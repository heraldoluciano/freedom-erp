/* Server version: LI-V6.3.3.4870 Firebird 1.5 
   SQLDialect: 3. ODS: 10.1. Forced writes: On. Sweep inteval: 20000.
   Page size: 4096. Cache pages: 2048 (8192 Kb). Read-only: False. */
SET SQL DIALECT 3;

CONNECT '/opt/firebird/dados/desenv/1.2.4.4/freedom.fdb' USER 'SYSDBA' PASSWORD 'masterkey';

SET AUTODDL ON;

RECONNECT;

ALTER TABLE VDTEF DROP CONSTRAINT VDTEFPK;

ALTER TABLE VDCLIENTE DROP CONSTRAINT VDCLIENTEFKFNTIPOD;

ALTER TABLE VDCLIENTE DROP CONSTRAINT VDCLIENTEFKFNTIPOB;

ALTER TABLE SGTRATARET DROP CONSTRAINT SGTRATARETFKSGITPR;

ALTER TABLE SGTRATARET DROP CONSTRAINT SGTRATARETFKSGITP2;

ALTER TABLE SGPREFERE2 DROP CONSTRAINT SGPREFERE2FKSGITTA;

ALTER TABLE SGPREFERE2 DROP CONSTRAINT SGPREFERE2FKSGITT2;

RECONNECT;

ALTER TABLE PPPROCESSAOPTMP DROP CONSTRAINT PPPROCESSFKSGEST;

ALTER TABLE PVCAIXA DROP CONSTRAINT PVCAIXAFKSGESTACAO;

ALTER TABLE SGESTACAOBAL DROP CONSTRAINT SGESTACAOBALFKSGES;

ALTER TABLE SGESTACAOIMP DROP CONSTRAINT SGESTACAOIMPFKSGES;

ALTER TABLE SGESTACAO DROP CONSTRAINT SGESTACAOPK;

ALTER TABLE RHCANDIDATO DROP CONSTRAINT RHCANDIDATOFKESTCIVIL;

ALTER TABLE PPRETCP DROP CONSTRAINT PPRETCPFKPPOP;

ALTER TABLE PPDISTRIB DROP CONSTRAINT PPDISTRIBFKPPESTRU;

ALTER TABLE PPDISTRIB DROP CONSTRAINT PPDISTRIBFKPPESTFA;

ALTER TABLE LFITREGRAFISCAL DROP CONSTRAINT LFITREGRAFISFKLFRE;

ALTER TABLE LFITREGRAFISCAL DROP CONSTRAINT LFITREGRAFISFKLFNA;

ALTER TABLE LFITREGRAFISCAL DROP CONSTRAINT LFITREGRAFISFKEQTI;

ALTER TABLE FNPAGCHEQ DROP CONSTRAINT FNPAGCHEQFKFNITPAG;

ALTER TABLE FNPAGCHEQ DROP CONSTRAINT FNPAGCHEQFKCHEQUE;

ALTER TABLE FNPAGAR DROP CONSTRAINT FNPAGARFKFNPLANEJ;

ALTER TABLE EQMOVSERIE DROP CONSTRAINT EQMOVSERIEFKVDITVEN;

ALTER TABLE EQMOVSERIE DROP CONSTRAINT EQMOVSERIEFKSGFILIA;

ALTER TABLE EQMOVSERIE DROP CONSTRAINT EQMOVSERIEFKEQTIPOM;

ALTER TABLE EQMOVSERIE DROP CONSTRAINT EQMOVSERIEFKEQSERIE;

ALTER TABLE EQMOVSERIE DROP CONSTRAINT EQMOVSERIEFKEQOP;

ALTER TABLE EQMOVSERIE DROP CONSTRAINT EQMOVSERIEFKEQITRMA;

ALTER TABLE EQMOVSERIE DROP CONSTRAINT EQMOVSERIEFKEQINVPR;

ALTER TABLE EQMOVSERIE DROP CONSTRAINT EQMOVSERIEFKCPITCOM;

ALTER TABLE EQMOVPROD DROP CONSTRAINT EQMOVPRODFKEQOP;

RECONNECT;

ALTER TABLE ATTIPOATENDOSETOR DROP CONSTRAINT ATTIPOATENDOSETOPK;

/* Drop Index... */
RECONNECT;

/* Drop: EQPRODUTOIDX01 (TIdxData) */
DROP INDEX EQPRODUTOIDX01;


/* Create Table... */
CREATE TABLE ATESPECATEND(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODESPEC INTEGER NOT NULL,
DESCESPEC VARCHAR(100) NOT NULL,
PGCOMIESPEC CHAR DEFAULT 'S' NOT NULL,
COBCLIESPEC CHAR DEFAULT 'S' NOT NULL,
CONTMETAESPEC CHAR DEFAULT 'S' NOT NULL,
TEMPOMINCOBESPEC INTEGER DEFAULT 0 NOT NULL,
TEMPOMAXCOBESPEC INTEGER DEFAULT 0 NOT NULL,
PERCCOMIESPEC NUMERIC(15,5) DEFAULT 0 NOT NULL,
DTINS DATE DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now' NOT NULL,
IDUSUALT VARCHAR(128) DEFAULT USER NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
MRELCOBESPEC CHAR DEFAULT 'S' NOT NULL);


UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Especificação dos atendimentos'
WHERE RDB$RELATION_NAME = 'ATESPECATEND';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'CODEMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'CODFILIAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da especificação.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'CODESPEC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Descrição da especificação.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'DESCESPEC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Paga comissão (S/N).'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'PGCOMIESPEC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Cobrar do cliente (S/N).'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'COBCLIESPEC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Contabiliza para meta (S/N).'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'CONTMETAESPEC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tempo mínimo a contabilizar.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'TEMPOMINCOBESPEC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tempo máximo a contabilizar.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'TEMPOMAXCOBESPEC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Percentual de comissão do atendente.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'PERCCOMIESPEC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de inserção.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'DTINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Id do usuário que inseriu.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'IDUSUINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Id do usuário que fez a Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'IDUSUALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora de inserção.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'HINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'ATESPECATEND' AND RDB$FIELD_NAME = 'HALT';

CREATE TABLE CPIMPORTACAO(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODIMP INTEGER NOT NULL,
CODEMPMI INTEGER NOT NULL,
CODFILIALMI SMALLINT NOT NULL,
CODMOEDA CHAR(4) NOT NULL,
COTACAOMOEDA NUMERICDN NOT NULL,
CODEMPPG INTEGER NOT NULL,
CODFILIALPG SMALLINT NOT NULL,
CODPLANOPAG INTEGER NOT NULL,
CODEMPFR INTEGER NOT NULL,
CODFILIALFR SMALLINT NOT NULL,
CODFOR INTEGER NOT NULL,
INVOICE VARCHAR(20),
DI CHAR(10),
MANIFESTO VARCHAR(20),
CERTORIGEM VARCHAR(200),
LACRE VARCHAR(100),
PRESCARGA VARCHAR(200),
IDENTHOUSE VARCHAR(100),
DTA VARCHAR(50),
CONHECCARGA VARCHAR(100),
IDENTCONTAINER CHAR(20),
TIPOMANIFESTO VARCHAR(20),
DTIMP DATE NOT NULL,
DTEMB DATE,
DTCHEGADA DATE,
DTDESEMBDI DATE,
DTREGDI DATE,
LOCALEMB VARCHAR(200),
RECINTOADUANEIRO VARCHAR(200),
CODPAISDESEMBDI INTEGER,
SIGLAUFDESEMBDI CHAR(2),
LOCDESEMBDI CHAR(60),
OBS VARCHAR(1024),
VEICULO VARCHAR(200),
PESOBRUTO NUMERICDN DEFAULT 0.00 NOT NULL,
PESOLIQUIDO NUMERICDN DEFAULT 0.00 NOT NULL,
VLRFRETEMI NUMERICDN DEFAULT 0.00 NOT NULL,
VLRFRETE NUMERICDN DEFAULT 0.00 NOT NULL,
VMLEMI NUMERICDN DEFAULT 0.00 NOT NULL,
VMLDMI NUMERICDN DEFAULT 0.00 NOT NULL,
VMLE NUMERICDN DEFAULT 0.00 NOT NULL,
VMLD NUMERICDN DEFAULT 0.00 NOT NULL,
VLRSEGUROMI NUMERICDN DEFAULT 0.00 NOT NULL,
VLRSEGURO NUMERICDN DEFAULT 0.00 NOT NULL,
VLRII NUMERICDN DEFAULT 0.00 NOT NULL,
VLRIPI NUMERICDN DEFAULT 0.00 NOT NULL,
VLRPIS NUMERICDN DEFAULT 0.00 NOT NULL,
VLRCOFINS NUMERICDN DEFAULT 0.00 NOT NULL,
VLRDIREITOSAD NUMERICDN DEFAULT 0.00 NOT NULL,
VLRTHC NUMERICDN DEFAULT 0.00 NOT NULL,
VLRTHCMI NUMERICDN DEFAULT 0.00 NOT NULL,
VLRTXSISCOMEX NUMERICDN DEFAULT 0.00 NOT NULL,
VLRAD NUMERICDN DEFAULT 0.00 NOT NULL,
VLRADMI NUMERICDN DEFAULT 0.00 NOT NULL,
VLRBASEICMS NUMERICDN DEFAULT 0.00 NOT NULL,
VLRICMS NUMERICDN DEFAULT 0.00 NOT NULL,
VLRICMSDIFERIDO NUMERICDN DEFAULT 0.00 NOT NULL,
VLRICMSDEVIDO NUMERICDN DEFAULT 0.00 NOT NULL,
VLRICMSCREDPRESUM NUMERICDN DEFAULT 0.00 NOT NULL,
VLRICMSRECOLHIMENTO NUMERICDN DEFAULT 0.00 NOT NULL,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER);


UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Tabela de informações sobre importações.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODEMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODFILIAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da importação'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODIMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa da moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODEMPMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial da moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODFILIALMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODMOEDA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Fator de conversão da moeda de importação para moeda corrente.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'COTACAOMOEDA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do plano de pagamento.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODEMPPG';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do plano de pagamento'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODFILIALPG';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do plano de pagamento acordado no invoice.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODPLANOPAG';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do fornecedor.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODEMPFR';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do fornecedor.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODFILIALFR';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
' Código do fornecedor na importação.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODFOR';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do invoice (pedido de compra de importação)'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'INVOICE';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Número da declaração de importação .'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'DI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do manifesto de carga.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'MANIFESTO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Certificado de origem da mercadoria.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CERTORIGEM';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do lacre'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'LACRE';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Presença de carga'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'PRESCARGA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação House B/L'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'IDENTHOUSE';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do conhecimento de carga.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CONHECCARGA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do container'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'IDENTCONTAINER';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo de manifesto.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'TIPOMANIFESTO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da importação'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'DTIMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de embarque.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'DTEMB';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de chegada'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'DTCHEGADA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data do desembaraço da declaração de importação'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'DTDESEMBDI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de registro da declaração de importação.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'DTREGDI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Local do desembaraço da declaração de importação.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'LOCALEMB';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Recinto Aduaneiro'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'RECINTOADUANEIRO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do país do desembaraço da DI'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'CODPAISDESEMBDI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Sigla da unidade da federação do desembaraço da DI'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'SIGLAUFDESEMBDI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
' Local de desembaraço da DI.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'LOCDESEMBDI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Observações'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'OBS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do veículo (ex.: Nome do navio)'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VEICULO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Peso bruto total.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'PESOBRUTO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Peso líquido total'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'PESOLIQUIDO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do frete na moeda de importação'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRFRETEMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do frete na moeda corrente.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRFRETE';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor liquido sem o frete na moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VMLEMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor liquido mais o frete na moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VMLDMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor liquido sem o frete na moeda corrente.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VMLE';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor liquido mais o frete na moeda corrente.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VMLD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do seguro na moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRSEGUROMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do seguro na moeda corrente.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRSEGURO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do imposto de importação.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRII';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do  IPI'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRIPI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do PIS'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRPIS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do cofins'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRCOFINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor de direitos antidumping.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRDIREITOSAD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor da taxa de manutenção no terminal (Terminal Handling Charges)'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRTHC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do THC em moeda de importação'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRTHCMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor da taxa siscomex.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRTXSISCOMEX';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor aduaneiro valor da mercadoria + frete +seguro +thc
'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRAD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor aduaneiro em moeda de importação
'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRADMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Base de calculo do icms
'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'VLRBASEICMS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de inserção do registro.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'DTINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora de inserção do registro.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'HINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do usuário que inseriu o registro'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'IDUSUINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de alteração do registro'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora de alteração do registro.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do usuário que alterou o registro.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAO' AND RDB$FIELD_NAME = 'IDUSUALT';

CREATE TABLE CPIMPORTACAOADIC(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODIMP INTEGER NOT NULL,
CODNCM VARCHAR(10) NOT NULL,
CODADIC INTEGER NOT NULL,
VLRTXSISCOMEX NUMERICDN NOT NULL,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER);


UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Tabela de adições da importação.'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'CODEMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'CODFILIAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da importação'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'CODIMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da NCM'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'CODNCM';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da adicao'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'CODADIC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor da taxa siscomex para a adicão'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'VLRTXSISCOMEX';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de inserção do registro'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'DTINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora de inserção do registro'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'HINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do usuário de inseriu o registro'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'IDUSUINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da alteração do registro'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da alteração do registro'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do usuário que alterou o registro'
WHERE RDB$RELATION_NAME = 'CPIMPORTACAOADIC' AND RDB$FIELD_NAME = 'IDUSUALT';

CREATE TABLE CPITIMPORTACAO(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODIMP INTEGER NOT NULL,
CODITIMP SMALLINT NOT NULL,
CODEMPPD INTEGER NOT NULL,
CODFILIALPD SMALLINT NOT NULL,
CODPROD INTEGER NOT NULL,
REFPROD VARCHAR(20) NOT NULL,
QTD NUMERICDN NOT NULL,
CODEMPUN INTEGER NOT NULL,
CODFILIALUN SMALLINT NOT NULL,
CODUNID VARCHAR(20) NOT NULL,
PESOLIQUIDO NUMERICDN NOT NULL,
PESOBRUTO NUMERICDN NOT NULL,
PRECOMI NUMERICDN NOT NULL,
PRECO NUMERICDN NOT NULL,
VMLEMI NUMERICDN DEFAULT 0.00 NOT NULL,
VMLDMI NUMERICDN DEFAULT 0.00 NOT NULL,
VMLE NUMERICDN DEFAULT 0.00 NOT NULL,
VMLD NUMERICDN DEFAULT 0.00 NOT NULL,
VLRFRETEMI NUMERICDN DEFAULT 0.00 NOT NULL,
VLRFRETE NUMERICDN DEFAULT 0.00 NOT NULL,
VLRSEGUROMI NUMERICDN DEFAULT 0.00 NOT NULL,
VLRSEGURO NUMERICDN DEFAULT 0.00 NOT NULL,
VLRTHCMI NUMERICDN DEFAULT 0.00 NOT NULL,
VLRTHC NUMERICDN DEFAULT 0.00 NOT NULL,
VLRADMI NUMERICDN DEFAULT 0.00 NOT NULL,
VLRAD NUMERICDN DEFAULT 0.00 NOT NULL,
ALIQICMSIMP NUMERICDN DEFAULT 0.00 NOT NULL,
ALIQICMSUF NUMERICDN DEFAULT 0.00 NOT NULL,
PERCDIFERICMS NUMERICDN DEFAULT 0.00 NOT NULL,
ALIQIPI NUMERICDN DEFAULT 0.00 NOT NULL,
ALIQPIS NUMERICDN DEFAULT 0.00 NOT NULL,
ALIQCOFINS NUMERICDN DEFAULT 0.00 NOT NULL,
ALIQII NUMERICDN DEFAULT 0.00 NOT NULL,
VLRII NUMERICDN DEFAULT 0.00 NOT NULL,
VLRIPI NUMERICDN DEFAULT 0.00 NOT NULL,
VLRPIS NUMERICDN DEFAULT 0.00 NOT NULL,
VLRCOFINS NUMERICDN DEFAULT 0.00 NOT NULL,
VLRBASEICMS NUMERICDN DEFAULT 0.00 NOT NULL,
VLRICMS NUMERICDN DEFAULT 0.00 NOT NULL,
VLRICMSDIFERIDO NUMERICDN DEFAULT 0.00 NOT NULL,
VLRICMSDEVIDO NUMERICDN DEFAULT 0.00 NOT NULL,
VLRICMSCREDPRESUM NUMERICDN DEFAULT 0.00 NOT NULL,
VLRICMSRECOLHIMENTO NUMERICDN DEFAULT 0.00 NOT NULL,
VLRTXSISCOMEX NUMERICDN DEFAULT 0.00 NOT NULL,
VLRVMCV NUMERICDN DEFAULT 0.00 NOT NULL,
CODEMPCF INTEGER,
CODFILIALCF SMALLINT,
CODFISC CHAR(13),
CODITFISC INTEGER,
CODNCM VARCHAR(10),
SEQADIC SMALLINT,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER);


UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Tabela de item de importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODEMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODFILIAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODIMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do item de importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODITIMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do produto.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODEMPPD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do produto.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODFILIALPD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do produto.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODPROD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Referência do produto.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'REFPROD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Quantidade de itens.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'QTD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa da unidade de medida.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODEMPUN';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial da unidade de medida.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODFILIALUN';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da unidade de medida
'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODUNID';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Peso liquido'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'PESOLIQUIDO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Peso bruto'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'PESOBRUTO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Preco na moeda de importação'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'PRECOMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Preço na moeda corrente.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'PRECO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor bruto da mercadoria na moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VMLEMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor bruto da mercadoria + frete e seguro, na moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VMLDMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor bruto da mercadoria na moeda corrente.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VMLE';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor bruto da mercadoria + frete e seguro, na moeda corrente.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VMLD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do frete na moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRFRETEMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do frete na moeda corrente.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRFRETE';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do seguro na moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRSEGUROMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do seguro na moeda corrente.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRSEGURO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do THC na moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRTHCMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do THC'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRTHC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor aduaneiro (Valor bruto+frete+seguro+thc) em moeda de importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRADMI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor aduaneiro (Valor bruto+frete+seguro+thc) na moeda corrente.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRAD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Aliquota do ICMS de importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'ALIQICMSIMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Aliquota do ICMS da UF (Operação futura)'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'ALIQICMSUF';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Percentual do diferimento do ICMS.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'PERCDIFERICMS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Aliquota de IPI'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'ALIQIPI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Aliquota do PIS'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'ALIQPIS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Aliquota do cofins'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'ALIQCOFINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Aliquota do imposto de importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'ALIQII';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do imposto de importação.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRII';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do IPI'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRIPI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do PIS'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRPIS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do cofins'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRCOFINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor da base do ICMS.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRBASEICMS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do ICMS bruto'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRICMS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do ICMS diferido'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRICMSDIFERIDO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do ICMS devido'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRICMSDEVIDO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do crédito do ICMS presumido.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRICMSCREDPRESUM';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do ICMS a recolher.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRICMSRECOLHIMENTO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor da taxa siscomex rateada por ítem.
'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRTXSISCOMEX';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor bruto
'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'VLRVMCV';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do da classificação fiscal.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODEMPCF';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial da classificação fiscal.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODFILIALCF';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Codigo da classificação fiscal.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODFISC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do item de classificação fiscal.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODITFISC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da NCM'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'CODNCM';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Sequencia do item na adição.
'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'SEQADIC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de inserção do registro.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'DTINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da inserção do registro.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'HINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do usuário que inseriu o registro.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'IDUSUINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da alteração do registro.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da alteração do registro.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do usuário que alterou o registro.'
WHERE RDB$RELATION_NAME = 'CPITIMPORTACAO' AND RDB$FIELD_NAME = 'IDUSUALT';

CREATE TABLE CRCHAMADOANEXO(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODCHAMADO INTEGER NOT NULL,
CODANEXO SMALLINT NOT NULL,
DESCANEXO VARCHAR(200),
ANEXO BLOB SUB_TYPE 1 SEGMENT SIZE 4096,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER);


UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do anexo'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'CODEMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do anexo;'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'CODFILIAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Códiugo do chamado;'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'CODCHAMADO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do anexo;'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'CODANEXO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Descrição do anexo;'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'DESCANEXO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Arquivo Binário.
'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'ANEXO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de inserção do registro no banco de dados;'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'DTINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora de inserção do registro no banco de dados'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'HINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Usuário que inseriu o registro no banco de dados;'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'IDUSUINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de alteração do registro no banco de dados;'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora de alteração do registro no banco de dados;'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Usuário que alterou o registro no banco de dados;'
WHERE RDB$RELATION_NAME = 'CRCHAMADOANEXO' AND RDB$FIELD_NAME = 'IDUSUALT';

CREATE TABLE CRQUALIFICACAO(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODQUALIFIC INTEGER NOT NULL,
DESCQUALIFIC CHAR(100) NOT NULL,
FINALIZA CHAR DEFAULT 'N' NOT NULL,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER);


UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Tabela para qualificação de chamados/atendimentos.'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa.'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO' AND RDB$FIELD_NAME = 'CODEMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO' AND RDB$FIELD_NAME = 'CODFILIAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da qualificação'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO' AND RDB$FIELD_NAME = 'CODQUALIFIC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Descrição da qualificação'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO' AND RDB$FIELD_NAME = 'DESCQUALIFIC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se a qualificação finaliza o processo (chamado/atendimento)
"S" - Sim
"N" - Não'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO' AND RDB$FIELD_NAME = 'FINALIZA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de inserção do registro'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO' AND RDB$FIELD_NAME = 'DTINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora de inserção do registro'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO' AND RDB$FIELD_NAME = 'HINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do usuário que inseriu o registro'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO' AND RDB$FIELD_NAME = 'IDUSUINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de altereção do registro'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora de alteração do registro'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação do usuário que alterou o registro'
WHERE RDB$RELATION_NAME = 'CRQUALIFICACAO' AND RDB$FIELD_NAME = 'IDUSUALT';

CREATE TABLE EQPRODUTOLOG(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPROD INTEGER NOT NULL,
PRECOBASEPRODANT NUMERICDN NOT NULL,
PRECOBASEPRODNOVO NUMERICDN NOT NULL,
SEQLOG INTEGER NOT NULL,
PRECOPROC CHAR DEFAULT 'N' NOT NULL,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER);


UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'CODEMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'CODFILIAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do produto'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'CODPROD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Preco base anterior.'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'PRECOBASEPRODANT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Novo preço base.'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'PRECOBASEPRODNOVO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Sequência do log'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'SEQLOG';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se o preço base já foi processado (tabelas de preço)'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'PRECOPROC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de inserção do registro'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'DTINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora de inserção do registro'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'HINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Usuário que inseriu o registro'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'IDUSUINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de alteração do registro'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora de alteração do registro'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Usuário que alterou o registro.'
WHERE RDB$RELATION_NAME = 'EQPRODUTOLOG' AND RDB$FIELD_NAME = 'IDUSUALT';

CREATE TABLE FNSINAL(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODSINAL SMALLINT NOT NULL,
DESCSINAL VARCHAR(100) NOT NULL,
CORSINAL INTEGER DEFAULT 0 NOT NULL,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT user NOT NULL,
DTALT DATE DEFAULT 'now' NOT NULL,
HALT TIME DEFAULT 'now' NOT NULL,
IDUSUALT VARCHAR(128) DEFAULT user NOT NULL);


UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Tabela de sinalização de lançamentos.'
WHERE RDB$RELATION_NAME = 'FNSINAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa.'
WHERE RDB$RELATION_NAME = 'FNSINAL' AND RDB$FIELD_NAME = 'CODEMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial.'
WHERE RDB$RELATION_NAME = 'FNSINAL' AND RDB$FIELD_NAME = 'CODFILIAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código de sinalização'
WHERE RDB$RELATION_NAME = 'FNSINAL' AND RDB$FIELD_NAME = 'CODSINAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Descrição da sinalização'
WHERE RDB$RELATION_NAME = 'FNSINAL' AND RDB$FIELD_NAME = 'DESCSINAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Cor da sinalização'
WHERE RDB$RELATION_NAME = 'FNSINAL' AND RDB$FIELD_NAME = 'CORSINAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de inserção'
WHERE RDB$RELATION_NAME = 'FNSINAL' AND RDB$FIELD_NAME = 'DTINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da inserção'
WHERE RDB$RELATION_NAME = 'FNSINAL' AND RDB$FIELD_NAME = 'HINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'ID do usuário que inseriu'
WHERE RDB$RELATION_NAME = 'FNSINAL' AND RDB$FIELD_NAME = 'IDUSUINS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da Ãºlt. alteração'
WHERE RDB$RELATION_NAME = 'FNSINAL' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da Ãºlt. alteração'
WHERE RDB$RELATION_NAME = 'FNSINAL' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'ID do usuário que alterou'
WHERE RDB$RELATION_NAME = 'FNSINAL' AND RDB$FIELD_NAME = 'IDUSUALT';

CREATE TABLE LFCSOSN(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CSOSN CHAR(4) NOT NULL,
DESCCSOSN VARCHAR(1000) NOT NULL,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER);


UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Tabela de situação da operação no simples nacional.'
WHERE RDB$RELATION_NAME = 'LFCSOSN';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código de situação da operação no simples nacional.'
WHERE RDB$RELATION_NAME = 'LFCSOSN' AND RDB$FIELD_NAME = 'CSOSN';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Descrição da situação da operação no simples nacional.'
WHERE RDB$RELATION_NAME = 'LFCSOSN' AND RDB$FIELD_NAME = 'DESCCSOSN';

CREATE TABLE PPITESTRUTURASUBPROD(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODPROD INTEGER NOT NULL,
SEQEST SMALLINT DEFAULT 0 NOT NULL,
SEQITESTSP SMALLINT NOT NULL,
REFPROD VARCHAR(20),
CODEMPPD INTEGER NOT NULL,
CODFILIALPD SMALLINT NOT NULL,
CODPRODPD INTEGER NOT NULL,
REFPRODPD VARCHAR(20),
CODEMPFS INTEGER NOT NULL,
CODFILIALFS SMALLINT NOT NULL,
CODFASE INTEGER NOT NULL,
SEQEF SMALLINT NOT NULL,
QTDITESTSP NUMERICDN NOT NULL,
QTDVARIAVEL CHAR DEFAULT 'N' NOT NULL,
QTDFIXA CHAR DEFAULT 'N' NOT NULL,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER);


CREATE TABLE PPOPSUBPROD(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
CODOP INTEGER NOT NULL,
SEQOP SMALLINT DEFAULT 0 NOT NULL,
SEQSUBPROD SMALLINT NOT NULL,
CODEMPPD INTEGER NOT NULL,
CODFILIALPD SMALLINT NOT NULL,
CODPROD INTEGER NOT NULL,
REFPROD VARCHAR(20) NOT NULL,
QTDITSP NUMERICDN DEFAULT 0 NOT NULL,
CODEMPFS INTEGER NOT NULL,
CODFILIALFS SMALLINT NOT NULL,
CODFASE INTEGER NOT NULL,
SEQOF SMALLINT NOT NULL,
CODEMPLE INTEGER,
CODFILIALLE SMALLINT,
CODLOTE VARCHAR(20),
CODEMPTM INTEGER NOT NULL,
CODFILIALTM SMALLINT NOT NULL,
CODTIPOMOV INTEGER NOT NULL,
DTSUBPROD DATE,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER);


UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Tabela para lançamento de sub-produtos em ordens de produção.'
WHERE RDB$RELATION_NAME = 'PPOPSUBPROD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Sequencial da fase
'
WHERE RDB$RELATION_NAME = 'PPOPSUBPROD' AND RDB$FIELD_NAME = 'SEQOF';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do tipo de movimento.'
WHERE RDB$RELATION_NAME = 'PPOPSUBPROD' AND RDB$FIELD_NAME = 'CODEMPTM';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do tipo de movimento'
WHERE RDB$RELATION_NAME = 'PPOPSUBPROD' AND RDB$FIELD_NAME = 'CODFILIALTM';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do tipo de movimento.'
WHERE RDB$RELATION_NAME = 'PPOPSUBPROD' AND RDB$FIELD_NAME = 'CODTIPOMOV';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data para entrada da subproducao (finalização da fase)
'
WHERE RDB$RELATION_NAME = 'PPOPSUBPROD' AND RDB$FIELD_NAME = 'DTSUBPROD';

CREATE TABLE VDITVENDAVDITCONTR(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
TIPOVENDA CHAR DEFAULT 'V' NOT NULL,
CODVENDA INTEGER NOT NULL,
CODITVENDA INTEGER NOT NULL,
CODEMPCT INTEGER NOT NULL,
CODFILIALCT SMALLINT NOT NULL,
CODCONTR INTEGER NOT NULL,
CODITCONTR SMALLINT NOT NULL,
DTINIAPURA DATE NOT NULL,
DTFINAPURA DATE NOT NULL,
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS VARCHAR(128) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT VARCHAR(128) DEFAULT USER);


CREATE TABLE VDREGCOMISDESC(CODEMP INTEGER NOT NULL,
CODFILIAL INTEGER NOT NULL,
CODREGCOMISDESC SMALLINT NOT NULL,
DESCREGCOMISDESC VARCHAR(100),
DESCONTO NUMERIC(15,2),
COMISSAO NUMERIC(15,2),
DTINS DATE DEFAULT 'now',
HINS TIME DEFAULT 'now',
IDUSUINS CHAR(8) DEFAULT USER,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER);


CREATE TABLE VDVENDAENTREGA(CODEMP INTEGER NOT NULL,
CODFILIAL SMALLINT NOT NULL,
TIPOVENDA CHAR DEFAULT 'V' NOT NULL,
CODVENDA INTEGER NOT NULL,
DTENTREGA DATE DEFAULT 'now' NOT NULL,
OBSENTREGA VARCHAR(1000),
RECEBEDOR VARCHAR(200),
ENTREGADOR VARCHAR(200),
DTINS DATE DEFAULT 'now' NOT NULL,
HINS TIME DEFAULT 'now' NOT NULL,
IDUSUINS CHAR(8) DEFAULT USER NOT NULL,
DTALT DATE DEFAULT 'now',
HALT TIME DEFAULT 'now',
IDUSUALT CHAR(8) DEFAULT USER);



ALTER TABLE ATATENDIMENTO ADD CODEMPEA INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa na tabela de especificação.'
WHERE RDB$RELATION_NAME = 'ATATENDIMENTO' AND RDB$FIELD_NAME = 'CODEMPEA';

ALTER TABLE ATATENDIMENTO ADD CODFILIALEA SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial na tabela de especificação.'
WHERE RDB$RELATION_NAME = 'ATATENDIMENTO' AND RDB$FIELD_NAME = 'CODFILIALEA';

ALTER TABLE ATATENDIMENTO ADD CODESPEC INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código de especificação.'
WHERE RDB$RELATION_NAME = 'ATATENDIMENTO' AND RDB$FIELD_NAME = 'CODESPEC';

ALTER TABLE CPCOMPRA ADD DTCOMPCOMPRA DATE NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de competência.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'DTCOMPCOMPRA';

ALTER TABLE CPCOMPRA ADD OBSNFE VARCHAR(10000);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Observacao gerada na emissao de nfe.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'OBSNFE';

ALTER TABLE CPCOMPRA ADD CODEMPOP INTEGER;

ALTER TABLE CPCOMPRA ADD CODFILIALOP SMALLINT;

ALTER TABLE CPCOMPRA ADD CODOP INTEGER;

ALTER TABLE CPCOMPRA ADD SEQOP SMALLINT;

ALTER TABLE CPCOMPRA ADD CODEMPIM INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa de importação.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'CODEMPIM';

ALTER TABLE CPCOMPRA ADD CODFILIALIM SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial da importação.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'CODFILIALIM';

ALTER TABLE CPCOMPRA ADD CODIMP INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da importação.
'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'CODIMP';

ALTER TABLE CPCOMPRA ADD VLRBASEIICOMPRA NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor da base de calculo do imposto de importação.
'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'VLRBASEIICOMPRA';

ALTER TABLE CPCOMPRA ADD VLRIICOMPRA NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do imposto de importação da compra.
'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'VLRIICOMPRA';

ALTER TABLE CPCOMPRA ADD VLRICMSDIFERIDO NUMERICDN;

ALTER TABLE CPCOMPRA ADD VLRICMSDEVIDO NUMERICDN;

ALTER TABLE CPCOMPRA ADD VLRICMSCREDPRESUM NUMERICDN;

ALTER TABLE CRCHAMADO ADD FATOGERADOR VARCHAR(1000);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Identificação da ação que gerou o problema.'
WHERE RDB$RELATION_NAME = 'CRCHAMADO' AND RDB$FIELD_NAME = 'FATOGERADOR';

ALTER TABLE CRCHAMADO ADD AMBIENTE VARCHAR(1000);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Informações sobre o ambiente onde ocorreu o fato;
'
WHERE RDB$RELATION_NAME = 'CRCHAMADO' AND RDB$FIELD_NAME = 'AMBIENTE';

ALTER TABLE CRCHAMADO ADD CODEMPQL INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa da qualificação do chamado'
WHERE RDB$RELATION_NAME = 'CRCHAMADO' AND RDB$FIELD_NAME = 'CODEMPQL';

ALTER TABLE CRCHAMADO ADD CODFILIALQL SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial da qualificação do chamado.
'
WHERE RDB$RELATION_NAME = 'CRCHAMADO' AND RDB$FIELD_NAME = 'CODFILIALQL';

ALTER TABLE CRCHAMADO ADD CODQUALIFIC INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da qualificação do atendimento.
'
WHERE RDB$RELATION_NAME = 'CRCHAMADO' AND RDB$FIELD_NAME = 'CODQUALIFIC';

ALTER TABLE EQMOVPROD ADD SEQSUBPROD SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Sequencial de subproduto.
'
WHERE RDB$RELATION_NAME = 'EQMOVPROD' AND RDB$FIELD_NAME = 'SEQSUBPROD';

ALTER TABLE EQPRODUTO ADD QTDPORPLANO SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica a quantidade de produto acabado por plano da folha (industria gráfica/etiquetas)'
WHERE RDB$RELATION_NAME = 'EQPRODUTO' AND RDB$FIELD_NAME = 'QTDPORPLANO';

ALTER TABLE EQPRODUTO ADD NROPLANOS SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica o nÃºmero de planos por folha (industria gráfica/etiquetas)'
WHERE RDB$RELATION_NAME = 'EQPRODUTO' AND RDB$FIELD_NAME = 'NROPLANOS';

ALTER TABLE EQPRODUTO ADD CERTFSC CHAR DEFAULT 'N';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se o produto participa da Certificação FSC.
Forest Stewardship Council (Conselho de Manejo Florestal).
"S" - Sim
"N" - Não
'
WHERE RDB$RELATION_NAME = 'EQPRODUTO' AND RDB$FIELD_NAME = 'CERTFSC';

ALTER TABLE EQPRODUTO ADD FATORFSC NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Fator para calculo dos relatórios FSC em folhas.
'
WHERE RDB$RELATION_NAME = 'EQPRODUTO' AND RDB$FIELD_NAME = 'FATORFSC';

ALTER TABLE EQRECMERC ADD OBSRECMERC CHAR(1000);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Observações.
'
WHERE RDB$RELATION_NAME = 'EQRECMERC' AND RDB$FIELD_NAME = 'OBSRECMERC';

ALTER TABLE EQRECMERC ADD DESCONTO NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Percentual de desconto ao peso total do recebimento da mercadoria.
'
WHERE RDB$RELATION_NAME = 'EQRECMERC' AND RDB$FIELD_NAME = 'DESCONTO';

ALTER TABLE EQTIPOMOV ADD CODEMPPP INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa para o plano de pagamento preferencial
'
WHERE RDB$RELATION_NAME = 'EQTIPOMOV' AND RDB$FIELD_NAME = 'CODEMPPP';

ALTER TABLE EQTIPOMOV ADD CODFILIALPP SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial para o plano de pagamento preferencial
'
WHERE RDB$RELATION_NAME = 'EQTIPOMOV' AND RDB$FIELD_NAME = 'CODFILIALPP';

ALTER TABLE EQTIPOMOV ADD CODPLANOPAG INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do plano de pagamento preferencial
'
WHERE RDB$RELATION_NAME = 'EQTIPOMOV' AND RDB$FIELD_NAME = 'CODPLANOPAG';

ALTER TABLE FNCARTCOB ADD CODCARTCOBCNAB CHAR;

ALTER TABLE FNFBNREC ADD NOMEARQUIVO VARCHAR(200);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Nome do arquivo de remessa em que o registro foi exportado.
'
WHERE RDB$RELATION_NAME = 'FNFBNREC' AND RDB$FIELD_NAME = 'NOMEARQUIVO';

ALTER TABLE FNITPAGAR ADD DTCOMPITPAG DATE NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de competência.'
WHERE RDB$RELATION_NAME = 'FNITPAGAR' AND RDB$FIELD_NAME = 'DTCOMPITPAG';

ALTER TABLE FNITPAGAR ADD CODEMPSN INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do sinalizador.
'
WHERE RDB$RELATION_NAME = 'FNITPAGAR' AND RDB$FIELD_NAME = 'CODEMPSN';

ALTER TABLE FNITPAGAR ADD CODFILIALSN SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do sinalizador.
'
WHERE RDB$RELATION_NAME = 'FNITPAGAR' AND RDB$FIELD_NAME = 'CODFILIALSN';

ALTER TABLE FNITPAGAR ADD CODSINAL SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do sinalizador.
'
WHERE RDB$RELATION_NAME = 'FNITPAGAR' AND RDB$FIELD_NAME = 'CODSINAL';

ALTER TABLE FNITPAGAR ADD MULTIBAIXA CHAR DEFAULT 'N';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se o título será baixado através de baixa multipla.
S - Sim;
N - Não'
WHERE RDB$RELATION_NAME = 'FNITPAGAR' AND RDB$FIELD_NAME = 'MULTIBAIXA';

ALTER TABLE FNITRECEBER ADD DTCOMPITREC DATE NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de competência.
'
WHERE RDB$RELATION_NAME = 'FNITRECEBER' AND RDB$FIELD_NAME = 'DTCOMPITREC';

ALTER TABLE FNITRECEBER ADD DTLIQITREC DATE;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de liquidação do título.
'
WHERE RDB$RELATION_NAME = 'FNITRECEBER' AND RDB$FIELD_NAME = 'DTLIQITREC';

ALTER TABLE FNITRECEBER ADD NOSSONUMERO VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Nosso nÃºmero (utilizado para armazenar o nosso nÃºmero quando gerado pelo banco e retornado através do CNAB)
'
WHERE RDB$RELATION_NAME = 'FNITRECEBER' AND RDB$FIELD_NAME = 'NOSSONUMERO';

ALTER TABLE FNITRECEBER ADD EMMANUT CHAR DEFAULT 'N' NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Coloca registro em estado de manutenção.
'
WHERE RDB$RELATION_NAME = 'FNITRECEBER' AND RDB$FIELD_NAME = 'EMMANUT';

ALTER TABLE FNITRECEBER ADD CODEMPSN INTEGER;

ALTER TABLE FNITRECEBER ADD CODFILIALSN SMALLINT;

ALTER TABLE FNITRECEBER ADD CODSINAL SMALLINT;

ALTER TABLE FNLANCA ADD DTCOMPLANCA DATE NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de competência.'
WHERE RDB$RELATION_NAME = 'FNLANCA' AND RDB$FIELD_NAME = 'DTCOMPLANCA';

ALTER TABLE FNLANCA ADD EMMANUT CHAR DEFAULT 'N' NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Estado de manutenção (S/N).
'
WHERE RDB$RELATION_NAME = 'FNLANCA' AND RDB$FIELD_NAME = 'EMMANUT';

ALTER TABLE FNLANCA ADD CODEMPSN INTEGER;

ALTER TABLE FNLANCA ADD CODFILIALSN SMALLINT;

ALTER TABLE FNLANCA ADD CODSINAL SMALLINT;

ALTER TABLE FNPAGAR ADD DTCOMPPAG DATE NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de competência.'
WHERE RDB$RELATION_NAME = 'FNPAGAR' AND RDB$FIELD_NAME = 'DTCOMPPAG';

ALTER TABLE FNPAGTOCOMI ADD DTCOMPPCOMI DATE NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de competência.'
WHERE RDB$RELATION_NAME = 'FNPAGTOCOMI' AND RDB$FIELD_NAME = 'DTCOMPPCOMI';

ALTER TABLE FNPAGTOCOMI ADD EMMANUT CHAR DEFAULT 'N' NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Estado de manutenção (S/N).'
WHERE RDB$RELATION_NAME = 'FNPAGTOCOMI' AND RDB$FIELD_NAME = 'EMMANUT';

ALTER TABLE FNRECEBER ADD DTCOMPREC DATE NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de competência.'
WHERE RDB$RELATION_NAME = 'FNRECEBER' AND RDB$FIELD_NAME = 'DTCOMPREC';

ALTER TABLE FNRECEBER ADD EMMANUT CHAR DEFAULT 'N' NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Estado de manutenção (S/N).'
WHERE RDB$RELATION_NAME = 'FNRECEBER' AND RDB$FIELD_NAME = 'EMMANUT';

ALTER TABLE FNSUBLANCA ADD DTCOMPSUBLANCA DATE NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de competência.'
WHERE RDB$RELATION_NAME = 'FNSUBLANCA' AND RDB$FIELD_NAME = 'DTCOMPSUBLANCA';

ALTER TABLE FNSUBLANCA ADD EMMANUT CHAR DEFAULT 'N' NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Estado de manutenção (S/N).'
WHERE RDB$RELATION_NAME = 'FNSUBLANCA' AND RDB$FIELD_NAME = 'EMMANUT';

ALTER TABLE LFITCLFISCAL ADD CODEMPCN INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do CSOSN
'
WHERE RDB$RELATION_NAME = 'LFITCLFISCAL' AND RDB$FIELD_NAME = 'CODEMPCN';

ALTER TABLE LFITCLFISCAL ADD CODFILIALCN SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do CSOSN
'
WHERE RDB$RELATION_NAME = 'LFITCLFISCAL' AND RDB$FIELD_NAME = 'CODFILIALCN';

ALTER TABLE LFITCLFISCAL ADD CSOSN CHAR(4);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código de situação da operação no simples nacional.
'
WHERE RDB$RELATION_NAME = 'LFITCLFISCAL' AND RDB$FIELD_NAME = 'CSOSN';

ALTER TABLE LFITCLFISCAL ADD ALIQICMSIMP NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Aliquota do ICMS de importação.
'
WHERE RDB$RELATION_NAME = 'LFITCLFISCAL' AND RDB$FIELD_NAME = 'ALIQICMSIMP';

ALTER TABLE LFITCOMPRA ADD PERCICMSSIMPLES NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Percentual de crédito de icms (simples)
'
WHERE RDB$RELATION_NAME = 'LFITCOMPRA' AND RDB$FIELD_NAME = 'PERCICMSSIMPLES';

ALTER TABLE LFITCOMPRA ADD VLRBASEICMSSTITRETCOMPRA NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Base de calculo do icms st retido na operação anterior.'
WHERE RDB$RELATION_NAME = 'LFITCOMPRA' AND RDB$FIELD_NAME = 'VLRBASEICMSSTITRETCOMPRA';

ALTER TABLE LFITCOMPRA ADD VLRICMSSTRETITCOMPRA NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do ICMS ST retido na operação anterior.
'
WHERE RDB$RELATION_NAME = 'LFITCOMPRA' AND RDB$FIELD_NAME = 'VLRICMSSTRETITCOMPRA';

ALTER TABLE LFITCOMPRA ADD ALIQII NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Aliquota do imposto de importação do item.
'
WHERE RDB$RELATION_NAME = 'LFITCOMPRA' AND RDB$FIELD_NAME = 'ALIQII';

ALTER TABLE LFITCOMPRA ADD VLRBASEII NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor da base de calculo do imposto de importação do item.
'
WHERE RDB$RELATION_NAME = 'LFITCOMPRA' AND RDB$FIELD_NAME = 'VLRBASEII';

ALTER TABLE LFITCOMPRA ADD VLRII NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do imposto de importação do item.
'
WHERE RDB$RELATION_NAME = 'LFITCOMPRA' AND RDB$FIELD_NAME = 'VLRII';

ALTER TABLE LFITCOMPRA ADD VLRICMSDIFERIDO NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do ICMS diferido.'
WHERE RDB$RELATION_NAME = 'LFITCOMPRA' AND RDB$FIELD_NAME = 'VLRICMSDIFERIDO';

ALTER TABLE LFITCOMPRA ADD VLRICMSDEVIDO NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do ICMS devido.'
WHERE RDB$RELATION_NAME = 'LFITCOMPRA' AND RDB$FIELD_NAME = 'VLRICMSDEVIDO';

ALTER TABLE LFITCOMPRA ADD VLRICMSCREDPRESUM NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do crédito presumido do ICMS'
WHERE RDB$RELATION_NAME = 'LFITCOMPRA' AND RDB$FIELD_NAME = 'VLRICMSCREDPRESUM';

ALTER TABLE PPFASE ADD EXTERNAFASE CHAR;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se a fase é realizada externamente (terceirização)
S - Sim
N - Nao
'
WHERE RDB$RELATION_NAME = 'PPFASE' AND RDB$FIELD_NAME = 'EXTERNAFASE';

ALTER TABLE PPITESTRUTURA ADD PERMITEAJUSTEITEST CHAR;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve permitir o ajuste da quantidade a ser utilizad na produção no momento da OP.
'
WHERE RDB$RELATION_NAME = 'PPITESTRUTURA' AND RDB$FIELD_NAME = 'PERMITEAJUSTEITEST';

ALTER TABLE PPITESTRUTURA ADD TIPOEXTERNO CHAR;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo de fluxo externo
E - Envio/Remessa
R - Retorno

'
WHERE RDB$RELATION_NAME = 'PPITESTRUTURA' AND RDB$FIELD_NAME = 'TIPOEXTERNO';

ALTER TABLE PPITOP ADD PERMITEAJUSTEITOP CHAR;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve permitir o ajuste de quantidades.
S/N
'
WHERE RDB$RELATION_NAME = 'PPITOP' AND RDB$FIELD_NAME = 'PERMITEAJUSTEITOP';

ALTER TABLE PPITOP ADD TIPOEXTERNO CHAR;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo de fluxo externo
E - Envio/Remessa
R - Retorno'
WHERE RDB$RELATION_NAME = 'PPITOP' AND RDB$FIELD_NAME = 'TIPOEXTERNO';

ALTER TABLE PPITOP ADD CODEMPVD INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa da venda (remessa ou retorno industrialização);
'
WHERE RDB$RELATION_NAME = 'PPITOP' AND RDB$FIELD_NAME = 'CODEMPVD';

ALTER TABLE PPITOP ADD CODFILIALVD SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial da venda (remessa ou retorno industrialização);'
WHERE RDB$RELATION_NAME = 'PPITOP' AND RDB$FIELD_NAME = 'CODFILIALVD';

ALTER TABLE PPITOP ADD TIPOVENDA CHAR;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo da venda (remessa ou retorno industrialização);'
WHERE RDB$RELATION_NAME = 'PPITOP' AND RDB$FIELD_NAME = 'TIPOVENDA';

ALTER TABLE PPITOP ADD CODVENDA INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da venda (remessa ou retorno industrialização);'
WHERE RDB$RELATION_NAME = 'PPITOP' AND RDB$FIELD_NAME = 'CODVENDA';

ALTER TABLE PPITOP ADD CODEMPCP INTEGER;

ALTER TABLE PPITOP ADD CODFILIALCP SMALLINT;

ALTER TABLE PPITOP ADD CODCOMPRA INTEGER;

ALTER TABLE PPOPCQ ADD SEQEF SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Sequencial da fase na estrutura.
'
WHERE RDB$RELATION_NAME = 'PPOPCQ' AND RDB$FIELD_NAME = 'SEQEF';

ALTER TABLE PPOPITORC ADD QTDFINALPRODITORC NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Quantidade final produzida para atendimento a este ítem de orçamento.
'
WHERE RDB$RELATION_NAME = 'PPOPITORC' AND RDB$FIELD_NAME = 'QTDFINALPRODITORC';

ALTER TABLE SGPREFERE1 ADD REVALIDARLOTECOMPRA CHAR DEFAULT 'N';

ALTER TABLE SGPREFERE1 ADD ENCORCPROD CHAR DEFAULT 'N';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve encaminhar orçamentos contendo produtos acabados para a produção (Sistema Pull)
'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'ENCORCPROD';

ALTER TABLE SGPREFERE1 ADD CODEMPIM INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do tipo de movimento para NF de importação.'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'CODEMPIM';

ALTER TABLE SGPREFERE1 ADD CODFILIALIM SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do tipo de movimento para NF de importação'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'CODFILIALIM';

ALTER TABLE SGPREFERE1 ADD CODTIPOMOVIM INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do tipo de movimento para nota fiscal de importação.'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'CODTIPOMOVIM';

ALTER TABLE SGPREFERE1 ADD COMISSAODESCONTO CHAR DEFAULT 'N';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve habilitar o mecanismo de comissionamento progressivo, de acordo com o desconto concedido.
"S" - Sim
"N" - Não
'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'COMISSAODESCONTO';

ALTER TABLE SGPREFERE1 ADD CODEMPHC INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa para histórico padrão para baixa CNAB.
'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'CODEMPHC';

ALTER TABLE SGPREFERE1 ADD CODFILIALHC SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial para histórico padrão para baixa CNAB.
'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'CODFILIALHC';

ALTER TABLE SGPREFERE1 ADD CODHISTCNAB INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do histórico padrão para baixa CNAB.
'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'CODHISTCNAB';

ALTER TABLE SGPREFERE1 ADD ALINHATELALANCA CHAR;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve alinhar a tela de lançamentos financeiros a direta.
S - Sim
N - Não
'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'ALINHATELALANCA';

ALTER TABLE SGPREFERE3 ADD BLOQATENDCLIATRASO CHAR;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve bloquear atendimentos para clientes em atraso. S - Sim
N - Não
'
WHERE RDB$RELATION_NAME = 'SGPREFERE3' AND RDB$FIELD_NAME = 'BLOQATENDCLIATRASO';

ALTER TABLE SGPREFERE3 ADD MOSTRACLIATRASO CHAR;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve exibir informação de cliente em atraso, na tela de gerenciamento de atendimentos.
S - Sim
N - Não'
WHERE RDB$RELATION_NAME = 'SGPREFERE3' AND RDB$FIELD_NAME = 'MOSTRACLIATRASO';

ALTER TABLE SGPREFERE3 ADD CODEMPNC INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do email de notificação de chamados a técnicos designados.'
WHERE RDB$RELATION_NAME = 'SGPREFERE3' AND RDB$FIELD_NAME = 'CODEMPNC';

ALTER TABLE SGPREFERE3 ADD CODFILIALNC SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do email de notificação de chamados a técnicos designados.'
WHERE RDB$RELATION_NAME = 'SGPREFERE3' AND RDB$FIELD_NAME = 'CODFILIALNC';

ALTER TABLE SGPREFERE3 ADD CODEMAILNC INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do email de notificação de chamados a técnicos designados.'
WHERE RDB$RELATION_NAME = 'SGPREFERE3' AND RDB$FIELD_NAME = 'CODEMAILNC';

ALTER TABLE SGPREFERE3 ADD CODEMPEC INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do email de notificação de chamados ao cliente.
'
WHERE RDB$RELATION_NAME = 'SGPREFERE3' AND RDB$FIELD_NAME = 'CODEMPEC';

ALTER TABLE SGPREFERE3 ADD CODFILIALEC SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do email de notificação de chamados ao cliente.
'
WHERE RDB$RELATION_NAME = 'SGPREFERE3' AND RDB$FIELD_NAME = 'CODFILIALEC';

ALTER TABLE SGPREFERE3 ADD CODEMAILEC INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do email de notificação de chamados ao cliente.
'
WHERE RDB$RELATION_NAME = 'SGPREFERE3' AND RDB$FIELD_NAME = 'CODEMAILEC';

ALTER TABLE SGPREFERE3 ADD CODEMPEA INTEGER;

ALTER TABLE SGPREFERE3 ADD CODFILIALEA SMALLINT;

ALTER TABLE SGPREFERE3 ADD CODEMAILEA INTEGER;

ALTER TABLE SGPREFERE5 ADD CODEMPTS INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa para tipo de movimento para entrada de subprodutos.
'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'CODEMPTS';

ALTER TABLE SGPREFERE5 ADD CODFILIALTS SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial para tipo de movimento para entrada de subprodutos.
'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'CODFILIALTS';

ALTER TABLE SGPREFERE5 ADD CODTIPOMOVSP INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do tipo de movimento para entrada de subprodutos.
'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'CODTIPOMOVSP';

ALTER TABLE SGPREFERE5 ADD CODEMPEN INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do tipo de movimento padrão para envio de remessa para produção externa.'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'CODEMPEN';

ALTER TABLE SGPREFERE5 ADD CODFILIALEN SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do tipo de movimento padrão para envio de remessa para produção externa.'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'CODFILIALEN';

ALTER TABLE SGPREFERE5 ADD CODTIPOMOVEN INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do tipo de movimento padrão para envio de remessa para produção externa.'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'CODTIPOMOVEN';

ALTER TABLE SGPREFERE5 ADD CODEMPRE INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do tipo de movimento padrão para retorno de produção externa.'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'CODEMPRE';

ALTER TABLE SGPREFERE5 ADD CODFILIALRE SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do tipo de movimento padrão para retorno de produção externa.'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'CODFILIALRE';

ALTER TABLE SGPREFERE5 ADD CODTIPOMOVRE INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do tipo de movimento padrão para retorno de produção externa.'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'CODTIPOMOVRE';

ALTER TABLE VDCLIENTE ADD DESCIPI CHAR;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve haver o desconto do IPI ao preço da mercadoria.
'
WHERE RDB$RELATION_NAME = 'VDCLIENTE' AND RDB$FIELD_NAME = 'DESCIPI';

ALTER TABLE VDCOMISSAO ADD DTCOMPCOMI DATE NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de competência.
'
WHERE RDB$RELATION_NAME = 'VDCOMISSAO' AND RDB$FIELD_NAME = 'DTCOMPCOMI';

ALTER TABLE VDCOMISSAO ADD EMMANUT CHAR DEFAULT 'N' NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Estado de manutenção (S/N).'
WHERE RDB$RELATION_NAME = 'VDCOMISSAO' AND RDB$FIELD_NAME = 'EMMANUT';

ALTER TABLE VDITCONTRATO ADD ACUMULOITCONTR SMALLINT DEFAULT 0 NOT NULL;

ALTER TABLE VDITVENDA ADD VLRBASEICMSSTRETITVENDA NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor da base de calculo do icms st retido na opearação anterior.'
WHERE RDB$RELATION_NAME = 'VDITVENDA' AND RDB$FIELD_NAME = 'VLRBASEICMSSTRETITVENDA';

ALTER TABLE VDITVENDA ADD VLRICMSSTRETITVENDA NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do icms st retido na operação anterior.
'
WHERE RDB$RELATION_NAME = 'VDITVENDA' AND RDB$FIELD_NAME = 'VLRICMSSTRETITVENDA';

ALTER TABLE VDPRECOPROD ADD TIPOPRECOPROD CHAR DEFAULT 'B';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica qual o tipo de preço que originário.
B - Preço Base
I - Custo informado;
O - Outros;
'
WHERE RDB$RELATION_NAME = 'VDPRECOPROD' AND RDB$FIELD_NAME = 'TIPOPRECOPROD';

ALTER TABLE VDPRECOPROD ADD DTALTPRECO DATE;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da alteração do preço.
'
WHERE RDB$RELATION_NAME = 'VDPRECOPROD' AND RDB$FIELD_NAME = 'DTALTPRECO';

ALTER TABLE VDPRECOPROD ADD HALTPRECO TIME;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora de alteração do preço.
'
WHERE RDB$RELATION_NAME = 'VDPRECOPROD' AND RDB$FIELD_NAME = 'HALTPRECO';

ALTER TABLE VDPRECOPROD ADD PRECOANT NUMERICDN;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Preço anterior Ã  Ãºltima alteração.
'
WHERE RDB$RELATION_NAME = 'VDPRECOPROD' AND RDB$FIELD_NAME = 'PRECOANT';

ALTER TABLE VDPRECOPROD ADD IDUSUALTPRECO CHAR(8);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Usuário que realizou a alteração no preço.
'
WHERE RDB$RELATION_NAME = 'VDPRECOPROD' AND RDB$FIELD_NAME = 'IDUSUALTPRECO';

ALTER TABLE VDVENDA ADD DTCOMPVENDA DATE NOT NULL;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de competência.'
WHERE RDB$RELATION_NAME = 'VDVENDA' AND RDB$FIELD_NAME = 'DTCOMPVENDA';

ALTER TABLE VDVENDA ADD OBSNFE VARCHAR(10000);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Observacoes geradas na emissao da nfe.'
WHERE RDB$RELATION_NAME = 'VDVENDA' AND RDB$FIELD_NAME = 'OBSNFE';

ALTER TABLE VDVENDA ADD DESCIPIVENDA CHAR;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se o valor do IPI foi descontado no preço dos ítens.
'
WHERE RDB$RELATION_NAME = 'VDVENDA' AND RDB$FIELD_NAME = 'DESCIPIVENDA';

ALTER TABLE VDVENDA ADD CODEMPOP INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da OP vinculada (remessa industrialização)
'
WHERE RDB$RELATION_NAME = 'VDVENDA' AND RDB$FIELD_NAME = 'CODEMPOP';

ALTER TABLE VDVENDA ADD CODFILIALOP SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial da OP vinculada (remessa industrialização)
'
WHERE RDB$RELATION_NAME = 'VDVENDA' AND RDB$FIELD_NAME = 'CODFILIALOP';

ALTER TABLE VDVENDA ADD SEQOP SMALLINT;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da sequencia da OP vinculada (remessa industrialização)
'
WHERE RDB$RELATION_NAME = 'VDVENDA' AND RDB$FIELD_NAME = 'SEQOP';

ALTER TABLE VDVENDA ADD CODOP INTEGER;

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'CCódigo da OP vinculada (remessa industrialização)
'
WHERE RDB$RELATION_NAME = 'VDVENDA' AND RDB$FIELD_NAME = 'CODOP';

UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Tabela de vinculo entre item de recebimento de mercadoria e seus respectivos numeros de serie."'
WHERE RDB$RELATION_NAME = 'EQITRECMERCSERIE';

UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Tabela para controle de nÃºmeros de série de produtos.'
WHERE RDB$RELATION_NAME = 'EQSERIE';

UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Tabela da situação do cantato com relação Ã  campanha, de acordo com a atividade desenvolvida.'
WHERE RDB$RELATION_NAME = 'TKSITCAMP';

UPDATE RDB$RELATIONS SET RDB$DESCRIPTION = 
'Tabela da situação do cliente com relação Ã  campanha, de acordo com a atividade desenvolvida.'
WHERE RDB$RELATION_NAME = 'TKSITCAMPCL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'CÃDIGO DDD DO FAX DO CONVENIADO.'
WHERE RDB$RELATION_NAME = 'ATCONVENIADO' AND RDB$FIELD_NAME = 'DDDFAXCONV';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'CÃDIGO DDD DO CELULAR DO CONVENIADO.'
WHERE RDB$RELATION_NAME = 'ATCONVENIADO' AND RDB$FIELD_NAME = 'DDDCELCONV';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Campo "coringa" para outras observações.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'OBS01';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Campo "coringa" para outras observações.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'OBS02';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Campo "coringa" para outras observações.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'OBS03';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Campo "coringa" para outras observações.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'OBS04';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve adicionar o valor do frete Ã  base de calculo do icms.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'ADICFRETEBASEICMS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve somar os valores adicionais Ã  base de calculo do ICMS.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'ADICADICBASEICMS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve adicionar o valor do IPI Ã  base de calculo do ICMS.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'ADICIPIBASEICMS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Chave de acesso da nota fiscal eletrÃ´nica de compra.'
WHERE RDB$RELATION_NAME = 'CPCOMPRA' AND RDB$FIELD_NAME = 'CHAVENFECOMPRA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'"PE" - Pendente;
"FN" - Finalizada;'
WHERE RDB$RELATION_NAME = 'CPCOTACAO' AND RDB$FIELD_NAME = 'SITCOMPITSOL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'"PE" - Pendente;
"AP" - Aprovada;'
WHERE RDB$RELATION_NAME = 'CPCOTACAO' AND RDB$FIELD_NAME = 'SITAPROVITSOL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'"PE" - Pendente;
"FN" - Finalizada;'
WHERE RDB$RELATION_NAME = 'CPCOTACAO' AND RDB$FIELD_NAME = 'SITITSOL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Endereço eletrÃ´nico do site do fornecedor.'
WHERE RDB$RELATION_NAME = 'CPFORNECED' AND RDB$FIELD_NAME = 'SITEFOR';

/* Empty CPADICITCOMPRAPEDSP for drop CPITCOMPRA(REFPROD) */
SET TERM ^ ;

ALTER PROCEDURE CPADICITCOMPRAPEDSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODCOMPRA INTEGER,
CODEMPPC INTEGER,
CODFILIALPC SMALLINT,
CODCOMPRAPC INTEGER,
CODITCOMPRAPC INTEGER,
TPAGRUP CHAR,
QTDITCOMPRA FLOAT,
VLRDESCITCOMPRA NUMERIC(15,5),
PRECOITCOMPRA NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

DROP VIEW EQCONFESTOQVW01;

SET TERM ^ ;

ALTER TRIGGER CPITCOMPRATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITCOMPRATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPITCOMPRA ALTER COLUMN REFPROD TYPE VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do nÃºmero de série'
WHERE RDB$RELATION_NAME = 'CPITCOMPRA' AND RDB$FIELD_NAME = 'CODEMPNS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do nÃºmero de série
'
WHERE RDB$RELATION_NAME = 'CPITCOMPRA' AND RDB$FIELD_NAME = 'CODFILIALNS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Campo para abrigar temporariamente o nÃºmero de serie do produto (para uso do trigger quando produto for unitário)
'
WHERE RDB$RELATION_NAME = 'CPITCOMPRA' AND RDB$FIELD_NAME = 'NUMSERIETMP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor do desconto do item da DI
'
WHERE RDB$RELATION_NAME = 'CPITCOMPRA' AND RDB$FIELD_NAME = 'DESCDI';

SET TERM ^ ;

ALTER TRIGGER CPITSOLICITACAOTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITSOLICITACAOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPITSOLICITACAO ALTER COLUMN REFPROD TYPE VARCHAR(20);

/* Empty EQCOPIAPROD for drop CPPRODFOR(REFPRODFOR) */
SET TERM ^ ;

ALTER PROCEDURE EQCOPIAPROD(ICODPROD INTEGER,
ICODEMP INTEGER,
ICODFILIAL INTEGER)
 RETURNS(ICOD INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

RECONNECT;

/* Drop: CPPRODFORIDX01 (TIdxData) */
DROP INDEX CPPRODFORIDX01;

ALTER TABLE CPPRODFOR ALTER COLUMN REFPRODFOR TYPE VARCHAR(21);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'CPRATEIO' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'CPRATEIO' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'ID do usuário que fez a Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'CPRATEIO' AND RDB$FIELD_NAME = 'IDUSUALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da Ãºltima alteração'
WHERE RDB$RELATION_NAME = 'CPSOLICITACAO' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da Ãºltima alteração'
WHERE RDB$RELATION_NAME = 'CPSOLICITACAO' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'ID do usuário da Ãºltima alteração'
WHERE RDB$RELATION_NAME = 'CPSOLICITACAO' AND RDB$FIELD_NAME = 'IDUSUALT';

SET TERM ^ ;

ALTER TRIGGER CPSUMSOLTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPSUMSOLTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE CPSUMSOL ALTER COLUMN REFPROD TYPE VARCHAR(20);

SET TERM ^ ;

ALTER TRIGGER EQCODALTPRODBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQCODALTPRODBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQPRODUTOTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQCODALTPROD ALTER COLUMN REFPROD TYPE VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica o tipo de conversão:
"U" - Apenas converte a unidade no mesmo produto;
"P" - Executa processo de conversão de produtos através de estrutura;'
WHERE RDB$RELATION_NAME = 'EQFATCONV' AND RDB$FIELD_NAME = 'TIPOCONV';

SET TERM ^ ;

ALTER TRIGGER EQINVPRODTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQINVPROD ALTER COLUMN REFPROD TYPE VARCHAR(20);

/* Empty VDADICITORCRECMERCSP for drop EQITRECMERC(REFPROD) */
SET TERM ^ ;

ALTER PROCEDURE VDADICITORCRECMERCSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
TICKET INTEGER,
CODEMPOC INTEGER,
CODFILIALOC SMALLINT,
CODORC INTEGER,
COMPONENTES CHAR,
SERVICOS CHAR,
NOVOS CHAR)
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER EQRECMERCTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQITRECMERC ALTER COLUMN REFPROD TYPE VARCHAR(20);

/* Empty EQGERARMAOSSP for drop EQITRECMERCITOS(REFPRODPD) */
SET TERM ^ ;

ALTER PROCEDURE EQGERARMAOSSP(CODEMPRM INTEGER,
CODFILIALRM INTEGER,
TICKET INTEGER,
CODITRECMERC SMALLINT)
 RETURNS(CODRMA INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE EQITRECMERCITOS ALTER COLUMN REFPRODPD TYPE VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'"PE" - Item pendente / previsto / Orçado
"EC" - Encaminhado / Chamado aberto / RMA aberta
"EA" - Em andamento
"CO" - Item Concluído;'
WHERE RDB$RELATION_NAME = 'EQITRECMERCITOS' AND RDB$FIELD_NAME = 'STATUSITOS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Coluna de status para repasse via triggers Ã  tabela de ordem de seviço na atualização do status do orçamento.
(Vide status da ordem de seviço).'
WHERE RDB$RELATION_NAME = 'EQITRECMERCITOSITORC' AND RDB$FIELD_NAME = 'STATUS';

/* Empty EQGERARMASP for drop EQITRMA(REFPROD) */
SET TERM ^ ;

ALTER PROCEDURE EQGERARMASP(CODEMPOP INTEGER,
CODFILIALOP INTEGER,
CODOP INTEGER,
SEQOP SMALLINT)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

DROP VIEW VWCUSTOPROJ01;

SET TERM ^ ;

ALTER PROCEDURE EQACERTACUSTORMASP AS
 BEGIN EXIT; END
^

SET TERM ; ^

DROP VIEW VWTMPCUSTOITRMA;

ALTER TABLE EQITRMA ALTER COLUMN REFPROD TYPE VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Situação da aprovação do item:
"PE" - Aprovação pendente
"AP" - Aprovação parcial
"AT" - Aprovação total
"NA" - Não aprovado'
WHERE RDB$RELATION_NAME = 'EQITRMA' AND RDB$FIELD_NAME = 'SITAPROVITRMA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Situação da expedição do item:
"PE" - Expedição pendente
"EP" - Expedição parcial
"ET" - Expedição total
"NE" - Não expedida'
WHERE RDB$RELATION_NAME = 'EQITRMA' AND RDB$FIELD_NAME = 'SITEXPITRMA';

SET TERM ^ ;

ALTER TRIGGER EQITSIMILARBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQITSIMILARBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQITSIMILAR ALTER COLUMN REFPROD TYPE VARCHAR(20);

/* Alter Field (Null / Not Null)... */
UPDATE RDB$RELATION_FIELDS SET RDB$NULL_FLAG = 1 WHERE RDB$FIELD_NAME='NUMSERIE' AND RDB$RELATION_NAME='EQMOVSERIE';

/* Alter Field (Null / Not Null)... */
UPDATE RDB$RELATION_FIELDS SET RDB$NULL_FLAG = NULL WHERE RDB$FIELD_NAME='CODEMPTM' AND RDB$RELATION_NAME='EQMOVSERIE';

/* Alter Field (Null / Not Null)... */
UPDATE RDB$RELATION_FIELDS SET RDB$NULL_FLAG = NULL WHERE RDB$FIELD_NAME='CODFILIALTM' AND RDB$RELATION_NAME='EQMOVSERIE';

/* Alter Field (Null / Not Null)... */
UPDATE RDB$RELATION_FIELDS SET RDB$NULL_FLAG = NULL WHERE RDB$FIELD_NAME='CODTIPOMOV' AND RDB$RELATION_NAME='EQMOVSERIE';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Quantidade movimentada:
1 - Entrada em estoque;
0 - Sem movimentação de estoque;
-1 - Saída de estoque;'
WHERE RDB$RELATION_NAME = 'EQMOVSERIE' AND RDB$FIELD_NAME = 'TIPOMOVSERIE';

/* Alter Field (Null / Not Null)... */
UPDATE RDB$RELATION_FIELDS SET RDB$NULL_FLAG = NULL WHERE RDB$FIELD_NAME='CODALMOX' AND RDB$RELATION_NAME='EQMOVSERIE';

/* Alter Field (Null / Not Null)... */
UPDATE RDB$RELATION_FIELDS SET RDB$NULL_FLAG = NULL WHERE RDB$FIELD_NAME='CODEMPAX' AND RDB$RELATION_NAME='EQMOVSERIE';

/* Alter Field (Null / Not Null)... */
UPDATE RDB$RELATION_FIELDS SET RDB$NULL_FLAG = NULL WHERE RDB$FIELD_NAME='CODFILIALAX' AND RDB$RELATION_NAME='EQMOVSERIE';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'EQPRODACESSO' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'EQPRODACESSO' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'ID. do usuário que fez a Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'EQPRODACESSO' AND RDB$FIELD_NAME = 'IDUSUALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'EQPRODPLAN' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'EQPRODPLAN' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Id do usuário da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'EQPRODPLAN' AND RDB$FIELD_NAME = 'IDUSUALT';

/* Empty EQADICPRODUTOSP for drop EQPRODUTO(REFPROD) */
SET TERM ^ ;

ALTER PROCEDURE EQADICPRODUTOSP(ICODPROD INTEGER,
SDESCPROD CHAR(50),
SDESCAUXPROD CHAR(40),
SREFPROD CHAR(13),
SCODFABPROD CHAR(13),
SCODBARPROD CHAR(13),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 AS
 BEGIN EXIT; END
^

/* Empty EQREFPRODSP for drop EQPRODUTO(REFPROD) */
ALTER PROCEDURE EQREFPRODSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODPROD INTEGER)
 RETURNS(REFPROD CHAR(13))
 AS
 BEGIN EXIT; END
^

/* Empty EQRELDEMANDASP for drop EQPRODUTO(REFPROD) */
ALTER PROCEDURE EQRELDEMANDASP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
SCODFILIALPD SMALLINT,
DDTINI DATE,
DDTFIM DATE)
 RETURNS(CODMARCA CHAR(6),
CODGRUP CHAR(14),
CODPROD INTEGER,
REFPROD CHAR(13),
DESCPROD CHAR(50),
DESCGRUP CHAR(50),
SLDINI NUMERIC(15,5),
VLRCOMPRAS NUMERIC(15,5),
VLRDEVENT NUMERIC(15,5),
VLROUTENT NUMERIC(15,5),
VLRVENDAS NUMERIC(15,5),
VLRDEVSAI NUMERIC(15,5),
VLROUTSAI NUMERIC(15,5),
SLDFIM NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

/* Empty EQRELGIROPROD for drop EQPRODUTO(REFPROD) */
ALTER PROCEDURE EQRELGIROPROD(CODEMP INTEGER,
CODFILIAL INTEGER,
DATA_BASE DATE)
 RETURNS(CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
REFPROD CHAR(13),
CODFABPROD CHAR(13),
CODBARPROD CHAR(13),
DESCPROD VARCHAR(80),
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
DOCCOMPRA INTEGER,
IDENTCONTAINER CHAR(20),
CODITCOMPRA SMALLINT,
DTULTCP DATE,
SALDOANT NUMERIC(15,5),
QTDULTCP NUMERIC(15,5),
QTDVENDIDA NUMERIC(15,5),
SALDOATU NUMERIC(15,5),
CODEMPGP INTEGER,
CODFILIALGP INTEGER,
CODGRUP CHAR(14))
 AS
 BEGIN EXIT; END
^

/* Empty EQRELINVPRODSP for drop EQPRODUTO(REFPROD) */
ALTER PROCEDURE EQRELINVPRODSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
CTIPOCUSTO CHAR,
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14),
DDTESTOQ DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(CODPROD INTEGER,
REFPROD CHAR(13),
DESCPROD CHAR(100),
CODGRUP CHAR(14),
SALDO NUMERIC(15,5),
CUSTO NUMERIC(15,5),
VLRESTOQ NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

/* Empty EQRELPEPSSP for drop EQPRODUTO(REFPROD) */
ALTER PROCEDURE EQRELPEPSSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DTESTOQ DATE,
ICODEMPMC INTEGER,
SCODFILIALMC SMALLINT,
CCODMARCA CHAR(6),
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP VARCHAR(14),
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(CODPROD INTEGER,
REFPROD CHAR(13),
DESCPROD CHAR(50),
SLDPROD NUMERIC(15,5),
CUSTOUNIT NUMERIC(15,5),
CUSTOTOT NUMERIC(15,5),
CODBARPROD CHAR(13),
CODFABPROD CHAR(15),
ATIVOPROD CHAR)
 AS
 BEGIN EXIT; END
^

/* Empty PPGERAOP for drop EQPRODUTO(REFPROD) */
ALTER PROCEDURE PPGERAOP(TIPOPROCESS CHAR,
CODEMPOP INTEGER,
CODFILIALOP SMALLINT,
CODOP INTEGER,
SEQOP INTEGER,
CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
CODEMPOC INTEGER,
CODFILIALOC SMALLINT,
CODORC INTEGER,
TIPOORC CHAR,
CODITORC SMALLINT,
QTDSUGPRODOP NUMERIC(15,5),
DTFABROP DATE,
SEQEST SMALLINT,
CODEMPET INTEGER,
CODFILIALET SMALLINT,
CODEST SMALLINT,
AGRUPDATAAPROV CHAR,
AGRUPDTFABROP CHAR,
AGRUPCODCLI CHAR,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
DATAAPROV DATE,
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
CODITCOMPRA SMALLINT,
JUSTFICQTDPROD VARCHAR(500),
CODEMPPDENTRADA INTEGER,
CODFILIALPDENTRADA SMALLINT,
CODPRODENTRADA INTEGER,
QTDENTRADA NUMERIC(15,5))
 RETURNS(CODOPRET INTEGER,
SEQOPRET SMALLINT)
 AS
 BEGIN EXIT; END
^

/* Empty PPRELCUSTOSP for drop EQPRODUTO(REFPROD) */
ALTER PROCEDURE PPRELCUSTOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DTESTOQ DATE,
ICODEMPMC INTEGER,
SCODFILIALMC SMALLINT,
CCODMARCA CHAR(6),
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14),
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(CODPROD INTEGER,
REFPROD CHAR(13),
DESCPROD CHAR(50),
TIPOPROD CHAR,
SLDPROD NUMERIC(15,5),
CUSTOUNIT NUMERIC(15,5),
CUSTOTOT NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

DROP VIEW PPLISTAOPVW01;

DROP VIEW VWPROD_PRECO_CUSTO;

SET TERM ^ ;

ALTER TRIGGER PPESTRUTURATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPESTRUTURATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPITESTRUTURATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPITESTRUTURATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPITOPTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPITOPTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPOPTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPOPTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDITORCAMENTOTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDITVENDATGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDITVENDATGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQPRODUTO ALTER COLUMN REFPROD TYPE VARCHAR(20);

/* Empty LFBUSCAPREVTRIBORC for drop EQPRODUTO(TIPOPROD) */
SET TERM ^ ;

ALTER PROCEDURE LFBUSCAPREVTRIBORC(CODEMP INTEGER,
CODFILIAL INTEGER,
CODORC INTEGER,
TIPOORC CHAR,
CODITORC SMALLINT)
 RETURNS(VLRICMS NUMERIC(15,5),
VLRIPI NUMERIC(15,5),
VLRPIS NUMERIC(15,5),
VLRCOFINS NUMERIC(15,5),
VLRIR NUMERIC(15,5),
VLRCSOCIAL NUMERIC(15,5),
VLRISS NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

/* Empty PPCUSTOPRODSP for drop EQPRODUTO(TIPOPROD) */
ALTER PROCEDURE PPCUSTOPRODSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
DTESTOQ DATE,
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CCOMSALDO CHAR(10))
 RETURNS(CUSTOUNIT NUMERIC(15,5),
SLDPROD NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

/* Empty VDADICITVENDAORCSP for drop EQPRODUTO(TIPOPROD) */
ALTER PROCEDURE VDADICITVENDAORCSP(FILIALATUAL INTEGER,
ICODVENDA INTEGER,
ICODORC INTEGER,
ICODITORC INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER,
STIPOVENDA CHAR(10),
TPAGRUP CHAR,
IQTDITVENDA NUMERIC(15,5),
VLRDESCITVENDA NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

/* Empty VDADICVENDAORCSP for drop EQPRODUTO(TIPOPROD) */
ALTER PROCEDURE VDADICVENDAORCSP(ICODORC INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER,
STIPOVENDA CHAR(10),
NEWCODVENDA INTEGER)
 RETURNS(IRET INTEGER)
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER EQITRECMERCITOSTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDITVENDATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE EQPRODUTO ALTER COLUMN TIPOPROD TYPE VARCHAR(2);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo de produto (campo "fluxo" do cadastro de produtos)
P  - Mercadoria p/revenda
S  - Serviço
E  - Equipamento
F  - Produto acabado
M  - Matéria prima
O  - Ativo imobilizado
C  - Material de Consumo
02 - Embalagem
03 - Em processo
05 - SubProduto
06 - Produto Intermediário
10 - Outros insumos
99 - Outros'
WHERE RDB$RELATION_NAME = 'EQPRODUTO' AND RDB$FIELD_NAME = 'TIPOPROD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se será exigido o nÃºmero de série para o produto.'
WHERE RDB$RELATION_NAME = 'EQPRODUTO' AND RDB$FIELD_NAME = 'SERIEPROD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'"S" - Exige senha para venda abaixo de custo deste produto
"N" - Bloqueado (depende de parametro nas preferencias)
"L" - Liberado sem senha para o produto.'
WHERE RDB$RELATION_NAME = 'EQPRODUTO' AND RDB$FIELD_NAME = 'VERIFPROD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se podem ser feitas RMAÂ´s do produto.'
WHERE RDB$RELATION_NAME = 'EQPRODUTO' AND RDB$FIELD_NAME = 'RMAPROD';

ALTER TABLE EQRECMERC ALTER COLUMN REFPROD TYPE VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Status da aprovação da RMA.
"PE" - Aprovação pendente.
"AP" - Aprovação parcial.
"AT" - Aprovação total.
"NA" - Não aprovada.'
WHERE RDB$RELATION_NAME = 'EQRMA' AND RDB$FIELD_NAME = 'SITAPROVRMA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Status da expedição da RMA.
"PE" - Expedição pendente.
"EP" - Expedida parcial.
"ET" - Expedida total.
"NE" - Não expedida.'
WHERE RDB$RELATION_NAME = 'EQRMA' AND RDB$FIELD_NAME = 'SITEXPRMA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica alocação do nÃºmero da nota fiscal.
'
WHERE RDB$RELATION_NAME = 'EQTIPOMOV' AND RDB$FIELD_NAME = 'SEQNFTIPOMOV';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se o sistema de comissões é com mÃºltiplos comissionados.'
WHERE RDB$RELATION_NAME = 'EQTIPOMOV' AND RDB$FIELD_NAME = 'MCOMISTIPOMOV';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo de recepção de mercadoria:
"RP" - Recebimento com pesagem;
"CM" - Coleta de materiais;
'
WHERE RDB$RELATION_NAME = 'EQTIPORECMERC' AND RDB$FIELD_NAME = 'TIPORECMERC';

RECONNECT;

ALTER TABLE FNITMODBOLETO DROP CONSTRAINT FNITMODBOLETOFKCAR;

ALTER TABLE FNITRECEBER DROP CONSTRAINT FNITRECEBERFKCARTC;

ALTER TABLE FNRECEBER DROP CONSTRAINT FNRECEBERFKFNCARTC;

ALTER TABLE VDCLIENTE DROP CONSTRAINT VDCLIENTEFKFNCARTC;

ALTER TABLE VDVENDA DROP CONSTRAINT VDVENDAFKCARTCOB;

ALTER TABLE FNCARTCOB DROP CONSTRAINT FNCARTCOBPK;

ALTER TABLE FNCARTCOB ALTER COLUMN CODCARTCOB TYPE CHAR(3);

ALTER TABLE FNCARTCOB ALTER COLUMN CARTCOBCNAB TYPE CHAR(3);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica o tipo de conta:
"C" - Baixa
"B" - Bancos'
WHERE RDB$RELATION_NAME = 'FNCONTA' AND RDB$FIELD_NAME = 'TIPOCONTA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica o tipo de caixa
"F" - Físico
"P" - Previsionamentos'
WHERE RDB$RELATION_NAME = 'FNCONTA' AND RDB$FIELD_NAME = 'TIPOCAIXA';

RECONNECT;

ALTER TABLE FNITMODBOLETO DROP CONSTRAINT FNITMODBOLETOPK;

/* Empty FNGERASEQNOSSONUMERO for drop FNITMODBOLETO(CODCARTCOB) */
SET TERM ^ ;

ALTER PROCEDURE FNGERASEQNOSSONUMERO(CODEMPBO INTEGER,
CODFILIALBO SMALLINT,
CODBANCO CHAR(3),
CODEMPCB INTEGER,
CODFILIALCB SMALLINT,
CODCARTCOB CHAR(2),
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
NUMCONTA CHAR(10))
 RETURNS(SEQNOSSONUMERO INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE FNITMODBOLETO ALTER COLUMN CODCARTCOB TYPE CHAR(3);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Sequencia do nosso numero, para geração de nosso numero no padrão "S" SGPREFER1.TPNOSSONUMERO.'
WHERE RDB$RELATION_NAME = 'FNITMODBOLETO' AND RDB$FIELD_NAME = 'SEQNOSSONUMERO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data de pagamento ou data de compensação.'
WHERE RDB$RELATION_NAME = 'FNITRECEBER' AND RDB$FIELD_NAME = 'DTPAGOITREC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'R1 (Conta em aberto)
RP (Recebimento total)
RB (Em Bordero)
RL (Recebimento parcial)
RN (Recebimento Renegociado) 
RR (Recebimento em Renegociacao)'
WHERE RDB$RELATION_NAME = 'FNITRECEBER' AND RDB$FIELD_NAME = 'STATUSITREC';

/* Empty FNADICITRECEBERSP01 for drop FNITRECEBER(CODCARTCOB) */
SET TERM ^ ;

ALTER PROCEDURE FNADICITRECEBERSP01(CALTVLR CHAR,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRDESCITREC NUMERIC(15,5),
NVLRMULTAITREC NUMERIC(15,5),
NVLRJUROSITREC NUMERIC(15,5),
NVLRPARCITREC NUMERIC(15,5),
NVLRPAGOITREC NUMERIC(15,5),
DDTITREC DATE,
DDTVENCITREC DATE,
CSTATUSITREC CHAR(2),
CFLAG CHAR,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3),
ICODEMPTC INTEGER,
SCODFILIALTC SMALLINT,
ICODTIPOCOB INTEGER,
ICODEMPCB INTEGER,
SCODFILIALCB SMALLINT,
CODCARTCOB CHAR(2),
NVLRCOMIITREC NUMERIC(15,5),
OBSITREC VARCHAR(250),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC SMALLINT,
CODCC CHAR(19),
VLRBASECOMIS NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER FNITRECEBERTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNITRECEBERTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNITRECEBER ALTER COLUMN CODCARTCOB TYPE CHAR(3);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Armazena o nÃºmero do recibo.'
WHERE RDB$RELATION_NAME = 'FNITRECEBER' AND RDB$FIELD_NAME = 'RECIBOITREC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Sequencial do nosso nÃºmero.'
WHERE RDB$RELATION_NAME = 'FNITRECEBER' AND RDB$FIELD_NAME = 'SEQNOSSONUMERO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código reduzido'
WHERE RDB$RELATION_NAME = 'FNPLANEJAMENTO' AND RDB$FIELD_NAME = 'CODREDPLAN';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Dia fixo ou Ãºtil para o vencimento.'
WHERE RDB$RELATION_NAME = 'FNPLANOPAG' AND RDB$FIELD_NAME = 'DIAVCTOPLANOPAG';

/* Empty FNADICRECEBERSP01 for drop FNRECEBER(CODCARTCOB) */
SET TERM ^ ;

ALTER PROCEDURE FNADICRECEBERSP01(CTIPOVENDA CHAR,
ICODVENDA INTEGER,
ICODEMPTC INTEGER,
ICODFILIALTC INTEGER,
CODTIPOCOB INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL SMALLINT,
CODCLI INTEGER,
ICODEMPVD INTEGER,
ICODFILIALVD SMALLINT,
CODVEND INTEGER,
VLRLIQVENDA NUMERIC(15,5),
DTVENDA DATE,
VLRCOMISVENDA NUMERIC(15,5),
DOCVENDA INTEGER,
ICODEMPBO INTEGER,
ICODFILIALBO SMALLINT,
CODBANCO CHAR(3),
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
CODEMPCB INTEGER,
CODFILIALCB SMALLINT,
CODCARTCOB CHAR(2),
FLAG CHAR,
OBSREC VARCHAR(250),
VLRBASECOMIS NUMERIC(15,5),
VLRRETENSAOISS NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER FNRECEBERTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNRECEBERTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE FNRECEBER ALTER COLUMN CODCARTCOB TYPE CHAR(3);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se o caixa foi fechado para este dia, se "S" não deverá permitir lançamentos para esta data.'
WHERE RDB$RELATION_NAME = 'FNSALDOLANCA' AND RDB$FIELD_NAME = 'FECHADO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Ãltimo cheque impresso.'
WHERE RDB$RELATION_NAME = 'FNTALAOCHEQ' AND RDB$FIELD_NAME = 'CHEQATUALTALAO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do remetente. Relacionada Ã  tabela de códigos unificados SGUNIFCOD
Pode ser cliente, fornecedor, empresa, etc...'
WHERE RDB$RELATION_NAME = 'LFFRETE' AND RDB$FIELD_NAME = 'CODREMET';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do destinatario. Relacionada Ã  tabela de códigos unificados SGUNIFCOD
Pode ser cliente, fornecedor, empresa, etc...'
WHERE RDB$RELATION_NAME = 'LFFRETE' AND RDB$FIELD_NAME = 'CODDESTINAT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo de redução de ICMS
B - BASE DE CÃLCULO
V - VALOR DO ICMS'
WHERE RDB$RELATION_NAME = 'LFITCLFISCAL' AND RDB$FIELD_NAME = 'TPREDICMSFISC';

ALTER TABLE PPESTRUTURA ALTER COLUMN REFPROD TYPE VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'"EX" = Execução;
"CQ" = Controle de qualidade;
"EB" = Embalagem.
'
WHERE RDB$RELATION_NAME = 'PPFASE' AND RDB$FIELD_NAME = 'TIPOFASE';

ALTER TABLE PPITESTRUTURA ALTER COLUMN REFPROD TYPE VARCHAR(20);

/* Empty PPITOPSP01 for drop PPITESTRUTURA(REFPRODPD) */
SET TERM ^ ;

ALTER PROCEDURE PPITOPSP01(ICODEMP INTEGER,
ICODFILIAL SMALLINT,
ICODOP INTEGER,
ISEQOP SMALLINT)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE PPITESTRUTURA ALTER COLUMN REFPRODPD TYPE VARCHAR(20);

SET TERM ^ ;

ALTER TRIGGER PPITOPTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE PPITOP ALTER COLUMN REFPROD TYPE VARCHAR(20);

ALTER TABLE PPOP ALTER COLUMN REFPROD TYPE VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da empresa do item de compra vinculado Ã  OP (conversão de produtos)'
WHERE RDB$RELATION_NAME = 'PPOP' AND RDB$FIELD_NAME = 'CODEMPCP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do item de compra vinculado Ã  OP (conversão de produtos)'
WHERE RDB$RELATION_NAME = 'PPOP' AND RDB$FIELD_NAME = 'CODFILIALCP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da compra do item vinculado Ã  OP (conversão de produtos)'
WHERE RDB$RELATION_NAME = 'PPOP' AND RDB$FIELD_NAME = 'CODCOMPRA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código do item de compra vinculado Ã  OP (conversão de produtos)'
WHERE RDB$RELATION_NAME = 'PPOP' AND RDB$FIELD_NAME = 'CODITCOMPRA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da Ãºltima alteração no registro.'
WHERE RDB$RELATION_NAME = 'PPOP' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da Ãºltima alteração no registro.'
WHERE RDB$RELATION_NAME = 'PPOP' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo de causas fundamentais:
"1M" - Material;
"2M" - Máquina;
"3M" - Método;
"4M" - Meio ambiente;
"5M" - Mão-de-obra;
"6M" - Medida;


'
WHERE RDB$RELATION_NAME = 'PPOPACAOCORRET' AND RDB$FIELD_NAME = 'TPCAUSA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo de ação corretiva pré-definida:
"II" - Inclusão de insumos;
"DP" - Descarte da produção;'
WHERE RDB$RELATION_NAME = 'PPOPACAOCORRET' AND RDB$FIELD_NAME = 'TPACAO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Status da análise de controle de qualidade.
"PE" - Pendente;
"AP" - Aprovado;
"RC" - Recusado;
"CO" - Corrigido.'
WHERE RDB$RELATION_NAME = 'PPOPCQ' AND RDB$FIELD_NAME = 'STATUS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se da fase está pendente ou finalizada.
"PE" - Pendente
"FN" - Finalizada'
WHERE RDB$RELATION_NAME = 'PPOPFASE' AND RDB$FIELD_NAME = 'SITFS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Quantidade do item de orçamento que deverá ser produzida nessa OP. (previsão)'
WHERE RDB$RELATION_NAME = 'PPOPITORC' AND RDB$FIELD_NAME = 'QTDPROD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo de registro de especificações.
"MM" - Mínimo e máximo;
"DT" - Descritivo.'
WHERE RDB$RELATION_NAME = 'PPTIPOANALISE' AND RDB$FIELD_NAME = 'TIPOEXPEC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Status do candidato:
"IN" - Inativo;
"DI" - Disponível;
"EN" - Encaminhado;
"EL" - Eliminado de processo seletivo;
"EF" - Efetivado;
"EM" - Empregado;
"EV" - Entrevistado;
"DL" - Desligado;'
WHERE RDB$RELATION_NAME = 'RHCANDIDATO' AND RDB$FIELD_NAME = 'STCAND';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'ConteÃºdo programático do curso.'
WHERE RDB$RELATION_NAME = 'RHCURSO' AND RDB$FIELD_NAME = 'CONTPROGCURSO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Status do empregado
"AD" - Admitido;
"DE" - Demitido;
"EF" - Em férias;
"LM" - Licença maternidade;
"AI" - Afastamento INSS;
"AP" - Aposentado;'
WHERE RDB$RELATION_NAME = 'RHEMPREGADO' AND RDB$FIELD_NAME = 'STATUSEMPR';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Status da vaga:
"AB" - Aberta;
"SL" - Em processo de seleção;
"CA" - Cancelada;
"PR" - Preenchida;'
WHERE RDB$RELATION_NAME = 'RHVAGA' AND RDB$FIELD_NAME = 'STVAGA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Situação do candidato na vaga:
"EN" Encaminhado
"EF" Efetivado '
WHERE RDB$RELATION_NAME = 'RHVAGACANDIDATO' AND RDB$FIELD_NAME = 'STVAGACAND';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Status da vaga:
""AB"" - Aberta;
""SL"" - Em processo de seleção;
""CA"" - Cancelada;
""PR"" - Preenchida;'
WHERE RDB$RELATION_NAME = 'RHVAGASTATUS' AND RDB$FIELD_NAME = 'STVAGA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Status do agendamento:
"PE" - Pendente;
"CA" - Cancelado;
"FN" - Finalizado;'
WHERE RDB$RELATION_NAME = 'SGAGENDA' AND RDB$FIELD_NAME = 'SITAGD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'SGATRIBUSU' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'SGATRIBUSU' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'ID do Ãºltimo usuário que alterou.'
WHERE RDB$RELATION_NAME = 'SGATRIBUSU' AND RDB$FIELD_NAME = 'IDUSUALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'SGESTACAO' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'SGESTACAO' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'ID do Ãºltimo usuário que alterou.'
WHERE RDB$RELATION_NAME = 'SGESTACAO' AND RDB$FIELD_NAME = 'IDUSUALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica o uso principal da balança.
"TO" - Todos;
"PI" - Pesagem inicial;
"TR" - Tiragem de renda/descarregamento;
"PF" - Pesagem final;'
WHERE RDB$RELATION_NAME = 'SGESTACAOBAL' AND RDB$FIELD_NAME = 'TIPOPROCRECMERC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Data da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'SGESTACAOIMP' AND RDB$FIELD_NAME = 'DTALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Hora da Ãºltima alteração.'
WHERE RDB$RELATION_NAME = 'SGESTACAOIMP' AND RDB$FIELD_NAME = 'HALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'ID do Ãºltimo usuário que alterou.'
WHERE RDB$RELATION_NAME = 'SGESTACAOIMP' AND RDB$FIELD_NAME = 'IDUSUALT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Classificação Nacional de Atividades EconÃ´micas (CNAE).'
WHERE RDB$RELATION_NAME = 'SGFILIAL' AND RDB$FIELD_NAME = 'CNAEFILIAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Especie do titulo.
01 - CH Cheque.
02 - DM Duplicata mercantíl.
03 - DMI Duplicata mercantíl p/ indicação.
04 - DS Duplicata de serviço.
05 - DSI DUplicata de serviçõ p/ indicação.
06 - DR Duplicata rural.
07 - LC Letra de cambio.
08 - NCC Nota de crédito comercial.
09 - NCE Nota de crédito a exportação.
10 - NCI Nota de crédito indÃºstria.
11 - NCR Nota de crédito rural.
12 - NP Nota promissória.
13 - NPR Nota promissória rural.
14 - TM Triplicata mercantíl.
15 - TS Triplicata de serviço.
16 - NS Nota de seguro.
17 - RC Recibo.
18 - FAT Fatura.
19 - ND Nota de débito.
20 - AP Apolice de seguro.
21 - ME Mensalidade escolar.
22 - PC Parcela de consórcio.
99 - Outros.

'
WHERE RDB$RELATION_NAME = 'SGITPREFERE6' AND RDB$FIELD_NAME = 'ESPECTIT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'FLAG QUE INDICA SE USA PEDIDO SEQUENCIAL NO ORÃAMENTO'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'USAORCSEQ';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Opção de validade para impressão nos orçamentos:
"N"=nÃºmero de dias ; 
"D" data 
'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'TIPOVALIDORC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Permitir clientes com mesmo CNPJ:
S-SIM N-NÃO
'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'CLIMESMOCNPJ';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Cálculo de comissões por duplicata
"S" calcula pelas parcelas do contas a receber.
"N" calcula pelo valor da venda.'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'COMISPDUPL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'S - mostra data de entrega no pedido
N - mostra nÃºmero de dias para entrega'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'DIASPEDT';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'FLAG INDICA SE FAZ VERIFICAÃÃO PARA ALTERAR PARCELA DA VENDA'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'VERIFALTPARCVENDA';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'BUSCA GENERICA DO CÃDIGO DO PRODUTO'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'BUSCACODPRODGEN';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'FILTAR POR PRODUTO NA BUSCA COM O CÃDIGO DE BARRAS'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'FILBUSCGENPROD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'FILTAR POR REFERENCIA NA BUSCA COM O CÃDIGO DE BARRAS'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'FILBUSCGENREF';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'FILTAR POR CODIGO DE BARRAS NA BUSCA COM O CÃDIGO DE BARRAS'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'FILBUSCGENCODBAR';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'FILTAR POR CODIGO DO FABRICANTE NA BUSCA COM O CÃDIGO DE BARRAS'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'FILBUSCGENCODFAB';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag "S" para indicar o uso de nome do vendedor no orçamento, caso contrário utilizará o nome da empresa.'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'USANOMEVENDORC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve permitir adicionar frete Ã  base de calculo do ICMS.
'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'ADICFRETEBASEICM';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica o padrão para geração do nosso nÃºmero (boletos e arquivos de remessa)
D - Número do documento (doc)
R - Número do contas a receber (codrec)
S - Sequencial Ãºnico (recomendado)'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'TPNOSSONUMERO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Define se o nÃºmero  NF será impresso no campo documento do boleto (S/N).
'
WHERE RDB$RELATION_NAME = 'SGPREFERE1' AND RDB$FIELD_NAME = 'IMPDOCBOL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'FLAG QUE PERMITE APROVAÃÃO DO ORÃAMENTO DA TELA DE CADASTRO DO ORÃAMENTO'
WHERE RDB$RELATION_NAME = 'SGPREFERE4' AND RDB$FIELD_NAME = 'APROVORC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'DIAS PARA O VENCIMENTO DO ORÃAMENTO.'
WHERE RDB$RELATION_NAME = 'SGPREFERE4' AND RDB$FIELD_NAME = 'DIASVENCORC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Situação da RMA gerada pela OP.
Pode ser:
"PE" - Pendente
"AF" - Aprovada 
"EF" - Expedida '
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'SITRMAOP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se deve baixar o estoque de insumos em RMA"s aprovadas não expedidas.'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'BAIXARMAAPROV';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica qual o nome a ser impresso no relatório de análise.
"U" - Usuário de cadastrou a anáse;
"R" - Responsável pela produção;'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'NOMERELANAL';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Status padrão da OP após inserção.
"PE" Pendente
"FN" Finalizada'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'SITPADOP';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Status padrão da OP de conversão de produtos após inserção.
"PE" Pendente
"FN" Finalizada'
WHERE RDB$RELATION_NAME = 'SGPREFERE5' AND RDB$FIELD_NAME = 'SITPADOPCONV';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo de código:
"C" - Cliente;
"F" - Fornecedor;
"T" - Transportadora;
"E" - Empresa/Filial;'
WHERE RDB$RELATION_NAME = 'SGUNIFCOD' AND RDB$FIELD_NAME = 'TIPOUNIFCOD';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Define se o usuário pode liberar venda de produtos do patrimÃ´nio (imobilizado).'
WHERE RDB$RELATION_NAME = 'SGUSUARIO' AND RDB$FIELD_NAME = 'VENDAPATRIMUSU';

ALTER TABLE SVAVALIACAO ALTER COLUMN REFPROD TYPE VARCHAR(20);

ALTER TABLE SVEXECUCAO ALTER COLUMN REFPROD TYPE VARCHAR(20);

ALTER TABLE SVITOS ALTER COLUMN REFPROD TYPE VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Observações relativas Ã  campanha.'
WHERE RDB$RELATION_NAME = 'TKCAMPANHA' AND RDB$FIELD_NAME = 'OBSCAMP';

ALTER TABLE VDCLIENTE ALTER COLUMN CODCARTCOB TYPE CHAR(3);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Endereço eletrÃ´nico do site do cliente.'
WHERE RDB$RELATION_NAME = 'VDCLIENTE' AND RDB$FIELD_NAME = 'SITECLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Conceito do cliente junto Ã  referencia comercial.'
WHERE RDB$RELATION_NAME = 'VDCLIREFC' AND RDB$FIELD_NAME = 'CONCEITO';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Tipo de cobrança do contrato:
"ME" - Contrato Mensal
"BI" - Contrato Bimestral
"AN" - Contrato Anual
"ES" - Contrato Esporádico'
WHERE RDB$RELATION_NAME = 'VDCONTRATO' AND RDB$FIELD_NAME = 'TPCOBCONTR';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Indica se tem características de contrato ou de projeto.
"C" - Contrato;
"P" - Projeto;'
WHERE RDB$RELATION_NAME = 'VDCONTRATO' AND RDB$FIELD_NAME = 'TPCONTR';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Valor cobrado por excedente Ã  quantidade contratada.'
WHERE RDB$RELATION_NAME = 'VDITCONTRATO' AND RDB$FIELD_NAME = 'VLRITCONTREXCED';

SET TERM ^ ;

ALTER TRIGGER VDITKITTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDITKITTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDITKIT ALTER COLUMN REFPROD TYPE VARCHAR(20);

/* Empty VDCOPIAORCSP for drop VDITORCAMENTO(REFPROD) */
SET TERM ^ ;

ALTER PROCEDURE VDCOPIAORCSP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODORC INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER)
 RETURNS(IRET INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE VDITORCAMENTO ALTER COLUMN REFPROD TYPE VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'"*"  - Orçamento em aberto;
"OA" - Orçamento em aberto;
"OC" - Orçamento completo/impresso;
"OL" - Orçamento liberado/aprovado;
"OV" - Orçamento faturado.
"OP" - Orçamento produzido.
"CA" - Orçamento Cancelado/Não Aprovado.'
WHERE RDB$RELATION_NAME = 'VDITORCAMENTO' AND RDB$FIELD_NAME = 'STATUSITORC';

/* Empty VDADICITEMPDVSP for drop VDITVENDA(REFPROD) */
SET TERM ^ ;

ALTER PROCEDURE VDADICITEMPDVSP(CODVENDA INTEGER,
CODEMP INTEGER,
CODFILIAL CHAR(8),
CODPROD INTEGER,
CODEMPPD INTEGER,
CODFILIALPD INTEGER,
QTDITVENDA NUMERIC(9,5),
VLRPRECOITVENDA NUMERIC(18,5),
VLRDESCITVENDA NUMERIC(18,5),
PERCDESCITVENDA NUMERIC(15,5),
VLRCOMISITVENDA NUMERIC(15,5),
PERCCOMISITVENDA NUMERIC(15,5),
SCODLOTE VARCHAR(20),
CODEMPLE INTEGER,
CODFILIALLE SMALLINT,
CODFILIALCV SMALLINT,
CODCONV INTEGER)
 RETURNS(CODITVENDA INTEGER,
PERCICMSITVENDA NUMERIC(9,2),
VLRBASEICMSITVENDA NUMERIC(18,3),
VLRICMSITVENDA NUMERIC(18,3),
VLRLIQITVENDA NUMERIC(18,3))
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

ALTER TABLE VDITVENDA ALTER COLUMN REFPROD TYPE VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Código da filial do nÃºmero de série.'
WHERE RDB$RELATION_NAME = 'VDITVENDA' AND RDB$FIELD_NAME = 'CODFILIALNS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Campo para abrigar temporariamente o nÃºmero de série do produto (para uso do trigger quando produto for unitário)'
WHERE RDB$RELATION_NAME = 'VDITVENDA' AND RDB$FIELD_NAME = 'NUMSERIETMP';

SET TERM ^ ;

ALTER TRIGGER VDKITTGBI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDKITTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDKIT ALTER COLUMN REFPROD TYPE VARCHAR(20);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'"*"  - Orçamento em aberto;
"OA" - Orçamento em aberto;
"OC" - Orçamento completo/impresso;
"OL" - Orçamento liberado/aprovado;
"OV" - Orçamento faturado.
"OP" - Orçamento produzido.
"CA" - Orçamento Cancelado/Não Aprovado.'
WHERE RDB$RELATION_NAME = 'VDORCAMENTO' AND RDB$FIELD_NAME = 'STATUSORC';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'CODIGO DA CLASSIFICAÃÃO DA COMISSÃO'
WHERE RDB$RELATION_NAME = 'VDORCAMENTO' AND RDB$FIELD_NAME = 'CODCLCOMIS';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (cheque).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'CHEQTIPOCLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (pessoa física).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'FISTIPOCLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (pessoa jurídica).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'JURTIPOCLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (Filiação).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'FILTIPOCLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (local de trabalho).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'LOCTRABTIPOCLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (Referências comerciais).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'REFCOMLTIPOCLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (Dados bancários).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'BANCTIPOCLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (referências pessoais).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'REFPESTIPOCLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (dados do cÃ´njuge jurídica).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'CONJTIPOCLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (veículos).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'VEICTIPOCLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (imóveis).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'IMOVTIPOCLI';

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Flag que indica se haverão aba adicional no cadastro de clientes (terras).'
WHERE RDB$RELATION_NAME = 'VDTIPOCLI' AND RDB$FIELD_NAME = 'TERRATIPOCLI';

SET TERM ^ ;

ALTER TRIGGER VDVENDATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

SET TERM ; ^

ALTER TABLE VDVENDA ALTER COLUMN CODCARTCOB TYPE CHAR(3);

UPDATE RDB$RELATION_FIELDS SET RDB$DESCRIPTION = 
'Chave de acesso da nota fiscal eletrÃ´nica.'
WHERE RDB$RELATION_NAME = 'VDVENDA' AND RDB$FIELD_NAME = 'CHAVENFEVENDA';


/* Drop table-fields... */
ALTER TABLE EQMOVSERIE DROP QTDMOVSERIE;


/* Create Procedure... */
SET TERM ^ ;

CREATE PROCEDURE FNCHECAPGTOATRASOSP(ICODCLI INTEGER,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 RETURNS(SRETORNO CHAR)
 AS
 BEGIN EXIT; END
^


/* Create Views... */
/* Create view: ATATENDIMENTOVW01 (ViwData.CreateDependDef) */
SET TERM ; ^

CREATE VIEW ATATENDIMENTOVW01(
CODEMP,
CODFILIAL,
CODATENDO,
CODEMPAE,
CODFILIALAE,
CODATEND,
NOMEATEND,
DESCESPEC,
CODEMPCT,
CODFILIALCT,
CODCONTR,
CODITCONTR,
STATUSATENDO,
RAZCLI,
CODCLI,
CODEMPCL,
CODFILIALCL,
CODEMPCH,
CODFILIALCH,
CODCHAMADO,
CODEMPTO,
CODFILIALTO,
CODTPATENDO,
DESCTPATENDO,
OBSATENDO,
DATAATENDO,
DATAATENDOFIN,
HORAATENDO,
HORAATENDOFIN,
PGCOMIESPEC,
COBCLIESPEC,
CONTMETAESPEC,
MRELCOBESPEC,
TEMPOMINCOBESPEC,
TEMPOMAXCOBESPEC,
PERCCOMIESPEC,
TOTALMIN)
 AS 
select a.codemp, a.codfilial, a.codatendo, 
  a.codempae, a.codfilialae, a.codatend, ate.nomeatend, e.descespec, 
  a.codempct, a.codfilialct, a.codcontr, a.coditcontr, a.statusatendo,
  c.razcli, c.codcli, c.codemp, c.codfilial,
  a.codempch, a.codfilialch, a.codchamado,
  a.codempto, a.codfilialto, a.codtpatendo, ta.desctpatendo,
  a.obsatendo, a.dataatendo, a.dataatendofin, a.horaatendo, a.horaatendofin,
  e.pgcomiespec, e.cobcliespec, e.contmetaespec, e.mrelcobespec,
  e.tempomincobespec, e.tempomaxcobespec, e.perccomiespec, ((a.horaatendofin-a.horaatendo) / 60) TOTALMIN
from atatendimento a, atatendente ate, atespecatend e, vdcliente c, attipoatendo ta
where ate.codemp=a.codempae and ate.codfilial=a.codfilialae and ate.codatend=a.codatend and
e.codemp=a.codempea and e.codfilial=a.codfilialea and e.codespec=a.codespec and 
c.codemp=a.codempcl and c.codfilial=a.codfilialcl and c.codcli=a.codcli and
ta.codemp=a.codempto and ta.codfilial=a.codfilialto and ta.codtpatendo=a.codtpatendo
;

/* Create view: EQCONFESTOQVW01 (ViwData.CreateDependDef) */
CREATE VIEW EQCONFESTOQVW01(
CODEMP,
CODFILIAL,
ATIVOPROD,
DESCPROD,
CODPROD,
REFPROD,
SLDLIQPROD,
QTDINVP,
QTDITCOMPRA,
QTDFINALPRODOP,
QTDEXPITRMA,
QTDITVENDA,
SLDMOVPROD,
SLDLIQPRODAX)
 AS 
SELECT P.CODEMP, P.CODFILIAL, P.ATIVOPROD, P.DESCPROD,P.CODPROD,P.REFPROD,P.SLDLIQPROD,
    COALESCE((SELECT SUM(QTDINVP)  FROM EQINVPROD IT WHERE IT.CODEMPPD=P.CODEMP AND
       IT.CODFILIALPD=P.CODFILIAL AND IT.CODPROD=P.CODPROD ),0) QTDINVP,
   COALESCE((SELECT SUM(QTDITCOMPRA)  FROM CPITCOMPRA IC, CPCOMPRA C, EQTIPOMOV TM
       WHERE IC.CODEMPPD=P.CODEMP AND IC.CODFILIALPD=P.CODFILIAL AND
       IC.CODPROD=P.CODPROD AND  C.CODCOMPRA=IC.CODCOMPRA AND
       C.CODEMP=IC.CODEMP AND C.CODFILIAL=IC.CODFILIAL AND  TM.CODTIPOMOV=C.CODTIPOMOV AND
       TM.CODEMP=C.CODEMPTM AND TM.CODFILIAL=C.CODFILIALTM AND TM.ESTOQTIPOMOV='S' ),0) QTDITCOMPRA,
   COALESCE((SELECT SUM(QTDFINALPRODOP) FROM PPOP O, EQTIPOMOV TM
      WHERE O.CODEMPPD=P.CODEMP AND O.CODFILIALPD=P.CODFILIAL AND O.CODPROD=P.CODPROD AND
      TM.CODTIPOMOV=O.CODTIPOMOV AND TM.CODEMP=O.CODEMPTM AND
      TM.CODFILIAL=O.CODFILIALTM  AND TM.ESTOQTIPOMOV='S' ),0) QTDFINALPRODOP,
   COALESCE((SELECT SUM(QTDEXPITRMA) FROM EQRMA R, EQITRMA IR, EQTIPOMOV TM  WHERE IR.CODEMPPD=P.CODEMP AND
      IR.CODFILIALPD=P.CODFILIAL AND IR.CODPROD=P.CODPROD AND  R.CODRMA=IR.CODRMA AND
      R.CODEMP=IR.CODEMP AND R.CODFILIAL=IR.CODFILIAL AND
      TM.CODTIPOMOV=R.CODTIPOMOV AND TM.CODEMP=R.CODEMPTM AND
      TM.CODFILIAL=R.CODFILIALTM  AND TM.ESTOQTIPOMOV='S' ),0) QTDEXPITRMA,
   COALESCE((SELECT SUM(QTDITVENDA) FROM VDITVENDA IV, VDVENDA V, EQTIPOMOV TM
      WHERE IV.CODEMPPD=P.CODEMP AND IV.CODFILIALPD=P.CODFILIAL AND IV.CODPROD=P.CODPROD AND
      V.CODVENDA=IV.CODVENDA AND V.TIPOVENDA=IV.TIPOVENDA AND
      V.CODEMP=IV.CODEMP AND V.CODFILIAL=IV.CODFILIAL AND
      (NOT SUBSTR(V.STATUSVENDA,1,1)='C') AND TM.CODTIPOMOV=V.CODTIPOMOV AND
      TM.CODEMP=V.CODEMPTM AND TM.CODFILIAL=V.CODFILIALTM  AND TM.ESTOQTIPOMOV='S' ),0) QTDITVENDA,
   COALESCE((SELECT FIRST 1 M.SLDMOVPROD FROM EQMOVPROD M WHERE M.CODEMPPD=P.CODEMP AND
      M.CODFILIALPD=P.CODFILIAL AND  M.CODPROD=P.CODPROD
      ORDER BY M.DTMOVPROD DESC, M.CODMOVPROD DESC ),0) SLDMOVPROD,
   COALESCE((SELECT SUM(SP.SLDLIQPROD) FROM EQSALDOPROD SP WHERE SP.CODEMP=P.CODEMP AND
      SP.CODFILIAL=P.CODFILIAL AND SP.CODPROD=P.CODPROD),0) SLDLIQPRODAX
   FROM EQPRODUTO P
;

/* Create view: PPLISTAOPVW01 (ViwData.CreateDependDef) */
CREATE VIEW PPLISTAOPVW01(
CODEMP,
CODFILIAL,
DTEMITOP,
DTFABROP,
CODOP,
SEQOP,
DESCEST,
SITOP,
TEMPOTOT,
TEMPOFIN,
FASEATUAL,
TOTFASES,
QTDSUG,
QTDPREV,
QTDFINAL,
CODPROD,
REFPROD,
CODSECAO)
 AS 
select op.codemp,op.codfilial,op.dtemitop, op.dtfabrop,op.codop, op.seqop, et.descest,op.sitop,
(select coalesce(sum( ef.tempoef ),0)
    from ppestrufase ef
    where
    ef.codemp=et.codemp and ef.codfilial=et.codfilial and ef.codprod=et.codprod and ef.seqest=et.seqest) as tempotot,
(select coalesce(sum( opf.tempoof ),0)
    from ppopfase opf
    where
    opf.codemp=op.codemp and opf.codfilial=op.codfilial and opf.codop=op.codop and opf.seqop=op.seqop
    and opf.sitfs='FN') as tempofin,
(select coalesce(min(opf.seqof),0) from ppopfase opf
    where
    opf.codemp=op.codemp and opf.codfilial=op.codfilial and opf.codop=op.codop and opf.seqop=op.seqop
    and opf.sitfs='PE') as faseatual,
(select count(*) from ppopfase opf
    where
    opf.codemp=op.codemp and opf.codfilial=op.codfilial and opf.codop=op.codop and opf.seqop=op.seqop) as totfases,
    op.qtdsugprodop,
    op.qtdprevprodop,
    op.qtdfinalprodop,
    pd.codprod, pd.refprod, pd.codsecao
from ppop op, ppestrutura et, eqproduto pd
where
et.codemp=op.codemppd and et.codfilial=op.codfilialpd and et.codprod=op.codprod and et.seqest=op.seqest
and pd.codemp=op.codemppd and pd.codfilial=op.codfilialpd and pd.codprod=op.codprod
;

/* Create view: VWCUSTOPROJ01 (ViwData.CreateDependDef) */
CREATE VIEW VWCUSTOPROJ01(
CODEMP,
CODFILIAL,
CODCLI,
DATA,
DESCCUSTO,
CODCONTR,
CODITCONTR,
TPCONTR,
VLRPREVREC,
QTDCUSTO,
VLRCUSTO,
TIPOCUSTO)
 AS 
select ad.codemp, ad.codfilial, ad.codcli, ad.dataatendo ,cast('Hora trabalhada - ' || rtrim(ae.nomeatend)  as varchar(200)) as desccusto, ad.codcontr,ad.coditcontr, co.tpcontr ,ic.vlritcontr * ic.qtditcontr as vlrreceitaprev,
 ( ad.horaatendofin  - ad.horaatendo ) / 3600 as qtd , sa.custohoratrab as custo, 'M' as tipo
from
vditcontrato ic, atatendimento ad, atatendente ae, rhempregado em, rhempregadosal sa, vdcontrato co
where
ic.codemp=ad.codempct and ic.codfilial=ad.codfilialct and ic.codcontr=ad.codcontr and ic.coditcontr=ad.coditcontr and
co.codemp=ic.codemp and co.codfilial=ic.codfilial and co.codcontr=ic.codcontr and
ae.codemp=ad.codempae and ae.codfilial=ad.codfilialae and ae.codatend=ad.codatend and
em.codemp=ae.codempep and em.codfilial=ae.codfilialep and em.matempr=ae.matempr and
sa.codemp=em.codemp and sa.codfilial=em.codfilial and sa.matempr=em.matempr and sa.seqsal=
(
    select first 1 seqsal from rhempregadosal s1 where s1.codemp=em.codemp and
    s1.codfilial=em.codfilial and s1.matempr=em.matempr and
    s1.dtvigor < cast('today' as date) order by s1.dtvigor desc
)
-- Custos de outras despesas financeiras;
union
select sl.codemp, sl.codfilial, co.codcli, sl.datasublanca, cast(sl.histsublanca as varchar(200)) as desccusto, ic.codcontr, ic.coditcontr, co.tpcontr ,ic.vlritcontr * ic.qtditcontr as vlrreceitaprev,
1.00 as qtd, sl.vlrsublanca  as custo, 'F' as tipo
from
vditcontrato ic, vdcontrato co, fnsublanca sl, fnplanejamento pl
where
ic.codemp=sl.codempct and ic.codfilial=sl.codfilialct and ic.codcontr=sl.codcontr and ic.coditcontr=sl.coditcontr and
co.codemp=ic.codemp and co.codfilial=ic.codfilial and co.codcontr=ic.codcontr
and pl.codemp=sl.codemppn and pl.codfilial=sl.codfilialpn and pl.codplan=sl.codplan and pl.tipoplan='D'
union
--Custos de estoque
select ir.codemp, ir.codfilial, co.codcli, rma.dtaexprma, cast(pd.descprod as varchar(200)) as desccusto ,ic.codcontr, ic.coditcontr, co.tpcontr, ic.vlritcontr * ic.qtditcontr as vlrreceitaprev,
ir.qtdexpitrma as qtd, ir.precoitrma as custo, 'E' as tipo
from
vditcontrato ic, vdcontrato co, eqrma rma, eqitrma ir, eqproduto pd
where ic.codemp=rma.codempct and ic.codfilial=rma.codfilialct and ic.codcontr=rma.codcontr and ic.coditcontr=rma.coditcontr and
co.codemp=ic.codemp and co.codfilial=ic.codfilial and co.codcontr=ic.codcontr
and ir.codemp=rma.codemp and ir.codfilial=rma.codfilial and ir.codrma=rma.codrma and
pd.codemp=ir.codemppd and pd.codfilial=ir.codfilialpd and pd.codprod=ir.codprod and
ir.sitexpitrma='ET'
;

/* Create view: VWPROD_PRECO_CUSTO (ViwData.CreateDependDef) */
CREATE VIEW VWPROD_PRECO_CUSTO(
REFPROD,
CODSECAO,
DESCPROD,
PRECOBASEPROD,
CUSTO)
 AS 
select pd.refprod, pd.codsecao, pd.descprod, pd.precobaseprod,
(case
when (select custounit from eqcustoprodsp(pd.codemp, pd.codfilial, pd.codprod,cast('today' as date),'M',pd.codempax, pd.codfilialax,pd.codalmox, null)) > 0
then (select custounit from eqcustoprodsp(pd.codemp, pd.codfilial, pd.codprod,cast('today' as date),'M',pd.codempax, pd.codfilialax,pd.codalmox, null))

else pd.custoinfoprod end) custo
from eqproduto pd
;

/* Create view: VWTMPCUSTOITRMA (ViwData.CreateDependDef) */
CREATE VIEW VWTMPCUSTOITRMA(
CODEMP,
CODFILIAL,
CODRMA,
CODITRMA,
CODPROD,
CUSTODATA)
 AS 
select ITR.CODEMP,ITR.CODFILIAL,ITR.CODRMA,ITR.CODITRMA,ITR.CODPROD,COALESCE((SELECT FIRST 1 MP.CUSTOMPMMOVPROD
    FROM EQMOVPROD MP
    WHERE MP.CODEMPPD=ITR.codemppd AND MP.CODFILIALPD=ITR.codfilialpd
    AND MP.CODPROD=ITR.codprod AND MP.dtmovprod <= rm.dtareqrma
    ORDER BY MP.DTMOVPROD DESC, MP.CODMOVPROD DESC),0) AS CUSTO
from eqitrma itr, eqrma rm where rm.codrma = itr.codrma
;


/* Create index... */
CREATE INDEX CPPRODFORIDX01 ON CPPRODFOR(REFPRODFOR, CODFILIAL, CODEMP);

CREATE UNIQUE INDEX EQPRODUTOIDXREFPROD ON EQPRODUTO(REFPROD, CODEMP, CODFILIAL);

CREATE INDEX FNPLANEJAMENTOIDXCODRED ON FNPLANEJAMENTO(CODREDPLAN, CODFILIAL, CODEMP);

CREATE INDEX FNSUBLANCAIDXDTCOMP ON FNSUBLANCA(DTCOMPSUBLANCA);

CREATE INDEX FNSUBLANCAIDXDTSUBLANCA ON FNSUBLANCA(DATASUBLANCA);


/* Create Exception... */
CREATE EXCEPTION FNPLANEJAMENTO01 'Código reduzido já foi definido, escolha outro código.';


/* Create Primary Key... */
ALTER TABLE ATESPECATEND ADD CONSTRAINT ATESPECATENDPK PRIMARY KEY (CODESPEC, CODFILIAL, CODEMP);

ALTER TABLE ATTIPOATENDOSETOR ADD CONSTRAINT ATTIPOATENDOSETOPK PRIMARY KEY (CODSETAT, CODFILIALST, CODEMPST, CODTPATENDO, CODFILIAL, CODEMP);

ALTER TABLE CPIMPORTACAOADIC ADD CONSTRAINT CPIMPORTACAOADICPK PRIMARY KEY (CODNCM, CODFILIAL, CODIMP, CODEMP);

ALTER TABLE CPIMPORTACAO ADD CONSTRAINT CPIMPORTACAOPK PRIMARY KEY (CODIMP, CODFILIAL, CODEMP);

ALTER TABLE CPITIMPORTACAO ADD CONSTRAINT CPITIMPORTACAOPK PRIMARY KEY (CODIMP, CODITIMP, CODFILIAL, CODEMP);

ALTER TABLE CRCHAMADOANEXO ADD CONSTRAINT CRCHAMADOANEXOPK PRIMARY KEY (CODFILIAL, CODEMP, CODCHAMADO, CODANEXO);

ALTER TABLE CRQUALIFICACAO ADD CONSTRAINT CRQUALIFICACAOPK PRIMARY KEY (CODFILIAL, CODEMP, CODQUALIFIC);

ALTER TABLE FNCARTCOB ADD CONSTRAINT FNCARTCOBPK PRIMARY KEY (CODCARTCOB, CODFILIAL, CODEMP, CODBANCO, CODFILIALBO, CODEMPBO);

ALTER TABLE FNITMODBOLETO ADD CONSTRAINT FNITMODBOLETOPK PRIMARY KEY (CODMODBOL, CODFILIAL, CODEMP, CODBANCO, CODFILIALBO, CODEMPBO, CODCARTCOB, CODFILIALCB, CODEMPCB);

ALTER TABLE FNSINAL ADD CONSTRAINT FNSINALPK PRIMARY KEY (CODSINAL, CODEMP, CODFILIAL);

ALTER TABLE LFCSOSN ADD CONSTRAINT LFCSOSNPK PRIMARY KEY (CSOSN, CODFILIAL, CODEMP);

ALTER TABLE PPITESTRUTURASUBPROD ADD CONSTRAINT PPITESTRUTURASUBPRODPK PRIMARY KEY (CODPROD, SEQEST, SEQITESTSP, CODFILIAL, CODEMP);

ALTER TABLE PPOPSUBPROD ADD CONSTRAINT PPOPSUBPRODPK PRIMARY KEY (CODOP, SEQOP, SEQSUBPROD, CODFILIAL, CODEMP);

ALTER TABLE SGESTACAO ADD CONSTRAINT SGESTACAOPK PRIMARY KEY (CODEST, CODFILIAL, CODEMP);

ALTER TABLE VDITVENDAVDITCONTR ADD CONSTRAINT VDITVENDAVDITCONPK PRIMARY KEY (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIAL, CODEMP);

ALTER TABLE VDREGCOMISDESC ADD CONSTRAINT VDREGCOMISDESCPK PRIMARY KEY (CODEMP, CODFILIAL, CODREGCOMISDESC);

ALTER TABLE VDTEF ADD CONSTRAINT VDTEFPK PRIMARY KEY (CODVENDA, NSUTEF, TIPOVENDA, CODFILIAL, CODEMP);

ALTER TABLE VDVENDAENTREGA ADD CONSTRAINT VDVENDAENTREGAPK PRIMARY KEY (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP);

/* Create Foreign Key... */
RECONNECT;

ALTER TABLE ATATENDIMENTO ADD CONSTRAINT ATATENDIMENTOFKATE FOREIGN KEY (CODESPEC, CODFILIALEA, CODEMPEA) REFERENCES ATESPECATEND (CODESPEC, CODFILIAL, CODEMP);

ALTER TABLE CPCOMPRA ADD CONSTRAINT CPCOMPRAFKCPIMPORTACAO FOREIGN KEY (CODIMP, CODFILIALIM, CODEMPIM) REFERENCES CPIMPORTACAO (CODIMP, CODFILIAL, CODEMP);

ALTER TABLE CPCOMPRA ADD CONSTRAINT CPCOMPRAFKPPOP FOREIGN KEY (CODOP, SEQOP, CODFILIALOP, CODEMPOP) REFERENCES PPOP (CODOP, SEQOP, CODFILIAL, CODEMP) ON DELETE SET NULL;

ALTER TABLE CPIMPORTACAOADIC ADD CONSTRAINT CPIMPORTACAOADICFKCPIMP FOREIGN KEY (CODIMP, CODFILIAL, CODEMP) REFERENCES CPIMPORTACAO (CODIMP, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE CPIMPORTACAOADIC ADD CONSTRAINT CPIMPORTACAOADICFKNCM FOREIGN KEY (CODNCM) REFERENCES LFNCM (CODNCM);

ALTER TABLE CPIMPORTACAO ADD CONSTRAINT CPIMPORTACAOFKFNPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPG, CODEMPPG) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);

ALTER TABLE CPIMPORTACAO ADD CONSTRAINT CPIMPORTACAOFKFORNECED FOREIGN KEY (CODFOR, CODFILIALFR, CODEMPFR) REFERENCES CPFORNECED (CODFOR, CODFILIAL, CODEMP);

ALTER TABLE CPIMPORTACAO ADD CONSTRAINT CPIMPORTACAOFKMOEDA FOREIGN KEY (CODMOEDA, CODFILIALMI, CODEMPMI) REFERENCES FNMOEDA (CODMOEDA, CODFILIAL, CODEMP);

ALTER TABLE CPITIMPORTACAO ADD CONSTRAINT CPITIMPORTACAOFKCPIMPORT FOREIGN KEY (CODIMP, CODFILIAL, CODEMP) REFERENCES CPIMPORTACAO (CODIMP, CODFILIAL, CODEMP);

ALTER TABLE CPITIMPORTACAO ADD CONSTRAINT CPITIMPORTACAOFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);

ALTER TABLE CPITIMPORTACAO ADD CONSTRAINT CPITIMPORTACAOFKEQUNIDADE FOREIGN KEY (CODUNID, CODFILIALUN, CODEMPUN) REFERENCES EQUNIDADE (CODUNID, CODFILIAL, CODEMP);

ALTER TABLE CPITIMPORTACAO ADD CONSTRAINT CPITIMPORTACAOFKITCLFISCAL FOREIGN KEY (CODEMPCF, CODFILIALCF, CODFISC, CODITFISC) REFERENCES LFITCLFISCAL (CODEMP, CODFILIAL, CODFISC, CODITFISC);

ALTER TABLE CPITIMPORTACAO ADD CONSTRAINT CPITIMPORTACAOFKLFNCM FOREIGN KEY (CODNCM) REFERENCES LFNCM (CODNCM);

ALTER TABLE CRCHAMADOANEXO ADD CONSTRAINT CRCHAMADOANEXOFKCHAMADO FOREIGN KEY (CODFILIAL, CODEMP, CODCHAMADO) REFERENCES CRCHAMADO (CODFILIAL, CODEMP, CODCHAMADO) ON DELETE CASCADE;

ALTER TABLE CRCHAMADO ADD CONSTRAINT CRCHAMADOFKQUALIFIC FOREIGN KEY (CODFILIALQL, CODEMPQL, CODQUALIFIC) REFERENCES CRQUALIFICACAO (CODFILIAL, CODEMP, CODQUALIFIC);

ALTER TABLE EQMOVPROD ADD CONSTRAINT EQMOVPRODFKEQOP FOREIGN KEY (CODOP, SEQOP, CODFILIALOP, CODEMPOP) REFERENCES PPOP (CODOP, SEQOP, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKCPITCOM FOREIGN KEY (CODITCOMPRA, CODCOMPRA, CODFILIALCP, CODEMPCP) REFERENCES CPITCOMPRA (CODITCOMPRA, CODCOMPRA, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKEQINVPR FOREIGN KEY (CODINVPROD, CODFILIALIV, CODEMPIV) REFERENCES EQINVPROD (CODINVPROD, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKEQITRMA FOREIGN KEY (CODRMA, CODITRMA, CODFILIALRM, CODEMPRM) REFERENCES EQITRMA (CODRMA, CODITRMA, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKEQOP FOREIGN KEY (CODOP, SEQOP, CODFILIALOP, CODEMPOP) REFERENCES PPOP (CODOP, SEQOP, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKEQRECMERC FOREIGN KEY (TICKET, CODITRECMERC, CODFILIALRC, CODEMPRC) REFERENCES EQITRECMERC (TICKET, CODITRECMERC, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKEQSERIE FOREIGN KEY (NUMSERIE, CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQSERIE (NUMSERIE, CODPROD, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKEQTIPOM FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKRECMERC FOREIGN KEY (TICKET, CODFILIALRC, CODEMPRC) REFERENCES EQRECMERC (TICKET, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKSGFILIA FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQMOVSERIE ADD CONSTRAINT EQMOVSERIEFKVDITVEN FOREIGN KEY (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIALVD, CODEMPVD) REFERENCES VDITVENDA (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE EQRMA ADD CONSTRAINT EQRMAFKPPOP FOREIGN KEY (CODOP, SEQOP, CODFILIALOF, CODEMPOF) REFERENCES PPOP (CODOP, SEQOP, CODFILIAL, CODEMP);

ALTER TABLE EQTIPOMOV ADD CONSTRAINT EQTIPOMOVFKFNPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPP, CODEMPPP) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);

ALTER TABLE VDVENDAENTREGA ADD CONSTRAINT FKVDVENDAENTREGAVDVENDA FOREIGN KEY (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP) REFERENCES VDVENDA (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE FNITMODBOLETO ADD CONSTRAINT FNITMODBOLETOFKCAR FOREIGN KEY (CODCARTCOB, CODFILIALCB, CODEMPCB, CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNCARTCOB (CODCARTCOB, CODFILIAL, CODEMP, CODBANCO, CODFILIALBO, CODEMPBO);

ALTER TABLE FNITPAGAR ADD CONSTRAINT FNITPAGARFKSINAL FOREIGN KEY (CODSINAL, CODEMPSN, CODFILIALSN) REFERENCES FNSINAL (CODSINAL, CODEMP, CODFILIAL) ON DELETE SET NULL;

ALTER TABLE FNITRECEBER ADD CONSTRAINT FNITRECEBERFKCARTC FOREIGN KEY (CODCARTCOB, CODFILIALCB, CODEMPCB, CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNCARTCOB (CODCARTCOB, CODFILIAL, CODEMP, CODBANCO, CODFILIALBO, CODEMPBO);

ALTER TABLE FNITRECEBER ADD CONSTRAINT FNITRECEBERFKSINAL FOREIGN KEY (CODSINAL, CODEMPSN, CODFILIALSN) REFERENCES FNSINAL (CODSINAL, CODEMP, CODFILIAL) ON DELETE SET NULL;

ALTER TABLE FNLANCA ADD CONSTRAINT FNLANCAFKFNSINAL FOREIGN KEY (CODSINAL, CODEMPSN, CODFILIALSN) REFERENCES FNSINAL (CODSINAL, CODEMP, CODFILIAL) ON DELETE SET NULL;

ALTER TABLE FNPAGAR ADD CONSTRAINT FNPAGARFKFNPLANEJ FOREIGN KEY (CODPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, CODFILIAL, CODEMP);

ALTER TABLE FNPAGCHEQ ADD CONSTRAINT FNPAGCHEQFKCHEQUE FOREIGN KEY (SEQCHEQ, CODFILIALCH, CODEMPCH) REFERENCES FNCHEQUE (SEQCHEQ, CODFILIAL, CODEMP);

ALTER TABLE FNPAGCHEQ ADD CONSTRAINT FNPAGCHEQFKFNITPAG FOREIGN KEY (NPARCPAG, CODPAG, CODFILIAL, CODEMP) REFERENCES FNITPAGAR (NPARCPAG, CODPAG, CODFILIAL, CODEMP);

ALTER TABLE FNRECEBER ADD CONSTRAINT FNRECEBERFKFNCARTC FOREIGN KEY (CODCARTCOB, CODFILIALCB, CODEMPCB, CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNCARTCOB (CODCARTCOB, CODFILIAL, CODEMP, CODBANCO, CODFILIALBO, CODEMPBO);

ALTER TABLE LFCSOSN ADD CONSTRAINT LFCSOSNFKSGFILI FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);

ALTER TABLE LFITCLFISCAL ADD CONSTRAINT LFITCLFISCALFKCSOSN FOREIGN KEY (CSOSN, CODFILIALCN, CODEMPCN) REFERENCES LFCSOSN (CSOSN, CODFILIAL, CODEMP);

ALTER TABLE LFITCOMPRA ADD CONSTRAINT LFITCOMPRAFKCPITCOMPRA FOREIGN KEY (CODITCOMPRA, CODCOMPRA, CODFILIAL, CODEMP) REFERENCES CPITCOMPRA (CODITCOMPRA, CODCOMPRA, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE LFITREGRAFISCAL ADD CONSTRAINT LFITREGRAFISFKEQTI FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);

ALTER TABLE LFITREGRAFISCAL ADD CONSTRAINT LFITREGRAFISFKLFNA FOREIGN KEY (CODNAT, CODFILIAL, CODEMP) REFERENCES LFNATOPER (CODNAT, CODFILIAL, CODEMP);

ALTER TABLE LFITREGRAFISCAL ADD CONSTRAINT LFITREGRAFISFKLFRE FOREIGN KEY (CODREGRA, CODFILIAL, CODEMP) REFERENCES LFREGRAFISCAL (CODREGRA, CODFILIAL, CODEMP);

ALTER TABLE PPDISTRIB ADD CONSTRAINT PPDISTRIBFKPPESTFA FOREIGN KEY (CODPROD, SEQEST, SEQEF, CODFILIAL, CODEMP, CODFASE, CODFILIALFS, CODEMPFS) REFERENCES PPESTRUFASE (CODPROD, SEQEST, SEQEF, CODFILIAL, CODEMP, CODFASE, CODFILIALFS, CODEMPFS);

ALTER TABLE PPDISTRIB ADD CONSTRAINT PPDISTRIBFKPPESTRU FOREIGN KEY (CODPRODDE, SEQESTDE, CODFILIALDE, CODEMPDE) REFERENCES PPESTRUTURA (CODPROD, SEQEST, CODFILIAL, CODEMP);

ALTER TABLE PPITESTRUTURASUBPROD ADD CONSTRAINT PPITESTRUTURASUBPRODFKEQP FOREIGN KEY (CODPRODPD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);

ALTER TABLE PPITESTRUTURASUBPROD ADD CONSTRAINT PPITESTRUTURASUBPRODFKPPE FOREIGN KEY (CODPROD, SEQEST, SEQEF, CODFILIAL, CODEMP, CODFASE, CODFILIALFS, CODEMPFS) REFERENCES PPESTRUFASE (CODPROD, SEQEST, SEQEF, CODFILIAL, CODEMP, CODFASE, CODFILIALFS, CODEMPFS);

ALTER TABLE PPITOP ADD CONSTRAINT PPITOPFKCPCOMPRARETORNO FOREIGN KEY (CODCOMPRA, CODFILIALCP, CODEMPCP) REFERENCES CPCOMPRA (CODCOMPRA, CODFILIAL, CODEMP) ON DELETE SET NULL;

ALTER TABLE PPITOP ADD CONSTRAINT PPITOPFKVDVENDAREMESSA FOREIGN KEY (CODVENDA, TIPOVENDA, CODFILIALVD, CODEMPVD) REFERENCES VDVENDA (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP) ON DELETE SET NULL;

ALTER TABLE PPOPSUBPROD ADD CONSTRAINT PPOPSUBPRODFKEQLOTE FOREIGN KEY (CODLOTE, CODPROD, CODFILIALLE, CODEMPLE) REFERENCES EQLOTE (CODLOTE, CODPROD, CODFILIAL, CODEMP);

ALTER TABLE PPOPSUBPROD ADD CONSTRAINT PPOPSUBPRODFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);

ALTER TABLE PPOPSUBPROD ADD CONSTRAINT PPOPSUBPRODFKEQTIPOMOV FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);

ALTER TABLE PPOPSUBPROD ADD CONSTRAINT PPOPSUBPRODFKPPFASE FOREIGN KEY (CODFASE, CODFILIALFS, CODEMPFS) REFERENCES PPFASE (CODFASE, CODFILIAL, CODEMP);

ALTER TABLE PPOPSUBPROD ADD CONSTRAINT PPOPSUBPRODFKPPOP FOREIGN KEY (CODOP, SEQOP, CODFILIAL, CODEMP) REFERENCES PPOP (CODOP, SEQOP, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE PPPROCESSAOPTMP ADD CONSTRAINT PPPROCESSFKSGEST FOREIGN KEY (CODEST, CODFILIALET, CODEMPET) REFERENCES SGESTACAO (CODEST, CODFILIAL, CODEMP);

ALTER TABLE PPRETCP ADD CONSTRAINT PPRETCPFKPPOP FOREIGN KEY (CODOP, SEQOP, CODFILIAL, CODEMP) REFERENCES PPOP (CODOP, SEQOP, CODFILIAL, CODEMP) ON DELETE CASCADE;

ALTER TABLE PVCAIXA ADD CONSTRAINT PVCAIXAFKSGESTACAO FOREIGN KEY (CODEST, CODFILIALET, CODEMPET) REFERENCES SGESTACAO (CODEST, CODFILIAL, CODEMP);

ALTER TABLE RHCANDIDATO ADD CONSTRAINT RHCANDIDATOFKESTCIVIL FOREIGN KEY (CODESTCIVIL, CODFILIALES, CODEMPES) REFERENCES SGESTCIVIL (CODESTCIVIL, CODFILIAL, CODEMP);

ALTER TABLE SGESTACAOBAL ADD CONSTRAINT SGESTACAOBALFKSGES FOREIGN KEY (CODEST, CODFILIAL, CODEMP) REFERENCES SGESTACAO (CODEST, CODFILIAL, CODEMP);

ALTER TABLE SGESTACAOIMP ADD CONSTRAINT SGESTACAOIMPFKSGES FOREIGN KEY (CODEST, CODFILIAL, CODEMP) REFERENCES SGESTACAO (CODEST, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKTIPOMOVIM FOREIGN KEY (CODTIPOMOVIM, CODFILIALIM, CODEMPIM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE2 ADD CONSTRAINT SGPREFERE2FKSGITT2 FOREIGN KEY (CODITTBV, CODTBV, CODFILIALTV, CODEMPTV) REFERENCES SGITTABELA (CODITTB, CODTB, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE2 ADD CONSTRAINT SGPREFERE2FKSGITTA FOREIGN KEY (CODITTBA, CODTBA, CODFILIALTA, CODEMPTA) REFERENCES SGITTABELA (CODITTB, CODTB, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE3 ADD CONSTRAINT SGPREFERE3FKTKEMAIL FOREIGN KEY (CODEMAILNC, CODFILIALNC, CODEMPNC) REFERENCES TKEMAIL (CODEMAIL, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE3 ADD CONSTRAINT SGPREFERE3FKTKEMAILEA FOREIGN KEY (CODEMAILEA, CODFILIALEA, CODEMPEA) REFERENCES TKEMAIL (CODEMAIL, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE3 ADD CONSTRAINT SGPREFERE3FKTKEMAILEC FOREIGN KEY (CODEMPEC, CODFILIALEC, CODEMAILEC) REFERENCES TKEMAIL (CODEMAIL, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE5 ADD CONSTRAINT SGPREFERE5FKTIPOMOVEN FOREIGN KEY (CODTIPOMOVEN, CODFILIALEN, CODEMPEN) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE5 ADD CONSTRAINT SGPREFERE5FKTIPOMOVRE FOREIGN KEY (CODTIPOMOVRE, CODFILIALRE, CODEMPRE) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);

ALTER TABLE SGPREFERE5 ADD CONSTRAINT SGPREFERE5FKTIPOMOVSP FOREIGN KEY (CODTIPOMOVSP, CODFILIALTS, CODEMPTS) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);

ALTER TABLE SGTRATARET ADD CONSTRAINT SGTRATARETFKSGITP2 FOREIGN KEY (CODPROCGT, SEQITPROCGT, CODFILIALGT, CODEMPGT) REFERENCES SGITPROCESSO (CODPROC, SEQITPROC, CODFILIAL, CODEMP);

ALTER TABLE SGTRATARET ADD CONSTRAINT SGTRATARETFKSGITPR FOREIGN KEY (CODPROC, SEQITPROC, CODFILIAL, CODEMP) REFERENCES SGITPROCESSO (CODPROC, SEQITPROC, CODFILIAL, CODEMP);

ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKFNCARTC FOREIGN KEY (CODCARTCOB, CODFILIALCB, CODEMPCB, CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNCARTCOB (CODCARTCOB, CODFILIAL, CODEMP, CODBANCO, CODFILIALBO, CODEMPBO);

ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKFNTIPOB FOREIGN KEY (CODTIPOCOB, CODFILIALTC, CODEMPTC) REFERENCES FNTIPOCOB (CODTIPOCOB, CODFILIAL, CODEMP);

ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKFNTIPOD FOREIGN KEY (CODTPCRED, CODFILIALTR, CODEMPTR) REFERENCES FNTIPOCRED (CODTPCRED, CODFILIAL, CODEMP);

ALTER TABLE VDITVENDAVDITCONTR ADD CONSTRAINT VDITVENDACTFKVDCT FOREIGN KEY (CODCONTR, CODFILIALCT, CODEMPCT) REFERENCES VDCONTRATO (CODCONTR, CODFILIAL, CODEMP);

ALTER TABLE VDITVENDAVDITCONTR ADD CONSTRAINT VDITVENDACTFKVDITV FOREIGN KEY (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIAL, CODEMP) REFERENCES VDITVENDA (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIAL, CODEMP);

ALTER TABLE VDREGCOMISDESC ADD CONSTRAINT VDREGCOMISDESCFKFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);

ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKCARTCOB FOREIGN KEY (CODCARTCOB, CODFILIALCB, CODEMPCB, CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNCARTCOB (CODCARTCOB, CODFILIAL, CODEMP, CODBANCO, CODFILIALBO, CODEMPBO);

ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKPPOP FOREIGN KEY (CODOP, SEQOP, CODFILIALOP, CODEMPOP) REFERENCES PPOP (CODOP, SEQOP, CODFILIAL, CODEMP) ON DELETE SET NULL;

/*  Empty EQMOVPRODIUDSP for EQMOVPRODDSP(param list change)  */
SET TERM ^ ;

ALTER PROCEDURE EQMOVPRODIUDSP(CIUD CHAR,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER CPITCOMPRATGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITCOMPRATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPITCOMPRATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQINVPRODTGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQINVPRODTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQINVPRODTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQITRMATGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQITRMATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER EQITRMATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPOPENTRADATGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPOPENTRADATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPOPTGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPOPTGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER PPOPTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDITVENDATGAD
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER VDITVENDATGAI
 AS Declare variable I integer;
BEGIN I = 0; END
^

/*  Empty EQMOVPRODDSP for EQMOVPRODRETCODSP(param list change)  */
ALTER PROCEDURE EQMOVPRODDSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
DDTMOVPROD DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR)
 AS
 BEGIN EXIT; END
^

/*  Empty EQMOVPRODUSP for EQMOVPRODRETCODSP(param list change)  */
ALTER PROCEDURE EQMOVPRODUSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR)
 AS
 BEGIN EXIT; END
^

/*  Empty FNGERAITRECEBERSP01 for FNADICITRECEBERSP01(param list change)  */
ALTER PROCEDURE FNGERAITRECEBERSP01(CALTVLR CHAR,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
ICODEMPPG INTEGER,
SCODFILIALPG SMALLINT,
ICODPLANOPAG INTEGER,
NVLRREC NUMERIC(15,5),
DDATAREC DATE,
CFLAG CHAR,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3),
ICODEMPTC INTEGER,
SCODFILIALTC SMALLINT,
ICODTIPOCOB INTEGER,
ICODEMPCB INTEGER,
SCODFILIALCB SMALLINT,
CODCARTCOB CHAR(2),
NVLRCOMIREC NUMERIC(15,5),
OBSREC VARCHAR(250),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC INTEGER,
CODCC CHAR(19),
VLRBASECOMIS NUMERIC(15,5))
 RETURNS(I INTEGER)
 AS
 BEGIN EXIT; END
^

ALTER TRIGGER FNITRECEBERTGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER FNITPAGARTGBU
 AS Declare variable I integer;
BEGIN I = 0; END
^

ALTER TRIGGER CPCOMPRATGAU
 AS Declare variable I integer;
BEGIN I = 0; END
^

/*  Empty VDESTORNACOMISSAOSP for VDADICCOMISSAOSP(param list change)  */
ALTER PROCEDURE VDESTORNACOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
ICODVEND INTEGER,
DINI DATE,
DFIM DATE,
CORDEM CHAR)
 AS
 BEGIN EXIT; END
^

/*  Empty VDGERACOMISSAOSP for VDADICCOMISSAOSP(param list change)  */
ALTER PROCEDURE VDGERACOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRCOMIITREC NUMERIC(15,5),
DDTVENCITREC DATE)
 AS
 BEGIN EXIT; END
^

/* Alter empty procedure EQMOVPRODDSP with new param-list */
ALTER PROCEDURE EQMOVPRODDSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
DDTMOVPROD DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD SMALLINT)
 AS
 BEGIN EXIT; END
^

/* Alter empty procedure EQMOVPRODISP with new param-list */
ALTER PROCEDURE EQMOVPRODISP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD SMALLINT)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Sequencial do subproduto'
WHERE RDB$PROCEDURE_NAME = 'EQMOVPRODISP' AND RDB$PARAMETER_NAME = 'SEQSUBPROD';

/* Alter empty procedure EQMOVPRODRETCODSP with new param-list */
SET TERM ^ ;

ALTER PROCEDURE EQMOVPRODRETCODSP(ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQOPENT SMALLINT,
SEQSUBPROD SMALLINT)
 RETURNS(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER)
 AS
 BEGIN EXIT; END
^

/* Alter empty procedure EQMOVPRODUSP with new param-list */
ALTER PROCEDURE EQMOVPRODUSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD BIGINT)
 AS
 BEGIN EXIT; END
^

/* Alter empty procedure FNADICITRECEBERSP01 with new param-list */
ALTER PROCEDURE FNADICITRECEBERSP01(CALTVLR CHAR,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRDESCITREC NUMERIC(15,5),
NVLRMULTAITREC NUMERIC(15,5),
NVLRJUROSITREC NUMERIC(15,5),
NVLRPARCITREC NUMERIC(15,5),
NVLRPAGOITREC NUMERIC(15,5),
DDTITREC DATE,
DDTCOMPITREC DATE,
DDTVENCITREC DATE,
CSTATUSITREC CHAR(2),
CFLAG CHAR,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3),
ICODEMPTC INTEGER,
SCODFILIALTC SMALLINT,
ICODTIPOCOB INTEGER,
ICODEMPCB INTEGER,
SCODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
NVLRCOMIITREC NUMERIC(15,5),
OBSITREC VARCHAR(250),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC SMALLINT,
CODCC CHAR(19),
VLRBASECOMIS NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

/* Alter empty procedure VDADICCOMISSAOSP with new param-list */
ALTER PROCEDURE VDADICCOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRVENDACOMI NUMERIC(15,5),
NVLRCOMI NUMERIC(15,5),
DDATACOMI DATE,
DDTCOMPCOMI DATE,
DDTVENCCOMI DATE,
CTIPOCOMI CHAR,
CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
CODVEND INTEGER)
 AS
 BEGIN EXIT; END
^

/* Alter Procedure... */
/* Alter (ATADICATENDIMENTOCLISP) */
ALTER PROCEDURE ATADICATENDIMENTOCLISP(ICODTIPOATENDO INTEGER,
ICODATEND INTEGER,
ICODSETOR INTEGER,
ICODEMP INTEGER,
ICODFILIAL INTEGER,
IDOC INTEGER,
DATAATENDO DATE,
DATAATENDOFIN DATE,
HORAATENDO TIME,
HORAATENDOFIN TIME,
OBSATENDO VARCHAR(10000),
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
CODEMPCT INTEGER,
CODFILIALCT INTEGER,
CODCONTR INTEGER,
CODITCONTR INTEGER,
CODREC INTEGER,
NPARCITREC INTEGER,
CODEMPCH INTEGER,
CODFILIALCH SMALLINT,
CODCHAMADO INTEGER,
OBSINTERNO VARCHAR(10000),
CONCLUICHAMADO CHAR,
CODEMPEA INTEGER,
CODFILIALEA SMALLINT,
CODESPEC INTEGER)
 AS
declare variable icodatendo integer;
declare variable ifilialatendo integer;
declare variable ifilialtipoatendo integer;
declare variable ifilialatend integer;
declare variable ifilialsetor integer;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATATENDIMENTO') INTO IFILIALATENDO;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATTIPOATENDO') INTO IFILIALTIPOATENDO;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATATENDENTE') INTO IFILIALATEND;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATSETOR') INTO IFILIALSETOR;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALATENDO,'AT') INTO ICODATENDO;

  INSERT INTO ATATENDIMENTO (
    CODEMP,CODFILIAL,CODATENDO,CODEMPTO,
    CODFILIALTO,CODTPATENDO,CODEMPAE,
    CODFILIALAE,CODATEND,CODEMPSA,CODFILIALSA,
    CODSETAT,STATUSATENDO,IDUSU,CODEMPUS,CODFILIALUS,DOCATENDO, DATAATENDO,
    DATAATENDOFIN, HORAATENDO, HORAATENDOFIN, OBSATENDO, CODEMPCL, CODFILIALCL, CODCLI, CODEMPCT, CODFILIALCT,
    CODCONTR, CODITCONTR, CODEMPCH, CODFILIALCH, CODCHAMADO, obsinterno, CONCLUICHAMADO,
    CODEMPEA, CODFILIALEA, CODESPEC )

  VALUES
  (
    :ICODEMP,:IFILIALATENDO,:ICODATENDO,:ICODEMP,
    :IFILIALTIPOATENDO,:ICODTIPOATENDO,:ICODEMP,
    :IFILIALATEND,:ICODATEND,:ICODEMP,:IFILIALSETOR,
    :ICODSETOR,'AA',lower(USER),:ICODEMP,:ICODFILIAL,:IDOC,
    :DATAATENDO,:DATAATENDOFIN,:HORAATENDO,:HORAATENDOFIN,:OBSATENDO,:CODEMPCL,
    :CODFILIALCL,:CODCLI, :CODEMPCT, :CODFILIALCT, :CODCONTR, :CODITCONTR, :codempch,
    :codfilialch, :codchamado, :obsinterno, :CONCLUICHAMADO,
    :CODEMPEA, :CODFILIALEA, :CODESPEC
  );

  -- Caso o atendimento tenha vinculo com o contas a receber
  IF(CODREC IS NOT NULL AND NPARCITREC IS NOT NULL) THEN
  BEGIN
    INSERT INTO ATATENDIMENTOITREC (CODEMP,CODFILIAL,CODATENDO,CODEMPIR,CODFILIALIR,CODREC,NPARCITREC) VALUES
        (:ICODEMP,:ICODFILIAL,:ICODATENDO,:ICODEMP,:ICODFILIAL,:CODREC,:NPARCITREC);
  END



END
^

/* Alter (CPADICITCOMPRAPEDSP) */
ALTER PROCEDURE CPADICITCOMPRAPEDSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODCOMPRA INTEGER,
CODEMPPC INTEGER,
CODFILIALPC SMALLINT,
CODCOMPRAPC INTEGER,
CODITCOMPRAPC INTEGER,
TPAGRUP CHAR,
QTDITCOMPRA FLOAT,
VLRDESCITCOMPRA NUMERIC(15,5),
PRECOITCOMPRA NUMERIC(15,5))
 AS
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempfr integer;
declare variable codfilialfr smallint;
declare variable codfor integer;
declare variable coditcompra integer;
declare variable codemppd integer;
declare variable codfilialpd smallint;
declare variable codprod integer;
declare variable refprod varchar(20);
declare variable percdescitcompra numeric(15,5);
declare variable vlrliqitcompra numeric(15,5);
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable codlote varchar(20);
declare variable cloteprod char(1);
declare variable uffor char(2);
declare variable codempnt integer;
declare variable codfilialnt smallint;
declare variable codnat char(4);
declare variable tipofisc char(2);
declare variable percred numeric(9,2);
declare variable codtrattrib char(2);
declare variable origfisc char(1);
declare variable codmens smallint;
declare variable percicmsitcompra numeric(9,2);
declare variable codempif integer;
declare variable codfilialif smallint;
declare variable codfisc char(13);
declare variable coditfisc integer;
declare variable tipost char(2);
declare variable margemvlagr numeric(15,5);
declare variable percipiitcompra numeric(9,2);
declare variable percicmsst numeric(9,2);
declare variable tpredicms char(1);
declare variable redbaseicmsst char(1);
declare variable vlrproditcompra numeric(15,5);
declare variable vlrbaseipiitcompra numeric(15,5);
declare variable vlripiitcompra numeric(15,5);
declare variable vlrbaseicmsitcompra numeric(15,5);
declare variable vlricmsitcompra numeric(15,5);
declare variable vlrbaseicmsbrutitcompra numeric(15,5);
declare variable vlrisentasitcompra numeric(15,5);
declare variable vlroutrasitcompra numeric(15,5);
declare variable vlrbaseicmsstitcompra numeric(15,5);
declare variable vlricmsstitcompra numeric(15,5);
begin

-- Inicialização de variaveis

    select icodfilial from sgretfilial(:codemp, 'LFNATOPER') into :codfilialnt;

    select cp.codemptm, cp.codfilialtm, cp.codtipomov, cp.codempfr,  cp.codfilialfr, cp.codfor, coalesce(fr.siglauf, fr.uffor) uffor
    from cpcompra cp, cpforneced fr
    where cp.codcompra=:codcompra and cp.codfilial=:codfilial and cp.codemp=:codemp and
    fr.codemp=cp.codempfr and fr.codfilial=cp.codfilialfr and fr.codfor=cp.codfor
    into :codemptm, :codfilialtm, :codtipomov, :codempfr, :codfilialfr, :codfor, :uffor ;

-- Busca sequencia de numeração do ítem de compra

    select coalesce(max(coditcompra),0)+1 from cpitcompra where codcompra=:codcompra and codfilial=:codfilial and codemp=:codemp
    into :coditcompra;

-- Informações do item do pedido de compra

    select it.codemppd, it.codfilialpd, it.codprod, it.percdescitcompra, it.vlrliqitcompra, it.vlrproditcompra, it.refprod,
    it.codempax, it.codfilialax, it.codalmox, it.codlote, pd.cloteprod
    from cpitcompra it, eqproduto pd
    where it.coditcompra=:coditcomprapc and it.codcompra=:codcomprapc and it.codfilial=:codfilialpc and it.codemp=:codemppc
    and pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and pd.codprod=it.codprod
    into :codemppd, :codfilialpd, :codprod, :percdescitcompra, :vlrliqitcompra, :vlrproditcompra, :refprod,
    :codempax, :codfilialax, :codalmox, :codlote, :cloteprod;

-- Buscando a natureza de operação para o ítem de compra

    select codnat from lfbuscanatsp(:codfilial, :codemp, :codfilialpd, :codprod, null, null, null, :codempfr, :codfilialfr, :codfor,
    :codfilialtm, :codtipomov, null)
    into :codnat;
    
    if (:codnat is null) then
    begin
        exception cpitcompraex04 ' produto:' || :refprod; -- NÃO FOI POSSÍVEL ENCONTRAR A NATUREZA DA OPERAÇÃO PARA O ÍTEM
    end

-- Busca informações fiscais para o ítem de compra

    select tipofisc,redfisc,codtrattrib,origfisc,codmens,aliqfisc,codempif,codfilialif,codfisc,coditfisc,tipost,margemvlagr,
    aliqipifisc,aliqfiscintra,tpredicmsfisc,redbasest
    from lfbuscafiscalsp(:codemppd, :codfilialpd, :codprod, :codempfr,:codfilialfr, :codfor,
    :codemptm, :codfilialtm, :codtipomov, 'CP', :codnat,null,null,null,null)
    into :tipofisc, :percred, :codtrattrib, :origfisc, :codmens, :percicmsitcompra, :codempif, :codfilialif, :codfisc, :coditfisc, :tipost,
    :margemvlagr, :percipiitcompra, :percicmsst, :tpredicms, :redbaseicmsst;
    
-- Inicializando valores

    vlrproditcompra = :precoitcompra * :qtditcompra;
    vlrliqitcompra = :vlrproditcompra - :vlrdescitcompra;
    vlrbaseipiitcompra = 0;
    vlrbaseicmsitcompra = 0;
    vlricmsitcompra = 0;
    vlripiitcompra = 0;

    if (:percicmsitcompra = 0 or :percicmsitcompra is null) then
    begin
        select coalesce(percicms, 0) from lfbuscaicmssp (:codnat, :uffor,:codemp, :codfilial) into :percicmsst;
    end

    if (:percred is null) then
    begin
        percred = 0;
    end

    if(percred>0) then
    begin
        if(:tpredicms='B') then
        begin
            vlrbaseicmsitcompra = (:vlrproditcompra - :vlrdescitcompra) - ( (:vlrproditcompra - :vlrdescitcompra) * ( :percred / 100 ) );
        end
        else if(:tpredicms='V') then
        begin
            vlricmsitcompra = (:vlrbaseicmsitcompra * ( :percicmsitcompra / 100 )) -  ( (:vlrbaseicmsitcompra * ( :percicmsitcompra / 100 ) * ( :percred / 100 ) )) ;
        end
    end
    else
    begin
        vlrbaseicmsitcompra = :vlrproditcompra - :vlrdescitcompra;
        vlricmsitcompra = :vlrbaseicmsitcompra * ( :percicmsitcompra / 100 );
    end

    vlrbaseipiitcompra = :vlrproditcompra - :vlrdescitcompra;
    vlrbaseicmsbrutitcompra = :vlrproditcompra - :vlrdescitcompra;
    vlripiitcompra = :vlrbaseipiitcompra * ( :percipiitcompra / 100 );

-- **** Calculo dos tributos ***

    -- Se produto for isento de ICMS
    if (:tipofisc = 'II') then
    begin
        vlrisentasitcompra = :vlrliqitcompra;
        vlrbaseicmsitcompra = 0;
        percicmsitcompra = 0;
        vlricmsitcompra = 0;
        vlroutrasitcompra = 0;
    end
    -- Se produto for de Substituição Tributária
    else if (:tipofisc = 'FF') then
    begin
        if (:tipost = 'SI' ) then -- Contribuinte Substituído
        begin
            vlroutrasitcompra = :vlrliqitcompra;
            vlrbaseicmsitcompra = 0;
            percicmsitcompra = 0;
            vlricmsitcompra = 0;
            vlrisentasitcompra = 0;
        end
        else if (:tipost = 'SU' ) then -- Contribuinte Substituto
        begin

            if( (:percicmsst is null) or (:percicmsst=0) ) then
            begin
                select coalesce(percicmsintra,0) from lfbuscaicmssp (:codnat,:uffor,:codemp,:codfilial)
                into :percicmsst;
            end

            if(percred>0 and redbaseicmsst='S') then
            begin
            -- Quando há redução na base do icms st , deve usar o valor da base do icms proprio como parametro
               vlrbaseicmsstitcompra = (  (coalesce(:margemvlagr,0) + 100) / 100 )  * (  (coalesce(:vlrbaseicmsitcompra,0) ) + (coalesce(:vlripiitcompra,0)) );
            end
            else
            begin
                -- Quando não há redução na base do icms st deve usar o valor da base bruto (rem redução)
                vlrbaseicmsstitcompra = (  (coalesce(:margemvlagr,0) + 100) / 100 )  * (  (coalesce(:vlrbaseicmsbrutitcompra,0) ) + (coalesce(:vlripiitcompra,0)) );
            end

            vlroutrasitcompra = 0;
            vlrisentasitcompra = 0;
            vlricmsstitcompra = ( (:vlrbaseicmsstitcompra * :percicmsst) / 100 ) - (:vlricmsitcompra) ;

        end
    end

    -- Se produto não for tributado e não isento

    else if (:tipofisc = 'NN') then
    begin
        vlroutrasitcompra = :vlrliqitcompra;
        vlrbaseicmsitcompra = 0;
        percicmsitcompra = 0;
        vlricmsitcompra = 0;
        vlrisentasitcompra = 0;
    end

    -- Se produto for tributado integralmente

    else if (:tipofisc = 'TT') then
    begin
        vlroutrasitcompra = 0;
        vlrisentasitcompra = 0;
    end

    -- Inserindo dados na tabela de ítens de compra

    if ( :tpagrup <> 'F' ) then
    begin

        insert into cpitcompra (codemp, codfilial, codcompra, coditcompra, codempnt, codfilialnt, codnat, codemppd,
        codfilialpd, codprod, codemple, codfilialle, codlote, qtditcompra, precoitcompra, percdescitcompra,vlrdescitcompra,
        percicmsitcompra,vlrbaseicmsitcompra,vlricmsitcompra,percipiitcompra,vlrbaseipiitcompra,vlripiitcompra,vlrliqitcompra,
        vlrproditcompra,refprod, codempax,codfilialax,codalmox, codempif,codfilialif,codfisc,coditfisc,vlrisentasitcompra, vlroutrasitcompra)
        values (:codemp, :codfilial, :codcompra, :coditcompra, :codemp, :codfilialnt, :codnat, :codemp,:codfilialpd, :codprod,
        :codemp, :codfilialpd, :codlote, :qtditcompra, :precoitcompra,:percdescitcompra,:vlrdescitcompra,:percicmsitcompra,:vlrbaseicmsitcompra,
        :vlricmsitcompra, :percipiitcompra, :vlrbaseipiitcompra, :vlripiitcompra, :vlrliqitcompra,:vlrproditcompra,:refprod,
        :codempax, :codfilialax, :codalmox, :codempif, :codfilialif, :codfisc, :coditfisc, :vlrisentasitcompra,:vlroutrasitcompra
        );
    end

-- Atualizando informações de vínculo

    execute procedure cpupcomprapedsp(:codemp, :codfilial,:codcompra, :coditcompra, :codemppc, :codfilialpc, :codcomprapc, :coditcomprapc);

end
^

/* Alter (EQACERTACUSTORMASP) */
ALTER PROCEDURE EQACERTACUSTORMASP AS
DECLARE VARIABLE ICODRMA INTEGER;
DECLARE VARIABLE ICODFILIAL INTEGER;
DECLARE VARIABLE CUSTODATA NUMERIC(15,2);
DECLARE VARIABLE ICODITRMA INTEGER;
DECLARE VARIABLE ICODEMP INTEGER;
begin
   for select vw.codemp,vw.codfilial,vw.codrma, vw.coditrma, vw.custodata
   from vwtmpcustoitrma vw INTO ICODEMP,ICODFILIAL,ICODRMA,ICODITRMA,CUSTODATA
   do
   begin
      update eqitrma itr set itr.precoitrma=:CUSTODATA
      where itr.codemp=:ICODEMP AND itr.codfilial = :ICODFILIAL
      and itr.codrma = :ICODRMA and itr.coditrma=:ICODITRMA;
   END
  suspend;
end
^

/* Alter (EQADICPRODUTOSP) */
ALTER PROCEDURE EQADICPRODUTOSP(ICODPROD INTEGER,
SDESCPROD CHAR(50),
SDESCAUXPROD CHAR(40),
SREFPROD VARCHAR(20),
SCODFABPROD CHAR(13),
SCODBARPROD CHAR(13),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 AS
declare variable icodnovo integer;
declare variable codalmox integer;
declare variable codempax integer;
declare variable codfilialax integer;
declare variable codmoeda char(4);
declare variable codempma integer;
declare variable codfilialma integer;
declare variable codunid varchar(20);
declare variable codempud integer;
declare variable codfilialud integer;
declare variable codfisc char(13);
declare variable codempfc integer;
declare variable codfilialfc integer;
declare variable codmarca char(6);
declare variable codempmc integer;
declare variable codfilialmc integer;
declare variable codgrup char(10);
declare variable codempgp integer;
declare variable codfilialgp integer;
declare variable tipoprod varchar(2);
declare variable cvprod char(1);
declare variable cloteprod char(1);
declare variable comisprod numeric(15,5);
declare variable pesoliqprod numeric(15,5);
declare variable pesobrutprod numeric(15,5);
declare variable qtdminprod numeric(15,5);
declare variable qtdmaxprod numeric(15,5);
declare variable precobaseprod numeric(15,5);
BEGIN
  BEGIN
    BEGIN
      iCodnovo = CAST(SREFPROD AS INTEGER);
/*Se não conseguir converter para int causa uma excessão e entra neste bloco: */
      WHEN ANY DO
      BEGIN
        SELECT MAX(CODPROD) FROM EQPRODUTO
           WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :iCodnovo;
        iCodnovo = iCodnovo + 1;
      END
    END
    SELECT CODALMOX,CODEMPAX,CODFILIALAX,CODMOEDA,CODEMPMA,CODFILIALMA,CODUNID,CODEMPUD,CODFILIALUD,CODFISC,CODEMPFC,CODFILIALFC,CODMARCA,CODEMPMC,CODFILIALMC,CODGRUP,CODEMPGP,CODFILIALGP,TIPOPROD,
           CVPROD,CLOTEPROD,COMISPROD,PESOLIQPROD,PESOBRUTPROD,QTDMINPROD,
           QTDMAXPROD,PRECOBASEPROD FROM EQPRODUTO WHERE CODPROD=:iCodprod
           AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
           INTO
           :CODALMOX,:CODEMPAX,:CODFILIALAX,:CODMOEDA,:CODEMPMA,:CODFILIALMA,:CODUNID,:CODEMPUD,:CODFILIALUD,:CODFISC,:CODEMPFC,:CODFILIALFC,:CODMARCA,:CODEMPMC,:CODFILIALMC,:CODGRUP,:CODEMPGP,:CODFILIALGP,:TIPOPROD,
           :CVPROD,:CLOTEPROD,:COMISPROD,:PESOLIQPROD,:PESOBRUTPROD,:QTDMINPROD,
           :QTDMAXPROD,:PRECOBASEPROD;
    INSERT INTO EQPRODUTO (CODEMP,CODFILIAL,CODPROD,REFPROD,CODALMOX,CODEMPAX,CODFILIALAX,CODMOEDA,CODEMPMA,CODFILIALMA,CODUNID,CODEMPUD,CODFILIALUD,CODFISC,CODEMPFC,CODFILIALFC,CODMARCA,CODEMPMC,CODFILIALMC,
           CODGRUP,CODEMPGP,CODFILIALGP,TIPOPROD,CVPROD,DESCPROD,DESCAUXPROD,CLOTEPROD,CODBARPROD,CODFABPROD,
           COMISPROD,PESOLIQPROD,PESOBRUTPROD,QTDMINPROD,QTDMAXPROD,PRECOBASEPROD)
           VALUES (
                  :ICODEMP,:ICODFILIAL,:iCodnovo,:sRefProd,:CODALMOX,:CODEMPAX,:CODFILIALAX,:CODMOEDA,:CODEMPMA,:CODFILIALMA,:CODUNID,:CODEMPUD,:CODFILIALUD,:CODFISC,:CODEMPFC,:CODFILIALFC,:CODMARCA,:CODEMPMC,:CODFILIALMC,
                  :CODGRUP,:CODEMPGP,:CODFILIALGP,:TIPOPROD,:CVPROD,:sDescprod,:sDescAuxprod,:CLOTEPROD,:sCodbarprod,:sCodfabprod,
                  :COMISPROD,:PESOLIQPROD,:PESOBRUTPROD,:QTDMINPROD,:QTDMAXPROD,:PRECOBASEPROD
           );
    INSERT INTO VDPRECOPROD (CODEMP,CODFILIAL,CODPROD,CODPRECOPROD,CODCLASCLI,CODEMPCC,CODFILIALCC,CODTAB,CODEMPTB,CODFILIALTB,CODPLANOPAG,CODEMPPG,CODFILIALPG,PRECOPROD)
           SELECT :ICODEMP,:ICODFILIAL,:iCodnovo,CODPRECOPROD,CODCLASCLI,CODEMPCC,CODFILIALCC,
                  CODTAB,CODEMPTB,CODFILIALTB,CODPLANOPAG,CODEMPPG,CODFILIALPG,PRECOPROD FROM VDPRECOPROD WHERE CODPROD=:iCodprod
                  AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL;
  END
--  SUSPEND;
END
^

/* Alter (EQBUSCASIMILARSP) */
ALTER PROCEDURE EQBUSCASIMILARSP(CODEMP INTEGER,
CODFILIAL CHAR(8),
IPROD INTEGER,
SREFPROD VARCHAR(20))
 RETURNS(SRET CHAR(13),
IRET INTEGER,
CORIG CHAR,
ICODFOR INTEGER,
SRAZFOR CHAR(50),
NPRECO NUMERIC(15,5),
SSIM CHAR(18),
SSIMMASTER CHAR(18))
 AS
declare variable sfk char(21);
declare variable sbusca char(21);
BEGIN
/*  IF (IPROD IS NULL) THEN
  BEGIN
    SELECT CODPROD FROM EQPRODUTO WHERE CODEMP=:CODEMP
      AND CODFILIAL=:CODFILIAL AND REFPROD=:SREFPROD
      INTO IPROD;
    SBUSCA = CAST(SREFPROD AS CHAR(21));
  END
  ELSE
  BEGIN
    SBUSCA = CAST(IPROD AS VARCHAR(21));
  END
  FOR SELECT 'S',S.REFPRODSIM,S.REFPRODSIMFK,CAST(NULL AS INTEGER),
    CAST(NULL AS CHAR(50)),CAST(NULL AS NUMERIC(15, 5)),
    S.CODPROD,(SELECT P.REFPROD FROM EQPRODUTO P WHERE P.CODPROD=S.CODPROD
    AND P.CODEMP=S.CODEMP AND P.CODFILIAL=S.CODFILIAL)
    FROM EQSIMILAR S WHERE
    (S.CODPROD = :IPROD OR S.REFPRODSIM = :SBUSCA)
    AND S.CODEMP=:CODEMP AND S.CODFILIAL=:CODFILIAL INTO
    CORIG,SSIM,SFK,ICODFOR,SRAZFOR,NPRECO,IRET,SRET DO
  BEGIN
    SSIMMASTER = SSIM;
    SUSPEND;
    FOR SELECT 'K',S.REFPRODSIM,S.REFPRODSIMFK,CAST(NULL AS INTEGER),
      CAST(NULL AS CHAR(50)),CAST(NULL AS NUMERIC(15, 5)),
      S.CODPROD,(SELECT P.REFPROD FROM EQPRODUTO P WHERE P.CODPROD=S.CODPROD
      AND P.CODEMP=S.CODEMP AND P.CODFILIAL=S.CODFILIAL)
      FROM EQSIMILAR S WHERE
      (S.REFPRODSIMFK = :SFK OR S.CODPROD=:IRET) AND NOT S.REFPRODSIM=:SSIMMASTER
      AND S.CODEMP=:CODEMP AND S.CODFILIAL=:CODFILIAL INTO
      CORIG,SSIM,SFK,ICODFOR,SRAZFOR,NPRECO,IRET,SRET DO
    BEGIN
      SUSPEND;
    END
  END

  FOR SELECT 'C',C.REFPRODFOR,C.CODFOR,F.RAZFOR,CAST(NULL AS NUMERIC(15, 5)),
    P.CODPROD,(SELECT P.REFPROD FROM EQPRODUTO P WHERE P.CODPROD=C.CODPROD
    AND P.CODEMP=C.CODEMP AND P.CODFILIAL=C.CODFILIAL)
    FROM CPPRODFOR C, EQPRODUTO P, CPFORNECED F
    WHERE (C.CODPROD = :IPROD OR C.REFPRODFOR = :SBUSCA)
    AND C.CODEMP=:CODEMP AND C.CODFILIAL=:CODFILIAL AND P.CODEMP=C.CODEMP
    AND P.CODFILIAL=C.CODFILIAL AND P.CODPROD=C.CODPROD
    AND F.CODEMP=C.CODEMP AND F.CODFILIAL=C.CODFILIAL
    AND F.CODFOR=C.CODFOR
    UNION
    SELECT 'T',T.REFPRODTFOR,T.CODFOR,F.RAZFOR,T.PRECOPRODTFOR,
    (SELECT P.CODPROD FROM EQPRODUTO P WHERE P.CODEMP=T.CODEMPPD
    AND P.CODFILIAL=T.CODFILIALPD AND P.CODPROD=T.CODPROD),
    (SELECT P.REFPROD FROM EQPRODUTO P WHERE P.CODPROD=T.CODPROD
    AND P.CODEMP=T.CODEMP AND P.CODFILIAL=T.CODFILIAL)
    FROM CPTABFOR T, CPFORNECED F
    WHERE T.REFPRODTFOR = :SBUSCA AND T.CODEMP=:CODEMP
    AND T.CODFILIAL=:CODFILIAL AND F.CODEMP=T.CODEMP
    AND F.CODFILIAL=T.CODFILIAL AND F.CODFOR=T.CODFOR INTO
    CORIG,SSIM,ICODFOR,SRAZFOR,NPRECO,SRET,IRET DO
  BEGIN
    SUSPEND;
  END */
END
^

/* Alter (EQCOPIAPROD) */
ALTER PROCEDURE EQCOPIAPROD(ICODPROD INTEGER,
ICODEMP INTEGER,
ICODFILIAL INTEGER)
 RETURNS(ICOD INTEGER)
 AS
declare variable inovocod integer;
BEGIN
  SELECT MAX(CODPROD)+1 FROM EQPRODUTO
    WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO INOVOCOD;
  INSERT INTO EQPRODUTO
      (CODPROD,CODEMP,CODFILIAL,DESCPROD,REFPROD,CODEMPAX,
      CODFILIALAX,CODALMOX,CODEMPMA,CODFILIALMA,CODMOEDA,CODEMPUD,
      CODFILIALUD,CODUNID,CODEMPFC,CODFILIALFC,CODFISC,CODEMPMC,
      CODFILIALMC,CODMARCA,DESCAUXPROD,TIPOPROD,CVPROD,CODEMPGP,
      CODFILIALGP,CODGRUP,CODBARPROD,CLOTEPROD,CODFABPROD,
      COMISPROD,PESOLIQPROD,PESOBRUTPROD,QTDMINPROD,QTDMAXPROD,
      PRECOBASEPROD,ATIVOPROD,DESCCOMPPROD)
    SELECT :INOVOCOD,:ICODEMP,:ICODFILIAL,DESCPROD,:INOVOCOD,CODEMPAX,
      CODFILIALAX,CODALMOX,CODEMPMA,CODFILIALMA,CODMOEDA,CODEMPUD,
      CODFILIALUD,CODUNID,CODEMPFC,CODFILIALFC,CODFISC,CODEMPMC,
      CODFILIALMC,CODMARCA,DESCAUXPROD,TIPOPROD,CVPROD,CODEMPGP,
      CODFILIALGP,CODGRUP,CODBARPROD,CLOTEPROD,CODFABPROD,COMISPROD,
      PESOLIQPROD,PESOBRUTPROD,QTDMINPROD,QTDMAXPROD,PRECOBASEPROD,
      ATIVOPROD,DESCCOMPPROD FROM
      EQPRODUTO WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND
      CODPROD=:ICODPROD;

    INSERT INTO VDPRECOPROD (CODEMP,CODFILIAL,CODPROD,CODPRECOPROD,
        CODEMPTB,CODFILIALTB,CODTAB,CODEMPCC,CODFILIALCC,CODCLASCLI,
        CODEMPPG,CODFILIALPG,CODPLANOPAG,PRECOPROD)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODPRECOPROD,
        CODEMPTB,CODFILIALTB,CODTAB,CODEMPCC,CODFILIALCC,CODCLASCLI,
        CODEMPPG,CODFILIALPG,CODPLANOPAG,PRECOPROD FROM VDPRECOPROD
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND
          CODPROD=:ICODPROD;

    INSERT INTO EQFATCONV (CODEMP,CODFILIAL,CODPROD,CODUNID,FATCONV)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODUNID,FATCONV FROM EQFATCONV
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;

    INSERT INTO CPPRODFOR (CODEMP,CODFILIAL,CODPROD,CODFOR,REFPRODFOR)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODFOR,REFPRODFOR FROM CPPRODFOR
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;
        
    /* se for outro produto o lote provavelmente será outro também */
    /*INSERT INTO EQLOTE (CODEMP,CODFILIAL,CODPROD,CODLOTE,VENCTOLOTE,
        SLDLOTE,SLDRESLOTE,SLDCONSIGLOTE,SLDLIQLOTE,DINILOTE)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODLOTE,VENCTOLOTE,
        SLDLOTE,SLDRESLOTE,SLDCONSIGLOTE,SLDLIQLOTE,DINILOTE FROM EQLOTE
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;*/
        
    INSERT INTO VDFOTOPROD (CODEMP,CODFILIAL,CODPROD,CODFOTOPROD,DESCFOTOPROD,
        TIPOFOTOPROD,LARGFOTOPROD,ALTFOTOPROD,FOTOPROD)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODFOTOPROD,DESCFOTOPROD,
        TIPOFOTOPROD,LARGFOTOPROD,ALTFOTOPROD,FOTOPROD FROM VDFOTOPROD
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;
   ICOD = INOVOCOD;
   SUSPEND;
END
^

/* empty dependent procedure body */
/* Clear: CPADICITCOMPRARECMERCSP for: EQCUSTOPRODSP */
ALTER PROCEDURE CPADICITCOMPRARECMERCSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
TICKET INTEGER,
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
QTDITCOMPRA NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

/* empty dependent procedure body */
/* Clear: EQPRODUTOSP01 for: EQCUSTOPRODSP */
ALTER PROCEDURE EQPRODUTOSP01(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(NSALDO NUMERIC(15,5),
NSALDOAX NUMERIC(15,5),
NCUSTOMPM NUMERIC(15,5),
NCUSTOPEPS NUMERIC(15,5),
NCUSTOMPMAX NUMERIC(15,5),
NCUSTOPEPSAX NUMERIC(15,5),
NCUSTOINFO NUMERIC(15,5),
NCUSTOUC NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

/* Alter (EQCUSTOPRODSP) */
ALTER PROCEDURE EQCUSTOPRODSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
DTESTOQ DATE,
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CCOMSALDO CHAR(10))
 RETURNS(SLDPROD NUMERIC(15,5),
CUSTOUNIT NUMERIC(15,5),
CUSTOTOT NUMERIC(15,5))
 AS
declare variable precobase numeric(15,5);
declare variable custompm numeric(15,5);
begin
  /* Retorna o custo unitário do produto */
  IF (CTIPOCUSTO IS NULL) then
     CTIPOCUSTO = 'P';

     -- Se o almoxarifado não for selecionado, deve buscar o saldo geral
    if(:icodalmox is null) then
    begin

        SELECT P.PRECOBASEPROD,
            (SELECT FIRST 1 M.SLDMOVPROD
             FROM EQMOVPROD M
             WHERE M.CODEMPPD=P.CODEMP AND
               M.CODFILIAL=P.CODFILIAL AND
               M.CODPROD=P.CODPROD AND
               M.DTMOVPROD<=:DTESTOQ
             ORDER BY P.CODPROD, M.DTMOVPROD DESC , M.CODMOVPROD DESC
             ) ,
            (SELECT FIRST 1 M.CUSTOMPMMOVPROD
             FROM EQMOVPROD M
             WHERE M.CODEMPPD=P.CODEMP AND
               M.CODFILIAL=P.CODFILIAL AND
               M.CODPROD=P.CODPROD AND
               M.DTMOVPROD<=:DTESTOQ
             ORDER BY P.CODPROD, M.DTMOVPROD DESC , M.CODMOVPROD DESC
            )
            FROM EQPRODUTO P
            WHERE P.CODEMP = :ICODEMP AND P.CODFILIAL = :SCODFILIAL AND P.CODPROD=:ICODPROD
            INTO :PRECOBASE, :SLDPROD, :CUSTOMPM;
    end
    else
    begin

        SELECT P.PRECOBASEPROD,
            (SELECT FIRST 1 M.SLDMOVPRODAX
             FROM EQMOVPROD M
             WHERE M.CODEMPPD=P.CODEMP AND M.CODFILIAL=P.CODFILIAL AND M.CODPROD=P.CODPROD AND M.DTMOVPROD<=:DTESTOQ
                and ( (:icodalmox is null) or ( m.codempax=:icodempax and m.codfilial=:scodfilialax and m.codalmox=:icodalmox) )
             ORDER BY P.CODPROD, M.DTMOVPROD DESC , M.CODMOVPROD DESC
         ) ,
         (SELECT FIRST 1 M.CUSTOMPMMOVPROD
         FROM EQMOVPROD M
         WHERE M.CODEMPPD=P.CODEMP AND
               M.CODFILIAL=P.CODFILIAL AND
               M.CODPROD=P.CODPROD AND
               M.DTMOVPROD<=:DTESTOQ
               and ( (:icodalmox is null) or ( m.codempax=:icodempax and m.codfilial=:scodfilialax and m.codalmox=:icodalmox) )
         ORDER BY P.CODPROD, M.DTMOVPROD DESC , M.CODMOVPROD DESC
         )
       FROM EQPRODUTO P
       WHERE P.CODEMP = :ICODEMP AND P.CODFILIAL = :SCODFILIAL AND
          P.CODPROD=:ICODPROD
       INTO :PRECOBASE, :SLDPROD, :CUSTOMPM;

    end


  CUSTOUNIT = 0;
  CUSTOTOT = 0;
  IF (SLDPROD IS NULL) THEN
        SLDPROD = 0;
  IF ( (SLDPROD!=0) OR (CCOMSALDO!='S') ) THEN
  BEGIN
      -- Custo PEPS
      IF (CTIPOCUSTO='P') THEN
      BEGIN
         SELECT NCUSTOPEPS FROM EQCALCPEPSSP(:ICODEMP,:SCODFILIAL,:ICODPROD,
            :SLDPROD,:DTESTOQ, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX)
            INTO :CUSTOUNIT;
         IF (CUSTOUNIT!=0) THEN
            CUSTOTOT = CUSTOUNIT*SLDPROD;
      END
      -- Custo MPM
      ELSE IF (CTIPOCUSTO='M') THEN
      BEGIN
         CUSTOUNIT = CUSTOMPM;
         IF (CUSTOUNIT IS NULL) THEN
            CUSTOUNIT = 0;
          CUSTOTOT = CUSTOUNIT*SLDPROD;
      END
      -- Preço Base
      ELSE IF (CTIPOCUSTO='B') THEN
      BEGIN
         CUSTOUNIT = PRECOBASE;
         IF (CUSTOUNIT IS NULL) THEN
            CUSTOUNIT = 0;
          CUSTOTOT = CUSTOUNIT*SLDPROD;
      END
      -- Preço da Ultima Compra
      else if (CTIPOCUSTO='U') then
      begin
        select first 1 ic.custoitcompra from cpitcompra ic, cpcompra cp
            where cp.codemp=:icodemp and cp.codfilial=:scodfilial and cp.dtentcompra<=:dtestoq
            and ic.codemp=cp.codemp and ic.codfilial=cp.codfilial and ic.codcompra=cp.codcompra
            and ic.codemppd=:icodemp and ic.codfilialpd=:scodfilial and ic.codprod=:icodprod
            and ( (:icodalmox is null) or ( ic.codempax=:icodempax and ic.codfilial=:scodfilialax and ic.codalmox=:icodalmox) )
            order by cp.dtentcompra desc
            into :CUSTOUNIT;

            if (CUSTOUNIT IS NULL) THEN
                CUSTOUNIT = :CUSTOMPM;
      end

  END
  SUSPEND;
end
^

/* Alter (EQGERARMAOSSP) */
ALTER PROCEDURE EQGERARMAOSSP(CODEMPRM INTEGER,
CODFILIALRM INTEGER,
TICKET INTEGER,
CODITRECMERC SMALLINT)
 RETURNS(CODRMA INTEGER)
 AS
declare variable coditos smallint;
declare variable idusu1 char(8);
declare variable codfilialrma smallint;
declare variable codfilialpd smallint;
declare variable coditrma integer;
declare variable refprod varchar(20);
declare variable codtipomov1 integer;
declare variable codccusu1 char(19);
declare variable codfilialccusu1 smallint;
declare variable codfilialtm1 smallint;
declare variable codfilialtm smallint;
declare variable codemppd integer;
declare variable codprod integer;
declare variable codfilialle smallint;
declare variable custompmit numeric(15,5);
declare variable codlote varchar(20);
declare variable codalmox integer;
declare variable qtd numeric(15,2);
declare variable codfilialax smallint;
declare variable codfilialusu1 smallint;
declare variable anoccusu1 smallint;
declare variable statusaprovrmager char(2) = 'PE';
declare variable statusrmager char(2);
declare variable qtdaprov numeric(15,5) = 0;
begin


    -- buscando centro de custo do usuário atual
    select codfilialusu,codfilialccusu,codccusu,anoccusu,idusus
    from sgretinfousu(user)
    into :CODFILIALUSU1,:CODFILIALCCUSU1,:CODCCUSU1,:ANOCCUSU1,:IDUSU1;

    -- Buscando filial da rma
    SELECT ICODFILIAL FROM sgretfilial(:CODEMPRM,'EQRMA')
    into :codfilialrma;

    -- Buscando filial do lote
    SELECT ICODFILIAL FROM sgretfilial(:CODEMPRM,'EQLOTE')
    into :codfilialle;

    -- Buscando filial do tipo de movimento
    SELECT ICODFILIAL FROM sgretfilial(:CODEMPRM,'EQTIPOMOV')
    into :codfilialtm;

    -- buscando tipo de movimento para RMA
    select codfilialt8,codtipomov8 from sgprefere1
    where codemp=:codemprm and codfilial=:codfilialrm
    into :codfilialtm1,:codtipomov1;

    -- Buscado a situação pardrão para RMA
    select coalesce(SITRMAOP,'PE') from sgprefere5 where codemp=:codemprm and
    codfilial=(select icodfilial from sgretfilial(:codemprm,'SGPREFERE5'))
    into :statusrmager;

    if(:statusrmager is null) then
    begin
       statusrmager = 'PE';
    end

    -- Carregando quantidade aprovada...
    QTDAPROV = 0;
    STATUSAPROVRMAGER = 'PE';

    -- Buscando código novo código de RMA.
    select coalesce((max(codrma)+1),1) from
    eqrma where codemp=:codemprm and codfilial=:codfilialrma
    into :codrma;

    -- Inserindo nova RMA
    insert into eqrma (codemp,codfilial,codrma,
                     codempuu,codfilialuu,idusu,
                     codempua,codfilialua,idusuaprov,
                     codempue,codfilialue,idusuexp,
                     codemptm,codfilialtm,codtipomov,
                     codempcc,codfilialcc,anocc,codcc,
                     dtareqrma,dtaaprovrma,dtaexprma,
                     sitrma,sitaprovrma,sitexprma,
                     codempos,codfilialos,ticket,coditrecmerc,motivorma)
                     values
                     (:codemprm,:codfilialrma,:codrma,
                      :codemprm, :codfilialusu1,:idusu1,
                      null,null,null,
                      null,null,null,
                      :codemprm, :codfilialtm1, :codtipomov1,
                      :codemprm,:codfilialccusu1,:anoccusu1,:codccusu1,
                      cast('now' AS DATE),null,null,
                      :STATUSRMAGER,:STATUSAPROVRMAGER,'PE',
                      :codemprm,:codfilialrm,:ticket,:coditrecmerc,
                      'REQUISIÇÃO GERADA PARA ATENDIMENTO À OS:'|| :ticket
    );

    -- Loop nos itens de Ordem de Serviço.

    for select os.coditrecmerc, os.coditos, os.codemppd, os.codfilialpd, os.refprodpd, os.codprodpd, os.qtditos,
    (select ncustompm from eqprodutosp01(os.codemppd, os.codfilialpd, os.codprodpd,null,null,null)) custompmit
    from eqitrecmercitos os
    where os.codemp=:codemprm and os.codfilial=:codfilialrm and os.ticket=:ticket
--    and ( (os.coditrecmerc=:coditrecmerc) or (:coditrecmerc is null) )
    and os.gerarma='S'
    into :coditrecmerc, :coditos, :codemppd, :codfilialpd, :refprod, :codprod, :qtd, :custompmit
    do

    begin

       select coalesce((max(coditrma)+1),1) from eqitrma
       where codemp=:codemprm and codfilial=:codfilialrma and codrma=:codrma
       into :coditrma;

       if(:statusrmager='AF') then
       begin
         STATUSAPROVRMAGER = 'AT';
         QTDAPROV = :qtd;
       end

       insert into eqitrma (CODEMP,CODFILIAL,CODRMA,CODITRMA,
                            CODEMPPD,CODFILIALPD,CODPROD,REFPROD,
                            QTDITRMA,QTDAPROVITRMA,QTDEXPITRMA,PRECOITRMA,
                            CODEMPLE,CODFILIALLE,CODLOTE,
                            CODEMPAX,CODFILIALAX,CODALMOX,
                            SITITRMA,SITAPROVITRMA,SITEXPITRMA,
                            CODEMPOS,CODFILIALOS,TICKET,CODITRECMERC,CODITOS
                            )
                            values
                            (:codemprm,:codfilialrma,:codrma, :coditrma,
                            :codemprm,:codfilialpd,
                            :codprod, :refprod, :qtd, :qtdaprov, 0, :custompmit, :codemprm,
                            :codfilialle,:codlote,
                            :codemprm,:codfilialax,:codalmox,
                            :statusrmager,:statusaprovrmager,'PE',
                            :codemprm, :codfilialrm, :ticket, :coditrecmerc,:coditos
                            );

        update eqitrecmercitos os set os.gerarma='N', os.statusitos='EC'
        where os.codemp=:codemprm and os.codfilial=:codfilialrm and os.ticket=:ticket
        and os.coditrecmerc=:coditrecmerc and os.coditos=:coditos;

        suspend;

   end
end
^

/* Alter (EQGERARMASP) */
ALTER PROCEDURE EQGERARMASP(CODEMPOP INTEGER,
CODFILIALOP INTEGER,
CODOP INTEGER,
SEQOP SMALLINT)
 AS
declare variable seqof smallint;
declare variable idusu1 char(8);
declare variable seqitop integer;
declare variable coditrma integer;
declare variable refprod varchar(20);
declare variable codrma integer;
declare variable codtipomov1 integer;
declare variable codccusu1 char(19);
declare variable codfilialccusu1 smallint;
declare variable codfilialpd smallint;
declare variable codfilialtm1 smallint;
declare variable codprod integer;
declare variable codfilialle smallint;
declare variable custompmit numeric(15,5);
declare variable codlote varchar(20);
declare variable codalmox integer;
declare variable qtd numeric(15,2);
declare variable codfilialax smallint;
declare variable codfilialusu1 smallint;
declare variable anoccusu1 smallint;
declare variable statusaprovrmager char(2) = 'PE';
declare variable statusrmager char(2);
declare variable codfilialfase smallint;
declare variable qtdaprov numeric(15,5) = 0;
declare variable codfase integer;
declare variable codempos integer;
declare variable codfilialos smallint;
declare variable ticket integer;
declare variable coditrecmerc integer;
declare variable coditos integer;
begin

    -- Buscando informações do usuário
    select codfilialusu,codfilialccusu,codccusu,anoccusu,idusus
    from sgretinfousu(user)
    into :CODFILIALUSU1,:CODFILIALCCUSU1,:CODCCUSU1,:ANOCCUSU1,:IDUSU1;

    -- Buscando preferencias de tipo de movimento para OP
    select codfilialt8,codtipomov8
    from sgprefere1 where codemp=:CODEMPOP and codfilial=(select icodfilial from sgretfilial(:CODEMPOP, 'SGPREFERE1'))
    into :CODFILIALTM1,:CODTIPOMOV1;

    --Buscando informações da OP.
    select op.codempos, op.codfilialos, op.ticket, op.coditrecmerc, op.coditos
    from  ppop op
    where op.codemp=:codempop and op.codfilial=:codfilialop and op.codop=:codop and op.seqop=:seqop
    into :codempos, :codfilialos, :ticket, :coditrecmerc, :coditos;

    -- Buscando preferencias para geração de RMA
    select coalesce(SITRMAOP,'PE') from sgprefere5 where codemp=:CODEMPOP and
    codfilial=(select icodfilial from sgretfilial(:CODEMPOP,'SGPREFERE5'))
    into :STATUSRMAGER;

    QTDAPROV = 0;
    STATUSAPROVRMAGER = 'PE';

    for select codfilialfs,codfase,seqof from ppopfase opf
        where opf.codemp=:CODEMPOP and opf.codfilial=:CODFILIALOP and
        opf.codop=:CODOP and  opf.seqop=:SEQOP and
        (select count(1) from ppitop it
        where it.codemp=:CODEMPOP and it.codfilial=:CODFILIALOP and
        it.codempfs=opf.codempfs and it.codfilialfs=opf.codfilialfs and
        it.codfase=opf.codfase and it.gerarma='S' and
        it.codop=:CODOP and it.seqop=:SEQOP) > 0
        into :codfilialfase,:codfase,:SEQOF do
    begin
        select coalesce((max(codrma)+1),1)
        from eqrma
        where codemp=:CODEMPOP and codfilial=:CODFILIALOP into :CODRMA;

        insert into eqrma (codemp,codfilial,codrma,
                     codempuu,codfilialuu,idusu,
                     codempua,codfilialua,idusuaprov,
                     codempue,codfilialue,idusuexp,
                     codemptm,codfilialtm,codtipomov,
                     codempcc,codfilialcc,anocc,codcc,
                     dtareqrma,dtaaprovrma,dtaexprma,
                     sitrma,sitaprovrma,sitexprma,
                     codempof,codfilialof,codop,seqop,seqof,
                     motivorma, codempos, codfilialos, ticket, coditrecmerc)
                     values
                     (:CODEMPOP,(SELECT ICODFILIAL FROM sgretfilial(:CODEMPOP,'EQRMA')),:CODRMA,
                      :CODEMPOP, :CODFILIALUSU1,:IDUSU1,
                      null,null,null,
                      null,null,null,
                      :CODEMPOP,(SELECT ICODFILIAL FROM sgretfilial(:CODEMPOP,'EQTIPOMOV')),
                      :CODTIPOMOV1,
                      :CODEMPOP,:CODFILIALCCUSU1,:ANOCCUSU1,:CODCCUSU1,
                      cast('now' AS DATE),null,null,
                      :STATUSRMAGER,:STATUSAPROVRMAGER,'PE',
                      :CODEMPOP,:CODFILIALOP,:CODOP,:SEQOP,:SEQOF,
                      'REQUISIÇÃO GERADA PARA ATENDIMENTO À OP:'||:CODOP||' SEQ:'||:SEQOP||' - FASE:'||:CODFASE,
                      :codempos, :codfilialos, :ticket, :coditrecmerc
        );

        for select it.seqitop,it.codfilialpd,it.codprod,it.refprod,it.qtditop-coalesce(it.qtdcopiaitop,0),it.codfilialle,it.codlote,
            (select ncustompm from eqprodutosp01(it.codemppd,it.codfilialpd,it.codprod,null,null,null)),
            (SELECT CODFILIALAX FROM EQPRODUTO WHERE CODEMP=it.codemppd and codfilial=it.codfilialpd and codprod=it.codprod),
            (SELECT CODALMOX FROM EQPRODUTO WHERE CODEMP=it.codemppd and codfilial=it.codfilialpd and codprod=it.codprod)
            from ppitop it, eqproduto pd
            where
            pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and pd.codprod=it.codprod
            and it.codemp=:CODEMPOP and it.codfilial=:CODFILIALOP
            and it.codop=:CODOP and it.seqop=:SEQOP and it.codempfs=:CODEMPOP
            and it.codfilialfs=:CODFILIALFASE
            and it.codfase = :CODFASE and it.gerarma='S'
            and (('S'=(select ratauto from sgprefere5 where codemp=it.codemp and codfilial=it.codfilial))
            and (it.qtditop-coalesce(it.qtdcopiaitop, 0))<=(SELECT L.SLDLOTE FROM EQLOTE L
                                                            WHERE L.CODEMP=it.codemple AND L.CODFILIAL=it.codfilialle AND
                                                            L.CODPROD=it.codprod AND L.CODLOTE=it.codlote)
            or pd.cloteprod = 'N'
                                                            )
            into :SEQITOP, :CODFILIALPD,:CODPROD,:REFPROD,:QTD,
            :CODFILIALLE,:CODLOTE,:CUSTOMPMIT,:CODFILIALAX,:CODALMOX  DO
        begin
            select coalesce((max(coditrma)+1),1) from eqitrma
            where codemp=:CODEMPOP and codfilial=:CODFILIALOP and
            codrma=:CODRMA into :coditrma;

            if(:STATUSRMAGER='AF')then
            begin
                STATUSAPROVRMAGER = 'AT';
                QTDAPROV = :QTD;
            end

            insert into eqitrma (CODEMP,CODFILIAL,CODRMA,CODITRMA,
                            CODEMPPD,CODFILIALPD,CODPROD,REFPROD,
                            QTDITRMA,QTDAPROVITRMA,QTDEXPITRMA,PRECOITRMA,
                            CODEMPLE,CODFILIALLE,CODLOTE,
                            CODEMPAX,CODFILIALAX,CODALMOX,
                            SITITRMA,SITAPROVITRMA,SITEXPITRMA,
                            codempos, codfilialos, ticket, coditrecmerc, coditos
                            )
                            values
                            (:CODEMPOP,(SELECT ICODFILIAL FROM sgretfilial(:CODEMPOP,'EQITRMA')),:CODRMA,
                            :coditrma,
                            :CODEMPOP,(SELECT ICODFILIAL FROM sgretfilial(:CODEMPOP,'EQPRODUTO')),
                            :CODPROD,:REFPROD,:QTD,:QTDAPROV,0,:CUSTOMPMIT,:CODEMPOP,(SELECT ICODFILIAL FROM sgretfilial(:CODEMPOP,'EQLOTE')),:CODLOTE,
                            :CODEMPOP,:CODFILIALAX,:CODALMOX,
                            :STATUSRMAGER,:STATUSAPROVRMAGER,'PE',
                            :codempop, :codfilialos, :ticket, :coditrecmerc, :coditos
                            );

            update ppitop it set it.gerarma='N' where it.CODEMP=:CODEMPOP AND
                it.CODFILIAL=:CODFILIALOP AND
                it.codop=:CODOP and it.seqop=:SEQOP and it.seqitop=:seqitop;

        end

    end

    suspend;

end
^

ALTER PROCEDURE EQMOVPRODRETCODSP(ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQOPENT SMALLINT,
SEQSUBPROD SMALLINT)
 RETURNS(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER)
 AS
begin
  /* Retorna o código do movimento de estoque */
  if (ICODINVPROD IS NOT NULL) then
     SELECT MP.CODEMP, MP.CODFILIAL, MP.CODMOVPROD FROM EQMOVPROD MP
       WHERE MP.CODEMPIV=:ICODEMPIV AND MP.CODFILIALIV=:SCODFILIALIV
         AND MP.CODINVPROD=:ICODINVPROD
       INTO  :ICODEMP, :SCODFILIAL, :ICODMOVPROD;
  else if (ICODCOMPRA IS NOT NULL) then
     SELECT MP.CODEMP, MP.CODFILIAL, MP.CODMOVPROD FROM EQMOVPROD MP
       WHERE MP.CODEMPCP=:ICODEMPCP AND MP.CODFILIALCP=:SCODFILIALCP
         AND MP.CODCOMPRA=:ICODCOMPRA AND MP.CODITCOMPRA=:SCODITCOMPRA
       INTO  :ICODEMP, :SCODFILIAL, :ICODMOVPROD;
  else if (ICODVENDA IS NOT NULL) then
     SELECT MP.CODEMP, MP.CODFILIAL, MP.CODMOVPROD FROM EQMOVPROD MP
       WHERE MP.CODEMPVD=:ICODEMPVD AND MP.CODFILIALVD=:SCODFILIALVD
         AND MP.TIPOVENDA=:CTIPOVENDA AND MP.CODVENDA=:ICODVENDA
         AND MP.CODITVENDA=:SCODITVENDA
       INTO  :ICODEMP, :SCODFILIAL, :ICODMOVPROD;
  else if (ICODRMA IS NOT NULL) then
     SELECT MP.CODEMP, MP.CODFILIAL, MP.CODMOVPROD FROM EQMOVPROD MP
       WHERE MP.CODEMPRM=:ICODEMPRM AND MP.CODFILIALRM=:SCODFILIALRM
         AND MP.CODRMA=:ICODRMA AND MP.CODITRMA=:SCODITRMA
       INTO  :ICODEMP, :SCODFILIAL, :ICODMOVPROD;
  else if (ICODOP IS NOT NULL) then
     begin

        if( :sseqopent is not null ) then
        begin
            SELECT MP.CODEMP, MP.CODFILIAL, MP.CODMOVPROD FROM EQMOVPROD MP
            WHERE MP.CODEMPOP=:ICODEMPOP AND MP.CODFILIALOP=:SCODFILIALOP
            AND MP.CODOP=:ICODOP AND MP.SEQOP=:SSEQOP AND MP.seqentop=:sseqopent
            INTO  :ICODEMP, :SCODFILIAL, :ICODMOVPROD;
        end
        else if (:seqsubprod is not null) then
        begin
            SELECT MP.CODEMP, MP.CODFILIAL, MP.CODMOVPROD FROM EQMOVPROD MP
            WHERE MP.CODEMPOP=:ICODEMPOP AND MP.CODFILIALOP=:SCODFILIALOP
            AND MP.CODOP=:ICODOP AND MP.SEQOP=:SSEQOP AND MP.seqsubprod=:seqsubprod
            INTO  :ICODEMP, :SCODFILIAL, :ICODMOVPROD;

        end
        else
        begin
            SELECT MP.CODEMP, MP.CODFILIAL, MP.CODMOVPROD FROM EQMOVPROD MP
            WHERE MP.CODEMPOP=:ICODEMPOP AND MP.CODFILIALOP=:SCODFILIALOP
            AND MP.CODOP=:ICODOP AND MP.SEQOP=:SSEQOP and mp.seqentop is null and mp.seqsubprod is null
            INTO  :ICODEMP, :SCODFILIAL, :ICODMOVPROD;

        end
    end



  suspend;
end
^

/* Alter (EQMOVPRODDSP) */
ALTER PROCEDURE EQMOVPRODDSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
DDTMOVPROD DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD SMALLINT)
 AS
declare variable icodemp integer;
declare variable scodfilial smallint;
declare variable icodmovprod integer;
declare variable nsldmovprod numeric(15,5);
declare variable ncustompmmovprod numeric(15,5);
declare variable nsldmovprodax numeric(15,5);
declare variable ncustompmmovprodax numeric(15,5);
begin
  /* Procedure de deleção da tabela eqmovprod */
  SELECT ICODEMP, SCODFILIAL, ICODMOVPROD
  FROM EQMOVPRODRETCODSP(:ICODEMPIV, :SCODFILIALIV, :ICODINVPROD, :ICODEMPCP,
    :SCODFILIALCP, :ICODCOMPRA, :SCODITCOMPRA, :ICODEMPVD, :SCODFILIALVD,
    :CTIPOVENDA, :ICODVENDA, :SCODITVENDA, :ICODEMPRM, :SCODFILIALRM, :ICODRMA,
    :SCODITRMA, :ICODEMPOP,  :SCODFILIALOP,  :ICODOP, :SSEQOP, :sseqentop, :seqsubprod)
    INTO :ICODEMP, :SCODFILIAL, :ICODMOVPROD;

  SELECT NSALDO, NCUSTOMPM, NSALDOAX, NCUSTOMPMAX
  FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD,
   :ICODEMPPD, :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, 0, 0,
   :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
     INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX  ;

  /* DELETAR EQMOVPROD */
  DELETE FROM EQMOVPROD WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL
    AND CODMOVPROD=:ICODMOVPROD;

  /* REPROCESSAR ESTOQUE */
  SELECT NSLDPRC, NCUSTOMPMPRC, NSLDPRCAX, NCUSTOMPMPRCAX
    FROM EQMOVPRODPRCSLDSP( :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
      :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, null, :NSLDMOVPROD, :NCUSTOMPMMOVPROD,
      :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX,
      :CMULTIALMOX)
    INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX;

  /* ATUALIZA CUSTO NO CADASTRO DE PRODUTOS
   OPERADOR 1 PARA EFETUAR A ATUALIZAÇÃO SEMPRE
  EXECUTE PROCEDURE EQMOVPRODATCUSTSP( 1, :ICODEMP, :SCODFILIAL,
   :ICODMOVPROD,  :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, 0);
   */

  suspend;
end
^

/* Alter (EQMOVPRODISP) */
ALTER PROCEDURE EQMOVPRODISP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD SMALLINT)
 AS
declare variable scodfilial smallint;
declare variable icodmovprod integer;
declare variable cestoqmovprod char(1);
declare variable ctipomovprod char(1);
declare variable nsldmovprod numeric(15,5);
declare variable ncustompmmovprod numeric(15,5);
declare variable soperador smallint;
declare variable nsldmovprodax numeric(15,5);
declare variable ncustompmmovprodax numeric(15,5);
begin
  /* Procedure de inserção na tabela eqmovprod */

  SELECT NSALDO, NCUSTOMPM, NSALDOAX, NCUSTOMPMAX FROM EQMOVPRODSLDSP(null, null, null, :ICODEMPPD,
     :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, :NPRECOMOVPROD, :NPRECOMOVPROD,
     :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX )
     INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX ;

  /* Verifica se haverá mudança de saldo*/
  SELECT NSALDO, NCUSTOMPM, CESTOQMOVPROD, CTIPOMOVPROD, SOPERADOR FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
      :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPROD)
      INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :CESTOQMOVPROD, :CTIPOMOVPROD, :SOPERADOR;

  if (CMULTIALMOX='N') then
  begin
     NSLDMOVPRODAX = NSLDMOVPROD;
     NCUSTOMPMMOVPRODAX = NCUSTOMPMMOVPROD;
  end
  else
  begin
      SELECT NSALDO, NCUSTOMPM FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
          :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMMOVPRODAX, :NSLDMOVPRODAX)
        INTO :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX;
  end

  SELECT SCODFILIAL, ICODMOVPROD FROM EQMOVPRODSEQSP(:ICODEMPPD)
     INTO :SCODFILIAL, :ICODMOVPROD;  /* encontra o próximo código e a filial*/

   INSERT INTO EQMOVPROD ( CODEMP, CODFILIAL, CODMOVPROD,
      CODEMPPD, CODFILIALPD , CODPROD , CODEMPLE ,
      CODFILIALLE , CODLOTE , CODEMPTM, CODFILIALTM,
      CODTIPOMOV, CODEMPIV , CODFILIALIV , CODINVPROD ,
      CODEMPCP , CODFILIALCP , CODCOMPRA , CODITCOMPRA , CODEMPVD ,
      CODFILIALVD , TIPOVENDA , CODVENDA , CODITVENDA , CODEMPRM ,
      CODFILIALRM , CODRMA , CODITRMA ,
      CODEMPOP, CODFILIALOP, CODOP, SEQOP, SEQENTOP,
      CODEMPNT , CODFILIALNT ,
      CODNAT , DTMOVPROD , DOCMOVPROD , FLAG , QTDMOVPROD ,
      PRECOMOVPROD, ESTOQMOVPROD, TIPOMOVPROD, SLDMOVPROD, CUSTOMPMMOVPROD,
      SLDMOVPRODAX, CUSTOMPMMOVPRODAX, CODEMPAX, CODFILIALAX, CODALMOX, seqsubprod )
   VALUES ( :ICODEMPPD, :SCODFILIAL, :ICODMOVPROD,
    :ICODEMPPD , :SCODFILIALPD , :ICODPROD , :ICODEMPLE ,
    :SCODFILIALLE , :CCODLOTE , :ICODEMPTM, :SCODFILIALTM,
    :ICODTIPOMOV, :ICODEMPIV , :SCODFILIALIV ,
    :ICODINVPROD , :ICODEMPCP , :SCODFILIALCP , :ICODCOMPRA ,
    :SCODITCOMPRA , :ICODEMPVD , :SCODFILIALVD , :CTIPOVENDA ,
    :ICODVENDA , :SCODITVENDA , :ICODEMPRM , :SCODFILIALRM ,
    :ICODRMA , :SCODITRMA , :ICODEMPOP, :SCODFILIALOP, :ICODOP, :SSEQOP, :sseqentop,
    :ICODEMPNT , :SCODFILIALNT , :CCODNAT ,
    :DDTMOVPROD , :IDOCMOVPROD , :CFLAG , :NQTDMOVPROD ,
    :NPRECOMOVPROD, :CESTOQMOVPROD, :CTIPOMOVPROD, :NSLDMOVPROD, :NCUSTOMPMMOVPROD,
    :NSLDMOVPRODAX,  :NCUSTOMPMMOVPRODAX, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :seqsubprod );

  /* REPROCESSAR ESTOQUE */

  SELECT NSLDPRC, NCUSTOMPMPRC, NSLDPRCAX, NCUSTOMPMPRCAX
    FROM EQMOVPRODPRCSLDSP( :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
     :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, null, :NSLDMOVPROD, :NCUSTOMPMMOVPROD,
     :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX,
     :CMULTIALMOX)
    INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPRODAX, :NCUSTOMPMMOVPRODAX ;

 /* ATUALIZA O CUSTO NO CADASTRO DE PRODUTOS
   EXECUTE PROCEDURE EQMOVPRODATCUSTSP(:SOPERADOR, :ICODEMPPD, :SCODFILIAL,
    :ICODMOVPROD, :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, :NCUSTOMPMMOVPROD); 
 */


  suspend;
end
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Sequencial do subproduto'
WHERE RDB$PROCEDURE_NAME = 'EQMOVPRODISP' AND RDB$PARAMETER_NAME = 'SEQSUBPROD';

SET TERM ^ ;

ALTER PROCEDURE EQMOVPRODUSP(ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CMULTIALMOX CHAR,
SEQSUBPROD BIGINT)
 AS
declare variable icodemp integer;
declare variable scodfilial smallint;
declare variable icodmovprod integer;
declare variable nsldprc numeric(15,5);
declare variable ncustompmprc numeric(15,5);
declare variable nsldprcax numeric(15,5);
declare variable ncustompmprcax numeric(15,5);
declare variable nsldlc numeric(15,5);
declare variable ncustompmlc numeric(15,5);
declare variable nsldlcax numeric(15,5);
declare variable ncustompmlcax numeric(15,5);
declare variable ddtmovprodold date;
declare variable nprecomovprodold numeric(15,5);
declare variable nqtdmovprodold numeric(15,5);
declare variable icodemptmold integer;
declare variable scodfilialtmold smallint;
declare variable icodtipomovold integer;
declare variable calttm char(1);
declare variable ddtprc date;
declare variable ddtprcate date;
declare variable cestoqmovprod char(1);
begin
  /* Procedure de atualização da tabela eqmovprod */

  DDTPRCATE = NULL; /* Até onde deve ser processando o estoque */
 /* localiza movprod */

-- execute procedure sgdebugsp('antes da atualização...','no inicio');

  SELECT ICODEMP, SCODFILIAL, ICODMOVPROD
    FROM EQMOVPRODRETCODSP(:ICODEMPIV, :SCODFILIALIV, :ICODINVPROD, :ICODEMPCP,
      :SCODFILIALCP, :ICODCOMPRA, :SCODITCOMPRA, :ICODEMPVD, :SCODFILIALVD,
      :CTIPOVENDA, :ICODVENDA, :SCODITVENDA, :ICODEMPRM, :SCODFILIALRM,
      :ICODRMA, :SCODITRMA, :ICODEMPOP, :SCODFILIALOP, :ICODOP, :SSEQOP, :sseqentop, :seqsubprod)
    INTO :ICODEMP, :SCODFILIAL, :ICODMOVPROD;

--  traz valores antigos

  SELECT MP.CODEMPTM, MP.CODFILIALTM, MP.CODTIPOMOV, MP.DTMOVPROD,
       MP.PRECOMOVPROD, MP.QTDMOVPROD  FROM EQMOVPROD MP
     WHERE MP.CODEMP=:ICODEMP AND MP.CODFILIAL=:SCODFILIAL AND MP.CODMOVPROD=:ICODMOVPROD
     INTO :ICODEMPTMOLD, :SCODFILIALTMOLD, :ICODTIPOMOVOLD, :DDTMOVPRODOLD,
       :NPRECOMOVPRODOLD, :NQTDMOVPRODOLD;

   /* abaixo verificação se a alteração de tipo de movimento mexe no estoque */
   SELECT CALTTM FROM EQMOVPRODCKUTMSP(:ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV,
      :ICODEMPTMOLD, :SCODFILIALTMOLD, :ICODTIPOMOVOLD) INTO :CALTTM;

   /* verifica se há relevância para reprocessamento */
   if ( (DDTMOVPROD!=DDTMOVPRODOLD) OR (CALTTM='S') OR
        (NPRECOMOVPROD!=NPRECOMOVPRODOLD) OR (NQTDMOVPROD!=NQTDMOVPRODOLD) ) then
   begin

   -- execute procedure sgdebugsp('entrou no if','1');


      if ( DDTMOVPRODOLD IS NULL) then
         DDTMOVPRODOLD = DDTMOVPROD; /* garantir que a data antiga não e nula; */
      /* verifica qual data é menor para reprocessamento */
      if ( DDTMOVPROD<=DDTMOVPRODOLD ) then
      begin

     -- execute procedure sgdebugsp('entrou no if','2');

          DDTPRC = DDTMOVPROD;
          if (DDTMOVPROD=DDTMOVPRODOLD) then
             DDTPRCATE = null;
          else
             DDTPRCATE = DDTMOVPRODOLD;
/*          verifica lançamento anterior e traz custo e saldo */
          SELECT NSALDO, NCUSTOMPM, NSALDOAX, NCUSTOMPMAX
             FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
             :SCODFILIALPD, :ICODPROD, :DDTPRC, :NPRECOMOVPROD, :NPRECOMOVPROD,
             :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
             INTO :NSLDPRC, :NCUSTOMPMPRC, :NSLDPRCAX, :NCUSTOMPMPRCAX ;

          /* verifica se havera mudança de saldo */
          SELECT NSALDO, NCUSTOMPM, CESTOQMOVPROD
              FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
              :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMPRC, :NSLDPRC)
              INTO :NSLDPRC, :NCUSTOMPMPRC, :CESTOQMOVPROD;
          if (CMULTIALMOX='N') then
          begin
              NSLDPRCAX = NSLDPRC;
              NCUSTOMPMPRCAX = NCUSTOMPMPRC;
          end
          else
          begin
          SELECT NSALDO, NCUSTOMPM
              FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
              :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMPRCAX, :NSLDPRCAX)
              INTO :NSLDPRCAX, :NCUSTOMPMPRCAX;
          end
          NCUSTOMPMLC = NCUSTOMPMPRC;
          NSLDLC = NSLDPRC;
          NCUSTOMPMLCAX = NCUSTOMPMPRCAX;
          NSLDLCAX = NSLDPRCAX;
      end
      else
      begin
          DDTPRC = DDTMOVPRODOLD;
          DDTPRCATE = DDTMOVPROD;
          /* verifica lançamento anterior e traz custo e saldo */

       --   execute procedure sgdebugsp('entrou no else','3');

          SELECT NSALDO, NCUSTOMPM, NSALDOAX, NCUSTOMPMAX
             FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
             :SCODFILIALPD, :ICODPROD, :DDTPRC, 0, 0,
             :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
             INTO :NSLDPRC, :NCUSTOMPMPRC, :NSLDPRCAX, :NCUSTOMPMPRCAX ;

          /* verifica lançamento anterior e traz custo e saldo */
          SELECT NSALDO, NCUSTOMPM, NSALDOAX, NCUSTOMPMAX
             FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
             :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, :NCUSTOMPMLC, :NCUSTOMPMLCAX,
             :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
             INTO :NSLDLC, :NCUSTOMPMLC, :NSLDLCAX, :NCUSTOMPMLCAX ;

          /* verifica se havera mudança de saldo */
          SELECT NSALDO, NCUSTOMPM, CESTOQMOVPROD
              FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
              :ICODTIPOMOV, (:NQTDMOVPROD-:NQTDMOVPRODOLD), :NPRECOMOVPROD,
              :NCUSTOMPMLC, :NSLDLC)
              INTO :NSLDLC, :NCUSTOMPMLC, :CESTOQMOVPROD;
          if (CMULTIALMOX='N') then
          begin
             NSLDLCAX = NSLDLC;
             NCUSTOMPMLCAX = NCUSTOMPMLC;
          end
          else
          begin
              SELECT NSALDO, NCUSTOMPM
                  FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
                  :ICODTIPOMOV, (:NQTDMOVPROD-:NQTDMOVPRODOLD), :NPRECOMOVPROD,
                  :NCUSTOMPMLCAX, :NSLDLCAX)
                  INTO :NSLDLCAX, :NCUSTOMPMLCAX;
          end

      end

       SELECT NSLDPRC, NCUSTOMPMPRC, NSLDPRCAX, NCUSTOMPMPRCAX
        FROM EQMOVPRODPRCSLDSP( :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
          :SCODFILIALPD, :ICODPROD, :DDTPRC, :DDTPRCATE, :NSLDPRC,
          :NCUSTOMPMPRC, :NSLDPRCAX, :NCUSTOMPMPRCAX,
          :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
        INTO :NSLDPRC, :NCUSTOMPMPRC, :NSLDPRCAX, :NCUSTOMPMPRCAX;

      UPDATE EQMOVPROD SET DTMOVPROD=:DDTMOVPROD,
         QTDMOVPROD=:NQTDMOVPROD, PRECOMOVPROD=:NPRECOMOVPROD,
         SLDMOVPROD=:NSLDLC, CUSTOMPMMOVPROD=:NCUSTOMPMLC,
         SLDMOVPRODAX=:NSLDLCAX, CUSTOMPMMOVPRODAX=:NCUSTOMPMLCAX,
         FLAG=:CFLAG, CODEMPNT=:ICODEMPNT, CODFILIALNT=:SCODFILIALNT,
         CODNAT=:CCODNAT, DOCMOVPROD=:IDOCMOVPROD, CODEMPTM=:ICODEMPTM,
         CODFILIALTM=:SCODFILIALTM, CODTIPOMOV=:ICODTIPOMOV, CODEMPLE=:ICODEMPLE,
         CODFILIALLE=:SCODFILIALLE, CODLOTE=:CCODLOTE, ESTOQMOVPROD=:CESTOQMOVPROD ,
         CODEMPAX=:ICODEMPAX, CODFILIALAX=:SCODFILIALAX, CODALMOX=:ICODALMOX
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODMOVPROD=:ICODMOVPROD;
   end
   else /*  caso não tenha nenhuma alteração relevânte para processamento */

  --  execute procedure sgdebugsp('antes do reprocessamento','5SG');

      UPDATE EQMOVPROD SET FLAG=:CFLAG, CODEMPNT=:ICODEMPNT, CODFILIALNT=:SCODFILIALNT,
         CODNAT=:CCODNAT, DOCMOVPROD=:IDOCMOVPROD, CODEMPTM=:ICODEMPTM,
         CODFILIALTM=:SCODFILIALTM, CODTIPOMOV=:ICODTIPOMOV, CODEMPLE=:ICODEMPLE,
         CODFILIALLE=:SCODFILIALLE, CODLOTE=:CCODLOTE,
         CODEMPAX=:ICODEMPAX, CODFILIALAX=:SCODFILIALAX, CODALMOX=:ICODALMOX
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODMOVPROD=:ICODMOVPROD;
end
^

/* Alter (EQMOVPRODIUDSP) */
ALTER PROCEDURE EQMOVPRODIUDSP(CIUD CHAR,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE VARCHAR(20),
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPOP INTEGER,
SCODFILIALOP SMALLINT,
ICODOP INTEGER,
SSEQOP SMALLINT,
SSEQENTOP SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4),
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR,
NQTDMOVPROD NUMERIC(15,5),
NPRECOMOVPROD NUMERIC(15,5),
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
SEQSUBPROD SMALLINT)
 AS
declare variable cmultialmox char(1);
begin
  /* Procedure que controle INSERT, UPDATE E DELETE da tabela eqmovprod */

  /* Linha incluida para passar como parâmetro se é multi almoxarifado
      Como o objetivo de evitar I/O
  */
  SELECT CMULTIALMOX FROM SGRETMULTIALMOXSP(:ICODEMPPD) INTO :CMULTIALMOX;
  
  if (CIUD='I') then /* SE FOR INSERT */
     execute procedure EQMOVPRODISP( ICODEMPPD, SCODFILIALPD, ICODPROD,
         ICODEMPLE, SCODFILIALLE, CCODLOTE, ICODEMPTM, SCODFILIALTM, ICODTIPOMOV,
         ICODEMPIV, SCODFILIALIV, ICODINVPROD, ICODEMPCP, SCODFILIALCP, ICODCOMPRA,
         SCODITCOMPRA, ICODEMPVD, SCODFILIALVD, CTIPOVENDA, ICODVENDA, SCODITVENDA,
         ICODEMPRM, SCODFILIALRM, ICODRMA, SCODITRMA,
         ICODEMPOP, SCODFILIALOP, ICODOP, SSEQOP, sseqentop,
         ICODEMPNT, SCODFILIALNT,
         CCODNAT, DDTMOVPROD, IDOCMOVPROD, CFLAG, NQTDMOVPROD, NPRECOMOVPROD,
         ICODEMPAX, SCODFILIALAX, ICODALMOX, CMULTIALMOX, :seqsubprod);
  else if (CIUD='U') then
     execute procedure EQMOVPRODUSP( ICODEMPPD, SCODFILIALPD, ICODPROD,
         ICODEMPLE, SCODFILIALLE, CCODLOTE, ICODEMPTM, SCODFILIALTM, ICODTIPOMOV,
         ICODEMPIV, SCODFILIALIV, ICODINVPROD, ICODEMPCP, SCODFILIALCP, ICODCOMPRA,
         SCODITCOMPRA, ICODEMPVD, SCODFILIALVD, CTIPOVENDA, ICODVENDA, SCODITVENDA,
         ICODEMPRM, SCODFILIALRM, ICODRMA, SCODITRMA,
         ICODEMPOP, SCODFILIALOP, ICODOP, SSEQOP, sseqentop,
         ICODEMPNT, SCODFILIALNT,
         CCODNAT, DDTMOVPROD, IDOCMOVPROD, CFLAG, NQTDMOVPROD, NPRECOMOVPROD,
         ICODEMPAX, SCODFILIALAX, ICODALMOX, CMULTIALMOX,:seqsubprod);
  else if (CIUD='D') then
     execute procedure EQMOVPRODDSP( ICODEMPPD, SCODFILIALPD, ICODPROD, ICODEMPIV,
         SCODFILIALIV, ICODINVPROD, ICODEMPCP, SCODFILIALCP, ICODCOMPRA, SCODITCOMPRA,
         ICODEMPVD, SCODFILIALVD, CTIPOVENDA, ICODVENDA, SCODITVENDA,
         ICODEMPRM, SCODFILIALRM, ICODRMA, SCODITRMA,
         ICODEMPOP, SCODFILIALOP, ICODOP, SSEQOP, sseqentop,
         DDTMOVPROD, ICODEMPAX, SCODFILIALAX, ICODALMOX, CMULTIALMOX, :seqsubprod );
--  suspend;
end
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Sequencial de subproduto'
WHERE RDB$PROCEDURE_NAME = 'EQMOVPRODIUDSP' AND RDB$PARAMETER_NAME = 'SEQSUBPROD';

/* Alter (EQPRODUTOSP01) */
SET TERM ^ ;

ALTER PROCEDURE EQPRODUTOSP01(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(NSALDO NUMERIC(15,5),
NSALDOAX NUMERIC(15,5),
NCUSTOMPM NUMERIC(15,5),
NCUSTOPEPS NUMERIC(15,5),
NCUSTOMPMAX NUMERIC(15,5),
NCUSTOPEPSAX NUMERIC(15,5),
NCUSTOINFO NUMERIC(15,5),
NCUSTOUC NUMERIC(15,5))
 AS
declare variable ddtmovprod date;
declare variable ddtmovprodax date;
begin

    /* Procedure que retorna saldos e custos para a tela de cadastro de produtos */
    SELECT FIRST 1 MP.DTMOVPROD, MP.SLDMOVPROD , MP.CUSTOMPMMOVPROD
    FROM EQMOVPROD MP
    WHERE MP.CODEMPPD=:ICODEMP AND MP.CODFILIALPD=:SCODFILIAL AND MP.CODPROD=:ICODPROD
    ORDER BY MP.DTMOVPROD DESC, MP.CODMOVPROD DESC
    INTO :DDTMOVPROD, :NSALDO, :NCUSTOMPM;

    SELECT FIRST 1 MP.DTMOVPROD, MP.SLDMOVPRODAX, MP.CUSTOMPMMOVPRODAX
    FROM EQMOVPROD MP
    WHERE MP.CODEMPPD=:ICODEMP AND MP.CODFILIALPD=:SCODFILIAL AND MP.CODPROD=:ICODPROD
    ORDER BY MP.DTMOVPROD DESC, MP.CODMOVPROD DESC
    INTO :DDTMOVPRODAX, :NSALDOAX, :NCUSTOMPMAX;

    SELECT P.NCUSTOPEPS  FROM EQCALCPEPSSP(:ICODEMP, :SCODFILIAL,
    :ICODPROD, :NSALDO, :DDTMOVPROD, null, null, null ) P
    INTO :NCUSTOPEPS;

    SELECT P.NCUSTOPEPS  FROM EQCALCPEPSSP(:ICODEMP, :SCODFILIAL,
    :ICODPROD, :NSALDO, :DDTMOVPRODAX, :ICODEMPAX, :SCODFILIALAX,
    :ICODALMOX ) P
    INTO :NCUSTOPEPSAX;

    select p.custoinfoprod from eqproduto p
    where p.codemp=:icodemp and p.codfilial=:scodfilial and p.codprod=:icodprod
    into :ncustoinfo;

    select custounit from eqcustoprodsp(:icodemp, :scodfilial, :icodprod,
    cast('today' as date),'U',:icodempax, :scodfilialax, :icodalmox, 'N' )
    into :ncustouc;

    if(:ncustompm is null) then
    begin
        ncustompm = :ncustoinfo;
    end

    if(:ncustopeps is null) then
    begin
        ncustopeps = :ncustoinfo;
    end

    suspend;

end
^

/* Alter (EQREFPRODSP) */
ALTER PROCEDURE EQREFPRODSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
CODPROD INTEGER)
 RETURNS(REFPROD VARCHAR(20))
 AS
begin
  /* Procedure Text */
  SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=:CODPROD AND
     CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL INTO :REFPROD;
  suspend;
end
^

/* Alter (EQRELDEMANDASP) */
ALTER PROCEDURE EQRELDEMANDASP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
SCODFILIALPD SMALLINT,
DDTINI DATE,
DDTFIM DATE)
 RETURNS(CODMARCA CHAR(6),
CODGRUP CHAR(14),
CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(50),
DESCGRUP CHAR(50),
SLDINI NUMERIC(15,5),
VLRCOMPRAS NUMERIC(15,5),
VLRDEVENT NUMERIC(15,5),
VLROUTENT NUMERIC(15,5),
VLRVENDAS NUMERIC(15,5),
VLRDEVSAI NUMERIC(15,5),
VLROUTSAI NUMERIC(15,5),
SLDFIM NUMERIC(15,5))
 AS
begin
  /* Stored procedure de relatório de demanda */
  FOR SELECT P.CODMARCA, P.CODGRUP,P.CODPROD,
     P.REFPROD, P.DESCPROD,G.DESCGRUP,
     (SELECT FIRST 1 SLDMOVPROD FROM EQMOVPROD MP
      WHERE MP.CODEMP=:ICODEMP AND MP.CODFILIAL=:SCODFILIAL AND
         MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
         MP.CODPROD=P.CODPROD AND MP.DTMOVPROD<:DDTINI
         ORDER BY MP.DTMOVPROD DESC, MP.CODMOVPROD DESC ) SLDINI,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV IN ('CP','PC') AND TM.ESTIPOMOV = 'E') VLRCOMPRAS,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV ='DV' AND TM.ESTIPOMOV = 'E') VLRDEVENT,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP , EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV NOT IN ('CP','PC','DV') AND TM.ESTIPOMOV IN ('E','I')) VLROUTENT,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV IN ('VD','PV') AND TM.ESTIPOMOV = 'S') VLRVENDAS,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV ='DV' AND TM.ESTIPOMOV = 'S') VLRDEVSAI,
     (SELECT SUM(MP.QTDMOVPROD)
        FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV NOT IN ('VD','PV','DV') AND TM.ESTIPOMOV = 'S') VLROUTSAI
     FROM EQPRODUTO P, EQGRUPO G
         WHERE G.CODGRUP=P.CODGRUP AND G.CODEMP=P.CODEMPGP AND
           G.CODFILIAL=P.CODFILIALGP AND P.CODEMP=:ICODEMP AND
           P.CODFILIAL=:SCODFILIALPD AND P.ATIVOPROD='S'
     INTO :CODMARCA, :CODGRUP, :CODPROD, :REFPROD, :DESCPROD, :DESCGRUP,
        :SLDINI, :VLRCOMPRAS, :VLRDEVENT,  :VLROUTENT,
         :VLRVENDAS, :VLRDEVSAI, :VLROUTSAI DO
     BEGIN
        if (SLDINI IS NULL) then
           SLDINI = 0;
        if (VLROUTSAI IS NULL) then
           VLROUTSAI = 0;
        if (VLROUTENT IS NULL) then
           VLROUTENT = 0;
        if (VLRDEVSAI IS NULL) then
           VLRDEVSAI = 0;
        if (VLRDEVENT IS NULL) then
           VLRDEVENT = 0;
        if (VLRCOMPRAS IS NULL) then
           VLRCOMPRAS = 0;
        if (VLRVENDAS IS NULL) then
           VLRVENDAS = 0;
        SLDFIM = SLDINI + VLRCOMPRAS + VLRDEVENT + VLROUTENT -
           VLRVENDAS - VLRDEVSAI - VLROUTSAI;
        suspend;
     END
end
^

/* Alter (EQRELGIROPROD) */
ALTER PROCEDURE EQRELGIROPROD(CODEMP INTEGER,
CODFILIAL INTEGER,
DATA_BASE DATE)
 RETURNS(CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
REFPROD VARCHAR(20),
CODFABPROD CHAR(13),
CODBARPROD CHAR(13),
DESCPROD VARCHAR(80),
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
DOCCOMPRA INTEGER,
IDENTCONTAINER CHAR(20),
CODITCOMPRA SMALLINT,
DTULTCP DATE,
SALDOANT NUMERIC(15,5),
QTDULTCP NUMERIC(15,5),
QTDVENDIDA NUMERIC(15,5),
SALDOATU NUMERIC(15,5),
CODEMPGP INTEGER,
CODFILIALGP INTEGER,
CODGRUP CHAR(14))
 AS
begin

    -- Buscando produtos ativos
    for
        select pd.codemp, pd.codfilial, pd.codprod, pd.descprod, refprod, codfabprod, codbarprod,
        codempgp, codfilialgp, codgrup
        from eqproduto pd
        where pd.ativoprod='S' and pd.codemp=:codemp and pd.codfilial=:codfilial
        into codemppd, codfilialpd, codprod, descprod, refprod, codfabprod, codbarprod,
        codempgp, codfilialgp, codgrup
    do
    begin

        -- Buscando a ultima compra do produto
        codempcp = null;
        codfilialcp = null;
        codcompra = null;
        coditcompra = null;
        dtultcp = null;
        qtdultcp = 0;
        doccompra = null;
        identcontainer = null;

        select first 1 itc.codemp, itc.codfilial, itc.codcompra, itc.coditcompra, cp.dtentcompra, itc.qtditcompra, cp.doccompra, cp.identcontainer
        from cpcompra cp, cpitcompra itc
        where
        itc.codemp=cp.codemp and itc.codfilial=cp.codfilial and itc.codcompra=cp.codcompra and
        itc.codemppd=:codemppd and itc.codfilialpd=:codfilialpd and itc.codprod=:codprod and
        cp.dtentcompra < :data_base
        order by cp.dtentcompra desc
        into codempcp, codfilialcp, codcompra, coditcompra, dtultcp, qtdultcp, doccompra, identcontainer;

        -- Buscando a ultima compra do produto

        qtdvendida = 0;

        select coalesce(sum(itv.qtditvenda),0)
        from vdvenda vd, vditvenda itv, eqtipomov tm
        where
        itv.codemp=vd.codemp and itv.codfilial=vd.codfilial and itv.codvenda=vd.codvenda and itv.tipovenda=vd.tipovenda and
        itv.codemppd=:codemppd and itv.codfilialpd=:codfilialpd and itv.codprod=:codprod and
        vd.dtsaidavenda between :data_base - 30 and :data_base and
        tm.codemp=vd.codemptm and tm.codfilial=vd.codfilialtm and tm.codtipomov=vd.codtipomov and
        tm.estoqtipomov='S'
        into :qtdvendida;

        -- Buscando saldo anterior

        saldoant = 0;

        select first 1 mp.sldmovprod
        from eqmovprod mp
        where mp.codemp=:codemp and mp.codfilial=:codfilial and mp.codemppd=:codemppd and mp.codfilialpd=:codfilialpd
        and mp.codprod=:codprod and mp.dtmovprod<:dtultcp
        order by mp.dtmovprod desc, mp.codmovprod desc
        into saldoant;

        -- Buscando saldo atual
        saldoatu = 0;

        select first 1 mp.sldmovprod
        from eqmovprod mp
        where mp.codemp=:codemp and mp.codfilial=:codfilial and mp.codemppd=:codemppd and mp.codfilialpd=:codfilialpd
        and mp.codprod=:codprod and mp.dtmovprod<=:data_base
        order by mp.dtmovprod desc, mp.codmovprod desc
        into saldoatu;

        suspend;

    end

end
^

/* Alter (EQRELINVPRODSP) */
ALTER PROCEDURE EQRELINVPRODSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
CTIPOCUSTO CHAR,
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14),
DDTESTOQ DATE,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(100),
CODGRUP CHAR(14),
SALDO NUMERIC(15,5),
CUSTO NUMERIC(15,5),
VLRESTOQ NUMERIC(15,5))
 AS
declare variable cmultialmox char(1);
declare variable ncustompm numeric(15,5);
begin
  /* Relatório de estoque */
  SELECT CMULTIALMOX FROM SGRETMULTIALMOXSP(:ICODEMP) INTO :CMULTIALMOX;

  if (CCODGRUP IS NOT NULL) then
  begin
     CCODGRUP = rtrim(CCODGRUP);
     if (strlen(CCODGRUP)<14) then
        CCODGRUP = CCODGRUP || '%';
  end
  FOR SELECT P.CODPROD, P.REFPROD, P.DESCPROD, P.CODGRUP
    FROM EQPRODUTO P
    WHERE P.CODEMP=:ICODEMP AND P.CODFILIAL=:SCODFILIAL AND
          ( ( :CCODGRUP IS NULL ) OR
            (P.CODGRUP LIKE :CCODGRUP AND P.CODEMPGP=:ICODEMPGP AND
             P.CODFILIALGP=:SCODFILIALGP) )
    INTO :CODPROD, :REFPROD, :DESCPROD, :CODGRUP DO
  BEGIN
     SELECT NSALDO, NCUSTOMPM FROM EQMOVPRODSLDSP(null, null, null, :ICODEMP,
        :SCODFILIAL, :CODPROD, :DDTESTOQ, 0, 0,
        :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CMULTIALMOX)
       INTO :SALDO, :NCUSTOMPM;
     if (CTIPOCUSTO='M') then
        CUSTO = NCUSTOMPM;
     else
        SELECT NCUSTOPEPS FROM EQCALCPEPSSP(:ICODEMP, :SCODFILIAL, :CODPROD,
          :SALDO, :DDTESTOQ, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX)
        INTO :CUSTO;
     VLRESTOQ = CUSTO * SALDO;
     SUSPEND;
  END
end
^

/* Alter (EQRELPEPSSP) */
ALTER PROCEDURE EQRELPEPSSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DTESTOQ DATE,
ICODEMPMC INTEGER,
SCODFILIALMC SMALLINT,
CCODMARCA CHAR(6),
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP VARCHAR(14),
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(100),
SLDPROD NUMERIC(15,5),
CUSTOUNIT NUMERIC(15,5),
CUSTOTOT NUMERIC(15,5),
CODBARPROD CHAR(13),
CODFABPROD CHAR(15),
ATIVOPROD CHAR)
 AS
begin
  /* Procedure Text */
  IF (ICODEMPGP IS NOT NULL) THEN
  BEGIN
    IF (STRLEN(RTRIM(CCODGRUP))<14) THEN
       CCODGRUP = RTRIM(CCODGRUP)||'%';
  END
  IF (CTIPOCUSTO IS NULL) then
     CTIPOCUSTO = 'P';

  FOR SELECT P.CODPROD,P.REFPROD,P.DESCPROD, P.CODBARPROD, P.CODFABPROD, P.ATIVOPROD
   FROM EQPRODUTO P
   WHERE P.CODEMP = :ICODEMP AND P.CODFILIAL = :SCODFILIAL AND
   ( (:ICODEMPMC IS NULL) OR (P.CODEMPMC=:ICODEMPMC AND P.CODFILIALMC=:SCODFILIALMC AND
      P.CODMARCA=:CCODMARCA) ) AND
   ((:ICODEMPGP IS NULL) OR (P.CODEMPGP=:ICODEMPGP AND P.CODFILIALGP=:SCODFILIALGP AND
      P.CODGRUP LIKE :CCODGRUP) )
      ORDER BY P.CODPROD
   INTO :CODPROD, :REFPROD, :DESCPROD, :CODBARPROD, :CODFABPROD, :ATIVOPROD  DO
  BEGIN
     SELECT SLDPROD, CUSTOUNIT, CUSTOTOT FROM EQCUSTOPRODSP(:ICODEMP,
        :SCODFILIAL, :CODPROD, :DTESTOQ, :CTIPOCUSTO, :ICODEMPAX,
        :SCODFILIALAX, :ICODALMOX, 'S')
       INTO :SLDPROD, :CUSTOUNIT, :CUSTOTOT;
     SUSPEND;
  END
end
^

/* Alter (FNADICITRECEBERSP01) */
ALTER PROCEDURE FNADICITRECEBERSP01(CALTVLR CHAR,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRDESCITREC NUMERIC(15,5),
NVLRMULTAITREC NUMERIC(15,5),
NVLRJUROSITREC NUMERIC(15,5),
NVLRPARCITREC NUMERIC(15,5),
NVLRPAGOITREC NUMERIC(15,5),
DDTITREC DATE,
DDTCOMPITREC DATE,
DDTVENCITREC DATE,
CSTATUSITREC CHAR(2),
CFLAG CHAR,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3),
ICODEMPTC INTEGER,
SCODFILIALTC SMALLINT,
ICODTIPOCOB INTEGER,
ICODEMPCB INTEGER,
SCODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
NVLRCOMIITREC NUMERIC(15,5),
OBSITREC VARCHAR(250),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC SMALLINT,
CODCC CHAR(19),
VLRBASECOMIS NUMERIC(15,5))
 AS
declare variable inparcitrecold integer;
declare variable doclancaitrec char(10);
begin
   SELECT ir.doclancaitrec,ir.NPARCITREC FROM FNITRECEBER IR WHERE IR.CODEMP=:ICODEMP AND
     IR.CODFILIAL=:SCODFILIAL AND IR.CODREC=:ICODREC AND
     IR.NPARCITREC=:INPARCITREC INTO :doclancaitrec, :INPARCITRECOLD;

   IF (INPARCITRECOLD IS NULL) THEN
     /* Faz inserção na tabela de parcelas do contas a receber */
      INSERT INTO FNITRECEBER(CODEMP,CODFILIAL,CODREC,NPARCITREC,VLRDESCITREC,VLRMULTAITREC,
              VLRJUROSITREC,VLRPARCITREC,VLRPAGOITREC,DTITREC, DTCOMPITREC, DTVENCITREC,
              STATUSITREC,FLAG,CODEMPBO,CODFILIALBO,CODBANCO,
              CODEMPTC, CODFILIALTC, CODTIPOCOB,
              CODEMPCB, CODFILIALCB, CODCARTCOB, VLRCOMIITREC, OBSITREC, CODEMPCA,CODFILIALCA,NUMCONTA,dtprevitrec,
              codemppn, codfilialpn, codplan, codempcc, codfilialcc, anocc, codcc, vlrbasecomis, doclancaitrec)
              VALUES
             (:ICODEMP,:SCODFILIAL,:ICODREC,:INPARCITREC,:NVLRDESCITREC,:NVLRMULTAITREC,
             :NVLRJUROSITREC,:NVLRPARCITREC,:NVLRPAGOITREC, :DDTITREC, :DDTCOMPITREC, :DDTVENCITREC,
             :CSTATUSITREC,:CFLAG,:ICODEMPBO,:SCODFILIALBO,:CCODBANCO,
             :ICODEMPTC, :SCODFILIALTC, :ICODTIPOCOB,
             :ICODEMPCB, :SCODFILIALCB, :CODCARTCOB, :NVLRCOMIITREC, :OBSITREC, :codempca, :codfilialca, :numconta,:ddtvencitrec,
             :codemppn, :codfilialpn, :codplan, :codempcc, :codfilialcc, :anocc, :codcc,:vlrbasecomis,:doclancaitrec );
   ELSE
   BEGIN
       SELECT VLRDESCITREC, VLRMULTAITREC, VLRJUROSITREC, VLRPAGOITREC, STATUSITREC
       FROM FNITRECEBER
       WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODREC=:ICODREC AND
            NPARCITREC=:INPARCITREC
       INTO :NVLRDESCITREC, :NVLRMULTAITREC, :NVLRJUROSITREC, :NVLRPAGOITREC, :CSTATUSITREC;

       IF (CALTVLR='S') THEN /* Flag que indica se é para mudar os valores do contas a receber */
       BEGIN

           UPDATE FNITRECEBER SET ALTUSUITREC='N',VLRDESCITREC=:NVLRDESCITREC,VLRMULTAITREC=:NVLRMULTAITREC,
                  VLRJUROSITREC=:NVLRJUROSITREC,VLRPARCITREC=:NVLRPARCITREC,
                  VLRPAGOITREC=:NVLRPAGOITREC,DTITREC=:DDTITREC,STATUSITREC=:CSTATUSITREC,
                  FLAG=:CFLAG,CODEMPBO=:ICODEMPBO,CODFILIALBO=:SCODFILIALBO,
                  CODBANCO=:CCODBANCO,CODEMPTC=:ICODEMPTC, CODFILIALTC=:SCODFILIALTC, 
                  CODTIPOCOB=:ICODTIPOCOB,
                  CODEMPCB=:ICODEMPCB, CODFILIALCB=:SCODFILIALCB, CODCARTCOB=:CODCARTCOB,
                  VLRCOMIITREC=:NVLRCOMIITREC, CODEMPCA=:codempca, codfilialca=:codfilialca, numconta=:numconta,
                  vlrbasecomis=:vlrbasecomis, obsitrec=:obsitrec
            WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODREC=:ICODREC AND
                NPARCITREC=:INPARCITREC;
       END
       ELSE
           UPDATE FNITRECEBER SET ALTUSUITREC='N',DTITREC=:DDTITREC,
                  STATUSITREC=:CSTATUSITREC, FLAG=:CFLAG,CODEMPBO=:ICODEMPBO,
                  CODFILIALBO=:SCODFILIALBO,CODBANCO=:CCODBANCO,CODEMPTC=:ICODEMPTC,
                  CODFILIALTC=:SCODFILIALTC, CODTIPOCOB=:ICODTIPOCOB,
                  CODEMPCB=:ICODEMPCB, CODFILIALCB=:SCODFILIALCB, CODCARTCOB=:CODCARTCOB,
                  VLRCOMIITREC=:NVLRCOMIITREC, obsitrec=:obsitrec
            WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODREC=:ICODREC AND
                NPARCITREC=:INPARCITREC;
  END
 -- suspend;
end
^

/* Alter (FNADICLANCASP01) */
ALTER PROCEDURE FNADICLANCASP01(ICODREC INTEGER,
INPARCITREC INTEGER,
PDVITREC CHAR,
SNUMCONTA CHAR(10),
ICODEMPCA INTEGER,
ICODFILIALCA INTEGER,
ICODCLI INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL INTEGER,
SCODPLAN CHAR(13),
ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
IANOCC INTEGER,
SCODCC CHAR(19),
ICODEMPCC INTEGER,
ICODFILIALCC INTEGER,
DDTCOMPITREC DATE,
DDTPAGOITREC DATE,
SDOCLANCAITREC CHAR(10),
SOBSITREC CHAR(250),
DVLRPAGOITREC NUMERIC(15,5),
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DVLRPAGOJUROS NUMERIC(15,5),
DVLRDESC NUMERIC(15,5))
 AS
declare variable icodlanca integer;
declare variable scodplanconta char(13);
declare variable icodemppconta integer;
declare variable icodfilialpconta integer;
declare variable cflag char(1);
declare variable ifiliallanca integer;
declare variable tipolanca char(1);
declare variable codempjr integer;
declare variable codfilialjr smallint;
declare variable codplanjr char(13);
declare variable codempdc integer;
declare variable codfilialdc smallint;
declare variable codplandc char(13);
declare variable codsublanca smallint = 1;
BEGIN
    SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNLANCA') INTO IFILIALLANCA;

    SELECT CODPLAN,CODEMPPN,CODFILIALPN FROM FNCONTA WHERE NUMCONTA = :SNUMCONTA
        AND CODEMP=:ICODEMPCA AND CODFILIAL=:ICODFILIALCA INTO :sCodPlanConta,:iCodEmpPConta,:iCodFilialPConta;

    SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALLANCA,'LA') INTO ICODLANCA;

    SELECT FLAG FROM FNRECEBER WHERE CODREC=:ICODREC
        AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :cFlag;

    SELECT CODEMPJR,CODFILIALJR,CODPLANJR,CODEMPDC,CODFILIALDC,CODPLANDC FROM SGPREFERE1
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
        INTO :CODEMPJR,:CODFILIALJR,:CODPLANJR,:CODEMPDC,:CODFILIALDC,:CODPLANDC;


    IF (ICODCLI IS NULL) THEN
        TIPOLANCA = 'A';
    ELSE
        TIPOLANCA = 'C';

    if ( (DVLRPAGOJUROS IS NULL) OR (:CODPLANJR IS NULL)  ) then
        DVLRPAGOJUROS = 0;
    else
        DVLRPAGOITREC = DVLRPAGOITREC - DVLRPAGOJUROS;

    if (DVLRDESC IS NULL  OR (:CODPLANDC IS NULL) ) then
        DVLRDESC = 0;
    else
        DVLRPAGOITREC = DVLRPAGOITREC + DVLRDESC;


    INSERT INTO FNLANCA (TIPOLANCA,CODEMP,CODFILIAL,CODLANCA,CODEMPRC,CODFILIALRC,CODREC,NPARCITREC,CODEMPPN,CODFILIALPN,
                         CODPLAN, DTCOMPLANCA, DATALANCA, DOCLANCA,HISTBLANCA,DTPREVLANCA,VLRLANCA,FLAG,CODEMPCL,CODFILIALCL,CODCLI,PDVITREC)
        VALUES (:TIPOLANCA,:ICODEMP,:IFILIALLANCA,:iCodLanca,:ICODEMP,:ICODFILIAL,:ICODREC,:iNParcItRec,:iCodEmpPConta,:iCodFilialPConta,
                :sCodPlanConta,:dDtCompItRec, :dDtPagoItRec,:sDocLancaItRec,:sObsItRec,:dDtPagoItRec,0,:cFlag,:ICODEMPCL,:ICODFILIALCL,:ICODCLI,:PDVITREC
        );

    INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPCL,CODFILIALCL,CODCLI,CODEMPPN,CODFILIALPN,CODPLAN,CODEMPCC,
                            CODFILIALCC,ANOCC,CODCC,ORIGSUBLANCA, DTCOMPSUBLANCA, DATASUBLANCA,DTPREVSUBLANCA,VLRSUBLANCA,FLAG)
        VALUES (:ICODEMP,:IFILIALLANCA,:iCodLanca,:CODSUBLANCA,:ICODEMPCL,:ICODFILIALCL,:ICODCLI,:ICODEMPPN,:ICODFILIALPN,:SCODPLAN,:ICODEMPCC,
                :ICODFILIALCC,:IANOCC,:SCODCC,'S',:dDtCompItRec,:dDtPagoItRec,:dDtPagoItRec,:dVlrPagoItRec*-1,:cFlag
        );

    -- Lançamento dos juros em conta distinta.

    IF(DVLRPAGOJUROS > 0) THEN
    BEGIN

        CODSUBLANCA = CODSUBLANCA + 1;

        INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPCL,CODFILIALCL,CODCLI,CODEMPPN,CODFILIALPN,CODPLAN,CODEMPCC,
                            CODFILIALCC,ANOCC,CODCC,ORIGSUBLANCA,DTCOMPSUBLANCA,DATASUBLANCA,DTPREVSUBLANCA,VLRSUBLANCA,FLAG)
        VALUES (:ICODEMP,:IFILIALLANCA,:iCodLanca,:CODSUBLANCA,:ICODEMPCL,:ICODFILIALCL,:ICODCLI,:CODEMPJR,:CODFILIALJR,:CODPLANJR,:ICODEMPCC,
                :ICODFILIALCC,:IANOCC,:SCODCC,'S',:dDtCompItRec,:dDtPagoItRec,:dDtPagoItRec,:DVLRPAGOJUROS*-1,:cFlag
        );

    END

    -- Lançamento do desconto em conta distinta.

    IF(DVLRDESC > 0) THEN
    BEGIN

        CODSUBLANCA = CODSUBLANCA + 1;

        INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPCL,CODFILIALCL,CODCLI,CODEMPPN,CODFILIALPN,CODPLAN,CODEMPCC,
                            CODFILIALCC,ANOCC,CODCC,ORIGSUBLANCA,DTCOMPSUBLANCA,DATASUBLANCA,DTPREVSUBLANCA,VLRSUBLANCA,FLAG)
        VALUES (:ICODEMP,:IFILIALLANCA,:iCodLanca,:CODSUBLANCA,:ICODEMPCL,:ICODFILIALCL,:ICODCLI,:CODEMPDC,:CODFILIALDC,:CODPLANDC,:ICODEMPCC,
                :ICODFILIALCC,:IANOCC,:SCODCC,'S',:dDtCompItRec,:dDtPagoItRec,:dDtPagoItRec,:DVLRDESC,:cFlag
        );

    END


END
^

/* Alter (FNADICLANCASP02) */
ALTER PROCEDURE FNADICLANCASP02(ICODPAG INTEGER,
INPARCPAG INTEGER,
SNUMCONTA CHAR(10),
ICODEMPCA INTEGER,
ICODFILIALCA INTEGER,
ICODFOR INTEGER,
ICODEMPFR INTEGER,
ICODFILIALFR INTEGER,
SCODPLAN CHAR(13),
ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
IANOCC INTEGER,
SCODCC CHAR(19),
ICODEMPCC INTEGER,
ICODFILIALCC INTEGER,
DDTCOMPITPAG DATE,
DDTPAGOITPAG DATE,
SDOCLANCAITPAG CHAR(10),
SOBSITPAG CHAR(250),
DVLRPAGOITPAG NUMERIC(15,5),
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DVLRJUROSPAG NUMERIC(15,5),
DVLRDESC NUMERIC(15,5))
 AS
declare variable icodlanca integer;
declare variable scodplanconta char(13);
declare variable icodemppconta integer;
declare variable icodfilialpconta integer;
declare variable cflag char(1);
declare variable ifiliallanca integer;
declare variable tipolanca char(1);
declare variable codempjp integer;
declare variable codfilialjp smallint;
declare variable codplanjp char(13);
declare variable codempdr integer;
declare variable codfilialdr smallint;
declare variable codplandr char(13);
declare variable codsublanca smallint = 1;
BEGIN

    SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNLANCA')
    INTO IFILIALLANCA;

    SELECT CODPLAN,CODEMP,CODFILIAL FROM FNCONTA
    WHERE NUMCONTA=:sNumConta AND CODEMP=:ICODEMPCA AND CODFILIAL=:ICODFILIALCA
    INTO :sCodPlanConta,:iCodEmpPConta,:iCodFilialPConta;

    SELECT ISEQ FROM SPGERANUM(:iCODEMP,:IFILIALLANCA,'LA')
    INTO :iCodLanca;

    SELECT FLAG FROM FNPAGAR
    WHERE CODPAG=:iCodPag AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
    INTO :cFlag;

    SELECT CODEMPJP,CODFILIALJP,CODPLANJP,CODEMPDR,CODFILIALDR,CODPLANDR
    FROM SGPREFERE1
    WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
    INTO :CODEMPJP,:CODFILIALJP,:CODPLANJP,:CODEMPDR,:CODFILIALDR,:CODPLANDR;

    IF (ICODFOR IS NULL) THEN
        TIPOLANCA = 'A';
      ELSE
        TIPOLANCA = 'F';

    if ( (DVLRJUROSPAG IS NULL) OR (:CODPLANJP IS NULL)  ) then
        DVLRJUROSPAG = 0;
    else
        DVLRPAGOITPAG = DVLRPAGOITPAG - DVLRJUROSPAG;

    if (DVLRDESC IS NULL  OR (:CODPLANDR IS NULL) ) then
        DVLRDESC = 0;
    else
        DVLRPAGOITPAG = DVLRPAGOITPAG + DVLRDESC;

    INSERT INTO FNLANCA (TIPOLANCA,CODEMP,CODFILIAL,CODLANCA,CODEMPPG,CODFILIALPG,CODPAG,
                         NPARCPAG,CODEMPPN,CODFILIALPN,CODPLAN,DTCOMPLANCA,DATALANCA,DOCLANCA,
                         HISTBLANCA,DTPREVLANCA,VLRLANCA,FLAG, CODEMPFR, CODFILIALFR, CODFOR)
         VALUES (:TIPOLANCA,:ICODEMP,:IFILIALLANCA,:iCodLanca,:ICODEMP,:ICODFILIAL,:iCodPag,
                 :iNParcPag,:iCodEmpPConta,:iCodFilialPConta,:sCodPlanConta, :dDtCompItPag, :dDtPagoItPag,:sDocLancaItPag,
                 :sObsItPag,:dDtPagoItPag,0,:cFlag, :ICODEMPFR, :ICODFILIALFR, :ICODFOR
         );

    INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPFR,CODFILIALFR,CODFOR,CODEMPPN,CODFILIALPN,
        CODPLAN,CODEMPCC,CODFILIALCC,ANOCC,CODCC,ORIGSUBLANCA,DTCOMPSUBLANCA,DATASUBLANCA,DTPREVSUBLANCA,VLRSUBLANCA,FLAG)
        VALUES (:ICODEMP,:IFILIALLANCA,:iCodLanca,:CODSUBLANCA,:ICODEMPFR,:ICODFILIALFR,:ICODFOR,:ICODEMPPN,:ICODFILIALPN,
        :sCodplan,:ICODEMPCC,:ICODFILIALCC,:IANOCC,:SCODCC,'E',:dDtCompItPag,:dDtPagoItPag,:dDtPagoItPag,:dVlrPagoItPag,:cFlag);

    -- Lançamento dos juros em conta distinta.

    IF(DVLRJUROSPAG >0) THEN
    BEGIN

        CODSUBLANCA = CODSUBLANCA + 1;

        INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPFR,CODFILIALFR,CODFOR,CODEMPPN,CODFILIALPN,CODPLAN,CODEMPCC,CODFILIALCC,ANOCC,CODCC,ORIGSUBLANCA,DTCOMPSUBLANCA,DATASUBLANCA,DTPREVSUBLANCA,VLRSUBLANCA,FLAG)
            VALUES (:ICODEMP,:IFILIALLANCA,:iCodLanca,:CODSUBLANCA,:ICODEMPFR,:ICODFILIALFR,:ICODFOR,:CODEMPJP,:CODFILIALJP,:CODPLANJP,:ICODEMPCC,:ICODFILIALCC,:IANOCC,:SCODCC,'E',:dDtCompItPag,:dDtPagoItPag,:dDtPagoItPag,:DVLRJUROSPAG,:cFlag);

    END

    -- Lançamento de desconto em conta distinta.

    IF(DVLRDESC >0) THEN
    BEGIN

        CODSUBLANCA = CODSUBLANCA + 1;

        INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPFR,CODFILIALFR,CODFOR,CODEMPPN,CODFILIALPN,CODPLAN,CODEMPCC,CODFILIALCC,ANOCC,CODCC,ORIGSUBLANCA,DTCOMPSUBLANCA,DATASUBLANCA,DTPREVSUBLANCA,VLRSUBLANCA,FLAG)
            VALUES (:ICODEMP,:IFILIALLANCA,:iCodLanca,:CODSUBLANCA,:ICODEMPFR,:ICODFILIALFR,:ICODFOR,:CODEMPDR,:CODFILIALDR,:CODPLANDR,:ICODEMPCC,:ICODFILIALCC,:IANOCC,:SCODCC,'E',:dDtCompItPag,:dDtPagoItPag,:dDtPagoItPag,:DVLRDESC*-1,:cFlag);

    END

END
^

/* Alter (FNADICPAGARSP01) */
ALTER PROCEDURE FNADICPAGARSP01(CODCOMPRA INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
ICODEMPFR INTEGER,
ICODFILIALFR SMALLINT,
CODFOR INTEGER,
VLRLIQCOMPRA NUMERIC(18,2),
DTSAIDACOMPRA DATE,
DTCOMPCOMPRA DATE,
DOCCOMPRA INTEGER,
ICODEMPBO INTEGER,
ICODFILIALBO SMALLINT,
CODBANCO CHAR(3),
FLAG CHAR,
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
CODEMPTC INTEGER,
CODFILIALTC SMALLINT,
CODTIPOCOB INTEGER,
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
NUMCONTA CHAR(10),
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC SMALLINT,
CODCC CHAR(19),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13))
 AS
declare variable icodpagar integer;
declare variable ifilialpagar integer;
declare variable numparcs integer;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNPAGAR') INTO IFILIALPAGAR;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALPAGAR,'PA') INTO ICODPAGAR;
  SELECT COALESCE(PARCPLANOPAG,0) FROM FNPLANOPAG WHERE CODEMP=:icodemppg AND CODFILIAL=:icodfilialpg AND codplanopag=:codplanopag
  INTO NUMPARCS;

  IF(numparcs>0) THEN
  BEGIN
      INSERT INTO FNPAGAR (CODEMP,CODFILIAL,CODPAG,CODPLANOPAG,CODEMPPG,CODFILIALPG,CODFOR,CODEMPFR,
                          CODFILIALFR,CODCOMPRA,CODEMPCP,CODFILIALCP,VLRPAG,
                          VLRDESCPAG,VLRMULTAPAG,VLRJUROSPAG,VLRPARCPAG,VLRPAGOPAG,
                          VLRAPAGPAG,DATAPAG, DTCOMPPAG, STATUSPAG,DOCPAG,CODBANCO,CODEMPBO,CODFILIALBO,FLAG,
                          CODEMPTC, CODFILIALTC, CODTIPOCOB,
                          codempca, codfilialca,  numconta, codempcc, codfilialcc, anocc, codcc, codemppn, codfilialpn, codplan)
                          VALUES (
                                 :ICODEMP,:IFILIALPAGAR,:ICODPAGAR,:CodPlanoPag,:ICODEMPPG,:ICODFILIALPG,:CodFor,:ICODEMPFR,
                                 :ICODFILIALFR,:CodCompra,:ICODEMP,:ICODFILIAL,:VlrLiqCompra,
                                 0,0,0,:VlrLiqCompra,0,:VlrLiqCompra,:dtSaidaCompra, :DTCOMPCOMPRA, 'P1',:DocCompra,
                                 :CodBanco,:ICODEMPBO,:ICODFILIALBO,:FLAG,
                                 :CODEMPTC, :CODFILIALTC, :CODTIPOCOB,
                                 :codempct, :codfilialct, :numconta, :codempcc, :codfilialcc, :anocc, :codcc, :codemppn, :codfilialpn, :codplan
                          );
   END
END
^

/* Alter (FNADICRECEBERSP01) */
ALTER PROCEDURE FNADICRECEBERSP01(CTIPOVENDA CHAR,
ICODVENDA INTEGER,
ICODEMPTC INTEGER,
ICODFILIALTC INTEGER,
CODTIPOCOB INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL SMALLINT,
CODCLI INTEGER,
ICODEMPVD INTEGER,
ICODFILIALVD SMALLINT,
CODVEND INTEGER,
VLRLIQVENDA NUMERIC(15,5),
DTVENDA DATE,
DTCOMP DATE,
VLRCOMISVENDA NUMERIC(15,5),
DOCVENDA INTEGER,
ICODEMPBO INTEGER,
ICODFILIALBO SMALLINT,
CODBANCO CHAR(3),
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
CODEMPCB INTEGER,
CODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
FLAG CHAR,
OBSREC VARCHAR(250),
VLRBASECOMIS NUMERIC(15,5),
VLRRETENSAOISS NUMERIC(15,5))
 AS
declare variable icodrec integer;
declare variable scodfilialrc smallint;
declare variable iparcplanopag integer;
BEGIN
  SELECT R.CODREC,R.CODFILIAL FROM FNRECEBER R
     WHERE R.CODEMPVA=:ICODEMP AND R.CODFILIALVA=:ICODFILIAL AND
       R.TIPOVENDA=:CTIPOVENDA AND R.CODVENDA=:ICODVENDA
     INTO :ICODREC,:SCODFILIALRC;
  SELECT PARCPLANOPAG FROM FNPLANOPAG WHERE CODEMP=:ICODEMPPG AND
     CODFILIAL=:ICODFILIALPG AND CODPLANOPAG=:CODPLANOPAG
     INTO :IPARCPLANOPAG;

  IF ( (ICODREC IS NULL) AND (IPARCPLANOPAG>0) ) THEN
  BEGIN
     SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNRECEBER') INTO SCODFILIALRC;
     SELECT ISEQ FROM SPGERANUM(:ICODEMP,:SCODFILIALRC,'RC') INTO :ICODREC;

     -- Caso haja retensão de ISS deve
     if(coalesce(:vlrretensaoiss,0)>0) then
     begin
        vlrliqvenda = vlrliqvenda - vlrretensaoiss;
     end

     INSERT INTO FNRECEBER (CODEMP,CODFILIAL,CODREC, CODTIPOCOB, CODEMPTC, CODFILIALTC,
              CODPLANOPAG,CODEMPPG,CODFILIALPG,CODCLI,
              CODEMPCL,CODFILIALCL,CODVEND,CODEMPVD,CODFILIALVD,TIPOVENDA,CODVENDA,
              CODEMPVA,CODFILIALVA,VLRREC,
              VLRDESCREC,VLRMULTAREC,VLRJUROSREC,VLRPARCREC,VLRPAGOREC,
              VLRAPAGREC,DATAREC, DTCOMPREC, STATUSREC,VLRCOMIREC,DOCREC,CODBANCO,CODEMPBO,CODFILIALBO,
              CODEMPCB, CODFILIALCB, CODCARTCOB, FLAG, OBSREC, vlrbasecomis)
              VALUES (
                     :ICODEMP,:SCODFILIALRC,:ICODREC, :CODTIPOCOB, :ICODEMPTC, :ICODFILIALTC,
                     :CodPlanoPag,:ICODEMPPG,:ICODFILIALPG,:CodCli,
                     :ICODEMPCL,:ICODFILIALCL,:CodVend,:ICODEMPVD,:ICODFILIALVD,:CTIPOVENDA,:ICodVenda,
                     :ICODEMP,:ICODFILIAL,:VlrLiqVenda,
                     0,0,0,:VlrLiqVenda,0,:VlrLiqVenda,:dtVenda, :dtComp, 'R1',
                     :VlrComisVenda,:DocVenda,:CodBanco,:ICODEMPBO,:ICODFILIALBO,
                     :CODEMPCB, :CODFILIALCB, :CODCARTCOB, :FLAG, :OBSREC,:vlrbasecomis
              );
  END
  ELSE IF (ICODREC IS NOT NULL) THEN
  BEGIN
    IF (IPARCPLANOPAG>0) THEN
    BEGIN
        UPDATE FNRECEBER SET ALTUSUREC='N',
              CODTIPOCOB=:CODTIPOCOB,CODEMPTC=:ICODEMPTC, CODFILIALTC=:ICODFILIALTC,
              CODPLANOPAG=:CodPlanoPag,CODEMPPG=:ICODEMPPG,CODFILIALPG=:ICODFILIALPG,
              CODCLI=:CodCli, CODEMPCL=:ICODEMPCL,CODFILIALCL=:ICODFILIALCL,
              CODVEND=:CodVend,CODEMPVD=:ICODEMPVD,CODFILIALVD=:ICODFILIALVD,
              VLRREC=:VlrLiqVenda,VLRDESCREC=0,VLRMULTAREC=0,VLRJUROSREC=0,
              VLRPARCREC=:VlrLiqVenda,VLRPAGOREC=0,VLRAPAGREC=:VlrLiqVenda,
              DATAREC=:dtVenda,VLRCOMIREC=:VlrComisVenda,
              /* STATUSREC='R1' */
              DOCREC=:DocVenda,CODBANCO=:CodBanco,CODEMPBO=:ICODEMPBO,
              CODFILIALBO=:ICODFILIALBO,
              CODEMPCB=:CODEMPCB, CODFILIALCB=:CODFILIALCB, CODCARTCOB=:CODCARTCOB, FLAG=:FLAG,
              vlrbasecomis=:vlrbasecomis
             WHERE CODREC=:ICODREC AND CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIALRC;

        UPDATE FNITRECEBER SET ALTUSUITREC='S' /* Atualiza os itens de contas a */
        /* receber para ajustar automaticamente os valores no cabeçalho */
             WHERE CODREC=:ICODREC AND CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIALRC;
     END
     ELSE
     BEGIN
         DELETE FROM FNRECEBER WHERE CODREC=:ICODREC AND CODEMP=:ICODEMP AND
            CODFILIAL=:SCODFILIALRC;
     END
   END

END
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Indica se deve ser realizada a retensão do tributo ISS (descontando do valor final do título)'
WHERE RDB$PROCEDURE_NAME = 'FNADICRECEBERSP01' AND RDB$PARAMETER_NAME = 'VLRRETENSAOISS';

/* Alter (FNGERAITRECEBERSP01) */
SET TERM ^ ;

ALTER PROCEDURE FNGERAITRECEBERSP01(CALTVLR CHAR,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
ICODEMPPG INTEGER,
SCODFILIALPG SMALLINT,
ICODPLANOPAG INTEGER,
NVLRREC NUMERIC(15,5),
DDATAREC DATE,
DDTCOMPREC DATE,
CFLAG CHAR,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3),
ICODEMPTC INTEGER,
SCODFILIALTC SMALLINT,
ICODTIPOCOB INTEGER,
ICODEMPCB INTEGER,
SCODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
NVLRCOMIREC NUMERIC(15,5),
OBSREC VARCHAR(250),
CODEMPCA INTEGER,
CODFILIALCA SMALLINT,
NUMCONTA CHAR(10),
CODEMPPN INTEGER,
CODFILIALPN SMALLINT,
CODPLAN CHAR(13),
CODEMPCC INTEGER,
CODFILIALCC SMALLINT,
ANOCC INTEGER,
CODCC CHAR(19),
VLRBASECOMIS NUMERIC(15,5))
 RETURNS(I INTEGER)
 AS
declare variable nperc numeric(15,5);
declare variable npercpag numeric(15,5);
declare variable nresto numeric(15,5);
declare variable inumparc integer;
declare variable idiaspag integer;
declare variable nrestocomi numeric(15,5);
declare variable nvlrcomiitrec numeric(15,5);
declare variable nvlritrec numeric(15,5);
declare variable regrvcto char(1);
declare variable rvsab char(1);
declare variable rvdom char(1);
declare variable rvfer char(1);
declare variable dtvencto date;
declare variable rvdia char(1);
declare variable dtbase date;
declare variable diavcto smallint;
declare variable casasdecfin smallint;
declare variable vlrbaseitcomis numeric(15,5);
declare variable restobasecomis numeric(15,5);
begin

    -- Inicializando variáveis

    i = 0;
    nperc = 100;
    nresto = nvlrrec;
    nrestocomi = nvlrcomirec;
    dtbase = ddatarec;
    vlrbaseitcomis = vlrbasecomis;
    restobasecomis = vlrbasecomis;

    -- Buscando preferencias

    select casasdecfin from sgprefere1 where codemp=:icodemp and codfilial=:scodfilial
    into casasdecfin;

    -- Buscanco informações do plano de pagamento
    select pp.parcplanopag, pp.regrvctoplanopag, pp.rvsabplanopag, pp.rvdomplanopag, pp.rvferplanopag, pp.rvdiaplanopag,
    pp.diavctoplanopag
    from fnplanopag pp
    where pp.codplanopag =:icodplanopag and pp.codemp=:icodemppg and pp.codfilial = :scodfilialpg
    into :inumparc, :regrvcto, :rvsab, :rvdom, :rvfer, :rvdia, :diavcto;

    -- Loop nas parcelas do plano de pagamento para geração dos itens do contas a receber

    for select percpag, diaspag from fnparcpag
    where codplanopag=:icodplanopag and codemp=:icodemppg and codfilial =:scodfilialpg
    order by diaspag
    into :npercpag, :idiaspag
    do begin
        i = i+1;

        -- Calculando valor da parcela
        select v.deretorno from arreddouble(cast(:nvlrrec * :npercpag as numeric(15, 5))/:nperc, :casasdecfin ) v
        into :nvlritrec;

        nresto = nresto - nvlritrec;

        if (i = inumparc) then
        begin
            nvlritrec = nvlritrec + nresto;
        end

        -- Calculando o valor da comissão a pagar na parcela.
        select v.deretorno from arreddouble(cast(:nvlrcomirec * :npercpag as numeric(15, 5))/:nperc,:casasdecfin) v
        into :nvlrcomiitrec;

        nrestocomi = nrestocomi - nvlrcomiitrec;

        if (i = inumparc) then
        begin
            nvlrcomiitrec = nvlrcomiitrec + nrestocomi;
        end

         -- Calculando o valor da base da comissão especial a pagar na parcela.
        select v.deretorno from arreddouble(cast(:vlrbasecomis * :npercpag as numeric(15, 5))/:nperc,:casasdecfin) v
        into :vlrbaseitcomis;

        restobasecomis = restobasecomis - vlrbaseitcomis;

        if (i = inumparc) then
        begin
            vlrbaseitcomis = vlrbaseitcomis + restobasecomis;
        end

        -- Definindo o vencimento da parcela
        select c.dtvencret from sgcalcvencsp(:icodemp, :dtbase, :ddatarec + :idiaspag, :regrvcto,
        :rvsab, :rvdom, :rvfer, :rvdia, :diavcto, :idiaspag ) c
        into :dtvencto;

        dtbase = dtvencto;

        -- Execuntado procedimento que insere registros na tabela fnitreceber

        execute procedure fnadicitrecebersp01 (
        :caltvlr, :icodemp,:scodfilial,:icodrec,:i,0,0,0,:nvlritrec,0, :ddatarec, :ddtcomprec, :dtvencto,'R1',:cflag,
        :icodempbo,:scodfilialbo, :ccodbanco, :icodemptc, :scodfilialtc, :icodtipocob,
        :icodempcb, :scodfilialcb, :codcartcob, :nvlrcomiitrec, :obsrec, :codempca,
        :codfilialca, :numconta, :codemppn, :codfilialpn, :codplan, :codempcc, :codfilialcc, :anocc, :codcc, :vlrbaseitcomis);


    end
    suspend;
end
^

/* Alter (FNGERASEQNOSSONUMERO) */
ALTER PROCEDURE FNGERASEQNOSSONUMERO(CODEMPBO INTEGER,
CODFILIALBO SMALLINT,
CODBANCO CHAR(3),
CODEMPCB INTEGER,
CODFILIALCB SMALLINT,
CODCARTCOB CHAR(3),
CODEMPCT INTEGER,
CODFILIALCT SMALLINT,
NUMCONTA CHAR(10))
 RETURNS(SEQNOSSONUMERO INTEGER)
 AS
begin
    
    seqnossonumero = 0;

    --Buscando sequencia atual;

    select first 1 coalesce(im.seqnossonumero,0)
    from fnitmodboleto im
    where im.codempcb=:codempcb and im.codfilialcb=:codfilialcb and im.codcartcob=:codcartcob
    and im.codempbo=:codempbo and im.codfilialbo=:codfilialbo and im.codbanco=:codbanco
    and im.codempct=:codempct and im.codfilialct=:codfilialct and im.numconta=:numconta
    into seqnossonumero;

    --Incrementando sequencia;

    seqnossonumero = seqnossonumero + 1;

    --Atualizando sequencia na tabela de itens de modelo

    update fnitmodboleto im set im.seqnossonumero=:seqnossonumero
    where im.codempcb=:codempcb and im.codfilialcb=:codfilialcb and im.codcartcob=:codcartcob
    and im.codempbo=:codempbo and im.codfilialbo=:codfilialbo and im.codbanco=:codbanco
    and im.codempct=:codempct and im.codfilialct=:codfilialct and im.numconta=:numconta;

    suspend;

end
^

/* Alter (LFBUSCAPREVTRIBORC) */
ALTER PROCEDURE LFBUSCAPREVTRIBORC(CODEMP INTEGER,
CODFILIAL INTEGER,
CODORC INTEGER,
TIPOORC CHAR,
CODITORC SMALLINT)
 RETURNS(VLRICMS NUMERIC(15,5),
VLRIPI NUMERIC(15,5),
VLRPIS NUMERIC(15,5),
VLRCOFINS NUMERIC(15,5),
VLRIR NUMERIC(15,5),
VLRCSOCIAL NUMERIC(15,5),
VLRISS NUMERIC(15,5))
 AS
declare variable codempcl integer;
declare variable codfilialcl smallint;
declare variable codcli integer;
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempif integer;
declare variable codfilialif smallint;
declare variable codfisc char(13);
declare variable coditfisc smallint;
declare variable vlrbasepis numeric(15,5);
declare variable vlrbasecofins numeric(15,5);
declare variable vlrprod integer;
declare variable aliqpis numeric(6,2);
declare variable qtd numeric(15,5);
declare variable vlrpisunidtrib numeric(15,5);
declare variable codsittribcof char(2);
declare variable aliqcofins numeric(6,2);
declare variable vlrcofunidtrib numeric(15,5);
declare variable vlrliq numeric(15,5);
declare variable vlrfrete numeric(15,5);
declare variable codsittribipi char(2);
declare variable vlripiunidtrib numeric(15,5);
declare variable aliqipi numeric(6,2);
declare variable tpcalcipi char(1);
declare variable vlrbaseipi numeric(15,5);
declare variable aliqcsocial numeric(6,2);
declare variable aliqir numeric(6,2);
declare variable codemppd integer;
declare variable codfilialpd smallint;
declare variable codprod integer;
declare variable tipoprod varchar(2);
declare variable aliqiss numeric(6,2);
declare variable aliqicms numeric(6,2);
declare variable tpredicms char(1);
declare variable redicms numeric(15,5);
declare variable baseicms numeric(15,5);
declare variable codtrattrib char(2);
declare variable codsittribpis char(2);
declare variable ufcli char(2);
begin

    -- Inicializando variáveis

    vlripi = 0;
    vlrfrete = 0;

    -- Buscando informações no orçamento (cliente e tipo de movimento)
    select oc.codempcl,oc.codfilialcl,oc.codcli,tm.codemptm,tm.codfilialtm,tm.codtipomovtm,coalesce(cl.siglauf,cl.ufcli)
    from vdorcamento oc, vdcliente cl, eqtipomov tm
    where oc.codemp=:codemp and oc.codfilial=:codfilial and oc.codorc=:codorc and oc.tipoorc=:tipoorc
    and cl.codemp=oc.codempcl and cl.codfilial=oc.codfilialcl and cl.codcli=oc.codcli
    and tm.codemp=oc.codemp and tm.codfilial=oc.codfilialtm and tm.codtipomov=oc.codtipomov
    into :codempcl, :codfilialcl, :codcli, :codemptm, :codfilialtm, :codtipomov, :ufcli;

    -- Buscando informações do produto no item de orçamento
    select io.codemppd, io.codfilialpd, io.codprod, io.vlrproditorc, io.qtditorc, io.vlrliqitorc, coalesce(io.vlrfreteitorc,0),
    pd.tipoprod

    from vditorcamento io, eqproduto pd
    where io.codemp=:codemp and io.codfilial=:codfilial and io.codorc=:codorc and io.tipoorc=:tipoorc and io.coditorc=:coditorc
    and pd.codemp=io.codemppd and pd.codfilial=io.codfilialpd and pd.codprod=io.codprod
    into :codemppd, :codfilialpd, :codprod, :vlrprod, :qtd, :vlrliq, :vlrfrete, :tipoprod;

    -- Buscando a regra de classificação para o ítem
    select bf.codempif, bf.codfilialif, bf.codfisc, bf.coditfisc
    from lfbuscafiscalsp(:codemppd, :codfilialpd, :codprod, :codempcl, :codfilialcl, :codcli,
    :codemptm, :codfilialtm, :codtipomov, 'VD',null,null,null,null,null) bf
    into :codempif, :codfilialif, :codfisc, :coditfisc;

    -- Buscando informacoes fiscais na tabela de regras
    select cf.codsittribpis, cf.aliqpisfisc, cf.vlrpisunidtrib, cf.codsittribcof, cf.aliqcofinsfisc, cf.vlrcofunidtrib,
    cf.vlripiunidtrib, cf.aliqipifisc, cf.codsittribipi, cf.tpcalcipi,
    coalesce(cf.aliqcsocialfisc, fi.perccsocialfilial), coalesce(cf.aliqirfisc, fi.percirfilial), coalesce(fi.percissfilial, cf.aliqissfisc),
    cf.tpredicmsfisc, cf.redfisc, cf.codtrattrib
    from lfitclfiscal cf
    left outer join sgfilial fi on
    fi.codemp=:codemp and fi.codfilial=:codfilial
    where cf.codemp=:codempif and cf.codfilial=:codfilialif and cf.codfisc=:codfisc and cf.coditfisc=:coditfisc
    into :codsittribpis, :aliqpis, :vlrpisunidtrib, :codsittribcof, :aliqcofins, :vlrcofunidtrib,
    :vlripiunidtrib, :aliqipi, :codsittribipi,:tpcalcipi, :aliqcsocial, :aliqir, :aliqiss,
    :tpredicms, :redicms, :codtrattrib;

    -- Definição do IPI
    if(:codsittribipi not in ('52','53','54')) then -- IPI Tributado
    begin
        if(:tpcalcipi='P' and aliqipi is not null and aliqipi > 0) then -- Calculo pela aliquota
        begin
            vlrbaseipi = :vlrliq; -- (Base do IPI = Valor total dos produtos - Implementar situações distintas futuramente)
            vlripi = (vlrbaseipi * aliqipi) / 100;
        end
        else if (vlripiunidtrib is not null and vlripiunidtrib > 0) then -- Calculo pela quantidade
        begin
            vlripi = qtd * vlripiunidtrib;
        end
    end

    -- Definição do PIS

    if(:codsittribpis in ('01','02','99') and aliqpis is not null and aliqpis > 0 ) then -- PIS Tributado pela alíquota
    begin
        vlrbasepis = :vlrprod; -- (Base do PIS = Valor total dos produtos - Implementar situações distintas futuramente)
        vlrpis = (vlrbasepis * aliqpis) / 100;
    end
    else if (:codsittribpis in ('03') and vlrpisunidtrib is not null and vlrpisunidtrib > 0) then -- PIS Tributado pela quantidade
    begin
        vlrpis = qtd * vlrpisunidtrib;
    end

    -- Definição do COFINS

    if(:codsittribcof in ('01','02','99') and aliqcofins is not null and aliqcofins > 0 ) then -- COFINS Tributado pela alíquota
    begin
        vlrbasecofins = :vlrprod; -- (Base do COFINS = Valor total dos produtos - Implementar situações distintas futuramente)
        vlrcofins = (vlrbasecofins * aliqcofins) / 100;
    end
    else if (:codsittribpis in ('03') and vlrcofunidtrib is not null and vlrcofunidtrib > 0) then -- COFINS Tributado pela quantidade
    begin
        vlrcofins = qtd * vlrcofunidtrib;
    end

    -- Definição do IR

    if(aliqir is not null and aliqir > 0) then
    begin
        vlrir = ((:vlrliq + :vlripi + :vlrfrete) * aliqir) / 100;
    end

    -- Definição da CSocial

    vlrcsocial = ((:vlrliq + :vlripi + :vlrfrete) * aliqcsocial) / 100;

    -- Definição do ISS se for um serviço
    if (tipoprod = 'S') then
    begin
        if ( aliqiss is not null and aliqiss > 0 ) then
        begin
            vlriss = vlrliq * (aliqiss/100);
        end
    end

    -- Definição do ICMS
    -- Calcular icms quando aliquota maio que zero e tratamento tributário não for (isento, isento ou n.trib, n.trib., suspenso)

    if(codtrattrib not in ('40','30','41','50')) then
    begin

        if(aliqicms is null) then
        begin
            select ti.aliqti from lftabicms ti
            where codemp=:codemp and codfilial=:codfilial and ufti=:ufcli
            into aliqicms;
        end

        if (redicms>0) then -- Com redução
        begin
            if(tpredicms='B') then -- Redução na base de cálculo
            begin
                baseicms = vlrliq * ( 1 - (redicms / 100));
                vlricms = baseicms * (aliqicms / 100);
            end
            else -- Redução no valor
            begin

                baseicms = vlrliq;
                vlricms = baseicms * ( aliqicms / 100 );
                vlricms = vlricms * (( 100 - redicms ) / 100);


            end
        end
        else -- Sem redução
        begin

            baseicms = vlrliq;
            vlricms = baseicms * (aliqicms / 100);

        end

    end
  suspend;
end
^

/* Alter (PPCUSTOPRODSP) */
ALTER PROCEDURE PPCUSTOPRODSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
DTESTOQ DATE,
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER,
CCOMSALDO CHAR(10))
 RETURNS(CUSTOUNIT NUMERIC(15,5),
SLDPROD NUMERIC(15,5))
 AS
declare variable qtditest numeric(15,5);
declare variable seqest smallint;
declare variable tipoprod varchar(2);
declare variable custotot numeric(15,5);
declare variable codprodpd integer;
begin
  /* Retorna o custo unitário do produto */
  IF (CTIPOCUSTO IS NULL) then
     CTIPOCUSTO = 'P';

  SELECT P.TIPOPROD
   FROM EQPRODUTO P
   WHERE P.CODEMP = :ICODEMP AND P.CODFILIAL = :SCODFILIAL AND
      P.CODPROD=:ICODPROD
   INTO :TIPOPROD;

  IF (TIPOPROD='F') THEN
  BEGIN
     SELECT SLDPROD FROM EQCUSTOPRODSP(:ICODEMP, :SCODFILIAL, :ICODPROD,
        :DTESTOQ, :CTIPOCUSTO,  :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, 'N')
     INTO :SLDPROD;

     CUSTOTOT = 0;

     SELECT FIRST 1 E.SEQEST FROM PPESTRUTURA E
       WHERE E.CODEMP=:ICODEMP AND E.CODFILIAL=:SCODFILIAL AND E.CODPROD=:ICODPROD
       ORDER BY E.SEQEST INTO :SEQEST;

     FOR SELECT I.CODPRODPD,I.QTDITEST FROM  PPITESTRUTURA I
        WHERE I.CODEMP=:ICODEMP AND I.CODFILIAL=:SCODFILIAL AND
          I.CODPROD=:ICODPROD AND I.SEQEST=:SEQEST
        INTO :CODPRODPD, :QTDITEST DO
     BEGIN
         SELECT CUSTOUNIT FROM PPCUSTOPRODSP(:ICODEMP, :SCODFILIAL, :CODPRODPD, :DTESTOQ,
            :CTIPOCUSTO, :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, :CCOMSALDO)
         INTO :CUSTOUNIT;
         CUSTOTOT = CUSTOTOT + ( CUSTOUNIT * QTDITEST)  ;
     END
  END
  ELSE
  BEGIN
     SELECT CUSTOUNIT,SLDPROD FROM EQCUSTOPRODSP(:ICODEMP, :SCODFILIAL, :ICODPROD,
        :DTESTOQ, :CTIPOCUSTO,  :ICODEMPAX, :SCODFILIALAX, :ICODALMOX, 'N')
     INTO :CUSTOTOT, :SLDPROD;
  END
  CUSTOUNIT = CUSTOTOT;
  SUSPEND;
end
^

/* Alter (PPGERAOP) */
ALTER PROCEDURE PPGERAOP(TIPOPROCESS CHAR,
CODEMPOP INTEGER,
CODFILIALOP SMALLINT,
CODOP INTEGER,
SEQOP INTEGER,
CODEMPPD INTEGER,
CODFILIALPD SMALLINT,
CODPROD INTEGER,
CODEMPOC INTEGER,
CODFILIALOC SMALLINT,
CODORC INTEGER,
TIPOORC CHAR,
CODITORC SMALLINT,
QTDSUGPRODOP NUMERIC(15,5),
DTFABROP DATE,
SEQEST SMALLINT,
CODEMPET INTEGER,
CODFILIALET SMALLINT,
CODEST SMALLINT,
AGRUPDATAAPROV CHAR,
AGRUPDTFABROP CHAR,
AGRUPCODCLI CHAR,
CODEMPCL INTEGER,
CODFILIALCL SMALLINT,
CODCLI INTEGER,
DATAAPROV DATE,
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
CODITCOMPRA SMALLINT,
JUSTFICQTDPROD VARCHAR(500),
CODEMPPDENTRADA INTEGER,
CODFILIALPDENTRADA SMALLINT,
CODPRODENTRADA INTEGER,
QTDENTRADA NUMERIC(15,5))
 RETURNS(CODOPRET INTEGER,
SEQOPRET SMALLINT)
 AS
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable refprod varchar(20);
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable sitpadop char(2);
declare variable seqof smallint;
declare variable codempfs integer;
declare variable codfilialfs smallint;
declare variable codfase integer;
declare variable tempoefdias numeric(15,5);
declare variable tempoef numeric(15,5);
declare variable datafimprodant date;
declare variable hfimprodant time;
declare variable qtdfinalprodop numeric(15,5);
declare variable codtipomovtm integer;
declare variable sitpadopconv char(2);
declare variable codemprma integer;
declare variable codfilialrma smallint;
declare variable codrma integer;
declare variable coditrma smallint;
declare variable estdinamica char(1);
begin

    if(codop is null) then
    begin

        -- Busca novo código para a OP caso não venha no parâmetro.
        select coalesce(max(codop),0) + 1 from ppop where codemp=:codempop and codfilial=:codfilialop
        into :codop;

        -- Buscando informações do produto e estrutura.

        select pd.codempax, pd.codfilialax, pd.codalmox, pd.refprod, es.estdinamica from eqproduto pd, ppestrutura es
        where pd.codemp=:codemppd and pd.codfilial=:codfilialpd and pd.codprod=:codprod
        and es.codemp=pd.codemp and es.codfilial=pd.codfilial and es.codprod=pd.codprod and es.seqest=:seqest
        into :codempax, :codfilialax, :codalmox, :refprod, :estdinamica;

        -- Buscando tipo de movimento para OP.
        select p5.codemptm, p5.codfilialtm, p5.codtipomov, coalesce(tm.codtipomovtm,p5.codtipomov), p5.sitpadop, p5.sitpadopconv
        from sgprefere5 p5, eqtipomov tm
        where p5.codemp=:codempop and p5.codfilial=:codfilialop and
        tm.codemp=p5.codemptm and tm.codfilial=p5.codfilialtm and tm.codtipomov=p5.codtipomov
        into :codemptm, :codfilialtm, :codtipomov, :codtipomovtm, :sitpadop, :sitpadopconv;

        -- Inserindo OP
        seqop = 0;

        if(sitpadop='FN' and tipoprocess in ('D','A')) then
        begin
            qtdfinalprodop = :qtdsugprodop;
            codtipomov = :codtipomovtm;
        end
        else if(sitpadopconv='FN' and tipoprocess='C') then
        begin
            qtdfinalprodop = :qtdsugprodop;
            codtipomov = :codtipomovtm;
        end
        else
        begin
            qtdfinalprodop = 0;
        end

        insert into ppop  (codemp, codfilial, codop, seqop,
                           codemppd, codfilialpd, codprod, seqest, refprod,
                           codempax, codfilialax, codalmox,
                           dtemitop, dtfabrop,
                           qtdsugprodop, qtdprevprodop, qtdfinalprodop,
                           codemple, codfilialle, codlote,
                           codemptm, codfilialtm, codtipomov,
                           sitop, codempcp, codfilialcp, codcompra, coditcompra, justficqtdprod, estdinamica)
        values ( :codempop, :codfilialop, :codop, :seqop,
                 :codemppd, :codfilialpd, :codprod, :seqest, :refprod,
                 :codempax, :codfilialax, :codalmox,
                 cast('today' as date), :dtfabrop,
                 :qtdsugprodop, :qtdsugprodop, :qtdfinalprodop, null,null,null, 
                 :codemptm, :codfilialtm, :codtipomov, :sitpadop,
                 :codempcp, :codfilialcp, :codcompra, :coditcompra, :justficqtdprod, :estdinamica

        );

        -- Caso o status padrão da OP seja Finalizado
        if(:sitpadop='FN') then
        begin
            -- Inicializando variaveis
            datafimprodant = :dtfabrop;
            hfimprodant = cast('now' as time);

            -- Gerando RMAS

            execute procedure eqgerarmasp(:codempop,:codfilialop,:codop,:seqop);

            -- Finalizando Fases

            for select oe.codempfs, oe.codfilialfs, oe.codfase, oe.seqof
            from ppopfase oe, ppop op
            where oe.codemp=:codempop and oe.codfilial=:codfilialop and oe.codop=:codop and oe.seqop=:seqop and
            op.codemp=oe.codemp and op.codfilial=oe.codfilial and op.codop=oe.codop and op.seqop=oe.seqop
            order by oe.seqof
            into :codempfs, :codfilialfs, :codfase, :seqof do
            begin
                -- Buscando informações da fase
                select ef.tempoef from ppestrufase ef
                where ef.codemp=:codempfs and ef.codfilial=:codfilialfs and ef.codfase=:codfase and
                ef.codemp=:codemppd and ef.codfilial=:codfilialpd and ef.codprod=:codprod and ef.seqest=:seqest
                into :tempoef;

                tempoefdias = (tempoef/3600) / 24; -- de segundos para dias...

                update ppopfase oe set oe.sitfs=:sitpadop, oe.obsfs='Fase finalizada automaticamente',
                oe.datainiprodfs=:datafimprodant, oe.hiniprodfs=:hfimprodant,
                oe.datafimprodfs=:datafimprodant + :tempoefdias, oe.hfimprodfs=:hfimprodant + :tempoef
                where oe.codemp=:codempop and oe.codfilial=:codfilialop and oe.codop=:codop and oe.seqop=:seqop and
                oe.seqof=:seqof;

                -- Carregando variáveis para proximo registro
                datafimprodant = :datafimprodant + :tempoefdias;
                hfimprodant = :hfimprodant + :tempoef;

            end
        end

    end

    -- Caso o tipo de processamento seja Detalhado (uma OP por orçamento)
    if(tipoprocess='D') then
    begin

        -- Caso o código do orçamento e código da OP tenham sido informados (deve ocorrer no modo orçamento ou a partir da segunda passagem do modo agrupado...
        if( (codorc is not null) and (codop is not null) ) then
        begin
            insert into ppopitorc (codemp, codfilial, codop, seqop, codempoc, codfilialoc, tipoorc, codorc, coditorc, qtdprod)
            values(:codempop, :codfilialop, :codop, :seqop, :codempoc, :codfilialoc, :tipoorc, :codorc, :coditorc, :qtdsugprodop);

            -- Caso a OP seja gerada já finalizada... deve mudar o status do item de orçamento para produzido.
            if(sitpadop='FN') then
            begin
                update vditorcamento io set io.sitproditorc='PD'
                where io.codemp=:codempoc and io.codfilial=:codfilialoc and io.codorc=:codorc and io.coditorc=:coditorc and io.tipoorc=:tipoorc;
            end

        end
    end
    -- Caso o tipo de processamento seja Agrupado (uma OP para vários orçamentos)
    else if(tipoprocess='A') then
    begin

        for select pt.codemp,pt.codfilial, pt.codorc, pt.coditorc, pt.tipoorc, pt.dtfabrop, pt.qtdaprod
        from ppprocessaoptmp pt, vditorcamento io, vdorcamento oc
        where pt.codempet=:codempet and pt.codfilialet=:codfilialet and pt.codest=:codest
        and io.codemp=pt.codemp and io.codfilial=pt.codfilial and io.codorc=pt.codorc and io.coditorc=pt.coditorc and io.tipoorc=pt.tipoorc
        and oc.codemp=io.codemp and oc.codfilial=io.codfilial and oc.codorc=io.codorc and oc.tipoorc=io.tipoorc
        and (:agrupdataaprov='N' or io.dtaprovitorc=:dataaprov )
        and (:agrupdtfabrop='N' or pt.dtfabrop=:dtfabrop )
        and (:agrupcodcli='N' or (oc.codorc=:codcli and oc.codempcl=:codempcl and oc.codfilialcl=:codfilialcl) )
        and io.codemppd=:codemppd and io.codfilialpd=:codfilialpd and io.codprod=:codprod
        into :codempoc, :codfilialoc, :codorc, :coditorc, :tipoorc, :dtfabrop, :qtdsugprodop do
        begin

            insert into ppopitorc (codemp, codfilial, codop, seqop, codempoc, codfilialoc, tipoorc, codorc, coditorc, qtdprod)
            values(:codempop, :codfilialop, :codop, :seqop, :codempoc, :codfilialoc, :tipoorc, :codorc, :coditorc, :qtdsugprodop);

            -- Caso a OP seja gerada já finalizada... deve mudar o status do item de orçamento para produzido.
            if(sitpadop='FN') then
            begin
                update vditorcamento io set io.sitproditorc='PD'
                where io.codemp=:codempoc and io.codfilial=:codfilialoc and io.codorc=:codorc and io.coditorc=:coditorc and io.tipoorc=:tipoorc;
            end

        end
    end

    -- Carregando parametros de saída
    codopret = :codop;
    seqopret = :seqop;

    suspend;

end
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Tipo de processamento (D=Detalhado, A=Agrupado, C=Comum)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'TIPOPROCESS';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da empresa da ordem de produção'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPOP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da filial da ordem de produção'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALOP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da ordem de produção'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODOP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Sequencia da ordem de produção'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'SEQOP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da empresa do produto'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPPD';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da filial do produto'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALPD';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código do produto'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODPROD';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da emrpesa do orçamento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPOC';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da filial do orçamento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALOC';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código do orçamento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODORC';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Tipo de orçamento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'TIPOORC';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código do item de orçamento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODITORC';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Quantidade sugerida para fabricação'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'QTDSUGPRODOP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Data de fabricação'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'DTFABROP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Sequência da estrutura'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'SEQEST';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da empresa da estação de trabalho'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPET';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da filial da estação de trabalho'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALET';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da estação de trabalho'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEST';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Indica se o agrupamento é por data de aprovação'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'AGRUPDATAAPROV';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Indica se o agrupamento é por data de fabricação'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'AGRUPDTFABROP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Indica se o agrupamento é por código de cliente'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'AGRUPCODCLI';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da empresa do cliente do lote processado'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPCL';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da filial do cliente do lote processado'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALCL';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código do cliente do lote processado'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODCLI';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Data de aprovação do lote processado'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'DATAAPROV';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da empresa do item de compra (conversão de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPCP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da filial do item de compra (conversão de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALCP';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da compra (conversão de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODCOMPRA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código do item de compra (conversão de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODITCOMPRA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Justificativa por divergencias na quantidade final (conversão de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'JUSTFICQTDPROD';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da empresa do produto de entrada (conversão de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODEMPPDENTRADA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código da filial do produto de entrada (conversão de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODFILIALPDENTRADA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código do produto de entrada (conversão de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODPRODENTRADA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Quantidade do produto de entrada (conversão de produtos)'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'QTDENTRADA';

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código do item de orçamento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODITORC';

/* Alter (PPGERAOPCQ) */
SET TERM ^ ;

ALTER PROCEDURE PPGERAOPCQ(ICODEMP INTEGER,
ICODFILIAL SMALLINT,
ICODOP INTEGER,
ISEQOP SMALLINT)
 AS
declare variable iseqef smallint;
declare variable iseqopcq smallint;
declare variable icodempea integer;
declare variable icodfilialea smallint;
declare variable icodestanalise integer;
BEGIN

    SELECT COALESCE(MAX(SEQOPCQ),0)
        FROM PPOPCQ
            WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
                AND CODOP=:ICODOP AND SEQOP=:ISEQOP
    INTO :ISEQOPCQ;

    FOR
        SELECT EA.SEQEF, EA.codemp,EA.codfilial,EA.codestanalise
            FROM PPESTRUANALISE EA, PPOP O, PPESTRUTURA E
            WHERE O.CODEMP=:iCodEmp AND O.CODFILIAL=:iCodFilial
                AND O.CODOP=:iCodOp AND O.SEQOP=:iSEQOP AND E.CODEMP=O.CODEMPPD
                AND E.CODFILIAL=O.CODFILIALPD AND E.CODPROD=O.CODPROD AND E.SEQEST=O.SEQEST
                AND EA.CODEMP=E.CODEMP AND EA.CODFILIAL=E.CODFILIAL AND EA.CODPROD=E.CODPROD
                AND EA.SEQEST=E.SEQEST
        INTO :iSeqEf, :ICODEMPEA,:ICODFILIALEA,:ICODESTANALISE
    DO
    BEGIN
        ISEQOPCQ = :ISEQOPCQ + 1;
        INSERT INTO PPOPCQ (CODEMP,CODFILIAL,CODOP,SEQOP,SEQOPCQ,
            CODEMPEA,CODFILIALEA,CODESTANALISE, SEQEF)
            VALUES (:iCodEmp,:iCodFilial,:iCodOp,:iSeqOp, :ISEQOPCQ,:ICODEMPEA,
                    :ICODFILIALEA,:ICODESTANALISE,:iseqef);
    END

END
^

/* Alter (PPITOPSP01) */
ALTER PROCEDURE PPITOPSP01(ICODEMP INTEGER,
ICODFILIAL SMALLINT,
ICODOP INTEGER,
ISEQOP SMALLINT)
 AS
declare variable icodemppd integer;
declare variable icodfilialpd smallint;
declare variable gerarma char(1);
declare variable crefprod varchar(20);
declare variable icodprodpd integer;
declare variable nqtditop numeric(15,5);
declare variable icodemple integer;
declare variable icodfilialle smallint;
declare variable ccodlote varchar(20);
declare variable icodempfs integer;
declare variable icodfilialfs smallint;
declare variable icodfase integer;
declare variable icodemptr integer;
declare variable icodfilialtr smallint;
declare variable icodtprec integer;
declare variable icodemprp integer;
declare variable icodfilialrp smallint;
declare variable icodrecp integer;
declare variable dtempoof numeric(15,5);
declare variable iseqof smallint;
declare variable iseqppitop integer;
declare variable qtditest numeric(15,5);
declare variable qtdest numeric(15,5);
declare variable qtdprevprodop numeric(15,5);
declare variable qtdfixa char(1);
declare variable estdinamica char(1);
declare variable permiteajusteitop char(1);
declare variable iseqsubprod integer;
declare variable qtditestsp numeric(15,5);
declare variable codempts integer;
declare variable codfilialts smallint;
declare variable codtipomovsp integer;
declare variable tipoexterno char(10);
begin

    --Loop nas fases da estrutura para geração da tabela de fases da OP.
    for select ef.seqef, ef.codempfs, ef.codfilialfs, ef.codfase, ef.codemptr, ef.codfilialtr, ef.codtprec, ef.tempoef, o.estdinamica
    from ppestrufase ef, ppop o, ppestrutura e
    where
        o.codemp=:icodemp and o.codfilial=:icodfilial and o.codop=:icodop and o.seqop=:iseqop and
        e.codemp=o.codemppd and e.codfilial=o.codfilialpd and e.codprod=o.codprod and e.seqest=o.seqest and
        ef.codemp=e.codemp and ef.codfilial=e.codfilial and ef.codprod=e.codprod and ef.seqest=E.seqest
    into
        :iseqof, :icodempfs, :icodfilialfs, :icodfase, :icodemptr, :icodfilialtr, :icodtprec, :dtempoof, :estdinamica
    do
    begin
        -- Buscando o primeiro recurso para inserção na fase (provisório)
        select first 1 codemp, codfilial, codrecp from pprecurso r
        where r.codemp=:icodemptr and r.codfilial=:icodfilialtr and r.codtprec=:icodtprec
        into :icodemprp, :icodfilialrp, :icodrecp;

        -- Inserindo na tabela de fase por op
        insert into
            ppopfase (
                codemp, codfilial, codop, seqop, seqof, codempfs, codfilialfs, codfase, codemprp, codfilialrp, codrecp, tempoof,
                codemptr, codfilialtr, codtprec
            )
            values (
                :icodemp, :icodfilial, :icodop, :iseqop, :iseqof, :icodempfs, :icodfilialfs,:icodfase, :icodemprp, :icodfilialrp,
                :icodrecp,:dtempoof, :icodemptr, :icodfilialtr, :icodtprec
            );
    end

    -- Se a estrutura não for dinâmica, deve inserir os ítens

    if(:estdinamica='N' or :estdinamica is not null ) then
    begin

        iseqppitop = 0;

        for select
            ie.codemppd, ie.codfilialpd, ie.codprodpd, ie.refprodpd, ie.rmaautoitest, ie.codempfs, ie.codfilialfs, ie.codfase,
            ie.qtditest, e.qtdest, o.qtdprevprodop, ie.qtdfixa,
            (   select min(l.codlote) from eqlote l
                where
                l.codemp=e.codemp and l.codfilial=e.codfilial and l.codprod=e.codprod and l.sldliqlote > 0 and l.venctolote =
                (   select min( ls.venctolote ) from eqlote ls where ls.codprod=l.codprod and ls.codfilial=l.codfilial and
                    ls.codemp=l.codemp and ls.sldliqlote>0)) codlote, ie.permiteajusteitest, ie.tipoexterno
            from
                ppitestrutura ie, ppestrutura e, ppop o
            where
                ie.codemp=e.codemp and ie.codfilial=e.codfilial and ie.codprod=e.codprod and ie.seqest=e.seqest and
                o.codemppd=e.codemp and o.codfilialpd=e.codfilial and o.codprod=e.codprod and o.seqest=e.seqest and
                o.codemp=:icodemp and o.codfilial=:icodfilial and o.codop=:icodop and o.seqop=:iseqop
            order by ie.codfase, ie.seqef
        into
        :icodemppd, :icodfilialpd, :icodprodpd, :crefprod, :gerarma, :icodempfs, :icodfilialfs, :icodfase,
        :qtditest,:qtdest,:qtdprevprodop,:qtdfixa,:ccodlote,:permiteajusteitop,:tipoexterno
        do
        begin
            if (:ccodlote is null ) then
            begin
                icodemple = null;
                icodfilialle = null;
            end
            else
            begin
                icodemple = icodemppd;
                icodfilialle = icodfilialpd;
            end

            iseqppitop = :iseqppitop + 1;

            if ('S'=qtdfixa) then
            begin
                nqtditop = :qtditest;
            end
            else
            begin
                nqtditop = cast(:qtditest/:qtdest as numeric(15,5) ) * cast(:qtdprevprodop as numeric(15, 5));
            end

            insert into ppitop (
                codemp, codfilial, codop, seqop, seqitop, codemppd, codfilialpd, codprod, refprod,
                codempfs, codfilialfs, codfase, qtditop, gerarma, permiteajusteitop, tipoexterno
            )
            values (
                :icodemp, :icodfilial, :icodop, :iseqop, :iseqppitop, :icodemppd, :icodfilialpd,
                :icodprodpd, :crefprod,:icodempfs, :icodfilialfs, :icodfase, :nqtditop, :gerarma,
                :permiteajusteitop, :tipoexterno
            );

        end

        -- Inserindo tabela de subprodutos

        iseqsubprod = 0;

        -- Buscando tipo de movimento para subproducao
        select codempts, codfilialts, codtipomovsp from sgprefere5 where codemp=:icodemp and codfilial=:icodfilial
        into :codempts, :codfilialts, :codtipomovsp;

        for select
            ie.codemppd, ie.codfilialpd, ie.seqitestsp, ie.codprodpd, ie.refprodpd, ie.codempfs, ie.codfilialfs, ie.codfase,
            ie.qtditestsp, e.qtdest, o.qtdprevprodop, ie.qtdfixa,
            (   select min(l.codlote) from eqlote l
                where
                l.codemp=e.codemp and l.codfilial=e.codfilial and l.codprod=e.codprod and l.sldliqlote > 0 and l.venctolote =
                (   select min( ls.venctolote ) from eqlote ls where ls.codprod=l.codprod and ls.codfilial=l.codfilial and
                    ls.codemp=l.codemp and ls.sldliqlote>0)) codlote, fs.seqof
            from
                ppitestruturasubprod ie, ppestrutura e, ppop o, ppopfase fs
            where
                ie.codemp=e.codemp and ie.codfilial=e.codfilial and ie.codprod=e.codprod and ie.seqest=e.seqest and
                o.codemppd=e.codemp and o.codfilialpd=e.codfilial and o.codprod=e.codprod and o.seqest=e.seqest and
                o.codemp=:icodemp and o.codfilial=:icodfilial and o.codop=:icodop and o.seqop=:iseqop and
                fs.codemp=ie.codempfs and fs.codfilial=ie.codfilialfs and fs.codfase=ie.codfase and fs.codop=o.codop and fs.seqop=o.seqop
            order by ie.codfase, ie.seqef
        into
        :icodemppd, :icodfilialpd, :iseqsubprod, :icodprodpd, :crefprod, :icodempfs, :icodfilialfs, :icodfase,
        :qtditestsp,:qtdest,:qtdprevprodop,:qtdfixa,:ccodlote, :iseqof
        do
        begin

            if (:ccodlote is null ) then
            begin
                icodemple = null;
                icodfilialle = null;
            end
            else
            begin
                icodemple = icodemppd;
                icodfilialle = icodfilialpd;
            end

            iseqsubprod = :iseqsubprod + 1;

           insert into ppopsubprod (codemp, codfilial, codop, seqop, seqsubprod, codemppd, codfilialpd, codprod,
                refprod, qtditsp, codempfs, codfilialfs, codfase, codemple, codfilialle, codlote, seqof, codemptm, codfilialtm, codtipomov
           )
           values(
                :icodemp, :icodfilial,:icodop,:iseqop, :iseqsubprod, :icodemppd, :icodfilialpd, :icodprodpd,
                :crefprod, :qtditestsp, :icodempfs, :icodfilialfs, :icodfase, :icodemple, :icodfilialle, :ccodlote, :iseqof, :codempts, :codfilialts, :codtipomovsp
           );



        end


    end

end
^

/* Alter (PPRELCUSTOSP) */
ALTER PROCEDURE PPRELCUSTOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DTESTOQ DATE,
ICODEMPMC INTEGER,
SCODFILIALMC SMALLINT,
CCODMARCA CHAR(6),
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14),
CTIPOCUSTO CHAR,
ICODEMPAX INTEGER,
SCODFILIALAX SMALLINT,
ICODALMOX INTEGER)
 RETURNS(CODPROD INTEGER,
REFPROD VARCHAR(20),
DESCPROD CHAR(50),
TIPOPROD VARCHAR(2),
SLDPROD NUMERIC(15,5),
CUSTOUNIT NUMERIC(15,5),
CUSTOTOT NUMERIC(15,5))
 AS
begin
  /* Procedure Text */
  IF (ICODEMPGP IS NOT NULL) THEN
  BEGIN
    IF (STRLEN(RTRIM(CCODGRUP))<14) THEN
       CCODGRUP = RTRIM(CCODGRUP)||'%';
  END
  IF (CTIPOCUSTO IS NULL) then
     CTIPOCUSTO = 'P';

  FOR SELECT P.CODPROD,P.REFPROD,P.DESCPROD, P.TIPOPROD
   FROM EQPRODUTO P
   WHERE P.CODEMP = :ICODEMP AND P.CODFILIAL = :SCODFILIAL AND
   ( (:ICODEMPMC IS NULL) OR (P.CODEMPMC=:ICODEMPMC AND P.CODFILIALMC=:SCODFILIALMC AND
      P.CODMARCA=:CCODMARCA) ) AND
   ((:ICODEMPGP IS NULL) OR (P.CODEMPGP=:ICODEMPGP AND P.CODFILIALGP=:SCODFILIALGP AND
      P.CODGRUP LIKE :CCODGRUP) )
   INTO :CODPROD, :REFPROD, :DESCPROD, :TIPOPROD  DO
  BEGIN
     SELECT CUSTOUNIT,SLDPROD FROM PPCUSTOPRODSP(:ICODEMP,
        :SCODFILIAL, :CODPROD, :DTESTOQ, :CTIPOCUSTO, :ICODEMPAX,
        :SCODFILIALAX, :ICODALMOX, 'N')
       INTO :CUSTOUNIT, :SLDPROD;
     CUSTOTOT = CUSTOUNIT * SLDPROD;
     SUSPEND;
  END
end
^

/* Alter (SGCALCVENCSP) */
ALTER PROCEDURE SGCALCVENCSP(CODEMP INTEGER,
DTBASE DATE,
DTVENC DATE,
REGRVCTO CHAR,
RVSAB CHAR,
RVDOM CHAR,
RVFER CHAR,
RVDIA CHAR,
DIAVCTO SMALLINT,
DIASVCTO SMALLINT)
 RETURNS(DTVENCRET DATE)
 AS
declare variable maxloop smallint;
declare variable curloop smallint;
declare variable dttemp date;
declare variable valorinc smallint;
declare variable codfilial smallint;
declare variable curloop02 smallint;
begin
  DTVENCRET = DTVENC;

  -- Busca o codigo da filial que será utilizado em duas regras
  if ( (REGRVCTO<>'N') and (RVFER = 'S') ) then
  begin
     SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'SGFERIADO') INTO :CODFILIAL;
  end

  -- Logica pra dia fixo
  if ( RVDIA = 'F' ) then
  begin
     MAXLOOP = 2;
     CURLOOP = 1;
     while ( CURLOOP<MAXLOOP ) do
     begin
        DTTEMP = DTVENCRET + ( 1 - EXTRACT(DAY FROM DTVENCRET) );
        DTTEMP = DTTEMP + DIAVCTO - 1;
        -- Objetivo do loop é voltar quando o dia fixo for no final do mês.
        while ( ( ( extract( month from DTVENCRET ) ) < ( extract( month from DTTEMP ) ) ) or
                ( ( extract( year from DTVENCRET ) ) < ( extract( year from DTTEMP ) ) ) ) do
        begin
           DTTEMP = DTTEMP - 1;
        end
        DTVENCRET = DTTEMP;
        if ( DTVENCRET<DTBASE ) then
        begin
           DTVENCRET = addmonth(DTVENCRET,1);
        end
        else
        begin
           break;
        end
        CURLOOP = CURLOOP + 1;
     end
  end
  -- Logica para ajustar dias uteis
  else if ( RVDIA = 'U' ) then
  begin
     while ( ( extract(month from DTVENCRET)<=extract(month from DTBASE) ) and
             ( extract(year from DTVENCRET)<=extract(year from DTBASE ) ) and
             ( DIASVCTO>0 ) ) do
     begin
        DTVENCRET = addmonth(DTVENCRET,1);
     end
     DTTEMP = DTVENCRET + ( 1 - EXTRACT(DAY FROM DTVENCRET) );
     DTVENCRET = DTTEMP;
     if (DIAVCTO<28) then -- Se for menor que dia 28 calcula o dia útil
     begin                -- Caso contrário vai será o último dia útil.
        CURLOOP02 = 1;
        while (CURLOOP02<12) do
        begin
           CURLOOP = 1;
           MAXLOOP = DIAVCTO;
           while ( CURLOOP < MAXLOOP )  do
           begin
              DTTEMP = null;
              if (RVFER='S') then
              begin
                 SELECT DATAFER FROM SGFERIADO F
                   WHERE F.CODEMP=:CODEMP AND F.CODFILIAL=:CODFILIAL AND
                     F.DATAFER=:DTVENCRET AND F.BANCFER='S'
                       INTO :DTTEMP;
              end
              if ( ( (extract( weekday from DTVENCRET )=0) and (RVDOM='S')  ) or
                   ( (extract( weekday from DTVENCRET )=6) and (RVSAB='S')  ) or
                   ( (RVFER='S') and (DTVENCRET=DTTEMP) ) ) then
              begin
                 DTVENCRET = DTVENCRET + 1;
              end
              else
              begin

                 DTVENCRET = DTVENCRET + 1;
                 CURLOOP = CURLOOP + 1;
              end
           end
           if (DTVENCRET<=DTBASE) then
           begin
              DTTEMP = DTVENCRET + ( 1 - EXTRACT(DAY FROM DTVENCRET) );
              DTVENCRET = DTTEMP;
              while ( ( extract(month from DTVENCRET)<=extract(month from DTBASE) ) and
                  ( extract(year from DTVENCRET)<=extract(year from DTBASE ) ) ) do
              begin
                 DTVENCRET = addmonth(DTVENCRET,1);
              end
           end
           else
           begin
              break;
           end
           CURLOOP02 = CURLOOP02 + 1;
        end
     end
     else
     begin
        DTTEMP = addmonth(DTVENCRET,1);
        DTVENCRET = DTTEMP - 1;
     end
  end

--  if (extract(month from dtvencret)=8) then
--  begin
--     exception fnreceberex02 'VENCIMENTO: '||CAST(dtvencret AS CHAR(10))||'REGRAVCTO = ' || REGRVCTO || 'REGRA DIA '|| RVDIA;

--  end


  -- Logica para ajustar finais de semana e feriados
  if ( (REGRVCTO<>'N') ) then
  begin
     MAXLOOP = 30;
     CURLOOP = 1;
     if ( REGRVCTO='A' ) then
     begin
        VALORINC = -1;
     end
     else
     begin
        VALORINC = 1;
     end
     while (CURLOOP<MAXLOOP) do
     begin
        if ( ( (extract( weekday from dtvencret )=0) and (RVDOM='S')  ) or
             ( (extract( weekday from dtvencret )=6) and (RVSAB='S')  ) ) then
        begin
           DTVENCRET = DTVENCRET + VALORINC;
        end
        else if (RVFER='S') then
        begin
           DTTEMP = NULL;
           SELECT DATAFER FROM SGFERIADO F
             WHERE F.CODEMP=:CODEMP AND F.CODFILIAL=:CODFILIAL AND
               F.DATAFER=:DTVENCRET AND F.BANCFER='S'
                 INTO :DTTEMP;
           if ( (DTTEMP IS NOT NULL) AND (DTTEMP=DTVENCRET) ) then
           begin
             DTVENCRET = DTVENCRET + VALORINC;
           end
           else
           begin
             break;
           end
        end
        else
        begin
           break;
        end
        CURLOOP = CURLOOP + 1;
     end
  end
  suspend;
end
^

/* Alter (SGRETVERSAO) */
ALTER PROCEDURE SGRETVERSAO RETURNS(VERSAO VARCHAR(30))
 AS
begin
    versao = '1.2.4.5 (20/05/2011)';
    suspend;
end
^

/* Alter (VDADICCOMISSAOSP) */
ALTER PROCEDURE VDADICCOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRVENDACOMI NUMERIC(15,5),
NVLRCOMI NUMERIC(15,5),
DDATACOMI DATE,
DDTCOMPCOMI DATE,
DDTVENCCOMI DATE,
CTIPOCOMI CHAR,
CODEMPVD INTEGER,
CODFILIALVD SMALLINT,
CODVEND INTEGER)
 AS
declare variable scodfilialcs smallint;
declare variable icodcomi integer;
declare variable cstatuscomi char(2);
begin

    -- Se o valor for nulo ou 0 deve deletar a comissão já gerada
    if ( (nvlrcomi is null) or  (nvlrcomi=0) ) then
    begin

        delete from vdcomissao co
        where co.codemprc=:icodemp and co.codfilialrc=:scodfilial and co.codrec=:icodrec and co.nparcitrec=:inparcitrec and
        co.tipocomi=:ctipocomi and codempvd=:codempvd and codfilialvd=:codfilialvd and codvend=:codvend;

    end
    -- Caso seja um estorno de comissão
    else if (nvlrcomi<0) then
    begin

        -- Buscando a filial da tabela de comissões
        select icodfilial from sgretfilial(:icodemp,'VDCOMISSAO') into :scodfilialcs;

        -- Buscando novo numero para
        select max(codcomi) from vdcomissao where codemp=:icodemp and codfilialvd = :scodfilialcs into icodcomi;

        if (:icodcomi is null) then
            icodcomi = 1;
        else
            icodcomi = icodcomi + 1;

        -- Inserindo na tabela de comissões
        insert into vdcomissao (
            codemp, codfilial, codcomi, codempRc, codfilialrc, codrec, nparcitrec, vlrvendacomi, vlrcomi, datacomi,
            dtcompcomi, dtvenccomi, statuscomi, tipocomi, codempvd, codfilialvd, codvend )
        values (
            :icodemp, :scodfilialcs, :icodcomi, :icodemp, :scodfilial, :icodrec, :inparcitrec, :nvlrvendacomi, :nvlrcomi, :ddatacomi,
            :ddtcompcomi, :ddtvenccomi, 'CE', :ctipocomi, :codempvd, :codfilialvd,:codvend
            );

        -- Transforma o valor da comissão em positivo e programa para o proximo pagto.
        nvlrcomi = nvlrcomi * -1;

        insert into vdcomissao (
            codemp, codfilial, codcomi, codemprc, codfilialrc, codrec, nparcitrec,
            vlrvendacomi, vlrcomi, datacomi, dtcompcomi,  dtvenccomi, statuscomi, tipocomi, codempvd, codfilialvd, codvend )
        values (
            :icodemp, :scodfilialcs, :icodcomi, :icodemp, :scodfilial, :icodrec, :inparcitrec,
            :nvlrvendacomi, :nvlrcomi, :ddatacomi, :ddtcompcomi, :ddtvenccomi, 'C1', :ctipocomi, :codempvd,:codfilialvd,:codvend
            );

    end
    else
    begin

        if (ctipocomi='F') then
            cstatuscomi = 'C2';
        else
            cstatuscomi = 'C1';

        -- Buscando a filial da tabela de comissões
        select icodfilial from sgretfilial( :icodemp, 'VDCOMISSAO') into :scodfilialcs;

        -- Buscando o código da comissão já existente
        select codcomi from vdcomissao
        where codemp=:icodemp and codfilialrc=:scodfilial and codrec=:icodrec and nparcitrec=:inparcitrec and
        tipocomi=:ctipocomi and codempvd=:codempvd and codfilialvd=:codfilialvd and codvend=:codvend
        into :icodcomi;

        -- Caso já não exista a comissão deve inserir
        if (icodcomi is null) then
        begin
            --Buscando um novo código
            select max(codcomi) from vdcomissao where codemp=:icodemp and codfilial = :scodfilialcs into icodcomi;

            if (:icodcomi is null) then
                icodcomi = 1;
            else
                icodcomi = icodcomi + 1;

            -- Inserindo na tabela de comissões
            insert into vdcomissao( codemp, codfilial, codcomi, codemprc, codfilialrc, codrec, nparcitrec,
            vlrvendacomi, vlrcomi, datacomi, dtcompcomi, dtvenccomi, statuscomi, tipocomi, codempvd, codfilialvd, codvend)
            values (
                :icodemp, :scodfilialcs, :icodcomi, :icodemp, :scodfilial, :icodrec, :inparcitrec,
                :nvlrvendacomi, :nvlrcomi, :ddatacomi, :ddtcompcomi, :ddtvenccomi, :cstatuscomi, :ctipocomi, :codempvd, :codfilialvd, :codvend
            );

        end
        -- Se encontrou a comissão atualiza
        else
        begin

            update vdcomissao set vlrvendacomi=:nvlrvendacomi, vlrcomi=:nvlrcomi, datacomi=:ddatacomi,
            dtvenccomi=:ddtvenccomi, statuscomi=:cstatuscomi
            where codemp=:icodemp and codfilial=:scodfilialcs and codcomi=:icodcomi and codempvd=:codempvd and
            codfilialvd=:codfilialvd and codvend=:codvend and statuscomi!='CP' ;

        end

    end
    suspend;
end
^

/* Alter (VDADICITEMPDVSP) */
ALTER PROCEDURE VDADICITEMPDVSP(CODVENDA INTEGER,
CODEMP INTEGER,
CODFILIAL CHAR(8),
CODPROD INTEGER,
CODEMPPD INTEGER,
CODFILIALPD INTEGER,
QTDITVENDA NUMERIC(9,5),
VLRPRECOITVENDA NUMERIC(18,5),
VLRDESCITVENDA NUMERIC(18,5),
PERCDESCITVENDA NUMERIC(15,5),
VLRCOMISITVENDA NUMERIC(15,5),
PERCCOMISITVENDA NUMERIC(15,5),
SCODLOTE VARCHAR(20),
CODEMPLE INTEGER,
CODFILIALLE SMALLINT,
CODFILIALCV SMALLINT,
CODCONV INTEGER)
 RETURNS(CODITVENDA INTEGER,
PERCICMSITVENDA NUMERIC(9,2),
VLRBASEICMSITVENDA NUMERIC(18,3),
VLRICMSITVENDA NUMERIC(18,3),
VLRLIQITVENDA NUMERIC(18,3),
TIPOFISC CHAR(2))
 AS
declare variable icodfilialnt smallint;
declare variable icodcli integer;
declare variable icodfilialcl integer;
declare variable icodtipomov integer;
declare variable icodfilialtm integer;
declare variable scodnat char(4);
declare variable sorigfisc char(1);
declare variable scodtrattrib char(2);
declare variable icodfilialtt smallint;
declare variable icodfilialme smallint;
declare variable icodmens smallint;
declare variable percipiitvenda numeric(9,2);
declare variable vlrbaseipiitvenda numeric(15,5);
declare variable vlripiitvenda numeric(15,5);
declare variable vlrproditvenda numeric(15,5);
declare variable srefprod varchar(20);
declare variable obsitorc varchar(500);
declare variable ufcli char(2);
declare variable ufflag char(1);
declare variable percred numeric(9,2);
begin

  SELECT MAX(CODITVENDA)+1 FROM VDITVENDA WHERE CODVENDA=:CODVENDA
    AND CODFILIAL=:CODFILIAL AND CODEMP=:CODEMP INTO CODITVENDA;

  IF (CODITVENDA IS NULL) THEN
    CODITVENDA = 1;

/*Informações da Venda.:*/

  SELECT V.CODCLI,V.CODFILIALCL,C.UFCLI,V.CODTIPOMOV,V.CODFILIALTM FROM VDVENDA V, VDCLIENTE C
    WHERE V.CODEMP=:CODEMP AND V.CODFILIAL=:CODFILIAL
    AND V.CODVENDA=:CODVENDA AND V.TIPOVENDA='E' AND
    C.CODCLI=V.CODCLI AND C.CODEMP=V.CODEMPCL AND
    C.CODFILIAL=V.CODFILIALCL INTO ICODCLI,ICODFILIALCL,UFCLI,ICODTIPOMOV,ICODFILIALTM;


  UFFLAG = 'N';

  SELECT 'S' FROM SGFILIAL  WHERE CODEMP=:CODEMP
    AND CODFILIAL=:CODFILIAL AND UFFILIAL=:UFCLI INTO UFFLAG;


  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'LFNATOPER') INTO ICODFILIALNT;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'LFTRATTRIB') INTO ICODFILIALTT;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'LFMENSAGEM') INTO ICODFILIALME;

  SELECT C.ALIQIPIFISC
      FROM EQPRODUTO P, LFITCLFISCAL C
         WHERE P.CODPROD=:CODPROD AND P.CODFILIAL=:CODFILIALPD
         AND P.CODEMP=:CODEMPPD AND C.CODFISC=P.CODFISC AND C.CODFILIAL=P.CODFILIALFC and
         C.geralfisc='S'
         AND C.CODEMP=P.CODEMPFC INTO PERCIPIITVENDA;

  SELECT CODNAT FROM
      LFBUSCANATSP(:CODFILIAL,:CODEMP,:CODFILIALPD,
                   :CODPROD,:CODEMP,:ICODFILIALCL,
                   :ICODCLI,NULL,NULL,NULL,:ICODFILIALTM,:ICODTIPOMOV,null)
      INTO SCODNAT;

  IF (SCODNAT IS NULL) THEN
      EXCEPTION VDITVENDAEX03;

  SELECT TIPOFISC,REDFISC,CODTRATTRIB,ORIGFISC,CODMENS,ALIQFISC FROM
      LFBUSCAFISCALSP(:CODEMP,:CODFILIALPD,:CODPROD,
                      :CODEMP,:ICODFILIALCL,:ICODCLI,
                      :CODEMP,:ICODTIPOMOV,:ICODFILIALTM, 'VD',:SCODNAT,null,null,null,null)
      INTO TIPOFISC,PERCRED,SCODTRATTRIB,SORIGFISC,ICODMENS,PERCICMSITVENDA;

  VLRPRODITVENDA = (QTDITVENDA*VLRPRECOITVENDA);
  VLRBASEIPIITVENDA = 0;
  VLRBASEICMSITVENDA = 0;
  VLRICMSITVENDA = 0;
  VLRIPIITVENDA = 0;
  IF (PERCIPIITVENDA IS NULL) THEN
     PERCIPIITVENDA = 0;

  IF ( TIPOFISC = 'II') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'FF') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'NN') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'TT') THEN
  BEGIN
    IF (PERCICMSITVENDA = 0 OR PERCICMSITVENDA IS NULL) THEN
      SELECT PERCICMS FROM LFBUSCAICMSSP (:SCODNAT,:UFCLI,:CODEMP,:CODFILIAL) INTO PERCICMSITVENDA;
    IF (PERCRED IS NULL) THEN
      PERCRED = 0;
    VLRBASEICMSITVENDA = (VLRPRODITVENDA-VLRDESCITVENDA) - ((VLRPRODITVENDA-VLRDESCITVENDA)*(PERCRED/100));
    VLRBASEIPIITVENDA = VLRPRODITVENDA-VLRDESCITVENDA;
    VLRICMSITVENDA = VLRBASEICMSITVENDA*(PERCICMSITVENDA/100);
    VLRIPIITVENDA = VLRBASEIPIITVENDA*(PERCIPIITVENDA/100);
  END
  VLRLIQITVENDA= VLRPRODITVENDA+VLRIPIITVENDA-VLRDESCITVENDA;
  INSERT INTO VDITVENDA (
     CODEMP,CODFILIAL,TIPOVENDA,CODVENDA,CODITVENDA,
     CODEMPNT,CODFILIALNT,CODNAT,
     CODEMPPD,CODFILIALPD,CODPROD,
     CODEMPLE,CODFILIALLE,CODLOTE,
     QTDITVENDA,PRECOITVENDA,PERCDESCITVENDA,VLRDESCITVENDA,
     VLRCOMISITVENDA,PERCCOMISITVENDA,
     PERCICMSITVENDA,VLRBASEICMSITVENDA,VLRICMSITVENDA,
     PERCIPIITVENDA,VLRBASEIPIITVENDA,VLRIPIITVENDA,VLRLIQITVENDA,
     VLRPRODITVENDA,REFPROD,ORIGFISC,
     CODEMPTT,CODFILIALTT,CODTRATTRIB,TIPOFISC,
     CODEMPME,CODFILIALME,CODMENS,OBSITVENDA,
     CODEMPCV,CODFILIALCV,CODCONV) VALUES (
     :CODEMP,:CODFILIAL,'E',:CODVENDA,:CODITVENDA,
     :CODEMP,:ICODFILIALNT,:SCODNAT,
     :CODEMPPD,:CODFILIALPD,:CODPROD,
     :CODEMPLE,:CODFILIALLE,:SCODLOTE,
     :QTDITVENDA,:VLRPRECOITVENDA,:PERCDESCITVENDA,:VLRDESCITVENDA,
     :VLRCOMISITVENDA,:PERCCOMISITVENDA,
     :PERCICMSITVENDA,:VLRBASEICMSITVENDA,:VLRICMSITVENDA,
     :PERCIPIITVENDA,:VLRBASEIPIITVENDA,:VLRIPIITVENDA,:VLRLIQITVENDA,
     :VLRPRODITVENDA,:SREFPROD,:SORIGFISC,
     :CODEMP,:ICODFILIALTT,:SCODTRATTRIB,:TIPOFISC,
     :CODEMP,:ICODFILIALME,:ICODMENS,:OBSITORC,
     :CODEMP, :CODFILIALCV,:CODCONV);
  SUSPEND;
END
^

/* Alter (VDADICITORCRECMERCSP) */
ALTER PROCEDURE VDADICITORCRECMERCSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
TICKET INTEGER,
CODEMPOC INTEGER,
CODFILIALOC SMALLINT,
CODORC INTEGER,
COMPONENTES CHAR,
SERVICOS CHAR,
NOVOS CHAR)
 AS
declare variable codemppd integer;
declare variable codfilialpd integer;
declare variable codprod integer;
declare variable coditos integer;
declare variable coditorc integer;
declare variable codprodant integer;
declare variable coditrecmerc integer;
declare variable refprod varchar(20);
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable precoitorc numeric(15,5);
declare variable qtditorc numeric(15,5);
declare variable codempcl integer;
declare variable codfilialcl smallint;
declare variable codcli integer;
declare variable codemppg integer;
declare variable codfilialpg smallint;
declare variable codplanopag integer;
declare variable gerachamado char(1);
declare variable obsitorc varchar(10000);
declare variable descprod char(100);
declare variable vlrliqitorc numeric(15,5);
declare variable vlrproditorc numeric(15,5);
declare variable usaprecopecaserv char(1);
declare variable codprodpeca integer;
declare variable garantia char(1);
declare variable codprodir integer;
declare variable refprodir varchar(20);
begin
    
    -- Buscando preferencias do GMS
    select coalesce(p8.usaprecopecaserv,'N') from sgprefere8 p8
    where p8.codemp=:codemp and p8.codfilial=:codfilial
    into :usaprecopecaserv;

    -- Buscando informações do orçamento
    select codempcl, codfilialcl, codcli, codemppg, codfilialpg, codplanopag, codemptm, codfilialtm, codtipomov
    from vdorcamento
    where codemp=:codempoc and codfilial=:codfilialoc and codorc=:codorc and tipoorc='O'
    into :codempcl, :codfilialcl, :codcli, :codemppg, :codfilialpg, :codplanopag, :codemptm, :codfilialtm, :codtipomov;

    -- Sendo um orçamento para peças e mão-de-obra
    -- Deve gerar orçamento dos ítens de suplemento
    for select ir.codemppd, ir.codfilialpd, ir.codprodpd, ir.refprodpd, ir.coditrecmerc, ir.coditos, ir.qtditos,
        ir.gerachamado, pd.descprod, irm.codprod, irm.garantia, irm.codprod codprodir, irm.refprod refprodir
        from eqitrecmercitos ir, eqitrecmerc irm, eqproduto pd
        where
        irm.codemp=ir.codemp and irm.codfilial=ir.codfilial and irm.ticket=ir.ticket and irm.coditrecmerc=ir.coditrecmerc
        and pd.codemp=irm.codemppd and pd.codfilial=irm.codfilialpd and irm.codprod=pd.codprod
        and ir.codemp=:codemp and ir.codfilial=:codfilial and ir.ticket=:ticket and
        -- Filtrando componentes e serviços
        (
           (ir.gerarma=:componentes and ir.gerarma='S') or
           (ir.gerachamado=:servicos and ir.gerachamado='S') or
           (ir.geranovo=:novos and ir.geranovo='S')
        )

        into :codemppd, :codfilialpd, :codprod, :refprod, :coditrecmerc, :coditos, :qtditorc,
             :gerachamado, :descprod, :codprodpeca, :garantia, :codprodir, :refprodir
        do
        begin

--            if(:codprod <> :codprodant or :codprodant is null) then
--            begin

                -- Verifica se é serviço, sendo serviço insere a descriçao do produto
                -- consertado na descrição auxiliar do item de orçamento
                if(:gerachamado=:servicos and :gerachamado='S') then
                begin
                    if( 'N' = :garantia ) then
                    begin
                        obsitorc = :refprodir || ' - ' || :descprod;
                    end
                    else
                    begin
                        obsitorc = :refprodir || ' - ' || :descprod || '[G]';
                    end

                end

                --Buscando código do item de orçamento
                select coalesce(max(coditorc)+1,1) from vditorcamento io
                where io.codemp=:codempoc and io.codfilial=:codfilialoc and io.codorc=:codorc and io.tipoorc='O'
                into :coditorc;

                -- Buscando preço de venda
                -- Se não está em garantia...

                if('N' = :garantia) then
                begin
                    -- Se o preço é basedo na peca, deve buscar o preço da peça
                    if(usaprecopecaserv='S') then
                    begin
                        select preco from vdbuscaprecosp(:codprodpeca,:codcli,:codempcl,:codfilialcl,
                        :codplanopag,:codemppg,:codfilialpg,:codtipomov,:codemptm,:codfilialtm,:codemp,:codfilial)
                        into :precoitorc;
                    end
                    else
                    begin
                        select preco from vdbuscaprecosp(:codprod,:codcli,:codempcl,:codfilialcl,
                        :codplanopag,:codemppg,:codfilialpg,:codtipomov,:codemptm,:codfilialtm,:codemp,:codfilial)
                        into :precoitorc;
                    end
                end
                else
                begin

                    precoitorc = 0.00;

                end

                -- Buscando informações do produto
                select pd.codempax, pd.codfilialax, pd.codalmox, pd.refprod from eqproduto pd
                where pd.codemp=:codemppd and pd.codfilial=:codfilialpd and pd.codprod=:codprod
                into :codempax, :codfilialax, :codalmox, :refprod;

                vlrproditorc = :qtditorc * :precoitorc;
                vlrliqitorc = vlrproditorc;

                -- Inserir itens
                insert into vditorcamento (
                codemp, codfilial, codorc, tipoorc, coditorc,
                codemppd, codfilialpd, codprod, refprod,
                qtditorc, precoitorc, codempax, codfilialax, codalmox, obsitorc, vlrproditorc, vlrliqitorc, sitproditorc)
                values (:codempoc, :codfilialoc, :codorc, 'O', :coditorc,
                :codemppd, :codfilialpd, :codprod, :refprod,
                :qtditorc, :precoitorc, :codempax, :codfilialax, :codalmox, :obsitorc, :vlrproditorc, :vlrliqitorc,
                'PE') ;

                -- Inserindo vínculo entre item de orçamento e ordem de serviço

                insert into eqitrecmercitositorc(codemp, codfilial, ticket, coditrecmerc, coditos, codempoc, codfilialoc, codorc, coditorc, tipoorc)
                values(:codemp,:codfilial,:ticket,:coditrecmerc,:coditos, :codempoc,:codfilialoc,:codorc,:coditorc,'O');

                codprodant = codprod;

--            end
        end

        -- Atualizando o status da ordem de serviço
        update eqrecmerc rm set rm.status = 'EO'
        where rm.codemp=:codemp and rm.codfilial=:codfilial and rm.ticket=:ticket;

end
^

/* Alter (VDADICITVENDAORCSP) */
ALTER PROCEDURE VDADICITVENDAORCSP(FILIALATUAL INTEGER,
ICODVENDA INTEGER,
ICODORC INTEGER,
ICODITORC INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER,
STIPOVENDA CHAR(10),
TPAGRUP CHAR,
IQTDITVENDA NUMERIC(15,5),
VLRDESCITVENDA NUMERIC(15,5))
 AS
declare variable icoditvenda integer;
declare variable icodfilialnt smallint;
declare variable codempax integer;
declare variable codfilialax integer;
declare variable codalmox integer;
declare variable icodcli integer;
declare variable icodfilialtm integer;
declare variable icodtipomov integer;
declare variable icodfilialcl integer;
declare variable scodnat char(4);
declare variable icodfilialle smallint;
declare variable scodlote varchar(20);
declare variable tipofisc char(2);
declare variable sorigfisc char(1);
declare variable scodtrattrib char(2);
declare variable icodfilialtt smallint;
declare variable icodfilialme smallint;
declare variable icodmens smallint;
declare variable percicmsitvenda numeric(15,5);
declare variable vlrbaseicmsitvenda numeric(15,5);
declare variable vlricmsitvenda numeric(15,5);
declare variable percipiitvenda numeric(15,5);
declare variable vlrbaseipiitvenda numeric(15,5);
declare variable vlripiitvenda numeric(15,5);
declare variable icodprod integer;
declare variable icodfilialpd integer;
declare variable vlrprecoitvenda numeric(15,5);
declare variable percdescitvenda numeric(15,5);
declare variable vlrliqitvenda numeric(15,5);
declare variable vlrproditvenda numeric(15,5);
declare variable obsitorc varchar(500);
declare variable ufcli char(2);
declare variable ufflag char(1);
declare variable percred numeric(15,5);
declare variable cloteprod char(1);
declare variable perccomisitvenda numeric(15,5);
declare variable geracomis char(1);
declare variable vlrcomisitvenda numeric(15,5);
declare variable codempif integer;
declare variable codfilialif smallint;
declare variable codfisc char(13);
declare variable coditfisc integer;
declare variable percissitvenda numeric(15,5);
declare variable vlrbaseissitvenda numeric(15,5);
declare variable vlrissitvenda numeric(15,5);
declare variable vlrisentasitvenda numeric(15,5);
declare variable vlroutrasitvenda numeric(15,5);
declare variable tipost char(2);
declare variable vlrbaseicmsstitvenda numeric(15,5);
declare variable vlricmsstitvenda numeric(15,5);
declare variable margemvlagritvenda numeric(15,5);
declare variable srefprod varchar(20);
declare variable stipoprod varchar(2);
declare variable percicmsst numeric(15,5);
declare variable vlrbaseicmsbrutitvenda numeric(15,5);
declare variable tpredicms char(1);
declare variable redbaseicmsst char(1);
begin
-- Inicialização de variaveis

    UFFLAG = 'N';

    select icodfilial from sgretfilial(:ICODEMP,'LFNATOPER') into ICODFILIALNT;
    select icodfilial from sgretfilial(:ICODEMP,'LFTRATTRIB') into ICODFILIALTT;
    select icodfilial from sgretfilial(:ICODEMP,'LFMENSAGEM') into ICODFILIALME;

    select vd.codfilialtm,vd.codtipomov from vdvenda vd where codvenda=:ICODVENDA and codfilial=:ICODFILIAL and codemp=:ICODEMP and tipovenda=:STIPOVENDA
    into ICODFILIALTM,ICODTIPOMOV;

-- Verifica se deve gerar comissão para a venda

    select geracomisvendaorc from sgprefere1 where codemp=:ICODEMP and codfilial=:ICODFILIAL into GERACOMIS;

-- Busca sequencia de numeração do ítem de venda

    select coalesce(max(coditvenda),0)+1 from vditvenda where codvenda=:ICODVENDA and codfilial=:ICODFILIAL and codemp=:ICODEMP and tipovenda=:STIPOVENDA
    into ICODITVENDA;

-- Informações do Orcamento

    select codcli,codfilialcl from vdorcamento where codemp=:ICODEMP and codfilial=:ICODFILIAL and codorc=:ICODORC into ICODCLI,ICODFILIALCL;

-- Informações do item de orçamento

    select it.codemppd, it.codfilialpd,it.codprod,it.precoitorc,it.percdescitorc,it.vlrliqitorc,it.vlrproditorc,it.refprod,it.obsitorc,
    it.codempax,it.codfilialax,it.codalmox,it.codlote,pd.cloteprod,pd.comisprod,pd.tipoprod, it.perccomisitorc, it.vlrcomisitorc
    from vditorcamento it, eqproduto pd
    where it.coditorc=:ICODITORC and it.codorc=:ICODORC and it.codfilial=:ICODFILIAL and it.codemp=:ICODEMP and
    pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and pd.codprod=it.codprod
    into ICODEMP,ICODFILIALPD,ICODPROD,VLRPRECOITVENDA,PERCDESCITVENDA,VLRLIQITVENDA,VLRPRODITVENDA,SREFPROD,OBSITORC,
    CODEMPAX,CODFILIALAX,CODALMOX,SCODLOTE,CLOTEPROD,perccomisitvenda,STIPOPROD,perccomisitvenda,vlrcomisitvenda;

    -- Informações fiscais para a venda

    select coalesce(c.siglauf,c.ufcli)
    from vdorcamento o, vdcliente c
    where o.codorc=:ICODORC and o.codfilial=:ICODFILIAL and o.codemp=:ICODEMP and
    c.codcli=o.codcli and c.codfilial=o.codfilialcl and c.codemp=o.codempcl
    into ufcli;

    -- Busca informações fiscais para o ítem de venda (sem natureza da operação deve retornar apenas o coditfisc)

    select codempif,codfilialif,codfisc,coditfisc
    from lfbuscafiscalsp(:ICODEMP,:ICODFILIALPD,:ICODPROD,:ICODEMP,:ICODFILIALCL,:ICODCLI,:ICODEMP,:ICODFILIALTM,
    :ICODTIPOMOV, 'VD',null,null,null,null,null)
    into CODEMPIF,CODFILIALIF,CODFISC,CODITFISC;

-- Verifica se a venda é para outro estado

    select codnat from lfbuscanatsp(:FILIALATUAL,:ICODEMP,:ICODFILIALPD,:ICODPROD,:ICODEMP,:ICODFILIALCL,
    :ICODCLI,NULL,NULL,NULL,:ICODFILIALTM,:ICODTIPOMOV,:coditfisc)
    into SCODNAT;
    
    if (SCODNAT IS NULL) then
    begin
        exception vditvendaex03 :SREFPROD; -- NÃO FOI POSSÍVEL ENCONTRAR A NATUREZA DA OPERAÇÃO PARA O ÍTEM
    end

-- Busca informações fiscais para o ítem de venda (já sabe o coditfisc)

    select tipofisc,redfisc,codtrattrib,origfisc,codmens,aliqfisc,codempif,codfilialif,codfisc,coditfisc,tipost,
    margemvlagr,aliqipifisc,aliqfiscintra,tpredicmsfisc,redbasest,aliqiss
    from lfbuscafiscalsp(:ICODEMP,:ICODFILIALPD,:ICODPROD,:ICODEMP,:ICODFILIALCL,:ICODCLI,:ICODEMP,:ICODFILIALTM,
    :ICODTIPOMOV, 'VD',:scodnat,:codempif,:codfilialif,:codfisc,:coditfisc)
    into TIPOFISC,PERCRED,SCODTRATTRIB,SORIGFISC,ICODMENS,PERCICMSITVENDA,CODEMPIF,CODFILIALIF,CODFISC,CODITFISC,TIPOST,MARGEMVLAGRITVENDA,
    PERCIPIITVENDA,PERCICMSST, tpredicms, redbaseicmsst, PERCISSITVENDA;

-- Busca lote, caso seja necessário

    if (CLOTEPROD = 'S' and SCODLOTE is null) then
    begin
        select first 1 l.codlote from eqlote l
        where l.codprod=:ICODPROD and l.codfilial=:ICODFILIALPD and l.codemp=:ICODEMP and
        l.venctolote = ( select min(venctolote) from eqlote ls where ls.codprod=l.codprod and ls.codfilial=l.codfilial and ls.codemp=L.codemp and
                         ls.sldliqlote>=:IQTDITVENDA ) and
        l.sldliqlote>=:IQTDITVENDA
        into SCODLOTE;

        ICODFILIALLE = ICODFILIALPD;
    end
    
-- Inicializando valores

    VLRPRODITVENDA = VLRPRECOITVENDA * :IQTDITVENDA;
    VLRLIQITVENDA = VLRPRODITVENDA - :VLRDESCITVENDA;
    VLRBASEIPIITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRIPIITVENDA = 0;

    if (PERCICMSITVENDA = 0 or PERCICMSITVENDA is null) then
    begin
        select coalesce(PERCICMS,0) from lfbuscaicmssp (:SCODNAT,:UFCLI,:ICODEMP,:ICODFILIAL) into PERCICMSST;
    end

    if (PERCRED is null) then
    begin
        PERCRED = 0;
    end

    if(percred>0) then
    begin
        if(:tpredicms='B') then
        begin
            VLRBASEICMSITVENDA = (:VLRPRODITVENDA - :VLRDESCITVENDA) - ( (VLRPRODITVENDA - :VLRDESCITVENDA) * ( PERCRED / 100 ) );
            VLRICMSITVENDA = VLRBASEICMSITVENDA * ( PERCICMSITVENDA / 100 );
        end
        else if(:tpredicms='V') then
        begin
            VLRBASEICMSITVENDA = (:VLRPRODITVENDA - :VLRDESCITVENDA);
            VLRICMSITVENDA = (VLRBASEICMSITVENDA * ( PERCICMSITVENDA / 100 )) -  ( (VLRBASEICMSITVENDA * ( PERCICMSITVENDA / 100 ) * ( PERCRED / 100 ) )) ;
        end
    end
    else
    begin
        VLRBASEICMSITVENDA = :VLRPRODITVENDA - :VLRDESCITVENDA;
        VLRICMSITVENDA = VLRBASEICMSITVENDA * ( PERCICMSITVENDA / 100 );
    end

    VLRBASEIPIITVENDA = :VLRPRODITVENDA - :VLRDESCITVENDA;
    VLRBASEICMSBRUTITVENDA = :VLRPRODITVENDA - :VLRDESCITVENDA;
    VLRIPIITVENDA = VLRBASEIPIITVENDA * ( PERCIPIITVENDA / 100 );

-- **** Calculo dos tributos ***

-- Verifica se é um serviço (Calculo do ISS);

    if (:STIPOPROD = 'S') then
    begin
    -- Carregando aliquota do ISS
    -- Bloco comentado, pois já buscou o percentual do iss através da procedure.
   --     select percissfilial from sgfilial where codemp=:ICODEMP and codfilial=:ICODFILIAL
   --     into PERCISSITVENDA;

    -- Calculando e computando base e valor do ISS;
        if (:PERCISSITVENDA != 0) then
        begin
            VLRBASEISSITVENDA = :VLRLIQITVENDA;
            VLRISSITVENDA = :VLRBASEISSITVENDA * (:PERCISSITVENDA/100);
        end
    end
    else -- Se o item vendido não for SERVIÇO zera ISS
        VLRBASEISSITVENDA = 0;

    -- Se produto for isento de ICMS
    if (:TIPOFISC = 'II') then
    begin
        VLRISENTASITVENDA = :VLRLIQITVENDA;
        VLRBASEICMSITVENDA = 0;
        PERCICMSITVENDA = 0;
        VLRICMSITVENDA = 0;
        VLROUTRASITVENDA = 0;
    end
    -- Se produto for de Substituição Tributária
    else if (:TIPOFISC = 'FF') then
    begin
        if (:TIPOST = 'SI' ) then -- Contribuinte Substituído
        begin
            VLROUTRASITVENDA = :VLRLIQITVENDA;
            VLRBASEICMSITVENDA = 0;
            PERCICMSITVENDA = 0;
            VLRICMSITVENDA = 0;
            VLRISENTASITVENDA = 0;
        end
        else if (:TIPOST = 'SU' ) then -- Contribuinte Substituto
        begin

            if( (:PERCICMSST is null) or (:PERCICMSST=0) ) then
            begin
                select coalesce(PERCICMSINTRA,0) from lfbuscaicmssp (:SCODNAT,:UFCLI,:ICODEMP,:ICODFILIAL)
                into PERCICMSST;
            end

            if(percred>0 and redbaseicmsst='S') then
            begin
            -- Quando há redução na base do icms st , deve usar o valor da base do icms proprio como parametro
               vlrbaseicmsstitvenda = (  (coalesce(margemvlagritvenda,0) + 100) / 100 )  * (  (coalesce(vlrbaseicmsitvenda,0) ) + (coalesce(vlripiitvenda,0)) );
            end
            else
            begin
                -- Quando não há redução na base do icms st deve usar o valor da base bruto (rem redução)
                vlrbaseicmsstitvenda = (  (coalesce(margemvlagritvenda,0) + 100) / 100 )  * (  (coalesce(vlrbaseicmsbrutitvenda,0) ) + (coalesce(vlripiitvenda,0)) );
            end

            VLROUTRASITVENDA = 0;
            VLRISENTASITVENDA = 0;
            VLRICMSSTITVENDA = ( (:VLRBASEICMSSTITVENDA * :PERCICMSST) / 100 ) - (:VLRICMSITVENDA) ;

        end
    end

    -- Se produto não for tributado e não isento

    else if (:TIPOFISC = 'NN') then
    begin
        VLROUTRASITVENDA = :VLRLIQITVENDA;
        VLRBASEICMSITVENDA = 0;
        PERCICMSITVENDA = 0;
        VLRICMSITVENDA = 0;
        VLRISENTASITVENDA = 0;
    end

    -- Se produto for tributado integralmente

    else if (:TIPOFISC = 'TT') then
    begin
        VLROUTRASITVENDA = 0;
        VLRISENTASITVENDA = 0;
    end

    -- Inserindo dados na tabela de ítens de venda

    if ( TPAGRUP <> 'F' ) then
    begin

        insert into vditvenda (codemp,codfilial,codvenda,tipovenda,coditvenda,codempnt,codfilialnt,codnat,codemppd,
        codfilialpd,codprod,codemple,codfilialle,codlote,qtditvenda,precoitvenda,percdescitvenda,vlrdescitvenda,
        percicmsitvenda,vlrbaseicmsitvenda,vlricmsitvenda,percipiitvenda,vlrbaseipiitvenda,vlripiitvenda,vlrliqitvenda,
        vlrproditvenda,refprod,origfisc,codemptt,codfilialtt,codtrattrib,tipofisc,codempme,codfilialme,codmens,obsitvenda,
        codempax,codfilialax,codalmox,perccomisitvenda,vlrcomisitvenda,codempif,codfilialif,codfisc,coditfisc,percissitvenda,
        vlrbaseissitvenda,vlrissitvenda,vlrisentasitvenda,vlroutrasitvenda,tipost,vlrbaseicmsstitvenda,vlricmsstitvenda,
        margemvlagritvenda,vlrbaseicmsbrutitvenda)
        values (:ICODEMP,:ICODFILIAL,:ICODVENDA,:STIPOVENDA,:ICODITVENDA,:ICODEMP,
        :ICODFILIALNT,:SCODNAT,:ICODEMP,:ICODFILIALPD,:ICODPROD,:ICODEMP,:ICODFILIALPD,:SCODLOTE,:IQTDITVENDA,
        :VLRPRECOITVENDA,:PERCDESCITVENDA,:VLRDESCITVENDA,:PERCICMSITVENDA,:VLRBASEICMSITVENDA,:VLRICMSITVENDA,
        :PERCIPIITVENDA,:VLRBASEIPIITVENDA,:VLRIPIITVENDA,:VLRLIQITVENDA,:VLRPRODITVENDA,:SREFPROD,:SORIGFISC,
        :ICODEMP,:ICODFILIALTT,:SCODTRATTRIB,:TIPOFISC,:ICODEMP,:ICODFILIALME,:ICODMENS,:OBSITORC,
        :CODEMPAX,:CODFILIALAX,:CODALMOX,:perccomisitvenda,:vlrcomisitvenda,:CODEMPIF,:CODFILIALIF,:CODFISC,:CODITFISC,
        :PERCISSITVENDA,:VLRBASEISSITVENDA,:VLRISSITVENDA,:VLRISENTASITVENDA,:VLROUTRASITVENDA,:TIPOST,
        :VLRBASEICMSSTITVENDA,:VLRICMSSTITVENDA,:MARGEMVLAGRITVENDA,:vlrbaseicmsbrutitvenda);
    end

-- Atualizando informações de vínculo

    execute procedure vdupvendaorcsp(:ICODEMP,:ICODFILIAL,:ICODORC,:ICODITORC,:ICODFILIAL,:ICODVENDA,:ICODITVENDA,:STIPOVENDA);

end
^

/* Alter (VDADICVENDAORCSP) */
ALTER PROCEDURE VDADICVENDAORCSP(ICODORC INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER,
STIPOVENDA CHAR(10),
NEWCODVENDA INTEGER)
 RETURNS(IRET INTEGER)
 AS
declare variable icodvenda integer;
declare variable ifilialvd smallint;
declare variable icodtipomov integer;
declare variable ifilialtm smallint;
declare variable sserie char(4);
declare variable ifilialse smallint;
declare variable sstatusvenda char(2);
declare variable dperccomvend numeric(9,2);
declare variable icodvend integer;
declare variable icodfilialvd integer;
declare variable icodcli integer;
declare variable icodfilialcl integer;
declare variable icodplanopag integer;
declare variable icodfilialpg integer;
declare variable usapedseq char(1);
declare variable iconta integer;
declare variable icodclcomis integer;
declare variable icodfilialcm integer;
declare variable vlrdescorc numeric(15,5);
BEGIN

/*Cod. Tipo Mov e Sequencia:*/
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'EQTIPOMOV') INTO IFILIALTM;
  SELECT COUNT(P.TIPOPROD) FROM EQPRODUTO P, VDITORCAMENTO I WHERE
    P.CODPROD=I.CODPROD AND P.CODFILIAL=I.CODFILIALPD AND P.CODEMP=I.CODEMPPD
    AND P.TIPOPROD = 'S' AND I.CODORC=:ICODORC
    AND I.CODFILIAL=:ICODFILIAL AND I.CODEMP=:ICODEMP INTO ICONTA;
    
  IF (ICONTA > 0) THEN
    SELECT CODTIPOMOV4,USAPEDSEQ FROM SGPREFERE1
      WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
      INTO ICODTIPOMOV,USAPEDSEQ;
  IF (ICODTIPOMOV IS NULL) THEN  /* CASO AINDA O IF DE CIMA NAO TENHA PREECHIDO... */
    SELECT CODTIPOMOV3,USAPEDSEQ FROM SGPREFERE1
      WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
      INTO ICODTIPOMOV,USAPEDSEQ;

/*Informações basicas:*/

  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'VDVENDA') INTO IFILIALVD;
  IF (USAPEDSEQ='S') THEN
    SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALVD,'VD') INTO ICODVENDA;
  ELSE
    IF ((:NEWCODVENDA > 0) AND (:NEWCODVENDA IS NOT NULL)) THEN
      ICODVENDA = :NEWCODVENDA;
    ELSE
      SELECT MAX(CODVENDA)+1 FROM VDVENDA
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:IFILIALVD
        INTO ICODVENDA;

/*Serie:*/
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'LFSERIE') INTO IFILIALSE;
  SELECT SERIE FROM EQTIPOMOV WHERE CODEMP=:ICODEMP AND CODFILIAL=:IFILIALTM AND CODTIPOMOV=:ICODTIPOMOV INTO SSERIE;

/*Status:*/
  SSTATUSVENDA = 'P1';

/*Busca no orçamento:*/
  SELECT O.CODFILIALVD,O.CODVEND,O.CODFILIALCL,O.CODCLI,O.CODFILIALPG,
    O.CODPLANOPAG,VE.PERCCOMVEND,O.CODCLCOMIS,O.CODFILIALCM, o.vlrdescorc
    FROM VDORCAMENTO O, VDVENDEDOR VE WHERE O.CODORC=:ICODORC
    AND O.CODFILIAL=:ICODFILIAL AND O.CODEMP=:ICODEMP
    AND VE.CODEMP=O.CODEMP AND VE.CODFILIAL=O.CODFILIALVD
    AND VE.CODVEND=O.CODVEND INTO
           :ICODFILIALVD,:ICODVEND,:ICODFILIALCL,:ICODCLI,
           :ICODFILIALPG,:ICODPLANOPAG,DPERCCOMVEND,:ICODCLCOMIS,:ICODFILIALCM,:vlrdescorc;

  INSERT INTO VDVENDA (
    CODEMP,CODFILIAL,CODVENDA,TIPOVENDA,CODEMPVD,CODFILIALVD,CODVEND,CODEMPCL,CODFILIALCL,CODCLI,
    CODEMPPG,CODFILIALPG,CODPLANOPAG,CODEMPSE,CODFILIALSE,SERIE,CODEMPTM,CODFILIALTM,CODTIPOMOV,
    DTSAIDAVENDA,DTEMITVENDA,STATUSVENDA,PERCCOMISVENDA,CODCLCOMIS,CODFILIALCM,CODEMPCM,vlrdescvenda)
    VALUES (
    :ICODEMP,:IFILIALVD,:ICODVENDA,:STIPOVENDA,:ICODEMP,:ICODFILIALVD,:ICODVEND,:ICODEMP,:ICODFILIALCL,:ICODCLI,
    :ICODEMP,:ICODFILIALPG,:ICODPLANOPAG,:ICODEMP,:IFILIALSE,:SSERIE,:ICODEMP,:IFILIALTM,:ICODTIPOMOV,
    CAST('today' AS DATE),CAST('today' AS DATE),:SSTATUSVENDA,:DPERCCOMVEND,:ICODCLCOMIS,:ICODFILIALCM,:ICODEMP,:VLRDESCORC );

  IRET = ICODVENDA;

  SUSPEND;
END
^

/* Alter (VDBAIXACOMISSAOSP) */
ALTER PROCEDURE VDBAIXACOMISSAOSP(STIPO CHAR,
DINI DATE,
DFIM DATE,
ICODVEND INTEGER,
ICODEMPVD INTEGER,
ICODFILIALVD SMALLINT,
SCODCONTA CHAR(10),
ICODEMPCA INTEGER,
ICODFILIALCA SMALLINT,
SCODPLAN CHAR(13),
ICODEMPPN INTEGER,
ICODFILIALPN SMALLINT,
DDATA DATE,
IDOC INTEGER,
DVLR NUMERIC(15,5),
SOBS CHAR(50),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 AS
declare variable icodpcomi integer;
declare variable icodcomi integer;
declare variable icodempcomi integer;
declare variable icodfilialcomi integer;
declare variable cflag char(1);
declare variable ifilialpcomi integer;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNPAGTOCOMI') INTO IFILIALPCOMI;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALPCOMI,'CI') INTO ICODPCOMI;
  INSERT INTO FNPAGTOCOMI(CODEMP,CODFILIAL,CODPCOMI,CODEMPCA,CODFILIALCA,NUMCONTA,CODEMPPN,CODFILIALPN,CODPLAN,DTCOMPPCOMI,DATAPCOMI,DOCPCOMI,VLRPCOMI,OBSPCOMI)
         VALUES (
                :ICODEMP,:IFILIALPCOMI,:iCodPComi,:ICODEMPCA,:ICODFILIALCA,:sCodConta,:ICODEMPPN,:ICODFILIALPN,:sCodPlan,:dData,:dData,:iDoc,:dVlr,:sObs
         );
  FOR SELECT C.CODCOMI,C.CODEMP,C.CODFILIAL,C.FLAG FROM VDCOMISSAO C,FNRECEBER R WHERE R.CODVEND=:iCodVend
               AND R.CODEMPVD=:ICODEMPVD AND R.CODFILIALVD=:ICODFILIALVD
               AND C.CODREC=R.CODREC AND C.CODEMPRC=R.CODEMP AND C.CODFILIALRC=R.CODFILIAL
               AND ( (:STIPO='E') OR  (C.DTVENCCOMI BETWEEN :dIni AND :dFim) )
               AND ( (:STIPO='V') OR  (C.DATACOMI BETWEEN :dIni AND :dFim) )
               AND STATUSCOMI='C2'
               AND R.CODEMP=:ICODEMP AND R.CODFILIAL=:ICODFILIAL
               INTO :iCodComi,:iCodEmpComi,:iCodFilialComi,:cFLAG DO
  BEGIN
     UPDATE VDCOMISSAO SET VLRPAGOCOMI=VLRAPAGCOMI, CODPCOMI=:iCodPComi,CODEMPCI=:ICODEMP,
        CODFILIALCI=:IFILIALPCOMI,STATUSCOMI='CP',DTPAGTOCOMI=:dData,FLAG=:cFLAG
      WHERE CODCOMI=:iCodComi AND CODEMP=:iCodEmpComi AND CODFILIAL=:iCodFilialComi;
  END
END
^

/* Alter (VDCOPIAORCSP) */
ALTER PROCEDURE VDCOPIAORCSP(CODEMP INTEGER,
CODFILIAL INTEGER,
CODORC INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER)
 RETURNS(IRET INTEGER)
 AS
declare variable icodorc integer;
declare variable icodfilialpf integer;
declare variable cusaorcseq char(1);
declare variable vlrprodorc decimal(15,5);
declare variable percdescorc decimal(9,2);
declare variable vlrdescorc decimal(15,5);
declare variable vlradicorc decimal(15,5);
declare variable vlrdescitorc decimal(15,5);
declare variable vlrliqorc decimal(15,5);
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP, 'SGPREFERE1')
    INTO :ICODFILIALPF;
  SELECT USAORCSEQ FROM SGPREFERE1 P
     WHERE P.CODEMP=:CODEMP AND P.CODFILIAL=:ICODFILIALPF
     INTO :CUSAORCSEQ;
  IF (CUSAORCSEQ='S') THEN
  BEGIN
     SELECT ISEQ FROM SPGERANUM(:CODEMP,:CODFILIAL,'OC') INTO ICODORC;
  END
  ELSE
  BEGIN
     SELECT COALESCE(MAX(O.CODORC),0)+1 FROM VDORCAMENTO O
       WHERE O.CODEMP=:CODEMP AND O.CODFILIAL=:CODFILIAL AND
       O.TIPOORC='O' INTO ICODORC;
  END

  INSERT INTO VDORCAMENTO (CODEMP, CODFILIAL, TIPOORC, CODORC,
    CODEMPAE, CODFILIALAE, CODATEND, CODEMPCV, CODFILIALCV, CODCONV,
    DTORC, DTVENCORC, OBSORC, CODPLANOPAG, CODFILIALPG,
    CODEMPPG, TXT01, CODEMPVD, CODFILIALVD, CODVEND, CODEMPCL, CODFILIALCL,
    CODCLI, CODTPCONV, CODFILIALTC, CODEMPTC, PRAZOENTORC, statusorc)
    SELECT CODEMP, CODFILIAL, 'O', :ICODORC, CODEMPAE, CODFILIALAE,
      CODATEND, CODEMPCV, CODFILIALCV, CODCONV, DTORC, DTVENCORC,
      OBSORC, CODPLANOPAG, CODFILIALPG, CODEMPPG, TXT01, CODEMPVD,
      CODFILIALVD, CODVEND, :CODEMP, :CODFILIALCL, :CODCLI, CODTPCONV,
      CODFILIALTC, CODEMPTC, PRAZOENTORC, '*' FROM VDORCAMENTO WHERE
      CODORC=:CODORC AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL;

  INSERT INTO VDITORCAMENTO (CODEMP, CODFILIAL, TIPOORC, CODORC, CODITORC,
    CODEMPPD, CODFILIALPD, CODPROD, QTDITORC, PRECOITORC, PERCDESCITORC,
    VLRDESCITORC, VLRLIQITORC, VLRPRODITORC, REFPROD, NUMAUTORIZORC, ACEITEITORC,
    APROVITORC, EMITITORC, VENCAUTORIZORC, STRDESCITORC, OBSITORC,
    CODEMPAX, CODFILIALAX, CODALMOX)
    SELECT CODEMP, CODFILIAL, TIPOORC, :ICODORC, CODITORC,
      CODEMPPD, CODFILIALPD, CODPROD, QTDITORC, PRECOITORC, PERCDESCITORC,
      VLRDESCITORC, VLRLIQITORC, VLRPRODITORC, REFPROD, null, 'N',
      'N', 'N', VENCAUTORIZORC, STRDESCITORC, OBSITORC,
      CODEMPAX, CODFILIALAX, CODALMOX
      FROM VDITORCAMENTO
      WHERE CODORC=:CODORC AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL;

  SELECT VLRPRODORC, PERCDESCORC,VLRDESCORC,VLRADICORC,VLRDESCITORC,VLRLIQORC
      FROM VDORCAMENTO WHERE CODORC=:CODORC AND CODEMP=:CODEMP AND
      CODFILIAL=:CODFILIAL
      INTO :VLRPRODORC, :PERCDESCORC, :VLRDESCORC, :VLRADICORC, :VLRDESCITORC, :VLRLIQORC;

  UPDATE VDORCAMENTO SET VLRPRODORC=:VLRPRODORC, PERCDESCORC=:PERCDESCORC,
     VLRDESCORC=:VLRDESCORC, VLRADICORC=:VLRADICORC,
     VLRDESCITORC=:VLRDESCITORC, VLRLIQORC=:VLRLIQORC
     WHERE CODORC=:ICODORC AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL;

  IRET = ICODORC;
  SUSPEND;
END
^

/* Alter (VDESTORNACOMISSAOSP) */
ALTER PROCEDURE VDESTORNACOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
ICODVEND INTEGER,
DINI DATE,
DFIM DATE,
CORDEM CHAR)
 AS
declare variable icodcomi integer;
declare variable icodemprc integer;
declare variable scodfilialrc smallint;
declare variable icodrec integer;
declare variable inparcitrec integer;
declare variable nvlrvendacomi numeric(15,5);
declare variable nvlrcomi numeric(15,5);
declare variable ddatacomi date;
declare variable ddtcompcomi date;
declare variable ddtvenccomi date;
declare variable ctipocomi char(1);
declare variable cstatuscomi char(2);
declare variable datual date;
declare variable cstatusitrec char(2);
declare variable ddtvencitrec date;
begin
  /* Procedure Text */
  DATUAL = CAST( 'now' AS DATE);
  FOR SELECT C.CODCOMI,C.CODEMPRC, C.CODFILIALRC , C.CODREC, C.NPARCITREC,
      C.VLRVENDACOMI, C.VLRCOMI, C.DATACOMI , C.DTCOMPCOMI, C.DTVENCCOMI,
      C.TIPOCOMI, C.STATUSCOMI , IR.STATUSITREC, IR.DTVENCITREC
    FROM VDCOMISSAO C, FNITRECEBER IR, FNRECEBER R
    WHERE C.CODEMP=:ICODEMP AND C.CODFILIAL=:SCODFILIAL AND
       IR.CODEMP=C.CODEMPRC AND IR.CODFILIAL=C.CODFILIALRC AND
       IR.CODREC=C.CODREC AND IR.NPARCITREC=C.NPARCITREC AND
       R.CODEMP=C.CODEMPRC AND R.CODFILIAL=C.CODFILIALRC AND
       R.CODREC=C.CODREC AND R.CODEMPVD=:ICODEMPVD AND
       R.CODFILIALVD=:SCODFILIALVD AND R.CODVEND=:ICODVEND AND
       ( (:CORDEM = 'V')  OR (C.DATACOMI BETWEEN :DINI AND :DFIM) ) AND
       ( (:CORDEM = 'E')  OR (C.DTVENCCOMI BETWEEN :DINI AND :DFIM) ) AND
       C.STATUSCOMI IN ('C2','CP') AND
       IR.STATUSITREC NOT IN ('RP') AND
       NOT EXISTS(SELECT * FROM VDCOMISSAO C2 /* Sub-select para verificar a */
          /* existencia de estorno anterior. */
         WHERE C2.CODEMPRC=C.CODEMPRC AND C2.CODFILIALRC=C.CODFILIALRC AND
         C2.CODREC=C.CODREC AND C2.NPARCITREC=C.NPARCITREC AND
         C2.TIPOCOMI=C.TIPOCOMI AND C2.STATUSCOMI IN ('CE') )
    INTO :ICODCOMI, :ICODEMPRC, :SCODFILIALRC, :ICODREC, :INPARCITREC, :NVLRVENDACOMI,
      :NVLRCOMI, :DDATACOMI, :DDTCOMPCOMI, :DDTVENCCOMI, :CTIPOCOMI, :CSTATUSCOMI, :CSTATUSITREC,
      :DDTVENCITREC
  DO
  BEGIN
     IF ( (DATUAL>DDTVENCITREC) AND (CSTATUSCOMI='C2') ) THEN
     /* Caso a data atual seja maior que a data de vencimento e a */
     /* comissão não esteja paga, passa o status da comissão para não */
     /* liberada. */
     BEGIN
        UPDATE VDCOMISSAO SET STATUSCOMI='C1'
          WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND
            CODCOMI=:ICODCOMI;
     END
     ELSE IF ( (DATUAL>DDTVENCITREC) AND (CSTATUSCOMI='CP') ) THEN
     /* Caso a comissão esteja paga e a parcela esteja vencida, */
     /* gera um estorno da comissão. */
     BEGIN
        NVLRCOMI = NVLRCOMI * -1; /* Transforma o valor da comissão em negativo */
        /* para gerar estorno */
        EXECUTE PROCEDURE vdadiccomissaosp(:ICODEMPRC,:SCODFILIALRC,:ICODREC,
          :INPARCITREC, :NVLRVENDACOMI, :NVLRCOMI, :DDATACOMI , :DDTCOMPCOMI, :DDTVENCITREC,
          :CTIPOCOMI, :icodempvd, :scodfilialvd, : icodvend );
     END
  END
  suspend;
end
^

/* empty dependent procedure body */
/* Clear: FNITRECEBERSP01 for: VDGERACOMISSAOSP */
ALTER PROCEDURE FNITRECEBERSP01(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
NVLRPARCREC NUMERIC(15,5),
NVLRCOMIREC NUMERIC(15,5),
INROPARCREC INTEGER,
CCLASCOMIS CHAR)
 AS
 BEGIN EXIT; END
^

/* Alter (VDGERACOMISSAOSP) */
ALTER PROCEDURE VDGERACOMISSAOSP(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRCOMIITREC NUMERIC(15,5),
DDTVENCITREC DATE)
 AS
declare variable icodempva integer;
declare variable scodfilialva smallint;
declare variable ctipovenda char(3);
declare variable icodvenda integer;
declare variable icodempcm integer;
declare variable scodfilialcm smallint;
declare variable icodclcomis integer;
declare variable nvlrvendacomi numeric(15,5);
declare variable ddatacomi date;
declare variable ddtcompcomi date;
declare variable npercfatclcomis numeric(9,2);
declare variable npercpgtoclcomis numeric(9,2);
declare variable ctipocomi char(1);
declare variable nvlrcomi numeric(15,5);
declare variable i integer;
declare variable icodemptm integer;
declare variable scodfilialtm smallint;
declare variable icodtipomov integer;
declare variable cmulticomis char(1);
declare variable icodempvd integer; /* Código da empresa do comissionado principal */
declare variable scodfilialvd smallint; /* Código da filial do comissionado principal */
declare variable icodvend integer; /* Código do comissionado principal */
declare variable nperccomisvendadic numeric(15,2); /* Percentual de comissão para cada comissionado adicional */
declare variable nvlrcomiadic numeric(15,5); /* Valor total da comissão para os comissionados adicionais. */
declare variable icodempvdadic integer; /* Código da empresa do comissionado adicional */
declare variable scodfilialvdadic smallint; /* Código da filial do comissionado adicional */
declare variable icodvendadic integer; /* Código do comissionado adicional */
declare variable nvlrcomiparc numeric(15,5); /* Valor da comissão por vendedor parcial. */
begin
    /* Gera as comissões a pagar na tabela VDCOMISSAO */


    nvlrcomiadic = 0;

    select r.codempva, r.codfilialva, r.tipovenda, r.codvenda,
        v.codempcm, v.codfilialcm, v.codclcomis, ( v.vlrprodvenda - v.vlrdescvenda ),
        v.dtemitvenda, v.dtcompvenda, cm.percfatclcomis, cm.percpgtoclcomis,
        v.codemptm, v.codfilialtm, v.codtipomov,
        v.codempvd, v.codfilialvd, v.codvend
        from fnreceber r, vdvenda v, vdclcomis cm
        where r.codemp=:icodemp and r.codfilial=:scodfilial and r.codrec=:icodrec
            and v.codemp=r.codempva and v.codfilial=r.codfilialva and v.tipovenda=r.tipovenda
            and v.codvenda=r.codvenda and cm.codemp=v.codempcm and cm.codfilial=v.codfilialcm
            and cm.codclcomis=v.codclcomis
    into :icodempva, :scodfilialva, :ctipovenda, :icodvenda,
         :icodempcm, :scodfilialcm, :icodclcomis, :nvlrvendacomi,
         :ddatacomi, :ddtcompcomi, :npercfatclcomis, :npercpgtoclcomis,
         :icodemptm, :scodfilialtm, :icodtipomov,
         :icodempvd, :scodfilialvd, :icodvend ;

    /*Verifica se deve utilizar mecanismo de multiplos comissionados*/

    select cmulticomis from sgretmulticomissp(:icodemp, :icodemptm, :scodfilialtm, :icodtipomov)
        into cmulticomis;

    if(cmulticomis = 'S') then
    begin

        /*Implementação do mecanismo de multiplos comissionados*/
        
        for select vc.codempvd, vc.codfilialvd, vc.codvend, vc.percvc
            from vdvendacomis vc
            where vc.codemp=:icodempva and vc.codfilial=:scodfilialva and vc.codvenda=:icodvenda
                and vc.tipovenda=:ctipovenda and vc.codvend is not null
        into :icodempvdadic, :scodfilialvdadic, :icodvendadic, :nperccomisvendadic do
        begin

            /* Calcula o valor da comissão proporcional para cada comissionado adicional*/

            nvlrcomi = cast( ( nvlrcomiitrec * nperccomisvendadic / 100 ) as numeric(15,5));
            I = 1;
            while (:I<=2) do
            begin
                if (I=1) then
                    begin
                        ctipocomi='F';
                        nvlrcomiparc = cast( ( nvlrcomi * npercfatclcomis / 100 ) as NUMERIC(15, 5));
                    end
                else
                    begin
                        ctipocomi='R';
                        nvlrcomiparc = cast( (nvlrcomi * npercpgtoclcomis / 100 ) as NUMERIC(15, 5));
                    end
                execute procedure vdadiccomissaosp(:iCodEmp, :sCodFilial, :iCodRec, :iNParcItRec,
                    :nVlrVendaComi, :nvlrcomiparc, :dDataComi, :dDtCompComi, :dDtVencItRec, cTipoComi,:icodempvdadic, :scodfilialvdadic, :icodvendadic );
                I=I+1;
                /*Acumula as comissões adicionais para posteriormente descontar do valor principal*/
                nvlrcomiadic = nvlrcomiadic + nvlrcomiparc;

           /*     exception vdcomissaoex02 'rodou procedure para o vendedor:' || cast(:icodempvdadic as char(2)) || '-' || cast(:scodfilialvdadic as char(2)) || '-' || cast(:icodvendadic as char(2)) || '-' || ' - nvlrcomiadic:' || cast(nvlrcomiadic as char(20));*/

            end

        end

    end

    /*Comissionamento do vendedor principal*/

    I = 1;
    while (:I<=2) do
        begin
            if (I=1) then
                begin
                    ctipocomi='F';
                    nvlrcomi = cast( ( (nvlrcomiitrec - nvlrcomiadic ) * nPercFatClComis / 100 ) as numeric(15, 5) );
                end
            else
                begin
                    ctipocomi='R';
                    nvlrcomi = cast( ( (nvlrcomiitrec - nvlrcomiadic ) * nPercPgtoClComis / 100 ) as numeric(15, 5));
                end
/*
                exception vdcomissaoex01 ''
                || cast(:icodempvd as char(2)) || '-' || cast(:scodfilialvd as char(2)) || '-' || cast(:icodvend as char(2))
                || 'nvlrcomi:' || cast(:nvlrcomi as char(20))
                || 'nvlrvendacomi:' || cast(:nvlrvendacomi as char(20));
  */
            execute procedure vdadiccomissaosp(:icodemp, :scodfilial, :icodrec, :inparcitrec,
                :nvlrvendacomi, :nvlrcomi, :ddatacomi, :ddtcompcomi, :ddtvencitrec, ctipocomi, :icodempvd, :scodfilialvd, :icodvend );


            I=I+1;
        end

        suspend;
end
^

/* Restore proc. body: CPADICITCOMPRARECMERCSP */
ALTER PROCEDURE CPADICITCOMPRARECMERCSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
TICKET INTEGER,
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
QTDITCOMPRA NUMERIC(15,5))
 AS
declare variable usaprecocot char(1);
declare variable codemppd integer;
declare variable codfilialpd integer;
declare variable codprod integer;
declare variable codprodant integer;
declare variable coditrecmerc integer;
declare variable codnat char(4);
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempfr integer;
declare variable codfilialfr smallint;
declare variable codfor integer;
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable precoitcompra numeric(15,5);
declare variable aprovpreco char(1);
declare variable codemppp integer;
declare variable codfilialpp smallint;
declare variable codplanopag integer;
declare variable vlrproditcompra numeric(15,5);
begin
    
    -- Carregamdo variaveis
    aprovpreco = 'N';

    -- Buscando preferências
    select coalesce(p1.usaprecocot,'N') usaprecocot
    from sgprefere1 p1
    where p1.codemp=:codemp and p1.codfilial=:codfilial
    into :usaprecocot;

    -- Buscando informações da compra
    select cp.codfilialtm, cp.codtipomov,
    cp.codempfr, cp.codfilialfr, cp.codfor,
    cp.codemppg, cp.codfilialpg, cp.codplanopag
    from cpcompra cp
    where cp.codemp=:codempcp and cp.codfilial=:codfilialcp and cp.codcompra=:codcompra
    into :codfilialtm,  :codtipomov, :codempfr, :codfilialfr, :codfor, :codemppp, :codfilialpp, :codplanopag;

    for select ir.codemppd, ir.codfilialpd, ir.codprod, ir.coditrecmerc
        from eqitrecmerc ir
        where
        ir.codemp=:codemp and ir.codfilial=:codfilial and ir.ticket=:ticket
        into :codemppd, :codfilialpd, :codprod, :coditrecmerc
        do
        begin

            if(:codprod <> :codprodant or :codprodant is null) then
            begin

                -- Buscando a natureza da operação
                select codnat from lfbuscanatsp(:codfilial,:codemp,:codfilialpd,:codprod,:codemp,null,null,
                :codempfr,:codfilialfr,:codfor,:codfilialtm,:codtipomov,null)
                into :codnat;

                -- Buscando informações do produto
                select pd.codempax, pd.codfilialax, pd.codalmox from eqproduto pd
                where pd.codemp=:codemppd and pd.codfilial=:codfilialpd and pd.codprod=:codprod
                into :codempax, :codfilialax, :codalmox;

                -- Buscando preço da ultima compra
--                select custounit from eqcustoprodsp(:codemppd, :codfilialpd, :codprod,
--                cast('today' as date),'U',:codempax, :codfilialax, :codalmox,'N')
--                into :precoultcp;

                -- Se deve buscar preço de cotação.
                if( 'S' = :usaprecocot) then
                begin
                    -- Deve implementar ipi, vlrliq etc... futuramente...
                    select first 1 ct.precocot
                    from cpcotacao ct, cpsolicitacao sl, cpitsolicitacao iso
                    left outer join eqrecmerc rm on
                    rm.codemp=:codemp and rm.codfilial=:codfilial and rm.ticket=:ticket
                    where
                    iso.codemp = sl.codemp and iso.codfilial=sl.codfilial and iso.codsol=sl.codsol
                    and ct.codemp=iso.codemp and ct.codfilial=iso.codfilial and ct.codsol=iso.codsol and ct.coditsol=iso.coditsol
                    and iso.codemppd=:codemppd and iso.codfilialpd=:codfilialpd and iso.codprod=:codprod
                    and ct.codempfr=:codempfr and ct.codfilialfr=:codfilialfr and ct.codfor=:codfor
                    and (ct.dtvalidcot>=cast('today' as date) and (ct.dtcot<=cast('today' as date)))
                    and ct.sititsol not in ('EF','CA')

                    and ( (ct.rendacot = rm.rendaamostragem) or ( coalesce(ct.usarendacot,'N') = 'N') )

                    and ( (ct.codemppp=:codemppp and ct.codfilialpp=:codfilialpp and ct.codplanopag=:codplanopag)
                       or (ct.codplanopag is null))

                    order by ct.dtcot desc
                    into :precoitcompra;

                    if(:precoitcompra is not null) then
                    begin
                        -- Indica que o preço é aprovado (cotado anteriormente);
                        aprovpreco = 'S';
                    end

                end

                -- Se não conseguiu obter o preço das cotações
                if(precoitcompra is null) then
                begin
                    -- Buscando preço de compra da tabela de custos de produtos
                    select custounit from eqcustoprodsp(:codemppd, :codfilialpd, :codprod,
                    cast('today' as date),'M',:codempax, :codfilialax, :codalmox,'N')
                    into :precoitcompra;

                end

                vlrproditcompra = :precoitcompra * qtditcompra;


                -- Inserir itens
                insert into cpitcompra (
                codemp, codfilial, codcompra, coditcompra,
                codemppd, codfilialpd, codprod,
                codempnt, codfilialnt, codnat,
                codempax, codfilialax, codalmox,
                qtditcompra, precoitcompra, aprovpreco, vlrproditcompra)
                values (:codempcp, :codfilialcp, :codcompra, :coditrecmerc,
                :codemppd, :codfilialpd, :codprod,
                :codemp,:codfilial,:codnat,
                :codempax,:codfilialax,:codalmox,
                :qtditcompra, :precoitcompra, :aprovpreco, :vlrproditcompra) ;

                -- Inserindo vínculo entre compra e recebimento

                insert into eqitrecmercitcp(codemp, codfilial, ticket, coditrecmerc, codempcp, codfilialcp, codcompra, coditcompra)
                values(:codemp,:codfilial,:ticket,:coditrecmerc,:codempcp,:codfilialcp,:codcompra,:coditrecmerc);

                codprodant = codprod;

            end
        end



  --  suspend;
end
^

/* Restore proc. body: FNCHECAPGTOATRASOSP */
ALTER PROCEDURE FNCHECAPGTOATRASOSP(ICODCLI INTEGER,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
 RETURNS(SRETORNO CHAR)
 AS
declare variable ilinhas integer;
declare variable ifilialreceber integer;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNRECEBER') INTO IFILIALRECEBER;
  SELECT COUNT(*) FROM FNITRECEBER IT WHERE CODREC
         IN (
            SELECT CODREC FROM FNRECEBER REC WHERE REC.CODCLI = :iCodCli
                   AND REC.CODEMPCL=:ICODEMP AND REC.CODFILIALCL=:ICODFILIAL
                   AND REC.CODREC = IT.CODREC
                   AND CODEMP=IT.CODEMP AND CODFILIAL=IT.CODFILIAL
         )
         AND STATUSITREC != 'RP' AND IT.dtvencitrec < cast('today' as date)
         AND IT.CODEMP=:ICODEMP AND IT.CODFILIAL=:IFILIALRECEBER INTO iLinhas;
  IF (iLinhas > 0) THEN
    sRetorno = 'S';
  ELSE
    sRetorno = 'N';
  SUSPEND;
END
^

/* Restore proc. body: FNITRECEBERSP01 */
ALTER PROCEDURE FNITRECEBERSP01(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
NVLRPARCREC NUMERIC(15,5),
NVLRCOMIREC NUMERIC(15,5),
INROPARCREC INTEGER,
CCLASCOMIS CHAR)
 AS
declare variable inparcitrec integer;
declare variable nvlrparcitrec numeric(15,5);
declare variable nperc numeric(10,6);
declare variable nvlrcomiitrec numeric(15,5);
declare variable nresto numeric(15,5);
declare variable dvencitrec date;
begin
    -- Procedure que atualiza a comissão na tabela ITRECEBER
    nResto = nVlrComiRec;

    for select nparcitrec, vlrparcitrec, dtvencitrec from fnitreceber
    where codemp=:icodemp and codfilial=:scodfilial and codrec=:icodrec
    order by nparcitrec
    into :inparcitrec , :nvlrparcitrec, :dvencitrec do

    begin
        nperc = nvlrparcitrec / nvlrparcrec;
        nvlrcomiitrec = cast( (nvlrcomirec * nperc) as numeric(15, 5) );
        nresto = nresto - nvlrcomiitrec;

        if (inparcitrec=inroparcrec) then
        begin
            nvlrcomiitrec = nvlrcomiitrec + nresto;
        end

        update fnitreceber ir set vlrcomiitrec=:nvlrcomiitrec where codemp=:icodemp and codfilial=:scodfilial
        and codrec=:icodrec and nparcitrec=:inparcitrec;

        if (cclascomis='S') then
            execute procedure vdgeracomissaosp(:icodemp, :scodfilial, :icodrec, :inparcitrec, :nvlrcomiitrec, :dvencitrec);
    end
    suspend;
end
^

/* Create trigger... */
CREATE TRIGGER ATESPECATENDTGBU FOR ATESPECATEND
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

CREATE TRIGGER CPIMPORTACAOADICTGBU FOR CPIMPORTACAOADIC
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
    new.dtalt=cast('now' as date);
    new.idusualt=user;
    new.halt = cast('now' as time);
end
^

CREATE TRIGGER CPIMPORTACAOTGBI FOR CPIMPORTACAO
ACTIVE BEFORE INSERT POSITION 0 
AS
begin

    -- Convertendo valores em moeda corrente / estrangeira

    new.vlrfrete    =   new.vlrfretemi      *   new.cotacaomoeda;
    new.vlrseguro   =   new.vlrseguromi     *   new.cotacaomoeda;
    new.vlrthcmi    =   new.vlrthc          /   new.cotacaomoeda;


end
^

CREATE TRIGGER CPIMPORTACAOTGBU FOR CPIMPORTACAO
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
    new.dtalt=cast('now' as date);
    new.idusualt=user;
    new.halt = cast('now' as time);

    -- Não permitindo valores negativos
    if (new.pesobruto       < 0) then new.pesobruto     = 0;
    if (new.pesoliquido     < 0) then new.pesoliquido   = 0;
    if (new.vmlemi          < 0) then new.pesobruto     = 0;
    if (new.vmldmi          < 0) then new.pesobruto     = 0;
    if (new.vlrii           < 0) then new.pesobruto     = 0;
    if (new.vlripi          < 0) then new.pesobruto     = 0;
    if (new.vlrpis          < 0) then new.pesobruto     = 0;
    if (new.vlrcofins       < 0) then new.pesobruto     = 0;
    if (new.vlrtxsiscomex   < 0) then new.pesobruto     = 0;

    -- Convertendo valores em moeda corrente / estrangeira
    if( (old.cotacaomoeda != new.cotacaomoeda) or (old.vlrfretemi != new.vlrfretemi) or (old.vlrseguromi != new.vlrseguromi) or (old.vlrthc != new.vlrthc) ) then
    begin
        new.vlrfrete    =   new.vlrfretemi      *   new.cotacaomoeda;
        new.vlrseguro   =   new.vlrseguromi     *   new.cotacaomoeda;
        new.vlrthcmi    =   new.vlrthc          /   new.cotacaomoeda;
    end


end
^

CREATE TRIGGER CPITCOMPRASERIETGAI FOR CPITCOMPRASERIE
ACTIVE BEFORE INSERT OR UPDATE POSITION 0 
AS
    declare variable codemptm integer;
    declare variable codfilialtm integer;
    declare variable codtipomov integer;
    declare variable estoqtipomov char(1);
    declare variable tipomovserie smallint;
begin
    if(new.numserie is not null)then
        begin

            -- Buscando informações da compra e to tipo de movimento
            select c.codemptm, c.codfilialtm, c.codtipomov, tm.estoqtipomov
                from cpcompra c, eqtipomov tm
                where c.codemp = new.codemp and c.codfilial = new.codfilial and c.codcompra = new.codcompra
                and tm.codemp=c.codemptm and tm.codfilial=c.codfilialtm and tm.codtipomov=c.codtipomov
                into :codemptm, :codfilialtm, :codtipomov, :estoqtipomov;

            if('S' = :estoqtipomov) then
            begin
                tipomovserie = 1;
            end
            else
            begin
                tipomovserie = 0;
            end

            insert into eqmovserie (codemp, codfilial, codemppd, codfilialpd, codprod,
                codempcp, codfilialcp, codcompra, coditcompra,
                codemptm, codfilialtm, codtipomov,
                numserie, dtmovserie, tipomovserie)

            values(new.codemp, new.codfilial, new.codemppd, new.codfilialpd, new.codprod,
                new.codemp, new.codfilial, new.codcompra, new.coditcompra,
                :codemptm, :codfilialtm, :codtipomov,
                new.numserie,  current_timestamp , :tipomovserie );
        end
end
^

CREATE TRIGGER CPITIMPORTACAOTGAD FOR CPITIMPORTACAO
ACTIVE AFTER DELETE POSITION 0 
AS
begin

    -- Atualizando totais da importação

    update cpimportacao set

    pesobruto           =   pesobruto           -   old.pesobruto,
    pesoliquido         =   pesoliquido         -   old.pesoliquido,
    vmlemi              =   vmlemi              -   old.vmlemi,
    vmldmi              =   vmldmi              -   old.vmldmi,
    vmle                =   vmle                -   old.vmle,
    vmld                =   vmld                -   old.vmld,
    vlradmi             =   vlradmi             -   old.vlradmi,
    vlrad               =   vlrad               -   old.vlrad,
    vlrbaseicms         =   vlrbaseicms         -   old.vlrbaseicms,

    -- Tributos

    vlrii               =   vlrii               -   old.vlrii,
    vlripi              =   vlripi              -   old.vlripi,
    vlrpis              =   vlrpis              -   old.vlrpis,
    vlrcofins           =   vlrcofins           -   old.vlrcofins,
    vlrtxsiscomex       =   vlrtxsiscomex       -   old.vlrtxsiscomex,
    vlricms             =   vlricms             -   old.vlricms,
    vlricmsdiferido     =   vlricmsdiferido     -   old.vlricmsdiferido,
    vlricmsdevido       =   vlricmsdevido       -   old.vlricmsdevido,
    vlricmscredpresum   =   vlricmscredpresum   -   old.vlricmscredpresum,
    vlricmsrecolhimento =   vlricmsrecolhimento -   old.vlricmsrecolhimento


    where codemp=old.codemp and codfilial=old.codfilial and codimp=old.codimp;

end
^

CREATE TRIGGER CPITIMPORTACAOTGAI FOR CPITIMPORTACAO
ACTIVE AFTER INSERT POSITION 0 
AS
begin
    -- Atualizando totais da importação

    update cpimportacao set

    pesobruto           =   pesobruto           +   new.pesobruto, 
    pesoliquido         =   pesoliquido         +   new.pesoliquido,
    vmlemi              =   vmlemi              +   new.vmlemi,
    vmldmi              =   vmldmi              +   new.vmldmi,
    vmle                =   vmle                +   new.vmle,
    vmld                =   vmld                +   new.vmld,
    vlradmi             =   vlradmi             +   new.vlradmi,
    vlrad               =   vlrad               +   new.vlrad,
    vlrbaseicms         =   vlrbaseicms         +   new.vlrbaseicms,

    -- Tributos

    vlrii               =   vlrii               +   new.vlrii,
    vlripi              =   vlripi              +   new.vlripi,
    vlrpis              =   vlrpis              +   new.vlrpis,
    vlrcofins           =   vlrcofins           +   new.vlrcofins,
    vlrtxsiscomex       =   vlrtxsiscomex       +   new.vlrtxsiscomex,
    vlricms             =   vlricms             +   new.vlricms,
    vlricmsdiferido     =   vlricmsdiferido     +   new.vlricmsdiferido,
    vlricmsdevido       =   vlricmsdevido       +   new.vlricmsdevido,
    vlricmscredpresum   =   vlricmscredpresum   +   new.vlricmscredpresum,
    vlricmsrecolhimento =   vlricmsrecolhimento +   new.vlricmsrecolhimento

    where codemp=new.codemp and codfilial=new.codfilial and codimp=new.codimp;

end
^

CREATE TRIGGER CPITIMPORTACAOTGAU FOR CPITIMPORTACAO
ACTIVE AFTER UPDATE POSITION 0 
AS
begin

    -- Atualizando totais da importação

    update cpimportacao set

    pesobruto           = pesobruto         - old.pesobruto                 + new.pesobruto,
    pesoliquido         = pesoliquido       - old.pesoliquido               + new.pesoliquido,
    vmlemi              = vmlemi            - old.vmlemi                    + new.vmlemi,
    vmldmi              = vmldmi            - old.vmldmi                    + new.vmldmi,
    vmle                = vmle              - old.vmle                      + new.vmle,
    vmld                = vmld              - old.vmld                      + new.vmld,
    vlrad               = vlrad             - old.vlrad                     + new.vlrad,
    vlradmi             = vlradmi           - old.vlradmi                   + new.vlradmi,
    vlrbaseicms         = vlrbaseicms       - old.vlrbaseicms               + new.vlrbaseicms,

    -- Tributos

    vlrii               =   vlrii               -   old.vlrii               +   new.vlrii,
    vlripi              =   vlripi              -   old.vlripi              +   new.vlripi,
    vlrpis              =   vlrpis              -   old.vlrpis              +   new.vlrpis,
    vlrcofins           =   vlrcofins           -   old.vlrcofins           +   new.vlrcofins,
    vlrtxsiscomex       =   vlrtxsiscomex       -   old.vlrtxsiscomex       +   new.vlrtxsiscomex,
    vlricms             =   vlricms             -   old.vlricms             +   new.vlricms,
    vlricmsdiferido     =   vlricmsdiferido     -   old.vlricmsdiferido     +   new.vlricmsdiferido,
    vlricmsdevido       =   vlricmsdevido       -   old.vlricmsdevido       +   new.vlricmsdevido,
    vlricmscredpresum   =   vlricmscredpresum   -   old.vlricmscredpresum   +   new.vlricmscredpresum,
    vlricmsrecolhimento =   vlricmsrecolhimento -   old.vlricmsrecolhimento +   new.vlricmsrecolhimento

    where codemp=new.codemp and codfilial=new.codfilial and codimp=new.codimp;

end
^

CREATE TRIGGER CPITIMPORTACAOTGBI FOR CPITIMPORTACAO
ACTIVE BEFORE INSERT POSITION 0 
AS
    declare variable cotacao numeric(15,5);
begin
    
    -- Buscando cotação da moeda de importação
    select imp.cotacaomoeda from cpimportacao imp where imp.codemp=new.codemp and imp.codfilial=new.codfilial and imp.codimp=new.codimp
    into :cotacao;

    -- Calculando VMLE , VMLD e VLRAD

    new.vmlemi      =   new.qtd         *       new.precomi;
    new.vmldmi      =   new.vmlemi      +       new.vlrfretemi;
    new.vlradmi     =   new.vmldmi      +       new.vlrthcmi;


    -- Calculando valores em moeda corrente
    new.preco       =   new.precomi     *       :cotacao;
    new.vmle        =   new.vmlemi      *       :cotacao;
    new.vmld        =   new.vmldmi      *       :cotacao;
    new.vlrfrete    =   new.vlrfretemi  *       :cotacao;
    new.vlrseguro   =   new.vlrseguromi *       :cotacao;
    new.vlrthc      =   new.vlrthcmi    *       :cotacao;
    new.vlrad       =   new.vlradmi     *       :cotacao;

    -- Calculando II

    new.vlrii       =   new.vlrad       *       new.aliqii  /   100.00;

    -- Gerando o número do sequencial de adição.
    select coalesce(count(*),0) + 1
    from cpitimportacao
    where codemp=new.codemp and codfilial=new.codfilial and codimp=new.codimp and codncm=new.codncm
    into new.seqadic;

end
^

CREATE TRIGGER CPITIMPORTACAOTGBU FOR CPITIMPORTACAO
ACTIVE BEFORE UPDATE POSITION 0 
as
    declare variable cotacao        decimal(15,5);

begin

    -- Atualizando log
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);

    -- Buscando informações do cabeçalho
    select imp.cotacaomoeda
    from cpimportacao imp where imp.codemp=new.codemp and imp.codfilial=new.codfilial and imp.codimp=new.codimp
    into :cotacao;

    -- Calculando VMLE e VMLD

    new.vmlemi      =  ( new.qtd         *       new.precomi ) + new.vlrthcmi ;
    new.vmldmi      =   new.vmlemi       +       new.vlrfretemi;
    new.vlradmi     =   new.vmldmi       ;
    new.vlrvmcv     =  ( new.qtd         *       new.precomi ) + new.vlrfretemi ;

    -- Calculando valores em moeda corrente
    new.preco       =   new.precomi     *       :cotacao;
    new.vmle        =   new.vmlemi      *       :cotacao;
    new.vmld        =   new.vmldmi      *       :cotacao;
    new.vlrfrete    =   new.vlrfretemi  *       :cotacao;
    new.vlrseguro   =   new.vlrseguromi *       :cotacao;
    new.vlrthc      =   new.vlrthcmi    *       :cotacao;
    new.vlrad       =   new.vlradmi     *       :cotacao;

    -- Calculando II

    new.vlrii       =   new.vlrad       *       new.aliqii  /   100.00;

    -- Calculando IPI

    new.vlripi      = ( new.vlrad       +       new.vlrii ) *  ( new.aliqipi /   100.00);

    -- Calculando o ICMS

    new.vlrbaseicms         =  ( new.vlrad      +       new.vlrcofins      +   new.vlrpis   +     new.vlripi   + new.vlrii + new.vlrtxsiscomex ) / (  cast(1.00 as decimal(15,5)) - (new.aliqicmsuf / 100.00) ) ;

    new.vlricms             =   new.vlrbaseicms *      ( new.aliqicmsuf     / cast(100.00 as decimal(15,5)) );

    if(new.percdifericms > 0) then
        new.vlricmsdiferido     =   new.vlricms     *      ( new.percdifericms  / cast(100.00 as decimal(15,5)) );
    else
        new.vlricmsdiferido     =   0.00;

    new.vlricmsdevido       =   new.vlricms     -       new.vlricmsdiferido;

    new.vlricmscredpresum   =   new.vlrbaseicms *      ( new.aliqicmsimp    / cast(100.00 as decimal(15,5)) );

    new.vlricmsrecolhimento =   new.vlricmsdevido   -   new.vlricmscredpresum;

    -- Gerando o número do sequencial de adição.
    if(old.codncm <> new.codncm) then
    begin
        select coalesce(count(*),0) + 1
        from cpitimportacao
        where codemp=new.codemp and codfilial=new.codfilial and codimp=new.codimp and codncm=new.codncm
        into new.seqadic;
    end


end
^

CREATE TRIGGER CRCHAMADOANEXOTGBU FOR CRCHAMADOANEXO
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
end
^

CREATE TRIGGER CRQUALIFICACAOTGBU FOR CRQUALIFICACAO
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
end
^

CREATE TRIGGER EQITRECMERCSERIETGAI FOR EQITRECMERCSERIE
ACTIVE BEFORE INSERT OR UPDATE POSITION 0 
AS

begin
    if(new.numserie is not null)then
        begin
            insert into eqmovserie (codemp, codfilial, codemppd, codfilialpd, codprod,
                codemprc, codfilialrc, ticket, coditrecmerc,
                numserie, dtmovserie, tipomovserie )
            values(new.codemp, new.codfilial, new.codemppd, new.codfilialpd, new.codprod,
                   new.codemp, new.codfilial, new.ticket, new.coditrecmerc,
                   new.numserie,  current_timestamp , 1 );
        end
end
^

CREATE TRIGGER EQMOVSERIETGBI FOR EQMOVSERIE
ACTIVE BEFORE INSERT POSITION 0 
AS 
    declare variable codmovserie integer;
begin

    select max (eqmovserie.codmovserie) from eqmovserie into :codmovserie;

    if( codmovserie is null) then
    begin
        codmovserie = 0;
    end

    new.codmovserie = :codmovserie + 1;

end
^

CREATE TRIGGER EQPRODUTOLOGTGBU FOR EQPRODUTOLOG
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

CREATE TRIGGER EQPRODUTOTGAI FOR EQPRODUTO
ACTIVE AFTER INSERT POSITION 0 
AS
begin
    -- Inserindo registro na tabela de log do produto (para permitir processamento de preços
    insert into eqprodutolog(codemp, codfilial, codprod, seqlog, precobaseprodant, precobaseprodnovo)
    values (new.codemp, new.codfilial, new.codprod, 1, 0.00, new.precobaseprod);
end
^

CREATE TRIGGER EQPRODUTOTGAU FOR EQPRODUTO
ACTIVE AFTER UPDATE POSITION 0 
AS
    declare variable seqlog integer;
begin

    --Verifica se o preço foi realmente alterado;
    if(new.precobaseprod != old.precobaseprod) then
    begin
    
    select coalesce(max(seqlog),0) + 1 from eqprodutolog
    where codemp=new.codemp and codfilial=new.codfilial and codprod=new.codprod
    into :seqlog;

    insert into eqprodutolog(codemp, codfilial, codprod, seqlog, precobaseprodant, precobaseprodnovo)
    values (new.codemp, new.codfilial, new.codprod, coalesce(:seqlog,1), old.precobaseprod, new.precobaseprod);

  end
end
^

CREATE TRIGGER FNITRENEGRECTGAI FOR FNITRENEGREC
ACTIVE AFTER INSERT POSITION 0 
as
begin

 update fnitreceber set statusitrec = 'RN'
 where codemp=new.codempir and codfilial=new.codfilialir and codrec=new.codrec and nparcitrec=new.nparcitrec;

end
^

CREATE TRIGGER FNITRENEGRECTGBD FOR FNITRENEGREC
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  update fnitreceber set statusitrec = 'R1'
  where codemp=old.codempir and codfilial=old.codfilialir and codrec=old.codrec and nparcitrec=old.nparcitrec;
end
^

CREATE TRIGGER FNPAGCHEQTGAD FOR FNPAGCHEQ
ACTIVE AFTER DELETE POSITION 0 
AS
begin
    -- Estorno do pagamento com o cheque...

    UPDATE FNITPAGAR SET STATUSITPAG='P1' WHERE CODPAG=old.codpag AND NPARCPAG=old.nparcpag AND CODEMP=old.codemp AND CODFILIAL=old.codfilial;


end
^

CREATE TRIGGER FNRECEBERTGAD FOR FNRECEBER
ACTIVE AFTER DELETE POSITION 0 
AS
begin
 delete from fnrenegrec where codrenegrec = old.codrenegrec and codfilial = old.codfilial
    and codemp = old.codemp;
end
^

CREATE TRIGGER FNRENEGRECTGBD FOR FNRENEGREC
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
 delete from fnitrenegrec where codemp = old.codemp and codfilial = old.codfilial
 and codrenegrec = old.codrenegrec;
end
^

CREATE TRIGGER LFCSOSNTGBU FOR LFCSOSN
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

CREATE TRIGGER PPITESTRUTURASUBPRODTGBI FOR PPITESTRUTURASUBPROD
ACTIVE BEFORE INSERT POSITION 0 
as
begin
  new.DTINS=cast('now' AS DATE);
  new.idusuins=USER;
  new.hins = cast('now' AS TIME);
  if (new.REFPROD IS NULL) then
    SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
end
^

CREATE TRIGGER PPITESTRUTURASUBPRODTGBU FOR PPITESTRUTURASUBPROD
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.REFPROD IS NULL) then
    SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
end
^

CREATE TRIGGER PPOPFASETGAU FOR PPOPFASE
ACTIVE AFTER UPDATE POSITION 0 
AS
declare variable seqsubprod smallint;
begin

    -- Buscando subprodução para finalização

    if(old.datafimprodfs is null and new.datafimprodfs is not null) then
    begin
        for select sp.seqsubprod from ppopsubprod sp where sp.codemp=new.codemp and sp.codfilial=new.codfilial and sp.codop=new.codop and sp.seqop=new.seqop
        and sp.codempfs=new.codempfs and sp.codfilialfs=new.codfilialfs and sp.codfase=new.codfase and sp.seqof=new.seqof
        into :seqsubprod
        do
        begin

            update ppopsubprod sp set sp.dtsubprod=new.datafimprodfs
            where sp.codemp=new.codemp and sp.codfilial=new.codfilial and sp.codop=new.codop and sp.seqop=new.seqop
            and sp.codempfs=new.codempfs and sp.codfilialfs=new.codfilialfs and sp.codfase=new.codfase and sp.seqof=new.seqof
            and sp.seqsubprod=:seqsubprod;

        end
    end

end
^

CREATE TRIGGER PPOPSUBPRODTGAD FOR PPOPSUBPROD
ACTIVE AFTER DELETE POSITION 0 
AS
declare variable preco decimal(15,5);
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable dtestoque date;
begin

    --Buscando almoxarifado do produto
    select codempax, codfilialax, codalmox from eqproduto where codemp=old.codemppd and codfilial=old.codfilialpd and codprod=old.codprod
    into :codempax, :codfilialax, :codalmox;

    -- Buscando custo do produto;
    select ncustompm from eqprodutosp01(old.codemppd,old.codfilialpd,old.codprod,null,null,null)
    into :preco;

    -- Buscando data de finalização da fase
    select coalesce(fs.datafimprodfs,op.dtemitop) from ppopfase fs, ppop op
    where
    op.codemp=fs.codemp and op.codfilial=fs.codfilial and op.codop=fs.codop and op.seqop=fs.seqop and
    fs.codemp=old.codemp and fs.codfilial=old.codfilial and fs.codop=old.codop and fs.seqop=old.seqop and fs.codempfs=old.codempfs
    and fs.codfilialfs=old.codfilialfs and fs.codfase=old.codfase and fs.seqof=old.seqof
    into :dtestoque;

 
   EXECUTE PROCEDURE EQMOVPRODIUDSP('D',old.CODEMPPD, old.CODFILIALPD, old.CODPROD,
        old.CODEMPLE, old.CODFILIALLE, old.codlote, old.codemptm,
        old.codfilialtm, old.codtipomov, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, null, null, null, null, old.codemp, old.codfilial, old.codop, old.seqop, null,
        null, null, null,
        :dtestoque, old.codop, 'N', old.qtditsp,:preco,
        :codempax, :codfilialax, :codalmox, old.seqsubprod );
end
^

CREATE TRIGGER PPOPSUBPRODTGAI FOR PPOPSUBPROD
ACTIVE AFTER INSERT POSITION 0 
AS
declare variable dtestoque date;
declare variable preco decimal(15,5);
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
begin

    --Buscando almoxarifado do produto
    select codempax, codfilialax, codalmox from eqproduto where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
    into :codempax, :codfilialax, :codalmox;

    -- Buscando custo do produto;
    select ncustompm from eqprodutosp01(new.codemppd,new.codfilialpd,new.codprod,null,null,null)
    into :preco;

    -- Buscando data de finalização da fase
    select coalesce(fs.datafimprodfs,op.dtemitop) from ppopfase fs, ppop op
    where
    op.codemp=fs.codemp and op.codfilial=fs.codfilial and op.codop=fs.codop and op.seqop=fs.seqop and
    fs.codemp=new.codemp and fs.codfilial=new .codfilial and fs.codop=new.codop and fs.seqop=new.seqop and fs.codempfs=new.codempfs
    and fs.codfilialfs=new.codfilialfs and fs.codfase=new.codfase and fs.seqof=new.seqof
    into :dtestoque;

    EXECUTE PROCEDURE EQMOVPRODIUDSP('I',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
    new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
    new.codfilialtm, new.codtipomov, null, null, null ,null, null,
    null, null, null, null, null, null,
    null, null, null, null, null,new.codemp, new.codfilial,new.codop, new.seqop, null,
    null, null,  null, :dtestoque, new.codop,
    'N',0.00,cast(:preco as numeric(15,5)),
    :codempax, :codfilialax, :codalmox, new.seqsubprod );

end
^

CREATE TRIGGER PPOPSUBPRODTGAU FOR PPOPSUBPROD
ACTIVE AFTER UPDATE POSITION 0 
AS
declare variable preco decimal(15,5);
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;

begin

    if ( new.qtditsp>0 and (old.dtsubprod is null and new.dtsubprod is not null) ) then
        begin

            --Buscando almoxarifado do produto
            select codempax, codfilialax, codalmox from eqproduto where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
            into :codempax, :codfilialax, :codalmox;

            -- Buscando custo do produto;
            select ncustompm from eqprodutosp01(new.codemppd,new.codfilialpd,new.codprod,null,null,null)
            into :preco;

            execute procedure eqmovprodiudsp('U',new.codemppd, new.codfilialpd, new.codprod,
                new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
                new.codfilialtm, new.codtipomov, null, null, null ,null, null,
                null, null, null, null, null, null,null, null, null, null, null,
                new.codemp, new.codfilial,new.codop,new.seqop, null, null, null, null,
                new.dtsubprod , new.codop, 'N', new.qtditsp,:preco,
                :codempax, :codfilialax, :codalmox, new.seqsubprod );
        end
end
^

CREATE TRIGGER PPOPSUBPRODTGBU FOR PPOPSUBPROD
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD AND
    CODFILIAL=new.CODFILIALPD AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

CREATE TRIGGER VDITVENDASERIETGAI FOR VDITVENDASERIE
ACTIVE BEFORE INSERT OR UPDATE POSITION 0 
AS
    declare variable estoqtipomov char(1);
    declare variable codemptm integer;
    declare variable codfilialtm integer;
    declare variable codtipomov integer;
    declare variable tipomovserie smallint;

begin
    if(new.numserie is not null)then
        begin

            select v.codemptm, v.codfilialtm, v.codtipomov, tm.estoqtipomov
            from vdvenda v, eqtipomov tm
            where v.codemp = new.codemp and v.codfilial = new.codfilial and v.codvenda = new.codvenda
            and tm.codemp=v.codemptm and tm.codfilial=v.codfilialtm and tm.codtipomov=v.codtipomov
            into :codemptm, :codfilialtm, :codtipomov, :estoqtipomov;

            if('S' = :estoqtipomov) then
            begin
                tipomovserie = -1;
            end
            else
            begin
                tipomovserie = 0;
            end

            insert into eqmovserie (codemp, codfilial, codemppd, codfilialpd, codprod,
                    codempvd, codfilialvd, codvenda, coditvenda, tipovenda,
                    codemptm, codfilialtm, codtipomov,
                    numserie, dtmovserie, tipomovserie)
            values(new.codemp, new.codfilial, new.codemppd, new.codfilialpd, new.codprod,
                    new.codemp, new.codfilial, new.codvenda, new.coditvenda, new.tipovenda,
                    :codemptm, :codfilialtm, :codtipomov,
                    new.numserie,  current_timestamp , :tipomovserie);
        end
end
^

CREATE TRIGGER VDPRECOPRODTGAI FOR VDPRECOPROD
ACTIVE AFTER INSERT POSITION 0 
AS
begin
    
    -- Se a origem do preco foi o preço base deve indicar no log do produto que o preço foi processado
    if(new.tipoprecoprod='B') then
    begin
    
        update eqprodutolog set precoproc = 'S'
        where codemp=new.codemp and codfilial=new.codfilial and codprod=new.codprod;

    end

end
^

CREATE TRIGGER VDPRECOPRODTGAU FOR VDPRECOPROD
ACTIVE AFTER UPDATE POSITION 0 
AS
begin

    -- Se a origem do preco foi o preço base deve indicar no log do produto que o preço foi processado
    if(new.tipoprecoprod='B') then
    begin
    
        update eqprodutolog set precoproc = 'S'
        where codemp=new.codemp and codfilial=new.codfilial and codprod=new.codprod;

    end


end
^

CREATE TRIGGER VDREGCOMISDESC_BU0 FOR VDREGCOMISDESC
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
new.DTALT=cast('now' AS DATE);
new.IDUSUALT=USER;
new.HALT = cast('now' AS TIME);
end
^

CREATE TRIGGER VDVENDAENTREGATGBU FOR VDVENDAENTREGA
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

CREATE TRIGGER VDVENDAORCTGAI FOR VDVENDAORC
ACTIVE AFTER INSERT POSITION 0 
AS

begin
    -- Inserção de registro de movimentação de numero de série,
    -- para faturamento de seviços de conserto (recmerc/Ordens de serviço)

    insert into eqmovserie (
        codemp      , codfilial     , codmovserie   , codemppd      , codfilialpd   , codprod    ,
        numserie    , codempvd      , codfilialvd   , codvenda      , coditvenda    , tipovenda  ,
        dtmovserie  , tipomovserie  , docmovserie
    )
    select
        ir.codemp, ir.codfilial, coalesce((select max(codmovserie) + 1 from eqmovserie where codemp=vd.codemp and codfilial=vd.codfilial),1), ir.codemppd, ir.codfilialpd, ir.codprod,
        ir.numserie, new.codemp, new.codfilial, new.codvenda, new.coditvenda, new.tipovenda, vd.dtsaidavenda, -1, vd.docvenda
    from eqitrecmercitositorc ro, eqitrecmerc ir, vdvenda vd, vditvenda iv
    where
        ro.codemp=new.codempor and ro.codfilial=new.codfilialor and ro.codorc=new.codorc and ro.tipoorc=new.tipoorc and ro.coditorc=new.coditorc and
        ir.codemp=ro.codemp and ir.codfilial=ro.codfilial and ir.ticket=ro.ticket and ir.coditrecmerc=ro.coditrecmerc and
        iv.codemp=new.codemp and iv.codfilial=new.codfilial and iv.codvenda=new.codvenda and iv.tipovenda=new.tipovenda and iv.coditvenda=new.coditvenda and
        vd.codemp=iv.codemp and vd.codfilial=iv.codfilial and vd.tipovenda=iv.tipovenda and vd.codvenda=iv.codvenda and
        ir.numserie is not null;



end
^


/* Create Views... */

/* Alter exist trigger... */
ALTER TRIGGER CPCOMPRATGAU
AS
  DECLARE VARIABLE iCodPag INTEGER;
  DECLARE VARIABLE dVLR NUMERIC(15, 5);
  DECLARE VARIABLE IFILIALPAG INTEGER;
  DECLARE VARIABLE TIPOMOV CHAR(2);        
  DECLARE VARIABLE ICODITEM SMALLINT;
  DECLARE VARIABLE VLRITEM NUMERIC(15, 5);  
  DECLARE VARIABLE QTDITEM NUMERIC(15, 5);
  DECLARE VARIABLE PERCITFRETE NUMERIC(15, 5);
  DECLARE VARIABLE VLRITFRETE NUMERIC(15, 5);
  DECLARE VARIABLE PERCITADIC NUMERIC(15, 5);
  DECLARE VARIABLE VLRITADIC NUMERIC(15, 5);
  DECLARE VARIABLE SCODFILIALP1 SMALLINT;
  DECLARE VARIABLE GERAPAGEMIS CHAR(1);
  DECLARE VARIABLE DTBASE DATE;
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :SCODFILIALP1;
      SELECT P1.GERAPAGEMIS FROM SGPREFERE1 P1 WHERE  P1.CODEMP=new.CODEMP AND
         P1.CODFILIAL=:SCODFILIALP1 INTO :GERAPAGEMIS;
      IF (GERAPAGEMIS IS NULL) THEN
      BEGIN
        GERAPAGEMIS = 'N';
      END
      IF (GERAPAGEMIS='S') THEN
      BEGIN
        DTBASE = new.DTEMITCOMPRA;
      END
      ELSE
      BEGIN
        DTBASE = new.DTENTCOMPRA;
      END
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
      SELECT CODPAG FROM FNPAGAR WHERE CODCOMPRA=new.CODCOMPRA
             AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPAG INTO iCodPag;
      SELECT TIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
             AND CODEMP=new.CODEMPTM AND CODFILIAL=new.CODFILIALTM INTO TIPOMOV;
      IF ((NOT TIPOMOV IN ('DV','TR')) AND (
         (iCodPag IS NULL) OR (
         (new.CODPLANOPAG != old.CODPLANOPAG) OR
         (new.CODFOR != old.CODFOR) OR
         (new.VLRLIQCOMPRA != old.VLRLIQCOMPRA) OR
         (new.DTENTCOMPRA != old.DTENTCOMPRA) OR
         (new.DTEMITCOMPRA != old.DTEMITCOMPRA) OR
         (new.DOCCOMPRA != old.DOCCOMPRA) OR
         (new.CODBANCO != old.CODBANCO)))) THEN
      BEGIN
        dVLR = new.VLRLIQCOMPRA;
        IF ((new.STATUSCOMPRA IN ('P2','C2')) AND (old.STATUSCOMPRA IN ('P1','C1'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALPAG;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA,new.CODEMPPG,new.CODFILIALPG,
               new.CODPLANOPAG,new.CODEMPFR,new.CODFILIALFR,new.CODFOR,:dVLR,
               :DTBASE, new.DTCOMPCOMPRA, new.DOCCOMPRA,new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,
               new.FLAG,new.CODEMP,new.CODFILIAL, new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
               new.codempct, new.codfilialct, new.numconta, new.codempcc,  new.codfilialcc, new.anocc, new.codcc, new.codemppn, new.codfilialpn, new.codplan );
        END
        ELSE IF ((new.STATUSCOMPRA IN ('P2','C2')) AND (old.STATUSCOMPRA IN ('P2','C2'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA,new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,
               new.CODEMPFR,new.CODFILIALFR,new.CODFOR,:dVLR,:DTBASE , new.DTCOMPCOMPRA, new.DOCCOMPRA,
               new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,new.FLAG,new.CODEMP,new.CODFILIAL,
               new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
               new.codempct, new.codfilialct, new.numconta, new.codempcc,  new.codfilialcc, new.anocc, new.codcc, new.codemppn, new.codfilialpn, new.codplan );
        END
        ELSE IF ((new.STATUSCOMPRA IN ('P3','C3')) AND (old.STATUSCOMPRA IN ('P3','C3'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL = :IFILIALPAG;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA, new.CODEMPPG, new.CODFILIALPG, new.CODPLANOPAG,
               new.CODEMPFR, new.CODFILIALFR, new.CODFOR, :dVLR, :DTBASE, new.DTCOMPCOMPRA, new.DOCCOMPRA,
               new.CODEMPBO, new.CODFILIALBO, new.CODBANCO, new.FLAG, new.CODEMP, new.CODFILIAL,
               new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
               new.codempct, new.codfilialct, new.numconta, new.codempcc,  new.codfilialcc, new.anocc, new.codcc, new.codemppn, new.codfilialpn, new.codplan);
        END
      END
    /**
     Movimento do estoque
    **/
    /* Avisa os itens que a data de saida foi alterada */
      IF ( (new.DTENTCOMPRA != old.DTENTCOMPRA) OR
           (new.DTEMITCOMPRA != old.DTEMITCOMPRA) OR
           (new.DOCCOMPRA != old.DOCCOMPRA) OR
           (new.CODTIPOMOV != old.CODTIPOMOV) )  THEN
        UPDATE CPITCOMPRA SET CODITCOMPRA=CODITCOMPRA WHERE
             CODCOMPRA = old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;

      IF ( new.codimp is null and (((new.VLRFRETECOMPRA > 0) AND ( NOT new.VLRFRETECOMPRA = old.VLRFRETECOMPRA)) or ((new.vlradiccompra > 0) AND ( NOT new.vlradiccompra = old.vlradiccompra)))  ) THEN
      BEGIN
          FOR SELECT IT.CODITCOMPRA, IT.VLRLIQITCOMPRA, IT.QTDITCOMPRA FROM CPITCOMPRA IT
              WHERE IT.CODEMP=new.CODEMP AND IT.CODFILIAL=new.CODFILIAL AND IT.CODCOMPRA=new.CODCOMPRA
              INTO :ICODITEM, :VLRITEM, :QTDITEM
              DO
              BEGIN

                  IF ( (new.vlrfretecompra > 0) AND ( NOT new.vlrfretecompra = old.vlrfretecompra)  ) THEN
                  begin
                      PERCITFRETE = :VLRITEM / (old.VLRLIQCOMPRA / 100);
                      VLRITFRETE =  (:PERCITFRETE * (new.VLRFRETECOMPRA / 100)) / COALESCE(:QTDITEM, 1);

                      UPDATE CPITCOMPRA CIT
                          SET VLRFRETEITCOMPRA=:VLRITFRETE
                            WHERE CIT.CODEMP=new.CODEMP AND CIT.CODFILIAL=new.CODFILIAL
                                AND CIT.CODCOMPRA=new.CODCOMPRA AND CIT.CODITCOMPRA=:ICODITEM;
                  end
                  IF ( (new.vlradiccompra > 0) AND ( NOT new.vlradiccompra = old.vlradiccompra)  ) THEN
                  begin
                      PERCITADIC = :VLRITEM / (old.VLRLIQCOMPRA / 100);
                      VLRITADIC =  (:PERCITADIC * (new.VLRADICCOMPRA / 100)) / COALESCE(:QTDITEM, 1);
                      UPDATE CPITCOMPRA CIT
                          SET VLRADICITCOMPRA=:VLRITADIC
                            WHERE CIT.CODEMP=new.CODEMP AND CIT.CODFILIAL=new.CODFILIAL
                                AND CIT.CODCOMPRA=new.CODCOMPRA AND CIT.CODITCOMPRA=:ICODITEM;

                  end


              END
        END
          IF ((substr(new.STATUSCOMPRA,1,1)='X') AND (substr(old.STATUSCOMPRA,1,1) IN ('P','C'))) THEN
          BEGIN
              UPDATE CPITCOMPRA SET QTDITCOMPRACANC=QTDITCOMPRA, QTDITCOMPRA=0 WHERE CODCOMPRA=new.CODCOMPRA AND CODEMP=new.CODEMP
              AND CODFILIAL=new.CODFILIAL;
              DELETE FROM FNPAGAR WHERE CODCOMPRA=new.CODCOMPRA AND CODEMP=new.CODEMP
              AND CODFILIAL=new.CODFILIAL;
          END

        -- Atualização do status do recebimento da mercadoria quando a nota for emitida.
        if( old.statuscompra!='ET' and new.statuscompra='ET') then
        begin
            
           update eqrecmerc rm set rm.status='NE'
           where rm.codemp=new.codemp and rm.codfilial=new.codfilial
           and rm.ticket in
           (
            select ticket
            from eqitrecmercitcp rm
            where rm.codempcp=new.codemp and rm.codfilialcp=new.codfilial
            and rm.codcompra=new.codcompra
           );

        end

    END
END
^

/* Alter exist trigger... */
ALTER TRIGGER CPCOMPRATGBI
AS
  DECLARE VARIABLE IFILIALTIPOMOV INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'EQTIPOMOV') INTO IFILIALTIPOMOV;
  SELECT T.FISCALTIPOMOV FROM EQTIPOMOV T WHERE T.CODTIPOMOV=new.CODTIPOMOV
         AND T.CODEMP=new.CODEMP AND T.CODFILIAL=:IFILIALTIPOMOV INTO new.FLAG;
  IF ( new.FLAG <> 'S') THEN
  BEGIN
    new.FLAG = 'N';
  END
  new.STATUSCOMPRA = 'P1';
  IF (new.VLRPRODCOMPRA IS NULL) THEN new.VLRPRODCOMPRA = 0;
  IF (new.VLRDESCCOMPRA IS NULL) THEN new.VLRDESCCOMPRA = 0;
  IF (new.VLRDESCITCOMPRA IS NULL) THEN new.VLRDESCITCOMPRA = 0;
  IF (new.VLRCOMPRA IS NULL) THEN new.VLRCOMPRA = 0;
  IF (new.VLRBASEICMSCOMPRA IS NULL) THEN new.VLRBASEICMSCOMPRA = 0;
  IF (new.VLRICMSCOMPRA IS NULL) THEN new.VLRICMSCOMPRA = 0;
  IF (new.VLRISENTASCOMPRA IS NULL) THEN new.VLRISENTASCOMPRA = 0;
  IF (new.VLROUTRASCOMPRA IS NULL) THEN new.VLROUTRASCOMPRA = 0;
  IF (new.VLRBASEIPICOMPRA IS NULL) THEN new.VLRBASEIPICOMPRA = 0;
  IF (new.VLRIPICOMPRA IS NULL) THEN new.VLRIPICOMPRA = 0;
  IF (new.VLRLIQCOMPRA IS NULL) THEN new.VLRLIQCOMPRA = 0;
  IF (new.VLRFRETECOMPRA IS NULL) THEN new.VLRFRETECOMPRA = 0;
  IF (new.VLRADICCOMPRA IS NULL) THEN new.VLRADICCOMPRA = 0;
  IF (new.vlrbasepiscompra IS NULL) THEN new.vlrbasepiscompra = 0;
  IF (new.vlrbasecofinscompra IS NULL) THEN new.vlrbasecofinscompra = 0;
  IF (new.vlrpiscompra IS NULL) THEN new.vlrpiscompra = 0;
  IF (new.vlrcofinscompra IS NULL) THEN new.vlrcofinscompra = 0;
  IF (new.vlrfunruralcompra IS NULL) THEN new.vlrfunruralcompra = 0;
  IF (new.vlrbaseiicompra IS NULL) THEN new.vlrbaseiicompra = 0;
  IF (new.vlriicompra IS NULL) THEN new.vlriicompra = 0;
  IF (new.vlricmsdiferido IS NULL) THEN new.vlricmsdiferido = 0;
  IF (new.vlricmsdevido IS NULL) THEN new.vlricmsdevido = 0;
  IF (new.vlricmscredpresum IS NULL) THEN new.vlricmscredpresum = 0;
  if (new.sitdoc is null) then new.sitdoc='00';
  if (new.DTCOMPCOMPRA IS NULL) then new.DTCOMPCOMPRA = new.DTEMITCOMPRA;

END
^

/* Alter exist trigger... */
ALTER TRIGGER CPCOMPRATGBU
AS
  DECLARE VARIABLE dVlrPagar NUMERIC(15, 5);
  DECLARE VARIABLE sStatusPag CHAR(2);
  DECLARE VARIABLE IFILIALTIPOMOV INTEGER;
  DECLARE VARIABLE IFILIALPAG INTEGER;
  DECLARE VARIABLE CSEQNFTIPOMOV CHAR(1);
BEGIN
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  if (new.BLOQCOMPRA IS NULL) then
     new.BLOQCOMPRA='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      if ( (old.BLOQCOMPRA IS NOT NULL AND old.BLOQCOMPRA='S') or (new.BLOQCOMPRA='S') ) then
         EXCEPTION CPCOMPRAEX04 'ESTA COMPRA ESTÁ BLOQUEADA!!!';
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      if ( (new.DTCOMPCOMPRA IS NULL) OR (new.DTEMITCOMPRA<>old.DTEMITCOMPRA) )  then
         new.DTCOMPCOMPRA = new.DTEMITCOMPRA;
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'EQTIPOMOV') INTO IFILIALTIPOMOV;
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
      SELECT T.FISCALTIPOMOV, T.SEQNFTIPOMOV FROM EQTIPOMOV T WHERE T.CODTIPOMOV=new.CODTIPOMOV
             AND T.CODEMP=new.CODEMP AND T.CODFILIAL = :IFILIALTIPOMOV INTO new.FLAG, :CSEQNFTIPOMOV;
      IF (old.IMPNOTACOMPRA IS NULL) THEN
         new.IMPNOTACOMPRA = 'N';
      IF ( (CSEQNFTIPOMOV IS NOT NULL) AND (CSEQNFTIPOMOV='S') ) THEN
      BEGIN
         IF  (new.IMPNOTACOMPRA='N') THEN
         BEGIN
            SELECT DOC FROM LFNOVODOCSP(new.Serie,new.CODEMPSE,new.CODFILIALSE) INTO new.DocCompra;
            new.IMPNOTACOMPRA = 'S';
         END
         ELSE IF (old.DOCCOMPRA != new.DOCCOMPRA) THEN
         BEGIN
            new.DOCCOMPRA = old.DOCCOMPRA;
         END
      END

      IF ( new.FLAG <> 'S') THEN
      BEGIN
        new.FLAG = 'N';
      END
      IF (new.VLRDESCCOMPRA IS NULL) THEN
        new.VLRDESCCOMPRA = 0;
      IF (new.VLRADICCOMPRA IS NULL) THEN
        new.VLRADICCOMPRA = 0;
      IF (new.VLRFRETECOMPRA IS NULL) THEN
        new.VLRFRETECOMPRA = 0;
      IF (old.STATUSCOMPRA = 'P1')  THEN
      BEGIN
        IF (new.STATUSCOMPRA = 'C1') THEN
        BEGIN
          new.STATUSCOMPRA = 'C2';
        END
      END
      ELSE IF ((old.STATUSCOMPRA IN ('P4','C4')) AND (new.STATUSCOMPRA IN ('P4','C4'))) THEN
      BEGIN
        EXCEPTION CPCOMPRAEX03;
      END
      ELSE IF ((old.STATUSCOMPRA IN ('P2','C2')) AND (new.STATUSCOMPRA IN ('P3','C3'))) THEN
      BEGIN
        SELECT STATUSPAG,VLRPARCPAG FROM FNPAGAR WHERE CODCOMPRA=new.CODCOMPRA
             AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPAG INTO :sStatusPag,:dVlrPagar;
        IF ((sStatusPag = 'PD') AND (new.VLRLIQCOMPRA != :dVlrPagar)) THEN
          EXCEPTION CPCOMPRAEX04;
      END
       IF ((substr(old.STATUSCOMPRA,1,1) IN ('P','C')) AND (substr(new.STATUSCOMPRA,1,1)='X')) THEN
      BEGIN
           new.vlrdescitcompra = 0;
           new.vlrprodcompra = 0;
           new.vlrbaseicmscompra = 0;
           new.vlricmscompra = 0;
           new.vlrisentascompra = 0;
           new.vlroutrascompra = 0;
           new.vlrbaseipicompra = 0;
           new.vlripicompra = 0;
           new.vlrliqcompra = 0;
           new.vlripicompra = 0;
      END

  END
    -- Atualizando o status do documento fiscal para 02 - Documento cancelado, quando nota for cancelado pelo sistema.
  IF (new.statuscompra = 'X' and new.sitdoc!='02') THEN
  begin
    new.sitdoc = '02';
  end

  if(old.chavenfecompra is null and new.chavenfecompra is not null) then
  begin
    new.emmanut = 'N';
  end

END
^

/* Alter exist trigger... */
ALTER TRIGGER CPCOTACAOTGBU
AS
     declare variable sRefProd varChar(20);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRATGAD
as

declare variable ddtcompra date;
declare variable cflag char(1);
declare variable idoccompra integer;
declare variable icodemptm integer;
declare variable scodfilialtm smallint;
declare variable icodtipomov integer;

begin

    -- Se não estifver em manutenção...
    if ( not ( (old.emmanut='S') and (old.emmanut is not null) ) ) then
    begin

        -- Atualizando cabeçalho da compra
        update cpcompra cp set
            cp.vlrdescitcompra = cp.vlrdescitcompra - old.vlrdescitcompra,
            cp.vlrprodcompra = cp.vlrprodcompra - old.vlrproditcompra,
            cp.vlrbaseicmscompra = cp.vlrbaseicmscompra - old.vlrbaseicmsitcompra,
            cp.vlricmscompra = cp.vlricmscompra - old.vlricmsitcompra,
            cp.vlrisentascompra = cp.vlrisentascompra - old.vlrisentasitcompra,
            cp.vlroutrascompra = cp.vlroutrascompra - old.vlroutrasitcompra,
            cp.vlrbaseipicompra = cp.vlrbaseipicompra - old.vlrbaseipiitcompra,
            cp.vlripicompra = cp.vlripicompra - old.vlripiitcompra,
            cp.vlrliqcompra = cp.vlrliqcompra - old.vlrliqitcompra,
            cp.vlrfunruralcompra = cp.vlrfunruralcompra - old.vlrfunruralitcompra,
            cp.vlrfretecompra = cp.vlrfretecompra - old.vlrfreteitcompra,
            cp.vlradiccompra = cp.vlradiccompra - old.vlradicitcompra
        where codcompra=old.codcompra and codemp=old.codemp and codfilial=old.codfilial;

        -- Buscando informações do cabeçaho da compra
        select c.dtentcompra, c.flag, c.doccompra, c.codemptm, c.codfilialtm, c.codtipomov
        from cpcompra c
        where c.codcompra=old.codcompra and c.codemp=old.codemp and c.codfilial=old.codfilial
        into :ddtcompra, :cflag, :idoccompra, :icodemptm, :scodfilialtm, :icodtipomov;

        -- Atualizando movimentação de estoque
        execute procedure eqmovprodiudsp('D', old.codemppd, old.codfilialpd, old.codprod,
        old.codemple, old.codfilialle, old.codlote, :icodemptm, :scodfilialtm, :icodtipomov,
        null, null, null, old.codemp, old.codfilial, old.codcompra, old.coditcompra,
        null, null, null, null, null, null, null, null, null, null, null, null, null, null, old.codempnt,
        old.codfilialnt, old.codnat, :ddtcompra, :idoccompra, :cflag, old.qtditcompra, old.custoitcompra,
        old.codempax, old.codfilialax, old.codalmox, null);

    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRATGAI
as
    declare variable dtcompra date;
    declare variable flag char(1);
    declare variable doccompra integer;
    declare variable codemptm integer;
    declare variable codfilialtm smallint;
    declare variable codtipomov integer;
    declare variable calctrib char(1);

begin

    -- Buscando informações do cabeçalho da compra
    select c.dtentcompra, c.flag, c.doccompra, c.codemptm, c.codfilialtm, c.codtipomov, calctrib
    from cpcompra c
    where c.codcompra = new.codcompra and c.codemp = new.codemp and c.codfilial = new.codfilial
    into :dtcompra, :flag, :doccompra, :codemptm, :codfilialtm, :codtipomov, :calctrib;

    -- Executando procedure para movimentação de produto
    execute procedure eqmovprodiudsp (
        'I', new.codemppd, new.codfilialpd, new.codprod, new.codemple, new.codfilialle, new.codlote,
        :codemptm, :codfilialtm, :codtipomov, null, null, null, new.codemp, new.codfilial, new.codcompra, new.coditcompra,
        null, null, null, null, null, null, null, null, null, null, null, null, null, null, new.codempnt, new.codfilialnt, new.codnat,
        :dtcompra, :doccompra, :flag, new.qtditcompra, new.custoitcompra, new.codempax, new.codfilialax, new.codalmox, null
    );

    -- Executa procedure de geração de tabela de vinculo para numeros de serie

    execute procedure cpitcompraseriesp('I', new.codemp, new.codfilial, new.codcompra, new.coditcompra, new.codemppd, new.codfilialpd, new.codprod, new.numserietmp, new.qtditcompra);

    -- Gerando tabela de informações fiscais adicionais (lfitcompra)
    if(calctrib='S') then
    begin
       -- Inserindo registros na tabela de informações fiscais complementares (LFITCOMPRA)
        execute procedure lfgeralfitcomprasp(new.codemp, new.codfilial, new.codcompra, new.coditcompra);
    end

    -- Atualizando cabeçalho da compra

    update cpcompra cp set
    cp.vlrfretecompra = cp.vlrfretecompra + new.vlrfreteitcompra,
    cp.vlradiccompra = cp.vlradiccompra + new.vlradicitcompra
    where cp.codcompra=new.codcompra and cp.codemp=new.codemp and cp.codfilial=new.codfilial;


end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRATGAU
as

declare variable ddtcompra date;
declare variable cflag char(1);
declare variable idoccompra integer;
declare variable icodemptm integer;
declare variable scodfilialtm smallint;
declare variable icodtipomov integer;
declare variable calctrib char(1);
declare variable codimp integer;

begin
    -- Se não estiver em manutenção...
    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) ) ) ) then
    begin
        -- Buscando informações da compra
        select c.dtentcompra, c.flag, c.doccompra, c.codemptm, c.codfilialtm, c.codtipomov, c.calctrib, c.codimp
        from cpcompra c
        where c.codcompra = new.codcompra and c.codemp=new.codemp and c.codfilial = new.codfilial
        into :ddtcompra, :cflag, :idoccompra, :icodemptm, :scodfilialtm, :icodtipomov, :calctrib, :codimp;

        if(:codimp is null) then
        begin
            -- Atualizando cabeçalho da compra (não atualiza frete para não entrar em loop);
            update cpcompra cp set
                cp.vlrdescitcompra = cp.vlrdescitcompra -old.vlrdescitcompra + new.vlrdescitcompra,
                cp.vlrprodcompra = cp.vlrprodcompra - old.vlrproditcompra + new.vlrproditcompra,
                cp.vlrbaseicmscompra = cp.vlrbaseicmscompra - old.vlrbaseicmsitcompra + new.vlrbaseicmsitcompra,
                cp.vlricmscompra = cp.vlricmscompra -old.vlricmsitcompra + new.vlricmsitcompra,
                cp.vlrisentascompra = cp.vlrisentascompra - old.vlrisentasitcompra + new.vlrisentasitcompra,
                cp.vlroutrascompra = cp.vlroutrascompra - old.vlroutrasitcompra + new.vlroutrasitcompra,
                cp.vlrbaseipicompra = cp.vlrbaseipicompra - old.vlrbaseipiitcompra + new.vlrbaseipiitcompra,
                cp.vlripicompra = cp.vlripicompra - old.vlripiitcompra + new.vlripiitcompra,
                cp.vlrliqcompra = cp.vlrliqcompra - old.vlrliqitcompra + new.vlrliqitcompra,
                cp.vlrfunruralcompra = cp.vlrfunruralcompra - old.vlrfunruralitcompra + new.vlrfunruralitcompra
            where cp.codcompra=new.codcompra and cp.codemp=new.codemp and cp.codfilial=new.codfilial and cp.codimp is null;
        end
        else
        begin

            -- Atualizando cabeçalho da compra (atualiza o frete);

            update cpcompra cp set
                cp.vlrdescitcompra = cp.vlrdescitcompra -old.vlrdescitcompra + new.vlrdescitcompra,
                cp.vlrprodcompra = cp.vlrprodcompra - old.vlrproditcompra + new.vlrproditcompra,
                cp.vlrbaseicmscompra = cp.vlrbaseicmscompra - old.vlrbaseicmsitcompra + new.vlrbaseicmsitcompra,
                cp.vlricmscompra = cp.vlricmscompra -old.vlricmsitcompra + new.vlricmsitcompra,
                cp.vlrisentascompra = cp.vlrisentascompra - old.vlrisentasitcompra + new.vlrisentasitcompra,
                cp.vlroutrascompra = cp.vlroutrascompra - old.vlroutrasitcompra + new.vlroutrasitcompra,
                cp.vlrbaseipicompra = cp.vlrbaseipicompra - old.vlrbaseipiitcompra + new.vlrbaseipiitcompra,
                cp.vlripicompra = cp.vlripicompra - old.vlripiitcompra + new.vlripiitcompra,
                cp.vlrliqcompra = cp.vlrliqcompra - old.vlrliqitcompra + new.vlrliqitcompra,
                cp.vlrfunruralcompra = cp.vlrfunruralcompra - old.vlrfunruralitcompra + new.vlrfunruralitcompra,
                cp.vlrfretecompra = cp.vlrfretecompra - old.vlrfreteitcompra + new.vlrfreteitcompra,
                cp.vlradiccompra = cp.vlradiccompra - old.vlradicitcompra + new.vlradicitcompra
            where cp.codcompra=new.codcompra and cp.codemp=new.codemp and cp.codfilial=new.codfilial and cp.codimp is not null;

        end

        -- Atualizando movimentação de estoque
        execute procedure eqmovprodiudsp('U', new.codemppd, new.codfilialpd, new.codprod,
        new.codemple, new.codfilialle, new.codlote, :icodemptm, :scodfilialtm, :icodtipomov, null, null, null,
        new.codemp, new.codfilial, new.codcompra, new.coditcompra, null, null, null, null, null, null, null, null,
        null, null, null, null, null, null, new.codempnt, new.codfilialnt, new.codnat, :ddtcompra, :idoccompra, :cflag,
        new.qtditcompra, new.custoitcompra, new.codempax, new.codfilialax, new.codalmox, null);

        -- Executa procedure para atualização de tabela de vinculo para numeros de serie
        execute procedure cpitcompraseriesp('U', old.codemp, old.codfilial, old.codcompra, old.coditcompra, old.codemppd, old.codfilialpd, old.codprod, new.numserietmp, new.qtditcompra);

        -- Gerando tabela de informações fiscais adicionais (lfitcompra)
        if(calctrib='S') then
        begin
           -- Inserindo registros na tabela de informações fiscais complementares (LFITCOMPRA)
            execute procedure lfgeralfitcomprasp(new.codemp, new.codfilial, new.codcompra, new.coditcompra);
        end


    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRATGBI
as

declare variable srefprod varchar(20);
declare variable habCustoCompra char(1);
declare variable calctrib char(1);

begin

    -- Buscando preferências
    select p.custocompra from sgprefere1 p
    where p.codemp=new.codemp and p.codfilial=new.codfilial
    into habCustoCompra;

    --Buscando informações da compra
    select cp.calctrib from cpcompra cp
    where cp.codemp=new.codemp and cp.codfilial=new.codfilial and cp.codcompra=new.codcompra
    into :calctrib;

    -- Buscando referência do produto
    select refprod from eqproduto
    where codprod=new.codprod and codemp=new.codemppd and codfilial=new.codfilialpd
    into srefprod;

    -- Carregando valores padrão
    if (new.refprod is null) then new.refprod = srefprod;
    if (new.vlrdescitcompra is null) then new.vlrdescitcompra = 0;
    if (new.vlrbaseicmsitcompra is null) then new.vlrbaseicmsitcompra = 0;
    if (new.vlricmsitcompra is null) then new.vlricmsitcompra = 0;
    if (new.vlrbaseipiitcompra is null) then new.vlrbaseipiitcompra = 0;
    if (new.vlripiitcompra is null) then new.vlripiitcompra = 0;
    if (new.vlrliqitcompra is null) then new.vlrliqitcompra = 0;
    if (new.vlradicitcompra is null) then new.vlradicitcompra = 0;
    if (new.vlrfreteitcompra is null) then new.vlrfreteitcompra = 0;

    if(new.vlrliqitcompra=0) then
    begin
       new.vlrliqitcompra = (new.qtditcompra * new.precoitcompra) - new.vlrdescitcompra + new.vlradicitcompra;
    end

    -- Buscando e carregando almoxarifado do produto
    if (new.codalmox is null) then
    begin
        select codempax, codfilialax, codalmox from eqproduto
        where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
        into new.codempax, new.codfilialax, new.codalmox;
    end

    -- Buscando e carregando custo do produto
    if (('N' = habCustoCompra) or (new.custoitcompra is null)) then
    begin
        select nvlrcusto from cpcomprasp01(new.codemp, new.codfilial, new.qtditcompra, new.vlrliqitcompra, new.vlricmsitcompra)
        into new.custoitcompra;
    end

    -- Buscando e carregando retenção de tributos
    if(calctrib='S') then
    begin
        select coalesce(bc.vlrbasefunrural,0), coalesce(bc.aliqfunrural,0), coalesce(bc.vlrfunrural,0), bc.codempif, bc.codfilialif, bc.codfisc, bc.coditfisc
        from lfbuscatribcompra(new.codemp, new.codfilial, new.codcompra, new.codemppd, new.codfilialpd, new.codprod, new.vlrliqitcompra) bc
        into new.vlrbasefunruralitcompra, new.aliqfunruralitcompra, new.vlrfunruralitcompra,
        new.codempif, new.codfilialif, new.codfisc, new.coditfisc;
    end

    -- Descontando o valor do funrual do valor liquido do ítem
    if( new.vlrfunruralitcompra > 0 ) then
    begin
        new.vlrliqitcompra = new.vlrliqitcompra - new.vlrfunruralitcompra;
    end

    --Atualizando totais da compra
    update cpcompra cp set cp.vlrdescitcompra=cp.vlrdescitcompra + new.vlrdescitcompra,
    cp.vlrprodcompra = cp.vlrprodcompra + new.vlrproditcompra,
    cp.vlrbaseicmscompra = cp.vlrbaseicmscompra + new.vlrbaseicmsitcompra,
    cp.vlricmscompra = cp.vlricmscompra + new.vlricmsitcompra,
    cp.vlrisentascompra = cp.vlrisentascompra + new.vlrisentasitcompra,
    cp.vlroutrascompra = cp.vlroutrascompra + new.vlroutrasitcompra,
    cp.vlrbaseipicompra = cp.vlrbaseipicompra + new.vlrbaseipiitcompra,
    cp.vlripicompra = cp.vlripicompra + new.vlripiitcompra,
    cp.vlrliqcompra = cp.vlrliqcompra + new.vlrliqitcompra,
    cp.vlrfunruralcompra = coalesce(cp.vlrfunruralcompra,0) + coalesce(new.vlrfunruralitcompra,0)
    where cp.codcompra=new.codcompra and cp.codemp=new.codemp and cp.codfilial=new.codfilial;

end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITCOMPRATGBU
as

declare variable srefprod varchar(20);
declare variable sadicfrete char(1);
declare variable sadicadic char(1);
declare variable habcustocompra char(1);
declare variable vlritcusto numeric(15, 5);
declare variable statuscompra char(2);
declare variable calctrib char(1);

begin

    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
    begin
        
        -- Atulizando log de alteração
        new.dtalt = cast('today' as date);
        new.idusualt = user;
        new.halt = cast('now' as time);

        -- Não permite a alteração do produto
        if (new.codprod != old.codprod) then
        begin
            exception cpitcompraex01;
        end

        -- Não permite a alteração do lote
        if (new.codlote != old.codlote) then
        begin
            exception cpitcompraex02;
        end

        -- Se o código do almoxarifado estiver nulo, preenche como almoxarifado padrão do produto
        if (new.codalmox is null) then
        begin
            select codempax, codfilialax, codalmox from eqproduto
            where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
            into new.codempax, new.codfilialax, new.codalmox;
        end

        -- Não permite a troca de almoxarifado
        if ( old.codalmox is not null and old.codalmox != new.codalmox ) then
        begin
            exception eqalmox01;
        end

        -- Busca referência do produto
        select refprod from eqproduto
        where codprod=new.codprod and codemp=new.codemppd and codfilial=new.codfilialpd
        into srefprod;

        -- Busca informações no cabeçalho da compra
        select adicfretecompra, adicadiccompra, statuscompra
        from cpcompra where
        codemp=new.codemp and codfilial=new.codfilial and codcompra=new.codcompra
        into :sadicfrete, :sadicadic, :statuscompra;

        /* Caso a nota não seja cancelada */
        if ((substr(:statuscompra,1,1)<>'X')) then
        begin

            vlritcusto = new.vlrliqitcompra/new.qtditcompra;

            -- Buscando informações das preferencias gerais
            select p.custocompra from sgprefere1 p
            where p.codemp=new.codemp and p.codfilial=new.codfilial
            into :habcustocompra;

            --Buscando informações da compra
            select cp.calctrib from cpcompra cp
            where cp.codemp=new.codemp and cp.codfilial=new.codfilial and cp.codcompra=new.codcompra
            into :calctrib;

            if (('N' = habcustocompra) or (new.custoitcompra is null)) then
            begin
                select nvlrcusto
                from cpcomprasp01 (new.codemp, new.codfilial, new.qtditcompra, new.vlrliqitcompra, new.vlricmsitcompra)
                into new.custoitcompra;
            end

            --  Atualizado a referencia do produto
            if (new.refprod is null) then
            begin
                new.refprod = srefprod;
            end

            -- Adicionando o frete ao valor de custo do item
            if (:sadicfrete = 'S' ) then
            begin
                vlritcusto = vlritcusto + new.vlrfreteitcompra;
            end

            -- Adiconando valores adicionais ao custo do item
            if (:sadicadic = 'S') then
            begin
                vlritcusto = vlritcusto + new.vlradicitcompra;
            end

            new.custoitcompra=:vlritcusto;

            -- Buscando e carregando retenção de tributos
            if(calctrib='S') then
            begin
                select coalesce(bc.vlrbasefunrural,0), coalesce(bc.aliqfunrural,0), coalesce(bc.vlrfunrural,0), bc.codempif, bc.codfilialif, bc.codfisc, bc.coditfisc
                from lfbuscatribcompra(new.codemp, new.codfilial, new.codcompra, new.codemppd, new.codfilialpd, new.codprod, new.vlrliqitcompra) bc
                into new.vlrbasefunruralitcompra, new.aliqfunruralitcompra, new.vlrfunruralitcompra,
                new.codempif, new.codfilialif, new.codfisc, new.coditfisc;
            end

            -- Descontando o valor do funrual do valor liquido do ítem
            if( new.vlrfunruralitcompra > 0 ) then
            begin
                new.vlrliqitcompra = new.vlrliqitcompra - new.vlrfunruralitcompra;
            end

        end
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITSOLICITACAOTGBI
AS
begin
  IF (new.REFPROD IS NULL) THEN
       SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
            AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITSOLICITACAOTGBU
AS
     declare variable sRefProd VARChar(20);
     DECLARE VARIABLE ICODEMPUSU INT;
     declare variable ICODFILIALUSU smallint;
     declare variable IDUSU char(8);
begin
  /*#IBA#new.DTALT = cast('today' AS DATE);
  new.IDUSUALT = USER;
  new.HALT = cast('now' AS TIME);#IBA#*/
  IF (new.CODPROD != old.CODPROD) THEN
     EXCEPTION CPITSOLICITACAOEX01;
  IF (new.REFPROD IS NULL) THEN
  BEGIN
       SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
            AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO sRefProd;
       new.REFPROD = sRefProd;
  END

  if((new.idusuaprovitsol is null) and (new.sititsol!=old.sititsol) and ((new.sititsol= 'AP') or (new.sititsol= 'AT') )) then
  begin
    SELECT CODEMPUSU,CODFILIALUSU,IDUSUS FROM sgretinfousu(USER) into :ICODEMPUSU,:ICODFILIALUSU,:IDUSU;
    new.codempua = :ICODEMPUSU;
    new.codfilialua = :ICODFILIALUSU;
    new.idusuaprovitsol = :IDUSU;
    new.dtaprovitsol = cast('now' AS DATE);
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPITSUMSOLTGBU
AS
     declare variable sRefProd varChar(20);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

/* Alter exist trigger... */
ALTER TRIGGER CPSUMSOLTGBI
AS
begin
  new.dtins=cast('now' AS DATE);
  new.idusuins=USER;
  new.hins = cast('now' AS TIME);

 IF (new.REFPROD IS NULL) THEN
       SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
            AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO new.REFPROD;
END
^

/* Alter exist trigger... */
ALTER TRIGGER CPSUMSOLTGBU
AS
     declare variable sRefProd VARChar(20);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);

  IF (new.CODPROD != old.CODPROD) THEN
     EXCEPTION CPITSOLICITACAOEX01;
  IF (new.REFPROD IS NULL) THEN
  BEGIN
       SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
            AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO sRefProd;
       new.REFPROD = sRefProd;
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQCODALTPRODBI
AS
begin
  SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL
     AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQCODALTPRODBU
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL
     AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQINVPRODTGAD
AS
begin
  /* Apos a exclusão do inventário */
  EXECUTE PROCEDURE EQMOVPRODIUDSP('D', old.CODEMPPD, old.CODFILIALPD,
     old.CODPROD, old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
     old.CODEMPTM, old.CODFILIALTM, old.CODTIPOMOV, old.CODEMP,
     old.CODFILIAL, old.CODINVPROD, null, null, null, null,null,
     null, null, null, null, null, null, null, null, null, null, null,
     null, null, null,null,
     null, old.DATAINVP, old.CODINVPROD, 'S', old.QTDINVP, old.PRECOINVP,
     old.CODEMPAX, old.CODFILIALAX, old.CODALMOX, null);
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQINVPRODTGAI
AS
BEGIN
  EXECUTE PROCEDURE EQMOVPRODIUDSP('I', new.CODEMPPD, new.CODFILIALPD,
     new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
     new.CODEMPTM, new.CODFILIALTM, new.CODTIPOMOV, new.CODEMP,
     new.CODFILIAL, new.CODINVPROD,  null, null, null, null,
     null, null, null, null, null, null, null, null, null,null,
     null,null,null,null,
     null, null, null, new.DATAINVP, new.CODINVPROD, 'S',
     new.QTDINVP, new.PRECOINVP,
     new.CODEMPAX, new.CODFILIALAX, new.CODALMOX, null);
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQINVPRODTGAU
AS
BEGIN
  EXECUTE PROCEDURE EQMOVPRODIUDSP('U', new.CODEMPPD, new.CODFILIALPD,
     new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
     new.CODEMPTM, new.CODFILIALTM, new.CODTIPOMOV, new.CODEMP,
     new.CODFILIAL, new.CODINVPROD,  null, null, null, null,
     null, null, null, null, null, null, null, null, null,null,null,null,
     null, null, null, null, null, new.DATAINVP, new.CODINVPROD, 'S',
     new.QTDINVP, new.PRECOINVP,
     new.CODEMPAX, new.CODFILIALAX, new.CODALMOX, null);
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQINVPRODTGBI
AS
  DECLARE VARIABLE CLOTEPROD CHAR;
BEGIN
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  SELECT CLOTEPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
    AND CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD INTO CLOTEPROD;
  IF (CLOTEPROD = 'S' AND new.CODLOTE IS NULL) THEN
    EXCEPTION EQINVPRODEX05;
  if (new.SLDATUALINVP is null) then new.SLDATUALINVP = 0;
  if (new.SLDDIGINVP is null) then new.SLDDIGINVP = 0;
/*  new.QTDINVP = new.SLDATUALINVP - new.SLDDIGINVP; */
  SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO new.REFPROD;
END
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRECMERCITOSTGBI
AS
declare variable rmaprod char(1);
declare variable tipoprod varchar(2);

begin
    -- Buscando informação do produto
    select pd.rmaprod, pd.tipoprod from eqproduto pd
    where pd.codemp=new.codemppd and pd.codfilial=new.codfilialpd and pd.codprod=new.codprodpd
    into :rmaprod, :tipoprod;

    if('S' = :rmaprod) then
    begin
        
        new.gerarma = 'S';
        new.statusitos = 'AN';

    end

    -- Se o produto é de Comercio, Equipamento ou Fabricação deve sinalizar
    -- o Ítem de OS como um produto novo, para substituição.

    if(:tipoprod in ('P','E','F')) then
    begin
--        new.gerarma = 'N';
        new.geranovo = 'S';
        new.statusitos = 'AN';
    end


end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRMATGAD
AS
  DECLARE VARIABLE DDTRMA DATE;
  DECLARE VARIABLE ICODEMPTM INT;
  DECLARE VARIABLE ICODFILIALTM SMALLINT;
  declare VARIABLE ICODTIPOMOV INT ;

  begin
      SELECT R.DTAREQRMA,R.codemptm,R.codfilialtm,R.codtipomov
        FROM EQRMA R
        WHERE R.CODRMA = OLD.CODRMA AND R.CODEMP=OLD.CODEMP AND R.CODFILIAL = OLD.CODFILIAL
        INTO :DDTRMA,:ICODEMPTM,:ICODFILIALTM,:ICODTIPOMOV;

      EXECUTE PROCEDURE EQMOVPRODIUDSP('D',OLD.CODEMPPD, OLD.CODFILIALPD, OLD.CODPROD,
        OLD.CODEMPLE, OLD.CODFILIALLE, OLD.codlote, :ICODEMPTM,
        :ICODFILIALTM, :ICODTIPOMOV, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, OLD.CODEMP, OLD.CODFILIAL, OLD.codrma, OLD.coditrma, null, null, null,null,
        null,null,null,null, :DDTRMA, OLD.codrma, 'N', OLD.qtdexpitrma, OLD.precoitrma,
        OLD.CODEMPAX, OLD.CODFILIALAX, OLD.CODALMOX, null);
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRMATGAI
AS
    declare variable DDTRMA date;
    declare variable ICODEMPTM int;
    declare variable ICODFILIALTM smallint;
    declare variable ICODTIPOMOV int;
    declare variable ICODOP int;
    declare variable QTD decimal(15,5);
    declare variable CBAIXARMAAPROV char(1);

    begin

        select r.dtareqrma,r.codemptm,r.codfilialtm,r.codtipomov,r.codop
            from eqrma r
                where r.codrma=new.codrma and r.codemp=new.codemp and r.codfilial=new.codfilial
        into :DDTRMA,:ICODEMPTM,:ICODFILIALTM,:ICODTIPOMOV,:ICODOP;

        select baixarmaaprov from sgprefere5
            where codemp=new.codemp and codfilial=new.codfilial
        into :CBAIXARMAAPROV;

        if(:CBAIXARMAAPROV='S' AND :ICODOP IS NOT NULL) THEN
        begin
            QTD = new.qtdaprovitrma;
        end
        else
            QTD = new.qtdexpitrma;

        execute procedure eqmovprodiudsp('I',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
            new.CODEMPLE, new.CODFILIALLE, new.codlote, :ICODEMPTM,:ICODFILIALTM,:ICODTIPOMOV,
            null, null, null ,null, null, null, null, null, null, null, null, null, new.CODEMP,
            new.CODFILIAL, new.codrma, new.coditrma, null, null, null, null,null,null,null,null,
            :DDTRMA, new.codrma, 'N', :QTD, new.precoitrma, new.CODEMPAX,
            new.CODFILIALAX, new.CODALMOX, null);
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITRMATGAU
as
    declare variable icodemptm int;
    declare variable icodfilialtm smallint;
    declare variable icodtipomov int;
    declare variable ddtrma date;
    declare variable baixarmaaprov char(1);
    declare variable estoque char(1);
    declare variable qtdmov numeric(15,5);

begin
    -- Carregando preferências
    select baixarmaaprov from sgprefere5
    where codemp=new.codemp and codfilial=new.codfilial
    into :baixarmaaprov;

    qtdmov = new.qtdexpitrma;

    if(:baixarmaaprov='S' and new.sitaprovitrma in ('AT','AP')) then
    begin
        estoque = 'S';
        qtdmov = new.qtdaprovitrma;
    end
    else
    begin
        estoque = 'N';
    end


    -- Carregando informações do cabeçalho (RMA)
    select r.dtareqrma,r.codemptm,r.codfilialtm,r.codtipomov
    from eqrma r
    where r.codrma = new.codrma and r.codemp=new.codemp and r.codfilial = new.codfilial
    into :ddtrma,:icodemptm,:icodfilialtm,:icodtipomov;

    -- Movimentação de estoque
    execute procedure eqmovprodiudsp('U',new.codemppd, new.codfilialpd, new.codprod,
        new.codemple, new.codfilialle, new.codlote, :icodemptm,:icodfilialtm, :icodtipomov,
        null, null, null ,null, null,null, null, null, null, null, null, null,
        new.codemp, new.codfilial, new.codrma, new.coditrma, null, null, null, null,
        null, null, null, null, :ddtrma, new.codrma, :estoque, :qtdmov, new.precoitrma,
        new.codempax, new.codfilialax, new.codalmox, null );

end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITSIMILARBI
AS
 declare variable ICODPROD INTEGER;
begin
  SELECT CODPROD FROM EQITSIMILAR ITS
     WHERE ITS.CODEMPPD=new.CODEMPPD AND ITS.CODFILIALPD=new.CODFILIALPD AND
       ITS.CODPROD=new.CODPROD AND ITS.CODSIM != new.CODSIM
       INTO :ICODPROD;
  if (ICODPROD IS NOT NULL) then
     exception EQSIMILAREX01;
  SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD and CODFILIAL=new.CODFILIALPD
     AND CODPROD=new.CODPROD INTO new.REFPROD;

end
^

/* Alter exist trigger... */
ALTER TRIGGER EQITSIMILARBU
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD and CODFILIAL=new.CODFILIALPD
     AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQPRODUTOTGBU
as
  DECLARE VARIABLE ICODFILIAL INTEGER;
  DECLARE VARIABLE CESTNEG CHAR(1);
  DECLARE VARIABLE CESTNEGGRUPPREF CHAR(1);
  DECLARE VARIABLE CESTNEGGRUP CHAR(1);
  DECLARE VARIABLE ICODPROD INTEGER;
begin
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :iCodFilial;
  SELECT ESTNEG, ESTNEGGRUP FROM SGPREFERE1
     WHERE CODEMP=new.CODEMP AND CODFILIAL=:iCodFilial
     INTO :cEstNeg, :cEstNegGrupPref;
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.SLDPROD is null) then
     new.SLDPROD = 0;
  if (new.SLDRESPROD is null) then
     new.SLDRESPROD = 0;
  if (new.SLDCONSIGPROD is null) then
     new.SLDCONSIGPROD = 0;
  new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
  if (cEstNeg Is null) then
      cEstNeg = 'N';
  if (cEstNegGrupPref is null) then
      cEstNegGrupPref = 'N';
  if ((new.SLDPROD < 0) AND (new.TIPOPROD='P') ) THEN
  begin
    if (cEstNegGrupPref = 'S') then
    begin
       SELECT ESTNEGGRUP FROM EQGRUPO
         WHERE CODEMP=new.CODEMPGP AND CODFILIAL=new.CODFILIALGP AND
            CODGRUP=new.CODGRUP INTO :CESTNEGGRUP;
       if (cEstNegGrup is null) then
          cEstNegGrup = 'N';
       if (cEstNegGrup='N') then
          EXCEPTION EQPRODUTOEX01 'O PROD. '||rtrim(cast(new.CODPROD as char(10)))
            ||'-'||substring(new.DESCPROD from 1 for 20)||
          ' NÃO POSSUI SALDO P/COMPL. A OPERAÇÃO';
    end
    else if (cEstNeg='N') then
          EXCEPTION EQPRODUTOEX01 'O PROD. '||rtrim(cast(new.CODPROD as char(10)))
            ||'-'||substring(new.DESCPROD from 1 for 20)||
          ' NÃO POSSUI SALDO P/COMPL. A OPERAÇÃO';
  end
  if ( new.REFPROD != old.REFPROD ) then
  begin
     SELECT FIRST 1 CODPROD FROM EQMOVPROD WHERE CODEMPPD=new.CODEMP AND
        CODFILIALPD=new.CODFILIAL AND CODPROD=new.CODPROD
          INTO :ICODPROD;
     if ( (ICODPROD IS NOT NULL) AND (ICODPROD=new.CODPROD) ) then
        EXCEPTION EQPRODUTOEX01 'REFERÊNCIA NÃO PODE SER ALTERADA. PRODUTO POSSUI MOVIMENTO!';
     else
        UPDATE EQCODALTPROD SET REFPROD=new.REFPROD WHERE CODEMP=new.CODEMP AND
          CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD;
  end
end
^

/* Alter exist trigger... */
ALTER TRIGGER EQRECMERCTGAI
as
declare variable codemptp integer;
declare variable codfilialtp smallint;
declare variable codtiporecmerc integer;
declare variable codprocrecmerc integer;
declare variable coditrecmerc integer;

begin

    -- Se tiver um produto padrão no cabeçalho, deve gerar os ítens automaticamente.
    if(new.codprod is not null) then
    begin

        coditrecmerc = 1;
    
        for select pr.codemp, pr.codfilial, pr.codtiporecmerc, pr.codprocrecmerc
        from eqprocrecmerc pr
        where pr.codemp=new.codemptr and pr.codfilial=new.codfilialtr and pr.codtiporecmerc=new.codtiporecmerc
        into :codemptp,  :codfilialtp, :codtiporecmerc, :codprocrecmerc do
        begin

            select coalesce( max(coditrecmerc) , 0 ) + 1
            from eqitrecmerc rm
            where rm.codemp=new.codemp and rm.codfilial=new.codfilial and rm.ticket=new.ticket
            into coditrecmerc;
        
            insert into eqitrecmerc
            ( codemp, codfilial, ticket, coditrecmerc, codemppd, codfilialpd, codprod, refprod, codemptp, codfilialtp, codtiporecmerc, codprocrecmerc ) values
            ( new.codemp, new.codfilial, new.ticket, :coditrecmerc, new.codemppd, new.codfilial, new.codprod, new.refprod, :codemptp, :codfilialtp, :codtiporecmerc, :codprocrecmerc );


        end
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER FNBORDEROTGAU
AS                                   
DECLARE VARIABLE IFILIALLANCA INTEGER;
DECLARE VARIABLE ICODLANCA INTEGER;   
DECLARE VARIABLE NVALOR NUMERIC(15,5); 
DECLARE VARIABLE ICODEMPPLAN INTEGER;
DECLARE VARIABLE IFILIALPLAN INTEGER;
DECLARE VARIABLE SPLANEJAMENTO CHAR(13); 
DECLARE VARIABLE ICODEMPPLANBOR INTEGER;
DECLARE VARIABLE IFILIALPLANBOR INTEGER;
DECLARE VARIABLE SPLANEJAMENTOBOR CHAR(13);
DECLARE VARIABLE ICODSUBLANCA INTEGER;  
begin

  IF (new.STATUSBOR = 'BC') THEN
  BEGIN

    SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNLANCA') INTO IFILIALLANCA;
    SELECT ISEQ FROM SPGERANUM(new.CODEMP,:IFILIALLANCA,'LA') INTO ICODLANCA;
    SELECT SUM(IR.VLRITREC) FROM FNITRECEBER IR, FNITBORDERO IB
      WHERE
      IR.CODEMP=IB.CODEMPRC AND IR.CODFILIAL=IB.CODFILIALRC AND
      IR.CODREC=IB.CODREC AND IR.NPARCITREC=IB.NPARCITREC AND
      IB.CODEMP=new.CODEMP AND IB.CODFILIAL=new.CODFILIAL AND IB.CODBOR=new.CODBOR
      INTO NVALOR;

    SELECT P.CODEMP, P.CODFILIAL, P.CODPLAN FROM FNPLANEJAMENTO P, FNCONTA C
      WHERE P.CODEMP=C.CODEMPPN AND P.CODFILIAL=C.CODFILIALPN AND P.CODPLAN=C.CODPLAN AND
      C.CODEMP=new.CODEMPCC AND C.CODFILIAL=new.CODFILIALCC AND C.NUMCONTA=new.NUMCONTA
      INTO ICODEMPPLAN, IFILIALPLAN, SPLANEJAMENTO; 

    SELECT P.CODEMP, P.CODFILIAL, P.CODPLAN FROM FNPLANEJAMENTO P, FNCONTA C
      WHERE P.CODEMP=C.CODEMPPN AND P.CODFILIAL=C.CODFILIALPN AND P.CODPLAN=C.CODPLAN AND
      C.CODEMP=new.CODEMPCB AND C.CODFILIAL=new.CODFILIALCB AND C.NUMCONTA=new.NUMCONTABOR
      INTO ICODEMPPLANBOR, IFILIALPLANBOR, SPLANEJAMENTOBOR;

    /* Transferencia */
    INSERT INTO FNLANCA (
      TIPOLANCA,CODEMP,CODFILIAL,CODLANCA,
      CODEMPPN,CODFILIALPN,CODPLAN, DTCOMPLANCA,
      DATALANCA,DOCLANCA,HISTBLANCA,TRANSFLANCA,VLRLANCA)
      VALUES (
      'A',new.CODEMP,:IFILIALLANCA,:ICODLANCA,
      :ICODEMPPLANBOR,:IFILIALPLANBOR,:SPLANEJAMENTOBOR, new.DTBOR,
      new.DTBOR,CAST(new.CODBOR AS CHAR(15)),'ADIANTAMENTO DE RECEBIVÉIS','S',0);       

    ICODSUBLANCA=1;

    INSERT INTO FNSUBLANCA (
      CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,
      CODEMPPN,CODFILIALPN,CODPLAN, DTCOMPSUBLANCA,
      DATASUBLANCA,VLRSUBLANCA,HISTSUBLANCA)
      VALUES (
      new.CODEMP,:IFILIALLANCA,:ICODLANCA,:ICODSUBLANCA,
      :ICODEMPPLAN,:IFILIALPLAN,:SPLANEJAMENTO, new.DTBOR,
      new.DTBOR,:NVALOR,'ADIANTAMENTO DE RECEBIVÉIS');
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNCHEQUETGAU
AS
begin

    -- Se o cheque mudar de Cadastrado para Emitido,
    -- deverá sinalizar o titulo para ser baixado na conta de cheques.
    if(old.sitcheq='CA' and new.sitcheq='ED') then
    begin

        update fnpagcheq pc
        set pc.baixa='S'
        where pc.codempch=new.codemp and pc.codfilialch=new.codfilial and pc.seqcheq=new.seqcheq;

    end
    -- Deve realizar a transferência entre as contas de cheque
    -- Quando o cheque for compensado.
    if(old.sitcheq='ED' and new.sitcheq='CD') then
    begin

        update fnpagcheq pc
        set pc.transfere='S'
        where pc.codempch=new.codemp and pc.codfilialch=new.codfilial and pc.seqcheq=new.seqcheq;

    end

     -- Serve para limpar os flags caso o status do cheque volte para cadastrado
    if(new.sitcheq='CA' and old.sitcheq!='CA') then
    begin
        update fnpagcheq pc
        set pc.baixa='N', pc.transfere='N'
        where pc.codempch=new.codemp and pc.codfilialch=new.codfilial and pc.seqcheq=new.seqcheq;
    end

    -- Caso o status do cheque seja cancelado, deve eliminar os vinculos iniciais
    if(new.sitcheq='CN' and old.sitcheq!='CN') then
    begin
        delete from fnpagcheq pc
        where pc.codempch=new.codemp and pc.codfilialch=new.codfilial and pc.seqcheq=new.seqcheq;
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER FNITPAGARTGBU
AS
  DECLARE VARIABLE IFILIALPAG INTEGER;
  DECLARE VARIABLE ICODFOR INTEGER;
  DECLARE VARIABLE ICODEMPFR INTEGER;
  DECLARE VARIABLE ICODFILIALFR INTEGER;
BEGIN

  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);

  IF ( new.EMMANUT IS NULL ) THEN
  BEGIN
      new.EMMANUT = 'N';
  END

  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN

     SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
     IF ((old.STATUSITPAG IN ('PP','PL') )  AND (new.STATUSITPAG='P1') ) THEN
     BEGIN
       DELETE FROM FNLANCA WHERE CODPAG=new.CODPAG AND NPARCPAG=new.NPARCPAG
              AND CODEMPPG=new.CODEMP AND CODFILIALPG = new.CODFILIAL
              AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALPAG;

       new.VLRPAGOITPAG = 0;
       new.DTPAGOITPAG = NULL;

     END
     ELSE IF ( (old.STATUSITPAG='P1') AND ( new.STATUSITPAG='CP' ) ) THEN
     BEGIN
        IF ( (new.OBSITPAG IS NULL) OR (rtrim(new.OBSITPAG)='') ) THEN
        BEGIN
           EXCEPTION FNITPAGAREX01;
        END
        new.VLRCANCITPAG = new.VLRAPAGITPAG;
        new.VLRPARCITPAG = 0;
        new.VLRDESCITPAG = 0;
        new.VLRJUROSITPAG = 0;
        new.VLRDEVITPAG = 0;
        new.VLRITPAG = 0;
     END

     new.VLRITPAG = new.VLRPARCITPAG - new.VLRDESCITPAG - new.VLRDEVITPAG + new.VLRJUROSITPAG +
     new.VLRMULTAITPAG + new.VLRADICITPAG;
     new.VLRAPAGITPAG = new.VLRITPAG - new.VLRPAGOITPAG;
  
     if (new.VLRAPAGITPAG < 0) then /* se o valor a pagar for menor que zero */
       new.VLRAPAGITPAG = 0;  /* entÃ£o valor a pagar serÃ¡ zero */
     if ( (new.VLRAPAGITPAG=0) AND (new.VLRITPAG>0) ) then /* se o valor a pagar for igual a zero e existir valor na parcela*/
       new.STATUSITPAG = 'PP';  /* entÃ£o o status serÃ¡ PP(pagamento completo) */
     else if ( (new.VLRPAGOITPAG>0) AND (new.VLRITPAG>0) ) then /* caso contrÃ¡rio e o valor pago maior que zero e existir valor na parcela*/
       new.STATUSITPAG = 'PL'; /*  entÃ£o o status serÃ¡ PL(pagamento parcial) */

     /* faz o lanÃ§amento */
     SELECT CODFOR,CODEMPFR,CODFILIALFR FROM FNPAGAR WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND CODPAG=new.CODPAG
        INTO ICODFOR,ICODEMPFR,ICODFILIALFR;

     IF ((old.STATUSITPAG='P1' AND new.STATUSITPAG in ('PP','PL')) OR (old.STATUSITPAG in ('PP','PL') AND new.STATUSITPAG in ('PP','PL') AND new.VLRPAGOITPAG > 0)) THEN
     BEGIN
       IF(new.multibaixa is null or new.multibaixa = 'N')THEN
       BEGIN
           EXECUTE PROCEDURE FNADICLANCASP02(new.CodPag,new.NParcPag,new.NumConta,new.CODEMPCA,new.CODFILIALCA,:ICODFOR,:ICODEMPFR,:ICODFILIALFR,
                              new.CodPlan,new.CODEMPPN,new.CODFILIALPN,new.AnoCC,new.CodCC,new.CODEMPCC,new.CODFILIALCC, new.DTCOMPITPAG,
                              new.DtPagoItPag,new.DocLancaItPag,new.ObsItPag,new.VlrPagoItPag,new.CODEMP,new.CODFILIAL,new.vlrjurositpag,new.vlrdescitpag);
       END

       /* Altera o valor pago e o valor a pagar */
       new.VLRPAGOITPAG = new.VLRPAGOITPAG + old.VLRPAGOITPAG;
       new.VLRAPAGITPAG = new.VLRITPAG - new.VLRPAGOITPAG;

       if (new.VLRAPAGITPAG < 0) then /* se o valor a pagar for menor que zero */
         new.VLRAPAGITPAG = 0;  /* entÃ£o valor a pagar serÃ¡ zero */

       if (new.VLRAPAGITPAG=0) then /* se o valor a pagar for igual a zero */
         new.STATUSITPAG = 'PP';  /* entÃ£o o status serÃ¡ PP(pagamento completo) */
       else if (new.VLRPAGOITPAG>0) then /* caso contrÃ¡rio e o valor pago maior que zero */
         new.STATUSITPAG = 'PL'; /*  entÃ£o o status serÃ¡ PL(pagamento parcial) */

     END
     ELSE IF ((old.STATUSITPAG='PP') AND (new.STATUSITPAG='PP')) THEN
     BEGIN
        EXCEPTION FNPAGAREX01;
     END

   END

END
^

/* Alter exist trigger... */
ALTER TRIGGER FNITRECEBERTGAU
AS
  DECLARE VARIABLE ICODCLI INTEGER;
  DECLARE VARIABLE ICODEMPCL INTEGER;
  DECLARE VARIABLE ICODFILIALCL INTEGER;
  DECLARE VARIABLE SCODFILIALCI SMALLINT;
  DECLARE VARIABLE SCODFILIALLC SMALLINT;
  DECLARE VARIABLE ESTITRECALTDTVENC CHAR(1);
  DECLARE VARIABLE AUTOBAIXAPARC CHAR(1);
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN

     SELECT ESTITRECALTDTVENC FROM SGPREFERE1 WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL INTO :ESTITRECALTDTVENC;
     SELECT ITPP.AUTOBAIXAPARC FROM FNPARCPAG ITPP, FNRECEBER R
       WHERE ITPP.CODEMP=R.CODFILIALPG AND ITPP.CODFILIAL=R.CODFILIALPG AND ITPP.CODPLANOPAG=R.CODPLANOPAG AND
         ITPP.NROPARCPAG=new.NPARCITREC AND
          R.CODEMP=new.CODEMP AND R.CODFILIAL=new.CODFILIAL AND R.CODREC=new.CODREC
       INTO :AUTOBAIXAPARC;
     IF  ( ( (old.STATUSITREC IN ('RP','RL') )  AND (new.STATUSITREC='R1') ) OR
           ( (old.STATUSITREC IN ('RP','RL') )  AND (new.STATUSITREC='RR') ) OR
           ( (ESTITRECALTDTVENC='S') AND (AUTOBAIXAPARC='S') AND
             (old.DTVENCITREC<>new.DTVENCITREC) ) ) THEN
     BEGIN
       SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNCOMISSAO') INTO :SCODFILIALCI;
       SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNLANCA') INTO :SCODFILIALLC;
       UPDATE VDCOMISSAO SET STATUSCOMI='C1'
              WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC
              AND CODEMPRC = new.CODEMP AND CODFILIALRC=new.CODFILIAL
              AND CODEMP=new.CODEMP AND CODFILIAL=:SCODFILIALCI
              AND STATUSCOMI NOT IN ('CE') AND TIPOCOMI='R';
       DELETE FROM FNLANCA WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC
              AND CODEMPRC= new.CODEMP AND CODFILIALRC=new.CODFILIAL
              AND CODEMP=new.CODEMP AND CODFILIAL = :SCODFILIALLC;
     END
     ELSE IF ((old.STATUSITREC='R1' AND new.STATUSITREC in ('RP','RL')) OR
              (old.STATUSITREC='RR' AND new.STATUSITREC in ('RP','RL')) OR
              (old.STATUSITREC in ('RP','RL') AND new.STATUSITREC in ('RP','RL') AND new.VLRPAGOITREC > 0) OR
              (old.STATUSITREC = 'RB' AND new.STATUSITREC = 'RP')) THEN
     BEGIN
        SELECT CODCLI,CODEMPCL,CODFILIALCL FROM FNRECEBER WHERE CODEMP=new.CODEMP AND
           CODFILIAL=new.CODFILIAL AND CODREC=new.CODREC
           INTO ICODCLI,ICODEMPCL,ICODFILIALCL;
        IF ((new.VLRPAGOITREC-old.VLRPAGOITREC) > 0) THEN
        BEGIN
           EXECUTE PROCEDURE FNADICLANCASP01(new.CodRec,new.NParcItRec,new.PDVITREC,new.NumConta,new.CODEMPCA,new.CODFILIALCA,:ICODCLI,:ICODEMPCL,:ICODFILIALCL,
                              new.CodPlan,new.CODEMPPN,new.CODFILIALPN,new.ANOCC,new.CODCC,new.CODEMPCC,new.CODFILIALCC, new.dtCompItRec, new.DtPagoItRec,new.DocLancaItRec,
                              SUBSTRING(new.ObsItRec FROM 1 FOR 50),new.VlrPagoItRec-old.VlrPagoItRec,new.CODEMP,new.CODFILIAL,new.vlrjurositrec,new.vlrdescitrec);
        END
        IF (new.STATUSITREC = 'RP') THEN
        BEGIN
            UPDATE VDCOMISSAO SET STATUSCOMI='C2'
               WHERE CODREC=old.CODREC
               AND CODEMPRC=old.CODEMP
               AND CODFILIALRC=old.CODFILIAL
               AND NPARCITREC=old.NPARCITREC
               AND NOT STATUSCOMI IN ('CP','C2')
               AND CODEMP=old.CODEMP;
        END
     END
     ELSE IF (old.VLRCOMIITREC != new.VLRCOMIITREC) THEN
     BEGIN
        EXECUTE PROCEDURE vdgeracomissaosp(new.CODEMP, new.CODFILIAL, new.CODREC,
           new.NPARCITREC, new.VLRCOMIITREC, new.DTVENCITREC);
     END

     IF ( (new.ALTUSUITREC='S') AND ( (old.VLRITREC!=new.VLRITREC) OR
          (old.VLRDESCITREC!=new.VLRDESCITREC) OR (old.VLRMULTAITREC!=new.VLRMULTAITREC) OR
          (old.VLRJUROSITREC!=new.VLRJUROSITREC) OR (old.VLRPARCITREC!=new.VLRPARCITREC) OR
          (old.VLRPAGOITREC!=new.VLRPAGOITREC) OR (old.VLRAPAGITREC!=new.VLRAPAGITREC) ) ) THEN
        UPDATE FNRECEBER SET VLRREC = VLRREC - old.VLRITREC + new.VLRITREC,
            VLRDESCREC = VLRDESCREC - old.VLRDESCITREC + new.VLRDESCITREC,
            VLRMULTAREC = VLRMULTAREC - old.VLRMULTAITREC + new.VLRMULTAITREC,
            VLRJUROSREC = VLRJUROSREC - old.VLRJUROSITREC + new.VLRJUROSITREC,
            VLRDEVREC = VLRDEVREC - old.VLRDEVITREC + new.VLRDEVITREC,
            VLRPARCREC = VLRPARCREC - old.VLRPARCITREC + new.VLRPARCITREC,
            VLRPAGOREC = VLRPAGOREC - old.VLRPAGOITREC + new.VLRPAGOITREC,
            VLRAPAGREC = VLRAPAGREC - old.VLRAPAGITREC + new.VLRAPAGITREC,
            ALTUSUREC = 'S' WHERE CODREC=new.CODREC
           AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
   END
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNITRECEBERTGBI
as

    declare variable seqnossonumero int;

begin

    --Setando valor padrão de campos para 0;
    if (new.vlrparcitrec is null) then
        new.vlrparcitrec = 0;

    if (new.vlrdescitrec is null) then
        new.vlrdescitrec = 0;

    if (new.vlrjurositrec is null) then
        new.vlrjurositrec = 0;

    if (new.vlrmultaitrec is null) then
        new.vlrmultaitrec = 0;

    -- Calculando o valor liquido da parcela...
    new.vlritrec = new.vlrparcitrec - new.vlrdescitrec - new.vlrdevitrec + new.vlrjurositrec + new.vlrmultaitrec;
    new.vlrapagitrec = new.vlritrec - new.vlrpagoitrec;

    -- Zerando valores caso fique negativo...
    if (new.vlrapagitrec<0) then
        new.vlrapagitrec = 0;

    if(new.dtprevitrec is null) then
        new.dtprevitrec = new.dtvencitrec;

    --Buscando sequencial caso informações de banco e carteira já tenham sido informadas...

    if(new.codbanco is not null and new.codcartcob is not null and new.numconta is not null) then
    begin

       select seqnossonumero
       from fngeraseqnossonumero( new.codempbo, new.codfilialbo, new.codbanco, new.codempcb, new.codfilialcb, new.codcartcob, new.codempca, new.codfilialca, new.numconta)
       into :seqnossonumero;

       if (:seqnossonumero is not null and :seqnossonumero >0 ) then
       begin
          new.seqnossonumero = :seqnossonumero;
       end

    end



end
^

SET TERM ; ^

UPDATE RDB$TRIGGERS SET RDB$DESCRIPTION = 
''
WHERE RDB$TRIGGER_NAME = 'FNITRECEBERTGBI02';

/* Alter exist trigger... */
SET TERM ^ ;

ALTER TRIGGER FNITRECEBERTGBU
AS

  DECLARE VARIABLE SCODFILIALPF SMALLINT;
  DECLARE VARIABLE CCOMISPDUPL CHAR(1);
  DECLARE VARIABLE NVLRPARCREC NUMERIC(15, 5);
  DECLARE VARIABLE NVLRCOMIREC NUMERIC(15, 5);
  DECLARE VARIABLE ESTITRECALTDTVENC CHAR(1);
  DECLARE VARIABLE AUTOBAIXAPARC CHAR(1);
  declare variable seqnossonumero int;

BEGIN
  IF (new.EMMANUT IS NULL) THEN   /* Evita flag de manutenÃ§Ã£o nulo */
     new.EMMANUT='N';

  IF ( new.ALTUSUITREC IS NULL ) THEN /* Para nÃ£o permitir flag de usuÃ¡rio nulo */
     new.ALTUSUITREC = 'S';

  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
     new.DTALT=cast('now' AS DATE);
     new.IDUSUALT=USER;
     new.HALT = cast('now' AS TIME);

     IF ( (new.DTPAGOITREC is not null) AND (new.DTLIQITREC is null) ) THEN
     BEGIN
        new.DTLIQITREC = new.DTPAGOITREC;
     END

     SELECT ESTITRECALTDTVENC FROM SGPREFERE1 WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL INTO :ESTITRECALTDTVENC;
     SELECT ITPP.AUTOBAIXAPARC FROM FNPARCPAG ITPP, FNRECEBER R
       WHERE ITPP.CODEMP=R.CODFILIALPG AND ITPP.CODFILIAL=R.CODFILIALPG AND ITPP.CODPLANOPAG=R.CODPLANOPAG AND
         ITPP.NROPARCPAG=new.NPARCITREC AND
          R.CODEMP=new.CODEMP AND R.CODFILIAL=new.CODFILIAL AND R.CODREC=new.CODREC
       INTO :AUTOBAIXAPARC;

     IF  ( ( (old.STATUSITREC IN ('RP','RL') )  AND (new.STATUSITREC IN ('R1', 'RR')) ) OR
           ( (ESTITRECALTDTVENC='S') AND (AUTOBAIXAPARC='S') AND
             (old.DTVENCITREC<>new.DTVENCITREC) ) ) THEN
     BEGIN
       IF(new.STATUSITREC != 'RR')THEN
       BEGIN
        new.STATUSITREC = 'R1';
       END
       new.VLRPAGOITREC = 0;
     END
     ELSE IF ( (old.STATUSITREC='R1') AND ( new.STATUSITREC='CR' ) ) THEN
     BEGIN
        IF ( (new.OBSITREC IS NULL) OR (rtrim(new.OBSITREC)='') ) THEN
        BEGIN
           EXCEPTION FNITRECEBEREX02;
        END
        new.VLRCANCITREC = new.VLRAPAGITREC;
        new.VLRPARCITREC = 0;
        new.VLRDESCITREC = 0;
        new.VLRJUROSITREC = 0;
        new.VLRDEVITREC = 0;
        new.VLRITREC = 0;
     END

     new.VLRITREC = new.VLRPARCITREC - new.VLRDESCITREC - new.VLRDEVITREC + new.VLRJUROSITREC + new.VLRMULTAITREC;
     new.VLRAPAGITREC = new.VLRITREC - new.VLRPAGOITREC;
     if (new.VLRAPAGITREC < 0) then /* se o valor a pagar for maior que zero */
       new.VLRAPAGITREC = 0;  /* entÃ£o valor a pagar serÃ¡ zero */
     if ( (new.VLRAPAGITREC=0) AND (new.STATUSITREC<>'CR') ) then /* se o valor a pagar for igual a zero */
       new.STATUSITREC = 'RP';  /* entÃ£o o status serÃ¡ RP(pagamento completo) */
     else if (new.VLRPAGOITREC>0) then /* caso contrÃ¡rio e o valor pago maior que zero */
       new.STATUSITREC = 'RL'; /*  entÃ£o o status serÃ¡ RL(pagamento parcial) */
     /*
       Esta seÃ§Ã£o Ã© destinada e ajustar as comissÃµes conforme os valores de parcelas
       caso o preferÃªncias esteja ajustado para isso.
     */
     IF ( (new.VLRPARCITREC!=old.VLRPARCITREC) AND (new.VLRPARCITREC!=0) ) THEN
     BEGIN
        SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :SCODFILIALPF;
        SELECT P1.COMISPDUPL  FROM SGPREFERE1 P1
            WHERE P1.CODEMP=new.CODEMP AND P1.CODFILIAL=:SCODFILIALPF INTO :CCOMISPDUPL;
        IF (CCOMISPDUPL='S') THEN
        BEGIN
           SELECT V.VLRLIQVENDA, R.VLRCOMIREC FROM FNRECEBER R, VDVENDA V
             WHERE R.CODEMP=new.CODEMP AND R.CODFILIAL=new.CODFILIAL AND
                 R.CODREC=new.CODREC AND V.CODEMP=R.CODEMPVA AND V.CODFILIAL=R.CODFILIALVA AND
                 V.TIPOVENDA=R.TIPOVENDA AND V.CODVENDA=R.CODVENDA INTO :NVLRPARCREC, :NVLRCOMIREC;
           IF (NVLRPARCREC!=0) THEN
             new.VLRCOMIITREC = cast( new.VLRPARCITREC * :NVLRCOMIREC / :NVLRPARCREC as NUMERIC(15, 5) );
        END
     END
     IF ((old.IMPRECIBOITREC='N') AND (new.IMPRECIBOITREC='S') AND (new.RECIBOITREC IS NULL)) THEN
     BEGIN
        SELECT ISEQ FROM SPGERANUM(new.CODEMP,new.CODFILIAL,'RB') INTO new.RECIBOITREC;
     END
     /*AlteraÃ§Ã£o das datas de entrada e saida do estado de 'em cobranÃ§a'*/
     IF (new.RECEMCOB='S') THEN
     BEGIN
       new.DTINIEMCOB=CURRENT_DATE;
       new.DTFIMEMCOB=NULL;
     END
     ELSE IF (new.RECEMCOB='N') THEN
     BEGIN
       new.DTFIMEMCOB=CURRENT_DATE;
     END
     if(new.dtprevitrec is null) then
       new.dtprevitrec = new.dtvencitrec;

    --Buscando sequencial caso informaÃ§Ãµes de banco e carteira tenham sido alteradas...

       if ( (old.codbanco is null or old.codcartcob is null or old.numconta is null )
             or
            (new.codbanco != old.codbanco or new.codcartcob != old.codcartcob or new.numconta != old.numconta)
             and
            (new.codbanco is not null and new.codcartcob is not null and new.numconta is not null ) ) then

       begin

           seqnossonumero = 0;

          select seqnossonumero
          from fngeraseqnossonumero( new.codempbo, new.codfilialbo, new.codbanco, new.codempcb, new.codfilialcb, new.codcartcob, new.codempca, new.codfilialca, new.numconta)
          into :seqnossonumero;

          if (:seqnossonumero is not null and :seqnossonumero >0 ) then
          begin
             new.seqnossonumero = :seqnossonumero;
          end

       end
   end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNLANCATGAU
AS
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
     UPDATE FNSUBLANCA SET DTCOMPSUBLANCA = new.DTCOMPLANCA,
         DTPREVSUBLANCA=new.DTPREVLANCA,
         DATASUBLANCA=new.DATALANCA,VLRSUBLANCA=new.VLRLANCA,FLAG=new.FLAG
         WHERE CODLANCA=old.CODLANCA AND CODSUBLANCA=0
         AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
  END
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNLANCATGBI
AS
BEGIN
  new.STATUSLANCA = 'L1';
  IF (new.HISTLANCA IS NULL) THEN
    new.HISTLANCA = new.HISTBLANCA;
  IF (new.DTPREVLANCA IS NULL) THEN
    new.DTPREVLANCA = new.DATALANCA;
  IF (new.DTCOMPLANCA IS NULL) THEN
    new.DTCOMPLANCA = new.DATALANCA;
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNLANCATGBU
as
begin
  if (new.emmanut is null) then
    new.emmanut = 'N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
     new.DTALT=cast('now' AS DATE);
     new.IDUSUALT=USER;
     new.HALT = cast('now' AS TIME);
  END
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNPAGARTGAI
as
declare variable vlrpag numeric(15, 5);
declare variable percpag numeric(11,6);
declare variable resto numeric(15, 5);
declare variable numparc integer;
declare variable diaspag integer;
declare variable i integer;
declare variable filialpp integer;
declare variable regrvcto char(1);
declare variable rvsab char(1);
declare variable rvdom char(1);
declare variable rvfer char(1);
declare variable rvdia char(1);
declare variable diavcto smallint;
declare variable casasdecfin smallint;
declare variable dtvencto date;

begin

    -- Buscando filial do plano de pagamento
    select icodfilial from sgretfilial(new.codemp, 'FNPLANOPAG') into :filialpp;

    -- Buscando preferencias

    select casasdecfin from sgprefere1 where codemp=new.codemp and codfilial=new.codfilial
    into casasdecfin;

    -- Carregando valor restante de pagamento
    i = 0;
    resto = new.vlrpag;

    -- Buscando informações do plano de pagamento
    select pp.parcplanopag, pp.regrvctoplanopag, pp.rvsabplanopag, pp.rvdomplanopag,
           pp.rvferplanopag, pp.rvdiaplanopag, pp.diavctoplanopag
    from fnplanopag pp
    where pp.codplanopag=new.codplanopag and pp.codemp=new.codemp and pp.codfilial=:filialpp
    into :numparc, :regrvcto, :rvsab, :rvdom, :rvfer, :rvdia, :diavcto;

    -- Gerando parcelas

    for select pp.percpag, pp.diaspag
        from fnparcpag pp
        where pp.codplanopag=new.codplanopag and pp.codemp=new.codemp and pp.codfilial=:filialpp
        order by pp.diaspag
        into :percpag, :diaspag
    do
    begin
        i = i + 1;
        
        -- Calculando valor da parcela
        vlrpag = cast(cast(new.vlrpag * percpag as numeric(15, 5)) / 100 as numeric(15, 5));

        -- Usando o arredondamento para evitar dízima
        select v.deretorno
        from arreddouble(:vlrpag,:casasdecfin) v
        into :vlrpag;

        -- Valor restante para proximas parcelas
        resto = resto - vlrpag;

        if (i = numparc) then
        begin
            vlrpag = vlrpag + resto;
        end
        
        -- Buscando data de vencimento
        select c.dtvencret
        from sgcalcvencsp( new.codemp , new.datapag, new.datapag + :diaspag, :regrvcto,
                           :rvsab, :rvdom, :rvfer, :rvdia, :diavcto, :diaspag ) c
        into :dtvencto;

        -- Inserindo parcela

        insert into fnitpagar (CODEMP,CODFILIAL,CODPAG,NPARCPAG,VLRITPAG,VLRDESCITPAG,VLRMULTAITPAG,
                           VLRJUROSITPAG,VLRPARCITPAG,VLRPAGOITPAG,VLRAPAGITPAG,
                           DTITPAG, DTCOMPITPAG, DTVENCITPAG,STATUSITPAG,VLRADICITPAG,FLAG,OBSITPAG,
                           CODEMPTC,CODFILIALTC,CODTIPOCOB,CODEMPCA,CODFILIALCA,NUMCONTA,
                           CODEMPPN, CODFILIALPN, CODPLAN, CODEMPCC, CODFILIALCC, ANOCC, CODCC
                           ) VALUES
                           (new.CODEMP,new.CODFILIAL,new.CODPAG,:i,:vlrpag,0,0,0,:vlrpag,0,:vlrpag,
                            new.datapag, new.DTCOMPPAG, :dtvencto,'P1',new.vlradicpag,new.flag,new.obspag,
                            new.CODEMPTC,new.CODFILIALTC,new.CODTIPOCOB, new.codempca, new.codfilialca, new.numconta,
                            new.codemppn, new.codfilialpn, new.codplan, new.codempcc, new.codfilialcc, new.anocc, new.codcc
                            );
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER FNPAGARTGBI
AS
BEGIN
  IF (new.VLRDESCPAG IS NULL) THEN new.VLRDESCPAG = 0;
  IF (new.VLRJUROSPAG IS NULL) THEN new.VLRJUROSPAG = 0;
  IF (new.VLRMULTAPAG IS NULL) THEN new.VLRMULTAPAG = 0;
  IF (new.VLRPARCPAG IS NULL) THEN new.VLRPARCPAG = 0;
  IF (new.VLRPAGOPAG IS NULL) THEN new.VLRPAGOPAG = 0;
  IF (new.STATUSPAG IS NULL) THEN new.STATUSPAG = 'P1';
  IF (new.DTCOMPPAG IS NULL) THEN new.DTCOMPPAG = new.DATAPAG;
  new.VLRPAG = new.VLRPARCPAG - new.VLRDESCPAG - new.VLRDEVPAG + new.VLRJUROSPAG + new.VLRADICPAG +
  new.VLRMULTAPAG;
  new.VLRAPAGPAG = new.VLRPAG - new.VLRPAGOPAG;
  if ( ( new.NUMCONTA IS NULL ) AND ( new.CODTIPOCOB IS NOT NULL ) ) then
  begin
     SELECT TC.CODEMPCT, TC.CODFILIALCT, TC.NUMCONTA FROM FNTIPOCOB TC
        WHERE TC.CODEMP=new.CODEMPTC AND TC.CODFILIAL=new.CODFILIALTC AND TC.CODTIPOCOB=new.CODTIPOCOB
        INTO new.CODEMPCA, new.CODFILIALCA, new.NUMCONTA;
  end
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNPAGCHEQTGAU
as
    declare variable codfilialch smallint;
    declare variable contacheq char(10);
    declare variable codempcb int;
    declare variable codfilialcb smallint;
    declare variable contabaixa char(10);
    declare variable codemppn int;
    declare variable codfilialpn smallint;
    declare variable codplan char(13);
    declare variable tipocheq char(2);
    declare variable dtvenctocheq date;
    declare variable vlrcheq decimal(15,5);
    declare variable vlrapagitpag decimal(15,5);
    declare variable vlrbaixa decimal(15,5);
    declare variable dtcompitpag date;
    declare variable statusitpagar char(2);
    declare variable codempla int;
    declare variable codfilialla smallint;
    declare variable codlancatransf int;
    declare variable codemppnorig int;
    declare variable codfilialpnorig smallint;
    declare variable codplanorig char(13);
    declare variable codemppntransf int;
    declare variable codfilialpntransf smallint;
    declare variable codplantransf char(13);
    declare variable numcheq int;
    declare variable dtcompcheq date;
    declare variable vlrlanca decimal(15,5);
    declare variable icont int;
    declare variable obsitpag varchar(250);
    declare variable histblanca varchar(250);
    declare variable snumcheque varchar(15);
    declare variable sdoccompra varchar(50);
    declare variable nomefavcheq varchar(50);

begin

    -- Busca informações do cheque
    select ch.tipocheq, ch.contacheq, ch.dtvenctocheq, ch.vlrcheq, ch.numcheq, ch.dtcompcheq, ch.nomefavcheq
    from fncheque ch
    where ch.codemp=new.codempch and ch.codfilial=new.codfilialch and ch.seqcheq=new.seqcheq
    into :tipocheq, :contacheq, :dtvenctocheq, :vlrcheq, :numcheq, :dtcompcheq, :nomefavcheq;

    -- Baixa de título na emissão do cheque
    if(coalesce(old.baixa,'N')='N' and new.baixa='S') then
    begin

        -- Buscando filial da tabela de contas
        select icodfilial from sgretfilial(new.codemp,'FNCONTA') into :codfilialch;

        -- Se o cheque é de pagamento de fornecedores, deverá dar baixa no título para a conta de controle de cheques.
        if('PF' = :tipocheq) then
        begin

            -- Busca conta para a baixa
            select cv.codempcv, cv.codfilialcv, cv.numcontacv
            from fncontavinculada cv
            where cv.codemp=new.codempch and cv.codfilial=:codfilialch and cv.numconta=:contacheq
            into :codempcb, :codfilialcb, :contabaixa;

            -- Busca informações do planejamento
            select ip.vlrapagitpag, coalesce(ip.codemppn,p1.codemppc), coalesce(ip.codfilialpn,p1.codfilialpc),
            coalesce(ip.codplan,p1.codplanpc), coalesce(ip.obsitpag,'')
            from fnitpagar ip, fnpagar pg, sgprefere1 p1
            where ip.codemp=new.codemp and ip.codfilial=new.codfilial and ip.codpag=new.codpag and ip.nparcpag=new.nparcpag
            and p1.codemp=new.codemp and p1.codfilial=new.codfilial
            and pg.codemp=ip.codemp and pg.codfilial=ip.codfilial and pg.codpag=ip.codpag
            into :vlrapagitpag, :codemppn, :codfilialpn, :codplan, :obsitpag;

            -- Calculando valor e status da baixa de acordo com o valor do cheque.
            if(:vlrcheq >= :vlrapagitpag) then
            begin
                vlrbaixa = :vlrapagitpag;
                statusitpagar = 'PP';

            end
            else
            begin
                vlrbaixa = :vlrcheq;
                statusitpagar = 'PL';
            end


            if(:obsitpag='') then
            begin
                obsitpag = 'PGTO C/CHEQUE NRO:' || :numcheq;
            end
            else
            begin
                obsitpag = rtrim(obsitpag) || ' / ' || 'PGTO C/CHEQUE NRO:' || :numcheq;
            end

            -- Realizando a baixa
            update fnitpagar ip set
            ip.numconta=:contabaixa, ip.codempca=:codempcb, ip.codfilialca=:codfilialcb,
            ip.codplan=:codplan, ip.codemppn=:codemppn, ip.codfilialpn=:codfilialpn,
            ip.dtpagoitpag=:dtvenctocheq, ip.vlrpagoitpag=:vlrbaixa,
            ip.statusitpag=:statusitpagar, obsitpag=:obsitpag
            where ip.codpag=new.codpag and ip.nparcpag=new.nparcpag and ip.codemp=new.codemp and ip.codfilial=new.codfilial;
        end
   end

    -- Transferencia de baixa na compensação do cheque
    if(coalesce(old.transfere,'N')='N' and new.transfere='S') then
    begin
        icont = 0;
        for
            select
            la.codemp, la.codfilial, la.codemppn, la.codfilialpn, la.codplan, la.vlrlanca, pg.dtcompitpag, coalesce(p.docpag,'') || '/' || coalesce(pg.nparcpag,'')
            from fnlanca la, fnitpagar pg, fnpagcheq pc, fnpagar p
            where pc.codemp=pg.codemp and pc.codfilial=pg.codfilial and pc.codpag=pg.codpag and pc.nparcpag=pg.nparcpag and
            la.codemppg=pg.codemp and la.codfilialpg=pg.codfilial and la.codpag=pg.codpag and la.nparcpag=pg.nparcpag
            and pc.codemp=new.codemp and pc.codfilial=new.codfilial and pc.codpag=new.codpag and pc.nparcpag=new.nparcpag
            and p.codemp=pg.codemp and p.codfilial=pg.codfilial and p.codpag=pg.codpag
            into :codempla, :codfilialla, :codemppnorig, :codfilialpnorig, :codplanorig, :vlrlanca, :dtcompitpag, :sdoccompra


        do
        begin

             icont = :icont + 1;

            -- Buscando código do novo lançamento
            select iseq from spgeranum(:codempla, :codfilialla, 'LA' ) into :codlancatransf;

            -- Buscando conta planejamento da compensação.
            select ct.codemppn, ct.codfilialpn, ct.codplan
            from fncontavinculada cv, fnconta ct, fnconta ctv
            where ct.codemp=cv.codemp and ct.codfilial=cv.codfilial and ct.numconta=cv.numconta
            and ctv.codemppn=:codemppnorig and ctv.codfilialpn=:codfilialpnorig and ctv.codplan=:codplanorig
            and cv.codempcv=ctv.codemp and cv.codfilialcv=ctv.codfilial and cv.numcontacv=ctv.numconta and cv.contacheque='S'
            into :codemppntransf, :codfilialpntransf, codplantransf;

            -- Montando histórico...
            snumcheque = rtrim(coalesce(cast(:numcheq as char(15)),'0'));
            histblanca = 'CH CP [' || :snumcheque || '] NF ' || :sdoccompra || ' ' || coalesce(:nomefavcheq,'');

            -- Inserir lançamento na primeira passada....

            if(:icont=1) then
            begin

                -- Inserindo lançamento de transferência...
                insert into fnlanca (
                    tipolanca, codemp, codfilial, codlanca,
                    codemppn, codfilialpn, codplan, dtcomplanca,
                    datalanca, doclanca, histblanca, transflanca, vlrlanca )
                values (
                      'A', :codempla, :codfilialla, :codlancatransf,
                  :codemppntransf, :codfilialpntransf, :codplantransf, :dtcompitpag, 
                  :dtcompcheq, :snumcheque, :histblanca, 'S', 0);

            end

            -- Inserindo sub-lançamento de transferência...

            insert into fnsublanca (
                codemp, codfilial, codlanca, codsublanca,
                codemppn, codfilialpn, codplan, dtcompsublanca,
                datasublanca, vlrsublanca, histsublanca)
            values (
                :codempla, :codfilialla, :codlancatransf, :icont,
                :codemppnorig, :codfilialpnorig, :codplanorig, :dtcompitpag,
                :dtcompcheq, :vlrlanca * -1 , :histblanca );

        end

    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNPAGTOCOMITGAI
AS
  DECLARE VARIABLE iCodLanca INTEGER;
  DECLARE VARIABLE sCodPlanConta CHAR(13);
  DECLARE VARIABLE iPlanEmp INTEGER;
  DECLARE VARIABLE iPlanFilial INTEGER;
  DECLARE VARIABLE IFILIALLANCA INTEGER;
  DECLARE VARIABLE sObsPComi varchar(100);
BEGIN
  IF (new.OBSPCOMI is null) THEN
  BEGIN
     sObsPComi = '';
  END
  ELSE
  BEGIN
     sObsPComi = SUBSTRING(new.OBSPCOMI from 1 for 100);
  END

  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNLANCA') INTO IFILIALLANCA;
  SELECT CODPLAN,CODEMP,CODFILIAL FROM FNCONTA WHERE NUMCONTA=new.NUMCONTA
         AND CODEMP=new.CODEMPCA AND CODFILIAL = new.CODFILIALCA INTO :sCodPlanConta,:iPlanEmp,:iPlanFilial;
  SELECT ISEQ FROM SPGERANUM(new.CODEMP,new.CODFILIAL,'LA') INTO :iCodLanca;
  INSERT INTO FNLANCA (CODEMP,CODFILIAL,CODLANCA,CODEMPCI,CODFILIALCI,CODPCOMI,CODEMPPN,CODFILIALPN,CODPLAN,DTCOMPLANCA,DATALANCA,DOCLANCA,
                     HISTBLANCA,DTPREVLANCA,VLRLANCA,FLAG)
            VALUES (new.CODEMP,new.CODFILIAL,:iCodLanca,new.CODEMP,new.CODFILIAL,new.CODPCOMI,:iPlanEmp,:iPlanFilial,:sCodPlanConta, new.DTCOMPPCOMI, new.DATAPCOMI,
                   new.DOCPCOMI,:sObsPComi,new.DATAPCOMI,0,new.FLAG);
  INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPPN,CODFILIALPN,CODPLAN,ORIGSUBLANCA,DTCOMPSUBLANCA,DATASUBLANCA,DTPREVSUBLANCA,VLRSUBLANCA,FLAG)
            VALUES (new.CODEMP,new.CODFILIAL,:iCodLanca,1,new.CODEMPPN,new.CODFILIALPN,new.CODPLAN,'S',new.DTCOMPPCOMI, new.DATAPCOMI,new.DATAPCOMI,new.VLRPCOMI,new.FLAG);
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNPAGTOCOMITGBU
as
begin
  if (new.EMMANUT IS NULL) then
    new.EMMANUT='N';
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNPLANEJAMENTOTGBI
AS
declare variable codredplan Integer;
begin

    -- Se é de nível analítico deve gerar código reduzido
    if (new.nivelplan=6 and new.codredplan is null) then
    begin

        select coalesce(max(codredplan),0) from fnplanejamento where codemp=new.codemp and codfilial = new.codfilial
        into :codredplan;

        new.codredplan = codredplan + 1;

     end
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNPLANEJAMENTOTGBU
as
declare variable codredplan integer;
begin
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);

     -- Se é de nível analítico deve gerar código reduzido
    if (new.nivelplan=6 and new.codredplan is null) then
    begin

        select coalesce(max(codredplan),0) from fnplanejamento where codemp=new.codemp and codfilial = new.codfilial
        into :codredplan;

        new.codredplan = codredplan + 1;

     end

     -- Valida se o número criado já não existe...
     if (old.codredplan is null or new.codredplan <> old.codredplan) then
     begin
        select first 1  codredplan from fnplanejamento where codemp=new.codemp and codfilial=new.codfilial and codredplan=new.codredplan
        into :codredplan;

        if(:codredplan is not null) then
        begin

            exception fnplanejamento01;

        end


     end

end
^

/* Alter exist trigger... */
ALTER TRIGGER FNRECEBERTGAI
AS
  DECLARE VARIABLE NPARCREC INTEGER;
  DECLARE VARIABLE CODFILIALPP SMALLINT;
  DECLARE VARIABLE CODFILIALPN SMALLINT;
  DECLARE VARIABLE CODPLAN CHAR(13);
  DECLARE VARIABLE CODCC CHAR(19);
  DECLARE VARIABLE ANOCC SMALLINT;
  DECLARE VARIABLE CODFILIALCC SMALLINT;
  DECLARE VARIABLE CODFILIALIR SMALLINT;
  DECLARE VARIABLE CODFILIALCL SMALLINT;
  DECLARE VARIABLE ATIVOCLI CHAR(1);
  DECLARE VARIABLE NUMRESTR INTEGER;
  DECLARE VARIABLE CODFILIALCA SMALLINT;
  DECLARE VARIABLE CODEMPCA INTEGER;
  DECLARE VARIABLE NUMCONTA CHAR(10);
  declare variable docvenda integer;
  declare variable serievenda char(4);

BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'VDCLIENTE') INTO CODFILIALCL;
  SELECT C.ATIVOCLI  FROM VDCLIENTE C WHERE C.CODEMP=NEW.CODEMP AND
     C.CODFILIAL=:CODFILIALCL AND C.CODCLI=NEW.CODCLI INTO :ATIVOCLI;
  IF (ATIVOCLI<>'S') THEN
  BEGIN
     EXCEPTION FNRECEBEREX01;
  END
  SELECT COUNT(*) FROM FNRESTRICAO R, FNTIPORESTR TR
    WHERE R.CODEMP=NEW.CODEMP AND R.CODFILIAL=:CODFILIALCL AND
      R.CODCLI=NEW.CODCLI AND R.SITRESTR IN ('I') AND
      TR.CODEMP=R.CODEMPTR AND TR.CODFILIAL=R.CODFILIALTR AND
      TR.CODTPRESTR=R.CODTPRESTR AND TR.BLOQTPRESTR='S'
      INTO :NUMRESTR;
  IF ( (NUMRESTR IS NOT NULL) AND (NUMRESTR>0) ) THEN
  BEGIN
     IF (NUMRESTR=1) THEN
     BEGIN
        EXCEPTION FNRECEBEREX02 'Cliente possui '||RTRIM(CAST(NUMRESTR AS CHAR(10)))||' restrição!';
     END
     ELSE
     BEGIN
        EXCEPTION FNRECEBEREX02 'Cliente possui '||RTRIM(CAST(NUMRESTR AS CHAR(10)))||' restrições!';
     END
  END
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNPLANOPAG') INTO CODFILIALPP;
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNPLANEJAMENTO') INTO CODFILIALPN;
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNCENTROCUSTO') INTO CODFILIALCC;
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNITRECEBER') INTO CODFILIALIR;

  if(new.codvenda is not null and new.numconta is null) then
  begin
    select codempca,codfilialca,numconta, vd.docvenda, vd.serie from vdvenda vd
    where codemp=new.codempva and codfilial=new.codfilialva and codvenda=new.codvenda and tipovenda=new.tipovenda
    into :codempca, :codfilialca, :numconta, :docvenda, :serievenda;
  end
  else
  begin
    codempca = new.codempca;
    codfilialca = new.codfilialca;
    numconta = new.numconta;
  end


  SELECT I FROM fngeraitrecebersp01('S',new.CODEMP,
    new.CODFILIAL, new.CODREC, new.CODEMPPG, new.CODFILIALPG, new.CODPLANOPAG,
    new.VLRREC, new.DATAREC, new.DTCOMPREC, new.FLAG, new.CODEMPBO, new.CODFILIALBO,
    new.CODBANCO, new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
    new.CODEMPCB, new.CODFILIALCB, new.CODCARTCOB,
    new.VLRCOMIREC, new.OBSREC, :codempca, :codfilialca, :numconta,
    new.codemppn, new.codfilialpn, new.codplan, new.codempcc,  new.codfilialcc, new.anocc, new.codcc, new.vlrbasecomis
    ) INTO :NPARCREC;

/* Se a parcela do plano de pagamento tiver marcado para autobaixa, então é realizada a baixa automática. */
  FOR SELECT PP.NUMCONTA,PP.CODFILIALCA,PP.CODEMPCA, PP.CODPLAN,PP.CODFILIALPN,PP.CODCC,PP.ANOCC,PP.CODFILIALCC,PC.NROPARCPAG
      FROM FNPARCPAG PC, FNPLANOPAG PP
      WHERE
        PP.CODEMP=NEW.CODEMP AND PP.CODFILIAL=:CODFILIALPP AND PP.CODPLANOPAG=NEW.CODPLANOPAG AND
        PC.CODEMP=PP.CODEMP AND PC.CODFILIAL=PP.CODFILIAL AND PC.CODPLANOPAG=PP.CODPLANOPAG AND
        PC.AUTOBAIXAPARC='S'
      INTO NUMCONTA,CODFILIALCA,CODEMPCA, CODPLAN,CODFILIALPN,CODCC,ANOCC,CODFILIALCC,NPARCREC
  DO
  BEGIN
    UPDATE FNITRECEBER SET
      NUMCONTA=:NUMCONTA,
      CODEMPCA=:CODEMPCA,
      CODFILIALCA=:CODFILIALCA,
      NUMCONTA=:NUMCONTA,
      CODPLAN=:CODPLAN,
      CODEMPPN=NEW.CODEMP,
      CODFILIALPN=:CODFILIALPN,
      ANOCC=:ANOCC,
      CODCC=:CODCC,
      CODEMPCC=NEW.CODEMP,
      CODFILIALCC=:CODFILIALCC,
      DOCLANCAITREC= :docvenda || '/' || :nparcrec,
--      DOCLANCAITREC='AUTO',
      DTPAGOITREC=NEW.DATAREC,
      VLRPAGOITREC=VLRPARCITREC - coalesce(vlrdescitrec,0),
--      VLRDESCITREC=0,
      VLRJUROSITREC=0,
      OBSITREC='BAIXA AUTOMÁTICA' || ' REF. DOC: ' || :serievenda || '-' || :docvenda,
      STATUSITREC='RP'
      WHERE CODREC=NEW.CODREC AND CODEMP=NEW.CODEMP AND CODFILIAL=:CODFILIALIR AND
      NPARCITREC=:NPARCREC;
  END
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNRECEBERTGAU
as
    declare variable inparcold integer;
    declare variable inparcnew integer;
    declare variable caltvlr char(1);
    declare variable regrvcto char(1);
    declare variable rvsab char(1);
    declare variable rvdom char(1);
    declare variable rvfer char(1);
    declare variable rvdia char(1);
    declare variable diavcto smallint;
    declare variable diaspag smallint;
    declare variable dtvencto date;
    declare variable nroparcrec smallint;

    begin

        -- Se houver alterações relevantes...
        if ( (
                (old.codplanopag<>new.codplanopag) or
                (old.flag<>new.flag) or
                (old.vlrrec<>new.vlrrec) or
                (old.datarec<>new.datarec) or
                (coalesce(old.obsrec,'')<>coalesce(new.obsrec,''))
            )

            and (new.altusurec != 'S')

        ) then

        begin

            -- Se foi alterado o plano de pagamento            
            if (old.codplanopag <> new.codplanopag) then
            begin

                -- Buscando informações do plano de pagamento antigo
                select pp.parcplanopag from fnplanopag pp
                where codemp=old.codemppg and pp.codfilial=old.codfilialpg and pp.codplanopag=old.codplanopag
                into :inparcold;

                -- Buscando informações do novo plano de pagamento
                select pp.parcplanopag, pp.regrvctoplanopag, pp.rvsabplanopag, pp.rvdomplanopag,
                pp.rvferplanopag, pp.rvdiaplanopag, pp.diavctoplanopag
                from fnplanopag pp
                where pp.codemp=new.codemppg and pp.codfilial=new.codfilialpg and pp.codplanopag = new.codplanopag
                into :inparcnew, :regrvcto, :rvsab, :rvdom, :rvfer, :rvdia, :diavcto;

                -- Se o numero de parcelas entre os planos de pagamento são diferentes.
                if (inparcnew != inparcold) then
                begin
                    -- exclui os itens de contas a receber, para recria-los.
                    delete from fnitreceber where codrec=new.codrec and codemp=new.codemp and codfilial=new.codfilial;
                end
                -- Caso possua apenas uma parcela deve apenas atualizar a data do vencimento.
                else if (inparcnew=1) then
                begin
                    -- Buscando informação do item do plano de pagamento
                    select diaspag from fnparcpag
                    where codplanopag=new.codplanopag and codemp=new.codemppg and codfilial=new.codfilialpg
                    into :diaspag;

                    -- Calculando o vencimento da parcela.
                    select c.dtvencret from sgcalcvencsp( new.codemppg, new.datarec, new.datarec + :diaspag,
                    :regrvcto, :rvsab, :rvdom, :rvfer, :rvdia, :diavcto, :diaspag ) c
                    into :dtvencto;

                    -- Atualizando item do contas a receber
                    update fnitreceber set dtvencitrec=:dtvencto
                    where codemp=new.codemp and codfilial=new.codfilial and codrec=new.codrec and
                    statusitrec not in ('RP','RL');

                end
            end

            -- Se o valor foi alterado
            if (new.vlrrec!=old.vlrrec) then
                caltvlr = 'S';
            else
                caltvlr = 'N';

            select i from fngeraitrecebersp01(:caltvlr,  new.codemp, new.codfilial, new.codrec, new.codemppg,
            new.codfilialpg, new.codplanopag, new.vlrrec, new.datarec, new.dtcomprec, new.flag, new.codempbo, new.codfilialbo,
            new.codbanco, new.codemptc, new.codfilialtc, new.codtipocob, new.codempcb, new.codfilialcb, new.codcartcob,
            new.vlrcomirec, new.obsrec, null, null, null, new.codemppn, new.codfilialpn,new.codplan, new.codempcc,
            new.codfilialcc, new.anocc, new.codcc, new.vlrbasecomis)
            into :nroparcrec;

        end

        -- Atualiza os itens para eles atualizarem a comissao de forma distribuida.
        if (old.vlrcomirec != new.vlrcomirec) then
        begin
            execute procedure fnitrecebersp01(new.codemp, new.codfilial, new.codrec, new.vlrparcrec,
            new.vlrcomirec, new.nroparcrec, 'N');
        end
    end
^

/* Alter exist trigger... */
ALTER TRIGGER FNRECEBERTGBI
AS
BEGIN
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  IF (new.VLRREC IS NULL) THEN new.VLRREC = 0;
  IF (new.VLRDESCREC IS NULL) THEN new.VLRDESCREC = 0;
  IF (new.VLRJUROSREC IS NULL) THEN new.VLRJUROSREC = 0;
  IF (new.VLRMULTAREC IS NULL) THEN new.VLRMULTAREC = 0;
  IF (new.VLRPARCREC IS NULL) THEN new.VLRPARCREC = 0;
  IF (new.VLRAPAGREC IS NULL) THEN new.VLRAPAGREC = 0;
  IF (new.VLRPAGOREC IS NULL) THEN new.VLRPAGOREC = 0;
  IF (new.DTCOMPREC IS NULL) THEN new.DTCOMPREC = new.DATAREC;
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNRECEBERTGBU
as
begin
  IF (new.EMMANUT IS NULL) then
     new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      IF ( (new.DTCOMPREC IS NULL) or (new.DATAREC<>old.DATAREC) ) THEN
         new.DTCOMPREC = new.DATAREC;
  END
  /* Trigger Text */
end
^

/* Alter exist trigger... */
ALTER TRIGGER FNSUBLANCATGAU
AS
DECLARE VARIABLE dDataSl DATE;
DECLARE VARIABLE dSaldoSl NUMERIC(15, 5);
DECLARE VARIABLE sCodplan CHAR(13);
DECLARE VARIABLE dSaldoAnt NUMERIC(15, 5);
DECLARE VARIABLE IFILIALSALDO INTEGER;
declare variable codfilialpn smallint;
BEGIN

   IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
   BEGIN

      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNSALDOLANCA') INTO IFILIALSALDO;
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPLANEJAMENTO') INTO :codfilialpn;

      IF ( (old.DATASUBLANCA <> new.DATASUBLANCA) OR (old.VLRSUBLANCA<>new.VLRSUBLANCA) ) THEN
      BEGIN
   /*Verifica se já existe saldo no dia da nova data:*/
        SELECT CODPLAN,DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=new.CODPLAN
               AND DATASL=new.DATASUBLANCA AND CODEMP=new.CODEMPPN AND CODFILIAL=:IFILIALSALDO
               INTO :sCodplan,:dDataSl,:dSaldoSl;
   /*Se não existir, cria um saldo para o nova data:*/
        IF (sCodplan IS NULL ) THEN
        BEGIN
   /*Pega o ultimo saldo anterior a data do lançamento:*/
           SELECT SALDOSL FROM FNSALDOLANCA SL1 WHERE SL1.CODPLAN=new.CODPLAN and sl1.codemppn=new.codemp and sl1.codfilialpn=:codfilialpn
                  AND SL1.DATASL=(
                                 SELECT MAX(SL2.DATASL) FROM FNSALDOLANCA SL2 WHERE
                                        SL2.CODPLAN=SL1.CODPLAN AND SL2.DATASL<new.DATASUBLANCA
                                        AND SL2.CODEMP=new.CODEMPPN AND SL2.CODFILIAL=:IFILIALSALDO
                                 )
                  AND SL1.CODEMP=new.CODEMPPN AND SL1.CODFILIAL=:IFILIALSALDO INTO :dSaldoAnt;
       /*Cria um saldo para este dia e atualiza saldos possíveis que tiverem na frente:*/
           IF (:dSaldoAnt IS NULL) THEN
              dSaldoAnt = 0;
           INSERT INTO FNSALDOLANCA (CODEMP,CODFILIAL,CODPLAN,CODEMPPN,CODFILIALPN,DATASL,SALDOSL)
                  VALUES (new.CODEMP,:IFILIALSALDO,new.CODPLAN,new.CODEMPPN,new.CODFILIALPN,new.DATASUBLANCA,:dSaldoAnt + new.VLRSUBLANCA);
           UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL + new.VLRSUBLANCA
                  WHERE CODPLAN=new.CODPLAN AND DATASL>new.DATASUBLANCA
                  AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALSALDO;
        END
       /*Caso contrário só atualiza o saldo:*/
        ELSE
        BEGIN
           UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL + new.VLRSUBLANCA
                  WHERE CODPLAN=new.CODPLAN AND DATASL>=new.DATASUBLANCA
                  AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALSALDO;
        END
      END
   END
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNSUBLANCATGBI
AS
  DECLARE VARIABLE sEhTransf CHAR(1);
  DECLARE VARIABLE sTipoPlan CHAR(1);
  DECLARE VARIABLE dDataLanca DATE;
  DECLARE VARIABLE dDtPrevLanca DATE;
  DECLARE VARIABLE sHistSubLanc VARCHAR(250);
BEGIN
  /*IF ( new.VLRSUBLANCA = 0 ) THEN
     EXCEPTION FNSUBLANCAEX04;         */
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT = 'N';
  SELECT HISTBLANCA FROM FNLANCA WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL
  INTO sHistSubLanc;

  IF (new.HISTSUBLANCA IS NULL) THEN
      new.HISTSUBLANCA = sHistSubLanc;

  IF (new.CODSUBLANCA IS NULL) THEN
    SELECT MAX(CODSUBLANCA) FROM FNSUBLANCA
    WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL
    INTO new.CODSUBLANCA;

  new.STATUSSUBLANCA = 'S1';

  SELECT TRANSFLANCA,DATALANCA,DTPREVLANCA FROM FNLANCA
  WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL
  INTO sEhTransf,dDataLanca,dDtPrevLanca;

  SELECT TIPOPLAN FROM FNPLANEJAMENTO WHERE CODPLAN = new.CODPLAN AND CODEMP=new.CODEMPPN AND CODFILIAL = new.CODFILIALPN
  INTO sTipoPlan;

  new.DATASUBLANCA = dDataLanca;

  IF (new.DTCOMPSUBLANCA IS NULL) THEN
     new.DTCOMPSUBLANCA = new.DATASUBLANCA;

  IF (new.CODSUBLANCA > 0) THEN
  BEGIN
    new.ORIGSUBLANCA = 'N';
  END

  new.STATUSSUBLANCA = 'S1';
  new.DTPREVSUBLANCA = dDtPrevLanca;

  IF (sEhTransf = 'S') THEN
  BEGIN
   IF (new.CODSUBLANCA = 2) THEN
     EXCEPTION FNSUBLANCAEX01;
   ELSE IF (sTipoPlan IN ('D','R')) THEN
     EXCEPTION FNSUBLANCAEX02;
  END
  ELSE
    IF ((new.CODSUBLANCA != 0) AND (sTipoPlan IN ('C','B'))) THEN
      EXCEPTION FNSUBLANCAEX03;
  UPDATE FNLANCA SET STATUSLANCA = 'L2', VLRLANCA=(VLRLANCA-new.VLRSUBLANCA)
         WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END
^

/* Alter exist trigger... */
ALTER TRIGGER FNSUBLANCATGBU
AS
  DECLARE VARIABLE sEhTransf CHAR(1);
  DECLARE VARIABLE sTipoPlan CHAR(1);
  DECLARE VARIABLE IFILIALSALDO INTEGER;
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
     new.DTALT=cast('now' AS DATE);
     new.IDUSUALT=USER;
     new.HALT = cast('now' AS TIME);
     /*IF ( new.VLRSUBLANCA = 0 ) THEN
        EXCEPTION FNSUBLANCAEX04;   */
     SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNSALDOLANCA') INTO IFILIALSALDO;
     SELECT TIPOPLAN FROM FNPLANEJAMENTO WHERE CODPLAN = new.CODPLAN
            AND CODEMP=new.CODEMPPN AND CODFILIAL = new.CODFILIALPN INTO sTipoPlan;
     SELECT TRANSFLANCA FROM FNLANCA WHERE CODLANCA = new.CODLANCA
            AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO sEhTransf;
     IF (sEhTransf = 'S') THEN
     BEGIN
         IF (new.CODSUBLANCA = 2) THEN
        EXCEPTION FNSUBLANCAEX01;
      ELSE IF (sTipoPlan IN ('D','R')) THEN
        EXCEPTION FNSUBLANCAEX02;
     END
     ELSE
       IF ((new.CODSUBLANCA != 0) AND (sTipoPlan IN ('C','B'))) THEN
         EXCEPTION FNSUBLANCAEX03;
     IF ((new.CODSUBLANCA != 0) AND (old.VLRSUBLANCA <> new.VLRSUBLANCA)) THEN
       UPDATE FNLANCA SET VLRLANCA = ((VLRLANCA+old.VLRSUBLANCA)-new.VLRSUBLANCA)
              WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
     IF ( (old.DATASUBLANCA <> new.DATASUBLANCA) OR (old.VLRSUBLANCA<>new.VLRSUBLANCA) OR (old.CODPLAN<>new.CODPLAN) ) THEN
       UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL - old.VLRSUBLANCA
              WHERE CODPLAN=old.CODPLAN AND DATASL>=old.DATASUBLANCA
              AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALSALDO;
   END
END
^

/* Alter exist trigger... */
ALTER TRIGGER LFITCLFISCALTGAU
AS
begin
    -- Se esta for a regra geral, desabilita demais regras que estejam como geral.
    if(new.geralfisc='S') then
    begin
       update lfitclfiscal set geralfisc='N'
       where codemp=new.codemp and codfilial=new.codfilial and codfisc=new.codfisc and
             coditfisc!=new.coditfisc and geralfisc='S';

    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER LFITCOMPRATGAD
AS

    declare variable ovlrbasepis numeric(15, 5);
    declare variable ovlrbasecofins numeric(15, 5);
    declare variable ovlrpis numeric(15, 5);
    declare variable ovlrcofins numeric(15, 5);
    declare variable vlricmsdiferido numeric(15, 5);
    declare variable vlricmsdevido numeric(15, 5);
    declare variable vlricmscredpresum numeric(15, 5);

begin
    -- Inicialização de variáveis (old)
    if (old.vlrbasepis is null) then ovlrbasepis = 0; else ovlrbasepis = old.vlrbasepis;
    if (old.vlrbasecofins is null) then ovlrbasecofins = 0; else ovlrbasecofins = old.vlrbasepis;
    if (old.vlrpis is null) then ovlrpis = 0; else ovlrpis = old.vlrpis;
    if (old.vlrcofins is null) then ovlrcofins = 0; else ovlrcofins = old.vlrcofins;
    if (old.vlricmsdiferido is null) then vlricmsdiferido = 0; else vlricmsdiferido = old.vlricmsdiferido;
    if (old.vlricmsdevido is null) then vlricmsdevido = 0; else vlricmsdevido = old.vlricmsdevido;
    if (old.vlricmscredpresum is null) then vlricmscredpresum = 0; else vlricmscredpresum = old.vlricmscredpresum;

    update cpcompra cp set
        cp.vlrbasepiscompra = cp.vlrbasepiscompra - :ovlrbasepis,
        cp.vlrpiscompra = cp.vlrpiscompra - :ovlrpis,
        cp.vlrbasecofinscompra = cp.vlrbasecofinscompra - :ovlrbasecofins ,
        cp.vlrcofinscompra = cp.vlrcofinscompra - :ovlrcofins,
        cp.vlrbaseiicompra = cp.vlrbaseiicompra - old.vlrbaseii,
        cp.vlriicompra = cp.vlriicompra - old.vlrii,
        cp.vlricmsdiferido = cp.vlricmsdiferido - :vlricmsdiferido,
        cp.vlricmsdevido = cp.vlricmsdevido - :vlricmsdevido,
        cp.vlricmscredpresum = cp.vlricmscredpresum - :vlricmscredpresum
    where codcompra=old.codcompra and codemp=old.codemp and codfilial=old.codfilial;

end
^

/* Alter exist trigger... */
ALTER TRIGGER LFITCOMPRATGAI
as
    declare variable vlrbasepis numeric(15, 5);
    declare variable vlrbasecofins numeric(15, 5);
    declare variable vlrpis numeric(15, 5);
    declare variable vlrcofins numeric(15, 5);
    declare variable vlrbaseii numeric(15, 5);
    declare variable vlrii numeric(15, 5);
    declare variable vlricmsdiferido numeric(15, 5);
    declare variable vlricmsdevido numeric(15, 5);
    declare variable vlricmscredpresum numeric(15, 5);

    begin

    -- Inicialização de variáveis
    if (new.vlrbasepis is null) then vlrbasepis = 0; else vlrbasepis = new.vlrbasepis;
    if (new.vlrbasecofins is null) then vlrbasecofins = 0; else vlrbasecofins = new.vlrbasepis;
    if (new.vlrpis is null) then vlrpis = 0; else vlrpis = new.vlrpis;
    if (new.vlrcofins is null) then vlrcofins = 0; else vlrcofins = new.vlrcofins;
    if (new.vlrbaseii is null) then vlrbaseii = 0; else vlrbaseii = new.vlrbaseii;
    if (new.vlrii is null) then vlrii = 0; else vlrii = new.vlrii;
    if (new.vlricmsdiferido is null) then vlricmsdiferido = 0; else vlricmsdiferido = new.vlricmsdiferido;
    if (new.vlricmsdevido is null) then vlricmsdevido = 0; else vlricmsdevido = new.vlricmsdevido;
    if (new.vlricmscredpresum is null) then vlricmscredpresum = 0; else vlricmscredpresum = new.vlricmscredpresum;

    -- Atualizando campos de totais na tabela de compra;
    update cpcompra cp set
        cp.vlrbasepiscompra = cp.vlrbasepiscompra + :vlrbasepis ,
        cp.vlrpiscompra =  cp.vlrpiscompra + :vlrpis ,
        cp.vlrbasecofinscompra = cp.vlrbasecofinscompra + :vlrbasecofins ,
        cp.vlrcofinscompra =  cp.vlrcofinscompra + :vlrcofins,
        cp.vlrbaseiicompra = cp.vlrbaseiicompra + :vlrbaseii,
        cp.vlriicompra = cp.vlriicompra + :vlrii,
        cp.vlricmsdiferido = cp.vlricmsdiferido + :vlricmsdiferido,
        cp.vlricmsdevido = cp.vlricmsdevido + :vlricmsdevido,
        cp.vlricmscredpresum = cp.vlricmscredpresum + :vlricmscredpresum

    where codcompra=new.codcompra and codemp=new.codemp and codfilial=new.codfilial;

end
^

/* Alter exist trigger... */
ALTER TRIGGER LFITCOMPRATGAU
as
    declare variable cstatus char (2);
    declare variable nvlrbasepis numeric(15, 5);
    declare variable nvlrbasecofins numeric(15, 5);
    declare variable nvlrpis numeric(15, 5);
    declare variable nvlrcofins numeric(15, 5);

    declare variable ovlrbasepis numeric(15, 5);
    declare variable ovlrbasecofins numeric(15, 5);
    declare variable ovlrpis numeric(15, 5);
    declare variable ovlrcofins numeric(15, 5);

    declare variable ovlrbaseii numeric(15, 5);
    declare variable ovlrii numeric(15, 5);

    declare variable vlricmsdiferido numeric(15, 5);
    declare variable vlricmsdevido numeric(15, 5);
    declare variable vlricmscredpresum numeric(15, 5);

begin
    -- Inicialização de variáveis (new)
    if (new.vlrbasepis is null) then nvlrbasepis = 0; else nvlrbasepis = new.vlrbasepis;
    if (new.vlrbasecofins is null) then nvlrbasecofins = 0; else nvlrbasecofins = new.vlrbasepis;
    if (new.vlrpis is null) then nvlrpis = 0; else nvlrpis = new.vlrpis;
    if (new.vlrcofins is null) then nvlrcofins = 0; else nvlrcofins = new.vlrcofins;

    -- Inicialização de variáveis (old)
    if (old.vlrbasepis is null) then ovlrbasepis = 0; else ovlrbasepis = old.vlrbasepis;
    if (old.vlrbasecofins is null) then ovlrbasecofins = 0; else ovlrbasecofins = old.vlrbasepis;
    if (old.vlrpis is null) then ovlrpis = 0; else ovlrpis = old.vlrpis;
    if (old.vlrcofins is null) then ovlrcofins = 0; else ovlrcofins = old.vlrcofins;
    if (old.vlrbaseii is null) then ovlrbaseii = 0; else ovlrbaseii = old.vlrbaseii;
    if (old.vlrii is null) then ovlrii = 0; else ovlrii = old.vlrii;

    if (old.vlricmsdiferido is null) then vlricmsdiferido = 0; else vlricmsdiferido = old.vlricmsdiferido;
    if (old.vlricmsdevido is null) then vlricmsdevido = 0; else vlricmsdevido = old.vlricmsdevido;
    if (old.vlricmscredpresum is null) then vlricmscredpresum = 0; else vlricmscredpresum = old.vlricmscredpresum;


    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) ) ) ) then
    begin
        select cp.statuscompra from cpcompra cp
        where cp.codcompra = new.codcompra and cp.codemp=new.codemp and cp.codfilial = new.codfilial
        into :cstatus;

        if (substr(:cstatus,1,1)!='X') then
        begin
            update cpcompra cp set
            cp.vlrbasepiscompra = cp.vlrbasepiscompra - :ovlrbasepis + :nvlrbasepis,
            cp.vlrpiscompra = vlrpiscompra - :ovlrpis + :nvlrpis,
            cp.vlrbasecofinscompra = vlrbasecofinscompra - :ovlrbasecofins + :nvlrbasecofins,
            cp.vlrcofinscompra= vlrcofinscompra - :ovlrcofins + :nvlrcofins,
            cp.vlrbaseiicompra= vlrbaseiicompra - :ovlrbaseii + new.vlrbaseii,
            cp.vlriicompra= vlriicompra - :ovlrii + new.vlrii,
            cp.vlricmsdiferido= vlricmsdiferido - :vlricmsdiferido + new.vlricmsdiferido,
            cp.vlricmsdevido= vlricmsdevido - :vlricmsdevido + new.vlricmsdevido,
            cp.vlricmscredpresum = vlricmscredpresum - :vlricmscredpresum + new.vlricmscredpresum
            where codcompra=new.codcompra and codemp=new.codemp and codfilial=new.codfilial;
        end
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPESTRUTURATGBI
as
begin

    -- Acertando referência quando nula
    if (new.refprod is null) then
    begin
        -- Buscando referência do produto
        select p.refprod from eqproduto p
        where p.codemp=new.codemp and p.codfilial = new.codfilial and p.codprod=new.codprod
        into new.refprod;
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPESTRUTURATGBU
as
declare variable iFinaliza smallint;
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);

  if (new.REFPROD IS NULL) then
  SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
  IF(NEW.ativoest='S' AND NEW.ativoest!=OLD.ativoest) THEN
  BEGIN
    select count(1) from ppestrufase ef
        where ef.codemp=new.codemp and ef.codfilial=new.codfilial and
        ef.codprod=new.codprod and ef.seqest=new.seqest and ef.finalizaop='S'
        into :iFinaliza;
    if ((:iFinaliza is null) or (:iFinaliza<1) ) then
    begin
      exception ppestruturaex01;
    end
  END

end
^

/* Alter exist trigger... */
ALTER TRIGGER PPITESTRUTURATGBI
as
begin
  new.DTINS=cast('now' AS DATE);
  new.idusuins=USER;
  new.hins = cast('now' AS TIME);
  if (new.REFPROD IS NULL) then
    SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPITESTRUTURATGBU
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.REFPROD IS NULL) then
    SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPITOPTGAU
as
declare variable codemprma integer;
declare variable codfilialrma smallint;
declare variable codrma integer;
declare variable coditrma smallint;
declare variable sititrma char(2);
declare variable qtditrma numeric(15,5);
declare variable qtdaprovitrma numeric(15,5);
declare variable qtdexpitrma numeric(15,5);

begin
    if(new.qtdcopiaitop is not null) then
    begin
        if( (new.qtdcopiaitop>0) and (old.qtdcopiaitop is null) ) then
        begin
            insert into ppitop (codemp,codfilial,codop,seqop,seqitop,
                                codemppd, codfilialpd,codprod,refprod,
                                qtditop, codempfs,codfilialfs, codfase,
                                codemple,codfilialle,codlote,gerarma,SEQITOPCP)
                                values
                                (new.codemp,new.codfilial,new.codop,new.seqop,
                                (select (max(op.seqitop)+1) from ppitop op
                                where op.codemp=new.codemp and op.codfilial=new.codfilial
                                and op.codop=new.codop and op.seqop=new.seqop),
                                new.codemppd,new.codfilialpd,new.codprod,new.refprod,
                                new.qtdcopiaitop,new.codempfs,new.codfilialfs,new.codfase,
                                new.codemple, new.codfilialle,new.codloterat,new.gerarma,new.seqitop);
        end
    end
    -- Atualizando as requisições de material, caso as quantidades na OP sejam alteradas
    if(old.qtditop <> new.qtditop) then
    begin
        -- Buscando RMA Gerada para o produto de entrada
        select first 1 ir.codemp, ir.codfilial, ir.codrma, ir.coditrma, ir.sititrma,
        ir.qtditrma, ir.qtdaprovitrma, ir.qtdexpitrma
        from eqrma rm, eqitrma ir
        where rm.codemp=ir.codemp and rm.codfilial=ir.codfilial and rm.codrma=ir.codrma
        and ir.codemppd=new.codemppd and ir.codfilialpd=new.codfilialpd and ir.codprod=new.codprod
        and rm.codop=new.codop and rm.seqop=new.seqop
        into codemprma, codfilialrma, codrma, coditrma, sititrma, qtditrma, qtdaprovitrma, qtdexpitrma ;

        -- Atualizando item de rma
        if(sititrma='PE') then
        begin
            update eqitrma ir set ir.qtditrma=new.qtditop
            where ir.codemp=:codemprma and ir.codfilial=:codfilialrma and ir.codrma=:codrma
            and ir.coditrma=:coditrma;
        end
        else if (sititrma = 'AF' and :qtditrma=:qtdaprovitrma) then
        begin
            update eqitrma ir set ir.qtditrma=new.qtditop,ir.qtdaprovitrma=new.qtditop
            where ir.codemp=:codemprma and ir.codfilial=:codfilialrma and ir.codrma=:codrma
            and ir.coditrma=:coditrma;
        end
        else if(sititrma = 'EF' and :qtditrma=:qtdexpitrma) then
        begin
            update eqitrma ir set ir.qtditrma=new.qtditop,ir.qtdaprovitrma=new.qtditop,ir.qtdexpitrma=new.qtditop
            where ir.codemp=:codemprma and ir.codfilial=:codfilialrma and ir.codrma=:codrma
            and ir.coditrma=:coditrma;
        end
    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPITOPTGBI
AS
begin
   SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD AND
    CODFILIAL=new.CODFILIALPD AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPITOPTGBU
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD AND
    CODFILIAL=new.CODFILIALPD AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPENTRADATGAD
AS
declare variable preco decimal;
declare variable codemppd integer;
declare variable codfilialpd smallint;
declare variable codprod integer;
declare variable codemple integer;
declare variable codfilialle smallint;
declare variable codlote varchar(20);
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable codempopm integer;
declare variable codfilialopm smallint;
declare variable codopm integer;
declare variable seqopm smallint;
declare variable qtddistiop decimal(15,5);

begin

    -- Buscando custo do produto acabado
    select sum(pd.custompmprod) from ppitop it, eqproduto pd where it.codemp=old.codemp and it.codfilial=it.codfilial and
    it.codop=old.codop and it.seqop=old.seqop and
    pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and pd.codprod=it.codprod into :preco;

    -- Buscando informações da OP
    select codemppd, codfilialpd, codprod, codemple, codfilialle, codlote, codemptm, codfilialtm, codtipomov, codempax, codfilialax, codalmox,
    codempopm, codfilialopm, codopm, seqopm, qtddistiop
    from ppop where
    codemp=old.codemp and codfilial=old.codfilial and codop=old.codop and seqop=old.seqop
    into
    :codemppd, :codfilialpd, :codprod, :codemple, :codfilialle, :codlote, :codemptm, :codfilialtm, :codtipomov, :codempax, :codfilialax, :codalmox,
    :codempopm, codfilialopm, :codopm, :seqopm, :qtddistiop;

    execute procedure eqmovprodiudsp('D', :codemppd, :codfilialpd, :codprod,
        :codemple, :codfilialle, :codlote, :codemptm,
        :codfilialtm, :codtipomov, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, null, null, null, null, old.codemp, old.codfilial, old.codop, old.seqop, old.seqent,
        null, null, null,
        old.dtent, old.codop, 'N', old.qtdent,:preco,
        :codempax, :codfilialax, :codalmox, null );

   if (:codopm is not null) then
   begin
      execute procedure ppatudistopsp( :codempopm, :codfilialopm, :codopm, :seqopm, :qtddistiop, 0);
   end
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPENTRADATGAI
as
declare variable preco numeric;
declare variable qtdest numeric;
declare variable codemppd integer;
declare variable codfilialpd smallint;
declare variable codprod integer;
declare variable codemple integer;
declare variable codfilialle smallint;
declare variable codlote varchar(20);
declare variable codemptm integer;
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable codempopm integer;
declare variable codfilialopm smallint;
declare variable codopm integer;
declare variable seqopm smallint;
declare variable qtddistiop decimal(15,5);
declare variable seqest integer;
declare variable prodetapas char(1);

begin

    -- Buscando preferências de produção

    select coalesce(p5.prodetapas,'N') from sgprefere5 p5 where p5.codemp=new.codemp and p5.codfilial=new.codfilial
    into :prodetapas;

    -- Buscando informações da OP
    select codemppd, codfilialpd, codprod, codemple, codfilialle, codlote, codemptm, codfilialtm, codtipomov, codempax, codfilialax, codalmox,
    codempopm, codfilialopm, codopm, seqopm, qtddistiop, seqest
    from ppop where codemp=new.codemp and codfilial=new.codfilial and codop=new.codop and seqop=new.seqop
    into
    :codemppd, :codfilialpd, :codprod, :codemple, :codfilialle, :codlote, :codemptm, :codfilialtm, :codtipomov, :codempax, :codfilialax, :codalmox,
    :codempopm, codfilialopm, :codopm, :seqopm, :qtddistiop, :seqest;

    select pe.qtdest from ppestrutura pe
    where pe.codemp=:codemppd and pe.codfilial=:codfilialpd and
    pe.codprod=:codprod and pe.seqest=:seqest into :qtdest;

    if (:codopm is not null) then
    begin
        execute procedure ppatudistopsp( :codempopm, :codfilialopm, :codopm, :seqopm, :qtddistiop, 0);
    end

    -- Se o processo de finalização for em etapas deve gerar movimentação de estoque vinculada ao item de entrada da O.P.
    if( :prodetapas = 'S' ) then
    begin

        -- Buscando custo do produto acabado
        select sum((select ncustompm from eqprodutosp01(it.codemppd,it.codfilialpd,it.codprod,null,null,null)) * it.qtditop ) / op.qtdprevprodop
        from ppitop it, eqproduto pd, ppop op
        where it.codemp=new.codemp and it.codfilial=it.codfilial
        and it.codop=new.codop and it.seqop=new.seqop
        and pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd
        and pd.codprod=it.codprod
        and op.codemp=new.codemp and op.codfilial=new.codfilial and op.codop=new.codop and op.seqop=new.seqop
        group by op.qtdprevprodop
        into :preco;

        execute procedure EQMOVPRODIUDSP('I', :CODEMPPD, :CODFILIALPD, :CODPROD,
        :CODEMPLE, :CODFILIALLE, :codlote, :codemptm,
        :codfilialtm, :codtipomov, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, null, null, null, null,new.codemp, new.codfilial,new.codop, new.seqop, new.seqent,
        null, null,  null, new.dtent, new.codop,
        'S',new.qtdent,cast(:preco as numeric(15,5)),
        :codempax, :codfilialax, :codalmox, null );

        -- Atualizando quantidade final produzida na O.P.
        update ppop op set
        op.qtdfinalprodop=( select sum(et.qtdent) from ppopentrada et
                            where et.codemp=new.codemp and et.codfilial=new.codfilial and et.codop=new.codop and et.seqop=new.seqop
                           )
        where op.codemp=new.codemp and op.codfilial=new.codfilial and op.codop=new.codop and op.seqop=new.seqop;

    end

    if (:CODOPM is not null) then EXECUTE PROCEDURE PPATUDISTOPSP(:CODEMPOPM, :CODFILIALOPM, :CODOPM, :SEQOPM, 0, :QTDDISTIOP);

end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPFASETGAI
AS
declare variable ctipofase char(2);
declare variable imesesdesccp smallint;
declare variable ddtdescarte date;
declare variable ddtvalidop date;
declare variable icodempest integer;
declare variable icodfilialest smallint;
declare variable icodprodest integer;
declare variable iseqest smallint;
declare variable icodemppd integer;
declare variable icodfilialpd smallint;
declare variable icodprodpd integer;
declare variable icoditretcp smallint;
declare variable iqtd decimal(15,5);
declare variable numretcp integer;

begin
  select tipofase from ppfase where codemp=new.codempfs and codfilial=new.codfilialfs and codfase=new.codfase
      into :ctipofase;

  if(ctipofase='CQ') then
  begin

    select max(sg.mesesdesccp) from sgprefere5 sg where codemp=new.codemp and codfilial=new.codfilial
      into :imesesdesccp;

    select op.codemppd, op.codfilialpd, op.codprod, op.seqest, op.dtvalidpdop
        from ppop op
            where op.codemp = new.codemp and op.codfilial=new.codfilial and op.codop=new.codop
                and op.seqop=new.seqop
        into :icodempest,:icodfilialest,:icodprodest,:iseqest,:ddtvalidop;

    ddtdescarte = cast(addmonth(:ddtvalidop,:imesesdesccp) as date);

   -- Buscando o numero de contra provas (Deve haver apenas 1)
   select count(*) from ppretcp rc where rc.codemp=new.codemp and rc.codfilial=new.codfilial and rc.codop=new.codop and rc.seqop=new.seqop
   into :numretcp;
   
   if(:numretcp is null or :numretcp <1) then
   begin
       insert into ppretcp (codemp,codfilial,codop,seqop,dtdescarte)
       values(new.codemp,new.codfilial, new.codop,new.seqop,:ddtdescarte);


       for select it.codemppd,it.codfilialpd,it.codprodpd,it.seqitest,it.qtditest from ppitestrutura it
           where it.codemp = :icodempest and it.codfilial=:icodfilialest and it.codprod=:icodprodest
               and it.seqest = :iseqest and it.codempfs=new.codempfs and it.codfilialfs=new.codfilialfs
               and it.codfase = new.codfase
       into :icodemppd,:icodfilialpd,:icodprodpd,:icoditretcp,:iqtd do
       begin
           insert into ppitretcp (codemp,codfilial,codop,seqop,coditretcp,codemppd,codfilialpd,codprod,qtditret)
           values(new.codemp,new.codfilial,new.codop,new.seqop, :icoditretcp,:icodemppd,:icodfilialpd,:icodprodpd,:iqtd);
       end

    end
  end

  end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPTGAD
AS
declare variable preco decimal;
begin
  select sum(pd.custompmprod) from ppitop it, eqproduto pd where it.codemp=old.codemp and it.codfilial=it.codfilial and
    it.codop=old.codop and it.seqop=old.seqop and
    pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and pd.codprod=it.codprod into :preco;

   EXECUTE PROCEDURE EQMOVPRODIUDSP('D',old.CODEMPPD, old.CODFILIALPD, old.CODPROD,
        old.CODEMPLE, old.CODFILIALLE, old.codlote, old.codemptm,
        old.codfilialtm, old.codtipomov, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, null, null, null, null, old.codemp, old.codfilial, old.codop, old.seqop, null,
        null, null, null,
        old.dtfabrop, old.codop, 'N', old.qtdfinalprodop,:preco,
        old.codempax, old.codfilialax, old.codalmox, null );

   if (old.CODOPM is not null) then
      EXECUTE PROCEDURE PPATUDISTOPSP(old.CODEMPOPM, old.CODFILIALOPM, old.CODOPM,
        old.SEQOPM, old.QTDDISTIOP, 0);

end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPTGAI
as
declare variable preco numeric;
declare variable qtdest numeric;
declare variable prodetapas char(1);
begin

   EXECUTE PROCEDURE PPITOPSP01(new.CODEMP, new.CODFILIAL, new.CODOP, new.SEQOP);

   EXECUTE PROCEDURE ppgeraopcq (new.CODEMP, new.CODFILIAL, new.CODOP, new.SEQOP);

   select sum(pd.custompmprod) from ppitop it, eqproduto pd where it.codemp=new.codemp and
   it.codfilial=it.codfilial and it.codop=new.codop and it.seqop=new.seqop and
   pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and
   pd.codprod=it.codprod into :preco;

   select pe.qtdest from ppestrutura pe
      where pe.codemp=new.codemppd and pe.codfilial=new.codfilialpd and
      pe.codprod=new.codprod and pe.seqest=new.seqest into :qtdest;

   -- Buscando preferências de produção

   select coalesce(p5.prodetapas,'N') from sgprefere5 p5 where p5.codemp=new.codemp and p5.codfilial=new.codfilial
   into :prodetapas;

   -- Se o processo de finalização não for em etapas deve gerar movimentação de estoque vinculada diretamente a O.P.
   if( :prodetapas = 'N' or :prodetapas is null ) then
   begin

       EXECUTE PROCEDURE EQMOVPRODIUDSP('I',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
            new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
            new.codfilialtm, new.codtipomov, null, null, null ,null, null,
            null, null, null, null, null, null,
            null, null, null, null, null,new.codemp, new.codfilial,new.codop, new.seqop, null,
            null, null,  null, new.dtfabrop, new.codop,
            'N',new.qtdfinalprodop,cast(:preco as numeric(15,5)),
            new.codempax, new.codfilialax, new.codalmox, null );

       if (new.CODOPM is not null) then
          EXECUTE PROCEDURE PPATUDISTOPSP(new.CODEMPOPM, new.CODFILIALOPM, new.CODOPM,
            new.SEQOPM, 0, new.QTDDISTIOP);

   end

end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPTGAU
as
declare variable preco decimal(15,5);
declare variable codempoc integer;
declare variable codfilialoc smallint;
declare variable tipoorc char(1);
declare variable codorc integer;
declare variable coditorc smallint;
declare variable prodetapas char(1);
declare variable qtdprodorc decimal(15,5);

begin

    -- Buscando preferências de produção

    select coalesce(p5.prodetapas,'N') from sgprefere5 p5 where p5.codemp=new.codemp and p5.codfilial=new.codfilial
    into :prodetapas;

    /*Cancelamento de O.P */
    
    if(old.sitop!='CA' and new.sitop = 'CA') then
    begin

        /* Cancelamento de movimentação de estoque */

        -- Se o processo de finalização não for em etapas deve gerar movimentação de estoque vinculada diretamente a O.P.
        if( :prodetapas = 'N' ) then
        begin
            execute procedure eqmovprodiudsp('D',new.codemppd, new.codfilialpd, new.codprod,
                new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
                new.codfilialtm, new.codtipomov, null, null, null ,null, null,
                null, null, null, null, null, null,null, null, null, null, null,
                new.codemp, new.codfilial,new.codop,new.seqop, null, null, null, null,
                new.dtfabrop, new.codop, null, new.qtdfinalprodop,:preco,
                new.codempax, new.codfilialax, new.codalmox, null );
        end
        else
        begin

            delete from ppopentrada et where et.codemp=new.codemp and et.codfilial=new.codfilial and et.codop=new.codop and et.seqop=new.seqop;

        end

        -- Desfazendo vinculos com ítem de orçamento
        delete from ppopitorc oi where oi.codemp=new.codemp and oi.codfilial=new.codfilial
        and oi.codop=new.codop and oi.seqop=new.seqop;

        -- Cancelando as RMAs vinculadas
        update eqrma rma set rma.sitrma='CA', rma.motivocancrma='Ordem de produção original cancelada!'
        where rma.codempof=new.codemp and rma.codfilialof=new.codfilial and rma.codop=new.codop and rma.seqop=new.seqop;

        -- Excluindo subproducao
        delete from ppopsubprod where codemp=new.codemp and codfilial=new.codfilial and codop=new.codop and seqop = new.seqop;

    end
    else if (old.sitop!='FN' and new.sitop='FN') then
    begin
        -- Atualizando status do ítem de orçamento na finalização da OP
        for select oi.codempoc,oi.codfilialoc, oi.tipoorc, oi.codorc, oi.coditorc
        from ppopitorc oi
        where oi.codemp=new.codemp and oi.codfilial=new.codfilial and oi.codop=new.codop and oi.seqop=new.seqop
        into :codempoc, :codfilialoc, :tipoorc, :codorc, :coditorc do
        begin
            update vditorcamento io set io.sitproditorc = 'PD'
            where io.codemp=:codempoc and io.codfilial=:codfilialoc and io.tipoorc=:tipoorc
            and io.codorc=:codorc and io.coditorc=:coditorc;
        end

        if( :prodetapas = 'N' ) then
        begin
            -- Buscando custo do produto acabado

            select cast(cast(sum( cast((select cast(ncustompm as decimal(15,5)) from eqprodutosp01(it.codemppd,it.codfilialpd,it.codprod,null,null,null)) as decimal(15,5)) * it.qtditop ) as decimal(15,5)) / new.qtdfinalprodop as decimal(15,5))
                from ppitop it, eqproduto pd
                where it.codemp=new.codemp and it.codfilial=it.codfilial
                and it.codop=new.codop and it.seqop=new.seqop
                and pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd
                and pd.codprod=it.codprod
            into :preco;

            execute procedure eqmovprodiudsp('U',new.codemppd, new.codfilialpd, new.codprod,
                new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
                new.codfilialtm, new.codtipomov, null, null, null ,null, null,
                null, null, null, null, null, null,null, null, null, null, null,
                new.codemp, new.codfilial,new.codop,new.seqop, null, null, null, null,
                new.dtfabrop, new.codop, 'N', new.qtdfinalprodop,:preco,
                new.codempax, new.codfilialax, new.codalmox, null );

            -- Buscando quantidade de produto acabado destinado a orçamentos;
            select cast(sum(oo.qtdprod) as decimal(15,5)) from ppopitorc oo
            where oo.codemp=new.codemp and oo.codfilial=new.codfilial and oo.codop=new.codop and oo.seqop=new.seqop
            into :qtdprodorc;

            -- Atualizando a quantidade final produzida por item de orçamento;

            if(:qtdprodorc is not null and :qtdprodorc > 0 ) then
            begin

                update ppopitorc oo set oo.qtdfinalproditorc = cast( ( cast(cast(oo.qtdprod as decimal(15,5)) /  cast(:qtdprodorc as decimal(15,5) ) as decimal(15,5)) * (cast(new.qtdfinalprodop as decimal(15,5)))) as decimal(15,5) )
                where oo.codemp=new.codemp and oo.codfilial=new.codfilial and oo.codop=new.codop and oo.seqop=new.seqop;

            end

        end
    end

    /* Outras ações */

    else
    begin
        if (old.qtdprevprodop <> new.qtdprevprodop ) then
        begin
            delete from ppitop
                where codemp=new.codemp AND codfilial=new.codfilial
                    and codop=new.codop and seqop=new.seqop;

            delete from PPOPFASE
                where codemp=new.codemp and codfilial=new.codfilial
                    and codop=new.codop and seqop=new.seqop;

            execute procedure ppitopsp01(new.codemp, new.codfilial, new.codop, new.seqop);
        end

        if( (old.qtdfinalprodop <> new.qtdfinalprodop) and (new.qtdfinalprodop>0) ) then
        begin

            if( :prodetapas = 'N' ) then
            begin

                -- Buscando custo do produto acabado
                select cast(sum((select ncustompm from eqprodutosp01(it.codemppd,it.codfilialpd,it.codprod,null,null,null)) * it.qtditop ) / new.qtdfinalprodop as decimal(15,5))

                from ppitop it, eqproduto pd
                where it.codemp=new.codemp and it.codfilial=it.codfilial
                and it.codop=new.codop and it.seqop=new.seqop
                and pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd
                and pd.codprod=it.codprod
                into :preco;

                execute procedure eqmovprodiudsp('U',new.codemppd, new.codfilialpd, new.codprod,
                new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
                new.codfilialtm, new.codtipomov, null, null, null ,null, null,
                null, null, null, null, null, null,null, null, null, null, null,
                new.codemp, new.codfilial,new.codop,new.seqop, null, null, null, null,
                new.dtfabrop, new.codop, 'N', new.qtdfinalprodop,:preco,
                new.codempax, new.codfilialax, new.codalmox, null );

            end

            execute procedure ppitopsp02(new.codemp, new.codfilial, new.codop, new.seqop);

        end
        if (new.CODOPM is not null) then
            execute procedure ppatudistopsp(new.codempopm, new.codfilialopm, new.codopm,
                new.seqopm, old.qtddistiop, new.qtddistiop);

    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPTGBI
as
begin
   SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP AND
    CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER PPOPTGBU
as
declare variable prodetapas char(1);
begin
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);
    SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP AND
    CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD INTO new.REFPROD;

    -- Buscando preferências de produção
    select coalesce(p5.prodetapas,'N') from sgprefere5 p5 where p5.codemp=new.codemp and p5.codfilial=new.codfilial
    into :prodetapas;

    if('S'=:prodetapas) then
    begin

        if( new.qtdfinalprodop>=new.qtdprevprodop ) then
        begin
            select coalesce(tm.codemptm,tm.codemp),coalesce(tm.codfilialtm,tm.codfilial),coalesce(tm.codtipomovtm,tm.codtipomov)
            from eqtipomov tm, ppop op
            where tm.codemp=op.codemptm and tm.codfilial=op.codfilialtm and tm.codtipomov=op.codtipomov
            and op.codemp=new.codemp and op.codfilial=new.codfilial and op.codop=new.codop
            and op.seqop=new.seqop
            into new.codemptm,new.codfilialtm,new.codtipomov;
            new.sitop='FN';
        end

    end
    else
    begin
        if(new.qtdfinalprodop>0 and new.qtdfinalprodop<>old.qtdfinalprodop) then
        begin
            select coalesce(tm.codemptm,tm.codemp),coalesce(tm.codfilialtm,tm.codfilial),coalesce(tm.codtipomovtm,tm.codtipomov)
            from eqtipomov tm, ppop op
            where tm.codemp=op.codemptm and tm.codfilial=op.codfilialtm and tm.codtipomov=op.codtipomov
            and op.codemp=new.codemp and op.codfilial=new.codfilial and op.codop=new.codop
            and op.seqop=new.seqop
            into new.codemptm,new.codfilialtm,new.codtipomov;
            new.sitop='FN';
        end
     end


     if(new.sitop='CA' and old.sitop<>'CA') then
        begin
            new.idusucanc=USER;
            new.dtcanc=cast('now' AS DATE);
            new.hcanc = cast('now' AS TIME);
        end

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDCOMISSAOTGBI
AS
begin
  new.DTINS = cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  new.VLRAPAGCOMI = new.VLRCOMI - new.VLRPAGOCOMI;
  if (new.DTCOMPCOMI IS NULL) then
     new.DTCOMPCOMI = new.DATACOMI;
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDCOMISSAOTGBU
AS
BEGIN
  if (new.EMMANUT IS NULL) then
     new.EMMANUT = 'N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
     new.DTALT=cast('now' AS DATE);
     new.IDUSUALT=USER;
     new.HALT = cast('now' AS TIME);
     IF ( ( new.DTCOMPCOMI IS NULL ) OR ( new.DATACOMI<>old.DATACOMI ) ) THEN
        new.DTCOMPCOMI = new.DATACOMI;
     IF ( OLD.STATUSCOMI = 'CP' AND NEW.STATUSCOMI = 'C1' ) then
       EXCEPTION VDCOMISSAOEX01;
     ELSE if ( OLD.STATUSCOMI='CP' AND NEW.STATUSCOMI='CP' AND OLD.VLRCOMI!=NEW.VLRCOMI ) then
       EXCEPTION VDCOMISSAOEX01;
     ELSE IF ( OLD.STATUSCOMI = 'C1' AND NEW.STATUSCOMI = 'CP' ) then
       EXCEPTION VDCOMISSAOEX02;
     ELSE IF ( OLD.STATUSCOMI = 'CP' AND NEW.STATUSCOMI = 'CD' ) THEN /* Estorno de comissões */
     BEGIN
        new.STATUSCOMI ='C2';
        new.CODEMPCI = null;
        new.CODFILIALCI = null;
        new.CODPCOMI = null;
        new.VLRPAGOCOMI = 0;
     END
     IF ( new.VLRCOMI IS NULL) THEN
       new.VLRCOMI = 0;
     IF ( new.VLRPAGOCOMI IS NULL ) THEN
       new.VLRPAGOCOMI = 0;
     new.VLRAPAGCOMI = new.VLRCOMI - new.VLRPAGOCOMI;
  END
END
^

/* Alter exist trigger... */
ALTER TRIGGER VDITKITTGBI
AS
begin
  /* Trigger text */
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITKITTGBU
AS
begin
  /* Trigger text */
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITORCAMENTOTGAU
as
    declare variable visualizalucr char(1);
    declare variable custopeps numeric(15, 5);
    declare variable custompm numeric(15, 5);
    declare variable custouc numeric(15, 5);
    declare variable vlricmsitorc numeric(15,5);
    declare variable vlripiitorc numeric(15,5);
    declare variable vlrpisitorc numeric(15,5);
    declare variable vlrcofinsitorc numeric(15,5);
    declare variable vlriritorc numeric(15,5);
    declare variable vlrcsocialitorc numeric(15,5);
    declare variable vlrissitorc numeric(15,5);
    declare variable qtdstatusitem integer;
    declare variable qtdstatustot integer;

begin
    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) ) ) ) then
    begin

    update vdorcamento set
        VLRDESCITORC = VLRDESCITORC - old.VLRDESCITORC + new.VLRDESCITORC,
        VLRPRODORC = VLRPRODORC - old.VLRPRODITORC + new.VLRPRODITORC,
        VLRLIQORC = VLRLIQORC - old.VLRLIQITORC + new.VLRLIQITORC
        where CODORC=new.CODORC and TIPOORC='O' and CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL;

    -- Carregamento de preferencias
    select visualizalucr from sgprefere1 where codemp=new.codemp and codfilial = new.codfilial
    into :visualizalucr;

    if( visualizalucr = 'S' ) then
       begin

            -- Busca do custo da ultima compra;
            select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                new.dtins,'U',new.codempax, new.codfilialax, new.codalmox,'N')
            into :custouc;

            -- Busca do custo médio (MPM)
            select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                new.dtins,'M',new.codempax, new.codfilialax, new.codalmox,'N')
            into :custompm;

            -- Busca do custo peps
            select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                new.dtins,'P',new.codempax, new.codfilialax, new.codalmox,'N')
            into :custopeps;

            -- Atualizando registro na tabela de custos de item de orçamento

            update vditcustoorc ico set vlrprecoultcp=:custouc, vlrcustompm=:custompm, vlrcustopeps=:custopeps
                where ico.codemp=new.codemp and ico.codfilial=new.codfilial and ico.codorc=new.codorc
                and ico.tipoorc=new.tipoorc and ico.coditorc=new.coditorc;

            -- Buscando e inserindo previsão de tributos
            select vlricms, vlripi, vlrpis, vlrcofins, vlrir, vlrcsocial, vlriss
            from lfbuscaprevtriborc(new.codemp, new.codfilial, new.codorc, new.tipoorc, new.coditorc)
            into :vlricmsitorc, :vlripiitorc, :vlrpisitorc, :vlrcofinsitorc, :vlriritorc, :vlrcsocialitorc, :vlrissitorc;

            update vdprevtribitorc po set
            po.vlricmsitorc=:vlricmsitorc, po.vlripiitorc=:vlripiitorc, po.vlrpisitorc=:vlrpisitorc,
            po.vlrcofinsitorc=:vlrcofinsitorc, po.vlriritorc=:vlriritorc, po.vlrcsocialitorc=:vlrcsocialitorc,
            po.vlrissitorc=:vlrissitorc
            where po.codemp=new.codemp and po.codfilial=new.codfilial and po.codorc=new.codorc
            and po.tipoorc=new.tipoorc and po.coditorc=new.coditorc;

       end

       -- Se o status foi alterado para Aprovado (OL), deve atualizar o status das ordens de serviço vinculadas
       -- para OA (Orçamento aprovado)
       if(new.statusitorc!=old.statusitorc and new.statusitorc='OL' ) then
       begin
            update eqitrecmercitositorc ios set ios.status='OA'
            where ios.codempoc=new.codemp and ios.codfilialoc=new.codfilial and ios.codorc=new.codorc
            and ios.tipoorc=new.tipoorc and ios.coditorc=new.coditorc;
       end

       -- Contando a quantidade de itens do orçamento com o status do item atual
       select count(*) from vditorcamento
       where CODORC=new.CODORC and TIPOORC='O' and CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL and statusitorc=new.statusitorc
       into :qtdstatusitem;

       -- Contando a quantidade de itens total do orçamento
       select count(*) from vditorcamento
       where CODORC=new.CODORC and TIPOORC='O' and CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL and statusitorc=new.statusitorc
       into :qtdstatustot;

       -- Se todos os itens do orçamento tem o mesmo status, deve ataulizar o status do cabeçalho do orçamento;
       if(:qtdstatusitem > 0 and :qtdstatusitem = :qtdstatustot) then
       begin
            update vdorcamento set statusorc=new.statusitorc
            where CODORC=new.CODORC and TIPOORC='O' and CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL;
       end

    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITORCAMENTOTGBI
as
    declare variable refprod VARchar(20);
    declare variable vlripi numeric(15,5);
    declare variable contribipi char(1);

begin

    select fi.contribipifilial from sgfilial fi where fi.codemp=new.codemp and fi.codfilial=new.codfilial
    into contribipi;

    if(contribipi = 'S') then
    begin
        select pt.vlripiitorc from vdprevtribitorc pt
        where pt.codemp=new.codemp and pt.codfilial=new.codfilial and pt.codorc=new.codorc and pt.tipoorc=new.tipoorc
        and pt.coditorc=new.coditorc
        into vlripi;
    end

    -- Garantindo valor válido para IPI
    if (vlripi is null) then vlripi = 0;

    -- Garantindo valor válido para desconto
    if (new.vlrdescitorc is null) then new.vlrdescitorc = 0;

    -- Garantindo valor válido para vlrliqitorc
    if (new.vlrliqitorc is null) then new.vlrliqitorc = 0;

    -- Calculando valor liquido
    if (new.vlrliqitorc = 0) then
    begin
        new.vlrliqitorc = (new.qtditorc * new.precoitorc) - new.vlrdescitorc + vlripi;
    end

    new.tipoorc = 'O';

    -- Garantindo a gravação da referência do produto.

    if (new.refprod is null) then
    begin
        select p.refprod from eqproduto p
        where p.codprod=new.codprod and p.codemp=new.codemppd and p.codfilial=new.codfilialpd
        into refprod;

        new.refprod = refprod;
    end

    -- Atualizando a tabela de orçamento

    update vdorcamento o set o.vlrdescitorc=o.vlrdescitorc + new.vlrdescitorc,
                             o.vlrprodorc = o.vlrprodorc + new.vlrproditorc,
                             o.vlrliqorc = o.vlrliqorc + new.vlrliqitorc
    where o.codorc=new.codorc and o.tipoorc=new.tipoorc and o.codemp=new.codemp and o.codfilial=new.codfilial;

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITORCAMENTOTGBU
as
    declare variable adicfrete char(1);
    declare variable tipoprod varchar(2);
    declare variable encorcprod char(1);

begin
    if ( new.emmanut is null) then
        new.emmanut='N';

    if(old.aprovitorc!=new.aprovitorc and new.aprovitorc='S') then -- Na aprovação do item de orçamento
    begin
        new.statusitorc='OL';
        new.dtaprovitorc=cast('today' as date);

        if(new.qtdaprovitorc is null) then
        begin
            new.qtdaprovitorc=new.qtditorc;
        end
    end
    else if(new.cancitorc='S' or new.statusitorc='CA' ) then
    begin
        new.aceiteitorc = 'N';
        new.aprovitorc = 'N';
        new.qtdaprovitorc = 0;
        new.statusitorc = 'CA';
        new.cancitorc = 'S';
    end

    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
    begin

        new.dtalt = cast('now' as date);
        new.halt = cast('now' as time);
        new.idusualt = user;

        select adicfrete from vdorcamento
        where codemp=new.codemp and codfilial=new.codfilial and codorc=new.codorc and tipoorc=new.tipoorc
        into adicfrete;

        if (new.vlrproditorc is null) then new.vlrproditorc = 0;
        if (new.vlrdescitorc is null) then new.vlrdescitorc = 0;
        if (new.vlrliqitorc is null) then new.vlrliqitorc = 0;

        if( adicfrete = 'S' and new.vlrfreteitorc is not null and new.vlrfreteitorc>0) then
        begin
            new.vlrliqitorc = new.vlrliqitorc + new.vlrfreteitorc;
        end

    end


    -- Buscando nas preferencias de deve encaminhar orçamento para a produção.
    select coalesce(p1.encorcprod,'N') from sgprefere1 p1
    where p1.codemp=new.codemp and p1.codfilial=new.codfilial
    into :encorcprod;


    -- Se for produto acabado e encaminhamento pull definido nas preferencias e item for aprovado deverá sinalizar item para produção.

    if(new.statusitorc!=old.statusitorc and new.statusitorc='OL' and :encorcprod='S') then
    begin

        select tipoprod from eqproduto pd where pd.codemp=new.codemppd and pd.codfilial=new.codfilialpd and pd.codprod=new.codprod
        into :tipoprod;

        if(:tipoprod='F') then
        begin
            new.sitproditorc='PE';
        end

    end

    -- Atualiza status do item, quando produzido
    if( old.sitproditorc!=new.sitproditorc and new.sitproditorc='PD' ) then
    begin
       new.statusitorc = 'OP';
    end

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDATGAD
AS
  DECLARE VARIABLE DDTVENDA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCVENDA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
BEGIN
  IF ( not ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) THEN
  BEGIN
      UPDATE VDVENDA SET
         VLRPRODVENDA = VLRPRODVENDA - old.VLRPRODITVENDA,
         VLRBASEICMSVENDA = VLRBASEICMSVENDA - old.VLRBASEICMSITVENDA,
         VLRICMSVENDA = VLRICMSVENDA -old.VLRICMSITVENDA,
         VLRISENTASVENDA = VLRISENTASVENDA - old.VLRISENTASITVENDA,
         VLROUTRASVENDA = VLROUTRASVENDA - old.VLROUTRASITVENDA,
         VLRBASEIPIVENDA = VLRBASEIPIVENDA - old.VLRBASEIPIITVENDA,
         VLRIPIVENDA = VLRIPIVENDA - old.VLRIPIITVENDA,
         VLRLIQVENDA = VLRLIQVENDA - old.VLRLIQITVENDA,
         VLRCOMISVENDA = VLRCOMISVENDA - old.VLRCOMISITVENDA,
         VLRBASEISSVENDA = VLRBASEISSVENDA - old.VLRBASEISSITVENDA,
         VLRISSVENDA = VLRISSVENDA - old.VLRISSITVENDA,
         VLRDESCITVENDA = VLRDESCITVENDA - old.VLRDESCITVENDA,
         VLRBASEICMSSTVENDA = VLRBASEICMSSTVENDA - OLD.vlrbaseicmsstitvenda,
         VLRICMSSTVENDA = VLRICMSSTVENDA - OLD.vlricmsstitvenda,
         VLRBASECOMIS = VLRBASECOMIS - OLD.vlrbasecomisitvenda
         WHERE CODVENDA=old.CODVENDA AND TIPOVENDA=old.TIPOVENDA AND
         CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
      SELECT V.DTEMITVENDA, V.FLAG, V.DOCVENDA,
          V.CODEMPTM, V.CODFILIALTM, V.CODTIPOMOV
       FROM VDVENDA V  WHERE V.CODVENDA = old.CODVENDA AND
          V.CODEMP=old.CODEMP AND V.CODFILIAL = old.CODFILIAL AND
          V.TIPOVENDA=old.TIPOVENDA
      INTO :DDTVENDA, :CFLAG, :IDOCVENDA, :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV;
      EXECUTE PROCEDURE EQMOVPRODIUDSP('D', old.CODEMPPD, old.CODFILIALPD,
         old.CODPROD, old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
         :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV, null, null, null,
         null, null, null, null,
         old.CODEMP, old.CODFILIAL, old.TIPOVENDA, old.CODVENDA, old.CODITVENDA,
          null, null, null, null,null,null, null, null, null,
         old.CODEMPNT, old.CODFILIALNT, old.CODNAT, :DDTVENDA,
         :IDOCVENDA, :CFLAG, old.QTDITVENDA, old.PRECOITVENDA,
         old.CODEMPAX, old.CODFILIALAX, old.CODALMOX, null);
  END
END
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDATGAI
as
    declare variable dtvenda date ;
    declare variable flag char(1);
    declare variable docvenda integer;
    declare variable codemptm integer;
    declare variable codfilialtm smallint;
    declare variable codtipomov integer;
    declare variable preco numeric(15, 5);
    declare variable visualizalucr char(1);
    declare variable custopeps numeric(15, 5);
    declare variable custompm numeric(15, 5);
    declare variable custouc numeric(15, 5);

begin
    -- Carregamento de preferencias
    select visualizalucr from sgprefere1 where codemp=new.codemp and codfilial = new.codfilial
    into :visualizalucr;

    -- Carregamento de informações do cabeçalho da venda
    select vd.dtemitvenda, vd.flag, vd.docvenda, vd.codemptm, vd.codfilialtm, vd.codtipomov
        from eqtipomov tm, vdvenda vd
        where
            tm.codemp=vd.codemptm and tm.codfilial=vd.codfilialtm and tm.codtipomov=vd.codtipomov and
            vd.codemp=new.codemp and vd.codfilial=new.codfilial and vd.tipovenda=new.tipovenda and vd.codvenda=new.codvenda
    into :dtvenda, :flag, :docvenda, :codemptm, :codfilialtm, :codtipomov;

    -- Inicializando preco do item
    if (new.qtditvenda != 0 ) then
        preco = new.vlrliqitvenda/new.qtditvenda;
    else
        preco = new.precoitvenda;

    -- Executando movimentação do estoque
    execute procedure eqmovprodiudsp(
        'I', new.codemppd, new.codfilialpd, new.codprod,new.codemple, new.codfilialle, new.codlote, :codemptm, :codfilialtm,
        :codtipomov, null, null, null, null, null, null, null, new.codemp, new.codfilial, new.tipovenda, new.codvenda, new.coditvenda,
        null, null, null, null,null,null,null, null, null, new.codempnt, new.codfilialnt, new.codnat,:dtvenda, :docvenda, :flag, new.qtditvenda, :preco,
        new.codempax, new.codfilialax, new.codalmox, null
    );

    -- Salvamento de custos no momento da venda
    if( visualizalucr = 'S' ) then
    begin
        -- Busca do custo da ultima compra;
        select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
            new.dtins,'U',new.codempax, new.codfilialax, new.codalmox,'N')
        into :custouc;

        -- Busca do custo médio (MPM)
        select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
            new.dtins,'M',new.codempax, new.codfilialax, new.codalmox,'N')
        into :custompm;

        -- Busca do custo peps
        select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
            new.dtins,'P',new.codempax, new.codfilialax, new.codalmox,'N')
        into :custopeps;

        -- Inserindo registro na tabela de custos de item de venda
        insert into vditcustovenda (codemp,codfilial,codvenda,tipovenda,coditvenda,vlrprecoultcp, vlrcustompm, vlrcustopeps)
        values (new.codemp,new.codfilial,new.codvenda,new.tipovenda,new.coditvenda,:custouc,:custompm,:custopeps);

    end

     -- Executa procedure de geração de tabela de vinculo para numeros de serie

    execute procedure vditvendaseriesp('I', new.codemp, new.codfilial, new.codvenda, new.tipovenda, new.coditvenda, new.codemppd, new.codfilialpd, new.codprod, new.numserietmp, new.qtditvenda);

    -- Inserindo registros na tabela de informações fiscais complementares (LFITVENDA)

    execute procedure lfgeralfitvendasp(new.codemp, new.codfilial, new.codvenda, new.tipovenda, new.coditvenda);

    -- Inserindo registro na tabela de vinculo entre compras e vendas (devolução)

    if(new.codcompra is not null and new.coditcompra is not null) then
    begin
        insert into cpdevolucao
            (codemp, codfilial, codcompra, coditcompra, qtddev,
             codempvd, codfilialvd, codvenda, tipovenda, coditvenda )
        values
            (new.codempcp, new.codfilialcp, new.codcompra, new.coditcompra,new.qtditvenda,
             new.codemp, new.codfilial,new.codvenda, new.tipovenda, new.coditvenda);
    end

    execute procedure cpgeradevolucaosp (
    new.codempcp,new.codfilialcp, new.codcompra, new.coditcompra, new.codemp, new.codfilial,
    new.codvenda, new.coditvenda, new.tipovenda, new.qtditvenda);

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDATGAU
AS
  DECLARE VARIABLE DDTVENDA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCVENDA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
  DECLARE VARIABLE CSTATUS CHAR(2);
  DECLARE VARIABLE CTIPOPROD varCHAR(2);
  DECLARE VARIABLE NPRECO NUMERIC(15, 5);
  DECLARE VARIABLE visualizalucr CHAR(1);
  DECLARE VARIABLE custopeps NUMERIC(15, 5);
  DECLARE VARIABLE custompm NUMERIC(15, 5);
  DECLARE VARIABLE custouc NUMERIC(15, 5);

BEGIN
  
  select visualizalucr from sgprefere1 where codemp=new.codemp and codfilial = new.codfilial
    into :visualizalucr;

  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) ) THEN
  BEGIN
      SELECT VD.DTEMITVENDA,VD.DOCVENDA,VD.STATUSVENDA,VD.FLAG,
             VD.CODEMPTM, VD.CODFILIALTM, VD.CODTIPOMOV
        FROM VDVENDA VD
        WHERE VD.CODVENDA = new.CODVENDA AND VD.TIPOVENDA = new.TIPOVENDA
            AND VD.CODEMP=new.CODEMP AND VD.CODFILIAL = new.CODFILIAL
        INTO :DDTVENDA, :IDOCVENDA, :CSTATUS, :CFLAG, :ICODEMPTM,
          :SCODFILIALTM, :ICODTIPOMOV;
      SELECT TIPOPROD FROM EQPRODUTO WHERE CODPROD=old.CODPROD
             AND CODEMP=old.CODEMPPD AND CODFILIAL = old.CODFILIALPD
         INTO CTIPOPROD;
      if (substr(:CSTATUS,1,1)!='C') then
      BEGIN
        UPDATE VDVENDA SET VLRDESCITVENDA = VLRDESCITVENDA -old.VLRDESCITVENDA + new.VLRDESCITVENDA,
               VLRPRODVENDA = VLRPRODVENDA - old.VLRPRODITVENDA + new.VLRPRODITVENDA,
               VLRBASEICMSVENDA = VLRBASEICMSVENDA - old.VLRBASEICMSITVENDA + new.VLRBASEICMSITVENDA,
               VLRICMSVENDA = VLRICMSVENDA -old.VLRICMSITVENDA + new.VLRICMSITVENDA,
               VLRISENTASVENDA = VLRISENTASVENDA - old.VLRISENTASITVENDA + new.VLRISENTASITVENDA,
               VLROUTRASVENDA = VLROUTRASVENDA - old.VLROUTRASITVENDA + new.VLROUTRASITVENDA,
               VLRBASEIPIVENDA = VLRBASEIPIVENDA - old.VLRBASEIPIITVENDA + new.VLRBASEIPIITVENDA,
               VLRIPIVENDA = VLRIPIVENDA - old.VLRIPIITVENDA + new.VLRIPIITVENDA,
               VLRLIQVENDA = VLRLIQVENDA - old.VLRLIQITVENDA + new.VLRLIQITVENDA,
               VLRCOMISVENDA = VLRCOMISVENDA - old.VLRCOMISITVENDA + new.VLRCOMISITVENDA,
               VLRBASEISSVENDA = VLRBASEISSVENDA - old.VLRBASEISSITVENDA + new.VLRBASEISSITVENDA,
               VLRISSVENDA = VLRISSVENDA - old.VLRISSITVENDA + new.VLRISSITVENDA,
               VLRBASEICMSSTVENDA = VLRBASEICMSSTVENDA - OLD.vlrbaseicmsstitvenda + NEW.vlrbaseicmsstitvenda,
               VLRICMSSTVENDA = VLRICMSSTVENDA - OLD.vlricmsstitvenda + NEW.vlricmsstitvenda,
               vlrbasecomis = vlrbasecomis - old.vlrbasecomisitvenda + new.vlrbasecomisitvenda
               WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA
               AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
        
        IF (SUBSTR(CSTATUS,1,1) = 'P') THEN
          CSTATUS = 'PV';
        ELSE IF (SUBSTR(CSTATUS,1,1) = 'V') THEN
          CSTATUS = 'VD';
      END
      IF (new.QTDITVENDA = 0) THEN
         NPRECO = new.PRECOITVENDA;
      ELSE
         NPRECO = new.VLRLIQITVENDA/new.QTDITVENDA;
      EXECUTE PROCEDURE EQMOVPRODIUDSP('U',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
        new.CODEMPLE, new.CODFILIALLE, new.CODLOTE, :ICODEMPTM,
        :SCODFILIALTM, :ICODTIPOMOV, null, null, null ,null, null,
        null, null, new.CODEMP, new.CODFILIAL, new.TIPOVENDA, new.CODVENDA,
        new.CODITVENDA, null, null, null, null,null,null,null, null, null,
        new.CODEMPNT, new.CODFILIALNT,
        new.CODNAT, :DDTVENDA, :IDOCVENDA, :CFLAG, new.QTDITVENDA, :NPRECO,
        new.CODEMPAX, new.CODFILIALAX, new.CODALMOX, null);


       if( visualizalucr = 'S' ) then
       begin

            -- Busca do custo da ultima compra;
            select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                new.dtins,'U',new.codempax, new.codfilialax, new.codalmox,'N')
            into :custouc;

            -- Busca do custo médio (MPM)
            select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                new.dtins,'M',new.codempax, new.codfilialax, new.codalmox,'N')
            into :custompm;

            -- Busca do custo peps
            select custounit from eqcustoprodsp(new.codemppd, new.codfilialpd, new.codprod,
                new.dtins,'P',new.codempax, new.codfilialax, new.codalmox,'N')
            into :custopeps;

            -- Atualizando registro na tabela de custos de item de venda

            update vditcustovenda icv set vlrprecoultcp=:custouc, vlrcustompm=:custompm, vlrcustopeps=:custopeps
                where icv.codemp=new.codemp and icv.codfilial=new.codfilial and icv.codvenda=new.codvenda
                and icv.tipovenda=new.tipovenda and icv.coditvenda=new.coditvenda;

       end

        -- Executa procedure para atualização de tabela de vinculo para numeros de serie
        execute procedure vditvendaseriesp('U', old.codemp, old.codfilial, old.codvenda, old.tipovenda, old.coditvenda, old.codemppd, old.codfilialpd, old.codprod, new.numserietmp, new.qtditvenda);


        -- Atualizando registros na tabela de informações fiscais complementares (LFITVENDA)
        if(new.coditfisc is not null) then
        begin
            execute procedure lfgeralfitvendasp(
            new.codemp, new.codfilial, new.codvenda, new.tipovenda, new.coditvenda);
        end

        -- Atualizando informações referentes à devolução
        execute procedure cpgeradevolucaosp (
        new.codempcp,new.codfilialcp, new.codcompra, new.coditcompra, new.codemp, new.codfilial,
        new.codvenda, new.coditvenda, new.tipovenda, new.qtditvenda);


   END
END
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDATGBI
as
    declare variable srefprod VARchar(20);
    declare variable stipoprod varchar(2);
    declare variable percicmsst numeric(9,2);
    declare variable percicms numeric(9,2);
    declare variable precocomisprod numeric(15,5);
    declare variable redfisc numeric(9,2);
    declare variable redbasest char(1);
    declare variable ufcli char(2);
    declare variable ufemp char(2);

    begin

        -- Inicializando campos nulos.
        if (new.vlrdescitvenda is null) then new.vlrdescitvenda = 0;
        if (new.vlrbaseicmsitvenda is null) then new.vlrbaseicmsitvenda = 0;
        if (new.vlricmsitvenda is null) then new.vlricmsitvenda = 0;
        if (new.vlrbaseipiitvenda is null) then new.vlrbaseipiitvenda = 0;
        if (new.vlripiitvenda is null) then new.vlripiitvenda = 0;
        if (new.vlrliqitvenda is null) then new.vlrliqitvenda = 0;
        if (new.vlrcomisitvenda is null) then new.vlrcomisitvenda = 0;
        if (new.vlradicitvenda is null) then new.vlradicitvenda = 0;
        if (new.vlrissitvenda is null) then new.vlrissitvenda = 0;
        if (new.vlrfreteitvenda is null) then new.vlrfreteitvenda = 0;
        if (new.tipovenda is null) then new.tipovenda = 'V';
        if (new.vlrbaseicmsstitvenda is null) then new.vlrbaseicmsstitvenda = 0;
        if (new.vlrbaseicmsstretitvenda is null) then new.vlrbaseicmsstretitvenda = 0;
        if (new.vlricmsstitvenda is null) then new.vlricmsstitvenda = 0;
        if (new.vlricmsstretitvenda is null) then new.vlricmsstretitvenda = 0;
        if (new.vlrbasecomisitvenda is null) then new.vlrbasecomisitvenda = 0;

        -- Calculando valor liquido do ítem quando zerado.
        if (new.vlrliqitvenda = 0) then
            new.vlrliqitvenda = (new.qtditvenda * new.precoitvenda) +
                new.vlradicitvenda + new.vlrfreteitvenda - new.vlrdescitvenda;

        -- Carregando almoxarifado padrão do produto
        if (new.codalmox is null) then
            select codempax, codfilialax, codalmox from eqproduto
                where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
            into new.codempax, new.codfilialax,new.codalmox;

        -- Acertando o codigo de empresa e filial da mensagem, caso a mensagem seja informada.
        if (not new.codmens is null) then
        begin
            select icodfilial from sgretfilial(new.codemp,'LFMENSAGEM') into new.codfilialme;
            new.codempme = new.codemp;
        end

        -- Buscando referência do produto
        select p.refprod, p.tipoprod, p.precocomisprod from eqproduto p
            where p.codemp=new.codemppd and p.codfilial = new.codfilialpd and p.codprod=new.codprod
        into srefprod, stipoprod, precocomisprod;

        -- Acertando referência quando nula
        if (new.refprod is null) then new.refprod = srefprod;

          
        -- Se o item vendido seja um SERVIÇO (Calculo do ISS);
        if (stipoprod = 'S') then
        begin
            -- Carregando aliquota do ISS
            select first 1 coalesce(f.percissfilial,c.aliqissfisc)
            from sgfilial f
            left outer join lfitclfiscal c on
            c.codemp=new.codempif and c.codfilial=new.codfilialif and c.codfisc=new.codfisc and c.coditfisc=new.coditfisc
            where codemp=new.codemp and codfilial=new.codfilial
            into new.percissitvenda;

            -- Calculando e computando base e valor do ISS;
            if (new.percissitvenda != 0) then
            begin
                new.vlrbaseissitvenda = new.vlrliqitvenda;
                new.vlrissitvenda = new.vlrbaseissitvenda*(new.percissitvenda/100);
            end
        end
        else -- Se o item vendido não for SERVIÇO zera ISS
            new.vlrbaseissitvenda = 0;

        -- Se produto for isento de ICMS
        if (new.tipofisc = 'II') then
        begin
            new.vlrisentasitvenda = new.vlrliqitvenda;
            new.vlrbaseicmsitvenda = 0;
            new.percicmsitvenda = 0;
            new.vlricmsitvenda = 0;
            new.vlroutrasitvenda = 0;
        end
        -- Se produto for de Substituição Tributária
        else if (new.tipofisc = 'FF') then
        begin

           if (new.tipost = 'SI' ) then -- Contribuinte Substituído
                begin
                    new.vlroutrasitvenda = new.vlrliqitvenda;
                    new.vlrbaseicmsitvenda = 0;
                    new.percicmsitvenda = 0;
                    new.vlricmsitvenda = 0;
                    new.vlrisentasitvenda = 0;

                      -- Buscando estado do cliente e da empresa

                    select coalesce(cl.siglauf,cl.ufcli), fi.siglauf from vdcliente cl, vdvenda vd, sgfilial fi
                    where vd.codemp=new.codemp and vd.codfilial=new.codfilial and vd.codvenda=new.codvenda and vd.tipovenda=new.tipovenda and
                    cl.codemp=vd.codempcl and cl.codfilial=vd.codfilialcl and cl.codcli=vd.codcli
                    and fi.codemp=new.codemp and fi.codfilial=new.codfilial
                    into ufcli, ufemp;

                    -- Buscando aliquota do ICMS ST da tabela de classificação fiscal
                    select coalesce(ic.aliqfiscintra,0),coalesce(ic.aliqfisc,0), coalesce(ic.redfisc,0), coalesce(ic.redbasest,'S') from lfitclfiscal ic
                    where ic.codemp=new.codempif and ic.codfilial=new.codfilialif and ic.codfisc=new.codfisc and ic.coditfisc=new.coditfisc
                    into percicmsst, percicms, redfisc, redbasest ;

                    -- Buscando aliquota do ICMS ST da tabela de alíquotas (caso não encontre na busca anterior)
                    if (percicmsst = 0) then
                    begin
                        select coalesce(PERCICMSINTRA,0),coalesce(PERCICMS,0) from lfbuscaicmssp (new.codnat,:ufemp,new.codemp,new.codfilial)
                        into PERCICMSST, percicms;
                    end

                    if(redfisc>0 and redbasest='S') then
                    begin

                        -- Quando há redução na base do icms st , deve usar o valor da base do icms proprio como parametro

                        new.vlrbaseicmsstretitvenda = ( (new.vlrproditvenda - new.vlrdescitvenda + new.vlripiitvenda )  / (1+(new.margemvlagritvenda / 100.00))) * (1-(redfisc/100.00)) ;
                        new.vlricmsstretitvenda = ((new.vlrproditvenda - new.vlrdescitvenda + new.vlripiitvenda ) * (:percicmsst / 100.00)) - (new.vlrbaseicmsstretitvenda * (:percicms/100.00));

                    end
                    else
                    begin

                        -- Quando não há redução na base do icms st deve usar o valor da base bruto (rem redução)
                        new.vlrbaseicmsstretitvenda = ( (new.vlrproditvenda - new.vlrdescitvenda + new.vlripiitvenda )  / (1+(new.margemvlagritvenda / 100.00))) ;
                        new.vlricmsstretitvenda = ((new.vlrproditvenda - new.vlrdescitvenda + new.vlripiitvenda ) * (:percicmsst / 100.00)) - (new.vlrbaseicmsstretitvenda * (:percicms/100.00));

                    end

            end
            else if (new.tipost = 'SU' ) then -- Contribuinte Substituto
            begin

                -- Buscando estado do cliente

                select coalesce(cl.siglauf,cl.ufcli) from vdcliente cl, vdvenda vd
                where vd.codemp=new.codemp and vd.codfilial=new.codfilial and vd.codvenda=new.codvenda and vd.tipovenda=new.tipovenda and
                cl.codemp=vd.codempcl and cl.codfilial=vd.codfilialcl and cl.codcli=vd.codcli
                into ufcli;

                -- Buscando aliquota do ICMS ST da tabela de classificação fiscal
                select coalesce(ic.aliqfiscintra,0), coalesce(ic.redfisc,0), coalesce(ic.redbasest,'S') from lfitclfiscal ic
                where ic.codemp=new.codempif and ic.codfilial=new.codfilialif and ic.codfisc=new.codfisc and ic.coditfisc=new.coditfisc
                into percicmsst, redfisc, redbasest ;
                -- Buscando aliquota do ICMS ST da tabela de alíquotas (caso não encontre na busca anterior)
                if (percicmsst = 0) then
                begin
                    select coalesce(PERCICMSINTRA,0) from lfbuscaicmssp (new.codnat,:ufcli,new.codemp,new.codfilial)
                    into PERCICMSST;
                end

                if(redfisc>0 and redbasest='S') then
                begin
                    -- Quando há redução na base do icms st , deve usar o valor da base do icms proprio como parametro
                    new.vlrbaseicmsstitvenda = (  (coalesce(new.margemvlagritvenda,0) + 100) / 100 )  * (  (coalesce(new.vlrbaseicmsitvenda,0) ) + (coalesce(new.vlripiitvenda,0)) );

                end
                else
                begin
                    -- Quando não há redução na base do icms st deve usar o valor da base bruto (rem redução)
                    new.vlrbaseicmsstitvenda = (  (coalesce(new.margemvlagritvenda,0) + 100) / 100 )  * (  (coalesce(new.vlrbaseicmsbrutitvenda,0) ) + (coalesce(new.vlripiitvenda,0)) );
                end

                new.vlroutrasitvenda = 0;
                new.vlrisentasitvenda = 0;


                new.vlricmsstitvenda = ( (new.vlrbaseicmsstitvenda * :percicmsst) / 100 ) - (new.vlricmsitvenda) ;

            end
        end
        -- Se produto não for tributado e não isento
        else if (new.tipofisc = 'NN') then
        begin
            new.vlroutrasitvenda = new.vlrliqitvenda;
            new.vlrbaseicmsitvenda = 0;
            new.percicmsitvenda = 0;
            new.vlricmsitvenda = 0;
            new.vlrisentasitvenda = 0;
        end
        -- Se produto for tributado integralmente
        else if (new.tipofisc = 'TT') then
        begin
            new.vlroutrasitvenda = 0;
            new.vlrisentasitvenda = 0;
        end

        -- Gerando preço especial para comissionamento
        if(precocomisprod is not null) then
        begin

            new.vlrbasecomisitvenda = new.qtditvenda * precocomisprod;

        end

        -- Atualização de totais no cabeçalho da venda

        update vdvenda vd set vd.vlrdescitvenda = vd.vlrdescitvenda + new.vlrdescitvenda,
            vd.vlrprodvenda = vd.vlrprodvenda + new.vlrproditvenda,
            vd.vlrbaseicmsvenda = vd.vlrbaseicmsvenda + new.vlrbaseicmsitvenda,
            vd.vlricmsvenda = vd.VLRICMSVENDA + new.vlricmsitvenda,
            vd.vlrisentasvenda = vd.VLRISENTASVENDA + new.vlrisentasitvenda,
            vd.vlroutrasvenda = vd.VLROUTRASVENDA + new.vlroutrasitvenda,
            vd.vlrbaseipivenda = vd.VLRBASEIPIVENDA + new.vlrbaseipiitvenda,
            vd.vlripivenda = vd.VLRIPIVENDA + new.vlripiitvenda,
            vd.vlrliqvenda = vd.VLRLIQVENDA + new.vlrliqitvenda,
            vd.vlrbaseissvenda = vd.VLRBASEISSVENDA + new.vlrbaseissitvenda,
            vd.vlrissvenda = vd.VLRISSVENDA + new.vlrissitvenda,
            vd.vlrcomisvenda = vd.VLRCOMISVENDA + new.vlrcomisitvenda,
            vd.vlrbaseicmsstvenda = coalesce(vd.vlrbaseicmsstvenda,0) + new.vlrbaseicmsstitvenda,
            vd.vlricmsstvenda = coalesce(vd.vlricmsstvenda,0) + new.vlricmsstitvenda,
            vd.vlrbasecomis = coalesce(vd.vlrbasecomis, 0) + new.vlrbasecomisitvenda
         where vd.codvenda=new.codvenda and vd.tipovenda=new.tipovenda and
            vd.codemp=new.codemp and vd.codfilial=new.codfilial;



end
^

/* Alter exist trigger... */
ALTER TRIGGER VDITVENDATGBU
as
    declare variable srefprod VARchar(20);
    declare variable stipoprod varchar(2);
    declare variable ntmp numeric(15, 5);
    declare variable precocomisprod numeric(15, 5);
    declare variable percicmsst numeric(9,2);
    declare variable percicms numeric(9,2);
    declare variable ufcli char(2);
    declare variable ufemp char(2);
    declare variable redbasest char(1);
    declare variable redfisc numeric(9,2);


    begin
        -- Verifica se tabela está em manutenção // caso não esteja inicia procedimentos
        if ( new.emmanut is null) then
            new.emmanut='N';

        if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
        begin

            -- Computando campos de log
            new.dtalt=cast('now' as date);
            new.idusualt=user;
            new.halt = cast('now' as time);

            -- Verifica se o produto foi alterado
            if (new.codprod != old.codprod) then
                exception vditvendaex01;

            -- Verifica se o lote foi alterado
            if (new.codlote != old.codlote) then
                exception vditvendaex02;

            -- Verifica se o código do almoxarifa está nuloo, se estiver carrega o almoxarifado padrão do produto
            if (new.codalmox is null) then
            begin
                select codempax,codfilialax,codalmox from eqproduto
                where codemp=new.codemppd and codfilial=new.codfilialpd and codprod=new.codprod
                into new.codempax, new.codfilialax,new.codalmox;
            end

            -- Verifica se o almoxarifado anterior estava nulo, se não informa que não é pode ser trocado
            if (old.codalmox is not null) then
            begin
                if (old.codalmox != new.codalmox) then
                    exception eqalmox01;
            end

            -- Carrega a referencia e tipo do produto
            select refprod, tipoprod, precocomisprod
            from eqproduto where codprod=new.codprod and codemp=new.codemppd and codfilial=new.codfilialpd
            into srefprod, stipoprod, precocomisprod;

            if (new.refprod is null) then new.refprod = srefprod;

            -- Caso a nota tenha sido cancelada
            if ( (new.cancitvenda is not null) and (new.cancitvenda = 'S') ) then
            begin
                new.qtditvenda = 0;
                new.vlrliqitvenda = 0;
                new.vlrproditvenda = 0;
                new.vlrbaseicmsitvenda = 0;
                new.vlrbaseipiitvenda = 0;
                new.vlrdescitvenda = 0;
            end

            -- Calculando o valor liquido o ítem
            if ( (new.vlrliqitvenda = 0) and ( (new.cancitvenda is null) or (new.cancitvenda!='S') ) ) then
            begin
                new.vlrliqitvenda = (new.qtditvenda * new.precoitvenda) + new.vlradicitvenda + new.vlrfreteitvenda - new.vlrdescitvenda;
            end
            else if (new.vlrdescitvenda > 0 and new.qtditvenda > 0) then
            begin
                ntmp = new.vlrliqitvenda/new.qtditvenda;
                ntmp = ntmp * new.qtditvenda;
                new.vlrdescitvenda = new.vlrdescitvenda + (new.vlrliqitvenda-ntmp);

                -- Recalculando comissão sobre o ítem
                new.vlrcomisitvenda = (new.perccomisitvenda * new.vlrliqitvenda ) / 100;
            end

            -- Ser for um serviço
            if (stipoprod = 'S') then
            begin
                -- Calculo do ISS
                select first 1 coalesce(f.percissfilial,c.aliqissfisc)
                from sgfilial f
                left outer join lfitclfiscal c on
                c.codemp=new.codempif and c.codfilial=new.codfilialif and c.codfisc=new.codfisc and c.coditfisc=new.coditfisc
                where codemp=new.codemp and codfilial=new.codfilial
                into new.percissitvenda;

                if (new.percissitvenda != 0) then
                begin
                    new.vlrbaseissitvenda = new.vlrliqitvenda;
                    new.vlrissitvenda = new.vlrbaseissitvenda * (new.percissitvenda/100);
                end
            end
            else
                new.vlrbaseissitvenda = 0;

            -- ìtem isento
            if (new.tipofisc = 'II') then
            begin
                new.vlrisentasitvenda = new.vlrliqitvenda;
                new.vlrbaseicmsitvenda = 0;
                new.percicmsitvenda = 0;
                new.vlricmsitvenda = 0;
                new.vlroutrasitvenda = 0;
            end
            -- Item com substituição tributária
            else if (new.tipofisc = 'FF') then
            begin
                if (new.tipost = 'SI' ) then -- Contribuinte Substituído
                begin
                    new.vlroutrasitvenda = new.vlrliqitvenda;
                    new.vlrbaseicmsitvenda = 0;
                    new.percicmsitvenda = 0;
                    new.vlricmsitvenda = 0;
                    new.vlrisentasitvenda = 0;

                      -- Buscando estado do cliente e da empresa

                    select coalesce(cl.siglauf,cl.ufcli), fi.siglauf from vdcliente cl, vdvenda vd, sgfilial fi
                    where vd.codemp=new.codemp and vd.codfilial=new.codfilial and vd.codvenda=new.codvenda and vd.tipovenda=new.tipovenda and
                    cl.codemp=vd.codempcl and cl.codfilial=vd.codfilialcl and cl.codcli=vd.codcli
                    and fi.codemp=new.codemp and fi.codfilial=new.codfilial
                    into ufcli, ufemp;

                    -- Buscando aliquota do ICMS ST da tabela de classificação fiscal
                    select coalesce(ic.aliqfiscintra,0),coalesce(ic.aliqfisc,0), coalesce(ic.redfisc,0), coalesce(ic.redbasest,'S') from lfitclfiscal ic
                    where ic.codemp=new.codempif and ic.codfilial=new.codfilialif and ic.codfisc=new.codfisc and ic.coditfisc=new.coditfisc
                    into percicmsst, percicms, redfisc, redbasest ;

                    -- Buscando aliquota do ICMS ST da tabela de alíquotas (caso não encontre na busca anterior)
                    if (percicmsst = 0) then
                    begin
                        select coalesce(PERCICMSINTRA,0),coalesce(PERCICMS,0) from lfbuscaicmssp (new.codnat,:ufemp,new.codemp,new.codfilial)
                        into PERCICMSST, percicms;
                    end

                    if(redfisc>0 and redbasest='S') then
                    begin

                        -- Quando há redução na base do icms st , deve usar o valor da base do icms proprio como parametro

                        new.vlrbaseicmsstretitvenda = ( (new.vlrproditvenda - new.vlrdescitvenda + new.vlripiitvenda )  / (1+(new.margemvlagritvenda / 100.00))) * (1-(redfisc/100.00)) ;
                        new.vlricmsstretitvenda = ((new.vlrproditvenda - new.vlrdescitvenda + new.vlripiitvenda ) * (:percicmsst / 100.00)) - (new.vlrbaseicmsstretitvenda * (:percicms/100.00));

                    end
                    else
                    begin

                        -- Quando não há redução na base do icms st deve usar o valor da base bruto (rem redução)
                        new.vlrbaseicmsstretitvenda = ( (new.vlrproditvenda - new.vlrdescitvenda + new.vlripiitvenda )  / (1+(new.margemvlagritvenda / 100.00))) ;
                        new.vlricmsstretitvenda = ((new.vlrproditvenda - new.vlrdescitvenda + new.vlripiitvenda ) * (:percicmsst / 100.00)) - (new.vlrbaseicmsstretitvenda * (:percicms/100.00));

                    end
    

                end
                else if (new.tipost = 'SU' ) then -- Contribuinte Substituto
                begin

                    -- Buscando estado do cliente
                    select coalesce(cl.siglauf,cl.ufcli) from vdcliente cl, vdvenda vd
                    where vd.codemp=new.codemp and vd.codfilial=new.codfilial and vd.codvenda=new.codvenda and vd.tipovenda=new.tipovenda and
                    cl.codemp=vd.codempcl and cl.codfilial=vd.codfilialcl and cl.codcli=vd.codcli
                    into ufcli;

                   -- Buscando aliquota do ICMS ST da tabela de classificação fiscal
                    select coalesce(ic.aliqfiscintra,0), ic.redbasest, ic.redfisc from lfitclfiscal ic
                    where ic.codemp=new.codempif and ic.codfilial=new.codfilialif and ic.codfisc=new.codfisc and ic.coditfisc=new.coditfisc
                    into PERCICMSST,redbasest, redfisc;
                    -- Buscando aliquota do ICMS ST da tabela de alíquotas (caso não encontre na busca naterior)
                    if (percicmsst = 0) then
                    begin
                        select coalesce(PERCICMSINTRA,0) from lfbuscaicmssp (new.codnat,:ufcli,new.codemp,new.codfilial)
                        into PERCICMSST;
                    end

                    new.vlroutrasitvenda = 0;
                    new.VLRISENTASITVENDA = 0;

                   if(redfisc>0 and redbasest='S') then
                    begin
                        -- Quando há redução na base do icms st , deve usar o valor da base do icms proprio como parametro
                        new.vlrbaseicmsstitvenda = (  (coalesce(new.margemvlagritvenda,0) + 100) / 100 )  * (  (coalesce(new.vlrbaseicmsitvenda,0) ) + (coalesce(new.vlripiitvenda,0)) );
                    end
                    else
                    begin
                        -- Quando não há redução na base do icms st deve usar o valor da base bruto (rem redução)
                        new.vlrbaseicmsstitvenda = (  (coalesce(new.margemvlagritvenda,0) + 100) / 100 )  * (  (coalesce(new.vlrbaseicmsbrutitvenda,0) ) + (coalesce(new.vlripiitvenda,0)) );
                    end

                    new.vlricmsstitvenda = ( (new.vlrbaseicmsstitvenda * :percicmsst) / 100 ) - (new.vlricmsitvenda) ;

                end
            end
            -- Não insidencia
            else if (new.tipofisc = 'NN') then
            begin
                new.vlroutrasitvenda = new.vlrliqitvenda;
                new.vlrbaseicmsitvenda = 0;
                new.percicmsitvenda = 0;
                new.vlricmsitvenda = 0;
                new.vlrisentasitvenda = 0;
            end
            -- Tributado integralmente
            else if (new.tipofisc = 'TT') then
            begin
                new.vlroutrasitvenda = 0;
                new.vlrisentasitvenda = 0;
            end
        end


       -- Atualizando preço especial para comissionamento
       if(precocomisprod is not null) then
       begin

           new.vlrbasecomisitvenda = new.qtditvenda * precocomisprod;

       end



    end
^

/* Alter exist trigger... */
ALTER TRIGGER VDKITTGBI
AS
begin
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
  /* Trigger text */
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDKITTGBU
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
  /* Trigger text */
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDORCAMENTOTGBU
as

    declare variable codatendo integer;
    declare variable codsetor integer;
    declare variable filialpref integer;
    declare variable filialusu integer;
    declare variable vlradic numeric(15,5);

begin

    if (new.emmanut is null) then
        new.emmanut = 'N';

    if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null)) ) ) then
    begin
        new.dtalt = cast('now' as date);
        new.idusualt = user;
        new.halt = cast('now' as time);

        if(new.codcli is null and new.codconv is not null) then
        begin

            select codcli, codempcl, codfilialcl, codtpconv, codfilialtc, codemptc
            from atconveniado
            where codemp=new.codempcv and codfilial=new.codfilialcv and codconv=new.codconv into
            new.codcli, new.codempcl, new.codfilialcl, new.codtpconv, new.codfilialtc, new.codemptc;

        end

        if ( (not new.codconv = old.codconv) and (new.codconv is not null) ) then
        begin
            select codcli, codempcl, codfilialcl
            from atconveniado
            where codemp=new.codempcv and codfilial=new.codfilialcv and codconv=new.codconv into
            new.codcli, new.codempcl, new.codfilialcl;
        end

        if (old.statusorc = 'OA' and new.statusorc = 'OC') then
        begin
            select icodfilial from sgretfilial(new.codemp,'SGPREFERE2') into filialpref;
            select icodfilial from sgretfilial(new.codemp,'SGUSUARIO') into filialusu;
            select codsetat2, codtpatendo3 from sgprefere2 where codemp=new.codemp and codfilial=:filialpref into
            codsetor,codatendo;

            if(new.codconv is not null) then
            begin
                execute procedure atadicatendimentosp(new.codconv,:codatendo,new.codatend, codsetor, null, new.codemp, :filialusu, new.codorc );
            end

        end

        if (old.statusorc!='OL' and new.statusorc = 'OL') then -- Caso orçamento tenha sido aprovado
        begin
           new.dtaprovorc = cast('today' as date);
        end
        
        execute procedure vdclienteativosp(new.codempcl, new.codfilialcl, new.codcli);

        if (new.vlrdescorc is null) then
            new.vlrdescorc = 0;

        new.vlrdescorc = new.vlrdescorc - old.vlrdescitorc;
        new.vlrdescorc = new.vlrdescorc + new.vlrdescitorc;

        vlradic = 0;

        if(new.adicfrete='S' and new.vlrfreteorc is not null and new.vlrfreteorc>0) then
        begin
            vlradic = vlradic + new.vlrfreteorc;
        end

        new.vlrliqorc = new.vlrprodorc - new.vlrdescorc + new.vlradicorc + vlradic;

    end
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDPRECOPRODTGBU
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);

  --Verifica se o preço foi realmente alterado;
  if(new.precoprod != old.precoprod) then
  begin

     new.precoant = old.precoprod;
     new.dtaltpreco = cast('now' as date);
     new.halt = cast('now' as time);
     new.idusualtpreco=USER;

  end

end
^

/* Alter exist trigger... */
ALTER TRIGGER VDROMANEIOTGBU
as
begin

  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDVENDATGAU
as
    declare variable icodrec integer;
    declare variable scodfilialrc smallint;
    declare variable icoditvenda integer;
    declare variable percred numeric(15,5);
    declare variable percit numeric(15,5);
    declare variable percicmsitvenda numeric(15,5);
    declare variable percipiitvenda numeric(15,5);
    declare variable tipofisc char(2);
    declare variable vlrdescitvenda numeric(15, 5);
    declare variable vlrbaseipiitvenda numeric(15, 5);
    declare variable vlrbaseicmsitvenda numeric(15, 5);
    declare variable vlrbaseicmsfreteitvenda numeric(15, 5);
    declare variable vlripiitvenda numeric(15, 5);
    declare variable vlrproditvenda numeric(15, 5);
    declare variable vlrliqitvenda numeric(15, 5);
    declare variable vlricmsitvenda numeric(15, 5);
    declare variable vlricmsfreteitvenda numeric(15, 5);
    declare variable tipomov char(2);
    declare variable vlrmfintipomov char(1);
    declare variable vlrtmp numeric(15, 5);
    declare variable qtditvenda numeric(9,2);
    declare variable nvlrparcrec numeric(15, 5);
    declare variable nvlrcomirec numeric(15, 5);
    declare variable percitfrete numeric(15, 5);
    declare variable vlritfrete numeric(15, 5);
    declare variable snroparcrec smallint;
    declare variable codempif integer;
    declare variable codfilialif smallint;
    declare variable codfisc char(13);
    declare variable coditfisc integer;
    declare variable dtrec date;
    declare variable gerarecemis char(1);
    declare variable tpredicms char(1);
    declare variable redbasefrete char(1);
    declare variable vlrretensaoiss numeric(15, 5);

    begin

        if ( not ( (new.emmanut='S') or ( (old.emmanut='S') and (old.emmanut is not null) )) ) then
        begin

        -- buscando preferências
        select gerarecemis from sgprefere1 p1 where p1.codemp=new.codemp and p1.codfilial=new.codfilial
        into :gerarecemis;

        -- Se foi dado desconto ou alterado o valor do frete da venda

        if ((not new.vlrdescvenda = old.vlrdescvenda) or (not new.vlrfretevenda = old.vlrfretevenda) ) then
        begin

            -- distribuindo o desconto e frete csocial e ir:

            for select coditvenda,percicmsitvenda,vlrdescitvenda,
                vlrliqitvenda,vlrproditvenda,qtditvenda,codempif,codfilialif,codfisc,coditfisc
                from vditvenda
                where codemp=new.codemp and codfilial=new.codfilial and codvenda=new.codvenda and tipovenda=new.tipovenda
                into icoditvenda,percicmsitvenda,
                vlrdescitvenda,vlrliqitvenda,vlrproditvenda,qtditvenda,codempif,codfilialif,codfisc,coditfisc
            do
            begin

                -- distribuição do desconto
                percit = 0;
                if (new.vlrprodvenda > 0 and not new.vlrdescitvenda > 0 and new.vlrdescvenda > 0) then
                begin
                    percit = (100*vlrproditvenda) / new.vlrprodvenda;
                    vlrdescitvenda = (new.vlrdescvenda  * percit) / 100;
                end

                -- distribuição do frete
                if ( new.vlrfretevenda > 0 and ( not new.vlrfretevenda = old.vlrfretevenda) ) then
                begin
                    percitfrete = :vlrproditvenda / new.vlrprodvenda ;
                    vlritfrete =  :percitfrete * new.vlrfretevenda ;
                end

                -- busca informações fiscais.:
                select first 1 i.redfisc, i.aliqipifisc, i.tipofisc, i.tpredicmsfisc, i.redbasefrete
                from lfitclfiscal i
                where i.codemp=:codempif and i.codfilial=:codfilialif and i.codfisc=:codfisc and i.coditfisc=:coditfisc
                into percred, percipiitvenda, tipofisc, tpredicms, redbasefrete;

                if (percred is null) then
                    percred = 0;

                if (percipiitvenda is null) then
                    percipiitvenda = 0;

                if (percicmsitvenda is null) then
                    percicmsitvenda = 0;

                vlrliqitvenda = vlrproditvenda - vlrdescitvenda;
                vlrbaseipiitvenda = 0;
                vlrbaseicmsitvenda = 0;
                vlricmsitvenda = 0;
                vlripiitvenda = 0;

                if (qtditvenda > 0) then
                begin
                    vlrtmp = vlrliqitvenda/qtditvenda;
                    vlrdescitvenda = vlrproditvenda - (vlrtmp*qtditvenda);
                    vlrliqitvenda = vlrproditvenda - vlrdescitvenda;
                end

                if ( tipofisc = 'II' ) then -- Isento de ICMS
                begin
                    percicmsitvenda = 0;
                    vlricmsitvenda = 0;
                    vlrbaseicmsfreteitvenda = 0;
                    vlrbaseicmsitvenda = 0;
                    percipiitvenda = 0;
                    vlripiitvenda = 0;
                    vlrbaseipiitvenda = 0;
                end
                else if ( tipofisc = 'FF' ) then -- Substituição tributária do icms
                begin
                    vlrbaseicmsitvenda = vlrliqitvenda - (vlrproditvenda*(percred/100));
                    vlricmsitvenda = vlrbaseicmsitvenda*(percicmsitvenda/100);
                    vlrbaseipiitvenda = vlrliqitvenda;
                    vlripiitvenda = vlrbaseipiitvenda*(percipiitvenda/100);
                end
                else if ( tipofisc = 'NN') then -- Não insidência do icms
                begin
                    percicmsitvenda = 0;
                    vlricmsitvenda = 0;
                    vlrbaseicmsitvenda = 0;
                    vlrbaseicmsfreteitvenda = 0;
                    percipiitvenda = 0;
                    vlripiitvenda = 0;
                    vlrbaseipiitvenda = 0;
                end
                else if ( tipofisc = 'TT') then -- Tributado integralmente o icms
                begin

                    vlrbaseicmsitvenda = vlrliqitvenda;
                    vlrbaseicmsfreteitvenda = vlritfrete;

                    if(percred>0) then
                    begin
                        if(:tpredicms='B') then
                        begin
                            --Se deve reduzir a base do icms do frete...

                            if(:redbasefrete='S' and vlritfrete>0) then
                            begin
                                vlrbaseicmsfreteitvenda = vlritfrete - ( vlritfrete *(percred/100) );
                                vlricmsfreteitvenda = vlrbaseicmsfreteitvenda*(percicmsitvenda/100);
                            end
                            else
                            begin
                                vlrbaseicmsfreteitvenda = vlritfrete;
                            end

                            --vlrbaseicmsitvenda = vlrliqitvenda - (vlrproditvenda*(percred/100));
                            -- Revisao 12/07/2010 - Robson Sanchez
                            -- Foram separados os calculos de ICMS do frete e da venda.
                            -- Em virtude disso a formacao da base de calculo nao pode ser sobre o valor liquido,
                            -- pois o valor liquido pode conter valor adicional de frete, causando duplicacao de impostos.

                            vlrbaseicmsitvenda = (vlrproditvenda + vlripiitvenda - vlrdescitvenda)*(1-(percred/100));

                            vlricmsitvenda = vlrbaseicmsitvenda*(percicmsitvenda/100);

                        end
                        else if(:tpredicms='V') then
                        begin
                            vlricmsitvenda = ( vlrbaseicmsitvenda*(percicmsitvenda/100) );
                            vlricmsitvenda = vlricmsitvenda - ( vlricmsitvenda * (percred/100) );

                            vlricmsfreteitvenda = vlrbaseicmsfreteitvenda*(percicmsitvenda/100);
                            vlricmsfreteitvenda = vlricmsfreteitvenda - ( vlricmsfreteitvenda * (percred/100) );

                        end
                    end
                    else
                    begin
                        vlricmsitvenda = vlrbaseicmsitvenda*(percicmsitvenda/100);
                        vlricmsfreteitvenda = vlrbaseicmsfreteitvenda*(percicmsitvenda/100);
                    end

                    vlrbaseipiitvenda = vlrliqitvenda;
                    vlripiitvenda = vlrbaseipiitvenda*(percipiitvenda/100);

                end

                -- atualizando tabela de ítens
                update vditvenda set
                vlrbaseicmsitvenda = :vlrbaseicmsitvenda, vlrbaseipiitvenda = :vlrbaseipiitvenda,
                vlricmsitvenda = :vlricmsitvenda, vlripiitvenda = :vlripiitvenda,
                vlrdescitvenda = :vlrdescitvenda, vlrliqitvenda = :vlrliqitvenda,
                vlrfreteitvenda = :vlritfrete
                where
                codemp=new.codemp and codfilial=new.codfilial and codvenda=new.codvenda and
                coditvenda=:icoditvenda and tipovenda=new.tipovenda;

                -- Atualizando tabela de tributos referente ao frete
                if(new.vlrfretevenda != old.vlrfretevenda) then
                begin
                    update lfitvenda set
                    vlrbaseicmsfreteitvenda = :vlrbaseicmsfreteitvenda,
                    vlricmsfreteitvenda = :vlricmsfreteitvenda
                    where
                    codemp=new.codemp and codfilial=new.codfilial and codvenda=new.codvenda and
                    coditvenda=:icoditvenda and tipovenda=new.tipovenda;
                end

            end
        end


    -- Busca informações do tipo de movimento da venda
    select tipomov, vlrmfintipomov
    from eqtipomov
    where codtipomov=new.codtipomov and codemp=new.codemptm and codfilial=new.codfilialtm
    into tipomov, vlrmfintipomov;

    -- Busca informações do contas a receber da venda
    select codrec
    from fnreceber
    where codvenda=new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilialva=new.codfilial
    into icodrec;

    -- Verifica de
    if ((not tipomov in ('DV','TR')) and ((icodrec is null) or ((new.codplanopag != old.codplanopag) or
        (new.codcli != old.codcli) or (new.codvend != old.codvend) or (new.vlrliqvenda != old.vlrliqvenda) or
        (new.dtemitvenda != old.dtemitvenda) or (new.docvenda != old.docvenda) or (new.codbanco != old.codbanco)))) then

    begin

        if(gerarecemis = 'S') then
        begin
            dtrec = new.dtemitvenda;
        end
        else
        begin
            dtrec = new.dtsaidavenda;
        end


        -- Verica se deve haver retensão de ISS

        select sum(coalesce(iv.vlrissitvenda,0))
        from vditvenda iv left outer join lfitclfiscal cf on
        cf.codemp=iv.codempif and cf.codfilial=iv.codfilialif and cf.codfisc=iv.codfisc and cf.coditfisc=iv.coditfisc and cf.retensaoiss='S'
        where iv.codemp=new.codemp and iv.codfilial=new.codfilial and iv.codvenda=new.codvenda and iv.tipovenda=new.tipovenda
        and iv.vlrissitvenda>0
        into :vlrretensaoiss;

        if(:vlrretensaoiss is null) then
        begin
            vlrretensaoiss = 0;
        end

        -- De pedido para Venda
        if ((substr(old.statusvenda,1,1) = 'P') and (substr(new.statusvenda,1,1) = 'V' ) or
        ( (not new.vlrcomisvenda=old.vlrcomisvenda ) and (not new.statusvenda in ('P1','V1') ) ) ) then

        begin
           if (new.vlrliqvenda > 0) then
           begin

              execute procedure fnadicrecebersp01(
                   new.tipovenda, new.codvenda,
                   new.codemptc, new.codfilialtc, new.codtipocob,
                   new.codemppg,new.codfilialpg,new.codplanopag,
                   new.codempcl,new.codfilialcl,new.codcli,
                   new.codempvd,new.codfilialvd,new.codvend,
                   new.vlrliqvenda,dtrec, new.dtcompvenda, new.vlrcomisvenda,new.docvenda,
                   new.codempbo,new.codfilialbo,new.codbanco,
                   new.codemp,new.codfilial,
                   new.codempcb, new.codfilialcb, new.codcartcob, new.flag, new.obsrec, new.vlrbasecomis, :vlrretensaoiss);
           end
           else
           begin
               delete from fnreceber where codvenda = new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilialva = new.codfilial;
           end
        end
        -- De pedido ou venda aberto mudou para finalizado
        if ((new.statusvenda in ('P2','V2')) and (old.statusvenda in ('P1','V1'))) then
        begin
           if (new.vlrliqvenda > 0) then
               execute procedure fnadicrecebersp01(
                   new.tipovenda, new.codvenda,
                   new.codemptc, new.codfilialtc, new.codtipocob,
                   new.codemppg,new.codfilialpg,new.codplanopag,
                   new.codempcl,new.codfilialcl,new.codcli,
                   new.codempvd,new.codfilialvd,new.codvend,
                   new.vlrliqvenda,new.dtsaidavenda, new.dtcompvenda, new.vlrcomisvenda,new.docvenda,
                   new.codempbo,new.codfilialbo,new.codbanco,
                   new.codemp,new.codfilial,
                   new.codempcb, new.codfilialcb, new.codcartcob, new.flag, new.obsrec, new.vlrbasecomis, :vlrretensaoiss);
           else
           begin
               delete from fnreceber where codvenda = new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilialva = new.codfilial;
           end
        end
        -- De pedido fechado para venda fechada ou venda fechada para pedido fechado, ou sem alteração (em processo de fechamento)
        else if ((new.statusvenda in ('P2','V2')) and (old.statusvenda in ('P2','V2'))) then
        begin
           if (new.vlrliqvenda > 0) then
               execute procedure fnadicrecebersp01(
                   new.tipovenda, new.codvenda,
                   new.codemptc, new.codfilialtc, new.codtipocob,
                   new.codemppg,new.codfilialpg,new.codplanopag,
                   new.codempcl,new.codfilialcl,new.codcli,
                   new.codempvd,new.codfilialvd,new.codvend,
                   new.vlrliqvenda,new.dtsaidavenda, new.dtcompvenda, new.vlrcomisvenda,new.docvenda,
                   new.codempbo,new.codfilialbo,new.codbanco,
                   new.codemp,new.codfilial,
                   new.codempcb, new.codfilialcb, new.codcartcob, new.flag, new.obsrec, new.vlrbasecomis, :vlrretensaoiss);
           else
           begin
                delete from fnreceber where codvenda = new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilialva = new.codfilial;
           end
        end
        -- De pedido emitido para venda emitida ou venda emitida para pedido emitido, ou sem alteração
        else if ((new.statusvenda in ('P3','V3')) and (old.statusvenda in ('P3','V3'))) then
        begin
           if (new.vlrliqvenda > 0) then
               execute procedure fnadicrecebersp01(
                   new.tipovenda, new.codvenda,
                   new.codemptc, new.codfilialtc, new.codtipocob,
                   new.codemppg,new.codfilialpg,new.codplanopag,
                   new.codempcl,new.codfilialcl,new.codcli,
                   new.codempvd,new.codfilialvd,new.codvend,
                   new.vlrliqvenda,new.dtsaidavenda, new.dtcompvenda, new.vlrcomisvenda,new.docvenda,
                   new.codempbo,new.codfilialbo,new.codbanco,
                   new.codemp,new.codfilial,
                   new.codempcb, new.codfilialcb, new.codcartcob,
                   new.flag, new.obsrec, new.vlrbasecomis, :vlrretensaoiss);
           else
           begin
               delete from fnreceber where codvenda = new.codvenda and tipovenda=new.tipovenda and codemp=new.codemp and codfilialva = new.codfilial;
           end
        end
      end
      if (old.vlrcomisvenda != new.vlrcomisvenda) then
      begin
          update fnreceber set vlrcomirec=new.vlrcomisvenda
          where codvenda=new.codvenda and tipovenda=new.tipovenda and codempvd=new.codemp and
                codfilialvd=new.codfilial;
      end
      else if (old.codclcomis != new.codclcomis) then
      begin
          select r.codfilial,r.codrec,r.vlrparcrec,r.vlrcomirec,r.nroparcrec
              from fnreceber r
              where r.codvenda=new.codvenda and r.tipovenda=new.tipovenda
              and r.codempva=new.codemp and r.codfilialva=new.codfilial
              into :scodfilialrc, :icodrec, :nvlrparcrec, :nvlrcomirec, :snroparcrec;
          execute procedure fnitrecebersp01(new.codemp,:scodfilialrc,:icodrec,
                :nvlrparcrec,:nvlrcomirec,:snroparcrec,'S');
      end

      /**
        testa valor das parcelas x valor da venda
      **/
      if ((old.statusvenda in ('P2','V2')) and (new.statusvenda in ('P3','V3')) and (vlrmfintipomov<>'S') ) then
      begin
        select vlrparcrec from fnreceber
            where codvenda=new.codvenda and tipovenda=new.tipovenda
            and codempva=new.codemp and codfilialva = new.codfilial
            into :nvlrparcrec;

       if (new.vlrliqvenda-:vlrretensaoiss != :nvlrparcrec) then
        begin
            exception vdvendaex06;
        end

      end

      -- Caso a data ou o tipo de movimento tenham sido alterados, deve disparar o trigger da vditvenda
    if ( (new.dtsaidavenda != old.dtsaidavenda) or (new.codtipomov!=old.codtipomov) or ( new.docvenda != old.docvenda )  ) then
    begin
        -- Update necessário para disparar o trigger da tabela vditvenda
        update vditvenda set coditvenda=coditvenda
        where codvenda = old.codvenda and tipovenda = old.tipovenda and codemp=old.codemp and codfilial=old.codfilial;
    end
    else if ((substr(new.statusvenda,1,1)='C') and (substr(old.statusvenda,1,1) in ('P','V'))) then
    begin

        update vditvenda set qtditvendacanc=qtditvenda, qtditvenda=0 where codvenda=new.codvenda and tipovenda=new.tipovenda and
        codemp=new.codemp and codfilial=new.codfilial;

        delete from fnreceber where codvenda=new.codvenda and tipovenda=new.tipovenda and
        codemp=new.codemp and codfilialva=new.codfilial;

        delete from vdvendaorc where codemp=new.codemp and codfilial=new.codfilial and
        codvenda=new.codvenda and tipovenda=new.tipovenda;

      end
   end
end
^

/* Alter exist trigger... */
ALTER TRIGGER VDVENDATGBI
AS
  DECLARE VARIABLE sTipoMov CHAR(2);
BEGIN
  EXECUTE PROCEDURE VDCLIENTEATIVOSP(new.CODEMPCL, new.CODFILIALCL, new.CODCLI);
/*  EXECUTE PROCEDURE FNLIBCREDSP(new.CODVENDA,new.CODCLI,new.CODEMPCL,new.CODFILIALCL,null); */
  IF (new.VLRPRODVENDA IS NULL) THEN new.VLRPRODVENDA = 0;
  IF (new.VLRDESCVENDA IS NULL) THEN new.VLRDESCVENDA = 0;
  IF (new.VLRDESCITVENDA IS NULL) THEN new.VLRDESCITVENDA = 0;
  IF (new.VLRVENDA IS NULL) THEN new.VLRVENDA = 0;
  IF (new.VLRBASEICMSVENDA IS NULL) THEN new.VLRBASEICMSVENDA = 0;
  IF (new.VLRICMSVENDA IS NULL) THEN new.VLRICMSVENDA = 0;
  IF (new.VLRPISVENDA IS NULL) THEN new.VLRPISVENDA = 0;
  IF (new.VLRIRVENDA IS NULL) THEN new.VLRIRVENDA = 0;
  IF (new.VLRCSOCIALVENDA IS NULL) THEN new.VLRCSOCIALVENDA = 0;
  IF (new.VLRISENTASVENDA IS NULL) THEN new.VLRISENTASVENDA = 0;
  IF (new.VLROUTRASVENDA IS NULL) THEN new.VLROUTRASVENDA = 0;
  IF (new.VLRBASEIPIVENDA IS NULL) THEN new.VLRBASEIPIVENDA = 0;
  IF (new.VLRIPIVENDA IS NULL) THEN new.VLRIPIVENDA = 0;
  IF (new.VLRLIQVENDA IS NULL) THEN new.VLRLIQVENDA = 0;
  IF (new.VLRCOMISVENDA IS NULL) THEN new.VLRCOMISVENDA = 0;
  IF (new.VLRFRETEVENDA IS NULL) THEN new.VLRFRETEVENDA = 0;
  IF (new.VLRADICVENDA IS NULL) THEN new.VLRADICVENDA = 0;
  IF (new.TIPOVENDA IS NULL) THEN new.TIPOVENDA = 'V';
  IF (new.VLRBASEISSVENDA IS NULL) THEN new.VLRBASEISSVENDA = 0;
  IF (new.VLRISSVENDA IS NULL) THEN new.VLRISSVENDA = 0;
  IF (new.VLRPISVENDA IS NULL) THEN new.VLRPISVENDA = 0;
  IF (new.VLRIRVENDA IS NULL) THEN new.VLRIRVENDA = 0;
  IF (new.VLRCSOCIALVENDA IS NULL) THEN new.VLRCSOCIALVENDA = 0;
  IF (new.vlrbasepisvenda IS NULL) THEN new.vlrbasepisvenda = 0;
  IF (new.vlrbasecofinsvenda IS NULL) THEN new.vlrbasecofinsvenda = 0;
  IF (new.vlrpisvenda IS NULL) THEN new.vlrpisvenda = 0;
  IF (new.vlrcofinsvenda IS NULL) THEN new.vlrcofinsvenda = 0;
  IF (new.vlrbasecomis IS NULL) THEN new.vlrbasecomis = 0;
  if (new.sitdoc is null) then new.sitdoc='00';
  if (new.dtcompvenda is null) then new.dtcompvenda=new.dtemitvenda;

  IF (new.CODCAIXA IS NULL) THEN
    SELECT CODTERM FROM SGRETCAIXA INTO new.CODCAIXA;
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'PVCAIXA') INTO new.CODFILIALCX;
  new.CODEMPCX = new.CODEMP;
  IF (NOT new.tipovenda = 'E') THEN -- Se for ECF não precisa buscar o DOC, porque o DOC é o numero do cupom.
      SELECT DOC FROM LFNOVODOCSP(new.Serie,new.CODEMPSE,new.CODFILIALSE) INTO new.DocVenda;
  SELECT TIPOMOV,FISCALTIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIALTM INTO sTipoMov,new.FLAG;
  IF ( new.FLAG <> 'S') THEN
  BEGIN
     new.FLAG = 'N';
  END
  if ((new.STATUSVENDA is null) OR (RTRIM(new.STATUSVENDA) = '*')) then
  BEGIN
     IF (sTipoMov = 'VD') THEN new.STATUSVENDA = 'V1';
     ELSE new.STATUSVENDA = 'P1';
  END
END
^

/* Alter exist trigger... */
ALTER TRIGGER VDVENDATGBU
AS
  DECLARE VARIABLE ICODFILIAL INTEGER;
  DECLARE VARIABLE ICODITVENDA INTEGER;
  DECLARE VARIABLE iCodTipoMov INTEGER;
  DECLARE VARIABLE sSerie CHAR(4);
  DECLARE VARIABLE credicmssimples CHAR(1);
  DECLARE VARIABLE iCodFilialPref smallint;
  DECLARE VARIABLE dDesc NUMERIC(15, 5);
  DECLARE VARIABLE PERCPISFILIAL NUMERIC(9,2);
  DECLARE VARIABLE PERCCOFINSFILIAL NUMERIC(9,2);
  DECLARE VARIABLE PERCIRFILIAL NUMERIC(9,2);
  DECLARE VARIABLE PERCCSOCIALFILIAL NUMERIC(9,2);
  DECLARE VARIABLE PERCSIMPLESFILIAL NUMERIC(9,2);
  DECLARE VARIABLE VLRPRODITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE QTDITVENDA NUMERIC(9,2);
  DECLARE VARIABLE VLRCOMISITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE VLRDESCITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE PERCCOMISITVENDA NUMERIC(9,2);
  DECLARE VARIABLE SIMPLESFILIAL CHAR(1);
  DECLARE VARIABLE SIMPLESCLI CHAR(1);
  DECLARE VARIABLE PESSOACLI CHAR(1);          
  DECLARE VARIABLE NVLRFRETE NUMERIC(15,5);
  DECLARE VARIABLE CADICFRETEVD CHAR(1);
  DECLARE VARIABLE PERCIT NUMERIC(9,2);
  DECLARE VARIABLE RETENSAOIMP CHAR(1);

BEGIN

  retensaoimp = 'N';

  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  if (new.BLOQVENDA IS NULL) then
     new.BLOQVENDA='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      if ( ( (old.BLOQVENDA IS  NULL) OR (old.BLOQVENDA='N') ) AND (new.BLOQVENDA='S') )  then
      begin
          new.DTALT=cast('now' AS DATE);
          new.IDUSUALT=user;
          new.HALT=cast('now' AS TIME);
      end
      IF ( (new.DTCOMPVENDA is null) or (old.DTEMITVENDA<>new.DTEMITVENDA)  ) THEN
         new.DTCOMPVENDA=new.DTEMITVENDA;

      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP, 'SGPREFERE1') INTO iCodFilialPref;
      EXECUTE PROCEDURE VDCLIENTEATIVOSP(new.CODEMPCL, new.CODFILIALCL, new.CODCLI);

      if ( (old.BLOQVENDA IS NOT NULL AND old.BLOQVENDA='S') or (new.BLOQVENDA='S') and old.chavenfevenda=new.chavenfevenda) then
         EXCEPTION VDVENDAEX05 'ESTA VENDA ESTÁ BLOQUEADA!!!';


      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=user;
      new.HALT=cast('now' AS TIME);
      SELECT CODFILIALSEL FROM SGCONEXAO WHERE NRCONEXAO=CURRENT_CONNECTION AND
          CONECTADO > 0 INTO ICODFILIAL;
      IF (substr(old.STATUSVENDA,1,1) = 'C' and old.chavenfevenda=new.chavenfevenda ) THEN
        EXCEPTION VDVENDAEX05;
      IF (substr(old.STATUSVENDA,1,1) = 'D' and old.chavenfevenda=new.chavenfevenda) THEN
        EXCEPTION VDVENDAEX05 'ESTA VENDA FOI DEVOLVIDA!';
      IF ((SUBSTR(old.STATUSVENDA,1,1) = 'P') AND (SUBSTR(new.STATUSVENDA,1,1) = 'V' ) AND new.IMPNOTAVENDA = 'N') THEN
      BEGIN
        SELECT T2.CODTIPOMOV, T2.SERIE FROM EQTIPOMOV T2, EQTIPOMOV T WHERE T2.CODEMP=T.CODEMPTM
               AND T2.CODFILIAL=T.CODFILIALTM AND T2.CODTIPOMOV = T.CODTIPOMOVTM
               AND T.CODEMP=new.CODEMPTM AND T.CODFILIAL=new.CODFILIALTM AND T.CODTIPOMOV=new.CODTIPOMOV
               INTO :iCodTipoMov, :sSerie;
        IF (iCodTipoMov IS NULL) THEN
          SELECT T.CODTIPOMOV, T.SERIE FROM SGPREFERE1 P, EQTIPOMOV T WHERE P.CODEMPTM=T.CODEMP AND
                 P.CODFILIALTM=T.CODFILIAL AND P.CODTIPOMOV = T.CODTIPOMOV
                 AND P.CODEMP=new.CODEMP AND P.CODFILIAL = :iCodFilialPref INTO :iCodTipoMov, :sSerie;
        new.CODTIPOMOV = :iCodTipoMov;
        new.SERIE = :sSerie;
        IF ( ( not (old.IMPNOTAVENDA = 'S') ) AND ( not (new.IMPNOTAVENDA = 'S') ) ) THEN
        BEGIN
            SELECT DOC FROM LFNOVODOCSP(new.Serie,new.CODEMPSE,new.CODFILIALSE) INTO new.DocVenda;
            new.IMPNOTAVENDA = 'S';
        END
      END
      SELECT FISCALTIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
             AND CODEMP=new.CODEMP AND CODFILIAL = new.codfilialtm INTO new.FLAG;
      IF (new.FLAG<>'S') THEN
        new.FLAG = 'N';
      SELECT VLRFRETEVD, ADICFRETEVD FROM VDFRETEVD WHERE CODVENDA=old.CODVENDA AND TIPOVENDA=old.TIPOVENDA AND ADICFRETEVD = 'S'
             AND CODEMP=old.CODEMP AND CODFILIAL = old.codfilial INTO new.VLRFRETEVENDA, :CADICFRETEVD;
      IF (new.VLRDESCVENDA IS NULL) THEN
        new.VLRDESCVENDA = 0;
      IF (new.VLRDESCITVENDA IS NULL) THEN
        new.VLRDESCITVENDA = 0;
      IF (new.VLRADICVENDA IS NULL) THEN
        new.VLRADICVENDA = 0;
      IF (new.VLRFRETEVENDA IS NULL) THEN
        new.VLRFRETEVENDA = 0;
      IF (new.VLRPRODVENDA IS NULL) THEN
        new.VLRPRODVENDA = 0;
      IF (new.VLRIPIVENDA IS NULL) THEN
        new.VLRIPIVENDA = 0;
      IF (new.VLRBASEICMSVENDA IS NULL) THEN
        new.VLRBASEICMSVENDA = 0;
      IF (new.VLRDESCITVENDA > 0) THEN
        dDesc = new.VLRDESCITVENDA;
      ELSE
        dDesc = new.VLRDESCVENDA;
      IF (new.VLRBASEICMSSTVENDA IS NULL) THEN
        new.VLRBASEICMSSTVENDA = 0;
      IF (new.VLRICMSSTVENDA IS NULL) THEN
        new.VLRICMSSTVENDA = 0;

      SELECT C.SIMPLESCLI,C.PESSOACLI FROM VDCLIENTE C WHERE C.CODCLI=new.CODCLI AND
        C.CODFILIAL=new.CODFILIALCL AND C.CODEMP=new.CODEMPCL INTO SIMPLESCLI,PESSOACLI;
      SELECT SIMPLESFILIAL,PERCPISFILIAL,PERCCOFINSFILIAL,PERCIRFILIAL,PERCCSOCIALFILIAL,coalesce(PERCSIMPLESFILIAL,0)
        FROM SGFILIAL WHERE CODEMP=new.CODEMP AND CODFILIAL=:ICODFILIAL
        INTO SIMPLESFILIAL,PERCPISFILIAL,PERCCOFINSFILIAL,PERCIRFILIAL,PERCCSOCIALFILIAL,PERCSIMPLESFILIAL;
      IF (SIMPLESFILIAL = 'N') THEN
      BEGIN
        new.VLRIRVENDA = (new.vlrliqvenda/100)*PERCIRFILIAL;
        new.VLRCSOCIALVENDA = (new.vlrliqvenda/100)*PERCCSOCIALFILIAL;
      END
      ELSE
      BEGIN
        new.VLRIRVENDA = 0;
        new.VLRCSOCIALVENDA = 0;

        /*Verifica se deve destacar crédito de icms (simples)*/
        select p1.credicmssimples,p1.retensaoimp from sgprefere1 p1 where p1.codemp=new.codemp and p1.codfilial=:icodfilialpref
        into credicmssimples,retensaoimp;

        if(credicmssimples='S') then
        begin
            new.vlricmssimples = (new.vlrprodvenda/100) * percsimplesfilial ;
            new.percicmssimples = percsimplesfilial;
        end

      END
      if (CADICFRETEVD = 'S') then
         NVLRFRETE = new.VLRFRETEVENDA;
      else
         NVLRFRETE = 0;

      new.VLRLIQVENDA = coalesce(new.VLRPRODVENDA,0)
                      - coalesce(dDesc,0)
                      + coalesce(new.VLRADICVENDA,0)
                      + coalesce(:NVLRFRETE,0)
                      + coalesce(new.VLRIPIVENDA,0)
                      + coalesce(new.vlricmsstvenda,0);

      if (SIMPLESCLI = 'N' AND PESSOACLI = 'J' AND RETENSAOIMP = 'S') then
      begin
        new.VLRLIQVENDA =
             cast(
                (coalesce(new.VLRLIQVENDA,0)) -
                (case when new.calcpisvenda='S' then coalesce(new.vlrpisvenda,0) else 0 end) -
                (case when new.calccofinsvenda='S' then coalesce(new.vlrcofinsvenda,0) else 0 end) -
                (case when new.calcirvenda='S' then coalesce(new.vlrirvenda,0) else 0 end) -
                (case when new.calccsocialvenda='S' then coalesce(new.vlrcsocialvenda,0) else 0 end)
            as numeric(15, 5));
      end

      IF ((substr(old.STATUSVENDA,1,1) IN ('P','V')) AND (substr(new.STATUSVENDA,1,1)='C')) THEN
      BEGIN
          new.VLRDESCITVENDA = 0;
          new.VLRPRODVENDA = 0;
          new.VLRBASEICMSVENDA = 0;
          new.VLRICMSVENDA = 0;
          new.VLRISENTASVENDA = 0;
          new.VLROUTRASVENDA = 0;
          new.VLRBASEIPIVENDA = 0;
          new.VLRIPIVENDA = 0;
          new.VLRLIQVENDA = 0;
          new.VLRCOMISVENDA = 0;
          new.VLRISSVENDA = 0;
          new.VLRBASEISSVENDA = 0;
          new.vlrpisvenda = 0;
          new.vlrcofinsvenda = 0;
          new.vlrirvenda = 0;
          new.vlrcsocialvenda =0;
          new.vlrbaseicmsstvenda=0;
          new.vlricmsstvenda=0;
      END
    /**
       COMISSAO
    **/
      IF ((NOT NEW.VLRCOMISVENDA IS NULL) AND
          (NEW.VLRLIQVENDA > 0) AND
          ((NOT NEW.VLRDESCVENDA = OLD.VLRDESCVENDA) OR (NOT NEW.PERCMCOMISVENDA = OLD.PERCMCOMISVENDA))) then
      BEGIN
        /* Distribuindo a comissao: */
        FOR SELECT CODITVENDA,VLRPRODITVENDA,QTDITVENDA,coalesce(VLRCOMISITVENDA,0),coalesce(vlrdescitvenda,0),
            coalesce(iv.perccomisitvenda,0)
            FROM VDITVENDA IV
            WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND CODVENDA=new.CODVENDA and tipovenda=new.tipovenda
            INTO ICODITVENDA,VLRPRODITVENDA,QTDITVENDA,VLRCOMISITVENDA,VLRDESCITVENDA,PERCCOMISITVENDA DO
        BEGIN
          /* Calculo do item.: */
          /* INCLUIDO PARA DISTRIBUIR A COMISSAO MENOS O DESCONTO PROPORCIONALMENTE*/
          PERCIT = 0;
          IF (new.VLRPRODVENDA > 0 AND NOT new.VLRDESCITVENDA > 0 AND new.VLRDESCVENDA > 0) THEN
          BEGIN
            PERCIT = (100*VLRPRODITVENDA) / new.VLRPRODVENDA;
            VLRDESCITVENDA = (new.VLRDESCVENDA  * PERCIT) / 100;
          END
          IF (new.VLRPRODVENDA > 0 AND new.PERCMCOMISVENDA > 0) THEN
          BEGIN
            PERCCOMISITVENDA = new.PERCMCOMISVENDA;
            /* Retira.. */
            new.VLRCOMISVENDA = new.VLRCOMISVENDA - VLRCOMISITVENDA;
            /* Atualiza.. */
            VLRCOMISITVENDA = ((VLRPRODITVENDA - VLRDESCITVENDA) * PERCCOMISITVENDA) / 100;
            /* Adiciona.. */
            new.VLRCOMISVENDA = new.VLRCOMISVENDA + VLRCOMISITVENDA;
          END
          ELSE IF (new.PERCMCOMISVENDA=0) then
          BEGIN
              VLRCOMISITVENDA = 0;
              PERCCOMISITVENDA = 0;
              new.VLRCOMISVENDA = 0;
          END
          UPDATE VDITVENDA SET VLRCOMISITVENDA=:VLRCOMISITVENDA,PERCCOMISITVENDA=:PERCCOMISITVENDA
          WHERE CODITVENDA=:ICODITVENDA AND CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
        END
      END
      /* Calcula o percentual medio da comissao */
      ELSE IF (new.PERCMCOMISVENDA = old.PERCMCOMISVENDA AND new.VLRLIQVENDA > 0) THEN
      begin
         -- new.PERCMCOMISVENDA = (new.VLRCOMISVENDA/new.VLRLIQVENDA)*100.000;
         -- Modificado, pois causava divergencia em vendas geradas a partir de orçamentos.
          new.PERCMCOMISVENDA = (new.VLRCOMISVENDA/(new.vlrprodvenda-new.vlrdescvenda)) * 100;
      end

      IF (new.STATUSVENDA = 'V4') THEN
      BEGIN
        new.IMPNOTAVENDA = 'S';
        new.STATUSVENDA = 'V3';
      END
      IF ((new.IMPNOTAVENDA = 'S') AND (old.IMPNOTAVENDA = 'S')) THEN
      BEGIN
        new.DOCVENDA = old.DOCVENDA;
      END
  END

  -- Atualizando o status do documento fiscal para 02 - Documento cancelado, quando nota for cancelado pelo sistema.
  IF (substr(new.STATUSVENDA,1,1) = 'C' and new.sitdoc!='02') THEN
  begin
    new.sitdoc = '02';
  end

  if(old.chavenfevenda is null and new.chavenfevenda is not null) then
  begin
    new.emmanut = 'N';
  end


END
^

/* Alter Procedure... */
/* Alter (CPADICITCOMPRARECMERCSP) */
ALTER PROCEDURE CPADICITCOMPRARECMERCSP(CODEMP INTEGER,
CODFILIAL SMALLINT,
TICKET INTEGER,
CODEMPCP INTEGER,
CODFILIALCP SMALLINT,
CODCOMPRA INTEGER,
QTDITCOMPRA NUMERIC(15,5))
 AS
declare variable usaprecocot char(1);
declare variable codemppd integer;
declare variable codfilialpd integer;
declare variable codprod integer;
declare variable codprodant integer;
declare variable coditrecmerc integer;
declare variable codnat char(4);
declare variable codfilialtm smallint;
declare variable codtipomov integer;
declare variable codempfr integer;
declare variable codfilialfr smallint;
declare variable codfor integer;
declare variable codempax integer;
declare variable codfilialax smallint;
declare variable codalmox integer;
declare variable precoitcompra numeric(15,5);
declare variable aprovpreco char(1);
declare variable codemppp integer;
declare variable codfilialpp smallint;
declare variable codplanopag integer;
declare variable vlrproditcompra numeric(15,5);
begin
    
    -- Carregamdo variaveis
    aprovpreco = 'N';

    -- Buscando preferências
    select coalesce(p1.usaprecocot,'N') usaprecocot
    from sgprefere1 p1
    where p1.codemp=:codemp and p1.codfilial=:codfilial
    into :usaprecocot;

    -- Buscando informações da compra
    select cp.codfilialtm, cp.codtipomov,
    cp.codempfr, cp.codfilialfr, cp.codfor,
    cp.codemppg, cp.codfilialpg, cp.codplanopag
    from cpcompra cp
    where cp.codemp=:codempcp and cp.codfilial=:codfilialcp and cp.codcompra=:codcompra
    into :codfilialtm,  :codtipomov, :codempfr, :codfilialfr, :codfor, :codemppp, :codfilialpp, :codplanopag;

    for select ir.codemppd, ir.codfilialpd, ir.codprod, ir.coditrecmerc
        from eqitrecmerc ir
        where
        ir.codemp=:codemp and ir.codfilial=:codfilial and ir.ticket=:ticket
        into :codemppd, :codfilialpd, :codprod, :coditrecmerc
        do
        begin

            if(:codprod <> :codprodant or :codprodant is null) then
            begin

                -- Buscando a natureza da operação
                select codnat from lfbuscanatsp(:codfilial,:codemp,:codfilialpd,:codprod,:codemp,null,null,
                :codempfr,:codfilialfr,:codfor,:codfilialtm,:codtipomov,null)
                into :codnat;

                -- Buscando informações do produto
                select pd.codempax, pd.codfilialax, pd.codalmox from eqproduto pd
                where pd.codemp=:codemppd and pd.codfilial=:codfilialpd and pd.codprod=:codprod
                into :codempax, :codfilialax, :codalmox;

                -- Buscando preço da ultima compra
--                select custounit from eqcustoprodsp(:codemppd, :codfilialpd, :codprod,
--                cast('today' as date),'U',:codempax, :codfilialax, :codalmox,'N')
--                into :precoultcp;

                -- Se deve buscar preço de cotação.
                if( 'S' = :usaprecocot) then
                begin
                    -- Deve implementar ipi, vlrliq etc... futuramente...
                    select first 1 ct.precocot
                    from cpcotacao ct, cpsolicitacao sl, cpitsolicitacao iso
                    left outer join eqrecmerc rm on
                    rm.codemp=:codemp and rm.codfilial=:codfilial and rm.ticket=:ticket
                    where
                    iso.codemp = sl.codemp and iso.codfilial=sl.codfilial and iso.codsol=sl.codsol
                    and ct.codemp=iso.codemp and ct.codfilial=iso.codfilial and ct.codsol=iso.codsol and ct.coditsol=iso.coditsol
                    and iso.codemppd=:codemppd and iso.codfilialpd=:codfilialpd and iso.codprod=:codprod
                    and ct.codempfr=:codempfr and ct.codfilialfr=:codfilialfr and ct.codfor=:codfor
                    and (ct.dtvalidcot>=cast('today' as date) and (ct.dtcot<=cast('today' as date)))
                    and ct.sititsol not in ('EF','CA')

                    and ( (ct.rendacot = rm.rendaamostragem) or ( coalesce(ct.usarendacot,'N') = 'N') )

                    and ( (ct.codemppp=:codemppp and ct.codfilialpp=:codfilialpp and ct.codplanopag=:codplanopag)
                       or (ct.codplanopag is null))

                    order by ct.dtcot desc
                    into :precoitcompra;

                    if(:precoitcompra is not null) then
                    begin
                        -- Indica que o preço é aprovado (cotado anteriormente);
                        aprovpreco = 'S';
                    end

                end

                -- Se não conseguiu obter o preço das cotações
                if(precoitcompra is null) then
                begin
                    -- Buscando preço de compra da tabela de custos de produtos
                    select custounit from eqcustoprodsp(:codemppd, :codfilialpd, :codprod,
                    cast('today' as date),'M',:codempax, :codfilialax, :codalmox,'N')
                    into :precoitcompra;

                end

                vlrproditcompra = :precoitcompra * qtditcompra;


                -- Inserir itens
                insert into cpitcompra (
                codemp, codfilial, codcompra, coditcompra,
                codemppd, codfilialpd, codprod,
                codempnt, codfilialnt, codnat,
                codempax, codfilialax, codalmox,
                qtditcompra, precoitcompra, aprovpreco, vlrproditcompra)
                values (:codempcp, :codfilialcp, :codcompra, :coditrecmerc,
                :codemppd, :codfilialpd, :codprod,
                :codemp,:codfilial,:codnat,
                :codempax,:codfilialax,:codalmox,
                :qtditcompra, :precoitcompra, :aprovpreco, :vlrproditcompra) ;

                -- Inserindo vínculo entre compra e recebimento

                insert into eqitrecmercitcp(codemp, codfilial, ticket, coditrecmerc, codempcp, codfilialcp, codcompra, coditcompra)
                values(:codemp,:codfilial,:ticket,:coditrecmerc,:codempcp,:codfilialcp,:codcompra,:coditrecmerc);

                codprodant = codprod;

            end
        end



  --  suspend;
end
^

/* Alter (FNITRECEBERSP01) */
ALTER PROCEDURE FNITRECEBERSP01(ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
NVLRPARCREC NUMERIC(15,5),
NVLRCOMIREC NUMERIC(15,5),
INROPARCREC INTEGER,
CCLASCOMIS CHAR)
 AS
declare variable inparcitrec integer;
declare variable nvlrparcitrec numeric(15,5);
declare variable nperc numeric(10,6);
declare variable nvlrcomiitrec numeric(15,5);
declare variable nresto numeric(15,5);
declare variable dvencitrec date;
begin
    -- Procedure que atualiza a comissão na tabela ITRECEBER
    nResto = nVlrComiRec;

    for select nparcitrec, vlrparcitrec, dtvencitrec from fnitreceber
    where codemp=:icodemp and codfilial=:scodfilial and codrec=:icodrec
    order by nparcitrec
    into :inparcitrec , :nvlrparcitrec, :dvencitrec do

    begin
        nperc = nvlrparcitrec / nvlrparcrec;
        nvlrcomiitrec = cast( (nvlrcomirec * nperc) as numeric(15, 5) );
        nresto = nresto - nvlrcomiitrec;

        if (inparcitrec=inroparcrec) then
        begin
            nvlrcomiitrec = nvlrcomiitrec + nresto;
        end

        update fnitreceber ir set vlrcomiitrec=:nvlrcomiitrec where codemp=:icodemp and codfilial=:scodfilial
        and codrec=:icodrec and nparcitrec=:inparcitrec;

        if (cclascomis='S') then
            execute procedure vdgeracomissaosp(:icodemp, :scodfilial, :icodrec, :inparcitrec, :nvlrcomiitrec, :dvencitrec);
    end
    suspend;
end
^

SET TERM ; ^

UPDATE RDB$PROCEDURE_PARAMETERS SET RDB$DESCRIPTION = 
'Código do item de orçamento'
WHERE RDB$PROCEDURE_NAME = 'PPGERAOP' AND RDB$PARAMETER_NAME = 'CODITORC';

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODATENDO POSITION 3;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODCONV POSITION 4;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODEMPCV POSITION 5;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODFILIALCV POSITION 6;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODEMPTO POSITION 7;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODFILIALTO POSITION 8;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODTPATENDO POSITION 9;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODEMPAE POSITION 10;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODFILIALAE POSITION 11;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODATEND POSITION 12;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODEMPSA POSITION 13;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODFILIALSA POSITION 14;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODSETAT POSITION 15;

ALTER TABLE ATATENDIMENTO ALTER COLUMN DATAATENDO POSITION 16;

ALTER TABLE ATATENDIMENTO ALTER COLUMN HORAATENDO POSITION 17;

ALTER TABLE ATATENDIMENTO ALTER COLUMN DATAATENDOFIN POSITION 18;

ALTER TABLE ATATENDIMENTO ALTER COLUMN HORAATENDOFIN POSITION 19;

ALTER TABLE ATATENDIMENTO ALTER COLUMN OBSATENDO POSITION 20;

ALTER TABLE ATATENDIMENTO ALTER COLUMN OBSINTERNO POSITION 21;

ALTER TABLE ATATENDIMENTO ALTER COLUMN STATUSATENDO POSITION 22;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODEMPCL POSITION 23;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODFILIALCL POSITION 24;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODCLI POSITION 25;

ALTER TABLE ATATENDIMENTO ALTER COLUMN IDUSU POSITION 26;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODEMPUS POSITION 27;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODFILIALUS POSITION 28;

ALTER TABLE ATATENDIMENTO ALTER COLUMN DOCATENDO POSITION 29;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODEMPCT POSITION 30;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODFILIALCT POSITION 31;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODCONTR POSITION 32;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODITCONTR POSITION 33;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODEMPCA POSITION 34;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODFILIALCA POSITION 35;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODCLASATENDO POSITION 36;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODEMPCH POSITION 37;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODFILIALCH POSITION 38;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODCHAMADO POSITION 39;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CONCLUICHAMADO POSITION 40;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODEMPEA POSITION 41;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODFILIALEA POSITION 42;

ALTER TABLE ATATENDIMENTO ALTER COLUMN CODESPEC POSITION 43;

ALTER TABLE ATATENDIMENTO ALTER COLUMN DTINS POSITION 44;

ALTER TABLE ATATENDIMENTO ALTER COLUMN HINS POSITION 45;

ALTER TABLE ATATENDIMENTO ALTER COLUMN IDUSUINS POSITION 46;

ALTER TABLE ATATENDIMENTO ALTER COLUMN DTALT POSITION 47;

ALTER TABLE ATATENDIMENTO ALTER COLUMN HALT POSITION 48;

ALTER TABLE ATATENDIMENTO ALTER COLUMN IDUSUALT POSITION 49;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE CPCOMPRA ALTER COLUMN CODCOMPRA POSITION 3;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPPG POSITION 4;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALPG POSITION 5;

ALTER TABLE CPCOMPRA ALTER COLUMN CODPLANOPAG POSITION 6;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPFR POSITION 7;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALFR POSITION 8;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFOR POSITION 9;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPSE POSITION 10;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALSE POSITION 11;

ALTER TABLE CPCOMPRA ALTER COLUMN SERIE POSITION 12;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPTM POSITION 13;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALTM POSITION 14;

ALTER TABLE CPCOMPRA ALTER COLUMN CODTIPOMOV POSITION 15;

ALTER TABLE CPCOMPRA ALTER COLUMN DOCCOMPRA POSITION 16;

ALTER TABLE CPCOMPRA ALTER COLUMN DTENTCOMPRA POSITION 17;

ALTER TABLE CPCOMPRA ALTER COLUMN DTEMITCOMPRA POSITION 18;

ALTER TABLE CPCOMPRA ALTER COLUMN DTCOMPCOMPRA POSITION 19;

ALTER TABLE CPCOMPRA ALTER COLUMN PERCDESCCOMPRA POSITION 20;

ALTER TABLE CPCOMPRA ALTER COLUMN PERCIPICOMPRA POSITION 21;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRPRODCOMPRA POSITION 22;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRLIQCOMPRA POSITION 23;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRCOMPRA POSITION 24;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRDESCCOMPRA POSITION 25;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRDESCITCOMPRA POSITION 26;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRADICCOMPRA POSITION 27;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEICMSCOMPRA POSITION 28;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEICMSSTCOMPRA POSITION 29;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEIPICOMPRA POSITION 30;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEPISCOMPRA POSITION 31;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASECOFINSCOMPRA POSITION 32;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSCOMPRA POSITION 33;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSSTCOMPRA POSITION 34;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRIPICOMPRA POSITION 35;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRPISCOMPRA POSITION 36;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRCOFINSCOMPRA POSITION 37;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRFUNRURALCOMPRA POSITION 38;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRFRETECOMPRA POSITION 39;

ALTER TABLE CPCOMPRA ALTER COLUMN VLROUTRASCOMPRA POSITION 40;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRISENTASCOMPRA POSITION 41;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPTC POSITION 42;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALTC POSITION 43;

ALTER TABLE CPCOMPRA ALTER COLUMN CODTIPOCOB POSITION 44;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPBO POSITION 45;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALBO POSITION 46;

ALTER TABLE CPCOMPRA ALTER COLUMN CODBANCO POSITION 47;

ALTER TABLE CPCOMPRA ALTER COLUMN IMPNOTACOMPRA POSITION 48;

ALTER TABLE CPCOMPRA ALTER COLUMN BLOQCOMPRA POSITION 49;

ALTER TABLE CPCOMPRA ALTER COLUMN EMMANUT POSITION 50;

ALTER TABLE CPCOMPRA ALTER COLUMN FLAG POSITION 51;

ALTER TABLE CPCOMPRA ALTER COLUMN ADICFRETECOMPRA POSITION 52;

ALTER TABLE CPCOMPRA ALTER COLUMN TIPOFRETECOMPRA POSITION 53;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPSOL POSITION 54;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALSOL POSITION 55;

ALTER TABLE CPCOMPRA ALTER COLUMN CODSOL POSITION 56;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPTN POSITION 57;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALTN POSITION 58;

ALTER TABLE CPCOMPRA ALTER COLUMN CODTRAN POSITION 59;

ALTER TABLE CPCOMPRA ALTER COLUMN OBSERVACAO POSITION 60;

ALTER TABLE CPCOMPRA ALTER COLUMN OBS01 POSITION 61;

ALTER TABLE CPCOMPRA ALTER COLUMN OBS02 POSITION 62;

ALTER TABLE CPCOMPRA ALTER COLUMN OBS03 POSITION 63;

ALTER TABLE CPCOMPRA ALTER COLUMN OBS04 POSITION 64;

ALTER TABLE CPCOMPRA ALTER COLUMN ADICADICCOMPRA POSITION 65;

ALTER TABLE CPCOMPRA ALTER COLUMN QTDFRETECOMPRA POSITION 66;

ALTER TABLE CPCOMPRA ALTER COLUMN ADICFRETEBASEICMS POSITION 67;

ALTER TABLE CPCOMPRA ALTER COLUMN ADICADICBASEICMS POSITION 68;

ALTER TABLE CPCOMPRA ALTER COLUMN ADICIPIBASEICMS POSITION 69;

ALTER TABLE CPCOMPRA ALTER COLUMN CHAVENFECOMPRA POSITION 70;

ALTER TABLE CPCOMPRA ALTER COLUMN STATUSCOMPRA POSITION 71;

ALTER TABLE CPCOMPRA ALTER COLUMN NRODI POSITION 72;

ALTER TABLE CPCOMPRA ALTER COLUMN DTREGDI POSITION 73;

ALTER TABLE CPCOMPRA ALTER COLUMN LOCDESEMBDI POSITION 74;

ALTER TABLE CPCOMPRA ALTER COLUMN SIGLAUFDESEMBDI POSITION 75;

ALTER TABLE CPCOMPRA ALTER COLUMN CODPAISDESEMBDI POSITION 76;

ALTER TABLE CPCOMPRA ALTER COLUMN DTDESEMBDI POSITION 77;

ALTER TABLE CPCOMPRA ALTER COLUMN IDENTCONTAINER POSITION 78;

ALTER TABLE CPCOMPRA ALTER COLUMN CALCTRIB POSITION 79;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPRM POSITION 80;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALRM POSITION 81;

ALTER TABLE CPCOMPRA ALTER COLUMN TICKET POSITION 82;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPCT POSITION 83;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALCT POSITION 84;

ALTER TABLE CPCOMPRA ALTER COLUMN NUMCONTA POSITION 85;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPCC POSITION 86;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALCC POSITION 87;

ALTER TABLE CPCOMPRA ALTER COLUMN ANOCC POSITION 88;

ALTER TABLE CPCOMPRA ALTER COLUMN CODCC POSITION 89;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPPN POSITION 90;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALPN POSITION 91;

ALTER TABLE CPCOMPRA ALTER COLUMN CODPLAN POSITION 92;

ALTER TABLE CPCOMPRA ALTER COLUMN INFCOMPL POSITION 93;

ALTER TABLE CPCOMPRA ALTER COLUMN NUMACDRAW POSITION 94;

ALTER TABLE CPCOMPRA ALTER COLUMN TIPODOCIMP POSITION 95;

ALTER TABLE CPCOMPRA ALTER COLUMN SITDOC POSITION 96;

ALTER TABLE CPCOMPRA ALTER COLUMN OBSNFE POSITION 97;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPOP POSITION 98;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALOP POSITION 99;

ALTER TABLE CPCOMPRA ALTER COLUMN CODOP POSITION 100;

ALTER TABLE CPCOMPRA ALTER COLUMN SEQOP POSITION 101;

ALTER TABLE CPCOMPRA ALTER COLUMN CODEMPIM POSITION 102;

ALTER TABLE CPCOMPRA ALTER COLUMN CODFILIALIM POSITION 103;

ALTER TABLE CPCOMPRA ALTER COLUMN CODIMP POSITION 104;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRBASEIICOMPRA POSITION 105;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRIICOMPRA POSITION 106;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSDIFERIDO POSITION 107;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSDEVIDO POSITION 108;

ALTER TABLE CPCOMPRA ALTER COLUMN VLRICMSCREDPRESUM POSITION 109;

ALTER TABLE CPCOMPRA ALTER COLUMN DTINS POSITION 110;

ALTER TABLE CPCOMPRA ALTER COLUMN HINS POSITION 111;

ALTER TABLE CPCOMPRA ALTER COLUMN IDUSUINS POSITION 112;

ALTER TABLE CPCOMPRA ALTER COLUMN DTALT POSITION 113;

ALTER TABLE CPCOMPRA ALTER COLUMN HALT POSITION 114;

ALTER TABLE CPCOMPRA ALTER COLUMN IDUSUALT POSITION 115;

ALTER TABLE CRCHAMADO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE CRCHAMADO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE CRCHAMADO ALTER COLUMN CODCHAMADO POSITION 3;

ALTER TABLE CRCHAMADO ALTER COLUMN DESCCHAMADO POSITION 4;

ALTER TABLE CRCHAMADO ALTER COLUMN FATOGERADOR POSITION 5;

ALTER TABLE CRCHAMADO ALTER COLUMN AMBIENTE POSITION 6;

ALTER TABLE CRCHAMADO ALTER COLUMN DETCHAMADO POSITION 7;

ALTER TABLE CRCHAMADO ALTER COLUMN OBSCHAMADO POSITION 8;

ALTER TABLE CRCHAMADO ALTER COLUMN CODEMPCL POSITION 9;

ALTER TABLE CRCHAMADO ALTER COLUMN CODFILIALCL POSITION 10;

ALTER TABLE CRCHAMADO ALTER COLUMN CODCLI POSITION 11;

ALTER TABLE CRCHAMADO ALTER COLUMN SOLICITANTE POSITION 12;

ALTER TABLE CRCHAMADO ALTER COLUMN PRIORIDADE POSITION 13;

ALTER TABLE CRCHAMADO ALTER COLUMN CODEMPTC POSITION 14;

ALTER TABLE CRCHAMADO ALTER COLUMN CODFILIALTC POSITION 15;

ALTER TABLE CRCHAMADO ALTER COLUMN CODTPCHAMADO POSITION 16;

ALTER TABLE CRCHAMADO ALTER COLUMN STATUS POSITION 17;

ALTER TABLE CRCHAMADO ALTER COLUMN DTCHAMADO POSITION 18;

ALTER TABLE CRCHAMADO ALTER COLUMN DTPREVISAO POSITION 19;

ALTER TABLE CRCHAMADO ALTER COLUMN QTDHORASPREVISAO POSITION 20;

ALTER TABLE CRCHAMADO ALTER COLUMN DTCONCLUSAO POSITION 21;

ALTER TABLE CRCHAMADO ALTER COLUMN CODEMPAE POSITION 22;

ALTER TABLE CRCHAMADO ALTER COLUMN CODFILIALAE POSITION 23;

ALTER TABLE CRCHAMADO ALTER COLUMN CODATEND POSITION 24;

ALTER TABLE CRCHAMADO ALTER COLUMN CODEMPOS POSITION 25;

ALTER TABLE CRCHAMADO ALTER COLUMN CODFILIALOS POSITION 26;

ALTER TABLE CRCHAMADO ALTER COLUMN TICKET POSITION 27;

ALTER TABLE CRCHAMADO ALTER COLUMN CODITRECMERC POSITION 28;

ALTER TABLE CRCHAMADO ALTER COLUMN CODITOS POSITION 29;

ALTER TABLE CRCHAMADO ALTER COLUMN EMATENDIMENTO POSITION 30;

ALTER TABLE CRCHAMADO ALTER COLUMN CODEMPQL POSITION 31;

ALTER TABLE CRCHAMADO ALTER COLUMN CODFILIALQL POSITION 32;

ALTER TABLE CRCHAMADO ALTER COLUMN CODQUALIFIC POSITION 33;

ALTER TABLE CRCHAMADO ALTER COLUMN DTINS POSITION 34;

ALTER TABLE CRCHAMADO ALTER COLUMN HINS POSITION 35;

ALTER TABLE CRCHAMADO ALTER COLUMN IDUSUINS POSITION 36;

ALTER TABLE CRCHAMADO ALTER COLUMN DTALT POSITION 37;

ALTER TABLE CRCHAMADO ALTER COLUMN HALT POSITION 38;

ALTER TABLE CRCHAMADO ALTER COLUMN IDUSUALT POSITION 39;

ALTER TABLE EQMOVPROD ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE EQMOVPROD ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE EQMOVPROD ALTER COLUMN CODMOVPROD POSITION 3;

ALTER TABLE EQMOVPROD ALTER COLUMN CODEMPPD POSITION 4;

ALTER TABLE EQMOVPROD ALTER COLUMN CODFILIALPD POSITION 5;

ALTER TABLE EQMOVPROD ALTER COLUMN CODPROD POSITION 6;

ALTER TABLE EQMOVPROD ALTER COLUMN CODEMPVD POSITION 7;

ALTER TABLE EQMOVPROD ALTER COLUMN CODFILIALVD POSITION 8;

ALTER TABLE EQMOVPROD ALTER COLUMN TIPOVENDA POSITION 9;

ALTER TABLE EQMOVPROD ALTER COLUMN CODVENDA POSITION 10;

ALTER TABLE EQMOVPROD ALTER COLUMN CODITVENDA POSITION 11;

ALTER TABLE EQMOVPROD ALTER COLUMN CODEMPLE POSITION 12;

ALTER TABLE EQMOVPROD ALTER COLUMN CODFILIALLE POSITION 13;

ALTER TABLE EQMOVPROD ALTER COLUMN CODLOTE POSITION 14;

ALTER TABLE EQMOVPROD ALTER COLUMN CODEMPTM POSITION 15;

ALTER TABLE EQMOVPROD ALTER COLUMN CODFILIALTM POSITION 16;

ALTER TABLE EQMOVPROD ALTER COLUMN CODTIPOMOV POSITION 17;

ALTER TABLE EQMOVPROD ALTER COLUMN CODEMPCP POSITION 18;

ALTER TABLE EQMOVPROD ALTER COLUMN CODFILIALCP POSITION 19;

ALTER TABLE EQMOVPROD ALTER COLUMN CODCOMPRA POSITION 20;

ALTER TABLE EQMOVPROD ALTER COLUMN CODITCOMPRA POSITION 21;

ALTER TABLE EQMOVPROD ALTER COLUMN CODEMPIV POSITION 22;

ALTER TABLE EQMOVPROD ALTER COLUMN CODFILIALIV POSITION 23;

ALTER TABLE EQMOVPROD ALTER COLUMN CODINVPROD POSITION 24;

ALTER TABLE EQMOVPROD ALTER COLUMN DTMOVPROD POSITION 25;

ALTER TABLE EQMOVPROD ALTER COLUMN TIPOMOVPROD POSITION 26;

ALTER TABLE EQMOVPROD ALTER COLUMN ESTOQMOVPROD POSITION 27;

ALTER TABLE EQMOVPROD ALTER COLUMN CODEMPAX POSITION 28;

ALTER TABLE EQMOVPROD ALTER COLUMN CODFILIALAX POSITION 29;

ALTER TABLE EQMOVPROD ALTER COLUMN CODALMOX POSITION 30;

ALTER TABLE EQMOVPROD ALTER COLUMN QTDMOVPROD POSITION 31;

ALTER TABLE EQMOVPROD ALTER COLUMN PRECOMOVPROD POSITION 32;

ALTER TABLE EQMOVPROD ALTER COLUMN CUSTOMPMMOVPROD POSITION 33;

ALTER TABLE EQMOVPROD ALTER COLUMN CUSTOMPMMOVPRODAX POSITION 34;

ALTER TABLE EQMOVPROD ALTER COLUMN SLDMOVPROD POSITION 35;

ALTER TABLE EQMOVPROD ALTER COLUMN SLDMOVPRODAX POSITION 36;

ALTER TABLE EQMOVPROD ALTER COLUMN FLAG POSITION 37;

ALTER TABLE EQMOVPROD ALTER COLUMN CODEMPNT POSITION 38;

ALTER TABLE EQMOVPROD ALTER COLUMN CODFILIALNT POSITION 39;

ALTER TABLE EQMOVPROD ALTER COLUMN CODNAT POSITION 40;

ALTER TABLE EQMOVPROD ALTER COLUMN DOCMOVPROD POSITION 41;

ALTER TABLE EQMOVPROD ALTER COLUMN CODEMPRM POSITION 42;

ALTER TABLE EQMOVPROD ALTER COLUMN CODFILIALRM POSITION 43;

ALTER TABLE EQMOVPROD ALTER COLUMN CODRMA POSITION 44;

ALTER TABLE EQMOVPROD ALTER COLUMN CODITRMA POSITION 45;

ALTER TABLE EQMOVPROD ALTER COLUMN EMMANUT POSITION 46;

ALTER TABLE EQMOVPROD ALTER COLUMN CODEMPOP POSITION 47;

ALTER TABLE EQMOVPROD ALTER COLUMN CODFILIALOP POSITION 48;

ALTER TABLE EQMOVPROD ALTER COLUMN CODOP POSITION 49;

ALTER TABLE EQMOVPROD ALTER COLUMN SEQOP POSITION 50;

ALTER TABLE EQMOVPROD ALTER COLUMN SEQENTOP POSITION 51;

ALTER TABLE EQMOVPROD ALTER COLUMN SEQSUBPROD POSITION 52;

ALTER TABLE EQMOVPROD ALTER COLUMN DTINS POSITION 53;

ALTER TABLE EQMOVPROD ALTER COLUMN HINS POSITION 54;

ALTER TABLE EQMOVPROD ALTER COLUMN IDUSUINS POSITION 55;

ALTER TABLE EQMOVPROD ALTER COLUMN DTALT POSITION 56;

ALTER TABLE EQMOVPROD ALTER COLUMN HALT POSITION 57;

ALTER TABLE EQMOVPROD ALTER COLUMN IDUSUALT POSITION 58;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODMOVSERIE POSITION 3;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODEMPPD POSITION 4;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODFILIALPD POSITION 5;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODPROD POSITION 6;

ALTER TABLE EQMOVSERIE ALTER COLUMN NUMSERIE POSITION 7;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODEMPVD POSITION 8;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODFILIALVD POSITION 9;

ALTER TABLE EQMOVSERIE ALTER COLUMN TIPOVENDA POSITION 10;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODVENDA POSITION 11;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODITVENDA POSITION 12;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODEMPTM POSITION 13;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODFILIALTM POSITION 14;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODTIPOMOV POSITION 15;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODEMPCP POSITION 16;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODFILIALCP POSITION 17;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODCOMPRA POSITION 18;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODITCOMPRA POSITION 19;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODEMPIV POSITION 20;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODFILIALIV POSITION 21;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODINVPROD POSITION 22;

ALTER TABLE EQMOVSERIE ALTER COLUMN DTMOVSERIE POSITION 23;

ALTER TABLE EQMOVSERIE ALTER COLUMN TIPOMOVSERIE POSITION 24;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODEMPRM POSITION 25;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODFILIALRM POSITION 26;

ALTER TABLE EQMOVSERIE ALTER COLUMN DOCMOVSERIE POSITION 27;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODRMA POSITION 28;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODITRMA POSITION 29;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODEMPOP POSITION 30;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODFILIALOP POSITION 31;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODOP POSITION 32;

ALTER TABLE EQMOVSERIE ALTER COLUMN SEQOP POSITION 33;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODLOTE POSITION 34;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODEMPLE POSITION 35;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODFILIALLE POSITION 36;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODALMOX POSITION 37;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODEMPAX POSITION 38;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODFILIALAX POSITION 39;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODEMPRC POSITION 40;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODFILIALRC POSITION 41;

ALTER TABLE EQMOVSERIE ALTER COLUMN TICKET POSITION 42;

ALTER TABLE EQMOVSERIE ALTER COLUMN CODITRECMERC POSITION 43;

ALTER TABLE EQMOVSERIE ALTER COLUMN IDUSUINS POSITION 44;

ALTER TABLE EQMOVSERIE ALTER COLUMN DTINS POSITION 45;

ALTER TABLE EQMOVSERIE ALTER COLUMN HINS POSITION 46;

ALTER TABLE EQMOVSERIE ALTER COLUMN IDUSUALT POSITION 47;

ALTER TABLE EQMOVSERIE ALTER COLUMN HALT POSITION 48;

ALTER TABLE EQMOVSERIE ALTER COLUMN DTALT POSITION 49;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE EQPRODUTO ALTER COLUMN CODPROD POSITION 3;

ALTER TABLE EQPRODUTO ALTER COLUMN DESCPROD POSITION 4;

ALTER TABLE EQPRODUTO ALTER COLUMN REFPROD POSITION 5;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPAX POSITION 6;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALAX POSITION 7;

ALTER TABLE EQPRODUTO ALTER COLUMN CODALMOX POSITION 8;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPMA POSITION 9;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALMA POSITION 10;

ALTER TABLE EQPRODUTO ALTER COLUMN CODMOEDA POSITION 11;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPUD POSITION 12;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALUD POSITION 13;

ALTER TABLE EQPRODUTO ALTER COLUMN CODUNID POSITION 14;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPFC POSITION 15;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALFC POSITION 16;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFISC POSITION 17;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPMC POSITION 18;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALMC POSITION 19;

ALTER TABLE EQPRODUTO ALTER COLUMN CODMARCA POSITION 20;

ALTER TABLE EQPRODUTO ALTER COLUMN DESCAUXPROD POSITION 21;

ALTER TABLE EQPRODUTO ALTER COLUMN TIPOPROD POSITION 22;

ALTER TABLE EQPRODUTO ALTER COLUMN CVPROD POSITION 23;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPGP POSITION 24;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALGP POSITION 25;

ALTER TABLE EQPRODUTO ALTER COLUMN CODGRUP POSITION 26;

ALTER TABLE EQPRODUTO ALTER COLUMN CODBARPROD POSITION 27;

ALTER TABLE EQPRODUTO ALTER COLUMN CLOTEPROD POSITION 28;

ALTER TABLE EQPRODUTO ALTER COLUMN SERIEPROD POSITION 29;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFABPROD POSITION 30;

ALTER TABLE EQPRODUTO ALTER COLUMN COMISPROD POSITION 31;

ALTER TABLE EQPRODUTO ALTER COLUMN PESOLIQPROD POSITION 32;

ALTER TABLE EQPRODUTO ALTER COLUMN PESOBRUTPROD POSITION 33;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDMINPROD POSITION 34;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDMAXPROD POSITION 35;

ALTER TABLE EQPRODUTO ALTER COLUMN DTMPMPROD POSITION 36;

ALTER TABLE EQPRODUTO ALTER COLUMN CUSTOMPMPROD POSITION 37;

ALTER TABLE EQPRODUTO ALTER COLUMN CUSTOPEPSPROD POSITION 38;

ALTER TABLE EQPRODUTO ALTER COLUMN CUSTOINFOPROD POSITION 39;

ALTER TABLE EQPRODUTO ALTER COLUMN PRECOBASEPROD POSITION 40;

ALTER TABLE EQPRODUTO ALTER COLUMN PRECOCOMISPROD POSITION 41;

ALTER TABLE EQPRODUTO ALTER COLUMN SLDPROD POSITION 42;

ALTER TABLE EQPRODUTO ALTER COLUMN SLDRESPROD POSITION 43;

ALTER TABLE EQPRODUTO ALTER COLUMN SLDCONSIGPROD POSITION 44;

ALTER TABLE EQPRODUTO ALTER COLUMN SLDLIQPROD POSITION 45;

ALTER TABLE EQPRODUTO ALTER COLUMN ATIVOPROD POSITION 46;

ALTER TABLE EQPRODUTO ALTER COLUMN DTULTCPPROD POSITION 47;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDULTCPPROD POSITION 48;

ALTER TABLE EQPRODUTO ALTER COLUMN DESCCOMPPROD POSITION 49;

ALTER TABLE EQPRODUTO ALTER COLUMN VERIFPROD POSITION 50;

ALTER TABLE EQPRODUTO ALTER COLUMN LOCALPROD POSITION 51;

ALTER TABLE EQPRODUTO ALTER COLUMN RMAPROD POSITION 52;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPPE POSITION 53;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALPE POSITION 54;

ALTER TABLE EQPRODUTO ALTER COLUMN CODPE POSITION 55;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPCC POSITION 56;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALCC POSITION 57;

ALTER TABLE EQPRODUTO ALTER COLUMN ANOCC POSITION 58;

ALTER TABLE EQPRODUTO ALTER COLUMN CODCC POSITION 59;

ALTER TABLE EQPRODUTO ALTER COLUMN USARECEITAPROD POSITION 60;

ALTER TABLE EQPRODUTO ALTER COLUMN USATELAADICPDV POSITION 61;

ALTER TABLE EQPRODUTO ALTER COLUMN VLRDENSIDADE POSITION 62;

ALTER TABLE EQPRODUTO ALTER COLUMN VLRCONCENT POSITION 63;

ALTER TABLE EQPRODUTO ALTER COLUMN COMPRIMENTO POSITION 64;

ALTER TABLE EQPRODUTO ALTER COLUMN LARGURA POSITION 65;

ALTER TABLE EQPRODUTO ALTER COLUMN ESPESSURA POSITION 66;

ALTER TABLE EQPRODUTO ALTER COLUMN GUIATRAFPROD POSITION 67;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDEMBALAGEM POSITION 68;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEANPROD POSITION 69;

ALTER TABLE EQPRODUTO ALTER COLUMN CUBAGEM POSITION 70;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPSC POSITION 71;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALSC POSITION 72;

ALTER TABLE EQPRODUTO ALTER COLUMN CODSECAO POSITION 73;

ALTER TABLE EQPRODUTO ALTER COLUMN CODEMPTC POSITION 74;

ALTER TABLE EQPRODUTO ALTER COLUMN CODFILIALTC POSITION 75;

ALTER TABLE EQPRODUTO ALTER COLUMN CODTPCHAMADO POSITION 76;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDHORASSERV POSITION 77;

ALTER TABLE EQPRODUTO ALTER COLUMN NRODIASVALID POSITION 78;

ALTER TABLE EQPRODUTO ALTER COLUMN DESCCLI POSITION 79;

ALTER TABLE EQPRODUTO ALTER COLUMN QTDPORPLANO POSITION 80;

ALTER TABLE EQPRODUTO ALTER COLUMN NROPLANOS POSITION 81;

ALTER TABLE EQPRODUTO ALTER COLUMN CERTFSC POSITION 82;

ALTER TABLE EQPRODUTO ALTER COLUMN FATORFSC POSITION 83;

ALTER TABLE EQPRODUTO ALTER COLUMN DTINS POSITION 84;

ALTER TABLE EQPRODUTO ALTER COLUMN HINS POSITION 85;

ALTER TABLE EQPRODUTO ALTER COLUMN IDUSUINS POSITION 86;

ALTER TABLE EQPRODUTO ALTER COLUMN DTALT POSITION 87;

ALTER TABLE EQPRODUTO ALTER COLUMN HALT POSITION 88;

ALTER TABLE EQPRODUTO ALTER COLUMN IDUSUALT POSITION 89;

ALTER TABLE EQRECMERC ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE EQRECMERC ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE EQRECMERC ALTER COLUMN TICKET POSITION 3;

ALTER TABLE EQRECMERC ALTER COLUMN PLACAVEICULO POSITION 4;

ALTER TABLE EQRECMERC ALTER COLUMN CODEMPPD POSITION 5;

ALTER TABLE EQRECMERC ALTER COLUMN CODFILIALPD POSITION 6;

ALTER TABLE EQRECMERC ALTER COLUMN CODPROD POSITION 7;

ALTER TABLE EQRECMERC ALTER COLUMN REFPROD POSITION 8;

ALTER TABLE EQRECMERC ALTER COLUMN CODEMPFR POSITION 9;

ALTER TABLE EQRECMERC ALTER COLUMN CODFILIALFR POSITION 10;

ALTER TABLE EQRECMERC ALTER COLUMN CODFOR POSITION 11;

ALTER TABLE EQRECMERC ALTER COLUMN CODEMPTR POSITION 12;

ALTER TABLE EQRECMERC ALTER COLUMN CODFILIALTR POSITION 13;

ALTER TABLE EQRECMERC ALTER COLUMN CODTIPORECMERC POSITION 14;

ALTER TABLE EQRECMERC ALTER COLUMN CODEMPTN POSITION 15;

ALTER TABLE EQRECMERC ALTER COLUMN CODFILIALTN POSITION 16;

ALTER TABLE EQRECMERC ALTER COLUMN CODTRAN POSITION 17;

ALTER TABLE EQRECMERC ALTER COLUMN IDUSUALT POSITION 18;

ALTER TABLE EQRECMERC ALTER COLUMN CODBAIRRO POSITION 19;

ALTER TABLE EQRECMERC ALTER COLUMN CODMUNIC POSITION 20;

ALTER TABLE EQRECMERC ALTER COLUMN SIGLAUF POSITION 21;

ALTER TABLE EQRECMERC ALTER COLUMN CODPAIS POSITION 22;

ALTER TABLE EQRECMERC ALTER COLUMN STATUS POSITION 23;

ALTER TABLE EQRECMERC ALTER COLUMN TIPOFRETE POSITION 24;

ALTER TABLE EQRECMERC ALTER COLUMN DTENT POSITION 25;

ALTER TABLE EQRECMERC ALTER COLUMN DTPREVRET POSITION 26;

ALTER TABLE EQRECMERC ALTER COLUMN DOCRECMERC POSITION 27;

ALTER TABLE EQRECMERC ALTER COLUMN CODEMPVD POSITION 28;

ALTER TABLE EQRECMERC ALTER COLUMN CODFILIALVD POSITION 29;

ALTER TABLE EQRECMERC ALTER COLUMN CODVEND POSITION 30;

ALTER TABLE EQRECMERC ALTER COLUMN CODEMPCL POSITION 31;

ALTER TABLE EQRECMERC ALTER COLUMN CODFILIALCL POSITION 32;

ALTER TABLE EQRECMERC ALTER COLUMN CODCLI POSITION 33;

ALTER TABLE EQRECMERC ALTER COLUMN CODEMPAR POSITION 34;

ALTER TABLE EQRECMERC ALTER COLUMN CODFILIALAR POSITION 35;

ALTER TABLE EQRECMERC ALTER COLUMN CODATENDREC POSITION 36;

ALTER TABLE EQRECMERC ALTER COLUMN SOLICITANTE POSITION 37;

ALTER TABLE EQRECMERC ALTER COLUMN MEDIAAMOSTRAGEM POSITION 38;

ALTER TABLE EQRECMERC ALTER COLUMN RENDAAMOSTRAGEM POSITION 39;

ALTER TABLE EQRECMERC ALTER COLUMN CODEMPAX POSITION 40;

ALTER TABLE EQRECMERC ALTER COLUMN CODFILIALAX POSITION 41;

ALTER TABLE EQRECMERC ALTER COLUMN CODALMOX POSITION 42;

ALTER TABLE EQRECMERC ALTER COLUMN OBSRECMERC POSITION 43;

ALTER TABLE EQRECMERC ALTER COLUMN DESCONTO POSITION 44;

ALTER TABLE EQRECMERC ALTER COLUMN DTINS POSITION 45;

ALTER TABLE EQRECMERC ALTER COLUMN HINS POSITION 46;

ALTER TABLE EQRECMERC ALTER COLUMN IDUSUINS POSITION 47;

ALTER TABLE EQRECMERC ALTER COLUMN DTALT POSITION 48;

ALTER TABLE EQRECMERC ALTER COLUMN HALT POSITION 49;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODTIPOMOV POSITION 3;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPMN POSITION 4;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALMN POSITION 5;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODMODNOTA POSITION 6;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPSE POSITION 7;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALSE POSITION 8;

ALTER TABLE EQTIPOMOV ALTER COLUMN SERIE POSITION 9;

ALTER TABLE EQTIPOMOV ALTER COLUMN DESCTIPOMOV POSITION 10;

ALTER TABLE EQTIPOMOV ALTER COLUMN ESTIPOMOV POSITION 11;

ALTER TABLE EQTIPOMOV ALTER COLUMN FISCALTIPOMOV POSITION 12;

ALTER TABLE EQTIPOMOV ALTER COLUMN ESTOQTIPOMOV POSITION 13;

ALTER TABLE EQTIPOMOV ALTER COLUMN TIPOMOV POSITION 14;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPTB POSITION 15;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALTB POSITION 16;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODTAB POSITION 17;

ALTER TABLE EQTIPOMOV ALTER COLUMN ESPECIETIPOMOV POSITION 18;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPTM POSITION 19;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALTM POSITION 20;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODTIPOMOVTM POSITION 21;

ALTER TABLE EQTIPOMOV ALTER COLUMN IMPPEDTIPOMOV POSITION 22;

ALTER TABLE EQTIPOMOV ALTER COLUMN IMPNFTIPOMOV POSITION 23;

ALTER TABLE EQTIPOMOV ALTER COLUMN IMPBOLTIPOMOV POSITION 24;

ALTER TABLE EQTIPOMOV ALTER COLUMN IMPRECTIPOMOV POSITION 25;

ALTER TABLE EQTIPOMOV ALTER COLUMN REIMPNFTIPOMOV POSITION 26;

ALTER TABLE EQTIPOMOV ALTER COLUMN TUSUTIPOMOV POSITION 27;

ALTER TABLE EQTIPOMOV ALTER COLUMN SOMAVDTIPOMOV POSITION 28;

ALTER TABLE EQTIPOMOV ALTER COLUMN SEQNFTIPOMOV POSITION 29;

ALTER TABLE EQTIPOMOV ALTER COLUMN VLRMFINTIPOMOV POSITION 30;

ALTER TABLE EQTIPOMOV ALTER COLUMN MCOMISTIPOMOV POSITION 31;

ALTER TABLE EQTIPOMOV ALTER COLUMN CTIPOFRETE POSITION 32;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPRC POSITION 33;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALRC POSITION 34;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODREGRCOMIS POSITION 35;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPTN POSITION 36;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALTN POSITION 37;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODTRAN POSITION 38;

ALTER TABLE EQTIPOMOV ALTER COLUMN EMITNFCPMOV POSITION 39;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPDF POSITION 40;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALDF POSITION 41;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODMODDOCFISC POSITION 42;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODEMPPP POSITION 43;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODFILIALPP POSITION 44;

ALTER TABLE EQTIPOMOV ALTER COLUMN CODPLANOPAG POSITION 45;

ALTER TABLE EQTIPOMOV ALTER COLUMN DTINS POSITION 46;

ALTER TABLE EQTIPOMOV ALTER COLUMN HINS POSITION 47;

ALTER TABLE EQTIPOMOV ALTER COLUMN IDUSUINS POSITION 48;

ALTER TABLE EQTIPOMOV ALTER COLUMN DTALT POSITION 49;

ALTER TABLE EQTIPOMOV ALTER COLUMN HALT POSITION 50;

ALTER TABLE EQTIPOMOV ALTER COLUMN IDUSUALT POSITION 51;

ALTER TABLE FNCARTCOB ALTER COLUMN CODEMPBO POSITION 1;

ALTER TABLE FNCARTCOB ALTER COLUMN CODFILIALBO POSITION 2;

ALTER TABLE FNCARTCOB ALTER COLUMN CODBANCO POSITION 3;

ALTER TABLE FNCARTCOB ALTER COLUMN CODEMP POSITION 4;

ALTER TABLE FNCARTCOB ALTER COLUMN CODFILIAL POSITION 5;

ALTER TABLE FNCARTCOB ALTER COLUMN CODCARTCOB POSITION 6;

ALTER TABLE FNCARTCOB ALTER COLUMN VARIACAOCARTCOB POSITION 7;

ALTER TABLE FNCARTCOB ALTER COLUMN DESCCARTCOB POSITION 8;

ALTER TABLE FNCARTCOB ALTER COLUMN CARTCOBCNAB POSITION 9;

ALTER TABLE FNCARTCOB ALTER COLUMN DTINS POSITION 10;

ALTER TABLE FNCARTCOB ALTER COLUMN HINS POSITION 11;

ALTER TABLE FNCARTCOB ALTER COLUMN IDUSUINS POSITION 12;

ALTER TABLE FNCARTCOB ALTER COLUMN DTALT POSITION 13;

ALTER TABLE FNCARTCOB ALTER COLUMN HALT POSITION 14;

ALTER TABLE FNCARTCOB ALTER COLUMN IDUSUALT POSITION 15;

ALTER TABLE FNCARTCOB ALTER COLUMN CODCARTCOBCNAB POSITION 16;

ALTER TABLE FNFBNREC ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNFBNREC ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNFBNREC ALTER COLUMN CODREC POSITION 3;

ALTER TABLE FNFBNREC ALTER COLUMN NPARCITREC POSITION 4;

ALTER TABLE FNFBNREC ALTER COLUMN CODEMPPF POSITION 5;

ALTER TABLE FNFBNREC ALTER COLUMN CODFILIALPF POSITION 6;

ALTER TABLE FNFBNREC ALTER COLUMN CODEMPBO POSITION 7;

ALTER TABLE FNFBNREC ALTER COLUMN CODFILIALBO POSITION 8;

ALTER TABLE FNFBNREC ALTER COLUMN CODBANCO POSITION 9;

ALTER TABLE FNFBNREC ALTER COLUMN TIPOFEBRABAN POSITION 10;

ALTER TABLE FNFBNREC ALTER COLUMN STIPOFEBRABAN POSITION 11;

ALTER TABLE FNFBNREC ALTER COLUMN SITREMESSA POSITION 12;

ALTER TABLE FNFBNREC ALTER COLUMN SITRETORNO POSITION 13;

ALTER TABLE FNFBNREC ALTER COLUMN NOMEARQUIVO POSITION 14;

ALTER TABLE FNFBNREC ALTER COLUMN DTINS POSITION 15;

ALTER TABLE FNFBNREC ALTER COLUMN HINS POSITION 16;

ALTER TABLE FNFBNREC ALTER COLUMN IDUSUINS POSITION 17;

ALTER TABLE FNFBNREC ALTER COLUMN DTALT POSITION 18;

ALTER TABLE FNFBNREC ALTER COLUMN HALT POSITION 19;

ALTER TABLE FNFBNREC ALTER COLUMN IDUSUALT POSITION 20;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNITPAGAR ALTER COLUMN CODPAG POSITION 3;

ALTER TABLE FNITPAGAR ALTER COLUMN NPARCPAG POSITION 4;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRITPAG POSITION 5;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRDESCITPAG POSITION 6;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRMULTAITPAG POSITION 7;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRJUROSITPAG POSITION 8;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRDEVITPAG POSITION 9;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRPARCITPAG POSITION 10;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRPAGOITPAG POSITION 11;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRAPAGITPAG POSITION 12;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRADICITPAG POSITION 13;

ALTER TABLE FNITPAGAR ALTER COLUMN VLRCANCITPAG POSITION 14;

ALTER TABLE FNITPAGAR ALTER COLUMN DTITPAG POSITION 15;

ALTER TABLE FNITPAGAR ALTER COLUMN DTCOMPITPAG POSITION 16;

ALTER TABLE FNITPAGAR ALTER COLUMN DTVENCITPAG POSITION 17;

ALTER TABLE FNITPAGAR ALTER COLUMN DTPAGOITPAG POSITION 18;

ALTER TABLE FNITPAGAR ALTER COLUMN STATUSITPAG POSITION 19;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPCA POSITION 20;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALCA POSITION 21;

ALTER TABLE FNITPAGAR ALTER COLUMN NUMCONTA POSITION 22;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPPN POSITION 23;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALPN POSITION 24;

ALTER TABLE FNITPAGAR ALTER COLUMN CODPLAN POSITION 25;

ALTER TABLE FNITPAGAR ALTER COLUMN DOCLANCAITPAG POSITION 26;

ALTER TABLE FNITPAGAR ALTER COLUMN OBSITPAG POSITION 27;

ALTER TABLE FNITPAGAR ALTER COLUMN FLAG POSITION 28;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPCC POSITION 29;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALCC POSITION 30;

ALTER TABLE FNITPAGAR ALTER COLUMN ANOCC POSITION 31;

ALTER TABLE FNITPAGAR ALTER COLUMN CODCC POSITION 32;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPTC POSITION 33;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALTC POSITION 34;

ALTER TABLE FNITPAGAR ALTER COLUMN CODTIPOCOB POSITION 35;

ALTER TABLE FNITPAGAR ALTER COLUMN EMMANUT POSITION 36;

ALTER TABLE FNITPAGAR ALTER COLUMN CODEMPSN POSITION 37;

ALTER TABLE FNITPAGAR ALTER COLUMN CODFILIALSN POSITION 38;

ALTER TABLE FNITPAGAR ALTER COLUMN CODSINAL POSITION 39;

ALTER TABLE FNITPAGAR ALTER COLUMN MULTIBAIXA POSITION 40;

ALTER TABLE FNITPAGAR ALTER COLUMN DTINS POSITION 41;

ALTER TABLE FNITPAGAR ALTER COLUMN IDUSUINS POSITION 42;

ALTER TABLE FNITPAGAR ALTER COLUMN DTALT POSITION 43;

ALTER TABLE FNITPAGAR ALTER COLUMN IDUSUALT POSITION 44;

ALTER TABLE FNITPAGAR ALTER COLUMN HINS POSITION 45;

ALTER TABLE FNITPAGAR ALTER COLUMN HALT POSITION 46;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNITRECEBER ALTER COLUMN CODREC POSITION 3;

ALTER TABLE FNITRECEBER ALTER COLUMN NPARCITREC POSITION 4;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRITREC POSITION 5;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRDESCITREC POSITION 6;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRMULTAITREC POSITION 7;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRJUROSITREC POSITION 8;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRDEVITREC POSITION 9;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRPARCITREC POSITION 10;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRPAGOITREC POSITION 11;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRAPAGITREC POSITION 12;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRCOMIITREC POSITION 13;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRCANCITREC POSITION 14;

ALTER TABLE FNITRECEBER ALTER COLUMN VLRBASECOMIS POSITION 15;

ALTER TABLE FNITRECEBER ALTER COLUMN DESCPONT POSITION 16;

ALTER TABLE FNITRECEBER ALTER COLUMN DTITREC POSITION 17;

ALTER TABLE FNITRECEBER ALTER COLUMN DTCOMPITREC POSITION 18;

ALTER TABLE FNITRECEBER ALTER COLUMN DTVENCITREC POSITION 19;

ALTER TABLE FNITRECEBER ALTER COLUMN DTPREVITREC POSITION 20;

ALTER TABLE FNITRECEBER ALTER COLUMN DTPAGOITREC POSITION 21;

ALTER TABLE FNITRECEBER ALTER COLUMN DTLIQITREC POSITION 22;

ALTER TABLE FNITRECEBER ALTER COLUMN STATUSITREC POSITION 23;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPPN POSITION 24;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALPN POSITION 25;

ALTER TABLE FNITRECEBER ALTER COLUMN CODPLAN POSITION 26;

ALTER TABLE FNITRECEBER ALTER COLUMN OBSITREC POSITION 27;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPCA POSITION 28;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALCA POSITION 29;

ALTER TABLE FNITRECEBER ALTER COLUMN NUMCONTA POSITION 30;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPBO POSITION 31;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALBO POSITION 32;

ALTER TABLE FNITRECEBER ALTER COLUMN CODBANCO POSITION 33;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPTC POSITION 34;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALTC POSITION 35;

ALTER TABLE FNITRECEBER ALTER COLUMN CODTIPOCOB POSITION 36;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPCB POSITION 37;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALCB POSITION 38;

ALTER TABLE FNITRECEBER ALTER COLUMN CODCARTCOB POSITION 39;

ALTER TABLE FNITRECEBER ALTER COLUMN DOCLANCAITREC POSITION 40;

ALTER TABLE FNITRECEBER ALTER COLUMN FLAG POSITION 41;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPCC POSITION 42;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALCC POSITION 43;

ALTER TABLE FNITRECEBER ALTER COLUMN ANOCC POSITION 44;

ALTER TABLE FNITRECEBER ALTER COLUMN CODCC POSITION 45;

ALTER TABLE FNITRECEBER ALTER COLUMN IMPRECIBOITREC POSITION 46;

ALTER TABLE FNITRECEBER ALTER COLUMN RECIBOITREC POSITION 47;

ALTER TABLE FNITRECEBER ALTER COLUMN ALTUSUITREC POSITION 48;

ALTER TABLE FNITRECEBER ALTER COLUMN PDVITREC POSITION 49;

ALTER TABLE FNITRECEBER ALTER COLUMN RECEMCOB POSITION 50;

ALTER TABLE FNITRECEBER ALTER COLUMN DTINIEMCOB POSITION 51;

ALTER TABLE FNITRECEBER ALTER COLUMN DTFIMEMCOB POSITION 52;

ALTER TABLE FNITRECEBER ALTER COLUMN SEQNOSSONUMERO POSITION 53;

ALTER TABLE FNITRECEBER ALTER COLUMN NOSSONUMERO POSITION 54;

ALTER TABLE FNITRECEBER ALTER COLUMN EMMANUT POSITION 55;

ALTER TABLE FNITRECEBER ALTER COLUMN DTINS POSITION 56;

ALTER TABLE FNITRECEBER ALTER COLUMN HINS POSITION 57;

ALTER TABLE FNITRECEBER ALTER COLUMN IDUSUINS POSITION 58;

ALTER TABLE FNITRECEBER ALTER COLUMN DTALT POSITION 59;

ALTER TABLE FNITRECEBER ALTER COLUMN HALT POSITION 60;

ALTER TABLE FNITRECEBER ALTER COLUMN IDUSUALT POSITION 61;

ALTER TABLE FNITRECEBER ALTER COLUMN CODEMPSN POSITION 62;

ALTER TABLE FNITRECEBER ALTER COLUMN CODFILIALSN POSITION 63;

ALTER TABLE FNITRECEBER ALTER COLUMN CODSINAL POSITION 64;

ALTER TABLE FNLANCA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNLANCA ALTER COLUMN CODLANCA POSITION 3;

ALTER TABLE FNLANCA ALTER COLUMN CODCOMI POSITION 4;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPPG POSITION 5;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALPG POSITION 6;

ALTER TABLE FNLANCA ALTER COLUMN CODPAG POSITION 7;

ALTER TABLE FNLANCA ALTER COLUMN NPARCPAG POSITION 8;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPRC POSITION 9;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALRC POSITION 10;

ALTER TABLE FNLANCA ALTER COLUMN CODREC POSITION 11;

ALTER TABLE FNLANCA ALTER COLUMN NPARCITREC POSITION 12;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPPN POSITION 13;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALPN POSITION 14;

ALTER TABLE FNLANCA ALTER COLUMN CODPLAN POSITION 15;

ALTER TABLE FNLANCA ALTER COLUMN DTCOMPLANCA POSITION 16;

ALTER TABLE FNLANCA ALTER COLUMN DATALANCA POSITION 17;

ALTER TABLE FNLANCA ALTER COLUMN DOCLANCA POSITION 18;

ALTER TABLE FNLANCA ALTER COLUMN HISTBLANCA POSITION 19;

ALTER TABLE FNLANCA ALTER COLUMN HISTLANCA POSITION 20;

ALTER TABLE FNLANCA ALTER COLUMN TRANSFLANCA POSITION 21;

ALTER TABLE FNLANCA ALTER COLUMN STATUSLANCA POSITION 22;

ALTER TABLE FNLANCA ALTER COLUMN DTPREVLANCA POSITION 23;

ALTER TABLE FNLANCA ALTER COLUMN DTPREVSUBLANCA POSITION 24;

ALTER TABLE FNLANCA ALTER COLUMN VLRLANCA POSITION 25;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPCI POSITION 26;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALCI POSITION 27;

ALTER TABLE FNLANCA ALTER COLUMN CODPCOMI POSITION 28;

ALTER TABLE FNLANCA ALTER COLUMN FLAG POSITION 29;

ALTER TABLE FNLANCA ALTER COLUMN TIPOLANCA POSITION 30;

ALTER TABLE FNLANCA ALTER COLUMN PDVITREC POSITION 31;

ALTER TABLE FNLANCA ALTER COLUMN CODCLI POSITION 32;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPCL POSITION 33;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALCL POSITION 34;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPFR POSITION 35;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALFR POSITION 36;

ALTER TABLE FNLANCA ALTER COLUMN CODFOR POSITION 37;

ALTER TABLE FNLANCA ALTER COLUMN EMMANUT POSITION 38;

ALTER TABLE FNLANCA ALTER COLUMN CODEMPSN POSITION 39;

ALTER TABLE FNLANCA ALTER COLUMN CODFILIALSN POSITION 40;

ALTER TABLE FNLANCA ALTER COLUMN CODSINAL POSITION 41;

ALTER TABLE FNLANCA ALTER COLUMN DTINS POSITION 42;

ALTER TABLE FNLANCA ALTER COLUMN HINS POSITION 43;

ALTER TABLE FNLANCA ALTER COLUMN IDUSUINS POSITION 44;

ALTER TABLE FNLANCA ALTER COLUMN DTALT POSITION 45;

ALTER TABLE FNLANCA ALTER COLUMN HALT POSITION 46;

ALTER TABLE FNLANCA ALTER COLUMN IDUSUALT POSITION 47;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNPAGAR ALTER COLUMN CODPAG POSITION 3;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPCP POSITION 4;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALCP POSITION 5;

ALTER TABLE FNPAGAR ALTER COLUMN CODCOMPRA POSITION 6;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPPG POSITION 7;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALPG POSITION 8;

ALTER TABLE FNPAGAR ALTER COLUMN CODPLANOPAG POSITION 9;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPFR POSITION 10;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALFR POSITION 11;

ALTER TABLE FNPAGAR ALTER COLUMN CODFOR POSITION 12;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPBO POSITION 13;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALBO POSITION 14;

ALTER TABLE FNPAGAR ALTER COLUMN CODBANCO POSITION 15;

ALTER TABLE FNPAGAR ALTER COLUMN VLRDESCPAG POSITION 16;

ALTER TABLE FNPAGAR ALTER COLUMN VLRMULTAPAG POSITION 17;

ALTER TABLE FNPAGAR ALTER COLUMN VLRJUROSPAG POSITION 18;

ALTER TABLE FNPAGAR ALTER COLUMN VLRDEVPAG POSITION 19;

ALTER TABLE FNPAGAR ALTER COLUMN VLRPARCPAG POSITION 20;

ALTER TABLE FNPAGAR ALTER COLUMN VLRPAGOPAG POSITION 21;

ALTER TABLE FNPAGAR ALTER COLUMN VLRAPAGPAG POSITION 22;

ALTER TABLE FNPAGAR ALTER COLUMN DATAPAG POSITION 23;

ALTER TABLE FNPAGAR ALTER COLUMN DTCOMPPAG POSITION 24;

ALTER TABLE FNPAGAR ALTER COLUMN STATUSPAG POSITION 25;

ALTER TABLE FNPAGAR ALTER COLUMN DTQUITPAG POSITION 26;

ALTER TABLE FNPAGAR ALTER COLUMN DOCPAG POSITION 27;

ALTER TABLE FNPAGAR ALTER COLUMN VLRPAG POSITION 28;

ALTER TABLE FNPAGAR ALTER COLUMN NROPARCPAG POSITION 29;

ALTER TABLE FNPAGAR ALTER COLUMN OBSPAG POSITION 30;

ALTER TABLE FNPAGAR ALTER COLUMN VLRADICPAG POSITION 31;

ALTER TABLE FNPAGAR ALTER COLUMN FLAG POSITION 32;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPTC POSITION 33;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALTC POSITION 34;

ALTER TABLE FNPAGAR ALTER COLUMN CODTIPOCOB POSITION 35;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPCA POSITION 36;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALCA POSITION 37;

ALTER TABLE FNPAGAR ALTER COLUMN NUMCONTA POSITION 38;

ALTER TABLE FNPAGAR ALTER COLUMN EMMANUT POSITION 39;

ALTER TABLE FNPAGAR ALTER COLUMN VLRBASEIRRF POSITION 40;

ALTER TABLE FNPAGAR ALTER COLUMN VLRBASEINSS POSITION 41;

ALTER TABLE FNPAGAR ALTER COLUMN VLRRETIRRF POSITION 42;

ALTER TABLE FNPAGAR ALTER COLUMN VLRRETINSS POSITION 43;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPPN POSITION 44;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALPN POSITION 45;

ALTER TABLE FNPAGAR ALTER COLUMN CODPLAN POSITION 46;

ALTER TABLE FNPAGAR ALTER COLUMN CODEMPCC POSITION 47;

ALTER TABLE FNPAGAR ALTER COLUMN CODFILIALCC POSITION 48;

ALTER TABLE FNPAGAR ALTER COLUMN ANOCC POSITION 49;

ALTER TABLE FNPAGAR ALTER COLUMN CODCC POSITION 50;

ALTER TABLE FNPAGAR ALTER COLUMN DTINS POSITION 51;

ALTER TABLE FNPAGAR ALTER COLUMN HINS POSITION 52;

ALTER TABLE FNPAGAR ALTER COLUMN IDUSUINS POSITION 53;

ALTER TABLE FNPAGAR ALTER COLUMN DTALT POSITION 54;

ALTER TABLE FNPAGAR ALTER COLUMN HALT POSITION 55;

ALTER TABLE FNPAGAR ALTER COLUMN IDUSUALT POSITION 56;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODPCOMI POSITION 3;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODEMPPN POSITION 4;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODFILIALPN POSITION 5;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODPLAN POSITION 6;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODEMPCA POSITION 7;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN CODFILIALCA POSITION 8;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN NUMCONTA POSITION 9;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN VLRPCOMI POSITION 10;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN DOCPCOMI POSITION 11;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN OBSPCOMI POSITION 12;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN DTCOMPPCOMI POSITION 13;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN DATAPCOMI POSITION 14;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN FLAG POSITION 15;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN EMMANUT POSITION 16;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN DTINS POSITION 17;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN HINS POSITION 18;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN IDUSUINS POSITION 19;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN DTALT POSITION 20;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN HALT POSITION 21;

ALTER TABLE FNPAGTOCOMI ALTER COLUMN IDUSUALT POSITION 22;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNRECEBER ALTER COLUMN CODREC POSITION 3;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPBO POSITION 4;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALBO POSITION 5;

ALTER TABLE FNRECEBER ALTER COLUMN CODBANCO POSITION 6;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPPG POSITION 7;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALPG POSITION 8;

ALTER TABLE FNRECEBER ALTER COLUMN CODPLANOPAG POSITION 9;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPCL POSITION 10;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALCL POSITION 11;

ALTER TABLE FNRECEBER ALTER COLUMN CODCLI POSITION 12;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPVD POSITION 13;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALVD POSITION 14;

ALTER TABLE FNRECEBER ALTER COLUMN CODVEND POSITION 15;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPVA POSITION 16;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALVA POSITION 17;

ALTER TABLE FNRECEBER ALTER COLUMN TIPOVENDA POSITION 18;

ALTER TABLE FNRECEBER ALTER COLUMN CODVENDA POSITION 19;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPTC POSITION 20;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALTC POSITION 21;

ALTER TABLE FNRECEBER ALTER COLUMN CODTIPOCOB POSITION 22;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPCB POSITION 23;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALCB POSITION 24;

ALTER TABLE FNRECEBER ALTER COLUMN CODCARTCOB POSITION 25;

ALTER TABLE FNRECEBER ALTER COLUMN VLRREC POSITION 26;

ALTER TABLE FNRECEBER ALTER COLUMN VLRDESCREC POSITION 27;

ALTER TABLE FNRECEBER ALTER COLUMN VLRMULTAREC POSITION 28;

ALTER TABLE FNRECEBER ALTER COLUMN VLRJUROSREC POSITION 29;

ALTER TABLE FNRECEBER ALTER COLUMN VLRDEVREC POSITION 30;

ALTER TABLE FNRECEBER ALTER COLUMN VLRPARCREC POSITION 31;

ALTER TABLE FNRECEBER ALTER COLUMN VLRPAGOREC POSITION 32;

ALTER TABLE FNRECEBER ALTER COLUMN VLRAPAGREC POSITION 33;

ALTER TABLE FNRECEBER ALTER COLUMN VLRBASECOMIS POSITION 34;

ALTER TABLE FNRECEBER ALTER COLUMN VLRRETENSAOISS POSITION 35;

ALTER TABLE FNRECEBER ALTER COLUMN DTCOMPREC POSITION 36;

ALTER TABLE FNRECEBER ALTER COLUMN DATAREC POSITION 37;

ALTER TABLE FNRECEBER ALTER COLUMN STATUSREC POSITION 38;

ALTER TABLE FNRECEBER ALTER COLUMN VLRCOMIREC POSITION 39;

ALTER TABLE FNRECEBER ALTER COLUMN DTQUITREC POSITION 40;

ALTER TABLE FNRECEBER ALTER COLUMN DOCREC POSITION 41;

ALTER TABLE FNRECEBER ALTER COLUMN NROPARCREC POSITION 42;

ALTER TABLE FNRECEBER ALTER COLUMN OBSREC POSITION 43;

ALTER TABLE FNRECEBER ALTER COLUMN FLAG POSITION 44;

ALTER TABLE FNRECEBER ALTER COLUMN ALTUSUREC POSITION 45;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPCA POSITION 46;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALCA POSITION 47;

ALTER TABLE FNRECEBER ALTER COLUMN NUMCONTA POSITION 48;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPPN POSITION 49;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALPN POSITION 50;

ALTER TABLE FNRECEBER ALTER COLUMN CODPLAN POSITION 51;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPCC POSITION 52;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALCC POSITION 53;

ALTER TABLE FNRECEBER ALTER COLUMN ANOCC POSITION 54;

ALTER TABLE FNRECEBER ALTER COLUMN CODCC POSITION 55;

ALTER TABLE FNRECEBER ALTER COLUMN CODEMPRR POSITION 56;

ALTER TABLE FNRECEBER ALTER COLUMN CODFILIALRR POSITION 57;

ALTER TABLE FNRECEBER ALTER COLUMN CODRENEGREC POSITION 58;

ALTER TABLE FNRECEBER ALTER COLUMN EMMANUT POSITION 59;

ALTER TABLE FNRECEBER ALTER COLUMN DTINS POSITION 60;

ALTER TABLE FNRECEBER ALTER COLUMN HINS POSITION 61;

ALTER TABLE FNRECEBER ALTER COLUMN IDUSUINS POSITION 62;

ALTER TABLE FNRECEBER ALTER COLUMN DTALT POSITION 63;

ALTER TABLE FNRECEBER ALTER COLUMN HALT POSITION 64;

ALTER TABLE FNRECEBER ALTER COLUMN IDUSUALT POSITION 65;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODLANCA POSITION 3;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODSUBLANCA POSITION 4;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPPN POSITION 5;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALPN POSITION 6;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODPLAN POSITION 7;

ALTER TABLE FNSUBLANCA ALTER COLUMN STATUSSUBLANCA POSITION 8;

ALTER TABLE FNSUBLANCA ALTER COLUMN ORIGSUBLANCA POSITION 9;

ALTER TABLE FNSUBLANCA ALTER COLUMN DTCOMPSUBLANCA POSITION 10;

ALTER TABLE FNSUBLANCA ALTER COLUMN DTPREVSUBLANCA POSITION 11;

ALTER TABLE FNSUBLANCA ALTER COLUMN DATASUBLANCA POSITION 12;

ALTER TABLE FNSUBLANCA ALTER COLUMN VLRSUBLANCA POSITION 13;

ALTER TABLE FNSUBLANCA ALTER COLUMN FLAG POSITION 14;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPCC POSITION 15;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALCC POSITION 16;

ALTER TABLE FNSUBLANCA ALTER COLUMN ANOCC POSITION 17;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODCC POSITION 18;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPCL POSITION 19;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALCL POSITION 20;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODCLI POSITION 21;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPFR POSITION 22;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALFR POSITION 23;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFOR POSITION 24;

ALTER TABLE FNSUBLANCA ALTER COLUMN HISTSUBLANCA POSITION 25;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODEMPCT POSITION 26;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODFILIALCT POSITION 27;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODCONTR POSITION 28;

ALTER TABLE FNSUBLANCA ALTER COLUMN CODITCONTR POSITION 29;

ALTER TABLE FNSUBLANCA ALTER COLUMN EMMANUT POSITION 30;

ALTER TABLE FNSUBLANCA ALTER COLUMN DTINS POSITION 31;

ALTER TABLE FNSUBLANCA ALTER COLUMN HINS POSITION 32;

ALTER TABLE FNSUBLANCA ALTER COLUMN IDUSUINS POSITION 33;

ALTER TABLE FNSUBLANCA ALTER COLUMN DTALT POSITION 34;

ALTER TABLE FNSUBLANCA ALTER COLUMN HALT POSITION 35;

ALTER TABLE FNSUBLANCA ALTER COLUMN IDUSUALT POSITION 36;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFISC POSITION 3;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODITFISC POSITION 4;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ORIGFISC POSITION 5;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPTT POSITION 6;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALTT POSITION 7;

ALTER TABLE LFITCLFISCAL ALTER COLUMN TIPOFISC POSITION 8;

ALTER TABLE LFITCLFISCAL ALTER COLUMN TPREDICMSFISC POSITION 9;

ALTER TABLE LFITCLFISCAL ALTER COLUMN REDFISC POSITION 10;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODTRATTRIB POSITION 11;

ALTER TABLE LFITCLFISCAL ALTER COLUMN NOUFITFISC POSITION 12;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPFC POSITION 13;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALFC POSITION 14;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFISCCLI POSITION 15;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQFISC POSITION 16;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQFISCINTRA POSITION 17;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQLFISC POSITION 18;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQIPIFISC POSITION 19;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQPISFISC POSITION 20;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQCOFINSFISC POSITION 21;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQCSOCIALFISC POSITION 22;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQIRFISC POSITION 23;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQFUNRURALFISC POSITION 24;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQIIFISC POSITION 25;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPME POSITION 26;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALME POSITION 27;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODMENS POSITION 28;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPTM POSITION 29;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALTM POSITION 30;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODTIPOMOV POSITION 31;

ALTER TABLE LFITCLFISCAL ALTER COLUMN TIPOST POSITION 32;

ALTER TABLE LFITCLFISCAL ALTER COLUMN MARGEMVLAGR POSITION 33;

ALTER TABLE LFITCLFISCAL ALTER COLUMN GERALFISC POSITION 34;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPSP POSITION 35;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALSP POSITION 36;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODSITTRIBPIS POSITION 37;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IMPSITTRIBPIS POSITION 38;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPSC POSITION 39;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALSC POSITION 40;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODSITTRIBCOF POSITION 41;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IMPSITTRIBCOF POSITION 42;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPSI POSITION 43;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALSI POSITION 44;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODSITTRIBIPI POSITION 45;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IMPSITTRIBIPI POSITION 46;

ALTER TABLE LFITCLFISCAL ALTER COLUMN TPCALCIPI POSITION 47;

ALTER TABLE LFITCLFISCAL ALTER COLUMN VLRIPIUNIDTRIB POSITION 48;

ALTER TABLE LFITCLFISCAL ALTER COLUMN MODBCICMS POSITION 49;

ALTER TABLE LFITCLFISCAL ALTER COLUMN MODBCICMSST POSITION 50;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODPAIS POSITION 51;

ALTER TABLE LFITCLFISCAL ALTER COLUMN SIGLAUF POSITION 52;

ALTER TABLE LFITCLFISCAL ALTER COLUMN VLRPISUNIDTRIB POSITION 53;

ALTER TABLE LFITCLFISCAL ALTER COLUMN VLRCOFUNIDTRIB POSITION 54;

ALTER TABLE LFITCLFISCAL ALTER COLUMN TIPOUSOITFISC POSITION 55;

ALTER TABLE LFITCLFISCAL ALTER COLUMN REDBASEST POSITION 56;

ALTER TABLE LFITCLFISCAL ALTER COLUMN REDBASEFRETE POSITION 57;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPRA POSITION 58;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALRA POSITION 59;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODREGRA POSITION 60;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPIS POSITION 61;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALIS POSITION 62;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODSITTRIBISS POSITION 63;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IMPSITTRIBISS POSITION 64;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQISSFISC POSITION 65;

ALTER TABLE LFITCLFISCAL ALTER COLUMN RETENSAOISS POSITION 66;

ALTER TABLE LFITCLFISCAL ALTER COLUMN INDAPURIPI POSITION 67;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODEMPCN POSITION 68;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CODFILIALCN POSITION 69;

ALTER TABLE LFITCLFISCAL ALTER COLUMN CSOSN POSITION 70;

ALTER TABLE LFITCLFISCAL ALTER COLUMN ALIQICMSIMP POSITION 71;

ALTER TABLE LFITCLFISCAL ALTER COLUMN DTINS POSITION 72;

ALTER TABLE LFITCLFISCAL ALTER COLUMN HINS POSITION 73;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IDUSUINS POSITION 74;

ALTER TABLE LFITCLFISCAL ALTER COLUMN DTALT POSITION 75;

ALTER TABLE LFITCLFISCAL ALTER COLUMN HALT POSITION 76;

ALTER TABLE LFITCLFISCAL ALTER COLUMN IDUSUALT POSITION 77;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODCOMPRA POSITION 3;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODITCOMPRA POSITION 4;

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQCOFINS POSITION 5;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODEMPSP POSITION 6;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODFILIALSP POSITION 7;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODSITTRIBPIS POSITION 8;

ALTER TABLE LFITCOMPRA ALTER COLUMN IMPSITTRIBPIS POSITION 9;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODEMPSC POSITION 10;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODFILIALSC POSITION 11;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODSITTRIBCOF POSITION 12;

ALTER TABLE LFITCOMPRA ALTER COLUMN IMPSITTRIBCOF POSITION 13;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODEMPSI POSITION 14;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODFILIALSI POSITION 15;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODSITTRIBIPI POSITION 16;

ALTER TABLE LFITCOMPRA ALTER COLUMN IMPSITTRIBIPI POSITION 17;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRIPIUNIDTRIB POSITION 18;

ALTER TABLE LFITCOMPRA ALTER COLUMN MODBCICMS POSITION 19;

ALTER TABLE LFITCOMPRA ALTER COLUMN MODBCICMSST POSITION 20;

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQREDBCICMS POSITION 21;

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQREDBCICMSST POSITION 22;

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQICMSST POSITION 23;

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQPIS POSITION 24;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRPISUNIDTRIB POSITION 25;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASEPIS POSITION 26;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASECOFINS POSITION 27;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRCOFUNIDTRIB POSITION 28;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRIR POSITION 29;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRPIS POSITION 30;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRCOFINS POSITION 31;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRCSOCIAL POSITION 32;

ALTER TABLE LFITCOMPRA ALTER COLUMN ORIGFISC POSITION 33;

ALTER TABLE LFITCOMPRA ALTER COLUMN CODTRATTRIB POSITION 34;

ALTER TABLE LFITCOMPRA ALTER COLUMN MARGEMVLAGRITCOMPRA POSITION 35;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASEICMSSTITCOMPRA POSITION 36;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRICMSSTITCOMPRA POSITION 37;

ALTER TABLE LFITCOMPRA ALTER COLUMN PERCISSITCOMPRA POSITION 38;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASEISSITCOMPRA POSITION 39;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRISSITCOMPRA POSITION 40;

ALTER TABLE LFITCOMPRA ALTER COLUMN PERCICMSSIMPLES POSITION 41;

ALTER TABLE LFITCOMPRA ALTER COLUMN EMMANUT POSITION 42;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASEICMSSTITRETCOMPRA POSITION 43;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRICMSSTRETITCOMPRA POSITION 44;

ALTER TABLE LFITCOMPRA ALTER COLUMN ALIQII POSITION 45;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRBASEII POSITION 46;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRII POSITION 47;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRICMSDIFERIDO POSITION 48;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRICMSDEVIDO POSITION 49;

ALTER TABLE LFITCOMPRA ALTER COLUMN VLRICMSCREDPRESUM POSITION 50;

ALTER TABLE LFITCOMPRA ALTER COLUMN DTINS POSITION 51;

ALTER TABLE LFITCOMPRA ALTER COLUMN HINS POSITION 52;

ALTER TABLE LFITCOMPRA ALTER COLUMN IDUSUINS POSITION 53;

ALTER TABLE LFITCOMPRA ALTER COLUMN DTALT POSITION 54;

ALTER TABLE LFITCOMPRA ALTER COLUMN HALT POSITION 55;

ALTER TABLE LFITCOMPRA ALTER COLUMN IDUSUALT POSITION 56;

ALTER TABLE PPFASE ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE PPFASE ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE PPFASE ALTER COLUMN CODFASE POSITION 3;

ALTER TABLE PPFASE ALTER COLUMN DESCFASE POSITION 4;

ALTER TABLE PPFASE ALTER COLUMN TIPOFASE POSITION 5;

ALTER TABLE PPFASE ALTER COLUMN EXTERNAFASE POSITION 6;

ALTER TABLE PPFASE ALTER COLUMN DTINS POSITION 7;

ALTER TABLE PPFASE ALTER COLUMN HINS POSITION 8;

ALTER TABLE PPFASE ALTER COLUMN IDUSUINS POSITION 9;

ALTER TABLE PPFASE ALTER COLUMN DTALT POSITION 10;

ALTER TABLE PPFASE ALTER COLUMN HALT POSITION 11;

ALTER TABLE PPFASE ALTER COLUMN IDUSUALT POSITION 12;

ALTER TABLE PPITESTRUTURA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE PPITESTRUTURA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE PPITESTRUTURA ALTER COLUMN CODPROD POSITION 3;

ALTER TABLE PPITESTRUTURA ALTER COLUMN SEQEST POSITION 4;

ALTER TABLE PPITESTRUTURA ALTER COLUMN SEQITEST POSITION 5;

ALTER TABLE PPITESTRUTURA ALTER COLUMN REFPROD POSITION 6;

ALTER TABLE PPITESTRUTURA ALTER COLUMN CODEMPPD POSITION 7;

ALTER TABLE PPITESTRUTURA ALTER COLUMN CODFILIALPD POSITION 8;

ALTER TABLE PPITESTRUTURA ALTER COLUMN CODPRODPD POSITION 9;

ALTER TABLE PPITESTRUTURA ALTER COLUMN REFPRODPD POSITION 10;

ALTER TABLE PPITESTRUTURA ALTER COLUMN CODEMPFS POSITION 11;

ALTER TABLE PPITESTRUTURA ALTER COLUMN CODFILIALFS POSITION 12;

ALTER TABLE PPITESTRUTURA ALTER COLUMN CODFASE POSITION 13;

ALTER TABLE PPITESTRUTURA ALTER COLUMN SEQEF POSITION 14;

ALTER TABLE PPITESTRUTURA ALTER COLUMN QTDITEST POSITION 15;

ALTER TABLE PPITESTRUTURA ALTER COLUMN RMAAUTOITEST POSITION 16;

ALTER TABLE PPITESTRUTURA ALTER COLUMN CPROVA POSITION 17;

ALTER TABLE PPITESTRUTURA ALTER COLUMN QTDVARIAVEL POSITION 18;

ALTER TABLE PPITESTRUTURA ALTER COLUMN QTDFIXA POSITION 19;

ALTER TABLE PPITESTRUTURA ALTER COLUMN PERMITEAJUSTEITEST POSITION 20;

ALTER TABLE PPITESTRUTURA ALTER COLUMN TIPOEXTERNO POSITION 21;

ALTER TABLE PPITESTRUTURA ALTER COLUMN DTINS POSITION 22;

ALTER TABLE PPITESTRUTURA ALTER COLUMN HINS POSITION 23;

ALTER TABLE PPITESTRUTURA ALTER COLUMN IDUSUINS POSITION 24;

ALTER TABLE PPITESTRUTURA ALTER COLUMN DTALT POSITION 25;

ALTER TABLE PPITESTRUTURA ALTER COLUMN HALT POSITION 26;

ALTER TABLE PPITESTRUTURA ALTER COLUMN IDUSUALT POSITION 27;

ALTER TABLE PPITOP ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE PPITOP ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE PPITOP ALTER COLUMN CODOP POSITION 3;

ALTER TABLE PPITOP ALTER COLUMN SEQOP POSITION 4;

ALTER TABLE PPITOP ALTER COLUMN SEQITOP POSITION 5;

ALTER TABLE PPITOP ALTER COLUMN CODEMPPD POSITION 6;

ALTER TABLE PPITOP ALTER COLUMN CODFILIALPD POSITION 7;

ALTER TABLE PPITOP ALTER COLUMN CODPROD POSITION 8;

ALTER TABLE PPITOP ALTER COLUMN REFPROD POSITION 9;

ALTER TABLE PPITOP ALTER COLUMN QTDITOP POSITION 10;

ALTER TABLE PPITOP ALTER COLUMN CODEMPFS POSITION 11;

ALTER TABLE PPITOP ALTER COLUMN CODFILIALFS POSITION 12;

ALTER TABLE PPITOP ALTER COLUMN CODFASE POSITION 13;

ALTER TABLE PPITOP ALTER COLUMN CODEMPLE POSITION 14;

ALTER TABLE PPITOP ALTER COLUMN CODFILIALLE POSITION 15;

ALTER TABLE PPITOP ALTER COLUMN CODLOTE POSITION 16;

ALTER TABLE PPITOP ALTER COLUMN SEQITOPCP POSITION 17;

ALTER TABLE PPITOP ALTER COLUMN CODLOTERAT POSITION 18;

ALTER TABLE PPITOP ALTER COLUMN QTDCOPIAITOP POSITION 19;

ALTER TABLE PPITOP ALTER COLUMN GERARMA POSITION 20;

ALTER TABLE PPITOP ALTER COLUMN SEQAC POSITION 21;

ALTER TABLE PPITOP ALTER COLUMN BLOQOP POSITION 22;

ALTER TABLE PPITOP ALTER COLUMN PERMITEAJUSTEITOP POSITION 23;

ALTER TABLE PPITOP ALTER COLUMN TIPOEXTERNO POSITION 24;

ALTER TABLE PPITOP ALTER COLUMN CODEMPVD POSITION 25;

ALTER TABLE PPITOP ALTER COLUMN CODFILIALVD POSITION 26;

ALTER TABLE PPITOP ALTER COLUMN TIPOVENDA POSITION 27;

ALTER TABLE PPITOP ALTER COLUMN CODVENDA POSITION 28;

ALTER TABLE PPITOP ALTER COLUMN CODEMPCP POSITION 29;

ALTER TABLE PPITOP ALTER COLUMN CODFILIALCP POSITION 30;

ALTER TABLE PPITOP ALTER COLUMN CODCOMPRA POSITION 31;

ALTER TABLE PPITOP ALTER COLUMN DTINS POSITION 32;

ALTER TABLE PPITOP ALTER COLUMN HINS POSITION 33;

ALTER TABLE PPITOP ALTER COLUMN IDUSUINS POSITION 34;

ALTER TABLE PPITOP ALTER COLUMN DTALT POSITION 35;

ALTER TABLE PPITOP ALTER COLUMN HALT POSITION 36;

ALTER TABLE PPITOP ALTER COLUMN IDUSUALT POSITION 37;

ALTER TABLE PPOPCQ ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE PPOPCQ ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE PPOPCQ ALTER COLUMN CODOP POSITION 3;

ALTER TABLE PPOPCQ ALTER COLUMN SEQOP POSITION 4;

ALTER TABLE PPOPCQ ALTER COLUMN SEQOPCQ POSITION 5;

ALTER TABLE PPOPCQ ALTER COLUMN SEQAC POSITION 6;

ALTER TABLE PPOPCQ ALTER COLUMN CODEMPEA POSITION 7;

ALTER TABLE PPOPCQ ALTER COLUMN CODFILIALEA POSITION 8;

ALTER TABLE PPOPCQ ALTER COLUMN CODESTANALISE POSITION 9;

ALTER TABLE PPOPCQ ALTER COLUMN SEQEF POSITION 10;

ALTER TABLE PPOPCQ ALTER COLUMN VLRAFER POSITION 11;

ALTER TABLE PPOPCQ ALTER COLUMN DESCAFER POSITION 12;

ALTER TABLE PPOPCQ ALTER COLUMN STATUS POSITION 13;

ALTER TABLE PPOPCQ ALTER COLUMN DTINS POSITION 14;

ALTER TABLE PPOPCQ ALTER COLUMN HINS POSITION 15;

ALTER TABLE PPOPCQ ALTER COLUMN IDUSUINS POSITION 16;

ALTER TABLE PPOPCQ ALTER COLUMN DTALT POSITION 17;

ALTER TABLE PPOPCQ ALTER COLUMN HALT POSITION 18;

ALTER TABLE PPOPCQ ALTER COLUMN IDUSUALT POSITION 19;

ALTER TABLE PPOPITORC ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE PPOPITORC ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE PPOPITORC ALTER COLUMN CODOP POSITION 3;

ALTER TABLE PPOPITORC ALTER COLUMN SEQOP POSITION 4;

ALTER TABLE PPOPITORC ALTER COLUMN CODEMPOC POSITION 5;

ALTER TABLE PPOPITORC ALTER COLUMN CODFILIALOC POSITION 6;

ALTER TABLE PPOPITORC ALTER COLUMN TIPOORC POSITION 7;

ALTER TABLE PPOPITORC ALTER COLUMN CODORC POSITION 8;

ALTER TABLE PPOPITORC ALTER COLUMN CODITORC POSITION 9;

ALTER TABLE PPOPITORC ALTER COLUMN QTDPROD POSITION 10;

ALTER TABLE PPOPITORC ALTER COLUMN QTDFINALPRODITORC POSITION 11;

ALTER TABLE PPOPITORC ALTER COLUMN DTINS POSITION 12;

ALTER TABLE PPOPITORC ALTER COLUMN HINS POSITION 13;

ALTER TABLE PPOPITORC ALTER COLUMN IDUSUINS POSITION 14;

ALTER TABLE PPOPITORC ALTER COLUMN DTALT POSITION 15;

ALTER TABLE PPOPITORC ALTER COLUMN HALT POSITION 16;

ALTER TABLE PPOPITORC ALTER COLUMN IDUSUALT POSITION 17;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAREFPROD POSITION 3;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV POSITION 4;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTM POSITION 5;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTM POSITION 6;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAPEDSEQ POSITION 7;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAORCSEQ POSITION 8;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILTRO POSITION 9;

ALTER TABLE SGPREFERE1 ALTER COLUMN USALIQREL POSITION 10;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOPRECOCUSTO POSITION 11;

ALTER TABLE SGPREFERE1 ALTER COLUMN ANOCENTROCUSTO POSITION 12;

ALTER TABLE SGPREFERE1 ALTER COLUMN OBSORCPAD POSITION 13;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV2 POSITION 14;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT2 POSITION 15;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT2 POSITION 16;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSORC POSITION 17;

ALTER TABLE SGPREFERE1 ALTER COLUMN TITORCTXT01 POSITION 18;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV3 POSITION 19;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT3 POSITION 20;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT3 POSITION 21;

ALTER TABLE SGPREFERE1 ALTER COLUMN ORDNOTA POSITION 22;

ALTER TABLE SGPREFERE1 ALTER COLUMN SETORVENDA POSITION 23;

ALTER TABLE SGPREFERE1 ALTER COLUMN PREFCRED POSITION 24;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOPREFCRED POSITION 25;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPMO POSITION 26;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALMO POSITION 27;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODMOEDA POSITION 28;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV4 POSITION 29;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT4 POSITION 30;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT4 POSITION 31;

ALTER TABLE SGPREFERE1 ALTER COLUMN USACLASCOMIS POSITION 32;

ALTER TABLE SGPREFERE1 ALTER COLUMN PERCPRECOCUSTO POSITION 33;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODGRUP POSITION 34;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALGP POSITION 35;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPGP POSITION 36;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODMARCA POSITION 37;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALMC POSITION 38;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPMC POSITION 39;

ALTER TABLE SGPREFERE1 ALTER COLUMN RGCLIOBRIG POSITION 40;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABFRETEVD POSITION 41;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABADICVD POSITION 42;

ALTER TABLE SGPREFERE1 ALTER COLUMN TRAVATMNFVD POSITION 43;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOVALIDORC POSITION 44;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLIMESMOCNPJ POSITION 45;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTBJ POSITION 46;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTJ POSITION 47;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTJ POSITION 48;

ALTER TABLE SGPREFERE1 ALTER COLUMN CNPJOBRIGCLI POSITION 49;

ALTER TABLE SGPREFERE1 ALTER COLUMN JUROSPOSCALC POSITION 50;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPFR POSITION 51;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALFR POSITION 52;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFOR POSITION 53;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTN POSITION 54;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTN POSITION 55;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTRAN POSITION 56;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTF POSITION 57;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTF POSITION 58;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOFOR POSITION 59;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT5 POSITION 60;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT5 POSITION 61;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV5 POSITION 62;

ALTER TABLE SGPREFERE1 ALTER COLUMN ESTLOTNEG POSITION 63;

ALTER TABLE SGPREFERE1 ALTER COLUMN ESTNEG POSITION 64;

ALTER TABLE SGPREFERE1 ALTER COLUMN NATVENDA POSITION 65;

ALTER TABLE SGPREFERE1 ALTER COLUMN IPIVENDA POSITION 66;

ALTER TABLE SGPREFERE1 ALTER COLUMN CUSTOSICMS POSITION 67;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPPG POSITION 68;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALPG POSITION 69;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANOPAG POSITION 70;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTB POSITION 71;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTB POSITION 72;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTAB POSITION 73;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPCE POSITION 74;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALCE POSITION 75;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODCLASCLI POSITION 76;

ALTER TABLE SGPREFERE1 ALTER COLUMN CASASDEC POSITION 77;

ALTER TABLE SGPREFERE1 ALTER COLUMN CASASDECFIN POSITION 78;

ALTER TABLE SGPREFERE1 ALTER COLUMN COMISPDUPL POSITION 79;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT6 POSITION 80;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT6 POSITION 81;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV6 POSITION 82;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQVENDA POSITION 83;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQCOMPRA POSITION 84;

ALTER TABLE SGPREFERE1 ALTER COLUMN VENDAMATPRIM POSITION 85;

ALTER TABLE SGPREFERE1 ALTER COLUMN VENDAPATRIM POSITION 86;

ALTER TABLE SGPREFERE1 ALTER COLUMN PEPSPROD POSITION 87;

ALTER TABLE SGPREFERE1 ALTER COLUMN CNPJFOROBRIG POSITION 88;

ALTER TABLE SGPREFERE1 ALTER COLUMN INSCESTFOROBRIG POSITION 89;

ALTER TABLE SGPREFERE1 ALTER COLUMN BUSCAPRODSIMILAR POSITION 90;

ALTER TABLE SGPREFERE1 ALTER COLUMN MULTIALMOX POSITION 91;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT8 POSITION 92;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT8 POSITION 93;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV8 POSITION 94;

ALTER TABLE SGPREFERE1 ALTER COLUMN ESTNEGGRUP POSITION 95;

ALTER TABLE SGPREFERE1 ALTER COLUMN USATABPE POSITION 96;

ALTER TABLE SGPREFERE1 ALTER COLUMN TAMDESCPROD POSITION 97;

ALTER TABLE SGPREFERE1 ALTER COLUMN DESCCOMPPED POSITION 98;

ALTER TABLE SGPREFERE1 ALTER COLUMN OBSCLIVEND POSITION 99;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONTESTOQ POSITION 100;

ALTER TABLE SGPREFERE1 ALTER COLUMN DIASPEDT POSITION 101;

ALTER TABLE SGPREFERE1 ALTER COLUMN RECALCPCVENDA POSITION 102;

ALTER TABLE SGPREFERE1 ALTER COLUMN RECALCPCORC POSITION 103;

ALTER TABLE SGPREFERE1 ALTER COLUMN USALAYOUTPED POSITION 104;

ALTER TABLE SGPREFERE1 ALTER COLUMN VERIFALTPARCVENDA POSITION 105;

ALTER TABLE SGPREFERE1 ALTER COLUMN BUSCACODPRODGEN POSITION 106;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILBUSCGENPROD POSITION 107;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILBUSCGENREF POSITION 108;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILBUSCGENCODBAR POSITION 109;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILBUSCGENCODFAB POSITION 110;

ALTER TABLE SGPREFERE1 ALTER COLUMN FILBUSCGENCODFOR POSITION 111;

ALTER TABLE SGPREFERE1 ALTER COLUMN BUSCAVLRULTCOMPRA POSITION 112;

ALTER TABLE SGPREFERE1 ALTER COLUMN ICMSVENDA POSITION 113;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAPRECOZERO POSITION 114;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAIMGASSORC POSITION 115;

ALTER TABLE SGPREFERE1 ALTER COLUMN IMGASSORC POSITION 116;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONSISTCPFCLI POSITION 117;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONSISTEIECLI POSITION 118;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONSISTEIEFOR POSITION 119;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONSISTECPFFOR POSITION 120;

ALTER TABLE SGPREFERE1 ALTER COLUMN USANOMEVENDORC POSITION 121;

ALTER TABLE SGPREFERE1 ALTER COLUMN SISCONTABIL POSITION 122;

ALTER TABLE SGPREFERE1 ALTER COLUMN ATBANCOIMPBOL POSITION 123;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOCODBAR POSITION 124;

ALTER TABLE SGPREFERE1 ALTER COLUMN ADICORCOBSPED POSITION 125;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPMENSORC POSITION 126;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALMENSORC POSITION 127;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODMENSORC POSITION 128;

ALTER TABLE SGPREFERE1 ALTER COLUMN CUSTOCOMPRA POSITION 129;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABTRANSPCP POSITION 130;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABTRANSPORC POSITION 131;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABSOLCP POSITION 132;

ALTER TABLE SGPREFERE1 ALTER COLUMN ADICFRETEBASEICM POSITION 133;

ALTER TABLE SGPREFERE1 ALTER COLUMN PRECOCPREL POSITION 134;

ALTER TABLE SGPREFERE1 ALTER COLUMN DESCORC POSITION 135;

ALTER TABLE SGPREFERE1 ALTER COLUMN MULTICOMIS POSITION 136;

ALTER TABLE SGPREFERE1 ALTER COLUMN USUATIVCLI POSITION 137;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPHISTREC POSITION 138;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALHISTREC POSITION 139;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODHISTREC POSITION 140;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPHISTPAG POSITION 141;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALHISTPAG POSITION 142;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODHISTPAG POSITION 143;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTC POSITION 144;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTC POSITION 145;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOCLI POSITION 146;

ALTER TABLE SGPREFERE1 ALTER COLUMN ESTITRECALTDTVENC POSITION 147;

ALTER TABLE SGPREFERE1 ALTER COLUMN LCREDGLOBAL POSITION 148;

ALTER TABLE SGPREFERE1 ALTER COLUMN VDMANUTCOMOBRIG POSITION 149;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSPED POSITION 150;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOCLASSPED POSITION 151;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAIBGECLI POSITION 152;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAIBGEFOR POSITION 153;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAIBGETRANSP POSITION 154;

ALTER TABLE SGPREFERE1 ALTER COLUMN SOMAVOLUMES POSITION 155;

ALTER TABLE SGPREFERE1 ALTER COLUMN BUSCACEP POSITION 156;

ALTER TABLE SGPREFERE1 ALTER COLUMN URLWSCEP POSITION 157;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSCP POSITION 158;

ALTER TABLE SGPREFERE1 ALTER COLUMN LABELOBS01CP POSITION 159;

ALTER TABLE SGPREFERE1 ALTER COLUMN LABELOBS02CP POSITION 160;

ALTER TABLE SGPREFERE1 ALTER COLUMN LABELOBS03CP POSITION 161;

ALTER TABLE SGPREFERE1 ALTER COLUMN LABELOBS04CP POSITION 162;

ALTER TABLE SGPREFERE1 ALTER COLUMN CONSISTEIEPF POSITION 163;

ALTER TABLE SGPREFERE1 ALTER COLUMN CREDICMSSIMPLES POSITION 164;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPMS POSITION 165;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALMS POSITION 166;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODMENSICMSSIMPLES POSITION 167;

ALTER TABLE SGPREFERE1 ALTER COLUMN GERACOMISVENDAORC POSITION 168;

ALTER TABLE SGPREFERE1 ALTER COLUMN GERACODUNIF POSITION 169;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOV9 POSITION 170;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALT9 POSITION 171;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPT9 POSITION 172;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPJP POSITION 173;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALJP POSITION 174;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANJP POSITION 175;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPJR POSITION 176;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALJR POSITION 177;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANJR POSITION 178;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPDR POSITION 179;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALDR POSITION 180;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANDR POSITION 181;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPDC POSITION 182;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALDC POSITION 183;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANDC POSITION 184;

ALTER TABLE SGPREFERE1 ALTER COLUMN GERAPAGEMIS POSITION 185;

ALTER TABLE SGPREFERE1 ALTER COLUMN LANCAFINCONTR POSITION 186;

ALTER TABLE SGPREFERE1 ALTER COLUMN LANCARMACONTR POSITION 187;

ALTER TABLE SGPREFERE1 ALTER COLUMN CASASDECPRE POSITION 188;

ALTER TABLE SGPREFERE1 ALTER COLUMN VISUALIZALUCR POSITION 189;

ALTER TABLE SGPREFERE1 ALTER COLUMN CLASSNFE POSITION 190;

ALTER TABLE SGPREFERE1 ALTER COLUMN DIRNFE POSITION 191;

ALTER TABLE SGPREFERE1 ALTER COLUMN DIRNFELIN POSITION 192;

ALTER TABLE SGPREFERE1 ALTER COLUMN FORMATODANFE POSITION 193;

ALTER TABLE SGPREFERE1 ALTER COLUMN AMBIENTENFE POSITION 194;

ALTER TABLE SGPREFERE1 ALTER COLUMN PROCEMINFE POSITION 195;

ALTER TABLE SGPREFERE1 ALTER COLUMN VERPROCNFE POSITION 196;

ALTER TABLE SGPREFERE1 ALTER COLUMN KEYLICNFE POSITION 197;

ALTER TABLE SGPREFERE1 ALTER COLUMN DTVENCTONFE POSITION 198;

ALTER TABLE SGPREFERE1 ALTER COLUMN INFADPRODNFE POSITION 199;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPNF POSITION 200;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALNF POSITION 201;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMAILNF POSITION 202;

ALTER TABLE SGPREFERE1 ALTER COLUMN EXIBEPARCOBSDANFE POSITION 203;

ALTER TABLE SGPREFERE1 ALTER COLUMN VERSAONFE POSITION 204;

ALTER TABLE SGPREFERE1 ALTER COLUMN REGIMETRIBNFE POSITION 205;

ALTER TABLE SGPREFERE1 ALTER COLUMN INFCPDEVOLUCAO POSITION 206;

ALTER TABLE SGPREFERE1 ALTER COLUMN INFVDREMESSA POSITION 207;

ALTER TABLE SGPREFERE1 ALTER COLUMN GERARECEMIS POSITION 208;

ALTER TABLE SGPREFERE1 ALTER COLUMN RETENSAOIMP POSITION 209;

ALTER TABLE SGPREFERE1 ALTER COLUMN TIPOCUSTOLUC POSITION 210;

ALTER TABLE SGPREFERE1 ALTER COLUMN TABIMPORTCP POSITION 211;

ALTER TABLE SGPREFERE1 ALTER COLUMN HABVLRTOTITORC POSITION 212;

ALTER TABLE SGPREFERE1 ALTER COLUMN USABUSCAGENPRODCP POSITION 213;

ALTER TABLE SGPREFERE1 ALTER COLUMN ADICOBSORCPED POSITION 214;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAPRECOCOT POSITION 215;

ALTER TABLE SGPREFERE1 ALTER COLUMN BLOQPRECOAPROV POSITION 216;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPFT POSITION 217;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALFT POSITION 218;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOFORFT POSITION 219;

ALTER TABLE SGPREFERE1 ALTER COLUMN USAPRECOCOMIS POSITION 220;

ALTER TABLE SGPREFERE1 ALTER COLUMN ESPECIALCOMIS POSITION 221;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALTS POSITION 222;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOVS POSITION 223;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPTS POSITION 224;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPSV POSITION 225;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALSV POSITION 226;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANOPAGSV POSITION 227;

ALTER TABLE SGPREFERE1 ALTER COLUMN ARREDPRECO POSITION 228;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPPC POSITION 229;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALPC POSITION 230;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODPLANPC POSITION 231;

ALTER TABLE SGPREFERE1 ALTER COLUMN TPNOSSONUMERO POSITION 232;

ALTER TABLE SGPREFERE1 ALTER COLUMN IMPDOCBOL POSITION 233;

ALTER TABLE SGPREFERE1 ALTER COLUMN FECHACAIXA POSITION 234;

ALTER TABLE SGPREFERE1 ALTER COLUMN FECHACAIXAAUTO POSITION 235;

ALTER TABLE SGPREFERE1 ALTER COLUMN NUMDIGIDENTTIT POSITION 236;

ALTER TABLE SGPREFERE1 ALTER COLUMN KEYLICEFD POSITION 237;

ALTER TABLE SGPREFERE1 ALTER COLUMN DTVENCTOEFD POSITION 238;

ALTER TABLE SGPREFERE1 ALTER COLUMN REVALIDARLOTECOMPRA POSITION 239;

ALTER TABLE SGPREFERE1 ALTER COLUMN ENCORCPROD POSITION 240;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPIM POSITION 241;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALIM POSITION 242;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODTIPOMOVIM POSITION 243;

ALTER TABLE SGPREFERE1 ALTER COLUMN COMISSAODESCONTO POSITION 244;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODEMPHC POSITION 245;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODFILIALHC POSITION 246;

ALTER TABLE SGPREFERE1 ALTER COLUMN CODHISTCNAB POSITION 247;

ALTER TABLE SGPREFERE1 ALTER COLUMN ALINHATELALANCA POSITION 248;

ALTER TABLE SGPREFERE1 ALTER COLUMN DTINS POSITION 249;

ALTER TABLE SGPREFERE1 ALTER COLUMN HINS POSITION 250;

ALTER TABLE SGPREFERE1 ALTER COLUMN IDUSUINS POSITION 251;

ALTER TABLE SGPREFERE1 ALTER COLUMN DTALT POSITION 252;

ALTER TABLE SGPREFERE1 ALTER COLUMN HALT POSITION 253;

ALTER TABLE SGPREFERE1 ALTER COLUMN IDUSUALT POSITION 254;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGPREFERE3 ALTER COLUMN SMTPMAIL POSITION 3;

ALTER TABLE SGPREFERE3 ALTER COLUMN SMTPSSLMAIL POSITION 4;

ALTER TABLE SGPREFERE3 ALTER COLUMN SMTPAUTMAIL POSITION 5;

ALTER TABLE SGPREFERE3 ALTER COLUMN PORTAMAIL POSITION 6;

ALTER TABLE SGPREFERE3 ALTER COLUMN USERMAIL POSITION 7;

ALTER TABLE SGPREFERE3 ALTER COLUMN PASSMAIL POSITION 8;

ALTER TABLE SGPREFERE3 ALTER COLUMN ENDMAIL POSITION 9;

ALTER TABLE SGPREFERE3 ALTER COLUMN AUTOHORATEND POSITION 10;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPCE POSITION 11;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALCE POSITION 12;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODATIVCE POSITION 13;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPTE POSITION 14;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALTE POSITION 15;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODATIVTE POSITION 16;

ALTER TABLE SGPREFERE3 ALTER COLUMN BLOQATENDCLIATRASO POSITION 17;

ALTER TABLE SGPREFERE3 ALTER COLUMN MOSTRACLIATRASO POSITION 18;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPNC POSITION 19;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALNC POSITION 20;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMAILNC POSITION 21;

ALTER TABLE SGPREFERE3 ALTER COLUMN DTINS POSITION 22;

ALTER TABLE SGPREFERE3 ALTER COLUMN HINS POSITION 23;

ALTER TABLE SGPREFERE3 ALTER COLUMN IDUSUINS POSITION 24;

ALTER TABLE SGPREFERE3 ALTER COLUMN DTALT POSITION 25;

ALTER TABLE SGPREFERE3 ALTER COLUMN HALT POSITION 26;

ALTER TABLE SGPREFERE3 ALTER COLUMN IDUSUALT POSITION 27;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPEC POSITION 28;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALEC POSITION 29;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMAILEC POSITION 30;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMPEA POSITION 31;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODFILIALEA POSITION 32;

ALTER TABLE SGPREFERE3 ALTER COLUMN CODEMAILEA POSITION 33;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE SGPREFERE5 ALTER COLUMN CLASSOP POSITION 3;

ALTER TABLE SGPREFERE5 ALTER COLUMN NOMERESP POSITION 4;

ALTER TABLE SGPREFERE5 ALTER COLUMN IDENTPROFRESP POSITION 5;

ALTER TABLE SGPREFERE5 ALTER COLUMN CARGORESP POSITION 6;

ALTER TABLE SGPREFERE5 ALTER COLUMN MESESDESCCP POSITION 7;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODTIPOMOV POSITION 8;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPTM POSITION 9;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALTM POSITION 10;

ALTER TABLE SGPREFERE5 ALTER COLUMN SITRMAOP POSITION 11;

ALTER TABLE SGPREFERE5 ALTER COLUMN IMGASSRESP POSITION 12;

ALTER TABLE SGPREFERE5 ALTER COLUMN BAIXARMAAPROV POSITION 13;

ALTER TABLE SGPREFERE5 ALTER COLUMN RATAUTO POSITION 14;

ALTER TABLE SGPREFERE5 ALTER COLUMN APAGARMAOP POSITION 15;

ALTER TABLE SGPREFERE5 ALTER COLUMN NOMERELANAL POSITION 16;

ALTER TABLE SGPREFERE5 ALTER COLUMN SITPADOP POSITION 17;

ALTER TABLE SGPREFERE5 ALTER COLUMN SITPADOPCONV POSITION 18;

ALTER TABLE SGPREFERE5 ALTER COLUMN HABCONVCP POSITION 19;

ALTER TABLE SGPREFERE5 ALTER COLUMN PRODETAPAS POSITION 20;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPTS POSITION 21;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALTS POSITION 22;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODTIPOMOVSP POSITION 23;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPEN POSITION 24;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALEN POSITION 25;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODTIPOMOVEN POSITION 26;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODEMPRE POSITION 27;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODFILIALRE POSITION 28;

ALTER TABLE SGPREFERE5 ALTER COLUMN CODTIPOMOVRE POSITION 29;

ALTER TABLE SGPREFERE5 ALTER COLUMN DTINS POSITION 30;

ALTER TABLE SGPREFERE5 ALTER COLUMN HINS POSITION 31;

ALTER TABLE SGPREFERE5 ALTER COLUMN IDUSUINS POSITION 32;

ALTER TABLE SGPREFERE5 ALTER COLUMN DTALT POSITION 33;

ALTER TABLE SGPREFERE5 ALTER COLUMN HALT POSITION 34;

ALTER TABLE SGPREFERE5 ALTER COLUMN IDUSUALT POSITION 35;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCLI POSITION 3;

ALTER TABLE VDCLIENTE ALTER COLUMN RAZCLI POSITION 4;

ALTER TABLE VDCLIENTE ALTER COLUMN NOMECLI POSITION 5;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPCC POSITION 6;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALCC POSITION 7;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCLASCLI POSITION 8;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPVD POSITION 9;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALVD POSITION 10;

ALTER TABLE VDCLIENTE ALTER COLUMN CODVEND POSITION 11;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPTC POSITION 12;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALTC POSITION 13;

ALTER TABLE VDCLIENTE ALTER COLUMN CODTIPOCOB POSITION 14;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPPG POSITION 15;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALPG POSITION 16;

ALTER TABLE VDCLIENTE ALTER COLUMN CODPLANOPAG POSITION 17;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPTN POSITION 18;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALTN POSITION 19;

ALTER TABLE VDCLIENTE ALTER COLUMN CODTRAN POSITION 20;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPBO POSITION 21;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALBO POSITION 22;

ALTER TABLE VDCLIENTE ALTER COLUMN CODBANCO POSITION 23;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPSR POSITION 24;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALSR POSITION 25;

ALTER TABLE VDCLIENTE ALTER COLUMN CODSETOR POSITION 26;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPTI POSITION 27;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALTI POSITION 28;

ALTER TABLE VDCLIENTE ALTER COLUMN CODTIPOCLI POSITION 29;

ALTER TABLE VDCLIENTE ALTER COLUMN CODTPCRED POSITION 30;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALTR POSITION 31;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPTR POSITION 32;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFISCCLI POSITION 33;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPFC POSITION 34;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALFC POSITION 35;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPEC POSITION 36;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALEC POSITION 37;

ALTER TABLE VDCLIENTE ALTER COLUMN CODTBEC POSITION 38;

ALTER TABLE VDCLIENTE ALTER COLUMN CODITTBEC POSITION 39;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPHP POSITION 40;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALHP POSITION 41;

ALTER TABLE VDCLIENTE ALTER COLUMN CODHIST POSITION 42;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPCB POSITION 43;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALCB POSITION 44;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCARTCOB POSITION 45;

ALTER TABLE VDCLIENTE ALTER COLUMN DATACLI POSITION 46;

ALTER TABLE VDCLIENTE ALTER COLUMN PESSOACLI POSITION 47;

ALTER TABLE VDCLIENTE ALTER COLUMN ATIVOCLI POSITION 48;

ALTER TABLE VDCLIENTE ALTER COLUMN CNPJCLI POSITION 49;

ALTER TABLE VDCLIENTE ALTER COLUMN INSCCLI POSITION 50;

ALTER TABLE VDCLIENTE ALTER COLUMN CPFCLI POSITION 51;

ALTER TABLE VDCLIENTE ALTER COLUMN RGCLI POSITION 52;

ALTER TABLE VDCLIENTE ALTER COLUMN SSPCLI POSITION 53;

ALTER TABLE VDCLIENTE ALTER COLUMN ENDCLI POSITION 54;

ALTER TABLE VDCLIENTE ALTER COLUMN NUMCLI POSITION 55;

ALTER TABLE VDCLIENTE ALTER COLUMN COMPLCLI POSITION 56;

ALTER TABLE VDCLIENTE ALTER COLUMN BAIRCLI POSITION 57;

ALTER TABLE VDCLIENTE ALTER COLUMN CIDCLI POSITION 58;

ALTER TABLE VDCLIENTE ALTER COLUMN UFCLI POSITION 59;

ALTER TABLE VDCLIENTE ALTER COLUMN CEPCLI POSITION 60;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDCLI POSITION 61;

ALTER TABLE VDCLIENTE ALTER COLUMN FONECLI POSITION 62;

ALTER TABLE VDCLIENTE ALTER COLUMN RAMALCLI POSITION 63;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDFAXCLI POSITION 64;

ALTER TABLE VDCLIENTE ALTER COLUMN FAXCLI POSITION 65;

ALTER TABLE VDCLIENTE ALTER COLUMN EMAILCLI POSITION 66;

ALTER TABLE VDCLIENTE ALTER COLUMN EMAILCOB POSITION 67;

ALTER TABLE VDCLIENTE ALTER COLUMN EMAILENT POSITION 68;

ALTER TABLE VDCLIENTE ALTER COLUMN EMAILNFECLI POSITION 69;

ALTER TABLE VDCLIENTE ALTER COLUMN CONTCLI POSITION 70;

ALTER TABLE VDCLIENTE ALTER COLUMN ENDCOB POSITION 71;

ALTER TABLE VDCLIENTE ALTER COLUMN NUMCOB POSITION 72;

ALTER TABLE VDCLIENTE ALTER COLUMN COMPLCOB POSITION 73;

ALTER TABLE VDCLIENTE ALTER COLUMN BAIRCOB POSITION 74;

ALTER TABLE VDCLIENTE ALTER COLUMN CIDCOB POSITION 75;

ALTER TABLE VDCLIENTE ALTER COLUMN UFCOB POSITION 76;

ALTER TABLE VDCLIENTE ALTER COLUMN CEPCOB POSITION 77;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDFONECOB POSITION 78;

ALTER TABLE VDCLIENTE ALTER COLUMN FONECOB POSITION 79;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDFAXCOB POSITION 80;

ALTER TABLE VDCLIENTE ALTER COLUMN FAXCOB POSITION 81;

ALTER TABLE VDCLIENTE ALTER COLUMN ENDENT POSITION 82;

ALTER TABLE VDCLIENTE ALTER COLUMN NUMENT POSITION 83;

ALTER TABLE VDCLIENTE ALTER COLUMN COMPLENT POSITION 84;

ALTER TABLE VDCLIENTE ALTER COLUMN BAIRENT POSITION 85;

ALTER TABLE VDCLIENTE ALTER COLUMN CIDENT POSITION 86;

ALTER TABLE VDCLIENTE ALTER COLUMN UFENT POSITION 87;

ALTER TABLE VDCLIENTE ALTER COLUMN CEPENT POSITION 88;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDFONEENT POSITION 89;

ALTER TABLE VDCLIENTE ALTER COLUMN FONEENT POSITION 90;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDFAXENT POSITION 91;

ALTER TABLE VDCLIENTE ALTER COLUMN FAXENT POSITION 92;

ALTER TABLE VDCLIENTE ALTER COLUMN OBSCLI POSITION 93;

ALTER TABLE VDCLIENTE ALTER COLUMN AGENCIACLI POSITION 94;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPPQ POSITION 95;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALPQ POSITION 96;

ALTER TABLE VDCLIENTE ALTER COLUMN CODPESQ POSITION 97;

ALTER TABLE VDCLIENTE ALTER COLUMN INCRACLI POSITION 98;

ALTER TABLE VDCLIENTE ALTER COLUMN DTINITR POSITION 99;

ALTER TABLE VDCLIENTE ALTER COLUMN DTVENCTOTR POSITION 100;

ALTER TABLE VDCLIENTE ALTER COLUMN NIRFCLI POSITION 101;

ALTER TABLE VDCLIENTE ALTER COLUMN SIMPLESCLI POSITION 102;

ALTER TABLE VDCLIENTE ALTER COLUMN DDDCELCLI POSITION 103;

ALTER TABLE VDCLIENTE ALTER COLUMN CELCLI POSITION 104;

ALTER TABLE VDCLIENTE ALTER COLUMN NATCLI POSITION 105;

ALTER TABLE VDCLIENTE ALTER COLUMN UFNATCLI POSITION 106;

ALTER TABLE VDCLIENTE ALTER COLUMN TEMPORESCLI POSITION 107;

ALTER TABLE VDCLIENTE ALTER COLUMN APELIDOCLI POSITION 108;

ALTER TABLE VDCLIENTE ALTER COLUMN SITECLI POSITION 109;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCONTDEB POSITION 110;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCONTCRED POSITION 111;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCLICONTAB POSITION 112;

ALTER TABLE VDCLIENTE ALTER COLUMN FOTOCLI POSITION 113;

ALTER TABLE VDCLIENTE ALTER COLUMN IMGASSCLI POSITION 114;

ALTER TABLE VDCLIENTE ALTER COLUMN CODMUNIC POSITION 115;

ALTER TABLE VDCLIENTE ALTER COLUMN SIGLAUF POSITION 116;

ALTER TABLE VDCLIENTE ALTER COLUMN CODPAIS POSITION 117;

ALTER TABLE VDCLIENTE ALTER COLUMN CODMUNICENT POSITION 118;

ALTER TABLE VDCLIENTE ALTER COLUMN SIGLAUFENT POSITION 119;

ALTER TABLE VDCLIENTE ALTER COLUMN CODPAISENT POSITION 120;

ALTER TABLE VDCLIENTE ALTER COLUMN CODMUNICCOB POSITION 121;

ALTER TABLE VDCLIENTE ALTER COLUMN SIGLAUFCOB POSITION 122;

ALTER TABLE VDCLIENTE ALTER COLUMN CODPAISCOB POSITION 123;

ALTER TABLE VDCLIENTE ALTER COLUMN CODEMPUC POSITION 124;

ALTER TABLE VDCLIENTE ALTER COLUMN CODFILIALUC POSITION 125;

ALTER TABLE VDCLIENTE ALTER COLUMN CODUNIFCOD POSITION 126;

ALTER TABLE VDCLIENTE ALTER COLUMN SUFRAMACLI POSITION 127;

ALTER TABLE VDCLIENTE ALTER COLUMN PRODRURALCLI POSITION 128;

ALTER TABLE VDCLIENTE ALTER COLUMN CTOCLI POSITION 129;

ALTER TABLE VDCLIENTE ALTER COLUMN CODCNAE POSITION 130;

ALTER TABLE VDCLIENTE ALTER COLUMN INSCMUNCLI POSITION 131;

ALTER TABLE VDCLIENTE ALTER COLUMN PERCDESCCLI POSITION 132;

ALTER TABLE VDCLIENTE ALTER COLUMN CONTCLICOB POSITION 133;

ALTER TABLE VDCLIENTE ALTER COLUMN CONTCLIENT POSITION 134;

ALTER TABLE VDCLIENTE ALTER COLUMN DESCIPI POSITION 135;

ALTER TABLE VDCLIENTE ALTER COLUMN DTINS POSITION 136;

ALTER TABLE VDCLIENTE ALTER COLUMN HINS POSITION 137;

ALTER TABLE VDCLIENTE ALTER COLUMN IDUSUINS POSITION 138;

ALTER TABLE VDCLIENTE ALTER COLUMN DTALT POSITION 139;

ALTER TABLE VDCLIENTE ALTER COLUMN HALT POSITION 140;

ALTER TABLE VDCLIENTE ALTER COLUMN IDUSUALT POSITION 141;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODCOMI POSITION 3;

ALTER TABLE VDCOMISSAO ALTER COLUMN TIPOCOMI POSITION 4;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODEMPRC POSITION 5;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODFILIALRC POSITION 6;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODREC POSITION 7;

ALTER TABLE VDCOMISSAO ALTER COLUMN NPARCITREC POSITION 8;

ALTER TABLE VDCOMISSAO ALTER COLUMN VLRVENDACOMI POSITION 9;

ALTER TABLE VDCOMISSAO ALTER COLUMN VLRCOMI POSITION 10;

ALTER TABLE VDCOMISSAO ALTER COLUMN VLRPAGOCOMI POSITION 11;

ALTER TABLE VDCOMISSAO ALTER COLUMN VLRAPAGCOMI POSITION 12;

ALTER TABLE VDCOMISSAO ALTER COLUMN DATACOMI POSITION 13;

ALTER TABLE VDCOMISSAO ALTER COLUMN DTCOMPCOMI POSITION 14;

ALTER TABLE VDCOMISSAO ALTER COLUMN DTVENCCOMI POSITION 15;

ALTER TABLE VDCOMISSAO ALTER COLUMN DTPAGTOCOMI POSITION 16;

ALTER TABLE VDCOMISSAO ALTER COLUMN STATUSCOMI POSITION 17;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODEMPCI POSITION 18;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODFILIALCI POSITION 19;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODPCOMI POSITION 20;

ALTER TABLE VDCOMISSAO ALTER COLUMN FLAG POSITION 21;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODEMPCT POSITION 22;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODFILIALCT POSITION 23;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODPCOMIANT POSITION 24;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODEMPVD POSITION 25;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODFILIALVD POSITION 26;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODVEND POSITION 27;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODEMPVE POSITION 28;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODFILIALVE POSITION 29;

ALTER TABLE VDCOMISSAO ALTER COLUMN CODVENDA POSITION 30;

ALTER TABLE VDCOMISSAO ALTER COLUMN TIPOVENDA POSITION 31;

ALTER TABLE VDCOMISSAO ALTER COLUMN EMMANUT POSITION 32;

ALTER TABLE VDCOMISSAO ALTER COLUMN DTINS POSITION 33;

ALTER TABLE VDCOMISSAO ALTER COLUMN HINS POSITION 34;

ALTER TABLE VDCOMISSAO ALTER COLUMN IDUSUINS POSITION 35;

ALTER TABLE VDCOMISSAO ALTER COLUMN DTALT POSITION 36;

ALTER TABLE VDCOMISSAO ALTER COLUMN HALT POSITION 37;

ALTER TABLE VDCOMISSAO ALTER COLUMN IDUSUALT POSITION 38;

ALTER TABLE VDITCONTRATO ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDITCONTRATO ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDITCONTRATO ALTER COLUMN CODCONTR POSITION 3;

ALTER TABLE VDITCONTRATO ALTER COLUMN CODITCONTR POSITION 4;

ALTER TABLE VDITCONTRATO ALTER COLUMN DESCITCONTR POSITION 5;

ALTER TABLE VDITCONTRATO ALTER COLUMN CODEMPPD POSITION 6;

ALTER TABLE VDITCONTRATO ALTER COLUMN CODFILIALPD POSITION 7;

ALTER TABLE VDITCONTRATO ALTER COLUMN CODPROD POSITION 8;

ALTER TABLE VDITCONTRATO ALTER COLUMN QTDITCONTR POSITION 9;

ALTER TABLE VDITCONTRATO ALTER COLUMN VLRITCONTR POSITION 10;

ALTER TABLE VDITCONTRATO ALTER COLUMN CODEMPPE POSITION 11;

ALTER TABLE VDITCONTRATO ALTER COLUMN CODFILIALPE POSITION 12;

ALTER TABLE VDITCONTRATO ALTER COLUMN CODPRODPE POSITION 13;

ALTER TABLE VDITCONTRATO ALTER COLUMN VLRITCONTREXCED POSITION 14;

ALTER TABLE VDITCONTRATO ALTER COLUMN KEYLIC POSITION 15;

ALTER TABLE VDITCONTRATO ALTER COLUMN DTINS POSITION 16;

ALTER TABLE VDITCONTRATO ALTER COLUMN HINS POSITION 17;

ALTER TABLE VDITCONTRATO ALTER COLUMN IDUSUINS POSITION 18;

ALTER TABLE VDITCONTRATO ALTER COLUMN DTALT POSITION 19;

ALTER TABLE VDITCONTRATO ALTER COLUMN HALT POSITION 20;

ALTER TABLE VDITCONTRATO ALTER COLUMN IDUSUALT POSITION 21;

ALTER TABLE VDITCONTRATO ALTER COLUMN ACUMULOITCONTR POSITION 22;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDITVENDA ALTER COLUMN TIPOVENDA POSITION 3;

ALTER TABLE VDITVENDA ALTER COLUMN CODVENDA POSITION 4;

ALTER TABLE VDITVENDA ALTER COLUMN CODITVENDA POSITION 5;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPNT POSITION 6;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALNT POSITION 7;

ALTER TABLE VDITVENDA ALTER COLUMN CODNAT POSITION 8;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPPD POSITION 9;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALPD POSITION 10;

ALTER TABLE VDITVENDA ALTER COLUMN CODPROD POSITION 11;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPLE POSITION 12;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALLE POSITION 13;

ALTER TABLE VDITVENDA ALTER COLUMN CODLOTE POSITION 14;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPAX POSITION 15;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALAX POSITION 16;

ALTER TABLE VDITVENDA ALTER COLUMN CODALMOX POSITION 17;

ALTER TABLE VDITVENDA ALTER COLUMN QTDITVENDA POSITION 18;

ALTER TABLE VDITVENDA ALTER COLUMN QTDITVENDACANC POSITION 19;

ALTER TABLE VDITVENDA ALTER COLUMN PRECOITVENDA POSITION 20;

ALTER TABLE VDITVENDA ALTER COLUMN PERCDESCITVENDA POSITION 21;

ALTER TABLE VDITVENDA ALTER COLUMN VLRDESCITVENDA POSITION 22;

ALTER TABLE VDITVENDA ALTER COLUMN PERCICMSITVENDA POSITION 23;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSITVENDA POSITION 24;

ALTER TABLE VDITVENDA ALTER COLUMN VLRICMSITVENDA POSITION 25;

ALTER TABLE VDITVENDA ALTER COLUMN PERCIPIITVENDA POSITION 26;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEIPIITVENDA POSITION 27;

ALTER TABLE VDITVENDA ALTER COLUMN VLRIPIITVENDA POSITION 28;

ALTER TABLE VDITVENDA ALTER COLUMN VLRLIQITVENDA POSITION 29;

ALTER TABLE VDITVENDA ALTER COLUMN PERCCOMISITVENDA POSITION 30;

ALTER TABLE VDITVENDA ALTER COLUMN VLRCOMISITVENDA POSITION 31;

ALTER TABLE VDITVENDA ALTER COLUMN VLRADICITVENDA POSITION 32;

ALTER TABLE VDITVENDA ALTER COLUMN PERCISSITVENDA POSITION 33;

ALTER TABLE VDITVENDA ALTER COLUMN VLRISSITVENDA POSITION 34;

ALTER TABLE VDITVENDA ALTER COLUMN VLRFRETEITVENDA POSITION 35;

ALTER TABLE VDITVENDA ALTER COLUMN VLRPRODITVENDA POSITION 36;

ALTER TABLE VDITVENDA ALTER COLUMN VLRISENTASITVENDA POSITION 37;

ALTER TABLE VDITVENDA ALTER COLUMN VLROUTRASITVENDA POSITION 38;

ALTER TABLE VDITVENDA ALTER COLUMN REFPROD POSITION 39;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEISSITVENDA POSITION 40;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSBRUTITVENDA POSITION 41;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSSTITVENDA POSITION 42;

ALTER TABLE VDITVENDA ALTER COLUMN VLRICMSSTITVENDA POSITION 43;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASECOMISITVENDA POSITION 44;

ALTER TABLE VDITVENDA ALTER COLUMN MARGEMVLAGRITVENDA POSITION 45;

ALTER TABLE VDITVENDA ALTER COLUMN OBSITVENDA POSITION 46;

ALTER TABLE VDITVENDA ALTER COLUMN ORIGFISC POSITION 47;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPTT POSITION 48;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALTT POSITION 49;

ALTER TABLE VDITVENDA ALTER COLUMN CODTRATTRIB POSITION 50;

ALTER TABLE VDITVENDA ALTER COLUMN TIPOFISC POSITION 51;

ALTER TABLE VDITVENDA ALTER COLUMN TIPOST POSITION 52;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPME POSITION 53;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALME POSITION 54;

ALTER TABLE VDITVENDA ALTER COLUMN CODMENS POSITION 55;

ALTER TABLE VDITVENDA ALTER COLUMN STRDESCITVENDA POSITION 56;

ALTER TABLE VDITVENDA ALTER COLUMN QTDDEVITVENDA POSITION 57;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPLG POSITION 58;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALLG POSITION 59;

ALTER TABLE VDITVENDA ALTER COLUMN CODLOG POSITION 60;

ALTER TABLE VDITVENDA ALTER COLUMN CANCITVENDA POSITION 61;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPPE POSITION 62;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALPE POSITION 63;

ALTER TABLE VDITVENDA ALTER COLUMN CODPE POSITION 64;

ALTER TABLE VDITVENDA ALTER COLUMN DIASPE POSITION 65;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPCV POSITION 66;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALCV POSITION 67;

ALTER TABLE VDITVENDA ALTER COLUMN CODCONV POSITION 68;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPIF POSITION 69;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALIF POSITION 70;

ALTER TABLE VDITVENDA ALTER COLUMN CODFISC POSITION 71;

ALTER TABLE VDITVENDA ALTER COLUMN CODITFISC POSITION 72;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPCP POSITION 73;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALCP POSITION 74;

ALTER TABLE VDITVENDA ALTER COLUMN CODCOMPRA POSITION 75;

ALTER TABLE VDITVENDA ALTER COLUMN CODITCOMPRA POSITION 76;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPVR POSITION 77;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALVR POSITION 78;

ALTER TABLE VDITVENDA ALTER COLUMN TIPOVENDAVR POSITION 79;

ALTER TABLE VDITVENDA ALTER COLUMN CODVENDAVR POSITION 80;

ALTER TABLE VDITVENDA ALTER COLUMN CODITVENDAVR POSITION 81;

ALTER TABLE VDITVENDA ALTER COLUMN CODEMPNS POSITION 82;

ALTER TABLE VDITVENDA ALTER COLUMN CODFILIALNS POSITION 83;

ALTER TABLE VDITVENDA ALTER COLUMN NUMSERIETMP POSITION 84;

ALTER TABLE VDITVENDA ALTER COLUMN EMMANUT POSITION 85;

ALTER TABLE VDITVENDA ALTER COLUMN VLRBASEICMSSTRETITVENDA POSITION 86;

ALTER TABLE VDITVENDA ALTER COLUMN VLRICMSSTRETITVENDA POSITION 87;

ALTER TABLE VDITVENDA ALTER COLUMN DTINS POSITION 88;

ALTER TABLE VDITVENDA ALTER COLUMN HINS POSITION 89;

ALTER TABLE VDITVENDA ALTER COLUMN IDUSUINS POSITION 90;

ALTER TABLE VDITVENDA ALTER COLUMN DTALT POSITION 91;

ALTER TABLE VDITVENDA ALTER COLUMN HALT POSITION 92;

ALTER TABLE VDITVENDA ALTER COLUMN IDUSUALT POSITION 93;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODPROD POSITION 3;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODPRECOPROD POSITION 4;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODEMPTB POSITION 5;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODFILIALTB POSITION 6;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODTAB POSITION 7;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODEMPCC POSITION 8;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODFILIALCC POSITION 9;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODCLASCLI POSITION 10;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODEMPPG POSITION 11;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODFILIALPG POSITION 12;

ALTER TABLE VDPRECOPROD ALTER COLUMN CODPLANOPAG POSITION 13;

ALTER TABLE VDPRECOPROD ALTER COLUMN PRECOPROD POSITION 14;

ALTER TABLE VDPRECOPROD ALTER COLUMN TIPOPRECOPROD POSITION 15;

ALTER TABLE VDPRECOPROD ALTER COLUMN DTALTPRECO POSITION 16;

ALTER TABLE VDPRECOPROD ALTER COLUMN HALTPRECO POSITION 17;

ALTER TABLE VDPRECOPROD ALTER COLUMN PRECOANT POSITION 18;

ALTER TABLE VDPRECOPROD ALTER COLUMN IDUSUALTPRECO POSITION 19;

ALTER TABLE VDPRECOPROD ALTER COLUMN DTINS POSITION 20;

ALTER TABLE VDPRECOPROD ALTER COLUMN HINS POSITION 21;

ALTER TABLE VDPRECOPROD ALTER COLUMN IDUSUINS POSITION 22;

ALTER TABLE VDPRECOPROD ALTER COLUMN DTALT POSITION 23;

ALTER TABLE VDPRECOPROD ALTER COLUMN HALT POSITION 24;

ALTER TABLE VDPRECOPROD ALTER COLUMN IDUSUALT POSITION 25;

ALTER TABLE VDVENDA ALTER COLUMN CODEMP POSITION 1;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIAL POSITION 2;

ALTER TABLE VDVENDA ALTER COLUMN TIPOVENDA POSITION 3;

ALTER TABLE VDVENDA ALTER COLUMN CODVENDA POSITION 4;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPVD POSITION 5;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALVD POSITION 6;

ALTER TABLE VDVENDA ALTER COLUMN CODVEND POSITION 7;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPCL POSITION 8;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALCL POSITION 9;

ALTER TABLE VDVENDA ALTER COLUMN CODCLI POSITION 10;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPPG POSITION 11;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALPG POSITION 12;

ALTER TABLE VDVENDA ALTER COLUMN CODPLANOPAG POSITION 13;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPSE POSITION 14;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALSE POSITION 15;

ALTER TABLE VDVENDA ALTER COLUMN SERIE POSITION 16;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPTM POSITION 17;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALTM POSITION 18;

ALTER TABLE VDVENDA ALTER COLUMN CODTIPOMOV POSITION 19;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPCX POSITION 20;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALCX POSITION 21;

ALTER TABLE VDVENDA ALTER COLUMN CODCAIXA POSITION 22;

ALTER TABLE VDVENDA ALTER COLUMN DOCVENDA POSITION 23;

ALTER TABLE VDVENDA ALTER COLUMN DTSAIDAVENDA POSITION 24;

ALTER TABLE VDVENDA ALTER COLUMN DTEMITVENDA POSITION 25;

ALTER TABLE VDVENDA ALTER COLUMN DTCOMPVENDA POSITION 26;

ALTER TABLE VDVENDA ALTER COLUMN VLRPRODVENDA POSITION 27;

ALTER TABLE VDVENDA ALTER COLUMN PERCDESCVENDA POSITION 28;

ALTER TABLE VDVENDA ALTER COLUMN VLRDESCVENDA POSITION 29;

ALTER TABLE VDVENDA ALTER COLUMN VLRDESCITVENDA POSITION 30;

ALTER TABLE VDVENDA ALTER COLUMN VLRVENDA POSITION 31;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEICMSVENDA POSITION 32;

ALTER TABLE VDVENDA ALTER COLUMN VLRICMSVENDA POSITION 33;

ALTER TABLE VDVENDA ALTER COLUMN CALCICMSVENDA POSITION 34;

ALTER TABLE VDVENDA ALTER COLUMN IMPICMSVENDA POSITION 35;

ALTER TABLE VDVENDA ALTER COLUMN VLRISENTASVENDA POSITION 36;

ALTER TABLE VDVENDA ALTER COLUMN VLROUTRASVENDA POSITION 37;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEIPIVENDA POSITION 38;

ALTER TABLE VDVENDA ALTER COLUMN VLRLIQVENDA POSITION 39;

ALTER TABLE VDVENDA ALTER COLUMN PERCCOMISVENDA POSITION 40;

ALTER TABLE VDVENDA ALTER COLUMN VLRCOMISVENDA POSITION 41;

ALTER TABLE VDVENDA ALTER COLUMN STATUSVENDA POSITION 42;

ALTER TABLE VDVENDA ALTER COLUMN VLRFRETEVENDA POSITION 43;

ALTER TABLE VDVENDA ALTER COLUMN VLRADICVENDA POSITION 44;

ALTER TABLE VDVENDA ALTER COLUMN VLRIPIVENDA POSITION 45;

ALTER TABLE VDVENDA ALTER COLUMN CALCIPIVENDA POSITION 46;

ALTER TABLE VDVENDA ALTER COLUMN IMPIPIVENDA POSITION 47;

ALTER TABLE VDVENDA ALTER COLUMN OBSVENDA POSITION 48;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPBO POSITION 49;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALBO POSITION 50;

ALTER TABLE VDVENDA ALTER COLUMN CODBANCO POSITION 51;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPTC POSITION 52;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALTC POSITION 53;

ALTER TABLE VDVENDA ALTER COLUMN CODTIPOCOB POSITION 54;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEISSVENDA POSITION 55;

ALTER TABLE VDVENDA ALTER COLUMN VLRISSVENDA POSITION 56;

ALTER TABLE VDVENDA ALTER COLUMN CALCISSVENDA POSITION 57;

ALTER TABLE VDVENDA ALTER COLUMN IMPIISSVENDA POSITION 58;

ALTER TABLE VDVENDA ALTER COLUMN IMPNOTAVENDA POSITION 59;

ALTER TABLE VDVENDA ALTER COLUMN FLAG POSITION 60;

ALTER TABLE VDVENDA ALTER COLUMN CODCLASCOMIS POSITION 61;

ALTER TABLE VDVENDA ALTER COLUMN VLRPISVENDA POSITION 62;

ALTER TABLE VDVENDA ALTER COLUMN CALCPISVENDA POSITION 63;

ALTER TABLE VDVENDA ALTER COLUMN IMPPISVENDA POSITION 64;

ALTER TABLE VDVENDA ALTER COLUMN VLRCOFINSVENDA POSITION 65;

ALTER TABLE VDVENDA ALTER COLUMN CALCCOFINSVENDA POSITION 66;

ALTER TABLE VDVENDA ALTER COLUMN IMPCOFINSVENDA POSITION 67;

ALTER TABLE VDVENDA ALTER COLUMN VLRIRVENDA POSITION 68;

ALTER TABLE VDVENDA ALTER COLUMN CALCIRVENDA POSITION 69;

ALTER TABLE VDVENDA ALTER COLUMN IMPIRVENDA POSITION 70;

ALTER TABLE VDVENDA ALTER COLUMN VLRCSOCIALVENDA POSITION 71;

ALTER TABLE VDVENDA ALTER COLUMN CALCCSOCIALVENDA POSITION 72;

ALTER TABLE VDVENDA ALTER COLUMN IMPCSOCIALVENDA POSITION 73;

ALTER TABLE VDVENDA ALTER COLUMN PERCMCOMISVENDA POSITION 74;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPCM POSITION 75;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALCM POSITION 76;

ALTER TABLE VDVENDA ALTER COLUMN CODCLCOMIS POSITION 77;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPCB POSITION 78;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALCB POSITION 79;

ALTER TABLE VDVENDA ALTER COLUMN CODCARTCOB POSITION 80;

ALTER TABLE VDVENDA ALTER COLUMN PEDCLIVENDA POSITION 81;

ALTER TABLE VDVENDA ALTER COLUMN VLRICMSSTVENDA POSITION 82;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEICMSSTVENDA POSITION 83;

ALTER TABLE VDVENDA ALTER COLUMN EMMANUT POSITION 84;

ALTER TABLE VDVENDA ALTER COLUMN BLOQVENDA POSITION 85;

ALTER TABLE VDVENDA ALTER COLUMN VLRICMSSIMPLES POSITION 86;

ALTER TABLE VDVENDA ALTER COLUMN PERCICMSSIMPLES POSITION 87;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASEPISVENDA POSITION 88;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASECOFINSVENDA POSITION 89;

ALTER TABLE VDVENDA ALTER COLUMN VLRBASECOMIS POSITION 90;

ALTER TABLE VDVENDA ALTER COLUMN CHAVENFEVENDA POSITION 91;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPCA POSITION 92;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALCA POSITION 93;

ALTER TABLE VDVENDA ALTER COLUMN NUMCONTA POSITION 94;

ALTER TABLE VDVENDA ALTER COLUMN OBSREC POSITION 95;

ALTER TABLE VDVENDA ALTER COLUMN INFCOMPL POSITION 96;

ALTER TABLE VDVENDA ALTER COLUMN SITDOC POSITION 97;

ALTER TABLE VDVENDA ALTER COLUMN OBSNFE POSITION 98;

ALTER TABLE VDVENDA ALTER COLUMN DESCIPIVENDA POSITION 99;

ALTER TABLE VDVENDA ALTER COLUMN CODEMPOP POSITION 100;

ALTER TABLE VDVENDA ALTER COLUMN CODFILIALOP POSITION 101;

ALTER TABLE VDVENDA ALTER COLUMN SEQOP POSITION 102;

ALTER TABLE VDVENDA ALTER COLUMN CODOP POSITION 103;

ALTER TABLE VDVENDA ALTER COLUMN DTINS POSITION 104;

ALTER TABLE VDVENDA ALTER COLUMN HINS POSITION 105;

ALTER TABLE VDVENDA ALTER COLUMN IDUSUINS POSITION 106;

ALTER TABLE VDVENDA ALTER COLUMN DTALT POSITION 107;

ALTER TABLE VDVENDA ALTER COLUMN HALT POSITION 108;

ALTER TABLE VDVENDA ALTER COLUMN IDUSUALT POSITION 109;

/* DROP: -- GRANT DELETE, INSERT, SELECT, UPDATE ON LFMODDOCFISC TO ADM */
REVOKE DELETE, INSERT, SELECT, UPDATE ON LFMODDOCFISC FROM ADM;

/* Create(Add) Crant */
GRANT ALL ON LFMODDOCFISC TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON ATESPECATEND TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON CPIMPORTACAO TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON CPIMPORTACAOADIC TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON CPITIMPORTACAO TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON CRQUALIFICACAO TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON EQPRODUTOLOG TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON LFCSOSN TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON PPITESTRUTURASUBPROD TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON PPOPSUBPROD TO ADM;

GRANT DELETE, INSERT, SELECT, UPDATE ON VWPROD_PRECO_CUSTO TO ADM;

GRANT EXECUTE ON PROCEDURE FNCHECAPGTOATRASOSP TO ADM;

GRANT EXECUTE ON PROCEDURE SGRETFILIAL TO PROCEDURE FNCHECAPGTOATRASOSP;

GRANT SELECT ON ATATENDIMENTOVW01 TO ADM;

GRANT SELECT ON EQCONFESTOQVW01 TO ADM;

GRANT SELECT ON FNITRECEBER TO PROCEDURE FNCHECAPGTOATRASOSP;

GRANT SELECT ON FNRECEBER TO PROCEDURE FNCHECAPGTOATRASOSP;

GRANT SELECT ON PPLISTAOPVW01 TO ADM;

GRANT SELECT ON VWCUSTOPROJ01 TO ADM;


