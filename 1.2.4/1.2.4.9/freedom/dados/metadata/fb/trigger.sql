/* Generated by IB DB Comparer v.1.15.Beta.  23/10/2007 11:07:20 */
/* Server Version: WI-V6.3.4.4910 Firebird 1.5.  ODS Version: 10.1. */

SET NAMES NONE;

SET SQL DIALECT 3;

CONNECT '/opt/firebird/dados/vazio.fdb' USER 'SYSDBA' PASSWORD 'masterkey';

/* Create Trigger... */
CREATE TABLE "ATAGENDA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODAG" INTEGER NOT NULL,
"CODEMPSA" INTEGER NOT NULL,
"CODFILIALSA" SMALLINT NOT NULL,
"CODSETAT" INTEGER NOT NULL,
"DTACADAG" DATE DEFAULT 'today' NOT NULL,
"HORACATAG" TIME DEFAULT 'now' NOT NULL,
"DTAAG" DATE DEFAULT 'today' NOT NULL,
"HORAAG" TIME DEFAULT 'now' NOT NULL,
"DESCAGENDA" CHAR(50) CHARACTER SET NONE NOT NULL,
"CODEMPAE" INTEGER,
"CODFILIALAE" SMALLINT,
"CODATEND" INTEGER,
"DTAATENDAG" DATE,
"HORAATENDAG" TIME,
"OBSAGENDA" VARCHAR(10000) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATAGENDATGBU" FOR "ATAGENDA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATATENDENTE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODATEND" INTEGER NOT NULL,
"NOMEATEND" CHAR(50) CHARACTER SET NONE NOT NULL,
"CODEMPTA" INTEGER NOT NULL,
"CODFILIALTA" SMALLINT NOT NULL,
"CODTPATEND" INTEGER NOT NULL,
"RGATEND" CHAR(10) CHARACTER SET NONE,
"ENDATEND" CHAR(50) CHARACTER SET NONE,
"BAIRATEND" CHAR(30) CHARACTER SET NONE,
"CIDATEND" CHAR(30) CHARACTER SET NONE,
"CEPATEND" CHAR(8) CHARACTER SET NONE,
"FONEATEND" CHAR(12) CHARACTER SET NONE,
"FAXATEND" CHAR(8) CHARACTER SET NONE,
"EMAILATEND" CHAR(60) CHARACTER SET NONE,
"NUMATEND" INTEGER,
"UFATEND" CHAR(2) CHARACTER SET NONE,
"CELATEND" CHAR(8) CHARACTER SET NONE,
"IDENTIFICATEND" CHAR(18) CHARACTER SET NONE,
"CODEMPUS" INTEGER,
"CODFILIALUS" INTEGER,
"IDUSU" CHAR(8) CHARACTER SET NONE,
"CPFATEND" CHAR(11) CHARACTER SET NONE,
"CODVEND" INTEGER,
"CODEMPVE" INTEGER,
"CODFILIALVE" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATATENDENTETGBU" FOR "ATATENDENTE"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATATENDIMENTOORC"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODATENDO" INTEGER NOT NULL,
"CODEMPOC" INTEGER NOT NULL,
"CODFILIALOC" SMALLINT NOT NULL,
"TIPOORC" CHAR(1) CHARACTER SET NONE NOT NULL,
"CODORC" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATATENDIMENTOORCTGBU" FOR "ATATENDIMENTOORC"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATATENDIMENTO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODATENDO" INTEGER NOT NULL,
"CODCONV" INTEGER NOT NULL,
"CODEMPCV" INTEGER NOT NULL,
"CODFILIALCV" INTEGER NOT NULL,
"CODEMPTO" INTEGER NOT NULL,
"CODFILIALTO" SMALLINT NOT NULL,
"CODTPATENDO" INTEGER NOT NULL,
"CODEMPAE" INTEGER NOT NULL,
"CODFILIALAE" SMALLINT NOT NULL,
"CODATEND" INTEGER NOT NULL,
"CODEMPSA" INTEGER NOT NULL,
"CODFILIALSA" INTEGER NOT NULL,
"CODSETAT" INTEGER NOT NULL,
"DATAATENDO" DATE DEFAULT 'today' NOT NULL,
"HORAATENDO" TIME DEFAULT 'now' NOT NULL,
"OBSATENDO" VARCHAR(10000) CHARACTER SET NONE,
"STATUSATENDO" CHAR(2) CHARACTER SET NONE NOT NULL,
"IDUSU" CHAR(8) CHARACTER SET NONE NOT NULL,
"CODEMPUS" INTEGER NOT NULL,
"CODFILIALUS" INTEGER NOT NULL,
"DOCATENDO" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATATENDIMENTTGBU" FOR "ATATENDIMENTO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
   new.DTALT=cast('now' AS DATE );
   new.IDUSUALT=USER;
   new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATATRIBUICAO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"CODATRIB" CHAR(15) CHARACTER SET NONE NOT NULL,
"DESCATRIB" CHAR(50) CHARACTER SET NONE NOT NULL,
"OBSATRIB" VARCHAR(10000) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATATRIBUICAOTGBU" FOR "ATATRIBUICAO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATCONVATRIBTB"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCONV" INTEGER NOT NULL,
"SEQCONVATRIB" SMALLINT NOT NULL,
"CODEMPTB" INTEGER NOT NULL,
"CODFILIALTB" SMALLINT NOT NULL,
"CODTB" SMALLINT NOT NULL,
"CODITTB" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATCONVATRIBTBTGBU" FOR "ATCONVATRIBTB"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATCONVATRIB"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCONV" INTEGER NOT NULL,
"SEQCONVATRIB" SMALLINT NOT NULL,
"CODEMPAB" INTEGER NOT NULL,
"CODFILIALAB" SMALLINT NOT NULL,
"CODATRIB" CHAR(15) CHARACTER SET NONE NOT NULL,
"OBSCONVATRIB" VARCHAR(10000) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATCONVATRIBTGBU" FOR "ATCONVATRIB"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "ATADICATENDIMENTOSP"("ICODCONV" INTEGER,
"ICODTIPOATENDO" INTEGER,
"ICODATEND" INTEGER,
"ICODSETOR" INTEGER,
"VOBSATENDO" VARCHAR(10000) CHARACTER SET NONE,
"ICODEMP" INTEGER,
"ICODFILIAL" INTEGER,
"IDOC" INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATCONVENIADO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCONV" INTEGER NOT NULL,
"NOMECONV" CHAR(50) CHARACTER SET NONE NOT NULL,
"CODEMPTC" INTEGER NOT NULL,
"CODFILIALTC" SMALLINT NOT NULL,
"CODTPCONV" INTEGER NOT NULL,
"DTNASCCONV" DATE NOT NULL,
"CODEMPAE" INTEGER,
"CODFILIALAE" SMALLINT,
"CODATEND" INTEGER,
"CODEMPGI" INTEGER,
"CODFILIALGI" SMALLINT,
"CODGRI" INTEGER,
"RGCONV" CHAR(10) CHARACTER SET NONE,
"CPFCONV" CHAR(11) CHARACTER SET NONE,
"ENDCONV" CHAR(50) CHARACTER SET NONE,
"NUMCONV" INTEGER,
"BAIRCONV" CHAR(30) CHARACTER SET NONE,
"CIDCONV" CHAR(30) CHARACTER SET NONE,
"CEPCONV" CHAR(8) CHARACTER SET NONE,
"FONECONV" CHAR(12) CHARACTER SET NONE,
"FAXCONV" CHAR(8) CHARACTER SET NONE,
"EMAILCONV" CHAR(60) CHARACTER SET NONE,
"PAICONV" CHAR(50) CHARACTER SET NONE,
"MAECONV" CHAR(50) CHARACTER SET NONE,
"RGPAICONV" CHAR(10) CHARACTER SET NONE,
"RGMAECONV" CHAR(10) CHARACTER SET NONE,
"CNSCONV" CHAR(15) CHARACTER SET NONE,
"CODEMPCL" INTEGER,
"CODFILIALCL" INTEGER,
"CODCLI" INTEGER,
"UFCONV" CHAR(2) CHARACTER SET NONE,
"CELCONV" CHAR(8) CHARACTER SET NONE,
"SEXOCONV" CHAR(1) CHARACTER SET NONE,
"IDENTIFICCONV" CHAR(20) CHARACTER SET NONE,
"COMPLCONV" CHAR(20) CHARACTER SET NONE,
"CODEMPEC" INTEGER,
"CODFILIALEC" SMALLINT,
"CODENC" INTEGER,
"CODEMPFC" INTEGER,
"CODFILIALFC" SMALLINT,
"CODFUNC" INTEGER,
"ICARDCONV" CHAR(15) CHARACTER SET NONE,
"NRVIACONV" SMALLINT,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"DDDCONV" CHAR(4) CHARACTER SET NONE,
"DDDFAXCONV" CHAR(4) CHARACTER SET NONE,
"DDDCELCONV" CHAR(4) CHARACTER SET NONE);
COMMIT WORK;
CREATE TABLE "SGPREFERE2"("CODFILIAL" INTEGER NOT NULL,
"CODEMP" INTEGER NOT NULL,
"CODTPATENDO" INTEGER,
"CODFILIALTO" INTEGER,
"CODEMPTO" INTEGER,
"CODTPATENDO2" INTEGER,
"CODFILIALT2" INTEGER,
"CODEMPT2" INTEGER,
"CODTPATENDO3" INTEGER,
"CODFILIALT3" INTEGER,
"CODEMPT3" INTEGER,
"CODSETAT" INTEGER,
"CODFILIALSA" INTEGER,
"CODEMPSA" INTEGER,
"CODSETAT2" INTEGER,
"CODFILIALS2" INTEGER,
"CODEMPS2" INTEGER,
"CODEMPAE" INTEGER,
"CODFILIALAE" SMALLINT,
"CODATEND" INTEGER,
"CLASSMEDIDA" CHAR(20) CHARACTER SET NONE,
"CODEMPTI" INTEGER,
"CODFILIALTI" SMALLINT,
"CODTIPOCLI" INTEGER,
"CODEMPCI" INTEGER,
"CODFILIALCI" SMALLINT,
"CODCLASCLI" INTEGER,
"CODEMPTA" INTEGER,
"CODFILIALTA" SMALLINT,
"CODTBA" SMALLINT,
"CODITTBA" INTEGER,
"CODEMPTV" INTEGER,
"CODFILIALTV" SMALLINT,
"CODTBV" SMALLINT,
"CODITTBV" INTEGER,
"CODEMPVD" INTEGER NOT NULL,
"CODFILIALVD" SMALLINT NOT NULL,
"CODVEND" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "SGRETFILIAL"("ICODEMP" INTEGER,
"SNOMETAB" CHAR(30) CHARACTER SET NONE)
 RETURNS("ICODFILIAL" SMALLINT)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATCONVENIADOTGAI" FOR "ATCONVENIADO"
ACTIVE AFTER INSERT POSITION 0 
as
declare variable ICODATEND INTEGER;
declare variable ICODATENDO INTEGER;
declare variable ICODSETOR INTEGER;
DECLARE VARIABLE IFILIALATEND INTEGER;
DECLARE VARIABLE IFILIALPREF INTEGER;
DECLARE VARIABLE IFILIALUSU INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'ATATENDENTE') INTO IFILIALATEND;
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE2') INTO IFILIALPREF;
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGUSUARIO') INTO IFILIALUSU;
  SELECT CODATEND FROM ATATENDENTE
    WHERE CODEMP=new.CODEMP AND CODFILIAL=:IFILIALATEND
    AND IDUSU=LOWER(USER) AND CODEMPUS=new.CODEMP AND CODFILIALUS=:IFILIALUSU
    INTO ICODATEND;
  SELECT CODSETAT,CODTPATENDO2 FROM SGPREFERE2
    WHERE CODEMP=new.CODEMP AND CODFILIAL=:IFILIALPREF
    INTO ICODSETOR,ICODATENDO;
  EXECUTE PROCEDURE ATADICATENDIMENTOSP(
    new.CODCONV,:ICODATENDO,:ICODATEND,
    ICODSETOR,NULL,new.CODEMP,:IFILIALUSU,new.CODCONV
  );
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATCONVENIADOTGBI" FOR "ATCONVENIADO"
ACTIVE BEFORE INSERT POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATCONVENIADOTGBU" FOR "ATCONVENIADO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATENCAMINHADOR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODENC" INTEGER NOT NULL,
"NOMEENC" CHAR(50) CHARACTER SET NONE NOT NULL,
"ENDENC" CHAR(50) CHARACTER SET NONE,
"NUMENC" INTEGER,
"COMPLENC" CHAR(30) CHARACTER SET NONE,
"CIDENC" CHAR(30) CHARACTER SET NONE,
"BAIRENC" CHAR(30) CHARACTER SET NONE,
"UFENC" CHAR(2) CHARACTER SET NONE,
"CEPENC" CHAR(8) CHARACTER SET NONE,
"FONEENC" CHAR(12) CHARACTER SET NONE,
"FAXENC" CHAR(8) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATENCAMINHADORTGBU" FOR "ATENCAMINHADOR"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATSETORATENDENTE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODSETAT" INTEGER NOT NULL,
"CODEMPAE" INTEGER NOT NULL,
"CODFILIALAE" SMALLINT NOT NULL,
"CODATEND" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATSETORATENDENTETGBU" FOR "ATSETORATENDENTE"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATSETOR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODSETAT" INTEGER NOT NULL,
"DESCSETAT" CHAR(50) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATSETORTGBU" FOR "ATSETOR"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATTIPOATENDOSETOR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTPATENDO" INTEGER NOT NULL,
"CODEMPST" INTEGER NOT NULL,
"CODFILIALST" SMALLINT NOT NULL,
"CODSETAT" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATTIPOATENDOSETORTGBU" FOR "ATTIPOATENDOSETOR"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATTIPOATENDO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTPATENDO" INTEGER NOT NULL,
"DESCTPATENDO" CHAR(50) CHARACTER SET NONE NOT NULL,
"CODEMPFX" INTEGER,
"CODFILIALFX" SMALLINT,
"CODFLUXO" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATTIPOATENDOTGBU" FOR "ATTIPOATENDO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATTIPOATEND"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTPATEND" INTEGER NOT NULL,
"DESCTPATEND" CHAR(50) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATTIPOATENDTGBU" FOR "ATTIPOATEND"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "ATTIPOCONV"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTPCONV" INTEGER NOT NULL,
"DESCTPCONV" CHAR(50) CHARACTER SET NONE NOT NULL,
"CLASSTPCONV" CHAR(20) CHARACTER SET NONE,
"CODAUXTPCONV" CHAR(20) CHARACTER SET NONE DEFAULT ' ' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "ATTIPOCONVTGBU" FOR "ATTIPOCONV"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "CPITCOMPRA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCOMPRA" INTEGER NOT NULL,
"CODITCOMPRA" INTEGER NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODEMPLE" INTEGER,
"CODFILIALLE" SMALLINT,
"CODLOTE" CHAR(13) CHARACTER SET NONE,
"CODEMPNT" INTEGER NOT NULL,
"CODFILIALNT" SMALLINT NOT NULL,
"CODNAT" CHAR(4) CHARACTER SET NONE NOT NULL,
"CODEMPAX" INTEGER NOT NULL,
"CODFILIALAX" SMALLINT NOT NULL,
"CODALMOX" INTEGER NOT NULL,
"QTDITCOMPRA" "NUMERICDN" NOT NULL,
"PRECOITCOMPRA" "NUMERICDN" NOT NULL,
"PERCDESCITCOMPRA" NUMERIC(9,2),
"VLRDESCITCOMPRA" "NUMERICDN",
"PERCICMSITCOMPRA" NUMERIC(9,2),
"VLRBASEICMSITCOMPRA" "NUMERICDN",
"VLRICMSITCOMPRA" "NUMERICDN",
"PERCIPIITCOMPRA" NUMERIC(9,2),
"VLRBASEIPIITCOMPRA" "NUMERICDN",
"VLRIPIITCOMPRA" "NUMERICDN",
"VLRLIQITCOMPRA" "NUMERICDN",
"VLRADICITCOMPRA" "NUMERICDN",
"VLRFRETEITCOMPRA" "NUMERICDN",
"VLRISENTASITCOMPRA" "NUMERICDN",
"VLROUTRASITCOMPRA" "NUMERICDN",
"VLRPRODITCOMPRA" "NUMERICDN",
"CUSTOITCOMPRA" "NUMERICDN" DEFAULT 0,
"REFPROD" CHAR(13) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"CUSTOVDITCOMPRA" "NUMERICDN" DEFAULT 0 NOT NULL,
"EMMANUT" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL);
COMMIT WORK;
CREATE TABLE "CPCOMPRA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCOMPRA" INTEGER NOT NULL,
"CODEMPPG" INTEGER NOT NULL,
"CODFILIALPG" SMALLINT NOT NULL,
"CODPLANOPAG" INTEGER NOT NULL,
"CODEMPFR" INTEGER NOT NULL,
"CODFILIALFR" SMALLINT NOT NULL,
"CODFOR" INTEGER NOT NULL,
"CODEMPSE" INTEGER NOT NULL,
"CODFILIALSE" SMALLINT NOT NULL,
"SERIE" CHAR(4) CHARACTER SET NONE NOT NULL,
"CODEMPTM" INTEGER NOT NULL,
"CODFILIALTM" SMALLINT NOT NULL,
"CODTIPOMOV" INTEGER NOT NULL,
"DOCCOMPRA" INTEGER NOT NULL,
"DTENTCOMPRA" DATE NOT NULL,
"DTEMITCOMPRA" DATE NOT NULL,
"VLRPRODCOMPRA" "NUMERICDN",
"PERCDESCCOMPRA" NUMERIC(6,2),
"VLRDESCCOMPRA" "NUMERICDN",
"VLRDESCITCOMPRA" "NUMERICDN",
"VLRCOMPRA" "NUMERICDN",
"VLRBASEICMSCOMPRA" "NUMERICDN",
"VLRICMSCOMPRA" "NUMERICDN",
"VLRISENTASCOMPRA" "NUMERICDN",
"VLROUTRASCOMPRA" "NUMERICDN",
"VLRBASEIPICOMPRA" "NUMERICDN",
"VLRLIQCOMPRA" "NUMERICDN",
"STATUSCOMPRA" CHAR(2) CHARACTER SET NONE NOT NULL,
"VLRFRETECOMPRA" "NUMERICDN",
"VLRADICCOMPRA" "NUMERICDN",
"PERCIPICOMPRA" NUMERIC(6,2),
"VLRIPICOMPRA" "NUMERICDN",
"CODEMPBO" INTEGER,
"CODFILIALBO" SMALLINT,
"CODBANCO" CHAR(3) CHARACTER SET NONE,
"IMPNOTACOMPRA" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"BLOQCOMPRA" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"EMMANUT" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"ADICFRETECOMPRA" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"TIPOFRETECOMPRA" CHAR(1) CHARACTER SET NONE,
"OBSERVACAO" VARCHAR(1024) CHARACTER SET NONE,
"CODEMPSOL" INTEGER,
"CODFILIALSOL" SMALLINT,
"CODSOL" INTEGER);
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "FNADICPAGARSP01"("CODCOMPRA" INTEGER,
"ICODEMPPG" INTEGER,
"ICODFILIALPG" SMALLINT,
"CODPLANOPAG" INTEGER,
"ICODEMPFR" INTEGER,
"ICODFILIALFR" SMALLINT,
"CODFOR" INTEGER,
"VLRLIQCOMPRA" NUMERIC(18,2),
"DTSAIDACOMPRA" DATE,
"DOCCOMPRA" INTEGER,
"ICODEMPBO" INTEGER,
"ICODFILIALBO" SMALLINT,
"CODBANCO" CHAR(3) CHARACTER SET NONE,
"FLAG" CHAR(1) CHARACTER SET NONE,
"ICODEMP" INTEGER,
"ICODFILIAL" SMALLINT)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNPAGAR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPAG" INTEGER NOT NULL,
"CODEMPCP" INTEGER,
"CODFILIALCP" SMALLINT,
"CODCOMPRA" INTEGER,
"CODEMPPG" INTEGER NOT NULL,
"CODFILIALPG" SMALLINT NOT NULL,
"CODPLANOPAG" INTEGER NOT NULL,
"CODEMPFR" INTEGER NOT NULL,
"CODFILIALFR" SMALLINT NOT NULL,
"CODFOR" INTEGER NOT NULL,
"CODEMPBO" INTEGER,
"CODFILIALBO" SMALLINT,
"CODBANCO" CHAR(3) CHARACTER SET NONE,
"VLRDESCPAG" "NUMERICDN",
"VLRMULTAPAG" "NUMERICDN",
"VLRJUROSPAG" "NUMERICDN",
"VLRPARCPAG" "NUMERICDN" NOT NULL,
"VLRPAGOPAG" "NUMERICDN",
"VLRAPAGPAG" "NUMERICDN",
"DATAPAG" DATE,
"STATUSPAG" CHAR(2) CHARACTER SET NONE NOT NULL,
"DTQUITPAG" DATE,
"DOCPAG" INTEGER NOT NULL,
"VLRPAG" "NUMERICDN" DEFAULT 0,
"NROPARCPAG" INTEGER DEFAULT 0,
"OBSPAG" CHAR(50) CHARACTER SET NONE,
"VLRADICPAG" "NUMERICDN" DEFAULT 0,
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
CREATE TABLE "EQTIPOMOV"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTIPOMOV" INTEGER NOT NULL,
"CODEMPMN" INTEGER NOT NULL,
"CODFILIALMN" SMALLINT NOT NULL,
"CODMODNOTA" INTEGER NOT NULL,
"CODEMPSE" INTEGER NOT NULL,
"CODFILIALSE" SMALLINT NOT NULL,
"SERIE" CHAR(4) CHARACTER SET NONE NOT NULL,
"DESCTIPOMOV" CHAR(40) CHARACTER SET NONE NOT NULL,
"ESTIPOMOV" CHAR(1) CHARACTER SET NONE NOT NULL,
"FISCALTIPOMOV" CHAR(1) CHARACTER SET NONE NOT NULL,
"ESTOQTIPOMOV" CHAR(1) CHARACTER SET NONE NOT NULL,
"TIPOMOV" CHAR(2) CHARACTER SET NONE NOT NULL,
"CODEMPTB" INTEGER,
"CODFILIALTB" SMALLINT,
"CODTAB" INTEGER,
"ESPECIETIPOMOV" CHAR(4) CHARACTER SET NONE,
"CODEMPTM" INTEGER,
"CODFILIALTM" SMALLINT,
"CODTIPOMOVTM" INTEGER,
"IMPPEDTIPOMOV" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"IMPNFTIPOMOV" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"IMPBOLTIPOMOV" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"IMPRECTIPOMOV" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"REIMPNFTIPOMOV" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"TUSUTIPOMOV" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"SOMAVDTIPOMOV" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"SEQNFTIPOMOV" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"VLRMFINTIPOMOV" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"CTIPOFRETE" CHAR(1) CHARACTER SET NONE DEFAULT 'C',
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPCOMPRATGAU" FOR "CPCOMPRA"
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE iCodPag INTEGER;
  DECLARE VARIABLE dVLR NUMERIC(15, 5);
  DECLARE VARIABLE IFILIALPAG INTEGER;
  DECLARE VARIABLE TIPOMOV CHAR(2);        
  DECLARE VARIABLE ICODITEM SMALLINT;
  DECLARE VARIABLE VLRITEM NUMERIC(15, 5);    
  DECLARE VARIABLE PERCITFRETE NUMERIC(15, 5);
  DECLARE VARIABLE VLRITFRETE NUMERIC(15, 5);
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
      SELECT CODPAG FROM FNPAGAR WHERE CODCOMPRA=new.CODCOMPRA
             AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPAG INTO iCodPag;
      SELECT TIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
             AND CODEMP=new.CODEMPTM AND CODFILIAL=new.CODFILIALTM INTO TIPOMOV;
      IF ((NOT TIPOMOV IN ('DV','TR')) AND (
         (iCodPag IS NULL) OR (
         (new.CODPLANOPAG != old.CODPLANOPAG) OR
         (new.CODFOR != old.CODFOR) OR
         (new.VLRLIQCOMPRA != old.VLRLIQCOMPRA) OR
         (new.DTENTCOMPRA != old.DTENTCOMPRA) OR
         (new.DOCCOMPRA != old.DOCCOMPRA) OR
         (new.CODBANCO != old.CODBANCO)))) THEN
      BEGIN
        dVLR = new.VLRLIQCOMPRA;
        IF ((new.STATUSCOMPRA IN ('P2','C2')) AND (old.STATUSCOMPRA IN ('P1','C1'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALPAG;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA,new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,new.CODEMPFR,new.CODFILIALFR,new.CODFOR,:dVLR,new.DTENTCOMPRA,new.DOCCOMPRA,new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,new.FLAG,new.CODEMP,new.CODFILIAL);
        END
        ELSE IF ((new.STATUSCOMPRA IN ('P2','C2')) AND (old.STATUSCOMPRA IN ('P2','C2'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA,new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,new.CODEMPFR,new.CODFILIALFR,new.CODFOR,:dVLR,new.DTENTCOMPRA,new.DOCCOMPRA,new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,new.FLAG,new.CODEMP,new.CODFILIAL);
        END
        ELSE IF ((new.STATUSCOMPRA IN ('P3','C3')) AND (old.STATUSCOMPRA IN ('P3','C3'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL = :IFILIALPAG;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA,new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,new.CODEMPFR,new.CODFILIALFR,new.CODFOR,:dVLR,new.DTENTCOMPRA,new.DOCCOMPRA,new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,new.FLAG,new.CODEMP,new.CODFILIAL);
        END
      END
    /**
     Movimento do estoque
    **/
    /* Avisa os itens que a data de saida foi alterada */
      IF ( (new.DTENTCOMPRA != old.DTENTCOMPRA) OR
           (new.DOCCOMPRA != old.DOCCOMPRA) OR
           (new.CODTIPOMOV != old.CODTIPOMOV) )  THEN
        UPDATE CPITCOMPRA SET CODITCOMPRA=CODITCOMPRA WHERE
             CODCOMPRA = old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;

      IF ( (new.VLRFRETECOMPRA > 0) AND ( NOT new.VLRFRETECOMPRA = old.VLRFRETECOMPRA)  ) THEN
      BEGIN
          FOR SELECT IT.CODITCOMPRA, IT.VLRLIQITCOMPRA FROM CPITCOMPRA IT
              WHERE IT.CODEMP=new.CODEMP AND IT.CODFILIAL=new.CODFILIAL AND IT.CODCOMPRA=new.CODCOMPRA INTO :ICODITEM, :VLRITEM
              DO
              BEGIN
                  PERCITFRETE = :VLRITEM / (new.VLRLIQCOMPRA / 100);
                  VLRITFRETE =  :PERCITFRETE * (new.VLRFRETECOMPRA / 100);
                  UPDATE CPITCOMPRA CIT SET VLRFRETEITCOMPRA=:VLRITFRETE
                      WHERE CIT.CODEMP=new.CODEMP AND CIT.CODFILIAL=new.CODFILIAL
                      AND CIT.CODCOMPRA=new.CODCOMPRA AND CIT.CODITCOMPRA=:ICODITEM;
              END

      END
    END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPCOMPRATGBD" FOR "CPCOMPRA"
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  /* Trigger text */
  if ( old.BLOQCOMPRA IS NOT NULL AND old.BLOQCOMPRA='S'  ) then
      EXCEPTION CPCOMPRAEX04 'ESTA COMPRA ESTÁ BLOQUEADA!!!';
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPCOMPRATGBI" FOR "CPCOMPRA"
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE IFILIALTIPOMOV INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'EQTIPOMOV') INTO IFILIALTIPOMOV;
  SELECT T.FISCALTIPOMOV FROM EQTIPOMOV T WHERE T.CODTIPOMOV=new.CODTIPOMOV
         AND T.CODEMP=new.CODEMP AND T.CODFILIAL=:IFILIALTIPOMOV INTO new.FLAG;
  IF ( new.FLAG <> 'S') THEN
  BEGIN
    new.FLAG = 'N';
  END
  new.STATUSCOMPRA = 'P1';
  IF (new.VLRPRODCOMPRA IS NULL) THEN new.VLRPRODCOMPRA = 0;
  IF (new.VLRDESCCOMPRA IS NULL) THEN new.VLRDESCCOMPRA = 0;
  IF (new.VLRDESCITCOMPRA IS NULL) THEN new.VLRDESCITCOMPRA = 0;
  IF (new.VLRCOMPRA IS NULL) THEN new.VLRCOMPRA = 0;
  IF (new.VLRBASEICMSCOMPRA IS NULL) THEN new.VLRBASEICMSCOMPRA = 0;
  IF (new.VLRICMSCOMPRA IS NULL) THEN new.VLRICMSCOMPRA = 0;
  IF (new.VLRISENTASCOMPRA IS NULL) THEN new.VLRISENTASCOMPRA = 0;
  IF (new.VLROUTRASCOMPRA IS NULL) THEN new.VLROUTRASCOMPRA = 0;
  IF (new.VLRBASEIPICOMPRA IS NULL) THEN new.VLRBASEIPICOMPRA = 0;
  IF (new.VLRIPICOMPRA IS NULL) THEN new.VLRIPICOMPRA = 0;
  IF (new.VLRLIQCOMPRA IS NULL) THEN new.VLRLIQCOMPRA = 0;
  IF (new.VLRFRETECOMPRA IS NULL) THEN new.VLRFRETECOMPRA = 0;
  IF (new.VLRADICCOMPRA IS NULL) THEN new.VLRADICCOMPRA = 0;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "LFNOVODOCSP"("SSERIE" CHAR(4) CHARACTER SET NONE,
"ICODEMP" INTEGER,
"ICODFILIAL" SMALLINT)
 RETURNS("DOC" INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPCOMPRATGBU" FOR "CPCOMPRA"
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE dVlrPagar NUMERIC(15, 5);
  DECLARE VARIABLE sStatusPag CHAR(2);
  DECLARE VARIABLE IFILIALTIPOMOV INTEGER;
  DECLARE VARIABLE IFILIALPAG INTEGER;
  DECLARE VARIABLE CSEQNFTIPOMOV CHAR(1);
BEGIN
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  if (new.BLOQCOMPRA IS NULL) then
     new.BLOQCOMPRA='N';
  if ( ( (old.BLOQCOMPRA IS  NULL) OR (old.BLOQCOMPRA='N') ) AND (new.BLOQCOMPRA='S') )  then
  begin
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=user;
      new.HALT=cast('now' AS TIME);
  end
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      if ( (old.BLOQCOMPRA IS NOT NULL AND old.BLOQCOMPRA='S') or (new.BLOQCOMPRA='S') ) then
         EXCEPTION CPCOMPRAEX04 'ESTA COMPRA ESTÁ BLOQUEADA!!!';
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'EQTIPOMOV') INTO IFILIALTIPOMOV;
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
      SELECT T.FISCALTIPOMOV, T.SEQNFTIPOMOV FROM EQTIPOMOV T WHERE T.CODTIPOMOV=new.CODTIPOMOV
             AND T.CODEMP=new.CODEMP AND T.CODFILIAL = :IFILIALTIPOMOV INTO new.FLAG, :CSEQNFTIPOMOV;
      IF (old.IMPNOTACOMPRA IS NULL) THEN
         new.IMPNOTACOMPRA = 'N';
      IF ( (CSEQNFTIPOMOV IS NOT NULL) AND (CSEQNFTIPOMOV='S') ) THEN
      BEGIN
         IF  (new.IMPNOTACOMPRA='N') THEN
         BEGIN
            SELECT DOC FROM LFNOVODOCSP(new.Serie,new.CODEMP,new.CODFILIAL) INTO new.DocCompra;
            new.IMPNOTACOMPRA = 'S';
         END
         ELSE IF (old.DOCCOMPRA != new.DOCCOMPRA) THEN
         BEGIN
            new.DOCCOMPRA = old.DOCCOMPRA;
         END
      END

      IF ( new.FLAG <> 'S') THEN
      BEGIN
        new.FLAG = 'N';
      END
      IF (new.VLRDESCCOMPRA IS NULL) THEN
        new.VLRDESCCOMPRA = 0;
      IF (new.VLRADICCOMPRA IS NULL) THEN
        new.VLRADICCOMPRA = 0;
      IF (new.VLRFRETECOMPRA IS NULL) THEN
        new.VLRFRETECOMPRA = 0;
      IF (old.STATUSCOMPRA = 'P1')  THEN
      BEGIN
        IF (new.STATUSCOMPRA = 'C1') THEN
        BEGIN
          new.STATUSCOMPRA = 'C2';
        END
      END
      ELSE IF ((old.STATUSCOMPRA IN ('P4','C4')) AND (new.STATUSCOMPRA IN ('P4','C4'))) THEN
      BEGIN
        EXCEPTION CPCOMPRAEX03;
      END
      ELSE IF ((old.STATUSCOMPRA IN ('P2','C2')) AND (new.STATUSCOMPRA IN ('P3','C3'))) THEN
      BEGIN
        SELECT STATUSPAG,VLRPARCPAG FROM FNPAGAR WHERE CODCOMPRA=new.CODCOMPRA
             AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPAG INTO :sStatusPag,:dVlrPagar;
        IF ((sStatusPag = 'PD') AND (new.VLRLIQCOMPRA != :dVlrPagar)) THEN
          EXCEPTION CPCOMPRAEX04;
      END
  END
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "CPCOTACAO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODSOL" INTEGER NOT NULL,
"CODITSOL" SMALLINT NOT NULL,
"CODCOT" SMALLINT NOT NULL,
"DTCOT" DATE DEFAULT 'now' NOT NULL,
"IDUSUCOT" CHAR(8) CHARACTER SET NONE DEFAULT user NOT NULL,
"CODEMPFR" INTEGER NOT NULL,
"CODFILIALFR" SMALLINT NOT NULL,
"CODFOR" INTEGER NOT NULL,
"QTDCOT" "NUMERICDN" DEFAULT 0 NOT NULL,
"QTDAPROVCOT" "NUMERICDN" DEFAULT 0 NOT NULL,
"PRECOCOT" "NUMERICDN" DEFAULT 0 NOT NULL,
"SITCOMPITSOL" CHAR(2) CHARACTER SET NONE DEFAULT 'PE',
"SITAPROVITSOL" CHAR(2) CHARACTER SET NONE DEFAULT 'PE',
"SITITSOL" CHAR(2) CHARACTER SET NONE DEFAULT 'PE',
"MOTIVOCANCCOT" VARCHAR(10000) CHARACTER SET NONE,
"MOTIVOCOTABAIXO" VARCHAR(10000) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE,
"HALT" TIME,
"IDUSUALT" CHAR(8) CHARACTER SET NONE,
"VLRFRETEITCOMPRA" NUMERIC(15,5),
"PERCIPIITCOMPRA" NUMERIC(9,2),
"VLRBASEIPIITCOMPRA" NUMERIC(15,5),
"VLRIPIITCOMPRA" NUMERIC(15,5),
"VLRLIQITCOMPRA" NUMERIC(15,5));
COMMIT WORK;
CREATE TABLE "CPITSOLICITACAO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODSOL" INTEGER NOT NULL,
"CODITSOL" SMALLINT NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"REFPROD" CHAR(13) CHARACTER SET NONE NOT NULL,
"QTDITSOL" "NUMERICDN" DEFAULT 0 NOT NULL,
"QTDAPROVITSOL" "NUMERICDN" DEFAULT 0 NOT NULL,
"IDUSUITSOL" CHAR(8) CHARACTER SET NONE DEFAULT USER NOT NULL,
"DTITSOL" DATE DEFAULT 'now' NOT NULL,
"IDUSUAPROVITSOL" CHAR(8) CHARACTER SET NONE,
"DTAPROVITSOL" DATE,
"SITAPROVITSOL" CHAR(2) CHARACTER SET NONE DEFAULT 'PE' NOT NULL,
"SITCOMPITSOL" CHAR(2) CHARACTER SET NONE DEFAULT 'PE' NOT NULL,
"SITITSOL" CHAR(2) CHARACTER SET NONE DEFAULT 'PE' NOT NULL,
"CODEMPAM" INTEGER NOT NULL,
"CODFILIALAM" SMALLINT NOT NULL,
"CODALMOX" INTEGER NOT NULL,
"MOTIVOITSOL" VARCHAR(10000) CHARACTER SET NONE,
"MOTIVOAPROVITSOL" VARCHAR(10000) CHARACTER SET NONE,
"MOTIVOCOMPITSOL" VARCHAR(10000) CHARACTER SET NONE,
"IDUSUCANCITSOL" CHAR(8) CHARACTER SET NONE,
"PRIORITSOL" CHAR(1) CHARACTER SET NONE DEFAULT 'B' NOT NULL,
"MOTIVOPRIORITSOL" VARCHAR(10000) CHARACTER SET NONE,
"MOTIVOCANCITSOL" VARCHAR(10000) CHARACTER SET NONE,
"MOTIVOCOTABAIX" VARCHAR(10000) CHARACTER SET NONE,
"CODEMPUA" INTEGER,
"CODFILIALUA" SMALLINT,
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE,
"HALT" TIME,
"IDUSUALT" CHAR(8) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPCOTACAOSTSOL" FOR "CPCOTACAO"
ACTIVE AFTER INSERT OR UPDATE OR DELETE POSITION 1 
AS
DECLARE VARIABLE NUMITENS INTEGER;
DECLARE VARIABLE NUMITENSAF INTEGER;
DECLARE VARIABLE NUMITENSAP INTEGER;
DECLARE VARIABLE NUMITENSNA INTEGER;
DECLARE VARIABLE NUMITENSAT INTEGER;
DECLARE VARIABLE NUMITENSEF INTEGER;
DECLARE VARIABLE NUMITENSCA INTEGER;
begin
  if (old.sititsol!='AF') then
  begin
      select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol into :numitens;
      select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitcompitsol='EF' into :numitensef;
      select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and new.sititsol='CA' into :numitensca;
      if (:numitens=:numitensef) then
      begin
        update cpitsolicitacao set sititsol='EF' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sititsol!='EF';
      end
      else if (:numitens=:numitensca) then
      begin
        update cpitsolicitacao set sititsol='CA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sititsol!='CA';
      end
      if (new.qtdaprovcot!=old.qtdaprovcot) then
      begin
          if (new.qtdaprovcot>0) then
          begin
              update cpitsolicitacao set sititsol='EA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sititsol='PE';
              select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitaprovitsol='AP' into :numitensap;
              select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitaprovitsol='NA' into :numitensna;
              select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitaprovitsol='AT' into :numitensat;
              if(:numitens!=:numitensaf) then
              begin
                if(:numitens=:numitensat) then
                begin
                   update cpitsolicitacao set sitcompitsol='CT' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitcompitsol!='CT';
                end
                else if((:numitensap>0) or (:numitensna>0)) then
                begin
                   update cpitsolicitacao set sitcompitsol='CP' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitcompitsol!='CP';
                end
                if(:numitens=:numitensna) then
                begin
                   update cpitsolicitacao set sitcompitsol='NA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sitcompitsol!='NA';
                end
              end
          end
      end
  end
  else if (old.sititsol!='EF') then
  begin
      select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol into :numitens;
      select count(1) from cpcotacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sititsol='EF' into :numitensef;
      if (:numitens=:numitensef) then
      begin
        update cpitsolicitacao set sititsol='EF' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and coditsol = new.coditsol and sititsol!='EF';
      end
  end
  SELECT sititsol FROM cpitsolicitacao
      WHERE CODEMP=new.codemp AND CODFILIAL=new.codfilial and coditsol=new.coditsol and codsol=new.codsol
      INTO new.sititsol;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "SGRETINFOUSU"("IDUSU" CHAR(8) CHARACTER SET NONE)
 RETURNS("ANOCCUSU" SMALLINT,
"CODFILIALCCUSU" SMALLINT,
"CODEMPUSU" INTEGER,
"CODFILIALUSU" SMALLINT,
"CODCCUSU" CHAR(19) CHARACTER SET NONE,
"IDUSUS" CHAR(8) CHARACTER SET NONE,
"ALMOXARIFE" CHAR(1) CHARACTER SET NONE,
"APROVARMA" CHAR(2) CHARACTER SET NONE)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPCOTACAOTGBD" FOR "CPCOTACAO"
ACTIVE BEFORE DELETE POSITION 0 
AS
declare variable sUsuarioCN char(8);
declare variable sUsuarioRM char(8);
begin

   if(old.sititsol<>'PE') then
   begin
      exception eqitrma01;
   end

   select idusus from sgretinfousu(USER) into :sUsuarioCN;
   select rm.idusucot from cpcotacao rm where rm.codemp=old.codemp and rm.codfilial=old.codfilial and rm.codsol=old.codsol into :sUsuarioRM;
   if(:sUsuarioCN<>:sUsuarioRM)then
   begin
      exception eqitrma02;
   end
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPCOTACAOTGBI" FOR "CPCOTACAO"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  SELECT sititsol FROM cpitsolicitacao
      WHERE CODEMP=new.codemp AND CODFILIAL=new.codfilial and coditsol=new.coditsol and codsol=new.codsol
      INTO new.sititsol;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPCOTACAOTGBU" FOR "CPCOTACAO"
ACTIVE BEFORE UPDATE POSITION 0 
AS
     declare variable sRefProd Char(13);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPCOTTGBIBU" FOR "CPCOTACAO"
ACTIVE  POSITION 8 
AS
  declare variable statusitem char(2);
begin
  if (old.sititsol!='AF') then
  begin
      if (new.qtdaprovcot!=old.qtdaprovcot or (NEW.sitaprovitsol='AT') ) then
      begin
          if ((new.sitaprovitsol='AT') and (new.qtdaprovcot=0) and (old.sitaprovitsol!='AT')) then
          begin
            new.qtdaprovcot=new.qtdcot;
          end
          if (new.qtdaprovcot>0) then
          begin
            if (new.qtdaprovcot<new.qtdcot) then
            begin
                statusitem = 'AP';
            end
            else
            begin
                statusitem = 'AT';
            end
          new.sitaprovitsol=:statusitem;
          if(new.sititsol='PE') then
          begin
              new.sititsol='EA';
          end
        end
      end
  end
  if(new.sititsol='CA') then
  begin
    new.qtdaprovcot=0;
    new.sitaprovitsol='NA';
  end

end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "CPEQUIVCFOP"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODNAT" CHAR(4) CHARACTER SET NONE NOT NULL,
"CODEMPND" INTEGER NOT NULL,
"CODFILIALND" SMALLINT NOT NULL,
"CODNATND" CHAR(4) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPEQUIVCFOPTGBU" FOR "CPEQUIVCFOP"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "CPFORNECED"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODFOR" INTEGER NOT NULL,
"RAZFOR" CHAR(50) CHARACTER SET NONE NOT NULL,
"CODEMPTF" INTEGER NOT NULL,
"CODFILIALTF" SMALLINT NOT NULL,
"CODTIPOFOR" INTEGER NOT NULL,
"CODEMPBO" INTEGER,
"CODFILIALBO" SMALLINT,
"CODBANCO" CHAR(3) CHARACTER SET NONE,
"CODEMPHP" INTEGER,
"CODFILIALHP" SMALLINT,
"CODHIST" INTEGER,
"NOMEFOR" CHAR(50) CHARACTER SET NONE NOT NULL,
"DATAFOR" DATE DEFAULT 'today' NOT NULL,
"ATIVOFOR" CHAR(1) CHARACTER SET NONE,
"PESSOAFOR" CHAR(1) CHARACTER SET NONE NOT NULL,
"CNPJFOR" CHAR(14) CHARACTER SET NONE,
"CPFFOR" CHAR(11) CHARACTER SET NONE,
"INSCFOR" CHAR(15) CHARACTER SET NONE,
"RGFOR" CHAR(10) CHARACTER SET NONE,
"ENDFOR" CHAR(50) CHARACTER SET NONE,
"NUMFOR" INTEGER,
"COMPLFOR" CHAR(20) CHARACTER SET NONE,
"BAIRFOR" CHAR(30) CHARACTER SET NONE,
"CEPFOR" CHAR(8) CHARACTER SET NONE,
"CIDFOR" CHAR(30) CHARACTER SET NONE,
"UFFOR" CHAR(2) CHARACTER SET NONE,
"CONTFOR" CHAR(40) CHARACTER SET NONE,
"FONEFOR" CHAR(12) CHARACTER SET NONE,
"FAXFOR" CHAR(8) CHARACTER SET NONE,
"AGENCIAFOR" CHAR(6) CHARACTER SET NONE,
"CONTAFOR" CHAR(10) CHARACTER SET NONE,
"EMAILFOR" CHAR(50) CHARACTER SET NONE,
"OBSFOR" VARCHAR(10000) CHARACTER SET NONE,
"CELFOR" CHAR(8) CHARACTER SET NONE,
"CLIFOR" CHAR(1) CHARACTER SET NONE DEFAULT 'F',
"SSPFOR" CHAR(10) CHARACTER SET NONE,
"DDDFONEFOR" CHAR(4) CHARACTER SET NONE,
"DDDFAXFOR" CHAR(4) CHARACTER SET NONE,
"DDDCELFOR" CHAR(4) CHARACTER SET NONE,
"SITEFOR" CHAR(50) CHARACTER SET NONE,
"CODCONTDEB" VARCHAR(20) CHARACTER SET NONE,
"CODCONTCRED" VARCHAR(20) CHARACTER SET NONE,
"CODFORCONTAB" VARCHAR(20) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPFORNECEDTGBU" FOR "CPFORNECED"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "EQMOVPRODIUDSP"("CIUD" CHAR(1) CHARACTER SET NONE,
"ICODEMPPD" INTEGER,
"SCODFILIALPD" SMALLINT,
"ICODPROD" INTEGER,
"ICODEMPLE" INTEGER,
"SCODFILIALLE" SMALLINT,
"CCODLOTE" CHAR(13) CHARACTER SET NONE,
"ICODEMPTM" INTEGER,
"SCODFILIALTM" SMALLINT,
"ICODTIPOMOV" INTEGER,
"ICODEMPIV" INTEGER,
"SCODFILIALIV" SMALLINT,
"ICODINVPROD" INTEGER,
"ICODEMPCP" INTEGER,
"SCODFILIALCP" SMALLINT,
"ICODCOMPRA" INTEGER,
"SCODITCOMPRA" SMALLINT,
"ICODEMPVD" INTEGER,
"SCODFILIALVD" SMALLINT,
"CTIPOVENDA" CHAR(1) CHARACTER SET NONE,
"ICODVENDA" INTEGER,
"SCODITVENDA" SMALLINT,
"ICODEMPRM" INTEGER,
"SCODFILIALRM" SMALLINT,
"ICODRMA" INTEGER,
"SCODITRMA" SMALLINT,
"ICODEMPOP" INTEGER,
"SCODFILIALOP" SMALLINT,
"ICODOP" INTEGER,
"SSEQOP" SMALLINT,
"ICODEMPNT" INTEGER,
"SCODFILIALNT" SMALLINT,
"CCODNAT" CHAR(4) CHARACTER SET NONE,
"DDTMOVPROD" DATE,
"IDOCMOVPROD" INTEGER,
"CFLAG" CHAR(1) CHARACTER SET NONE,
"NQTDMOVPROD" NUMERIC(15,5),
"NPRECOMOVPROD" NUMERIC(15,5),
"ICODEMPAX" INTEGER,
"SCODFILIALAX" SMALLINT,
"ICODALMOX" INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITCOMPRATGAD" FOR "CPITCOMPRA"
ACTIVE AFTER DELETE POSITION 0 
AS
  DECLARE VARIABLE DDTCOMPRA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCCOMPRA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
BEGIN
  IF ( not ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) THEN
  BEGIN
      UPDATE CPCOMPRA SET VLRDESCITCOMPRA = VLRDESCITCOMPRA -old.VLRDESCITCOMPRA,
             VLRPRODCOMPRA = VLRPRODCOMPRA - old.VLRPRODITCOMPRA,
             VLRBASEICMSCOMPRA = VLRBASEICMSCOMPRA - old.VLRBASEICMSITCOMPRA,
             VLRICMSCOMPRA = VLRICMSCOMPRA -old.VLRICMSITCOMPRA,
             VLRISENTASCOMPRA = VLRISENTASCOMPRA - old.VLRISENTASITCOMPRA,
             VLROUTRASCOMPRA = VLROUTRASCOMPRA - old.VLROUTRASITCOMPRA,
             VLRBASEIPICOMPRA = VLRBASEIPICOMPRA - old.VLRBASEIPIITCOMPRA,
             VLRIPICOMPRA = VLRIPICOMPRA - old.VLRIPIITCOMPRA,
             VLRLIQCOMPRA = VLRLIQCOMPRA - old.VLRLIQITCOMPRA
             WHERE CODCOMPRA=old.CODCOMPRA
             AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
      SELECT C.DTENTCOMPRA,C.FLAG,C.DOCCOMPRA,
          C.CODEMPTM, C.CODFILIALTM, C.CODTIPOMOV
       FROM CPCOMPRA C WHERE C.CODCOMPRA = old.CODCOMPRA
          AND C.CODEMP=old.CODEMP AND C.CODFILIAL = old.CODFILIAL
      INTO :DDTCOMPRA, :CFLAG, :IDOCCOMPRA, :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV;
      EXECUTE PROCEDURE EQMOVPRODIUDSP('D', old.CODEMPPD, old.CODFILIALPD,
         old.CODPROD, old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
         :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV, null, null, null,
         old.CODEMP, old.CODFILIAL, old.CODCOMPRA, old.CODITCOMPRA,
         null, null, null, null, null, null, null, null, null,null,null,null,
         null,old.CODEMPNT, old.CODFILIALNT, old.CODNAT, :DDTCOMPRA,
         :IDOCCOMPRA, :CFLAG, old.QTDITCOMPRA, old.CUSTOITCOMPRA,
         old.CODEMPAX, old.CODFILIALAX, old.CODALMOX);
  END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITCOMPRATGAI" FOR "CPITCOMPRA"
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE DDTCOMPRA DATE;
DECLARE VARIABLE CFLAG CHAR(1);
DECLARE VARIABLE IDOCCOMPRA INTEGER;
DECLARE VARIABLE ICODEMPTM INTEGER;
DECLARE VARIABLE SCODFILIALTM SMALLINT;
DECLARE VARIABLE ICODTIPOMOV INTEGER;
BEGIN
  SELECT C.DTENTCOMPRA,C.FLAG,C.DOCCOMPRA,
      C.CODEMPTM, C.CODFILIALTM, C.CODTIPOMOV
   FROM CPCOMPRA C WHERE C.CODCOMPRA = new.CODCOMPRA
      AND C.CODEMP=new.CODEMP AND C.CODFILIAL = new.CODFILIAL
  INTO :DDTCOMPRA, :CFLAG, :IDOCCOMPRA, :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV;
  EXECUTE PROCEDURE EQMOVPRODIUDSP('I', new.CODEMPPD, new.CODFILIALPD,
     new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
     :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV, null, null, null,
     new.CODEMP, new.CODFILIAL, new.CODCOMPRA, new.CODITCOMPRA,
     null, null, null, null, null, null, null, null, null,null,null,null,null,
     new.CODEMPNT, new.CODFILIALNT, new.CODNAT, :DDTCOMPRA,
     :IDOCCOMPRA, :CFLAG, new.QTDITCOMPRA, new.CUSTOITCOMPRA,
     new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITCOMPRATGAU" FOR "CPITCOMPRA"
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE DDTCOMPRA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCCOMPRA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) ) THEN
  BEGIN
      UPDATE CPCOMPRA SET VLRDESCITCOMPRA = VLRDESCITCOMPRA -old.VLRDESCITCOMPRA + new.VLRDESCITCOMPRA,
          VLRPRODCOMPRA = VLRPRODCOMPRA - old.VLRPRODITCOMPRA + new.VLRPRODITCOMPRA,
          VLRBASEICMSCOMPRA = VLRBASEICMSCOMPRA - old.VLRBASEICMSITCOMPRA + new.VLRBASEICMSITCOMPRA,
          VLRICMSCOMPRA = VLRICMSCOMPRA -old.VLRICMSITCOMPRA + new.VLRICMSITCOMPRA,
          VLRISENTASCOMPRA = VLRISENTASCOMPRA - old.VLRISENTASITCOMPRA + new.VLRISENTASITCOMPRA,
          VLROUTRASCOMPRA = VLROUTRASCOMPRA - old.VLROUTRASITCOMPRA + new.VLROUTRASITCOMPRA,
          VLRBASEIPICOMPRA = VLRBASEIPICOMPRA - old.VLRBASEIPIITCOMPRA + new.VLRBASEIPIITCOMPRA,
          VLRIPICOMPRA = VLRIPICOMPRA - old.VLRIPIITCOMPRA + new.VLRIPIITCOMPRA,
          VLRLIQCOMPRA = VLRLIQCOMPRA - old.VLRLIQITCOMPRA + new.VLRLIQITCOMPRA
          WHERE CODCOMPRA=new.CODCOMPRA
          AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
      SELECT C.DTENTCOMPRA,C.FLAG,C.DOCCOMPRA,
          C.CODEMPTM, C.CODFILIALTM, C.CODTIPOMOV
       FROM CPCOMPRA C WHERE C.CODCOMPRA = new.CODCOMPRA
          AND C.CODEMP=new.CODEMP AND C.CODFILIAL = new.CODFILIAL
      INTO :DDTCOMPRA, :CFLAG, :IDOCCOMPRA, :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV;
      EXECUTE PROCEDURE EQMOVPRODIUDSP('U', new.CODEMPPD, new.CODFILIALPD,
         new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
         :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV, null, null, null,
         new.CODEMP, new.CODFILIAL, new.CODCOMPRA, new.CODITCOMPRA,
         null, null, null, null, null, null, null, null, null,null,null,null,null,
         new.CODEMPNT, new.CODFILIALNT, new.CODNAT, :DDTCOMPRA,
         :IDOCCOMPRA, :CFLAG, new.QTDITCOMPRA, new.CUSTOITCOMPRA,
         new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
  END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "CPCOMPRASP01"("ICODEMP" INTEGER,
"SCODFILIAL" SMALLINT,
"NQTD" NUMERIC(15,5),
"NVLRTOT" NUMERIC(15,5),
"NVLRICMS" NUMERIC(15,5))
 RETURNS("NVLRCUSTO" NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQPRODUTO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"DESCPROD" CHAR(50) CHARACTER SET NONE NOT NULL,
"REFPROD" CHAR(13) CHARACTER SET NONE NOT NULL,
"CODEMPAX" INTEGER NOT NULL,
"CODFILIALAX" SMALLINT NOT NULL,
"CODALMOX" INTEGER NOT NULL,
"CODEMPMA" INTEGER NOT NULL,
"CODFILIALMA" SMALLINT NOT NULL,
"CODMOEDA" CHAR(4) CHARACTER SET NONE NOT NULL,
"CODEMPUD" INTEGER NOT NULL,
"CODFILIALUD" SMALLINT NOT NULL,
"CODUNID" CHAR(8) CHARACTER SET NONE NOT NULL,
"CODEMPFC" INTEGER NOT NULL,
"CODFILIALFC" SMALLINT NOT NULL,
"CODFISC" CHAR(13) CHARACTER SET NONE NOT NULL,
"CODEMPMC" INTEGER NOT NULL,
"CODFILIALMC" SMALLINT NOT NULL,
"CODMARCA" CHAR(6) CHARACTER SET NONE NOT NULL,
"DESCAUXPROD" CHAR(40) CHARACTER SET NONE,
"TIPOPROD" CHAR(1) CHARACTER SET NONE NOT NULL,
"CVPROD" CHAR(1) CHARACTER SET NONE NOT NULL,
"CODEMPGP" INTEGER NOT NULL,
"CODFILIALGP" SMALLINT NOT NULL,
"CODGRUP" CHAR(14) CHARACTER SET NONE NOT NULL,
"CODBARPROD" CHAR(13) CHARACTER SET NONE,
"CLOTEPROD" CHAR(1) CHARACTER SET NONE NOT NULL,
"CODFABPROD" CHAR(13) CHARACTER SET NONE,
"COMISPROD" NUMERIC(6,2),
"PESOLIQPROD" NUMERIC(10,3),
"PESOBRUTPROD" NUMERIC(10,3),
"QTDMINPROD" "NUMERICDN",
"QTDMAXPROD" "NUMERICDN",
"DTMPMPROD" DATE,
"CUSTOMPMPROD" "NUMERICDN" DEFAULT 0,
"CUSTOPEPSPROD" "NUMERICDN" DEFAULT 0,
"PRECOBASEPROD" "NUMERICDN",
"SLDPROD" "NUMERICDN",
"SLDRESPROD" "NUMERICDN",
"SLDCONSIGPROD" "NUMERICDN",
"SLDLIQPROD" "NUMERICDN",
"ATIVOPROD" CHAR(1) CHARACTER SET NONE DEFAULT 'S',
"DTULTCPPROD" DATE,
"QTDULTCPPROD" "NUMERICDN",
"DESCCOMPPROD" VARCHAR(500) CHARACTER SET NONE,
"VERIFPROD" CHAR(1) CHARACTER SET NONE DEFAULT 'S',
"LOCALPROD" CHAR(15) CHARACTER SET NONE,
"RMAPROD" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"CODEMPPE" INTEGER,
"CODFILIALPE" SMALLINT,
"CODPE" INTEGER,
"USARECEITAPROD" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"USATELAADICPDV" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL);
COMMIT WORK;
CREATE TABLE "LFCLFISCAL"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODFISC" CHAR(13) CHARACTER SET NONE NOT NULL,
"DESCFISC" CHAR(50) CHARACTER SET NONE NOT NULL,
"TIPOFISC" CHAR(2) CHARACTER SET NONE NOT NULL,
"TPREDICMSFISC" CHAR(1) CHARACTER SET NONE DEFAULT 'B' NOT NULL,
"ALIQFISC" NUMERIC(6,2),
"ALIQLFISC" NUMERIC(6,2),
"REDFISC" NUMERIC(6,2),
"ALIQIPIFISC" NUMERIC(6,2),
"CODEMPRA" INTEGER NOT NULL,
"CODFILIALRA" SMALLINT NOT NULL,
"CODREGRA" CHAR(4) CHARACTER SET NONE NOT NULL,
"ORIGFISC" CHAR(1) CHARACTER SET NONE,
"CODEMPTT" INTEGER,
"CODFILIALTT" SMALLINT,
"CODTRATTRIB" CHAR(2) CHARACTER SET NONE,
"CODEMPME" INTEGER,
"CODFILIALME" SMALLINT,
"CODMENS" INTEGER,
"SITPISFISC" CHAR(1) CHARACTER SET NONE DEFAULT 'T',
"SITCOFINSFISC" CHAR(1) CHARACTER SET NONE DEFAULT 'T',
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITCOMPRATGBI" FOR "CPITCOMPRA"
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE sTipoFisc CHAR(2);
DECLARE VARIABLE sRefProd CHAR(13);
DECLARE VARIABLE sCustoSICMS CHAR(1);
BEGIN
  SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO sRefProd;
  IF (new.REFPROD IS NULL) THEN new.REFPROD = sRefProd;
  IF (new.VLRDESCITCOMPRA IS NULL) THEN new.VLRDESCITCOMPRA = 0;
  IF (new.VLRBASEICMSITCOMPRA IS NULL) THEN new.VLRBASEICMSITCOMPRA = 0;
  IF (new.VLRICMSITCOMPRA IS NULL) THEN new.VLRICMSITCOMPRA = 0;
  IF (new.VLRBASEIPIITCOMPRA IS NULL) THEN new.VLRBASEIPIITCOMPRA = 0;
  IF (new.VLRIPIITCOMPRA IS NULL) THEN new.VLRIPIITCOMPRA = 0;
  IF (new.VLRLIQITCOMPRA IS NULL) THEN new.VLRLIQITCOMPRA = 0;
  IF (new.VLRADICITCOMPRA IS NULL) THEN new.VLRADICITCOMPRA = 0;
  IF (new.VLRFRETEITCOMPRA IS NULL) THEN new.VLRFRETEITCOMPRA = 0;
  SELECT F.TIPOFISC FROM LFCLFISCAL F, EQPRODUTO P WHERE P.CODPROD=new.CODPROD AND
    F.CODFISC = P.CODFISC AND F.CODEMP=P.CODEMP AND F.CODFILIAL=P.CODFILIAL
         AND P.CODEMP=new.CODEMPPD AND P.CODFILIAL = new.CODFILIALPD INTO :sTipoFisc;
  IF (new.CODALMOX IS NULL) THEN
       SELECT CODEMPAX,CODFILIALAX,CODALMOX FROM EQPRODUTO WHERE
          CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD AND
          CODPROD=new.CODPROD
       INTO new.CODEMPAX, new.CODFILIALAX,new.CODALMOX;

/*
  IF (sTipoFisc = 'II') THEN
  BEGIN
    new.VLRISENTASITCOMPRA = new.VLRLIQITCOMPRA;
    new.VLRBASEICMSITCOMPRA = 0;
    new.PERCICMSITCOMPRA = 0;
    new.VLRICMSITCOMPRA = 0;
    new.VLROUTRASITCOMPRA = 0;
  END
  ELSE IF (sTipoFisc = 'FF') THEN
  BEGIN
    new.VLROUTRASITCOMPRA = new.VLRLIQITCOMPRA;
    new.VLRBASEICMSITCOMPRA = 0;
    new.PERCICMSITCOMPRA = 0;
    new.VLRICMSITCOMPRA = 0;
    new.VLRISENTASITCOMPRA = 0;
  END
  ELSE IF (sTipoFisc = 'NN') THEN
  BEGIN
    new.VLROUTRASITCOMPRA = new.VLRLIQITCOMPRA;
    new.VLRBASEICMSITCOMPRA = 0;
    new.PERCICMSITCOMPRA = 0;
    new.VLRICMSITCOMPRA = 0;
    new.VLRISENTASITCOMPRA = 0;
  END
  ELSE IF (sTipoFisc = 'TT') THEN
  BEGIN
    new.VLROUTRASITCOMPRA = 0;
    new.VLRISENTASITCOMPRA = 0;
  END
*/
  SELECT NVLRCUSTO FROM CPCOMPRASP01(new.CODEMP, new.CODFILIAL, new.QTDITCOMPRA,
     new.VLRLIQITCOMPRA, new.VLRICMSITCOMPRA) INTO new.CUSTOITCOMPRA;
  UPDATE CPCOMPRA SET VLRDESCITCOMPRA = VLRDESCITCOMPRA + new.VLRDESCITCOMPRA,
         VLRPRODCOMPRA = VLRPRODCOMPRA + new.VLRPRODITCOMPRA,
         VLRBASEICMSCOMPRA = VLRBASEICMSCOMPRA + new.VLRBASEICMSITCOMPRA,
         VLRICMSCOMPRA = VLRICMSCOMPRA + new.VLRICMSITCOMPRA,
         VLRISENTASCOMPRA = VLRISENTASCOMPRA + new.VLRISENTASITCOMPRA,
         VLROUTRASCOMPRA = VLROUTRASCOMPRA + new.VLROUTRASITCOMPRA,
         VLRBASEIPICOMPRA = VLRBASEIPICOMPRA + new.VLRBASEIPIITCOMPRA,
         VLRIPICOMPRA = VLRIPICOMPRA + new.VLRIPIITCOMPRA,
         VLRLIQCOMPRA = VLRLIQCOMPRA + new.VLRLIQITCOMPRA
         WHERE CODCOMPRA=new.CODCOMPRA
         AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITCOMPRATGBU" FOR "CPITCOMPRA"
ACTIVE BEFORE UPDATE POSITION 0 
AS
     DECLARE VARIABLE sTipoFisc CHAR(2);
     DECLARE VARIABLE sRefProd CHAR(13);
     DECLARE VARIABLE sAdicFrete CHAR(1);
     DECLARE VARIABLE VLRIT NUMERIC(15, 5);
begin
  IF ( new.EMMANUT IS NULL) THEN
      new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN
      new.DTALT = cast('today' AS DATE);
      new.IDUSUALT = USER;
      new.HALT = cast('now' AS TIME);
      IF (new.CODPROD != old.CODPROD) THEN
        EXCEPTION CPITCOMPRAEX01;
      IF (new.CODLOTE != old.CODLOTE) THEN
        EXCEPTION CPITCOMPRAEX02;

      IF (new.CODALMOX IS NULL) THEN
         SELECT CODEMPAX,CODFILIALAX,CODALMOX FROM EQPRODUTO WHERE
          CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD AND
          CODPROD=new.CODPROD
         INTO new.CODEMPAX, new.CODFILIALAX,new.CODALMOX;

      IF (old.CODALMOX IS NOT NULL) THEN
      BEGIN
         IF (old.CODALMOX!=new.CODALMOX) THEN
            EXCEPTION EQALMOX01;
      END

      VLRIT = new.VLRLIQITCOMPRA;

      SELECT F.TIPOFISC FROM LFCLFISCAL F, EQPRODUTO P WHERE P.CODPROD=new.CODPROD
             AND F.CODFISC = P.CODFISC AND F.CODEMP = P.CODEMP AND F.CODFILIAL = P.CODFILIAL
             AND P.CODEMP = new.CODEMPPD AND P.CODFILIAL = new.CODFILIALPD INTO :sTipoFisc;

      SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
             AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO sRefProd;  

      SELECT ADICFRETECOMPRA FROM CPCOMPRA WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL
             AND CODCOMPRA=new.CODCOMPRA INTO :SADICFRETE;
                 
      IF (:SADICFRETE = 'S') THEN VLRIT = new.VLRLIQITCOMPRA + new.VLRFRETEITCOMPRA;

      SELECT NVLRCUSTO FROM CPCOMPRASP01(new.CODEMP, new.CODFILIAL, new.QTDITCOMPRA,
             :VLRIT, new.VLRICMSITCOMPRA) INTO new.CUSTOITCOMPRA;

      IF (new.REFPROD IS NULL) THEN new.REFPROD = sRefProd;
    /*
      IF (sTipoFisc = 'II') THEN
      BEGIN
        new.VLRISENTASITCOMPRA = new.VLRLIQITCOMPRA;
        new.VLROUTRASITCOMPRA = 0;
      END
      ELSE IF (sTipoFisc = 'FF') THEN
      BEGIN
        new.VLROUTRASITCOMPRA = new.VLRLIQITCOMPRA;
        new.VLRISENTASITCOMPRA = 0;
      END
      ELSE IF (sTipoFisc = 'NN') THEN
      BEGIN
        new.VLROUTRASITCOMPRA = new.VLRLIQITCOMPRA;
        new.VLRISENTASITCOMPRA = 0;
      END
      ELSE IF (sTipoFisc = 'TT') THEN
      BEGIN
        new.VLROUTRASITCOMPRA = 0;
        new.VLRISENTASITCOMPRA = 0;
      END
    */
  END
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITSOLICITACAOTGBI" FOR "CPITSOLICITACAO"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  IF (new.REFPROD IS NULL) THEN
       SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
            AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO new.REFPROD;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITSOLICITACAOTGBU" FOR "CPITSOLICITACAO"
ACTIVE BEFORE UPDATE POSITION 0 
AS
     declare variable sRefProd Char(13);
     DECLARE VARIABLE ICODEMPUSU INT;
     declare variable ICODFILIALUSU smallint;
     declare variable IDUSU char(8);
begin
  /*#IBA#new.DTALT = cast('today' AS DATE);
  new.IDUSUALT = USER;
  new.HALT = cast('now' AS TIME);#IBA#*/
  IF (new.CODPROD != old.CODPROD) THEN
     EXCEPTION CPITSOLICITACAOEX01;
  IF (new.REFPROD IS NULL) THEN
  BEGIN
       SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
            AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO sRefProd;
       new.REFPROD = sRefProd;
  END

  if((new.idusuaprovitsol is null) and (new.sititsol!=old.sititsol) and ((new.sititsol= 'AP') or (new.sititsol= 'AT') )) then
  begin
    SELECT CODEMPUSU,CODFILIALUSU,IDUSUS FROM sgretinfousu(USER) into :ICODEMPUSU,:ICODFILIALUSU,:IDUSU;
    new.codempua = :ICODEMPUSU;
    new.codfilialua = :ICODFILIALUSU;
    new.idusuaprovitsol = :IDUSU;
    new.dtaprovitsol = cast('now' AS DATE);
  end
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "CPSOLICITACAO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODSOL" INTEGER NOT NULL,
"DTEMITSOL" DATE NOT NULL,
"SITSOL" CHAR(2) CHARACTER SET NONE DEFAULT 'PE' NOT NULL,
"ORIGSOL" CHAR(2) CHARACTER SET NONE DEFAULT 'AX' NOT NULL,
"MOTIVOSOL" VARCHAR(10000) CHARACTER SET NONE,
"CODEMPUU" INTEGER NOT NULL,
"CODFILIALUU" SMALLINT NOT NULL,
"IDUSU" CHAR(8) CHARACTER SET NONE NOT NULL,
"DTAAPROVSOL" DATE,
"CODEMPUA" INTEGER,
"CODFILIALUA" SMALLINT,
"IDUSUAPROV" CHAR(8) CHARACTER SET NONE,
"CODEMPCC" INTEGER NOT NULL,
"CODFILIALCC" SMALLINT NOT NULL,
"CODCC" CHAR(19) CHARACTER SET NONE NOT NULL,
"ANOCC" SMALLINT NOT NULL,
"IDUSUCANCSOL" CHAR(8) CHARACTER SET NONE,
"MOTIVOCANCSOL" VARCHAR(10000) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"DTALT" DATE,
"HALT" TIME,
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"IDUSUALT" CHAR(8) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITSOLSTSOL" FOR "CPITSOLICITACAO"
ACTIVE AFTER INSERT OR UPDATE OR DELETE POSITION 1 
AS
  declare variable numitens int;
  declare variable numitensaf int;
  declare variable numitensap int;
  declare variable numitensna int;
  declare variable numitensat int;
  declare variable numitensef int;
  declare variable numitensca int;
  declare variable numitensep int;
  declare variable numitensne int;
  declare variable numitenset int;

begin
  if (old.sititsol!='AF') then
  begin
      select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol into :numitens;
      select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sititsol='AF' into :numitensaf;
      select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sititsol='EF' into :numitensef;
      select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sititsol='CA' into :numitensca;
      if(:numitens=:numitensaf) then
      begin
        update cpsolicitacao set sitsol='AF' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='AF';
      end
      else if (:numitens=:numitensef) then
      begin
        update cpsolicitacao set sitsol='EF' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='EF';
      end
      else if (:numitens=:numitensca) then
      begin
        update cpsolicitacao set sitsol='CA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='CA';
      end
      if (new.qtdaprovitsol!=old.qtdaprovitsol) then
      begin
          if (new.qtdaprovitsol>0) then
          begin
              update cpsolicitacao set sitsol='EA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol='PE';
              select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitaprovitsol='AP' into :numitensap;
              select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitaprovitsol='NA' into :numitensna;
              select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitaprovitsol='AT' into :numitensat;
              if(:numitens!=:numitensaf) then
              begin
                if(:numitens=:numitensat) then
                begin
                   update cpsolicitacao set sitsol='AT' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='AT';
                end
                else if((:numitensap>0) or (:numitensna>0)) then
                begin
                   update cpsolicitacao set sitsol='AP' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='AP';
                end
                if(:numitens=:numitensna) then
                begin
                   update cpsolicitacao set sitsol='NA' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol  and sitsol!='NA';
                end
              end
          end
      end
  end
  else if (old.sititsol!='EF') then
  begin
      select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol into :numitens;
      select count(1) from cpitsolicitacao where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sititsol='EF' into :numitensef;
      if (:numitens=:numitensef) then
      begin
        update cpsolicitacao set sitsol='EF' where codemp=new.codemp and codfilial=new.codfilial and codsol = new.codsol and sitsol!='EF';
      end
  end
    if(new.sititsol='EF')  then
    begin
      update cpcotacao set sititsol = 'EF' where codemp=new.codemp and codfilial=new.codfilial and codsol=new.codsol and coditsol=new.coditsol and sititsol!='EF';
    end
    if(new.sititsol='ET')  then
    begin
      update cpcotacao set sititsol = 'ET' where codemp=new.codemp and codfilial=new.codfilial and codsol=new.codsol and coditsol=new.coditsol and sitcompitsol!='ET';
    end
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITSOLTGBD" FOR "CPITSOLICITACAO"
ACTIVE BEFORE DELETE POSITION 0 
AS
declare variable sUsuarioCN char(8);
declare variable sUsuarioRM char(8);
begin

   if(old.sititsol<>'PE') then
   begin
      exception eqitrma01;
   end

   select idusus from sgretinfousu(USER) into :sUsuarioCN;
   select rm.idusu from cpsolicitacao rm where rm.codemp=old.codemp and rm.codfilial=old.codfilial and rm.codsol=old.codsol into :sUsuarioRM;
   if(:sUsuarioCN<>:sUsuarioRM)then
   begin
      exception eqitrma02;
   end
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITSOLTGBI" FOR "CPITSOLICITACAO"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  IF (new.CODALMOX IS NULL) THEN
       SELECT CODEMPAX,CODFILIALAX,CODALMOX FROM EQPRODUTO WHERE
          CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD AND CODPROD=new.CODPROD
       INTO new.codempam, new.codfilialam,new.codalmox;
  if (new.qtdaprovitsol>new.qtditsol) then
     exception cpitsolicitacao;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITSOLTGBIBU" FOR "CPITSOLICITACAO"
ACTIVE  POSITION 8 
AS
  declare variable statusitem char(2);
begin
  if (old.sititsol!='AF') then
  begin
      if (new.qtdaprovitsol!=old.qtdaprovitsol or (NEW.sitaprovitsol='AT') ) then
      begin
          if ((new.sitaprovitsol='AT') and (new.qtdaprovitsol=0) and (old.sitaprovitsol!='AT')) then
          begin
            new.qtdaprovitsol=new.qtditsol;
          end
          if (new.qtdaprovitsol>0) then
          begin
            if (new.qtdaprovitsol<new.qtditsol) then
            begin
                statusitem = 'AP';
            end
            else
            begin
                statusitem = 'AT';
            end
          new.sitaprovitsol=:statusitem;
          if(new.sititsol='PE') then
          begin
              new.sititsol='EA';
          end
        end
      end
  end
  if(new.sititsol='CA') then
  begin
    new.qtdaprovitsol=0;
    new.sitaprovitsol='NA';
  end

end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITSOLTGBU" FOR "CPITSOLICITACAO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF (new.CODALMOX IS NULL) THEN
       SELECT CODEMPAX,CODFILIALAX,CODALMOX FROM EQPRODUTO WHERE
          CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD AND
          CODPROD=new.CODPROD
       INTO new.codempam, new.codfilialam,new.CODALMOX;

  IF (old.CODALMOX IS NOT NULL) THEN
  BEGIN
     IF (old.CODALMOX!=new.CODALMOX) THEN
         EXCEPTION EQALMOX01;
  END


  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "CPITSUMSOL"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODSUMSOL" INTEGER NOT NULL,
"CODEMPSC" INTEGER NOT NULL,
"CODFILIALSC" SMALLINT NOT NULL,
"CODSOL" INTEGER NOT NULL,
"CODITSOL" SMALLINT NOT NULL,
"DTCOT" DATE,
"IDUSUCOT" CHAR(8) CHARACTER SET NONE,
"CODEMPFR" INTEGER,
"CODFILIALFR" SMALLINT,
"CODFOR" INTEGER,
"QTDCOT" NUMERIC(15,5),
"PRECOCOT" NUMERIC(15,5),
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE,
"HALT" TIME,
"IDUSUALT" CHAR(8) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITSUMSOLTGBI" FOR "CPITSUMSOL"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  new.dtins=cast('now' AS DATE);
  new.idusuins=USER;
  new.hins = cast('now' AS TIME);
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPITSUMSOLTGBU" FOR "CPITSUMSOL"
ACTIVE BEFORE UPDATE POSITION 0 
AS
     declare variable sRefProd Char(13);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "CPPRODFOR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODFOR" INTEGER NOT NULL,
"REFPRODFOR" CHAR(21) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPPRODFORTGBU" FOR "CPPRODFOR"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "CPRATEIO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCOMPRA" INTEGER NOT NULL,
"SEQRATEIO" SMALLINT NOT NULL,
"CODEMPFN" INTEGER NOT NULL,
"CODFILIALFN" SMALLINT NOT NULL,
"CODPLAN" CHAR(13) CHARACTER SET NONE NOT NULL,
"CODEMPCC" INTEGER NOT NULL,
"CODFILIALCC" SMALLINT NOT NULL,
"ANOCC" SMALLINT NOT NULL,
"CODCC" CHAR(19) CHARACTER SET NONE NOT NULL,
"PERCRATEIO" NUMERIC(6,2) DEFAULT 0 NOT NULL,
"VLRRATEIO" "NUMERICDN" DEFAULT 0 NOT NULL,
"SITRATEIO" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"IDUSUIN" CHAR(8) CHARACTER SET NONE DEFAULT user,
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE,
"DTALT" DATE,
"HALT" TIME);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPRATEIOTGBU" FOR "CPRATEIO"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPSOLICITACAOTGAI" FOR "CPSOLICITACAO"
ACTIVE AFTER INSERT POSITION 0 
AS
begin
    new.DTINS=cast('now' AS DATE);
    new.IDUSUINS=user;
    new.HINS=cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPSOLICITACAOTGAU" FOR "CPSOLICITACAO"
ACTIVE AFTER UPDATE POSITION 0 
AS
begin
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=user;
    new.HALT=cast('now' AS TIME);
    if(new.sitsol='AF')  then
    begin
      update cpitsolicitacao set sititsol = 'AF' where codemp=new.codemp and codfilial=new.codfilial and codsol=new.codsol and sititsol!='AF';
    end
    else if (new.sitsol='CA')  then
    begin
      update cpitsolicitacao set sititsol = 'CA' where codemp=new.codemp and codfilial=new.codfilial and codsol=new.codsol and sititsol!='CA';
    end
    else if(new.sitsol='AT')  then
    begin
      update cpitsolicitacao set sitaprovitsol = 'AT' where codemp=new.codemp and codfilial=new.codfilial and codsol=new.codsol and sitaprovitsol!='AT';
    end
    if(new.sitsol='EF')  then
    begin
      update cpitsolicitacao it set sititsol = 'EF' where codemp=new.codemp and codfilial=new.codfilial and codsol=new.codsol and sititsol!='EF';
    end
    if(new.sitsol='ET')  then
    begin
      update cpitsolicitacao set sitcompitsol = 'ET' where codemp=new.codemp and codfilial=new.codfilial and codsol=new.codsol and sitcompitsol!='ET';
    end
    if(new.sitsol='CT')  then
    begin
      update cpcotacao set sititsol = 'AT' where codemp=new.codemp and codfilial=new.codfilial and codsol=new.codsol and sititsol!='AT';
    end
    if(new.sitsol='CF')  then
    begin
      update cpcotacao set sitcompitsol = 'EF' where codemp=new.codemp and codfilial=new.codfilial and codsol=new.codsol and sitcompitsol!='EF';
    end
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPSOLICITACAOTGBU" FOR "CPSOLICITACAO"
ACTIVE BEFORE UPDATE POSITION 1 
as
  DECLARE VARIABLE ICODEMPUSU INT;
  declare variable ICODFILIALUSU smallint;
  declare variable IDUSU char(8);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);

  if((new.idusuaprov is null) and (new.sitsol!=old.sitsol) and ((new.sitsol= 'AP') or (new.sitsol= 'AT') )) then
  begin
    SELECT CODEMPUSU,CODFILIALUSU,IDUSUS FROM sgretinfousu(USER) into :ICODEMPUSU,:ICODFILIALUSU,:IDUSU;
    new.codempua = :ICODEMPUSU;
    new.codfilialua = :ICODFILIALUSU;
    new.idusuaprov = :IDUSU;
    new.dtaaprovsol = cast('now' AS DATE);
  end
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "CPSUMSOL"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODSUMSOL" INTEGER NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"REFPROD" CHAR(13) CHARACTER SET NONE NOT NULL,
"QTDITSOL" "NUMERICDN" DEFAULT 0 NOT NULL,
"QTDAPROVITSOL" "NUMERICDN" DEFAULT 0 NOT NULL,
"SITITSOL" CHAR(2) CHARACTER SET NONE DEFAULT 'PE' NOT NULL,
"DTAPROVITSOL" DATE,
"IDUSUAPROVITSOL" CHAR(8) CHARACTER SET NONE,
"SITAPROVITSOL" CHAR(2) CHARACTER SET NONE,
"MOTIVOCOTABAIX" VARCHAR(10000) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE,
"HALT" TIME,
"IDUSUALT" CHAR(8) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPSUMSOLTGBI" FOR "CPSUMSOL"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  new.dtins=cast('now' AS DATE);
  new.idusuins=USER;
  new.hins = cast('now' AS TIME);

 IF (new.REFPROD IS NULL) THEN
       SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
            AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO new.REFPROD;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPSUMSOLTGBU" FOR "CPSUMSOL"
ACTIVE BEFORE UPDATE POSITION 0 
AS
     declare variable sRefProd Char(13);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);

  IF (new.CODPROD != old.CODPROD) THEN
     EXCEPTION CPITSOLICITACAOEX01;
  IF (new.REFPROD IS NULL) THEN
  BEGIN
       SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
            AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO sRefProd;
       new.REFPROD = sRefProd;
  END
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "CPTABFOR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODFOR" INTEGER NOT NULL,
"REFPRODTFOR" CHAR(21) CHARACTER SET NONE NOT NULL,
"DESCPRODTFOR" CHAR(50) CHARACTER SET NONE NOT NULL,
"PRECOPRODTFOR" "NUMERICDN" DEFAULT 0 NOT NULL,
"CODEMPPD" INTEGER,
"CODFILIALPD" SMALLINT,
"CODPROD" INTEGER,
"REFORIGTFOR" CHAR(18) CHARACTER SET NONE,
"LINHATFOR" CHAR(30) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPTABFORTGBU" FOR "CPTABFOR"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "CPTIPOFOR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTIPOFOR" INTEGER NOT NULL,
"DESCTIPOFOR" CHAR(40) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "CPTIPOFORTGBU" FOR "CPTIPOFOR"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQALMOX"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODALMOX" INTEGER NOT NULL,
"DESCALMOX" CHAR(40) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQALMOXTGBU" FOR "EQALMOX"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT=cast('now'AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQCODALTPROD"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODALTPROD" CHAR(20) CHARACTER SET NONE NOT NULL,
"REFPROD" CHAR(13) CHARACTER SET NONE NOT NULL,
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT user,
"IDUSUALT" CHAR(8) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"DTALT" DATE,
"HINS" TIME DEFAULT 'now',
"HALT" TIME);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQCODALTPRODBI" FOR "EQCODALTPROD"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL
     AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQCODALTPRODBU" FOR "EQCODALTPROD"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP and CODFILIAL=new.CODFILIAL
     AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQFATCONV"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODUNID" CHAR(8) CHARACTER SET NONE NOT NULL,
"FATCONV" NUMERIC(10,3) NOT NULL,
"CPFATCONV" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQFATCONVTGBU" FOR "EQFATCONV"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQGRUPO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODGRUP" CHAR(14) CHARACTER SET NONE NOT NULL,
"DESCGRUP" CHAR(50) CHARACTER SET NONE NOT NULL,
"NIVELGRUP" INTEGER,
"CODEMPSG" INTEGER,
"CODFILIALSG" SMALLINT,
"CODSUBGRUP" CHAR(14) CHARACTER SET NONE,
"SIGLAGRUP" CHAR(10) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"ESTNEGGRUP" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"ESTLOTNEGGRUP" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQGRUPOTGBU" FOR "EQGRUPO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.ESTNEGGRUP IS NULL) then
     new.ESTNEGGRUP = 'N';
  if (new.ESTLOTNEGGRUP IS NULL) then
     new.ESTLOTNEGGRUP = 'N';
  if ( (old.ESTNEGGRUP IS NULL) OR (old.ESTNEGGRUP!=new.ESTNEGGRUP) ) then
     UPDATE EQGRUPO SET ESTNEGGRUP=new.ESTNEGGRUP
         WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND
           CODGRUP!=new.CODGRUP AND CODGRUP LIKE RTRIM(new.CODGRUP)||'%';
  if ( (old.ESTLOTNEGGRUP IS NULL) OR (old.ESTLOTNEGGRUP!=new.ESTLOTNEGGRUP) ) then
     UPDATE EQGRUPO SET ESTLOTNEGGRUP=new.ESTLOTNEGGRUP
         WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND
           CODGRUP!=new.CODGRUP AND CODGRUP LIKE RTRIM(new.CODGRUP)||'%';
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQINVPROD"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODINVPROD" INTEGER NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODEMPLE" INTEGER,
"CODFILIALLE" SMALLINT,
"CODLOTE" CHAR(13) CHARACTER SET NONE,
"CODEMPTM" INTEGER NOT NULL,
"CODFILIALTM" SMALLINT NOT NULL,
"CODTIPOMOV" INTEGER NOT NULL,
"DATAINVP" DATE NOT NULL,
"QTDINVP" "NUMERICDN" NOT NULL,
"PRECOINVP" "NUMERICDN" DEFAULT 0 NOT NULL,
"CODEMPAX" INTEGER NOT NULL,
"CODFILIALAX" SMALLINT NOT NULL,
"CODALMOX" INTEGER NOT NULL,
"REFPROD" CHAR(13) CHARACTER SET NONE,
"SLDATUALINVP" "NUMERICDN",
"SLDDIGINVP" "NUMERICDN",
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'S',
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQINVPRODTGAD" FOR "EQINVPROD"
ACTIVE AFTER DELETE POSITION 0 
AS
begin
  /* Apos a exclusão do inventário */
  EXECUTE PROCEDURE EQMOVPRODIUDSP('D', old.CODEMPPD, old.CODFILIALPD,
     old.CODPROD, old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
     old.CODEMPTM, old.CODFILIALTM, old.CODTIPOMOV, old.CODEMP,
     old.CODFILIAL, old.CODINVPROD, null, null, null, null,null,
     null, null, null, null, null, null, null, null, null, null, null,
     null,null,null,
     null, old.DATAINVP, old.CODINVPROD, 'S', old.QTDINVP, old.PRECOINVP,
     old.CODEMPAX, old.CODFILIALAX, old.CODALMOX);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQINVPRODTGAI" FOR "EQINVPROD"
ACTIVE AFTER INSERT POSITION 0 
AS
BEGIN
  EXECUTE PROCEDURE EQMOVPRODIUDSP('I', new.CODEMPPD, new.CODFILIALPD,
     new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
     new.CODEMPTM, new.CODFILIALTM, new.CODTIPOMOV, new.CODEMP,
     new.CODFILIAL, new.CODINVPROD,  null, null, null, null,
     null, null, null, null, null, null, null, null, null,null,
     null,null,null,
     null, null, null, new.DATAINVP, new.CODINVPROD, 'S',
     new.QTDINVP, new.PRECOINVP,
     new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQINVPRODTGAU" FOR "EQINVPROD"
ACTIVE AFTER UPDATE POSITION 0 
AS
BEGIN
  EXECUTE PROCEDURE EQMOVPRODIUDSP('U', new.CODEMPPD, new.CODFILIALPD,
     new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
     new.CODEMPTM, new.CODFILIALTM, new.CODTIPOMOV, new.CODEMP,
     new.CODFILIAL, new.CODINVPROD,  null, null, null, null,
     null, null, null, null, null, null, null, null, null,null,null,null,
     null, null, null, null, new.DATAINVP, new.CODINVPROD, 'S',
     new.QTDINVP, new.PRECOINVP,
     new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQINVPRODTGBI" FOR "EQINVPROD"
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE CLOTEPROD CHAR;
BEGIN
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  SELECT CLOTEPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
    AND CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD INTO CLOTEPROD;
  IF (CLOTEPROD = 'S' AND new.CODLOTE IS NULL) THEN
    EXCEPTION EQINVPRODEX05;
  if (new.SLDATUALINVP is null) then new.SLDATUALINVP = 0;
  if (new.SLDDIGINVP is null) then new.SLDDIGINVP = 0;
/*  new.QTDINVP = new.SLDATUALINVP - new.SLDDIGINVP; */
  SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO new.REFPROD;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQINVPRODTGBU" FOR "EQINVPROD"
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE CLOTEPROD CHAR;
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT CLOTEPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
    AND CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD INTO CLOTEPROD;
  IF (new.CODPROD != old.CODPROD) THEN
    EXCEPTION EQINVPRODEX01;
  IF (new.CODLOTE != old.CODLOTE) THEN
    EXCEPTION EQINVPRODEX02;
  IF (new.DATAINVP != old.DATAINVP) THEN
    EXCEPTION EQINVPRODEX03;
  IF (new.CODALMOX != old.CODALMOX) THEN
    EXCEPTION EQINVPRODEX04;
  IF (CLOTEPROD = 'S' AND new.CODLOTE IS NULL) THEN
    EXCEPTION EQINVPRODEX05;
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQITMODGRADE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODMODG" INTEGER NOT NULL,
"CODITMODG" INTEGER NOT NULL,
"REFITMODG" CHAR(6) CHARACTER SET NONE,
"CODEMPVG" INTEGER NOT NULL,
"CODFILIALVG" SMALLINT NOT NULL,
"CODVARG" INTEGER NOT NULL,
"CODFABITMODG" CHAR(6) CHARACTER SET NONE,
"CODBARITMODG" CHAR(6) CHARACTER SET NONE,
"DESCITMODG" CHAR(20) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITMODGRADETGBU" FOR "EQITMODGRADE"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQRMA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODRMA" INTEGER NOT NULL,
"IDUSU" CHAR(8) CHARACTER SET NONE NOT NULL,
"CODEMPTM" INTEGER NOT NULL,
"CODFILIALTM" SMALLINT NOT NULL,
"CODTIPOMOV" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"MOTIVORMA" VARCHAR(10000) CHARACTER SET NONE,
"MOTIVOCANCRMA" VARCHAR(10000) CHARACTER SET NONE,
"SITRMA" CHAR(2) CHARACTER SET NONE DEFAULT 'PE' NOT NULL,
"CODEMPCC" INTEGER NOT NULL,
"CODFILIALCC" SMALLINT NOT NULL,
"ANOCC" SMALLINT NOT NULL,
"CODCC" CHAR(19) CHARACTER SET NONE NOT NULL,
"CODEMPUU" INTEGER NOT NULL,
"CODFILIALUU" SMALLINT NOT NULL,
"DTAREQRMA" DATE DEFAULT 'today' NOT NULL,
"DTAEXPRMA" DATE,
"SITAPROVRMA" CHAR(2) CHARACTER SET NONE DEFAULT 'PE' NOT NULL,
"SITEXPRMA" CHAR(2) CHARACTER SET NONE DEFAULT 'PE' NOT NULL,
"IDUSUAPROV" CHAR(8) CHARACTER SET NONE,
"CODEMPUA" INTEGER,
"CODFILIALUA" SMALLINT,
"IDUSUEXP" CHAR(8) CHARACTER SET NONE,
"CODEMPUE" INTEGER,
"CODFILIALUE" SMALLINT,
"DTAAPROVRMA" DATE,
"CODEMPOF" INTEGER,
"CODFILIALOF" SMALLINT,
"CODOP" INTEGER,
"SEQOP" SMALLINT,
"SEQOF" SMALLINT);
COMMIT WORK;
CREATE TABLE "EQITRMA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODRMA" INTEGER NOT NULL,
"CODITRMA" SMALLINT NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"QTDITRMA" "NUMERICDN" NOT NULL,
"SITITRMA" CHAR(2) CHARACTER SET NONE DEFAULT 'PE' NOT NULL,
"CODEMPAX" INTEGER NOT NULL,
"CODFILIALAX" SMALLINT NOT NULL,
"CODALMOX" INTEGER,
"QTDAPROVITRMA" "NUMERICDN" DEFAULT 0 NOT NULL,
"QTDEXPITRMA" "NUMERICDN" DEFAULT 0 NOT NULL,
"CODEMPLE" INTEGER,
"CODFILIALLE" SMALLINT,
"CODLOTE" CHAR(13) CHARACTER SET NONE,
"REFPROD" CHAR(13) CHARACTER SET NONE NOT NULL,
"DTAPROVITRMA" DATE,
"DTAEXPITRMA" DATE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"PRECOITRMA" "NUMERICDN" DEFAULT 0 NOT NULL,
"SITAPROVITRMA" CHAR(2) CHARACTER SET NONE DEFAULT 'PE' NOT NULL,
"SITEXPITRMA" CHAR(2) CHARACTER SET NONE DEFAULT 'PE' NOT NULL,
"MOTIVOCANCITRMA" VARCHAR(10000) CHARACTER SET NONE,
"PRIORITRMA" CHAR(1) CHARACTER SET NONE DEFAULT 'B' NOT NULL,
"MOTIVOPRIORITRMA" VARCHAR(10000) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITRMASTRMA" FOR "EQITRMA"
ACTIVE AFTER INSERT OR UPDATE OR DELETE POSITION 1 
AS
  declare variable numitens int;
  declare variable numitensaf int;
  declare variable numitensap int;
  declare variable numitensna int;
  declare variable numitensat int;
  declare variable numitensef int;
  declare variable numitensca int;
  declare variable numitensep int;
  declare variable numitensne int;
  declare variable numitenset int;

begin
  if (old.sititrma!='AF') then
  begin
      select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma into :numitens;
      select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sititrma='AF' into :numitensaf;
      select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sititrma='EF' into :numitensef;
      select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sititrma='CA' into :numitensca;
      if(:numitens=:numitensaf) then
      begin
        update eqrma set sitrma='AF' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitrma!='AF';
      end
      else if (:numitens=:numitensef) then
      begin
        update eqrma set sitrma='EF' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitrma!='EF';
      end
      else if (:numitens=:numitensca) then
      begin
        update eqrma set sitrma='CA' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitrma!='CA';
      end
      if (new.qtdaprovitrma!=old.qtdaprovitrma) then
      begin
          if (new.qtdaprovitrma>0) then
          begin
              update eqrma set sitrma='EA' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitrma='PE';
              select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitaprovitrma='AP' into :numitensap;
              select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitaprovitrma='NA' into :numitensna;
              select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitaprovitrma='AT' into :numitensat;
              if(:numitens!=:numitensaf) then
              begin
                if(:numitens=:numitensat) then
                begin
                   update eqrma set sitaprovrma='AT' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitaprovrma!='AT';
                end
                else if((:numitensap>0) or (:numitensna>0)) then
                begin
                   update eqrma set sitaprovrma='AP' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitaprovrma!='AP';
                end
                if(:numitens=:numitensna) then
                begin
                   update eqrma set sitaprovrma='NA' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma  and sitaprovrma!='NA';
                end
              end
          end
      end
  end
  else if (old.sititrma!='EF') then
  begin
      select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma into :numitens;
      select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sititrma='EF' into :numitensef;
      if (:numitens=:numitensef) then
      begin
        update eqrma set sitrma='EF' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitrma!='EF';
      end
      if (new.qtdexpitrma!=old.qtdexpitrma) then
      begin
          if (new.qtdexpitrma>0) then
          begin
              select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitexpitrma='EP' into :numitensep;
              select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitexpitrma='NE' into :numitensne;
              select count(1) from eqitrma where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitexpitrma='ET' into :numitenset;
              if(:numitens!=:numitensef) then
              begin
                if(:numitens=:numitenset) then
                begin
                   update eqrma set sitexprma='ET' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitexprma!='ET';
                end
                else if((:numitensep>0) or (:numitensne>0)) then
                begin
                   update eqrma set sitexprma='EP' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma and sitexprma!='EP';
                end
                if(:numitens=:numitensne) then
                begin
                   update eqrma set sitaprovrma='NE' where codemp=new.codemp and codfilial=new.codfilial and codrma = new.codrma  and sitexprma!='NE';
                end
              end
          end
      end
  end

end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITRMATGAD" FOR "EQITRMA"
ACTIVE AFTER DELETE POSITION 0 
AS
  DECLARE VARIABLE DDTRMA DATE;
  DECLARE VARIABLE ICODEMPTM INT;
  DECLARE VARIABLE ICODFILIALTM SMALLINT;
  declare VARIABLE ICODTIPOMOV INT ;

  begin
      SELECT R.DTAREQRMA,R.codemptm,R.codfilialtm,R.codtipomov
        FROM EQRMA R
        WHERE R.CODRMA = OLD.CODRMA AND R.CODEMP=OLD.CODEMP AND R.CODFILIAL = OLD.CODFILIAL
        INTO :DDTRMA,:ICODEMPTM,:ICODFILIALTM,:ICODTIPOMOV;

      EXECUTE PROCEDURE EQMOVPRODIUDSP('D',OLD.CODEMPPD, OLD.CODFILIALPD, OLD.CODPROD,
        OLD.CODEMPLE, OLD.CODFILIALLE, OLD.codlote, :ICODEMPTM,
        :ICODFILIALTM, :ICODTIPOMOV, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, OLD.CODEMP, OLD.CODFILIAL, OLD.codrma, OLD.coditrma, null, null, null,
        null,null,null,null, :DDTRMA, OLD.codrma, 'N', OLD.qtdexpitrma, OLD.precoitrma,
        OLD.CODEMPAX, OLD.CODFILIALAX, OLD.CODALMOX);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITRMATGAI" FOR "EQITRMA"
ACTIVE AFTER INSERT POSITION 0 
AS
  DECLARE VARIABLE DDTRMA DATE;
  DECLARE VARIABLE ICODEMPTM INT;
  DECLARE VARIABLE ICODFILIALTM SMALLINT;
  declare VARIABLE ICODTIPOMOV INT ;

  begin
      new.DTINS=cast('now' AS DATE);
      new.IDUSUINS=user;
      new.HINS=cast('now' AS TIME);
      SELECT R.DTAREQRMA,R.codemptm,R.codfilialtm,R.codtipomov
        FROM EQRMA R
        WHERE R.CODRMA = new.CODRMA AND R.CODEMP=new.CODEMP AND R.CODFILIAL = new.CODFILIAL
        INTO :DDTRMA,:ICODEMPTM,:ICODFILIALTM,:ICODTIPOMOV;

      EXECUTE PROCEDURE EQMOVPRODIUDSP('I',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
        new.CODEMPLE, new.CODFILIALLE, new.codlote, :ICODEMPTM,
        :ICODFILIALTM, :ICODTIPOMOV, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, new.CODEMP, new.CODFILIAL, new.codrma, new.coditrma, null, null, null,
        null,null,null,null, :DDTRMA, new.codrma, 'N', new.qtdexpitrma, new.precoitrma,
        new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITRMATGAIAU" FOR "EQITRMA"
ACTIVE  POSITION 2 
AS
declare variable icodemptm int;
declare variable icodfilialtm smallint;
declare variable icodtipomov integer;
begin
  if(new.sititrma='EF') then
  begin
    select tm.codemptm,tm.codfilialtm,tm.codtipomovtm from eqtipomov tm, eqrma rm
       where tm.codemp=rm.codemptm and tm.codfilial=rm.codfilialtm and tm.codtipomov=rm.codtipomov
       and rm.codemp=new.codemp and rm.codfilial=new.codfilial and codrma=new.codrma
       into :icodemptm,:icodfilialtm,:icodtipomov;
    if((:icodemptm is not null) and (:icodfilialtm is not null) and (:icodtipomov is not null)) then
    begin
       update eqrma set codemptm=:icodemptm, codfilialtm=:icodfilialtm, codtipomov=:icodtipomov where
       codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma;
    end
  end
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITRMATGAU" FOR "EQITRMA"
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE DDTRMA DATE;
  DECLARE VARIABLE ICODEMPTM INT;
  DECLARE VARIABLE ICODFILIALTM SMALLINT;
  declare VARIABLE ICODTIPOMOV INT ;

  begin
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=user;
      new.HALT=cast('now' AS TIME);
      SELECT R.DTAREQRMA,R.codemptm,R.codfilialtm,R.codtipomov
        FROM EQRMA R
        WHERE R.CODRMA = new.CODRMA AND R.CODEMP=new.CODEMP AND R.CODFILIAL = new.CODFILIAL
        INTO :DDTRMA,:ICODEMPTM,:ICODFILIALTM,:ICODTIPOMOV;

      EXECUTE PROCEDURE EQMOVPRODIUDSP('U',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
        new.CODEMPLE, new.CODFILIALLE, new.codlote, :ICODEMPTM,
        :ICODFILIALTM, :ICODTIPOMOV, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, new.CODEMP, new.CODFILIAL, new.codrma, new.coditrma, null, null,
        null,null,null,null,null, :DDTRMA, new.codrma, 'N', new.qtdexpitrma, new.precoitrma,
        new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITRMATGBD" FOR "EQITRMA"
ACTIVE BEFORE DELETE POSITION 0 
AS
declare variable sUsuarioCN char(8);
declare variable sUsuarioRM char(8);
begin

   if(old.sititrma<>'PE') then
   begin
      exception eqitrma01;
   end

   select idusus from sgretinfousu(USER) into :sUsuarioCN;
   select rm.idusu from eqrma rm where rm.codemp=old.codemp and rm.codfilial=old.codfilial and rm.codrma=old.codrma into :sUsuarioRM;
   if(:sUsuarioCN<>:sUsuarioRM)then
   begin
      exception eqitrma02;
   end
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITRMATGBI" FOR "EQITRMA"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  IF (new.CODALMOX IS NULL) THEN
       SELECT CODEMPAX,CODFILIALAX,CODALMOX FROM EQPRODUTO WHERE
          CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD AND CODPROD=new.CODPROD
       INTO new.CODEMPAX, new.CODFILIALAX,new.CODALMOX;
  if (new.QTDAPROVITRMA>new.QTDITRMA) then
     exception eqitrma;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITRMATGBIBU" FOR "EQITRMA"
ACTIVE  POSITION 8 
AS
  declare variable statusitem char(2);
begin
  if (old.sititrma!='AF') then
  begin
      if (new.qtdaprovitrma!=old.qtdaprovitrma or (NEW.sitaprovitrma='AT') ) then
      begin
          if ((new.sitaprovitrma='AT') and (new.qtdaprovitrma=0) and (old.sitaprovitrma!='AT')) then
          begin
            new.qtdaprovitrma=new.qtditrma;
          end
          if (new.qtdaprovitrma>0) then
          begin
            if (new.qtdaprovitrma<new.qtditrma) then
            begin
                statusitem = 'AP';
            end
            else
            begin
                statusitem = 'AT';
            end
          new.sitaprovitrma=:statusitem;
          if(new.sititrma='PE') then
          begin
              new.sititrma='EA';
          end
        end
      end
  end
  else if (old.sititrma!='EF') then
  begin
      if (new.qtdexpitrma!=old.qtdexpitrma or (NEW.sitexpitrma='ET') ) then
      begin
          if ((new.sitexpitrma='ET') and (new.qtdexpitrma=0) and (old.sitexpitrma!='ET')) then
          begin
            new.qtdexpitrma=new.qtdaprovitrma;
          end
          if (new.qtdexpitrma>0) then
          begin
            if (new.qtdexpitrma<new.qtdaprovitrma) then
            begin
                statusitem = 'EP';
            end
            else
            begin
                statusitem = 'ET';
            end
          new.sitexpitrma=:statusitem;
        end
      end
  end
  if(new.sititrma='CA') then
  begin
    new.qtdaprovitrma=0;
    new.sitaprovitrma='NA';
  end

end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITRMATGBU" FOR "EQITRMA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF (new.CODALMOX IS NULL) THEN
       SELECT CODEMPAX,CODFILIALAX,CODALMOX FROM EQPRODUTO WHERE
          CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD AND
          CODPROD=new.CODPROD
       INTO new.CODEMPAX, new.CODFILIALAX,new.CODALMOX;

  IF (old.CODALMOX IS NOT NULL) THEN
  BEGIN
     IF (old.CODALMOX!=new.CODALMOX) THEN
         EXCEPTION EQALMOX01;
  END


  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQITSIMILAR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODSIM" INTEGER NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"REFPROD" CHAR(13) CHARACTER SET NONE NOT NULL,
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT user,
"IDUSUALT" CHAR(8) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"DTALT" DATE,
"HINS" TIME DEFAULT 'now',
"HALT" TIME);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITSIMILARBI" FOR "EQITSIMILAR"
ACTIVE BEFORE INSERT POSITION 0 
AS
 declare variable ICODPROD INTEGER;
begin
  SELECT CODPROD FROM EQITSIMILAR ITS
     WHERE ITS.CODEMPPD=new.CODEMPPD AND ITS.CODFILIALPD=new.CODFILIALPD AND
       ITS.CODPROD=new.CODPROD AND ITS.CODSIM != new.CODSIM
       INTO :ICODPROD;
  if (ICODPROD IS NOT NULL) then
     exception EQSIMILAREX01;
  SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD and CODFILIAL=new.CODFILIALPD
     AND CODPROD=new.CODPROD INTO new.REFPROD;

end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQITSIMILARBU" FOR "EQITSIMILAR"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD and CODFILIAL=new.CODFILIALPD
     AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQLANCTOEXP"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODLEXP" INTEGER NOT NULL,
"CODEMPTE" INTEGER NOT NULL,
"CODFILIALTE" SMALLINT NOT NULL,
"CODTIPOEXP" INTEGER NOT NULL,
"CODEMPCL" INTEGER NOT NULL,
"CODFILIALCL" SMALLINT NOT NULL,
"CODCLI" INTEGER NOT NULL,
"DTLEXP" DATE NOT NULL,
"QTDLEXP" INTEGER NOT NULL,
"DTRETLEXP" DATE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQLANCTOEXPTGBU" FOR "EQLANCTOEXP"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQLOTE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODLOTE" CHAR(13) CHARACTER SET NONE NOT NULL,
"VENCTOLOTE" DATE NOT NULL,
"SLDLOTE" "NUMERICDN",
"SLDRESLOTE" "NUMERICDN",
"SLDCONSIGLOTE" "NUMERICDN",
"SLDLIQLOTE" "NUMERICDN",
"DINILOTE" DATE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQLOTETGBI" FOR "EQLOTE"
ACTIVE BEFORE INSERT POSITION 0 
as
begin
  if (new.SLDLOTE is null) then
     new.SLDLOTE = 0;
  if (new.SLDRESLOTE is null) then
     new.SLDRESLOTE = 0;
  if (new.SLDCONSIGLOTE is null) then
     new.SLDCONSIGLOTE = 0;
  new.SLDLIQLOTE = new.SLDLOTE-new.SLDRESLOTE-new.SLDCONSIGLOTE;
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGPREFERE1"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"USAREFPROD" CHAR(1) CHARACTER SET NONE NOT NULL,
"CODTIPOMOV" INTEGER,
"CODEMPTM" SMALLINT,
"CODFILIALTM" SMALLINT,
"USAPEDSEQ" CHAR(1) CHARACTER SET NONE,
"USAORCSEQ" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"FILTRO" CHAR(2) CHARACTER SET NONE,
"USALIQREL" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"TIPOPRECOCUSTO" CHAR(1) CHARACTER SET NONE DEFAULT 'M' NOT NULL,
"ANOCENTROCUSTO" SMALLINT,
"OBSORCPAD" VARCHAR(10000) CHARACTER SET NONE,
"CODTIPOMOV2" INTEGER,
"CODFILIALT2" SMALLINT,
"CODEMPT2" INTEGER,
"CLASSORC" CHAR(20) CHARACTER SET NONE,
"TITORCTXT01" CHAR(20) CHARACTER SET NONE,
"CODTIPOMOV3" INTEGER,
"CODFILIALT3" SMALLINT,
"CODEMPT3" INTEGER,
"ORDNOTA" CHAR(1) CHARACTER SET NONE,
"SETORVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'C',
"PREFCRED" CHAR(1) CHARACTER SET NONE,
"LCREDGLOBAL" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"CODEMPMO" INTEGER NOT NULL,
"CODFILIALMO" INTEGER NOT NULL,
"CODMOEDA" CHAR(4) CHARACTER SET NONE NOT NULL,
"CODTIPOMOV4" INTEGER,
"CODFILIALT4" INTEGER,
"CODEMPT4" INTEGER,
"USACLASCOMIS" CHAR(1) CHARACTER SET NONE,
"PERCPRECOCUSTO" NUMERIC(9,2) DEFAULT 0 NOT NULL,
"CODGRUP" CHAR(14) CHARACTER SET NONE,
"CODFILIALGP" INTEGER,
"CODEMPGP" INTEGER,
"CODMARCA" CHAR(6) CHARACTER SET NONE,
"CODFILIALMC" INTEGER,
"CODEMPMC" INTEGER,
"RGCLIOBRIG" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"TABFRETEVD" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"TABADICVD" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"TRAVATMNFVD" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"TIPOVALIDORC" CHAR(1) CHARACTER SET NONE DEFAULT 'D',
"CLIMESMOCNPJ" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CODTBJ" INTEGER,
"CODEMPTJ" INTEGER,
"CODFILIALTJ" INTEGER,
"CNPJOBRIGCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"JUROSPOSCALC" CHAR(1) CHARACTER SET NONE,
"CODEMPFR" INTEGER,
"CODFILIALFR" INTEGER,
"CODFOR" INTEGER,
"CODEMPTN" INTEGER,
"CODFILIALTN" SMALLINT,
"CODTRAN" INTEGER,
"CODEMPTF" INTEGER,
"CODFILIALTF" INTEGER,
"CODTIPOFOR" INTEGER,
"CODEMPT5" INTEGER,
"CODFILIALT5" INTEGER,
"CODTIPOMOV5" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"ESTLOTNEG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"ESTNEG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"NATVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'S',
"IPIVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CUSTOSICMS" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"CODEMPPG" INTEGER,
"CODFILIALPG" SMALLINT,
"CODPLANOPAG" INTEGER,
"CODEMPTB" INTEGER,
"CODFILIALTB" SMALLINT,
"CODTAB" INTEGER,
"CODEMPCE" INTEGER,
"CODFILIALCE" SMALLINT,
"CODCLASCLI" INTEGER,
"CASASDEC" SMALLINT DEFAULT 2,
"CASASDECFIN" SMALLINT DEFAULT 2,
"COMISPDUPL" CHAR(1) CHARACTER SET NONE DEFAULT 'S',
"CODEMPT6" INTEGER,
"CODFILIALT6" SMALLINT,
"CODTIPOMOV6" INTEGER,
"BLOQVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"BLOQCOMPRA" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"VENDAMATPRIM" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"PEPSPROD" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"CNPJFOROBRIG" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"INSCESTFOROBRIG" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"BUSCAPRODSIMILAR" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"MULTIALMOX" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"CODEMPT8" INTEGER,
"CODFILIALT8" SMALLINT,
"CODTIPOMOV8" INTEGER,
"ESTNEGGRUP" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"USATABPE" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"TAMDESCPROD" SMALLINT DEFAULT 50,
"DESCCOMPPED" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"OBSCLIVEND" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"CONTESTOQ" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"DIASPEDT" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"RECALCPCVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"RECALCPCORC" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"USALAYOUTPED" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"VERIFALTPARCVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"BUSCACODPRODGEN" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"FILBUSCGENPROD" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"FILBUSCGENREF" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"FILBUSCGENCODBAR" CHAR(1) CHARACTER SET NONE NOT NULL,
"FILBUSCGENCODFAB" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"BUSCAVLRULTCOMPRA" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"ICMSVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"USAPRECOZERO" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"USAIMGASSORC" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"IMGASSORC" BLOB SEGMENT SIZE 50,
"CONSISTEIECLI" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"CONSISTEIEFOR" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"USANOMEVENDORC" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"SISCONTABIL" CHAR(2) CHARACTER SET NONE DEFAULT '00' NOT NULL,
"ATBANCOIMPBOL" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"TIPOCODBAR" CHAR(1) CHARACTER SET NONE DEFAULT '1' NOT NULL,
"ADICORCOBSPED" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQLOTETGBU" FOR "EQLOTE"
ACTIVE BEFORE UPDATE POSITION 0 
as
  DECLARE VARIABLE ICODFILIAL INTEGER;
  DECLARE VARIABLE CESTLOTNEG CHAR(1);
  DECLARE VARIABLE CESTNEGGRUP CHAR(1);
  DECLARE VARIABLE CESTLOTNEGGRUP CHAR(1);
begin
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :iCodFilial;
  SELECT ESTLOTNEG,ESTNEGGRUP FROM SGPREFERE1 WHERE CODEMP=new.CODEMP AND CODFILIAL=:iCodFilial
     INTO :cEstLotNeg, :cEstNegGrup;
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.SLDLOTE is null) then
     new.SLDLOTE = 0;
  if (new.SLDRESLOTE is null) then
     new.SLDRESLOTE = 0;
  if (new.SLDCONSIGLOTE is null) then
     new.SLDCONSIGLOTE = 0;
  new.SLDLIQLOTE = new.SLDLOTE-new.SLDRESLOTE-new.SLDCONSIGLOTE;
  if (cEstNegGrup is null) then
      cEstNegGrup ='N';
  if (cEstLotNeg Is null) then
      cEstLotNeg = 'N';

  if ( new.SLDLOTE < 0) then
  begin
     if (cEstNegGrup = 'S') then
     begin
        SELECT G.ESTLOTNEGGRUP FROM EQGRUPO G, EQPRODUTO P
          WHERE P.CODEMP=new.CODEMP AND P.CODFILIAL=new.CODFILIAL AND
            P.CODPROD=new.CODPROD AND G.CODEMP=P.CODEMPGP AND
            G.CODFILIAL=P.CODFILIALGP AND G.CODGRUP=P.CODGRUP
          INTO :cEstLotNegGrup;
        if (cEstLotNegGrup is null) then
           cEstLotNegGrup = 'N';
        if (cEstLotNegGrup='N') then
           EXCEPTION EQLOTEEX01 'O LOTE '||rtrim(new.CODLOTE)||
              ' NÃO POSSUI SALDO P/COMPL. A OPERAÇÃO';
     end
     else if (cEstLotNeg='N') then
           EXCEPTION EQLOTEEX01 'O LOTE '||rtrim(new.CODLOTE)||
              ' NÃO POSSUI SALDO P/COMPL. A OPERAÇÃO';
  end
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQMARCA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODMARCA" CHAR(6) CHARACTER SET NONE NOT NULL,
"DESCMARCA" CHAR(40) CHARACTER SET NONE NOT NULL,
"SIGLAMARCA" CHAR(20) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQMARCATGBU" FOR "EQMARCA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQMODGRADE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODMODG" INTEGER NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"DESCMODG" CHAR(40) CHARACTER SET NONE NOT NULL,
"DESCPRODMODG" CHAR(20) CHARACTER SET NONE NOT NULL,
"REFMODG" CHAR(10) CHARACTER SET NONE NOT NULL,
"CODFABMODG" CHAR(10) CHARACTER SET NONE NOT NULL,
"CODBARMODG" CHAR(10) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQMODGRADETGBU" FOR "EQMODGRADE"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQMOVEXP"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODMOVEXP" INTEGER NOT NULL,
"CODEMPTE" INTEGER NOT NULL,
"CODFILIALTE" SMALLINT NOT NULL,
"CODTIPOEXP" INTEGER NOT NULL,
"CODEMPCL" INTEGER NOT NULL,
"CODFILIALCL" SMALLINT NOT NULL,
"CODCLI" INTEGER NOT NULL,
"DTSAIMOVEXP" DATE NOT NULL,
"QTDMOVEXP" INTEGER NOT NULL,
"DTENTMOVEXP" DATE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQMOVEXPTGBU" FOR "EQMOVEXP"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "EQMOVPRODATEQSP"("ICODEMPPD" INTEGER,
"SCODFILIALPD" SMALLINT,
"ICODPROD" INTEGER,
"ICODEMPLEOLD" INTEGER,
"SCODFILIALLEOLD" SMALLINT,
"CCODLOTEOLD" CHAR(13) CHARACTER SET NONE,
"ICODEMPLENEW" INTEGER,
"SCODFILIALLENEW" SMALLINT,
"CCODLOTENEW" CHAR(13) CHARACTER SET NONE,
"SOPERADOR" SMALLINT,
"NQTDMOVPRODOLD" NUMERIC(15,5),
"NQTDMOVPRODNEW" NUMERIC(15,5),
"ICODEMPAXOLD" INTEGER,
"SCODFILIALAXOLD" SMALLINT,
"ICODALMOXOLD" INTEGER,
"ICODEMPAXNEW" INTEGER,
"SCODFILIALAXNEW" SMALLINT,
"ICODALMOXNEW" INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQMOVPROD"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODMOVPROD" INTEGER NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODEMPVD" INTEGER,
"CODFILIALVD" SMALLINT,
"TIPOVENDA" CHAR(1) CHARACTER SET NONE,
"CODVENDA" INTEGER,
"CODITVENDA" INTEGER,
"CODEMPLE" INTEGER,
"CODFILIALLE" SMALLINT,
"CODLOTE" CHAR(13) CHARACTER SET NONE,
"CODEMPTM" INTEGER NOT NULL,
"CODFILIALTM" SMALLINT NOT NULL,
"CODTIPOMOV" INTEGER NOT NULL,
"CODEMPCP" INTEGER,
"CODFILIALCP" SMALLINT,
"CODCOMPRA" INTEGER,
"CODITCOMPRA" INTEGER,
"CODEMPIV" INTEGER,
"CODFILIALIV" SMALLINT,
"CODINVPROD" INTEGER,
"DTMOVPROD" DATE NOT NULL,
"TIPOMOVPROD" CHAR(1) CHARACTER SET NONE NOT NULL,
"ESTOQMOVPROD" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"CODEMPAX" INTEGER NOT NULL,
"CODFILIALAX" SMALLINT NOT NULL,
"CODALMOX" INTEGER NOT NULL,
"QTDMOVPROD" "NUMERICDN" NOT NULL,
"PRECOMOVPROD" "NUMERICDN",
"CUSTOMPMMOVPROD" "NUMERICDN" DEFAULT 0,
"CUSTOMPMMOVPRODAX" "NUMERICDN",
"SLDMOVPROD" "NUMERICDN",
"SLDMOVPRODAX" "NUMERICDN",
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CODEMPNT" INTEGER,
"CODFILIALNT" SMALLINT,
"CODNAT" CHAR(4) CHARACTER SET NONE,
"DOCMOVPROD" INTEGER,
"CODEMPRM" INTEGER,
"CODFILIALRM" SMALLINT,
"CODRMA" INTEGER,
"CODITRMA" SMALLINT,
"EMMANUT" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"CODEMPOP" INTEGER,
"CODFILIALOP" SMALLINT,
"CODOP" INTEGER,
"SEQOP" SMALLINT);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQMOVPRODTGAD" FOR "EQMOVPROD"
ACTIVE AFTER DELETE POSITION 0 
AS
  DECLARE VARIABLE SOPERADOR SMALLINT;
BEGIN
  IF (old.ESTOQMOVPROD = 'S') THEN
  BEGIN
      IF (old.TIPOMOVPROD = 'S') THEN
        SOPERADOR = -1;
      ELSE
        SOPERADOR = 1;
      EXECUTE PROCEDURE EQMOVPRODATEQSP(old.CODEMPPD, old.CODFILIALPD, old.CODPROD,
        old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
        old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
        :SOPERADOR, old.QTDMOVPROD, 0,
        old.CODEMPAX, old.CODFILIALAX, old.CODALMOX,
        old.CODEMPAX, old.CODFILIALAX, old.CODALMOX);
   END
 /* EXECUTE PROCEDURE EQMOVPRODATCUSTSP(old.CODEMPPD, old.CODFILIALPD, old.CODPROD, SOPERADOR); */
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQMOVPRODTGAI" FOR "EQMOVPROD"
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE SOPERADOR SMALLINT;
BEGIN
  IF (new.ESTOQMOVPROD='S') THEN
  BEGIN
      IF (new.TIPOMOVPROD = 'S') THEN
         SOPERADOR = -1;
      ELSE
         SOPERADOR = 1;
      EXECUTE PROCEDURE EQMOVPRODATEQSP(new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
        null, null, null,
        new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
        :SOPERADOR, 0, new.QTDMOVPROD,
        null, null, null,
        new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
  END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQMOVPRODTGAU" FOR "EQMOVPROD"
ACTIVE AFTER UPDATE POSITION 0 
AS
DECLARE VARIABLE SOPERADOR SMALLINT;
DECLARE VARIABLE NQTDMOVPRODOLD NUMERIC(15, 5);
DECLARE VARIABLE NQTDMOVPRODNEW NUMERIC(15, 5);
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) ) THEN
  BEGIN

      IF ( ( old.ESTOQMOVPROD='S' ) OR (new.ESTOQMOVPROD='S') ) THEN
      BEGIN
          NQTDMOVPRODOLD = old.QTDMOVPROD;
          NQTDMOVPRODNEW = new.QTDMOVPROD;
          IF (new.TIPOMOVPROD = 'S') THEN /* Se for saída tem que diminuir do estoque */
            SOPERADOR = -1;
          ELSE
            SOPERADOR = 1;
          /* Caso o flag de controle de estoque tenha mudado */
          IF ( (old.ESTOQMOVPROD='S') AND (new.ESTOQMOVPROD='N') ) THEN
              NQTDMOVPRODNEW = 0;
          ELSE IF ( (old.ESTOQMOVPROD='N') AND (new.ESTOQMOVPROD='S') ) THEN
              NQTDMOVPRODOLD = 0;
          EXECUTE PROCEDURE EQMOVPRODATEQSP(new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
            old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
            new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
            :SOPERADOR, NQTDMOVPRODOLD, NQTDMOVPRODNEW,
            old.CODEMPAX, old.CODFILIALAX, old.CODALMOX,
            new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
      END
   END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQMOVPRODTGBU" FOR "EQMOVPROD"
ACTIVE BEFORE UPDATE POSITION 0 
AS
BEGIN
  IF ( new.EMMANUT IS NULL) THEN
      new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN
     new.DTALT=cast('now' AS DATE);
     new.IDUSUALT=USER;
     new.HALT = cast('now' AS TIME);
  END
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQPRODACESSO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"TIPOPA" CHAR(3) CHARACTER SET NONE NOT NULL,
"CODPA" INTEGER NOT NULL,
"CODEMPCC" INTEGER,
"CODFILIALCC" SMALLINT,
"ANOCC" SMALLINT,
"CODCC" CHAR(19) CHARACTER SET NONE,
"CODEMPCX" INTEGER,
"CODFILIALCX" SMALLINT,
"CODCAIXA" INTEGER,
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT user,
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE,
"DTALT" DATE,
"HALT" TIME);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQPRODACESSOTGBU" FOR "EQPRODACESSO"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.IDUSUALT=USER;
  new.DTALT=cast('now' AS DATE);
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQPRODPLAN"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"SEQPP" SMALLINT NOT NULL,
"TIPOPP" CHAR(1) CHARACTER SET NONE NOT NULL,
"CODEMPPN" INTEGER NOT NULL,
"CODFILIALPN" SMALLINT NOT NULL,
"CODPLAN" CHAR(13) CHARACTER SET NONE NOT NULL,
"CODEMPCC" INTEGER NOT NULL,
"CODFILIALCC" SMALLINT NOT NULL,
"ANOCC" SMALLINT NOT NULL,
"CODCC" CHAR(19) CHARACTER SET NONE NOT NULL,
"PERCPP" NUMERIC(6,2) DEFAULT 0 NOT NULL,
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT user,
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE,
"DTALT" DATE,
"HALT" TIME);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQPRODPLANBU" FOR "EQPRODPLAN"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);

end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQPRODUTOTGBI" FOR "EQPRODUTO"
ACTIVE BEFORE INSERT POSITION 0 
as
begin
  if (new.SLDPROD is null) then
     new.SLDPROD = 0;
  if (new.SLDRESPROD is null) then
     new.SLDRESPROD = 0;
  if (new.SLDCONSIGPROD is null) then
     new.SLDCONSIGPROD = 0;
  new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQPRODUTOTGBU" FOR "EQPRODUTO"
ACTIVE BEFORE UPDATE POSITION 0 
as
  DECLARE VARIABLE ICODFILIAL INTEGER;
  DECLARE VARIABLE CESTNEG CHAR(1);
  DECLARE VARIABLE CESTNEGGRUPPREF CHAR(1);
  DECLARE VARIABLE CESTNEGGRUP CHAR(1);
  DECLARE VARIABLE ICODPROD INTEGER;
begin
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :iCodFilial;
  SELECT ESTNEG, ESTNEGGRUP FROM SGPREFERE1
     WHERE CODEMP=new.CODEMP AND CODFILIAL=:iCodFilial
     INTO :cEstNeg, :cEstNegGrupPref;
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.SLDPROD is null) then
     new.SLDPROD = 0;
  if (new.SLDRESPROD is null) then
     new.SLDRESPROD = 0;
  if (new.SLDCONSIGPROD is null) then
     new.SLDCONSIGPROD = 0;
  new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
  if (cEstNeg Is null) then
      cEstNeg = 'N';
  if (cEstNegGrupPref is null) then
      cEstNegGrupPref = 'N';
  if ((new.SLDPROD < 0) AND (new.TIPOPROD='P') ) THEN
  begin
    if (cEstNegGrupPref = 'S') then
    begin
       SELECT ESTNEGGRUP FROM EQGRUPO
         WHERE CODEMP=new.CODEMPGP AND CODFILIAL=new.CODFILIALGP AND
            CODGRUP=new.CODGRUP INTO :CESTNEGGRUP;
       if (cEstNegGrup is null) then
          cEstNegGrup = 'N';
       if (cEstNegGrup='N') then
          EXCEPTION EQPRODUTOEX01 'O PROD. '||rtrim(cast(new.CODPROD as char(10)))
            ||'-'||substring(new.DESCPROD from 1 for 20)||
          ' NÃO POSSUI SALDO P/COMPL. A OPERAÇÃO';
    end
    else if (cEstNeg='N') then
          EXCEPTION EQPRODUTOEX01 'O PROD. '||rtrim(cast(new.CODPROD as char(10)))
            ||'-'||substring(new.DESCPROD from 1 for 20)||
          ' NÃO POSSUI SALDO P/COMPL. A OPERAÇÃO';
  end
  if ( new.REFPROD != old.REFPROD ) then
  begin
     SELECT FIRST 1 CODPROD FROM EQMOVPROD WHERE CODEMPPD=new.CODEMP AND
        CODFILIALPD=new.CODFILIAL AND CODPROD=new.CODPROD
          INTO :ICODPROD;
     if ( (ICODPROD IS NOT NULL) AND (ICODPROD=new.CODPROD) ) then
        EXCEPTION EQPRODUTOEX01 'REFERÊNCIA NÃO PODE SER ALTERADA. PRODUTO POSSUI MOVIMENTO!';
     else
        UPDATE EQCODALTPROD SET REFPROD=new.REFPROD WHERE CODEMP=new.CODEMP AND
          CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD;
  end
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQRMATGAI" FOR "EQRMA"
ACTIVE AFTER INSERT POSITION 0 
AS
begin
    new.DTINS=cast('now' AS DATE);
    new.IDUSUINS=user;
    new.HINS=cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQRMATGAU" FOR "EQRMA"
ACTIVE AFTER UPDATE POSITION 0 
AS
begin
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=user;
    new.HALT=cast('now' AS TIME);
    if(new.sitrma='AF')  then
    begin
      update eqitrma set sititrma = 'AF' where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma and sititrma!='AF';
    end
    else if (new.sitrma='CA')  then
    begin
      update eqitrma set sititrma = 'CA' where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma and sititrma!='CA';
    end
    else if(new.sitaprovrma='AT')  then
    begin
      update eqitrma set sitaprovitrma = 'AT' where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma and sitaprovitrma!='AT';
    end
    if(new.sitrma='EF')  then
    begin
      update eqitrma it set sititrma = 'EF',precoitrma=(select custompmprod from eqproduto where codemp=it.codemppd and codfilial=it.codfilialpd and codprod=it.codprod) where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma and sititrma!='EF';
    end
    if(new.sitexprma='ET')  then
    begin
      update eqitrma set sitexpitrma = 'ET' where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma and sitexpitrma!='ET';
    end
    if(new.codtipomov!=old.codtipomov) then
    begin
        update eqitrma it set precoitrma=(select custompmprod from eqproduto where codemp=it.codemppd and codfilial=it.codfilialpd and codprod=it.codprod)
            where codemp=new.codemp and codfilial=new.codfilial and codrma=new.codrma;
    end
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQRMATGBU" FOR "EQRMA"
ACTIVE BEFORE UPDATE POSITION 0 
as
  DECLARE VARIABLE ICODEMPUSU INT;
  declare variable ICODFILIALUSU smallint;
  declare variable IDUSU char(8);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if((new.idusuaprov is null) and (new.sitaprovrma!=old.sitaprovrma)) then
  begin
    SELECT CODEMPUSU,CODFILIALUSU,IDUSUS FROM sgretinfousu(USER) into :ICODEMPUSU,:ICODFILIALUSU,:IDUSU;
    new.codempua = :ICODEMPUSU;
    new.codfilialua = :ICODFILIALUSU;
    new.idusuaprov = :IDUSU;
    new.dtaaprovrma = cast('now' AS DATE);
  end
  if((new.idusuexp is null) and (new.sitexprma!=old.sitexprma)) then
  begin
    SELECT CODEMPUSU,CODFILIALUSU,IDUSUS FROM sgretinfousu(USER) into :ICODEMPUSU,:ICODFILIALUSU,:IDUSU;
    new.codempue = :ICODEMPUSU;
    new.codfilialue = :ICODFILIALUSU;
    new.idusuexp = :IDUSU;
    new.dtaexprma = cast('now' AS DATE);
  end
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQSALDOLOTE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODLOTE" CHAR(13) CHARACTER SET NONE NOT NULL,
"CODEMPAX" INTEGER NOT NULL,
"CODFILIALAX" SMALLINT NOT NULL,
"CODALMOX" INTEGER NOT NULL,
"SLDLOTE" "NUMERICDN" DEFAULT 0 NOT NULL,
"SLDRESLOTE" "NUMERICDN" DEFAULT 0 NOT NULL,
"SLDCONSIGLOTE" "NUMERICDN" DEFAULT 0 NOT NULL,
"SLDLIQLOTE" "NUMERICDN" DEFAULT 0 NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQSALDOLOTETGBI" FOR "EQSALDOLOTE"
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  if (new.SLDLOTE is null) then
     new.SLDLOTE = 0;
  if (new.SLDRESLOTE is null) then
     new.SLDRESLOTE = 0;
  if (new.SLDCONSIGLOTE is null) then
     new.SLDCONSIGLOTE = 0;
  new.SLDLIQLOTE = new.SLDLOTE-new.SLDRESLOTE-new.SLDCONSIGLOTE;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQSALDOLOTETGBU" FOR "EQSALDOLOTE"
ACTIVE BEFORE UPDATE POSITION 0 
AS
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.SLDLOTE is null) then
     new.SLDLOTE = 0;
  if (new.SLDRESLOTE is null) then
     new.SLDRESLOTE = 0;
  if (new.SLDCONSIGLOTE is null) then
     new.SLDCONSIGLOTE = 0;
  new.SLDLIQLOTE = new.SLDLOTE-new.SLDRESLOTE-new.SLDCONSIGLOTE;
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQSALDOPROD"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODEMPAX" INTEGER NOT NULL,
"CODFILIALAX" SMALLINT NOT NULL,
"CODALMOX" INTEGER NOT NULL,
"SLDPROD" "NUMERICDN" DEFAULT 0 NOT NULL,
"SLDRESPROD" "NUMERICDN" DEFAULT 0 NOT NULL,
"SLDCONSIGPROD" "NUMERICDN" DEFAULT 0 NOT NULL,
"SLDLIQPROD" "NUMERICDN" DEFAULT 0 NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQSALDOPRODTGBI" FOR "EQSALDOPROD"
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  if (new.SLDPROD is null) then
     new.SLDPROD = 0;
  if (new.SLDRESPROD is null) then
     new.SLDRESPROD = 0;
  if (new.SLDCONSIGPROD is null) then
     new.SLDCONSIGPROD = 0;
  new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQSALDOPRODTGBU" FOR "EQSALDOPROD"
ACTIVE BEFORE UPDATE POSITION 0 
AS
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.SLDPROD is null) then
     new.SLDPROD = 0;
  if (new.SLDRESPROD is null) then
     new.SLDRESPROD = 0;
  if (new.SLDCONSIGPROD is null) then
     new.SLDCONSIGPROD = 0;
  new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQTIPOEXP"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTIPOEXP" INTEGER NOT NULL,
"DESCTIPOEXP" CHAR(40) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQTIPOEXPTGBU" FOR "EQTIPOEXP"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQTIPOMOVTGBI" FOR "EQTIPOMOV"
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  IF ( (new.TIPOMOV='IV') AND (new.ESTIPOMOV!='I') ) THEN
     EXCEPTION EQTIPOMOVEX01 'FLUXO INCOMPATÍVEL COM O TIPO DE MOVIMENTO';
  ELSE IF (new.ESTIPOMOV = 'E') THEN
  BEGIN
    IF (new.CODTAB IS NOT NULL) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX01;
    END
  END
  ELSE
  BEGIN
    IF (new.CODTAB IS NULL) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX02;
    END
  END
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDVENDA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"TIPOVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'V' NOT NULL,
"CODVENDA" INTEGER NOT NULL,
"CODEMPVD" INTEGER,
"CODFILIALVD" SMALLINT,
"CODVEND" INTEGER,
"CODEMPCL" INTEGER NOT NULL,
"CODFILIALCL" SMALLINT NOT NULL,
"CODCLI" INTEGER NOT NULL,
"CODEMPPG" INTEGER NOT NULL,
"CODFILIALPG" SMALLINT NOT NULL,
"CODPLANOPAG" INTEGER NOT NULL,
"CODEMPSE" INTEGER NOT NULL,
"CODFILIALSE" SMALLINT NOT NULL,
"SERIE" CHAR(4) CHARACTER SET NONE NOT NULL,
"CODEMPTM" INTEGER NOT NULL,
"CODFILIALTM" SMALLINT NOT NULL,
"CODTIPOMOV" INTEGER NOT NULL,
"CODEMPCX" INTEGER,
"CODFILIALCX" SMALLINT,
"CODCAIXA" INTEGER,
"DOCVENDA" INTEGER NOT NULL,
"DTSAIDAVENDA" DATE NOT NULL,
"DTEMITVENDA" DATE NOT NULL,
"VLRPRODVENDA" "NUMERICDN",
"PERCDESCVENDA" NUMERIC(9,2),
"VLRDESCVENDA" "NUMERICDN",
"VLRDESCITVENDA" "NUMERICDN",
"VLRVENDA" "NUMERICDN",
"VLRBASEICMSVENDA" "NUMERICDN",
"VLRICMSVENDA" "NUMERICDN",
"VLRISENTASVENDA" "NUMERICDN",
"VLROUTRASVENDA" "NUMERICDN",
"VLRBASEIPIVENDA" "NUMERICDN",
"VLRLIQVENDA" "NUMERICDN",
"PERCCOMISVENDA" NUMERIC(9,2),
"VLRCOMISVENDA" "NUMERICDN",
"STATUSVENDA" CHAR(2) CHARACTER SET NONE NOT NULL,
"VLRFRETEVENDA" "NUMERICDN",
"VLRADICVENDA" "NUMERICDN",
"VLRIPIVENDA" "NUMERICDN",
"OBSVENDA" VARCHAR(10000) CHARACTER SET NONE,
"CODEMPBO" INTEGER,
"CODFILIALBO" SMALLINT,
"CODBANCO" CHAR(3) CHARACTER SET NONE,
"CODEMPTC" INTEGER,
"CODFILIALTC" SMALLINT,
"CODTIPOCOB" INTEGER,
"VLRBASEISSVENDA" "NUMERICDN" DEFAULT 0,
"VLRISSVENDA" "NUMERICDN" DEFAULT 0,
"IMPNOTAVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CODCLASCOMIS" CHAR(1) CHARACTER SET NONE,
"VLRPISVENDA" "NUMERICDN" DEFAULT 0,
"VLRCOFINSVENDA" "NUMERICDN" DEFAULT 0,
"VLRIRVENDA" "NUMERICDN" DEFAULT 0,
"VLRCSOCIALVENDA" "NUMERICDN" DEFAULT 0,
"PERCMCOMISVENDA" NUMERIC(7,3) DEFAULT 0,
"CODEMPCM" INTEGER,
"CODFILIALCM" INTEGER,
"CODCLCOMIS" INTEGER,
"CODEMPCB" INTEGER,
"CODFILIALCB" SMALLINT,
"CODCARTCOB" CHAR(2) CHARACTER SET NONE,
"PEDCLIVENDA" CHAR(10) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"EMMANUT" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"BLOQVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQTIPOMOVTGBU" FOR "EQTIPOMOV"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT = cast('now' AS DATE);
  new.IDUSUALT = USER;
  new.HALT = cast('now' AS TIME);
  IF ( (new.TIPOMOV='IV') AND (new.ESTIPOMOV!='I') ) THEN
     EXCEPTION EQTIPOMOVEX01 'FLUXO INCOMPATÍVEL COM O TIPO DE MOVIMENTO';
  ELSE IF (new.ESTIPOMOV = 'E') THEN
  BEGIN
    IF (new.CODTAB IS NOT NULL) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX01;
    END
  END
  ELSE
  BEGIN
    IF (new.CODTAB IS NULL) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX02;
    END
  END
  IF (old.ESTOQTIPOMOV != new.ESTOQTIPOMOV) THEN
  BEGIN
    IF ((EXISTS (SELECT CODVENDA FROM VDVENDA WHERE CODTIPOMOV=new.CODTIPOMOV
      AND CODEMPTM=new.CODEMP AND CODFILIALTM=new.CODFILIAL)) OR
        (EXISTS (SELECT CODCOMPRA FROM CPCOMPRA WHERE CODTIPOMOV=new.CODTIPOMOV
      AND CODEMPTM=new.CODEMP AND CODFILIALTM=new.CODFILIAL))) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX01 'JA EXISTE MOVIMENTOS PARA ESTE TIPO DE MOVIMENTO!';
    END
  END
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQUNIDADE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODUNID" CHAR(8) CHARACTER SET NONE NOT NULL,
"DESCUNID" CHAR(40) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQUNIDADETGBU" FOR "EQUNIDADE"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "EQVARGRADE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODVARG" INTEGER NOT NULL,
"DESCVARG" CHAR(30) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "EQVARGRADETGBU" FOR "EQVARGRADE"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNBANCO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODBANCO" CHAR(3) CHARACTER SET NONE NOT NULL,
"NOMEBANCO" CHAR(40) CHARACTER SET NONE NOT NULL,
"DVBANCO" CHAR(1) CHARACTER SET NONE DEFAULT '' NOT NULL,
"SITEBANCO" VARCHAR(80) CHARACTER SET NONE DEFAULT '',
"CODEMPMB" INTEGER,
"CODFILIALMB" INTEGER,
"CODMODBOL" INTEGER,
"IMGBOLBANCO" BLOB SEGMENT SIZE 50,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNBANCOTGBU" FOR "FNBANCO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNCC"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"ANOCC" SMALLINT NOT NULL,
"CODCC" CHAR(19) CHARACTER SET NONE NOT NULL,
"DESCCC" CHAR(50) CHARACTER SET NONE NOT NULL,
"NIVELCC" INTEGER NOT NULL,
"CODREDCC" INTEGER,
"CODEMPSCC" INTEGER,
"CODFILIALSCC" SMALLINT,
"ANOSCC" SMALLINT,
"CODSUBCC" CHAR(19) CHARACTER SET NONE,
"SIGLACC" CHAR(10) CHARACTER SET NONE DEFAULT '' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "SPGERANUM"("ICODEMP" INTEGER,
"ICODFILIAL" INTEGER,
"STAB" CHAR(2) CHARACTER SET NONE)
 RETURNS("ISEQ" INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNCCTGBI" FOR "FNCC"
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
   IF (new.NIVELCC=10) THEN
   BEGIN
     SELECT ISEQ FROM SPGERANUM(new.CODEMP,new.CODFILIAL,'CC') INTO new.CODREDCC;
   END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNCCTGBU" FOR "FNCC"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNCONTA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"NUMCONTA" CHAR(10) CHARACTER SET NONE NOT NULL,
"DESCCONTA" CHAR(50) CHARACTER SET NONE NOT NULL,
"CODEMPMA" INTEGER NOT NULL,
"CODFILIALMA" SMALLINT NOT NULL,
"CODMOEDA" CHAR(4) CHARACTER SET NONE NOT NULL,
"CODEMPBO" INTEGER,
"CODFILIALBO" SMALLINT,
"CODBANCO" CHAR(3) CHARACTER SET NONE,
"CODEMPPN" INTEGER NOT NULL,
"CODFILIALPN" SMALLINT NOT NULL,
"CODPLAN" CHAR(13) CHARACTER SET NONE NOT NULL,
"TIPOCONTA" CHAR(1) CHARACTER SET NONE NOT NULL,
"DATACONTA" DATE NOT NULL,
"CODEMPHP" INTEGER,
"CODFILIALHP" SMALLINT,
"CODHIST" INTEGER,
"CODCONTDEB" VARCHAR(20) CHARACTER SET NONE,
"CODCONTCRED" VARCHAR(20) CHARACTER SET NONE,
"AGENCIACONTA" CHAR(6) CHARACTER SET NONE,
"CONVCOBCONTA" VARCHAR(10) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"ATIVACONTA" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"TUSUCONTA" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNCONTATGBU" FOR "FNCONTA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNCOTMOEDA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODMOEDA" CHAR(4) CHARACTER SET NONE NOT NULL,
"DATACOT" DATE NOT NULL,
"VALORCOT" "NUMERICDN" NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNCOTMOEDATGBU" FOR "FNCOTMOEDA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNFBNCODRET"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODEMPBO" INTEGER NOT NULL,
"CODFILIALBO" SMALLINT NOT NULL,
"CODBANCO" CHAR(3) CHARACTER SET NONE NOT NULL,
"TIPOFEBRABAN" CHAR(2) CHARACTER SET NONE NOT NULL,
"CODRET" VARCHAR(4) CHARACTER SET NONE NOT NULL,
"DESCRET" VARCHAR(50) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now' NOT NULL,
"HINS" TIME DEFAULT 'now' NOT NULL,
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER NOT NULL,
"DTALT" DATE DEFAULT 'now' NOT NULL,
"HALT" TIME DEFAULT 'now' NOT NULL,
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNFBNCODRETTGBU" FOR "FNFBNCODRET"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNHISTPAD"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODHIST" INTEGER NOT NULL,
"DESCHIST" VARCHAR(80) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now' NOT NULL,
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER NOT NULL,
"DTALT" DATE DEFAULT 'now' NOT NULL,
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER NOT NULL,
"HINS" TIME DEFAULT 'now' NOT NULL,
"HALT" TIME DEFAULT 'now' NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNHISTPADTGBU" FOR "FNHISTPAD"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNITPAGAR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPAG" INTEGER NOT NULL,
"NPARCPAG" INTEGER NOT NULL,
"VLRITPAG" "NUMERICDN" NOT NULL,
"VLRDESCITPAG" "NUMERICDN",
"VLRMULTAITPAG" "NUMERICDN",
"VLRJUROSITPAG" "NUMERICDN",
"VLRPARCITPAG" "NUMERICDN" NOT NULL,
"VLRPAGOITPAG" "NUMERICDN",
"VLRAPAGITPAG" "NUMERICDN",
"DTITPAG" DATE NOT NULL,
"DTVENCITPAG" DATE NOT NULL,
"DTPAGOITPAG" DATE,
"STATUSITPAG" CHAR(2) CHARACTER SET NONE NOT NULL,
"CODEMPCA" INTEGER,
"CODFILIALCA" SMALLINT,
"NUMCONTA" CHAR(10) CHARACTER SET NONE,
"CODEMPPN" INTEGER,
"CODFILIALPN" SMALLINT,
"CODPLAN" CHAR(13) CHARACTER SET NONE,
"DOCLANCAITPAG" CHAR(10) CHARACTER SET NONE,
"OBSITPAG" CHAR(50) CHARACTER SET NONE,
"VLRADICITPAG" "NUMERICDN" DEFAULT 0,
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CODEMPCC" INTEGER,
"CODFILIALCC" SMALLINT,
"ANOCC" SMALLINT,
"CODCC" CHAR(19) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNITPAGARTGAD" FOR "FNITPAGAR"
ACTIVE AFTER DELETE POSITION 0 
AS
BEGIN
  UPDATE FNPAGAR SET VLRPAG = VLRPAG - old.VLRITPAG,
         VLRDESCPAG = VLRDESCPAG - old.VLRDESCITPAG,
         VLRMULTAPAG = VLRMULTAPAG  - old.VLRMULTAITPAG,
         VLRJUROSPAG = VLRJUROSPAG - old.VLRJUROSITPAG,
         VLRADICPAG = VLRADICPAG - old.VLRADICITPAG,
         VLRPAGOPAG = VLRPAGOPAG - old.VLRPAGOITPAG,
         VLRPARCPAG = VLRPARCPAG - old.VLRPARCITPAG,
         VLRAPAGPAG = VLRAPAGPAG - old.VLRAPAGITPAG
         WHERE CODPAG=old.CODPAG
         AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNITPAGARTGAU" FOR "FNITPAGAR"
ACTIVE AFTER UPDATE POSITION 0 
AS

BEGIN

  UPDATE FNPAGAR SET VLRPAG = VLRPAG - old.VLRITPAG + new.VLRITPAG,
      VLRDESCPAG = VLRDESCPAG - old.VLRDESCITPAG + new.VLRDESCITPAG,
      VLRMULTAPAG = VLRMULTAPAG - old.VLRMULTAITPAG + new.VLRMULTAITPAG,
      VLRJUROSPAG = VLRJUROSPAG - old.VLRJUROSITPAG + new.VLRJUROSITPAG,
      VLRADICPAG = VLRADICPAG - old.VLRADICITPAG + new.VLRADICITPAG,
      VLRPARCPAG = VLRPARCPAG - old.VLRPARCITPAG + new.VLRPARCITPAG,
      VLRPAGOPAG = VLRPAGOPAG - old.VLRPAGOITPAG + new.VLRPAGOITPAG,
      VLRAPAGPAG = VLRAPAGPAG - old.VLRAPAGITPAG + new.VLRAPAGITPAG
      WHERE CODPAG=new.CODPAG
           AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNITPAGARTGBD" FOR "FNITPAGAR"
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  IF (old.STATUSITPAG = 'PP') THEN
    EXCEPTION FNPAGAREX01;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "FNADICLANCASP02"("ICODPAG" INTEGER,
"INPARCPAG" INTEGER,
"SNUMCONTA" CHAR(10) CHARACTER SET NONE,
"ICODEMPCA" INTEGER,
"ICODFILIALCA" INTEGER,
"ICODFOR" INTEGER,
"ICODEMPFR" INTEGER,
"ICODFILIALFR" INTEGER,
"SCODPLAN" CHAR(13) CHARACTER SET NONE,
"ICODEMPPN" INTEGER,
"ICODFILIALPN" INTEGER,
"IANOCC" INTEGER,
"SCODCC" CHAR(19) CHARACTER SET NONE,
"ICODEMPCC" INTEGER,
"ICODFILIALCC" INTEGER,
"DDTPAGOITPAG" DATE,
"SDOCLANCAITPAG" CHAR(10) CHARACTER SET NONE,
"SOBSITPAG" CHAR(50) CHARACTER SET NONE,
"DVLRPAGOITPAG" NUMERIC(15,5),
"ICODEMP" INTEGER,
"ICODFILIAL" SMALLINT)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNLANCA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODLANCA" INTEGER NOT NULL,
"CODCOMI" INTEGER,
"CODEMPPG" INTEGER,
"CODFILIALPG" SMALLINT,
"CODPAG" INTEGER,
"NPARCPAG" INTEGER,
"CODEMPRC" INTEGER,
"CODFILIALRC" SMALLINT,
"CODREC" INTEGER,
"NPARCITREC" INTEGER,
"CODEMPPN" INTEGER NOT NULL,
"CODFILIALPN" SMALLINT NOT NULL,
"CODPLAN" CHAR(13) CHARACTER SET NONE NOT NULL,
"DATALANCA" DATE NOT NULL,
"DOCLANCA" CHAR(15) CHARACTER SET NONE,
"HISTBLANCA" CHAR(50) CHARACTER SET NONE NOT NULL,
"HISTLANCA" VARCHAR(10000) CHARACTER SET NONE,
"TRANSFLANCA" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"STATUSLANCA" CHAR(2) CHARACTER SET NONE,
"DTPREVLANCA" DATE,
"DTPREVSUBLANCA" DATE,
"VLRLANCA" "NUMERICDN" DEFAULT 0,
"CODEMPCI" INTEGER,
"CODFILIALCI" SMALLINT,
"CODPCOMI" INTEGER,
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"TIPOLANCA" CHAR(1) CHARACTER SET NONE DEFAULT 'A' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNITPAGARTGBU" FOR "FNITPAGAR"
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE IFILIALPAG INTEGER;
  DECLARE VARIABLE ICODFOR INTEGER;
  DECLARE VARIABLE ICODEMPFR INTEGER;
  DECLARE VARIABLE ICODFILIALFR INTEGER;
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
  IF ((old.STATUSITPAG IN ('PP','PL') )  AND (new.STATUSITPAG='P1') ) THEN
  BEGIN
    DELETE FROM FNLANCA WHERE CODPAG=new.CODPAG AND NPARCPAG=new.NPARCPAG
           AND CODEMPPG=new.CODEMP AND CODFILIALPG = new.CODFILIAL
           AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALPAG;
    new.VLRPAGOITPAG = 0;
    new.DTPAGOITPAG = NULL;
  END

  new.VLRITPAG = new.VLRPARCITPAG - new.VLRDESCITPAG + new.VLRJUROSITPAG + new.VLRMULTAITPAG +
  new.VLRADICITPAG;
  new.VLRAPAGITPAG = new.VLRITPAG - new.VLRPAGOITPAG;
  
  if (new.VLRAPAGITPAG < 0) then /* se o valor a pagar for maior que zero */
    new.VLRAPAGITPAG = 0;  /* então valor a pagar será zero */
  if ( (new.VLRAPAGITPAG=0) AND (new.VLRITPAG>0) ) then /* se o valor a pagar for igual a zero e existir valor na parcela*/
    new.STATUSITPAG = 'PP';  /* então o status será PP(pagamento completo) */
  else if ( (new.VLRPAGOITPAG>0) AND (new.VLRITPAG>0) ) then /* caso contrário e o valor pago maior que zero e existir valor na parcela*/
    new.STATUSITPAG = 'PL'; /*  então o status será PL(pagamento parcial) */

  /* faz o lançamento */
  SELECT CODFOR,CODEMPFR,CODFILIALFR FROM FNPAGAR WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND CODPAG=new.CODPAG
    INTO ICODFOR,ICODEMPFR,ICODFILIALFR;
  IF ((old.STATUSITPAG='P1' AND new.STATUSITPAG in ('PP','PL'))
        OR (old.STATUSITPAG in ('PP','PL') AND new.STATUSITPAG in ('PP','PL') AND
        new.VLRPAGOITPAG > 0))THEN
  BEGIN
    EXECUTE PROCEDURE FNADICLANCASP02(new.CodPag,new.NParcPag,new.NumConta,new.CODEMPCA,new.CODFILIALCA,:ICODFOR,:ICODEMPFR,:ICODFILIALFR,
                           new.CodPlan,new.CODEMPPN,new.CODFILIALPN,new.AnoCC,new.CodCC,new.CODEMPCC,new.CODFILIALCC,
                           new.DtPagoItPag,new.DocLancaItPag,new.ObsItPag,new.VlrPagoItPag,new.CODEMP,new.CODFILIAL);

    /* Altera o valor pago e o valor a pagar */
    new.VLRPAGOITPAG = new.VLRPAGOITPAG + old.VLRPAGOITPAG;
    new.VLRAPAGITPAG = new.VLRITPAG - new.VLRPAGOITPAG;

    if (new.VLRAPAGITPAG < 0) then /* se o valor a pagar for maior que zero */
      new.VLRAPAGITPAG = 0;  /* então valor a pagar será zero */
    if (new.VLRAPAGITPAG=0) then /* se o valor a pagar for igual a zero */
      new.STATUSITPAG = 'PP';  /* então o status será PP(pagamento completo) */
    else if (new.VLRPAGOITPAG>0) then /* caso contrário e o valor pago maior que zero */
      new.STATUSITPAG = 'PL'; /*  então o status será PL(pagamento parcial) */

  END
  ELSE IF ((old.STATUSITPAG='PP') AND (new.STATUSITPAG='PP')) THEN
  BEGIN
     EXCEPTION FNPAGAREX01;
  END

END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "VDGERACOMISSAOSP"("ICODEMP" INTEGER,
"SCODFILIAL" SMALLINT,
"ICODREC" INTEGER,
"INPARCITREC" INTEGER,
"NVLRCOMIITREC" NUMERIC(15,5),
"DDTVENCITREC" DATE)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNITRECEBER"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODREC" INTEGER NOT NULL,
"NPARCITREC" INTEGER NOT NULL,
"VLRITREC" "NUMERICDN" NOT NULL,
"VLRDESCITREC" "NUMERICDN",
"VLRMULTAITREC" "NUMERICDN",
"VLRJUROSITREC" "NUMERICDN",
"VLRPARCITREC" "NUMERICDN",
"VLRPAGOITREC" "NUMERICDN",
"VLRAPAGITREC" "NUMERICDN",
"DTITREC" DATE NOT NULL,
"DTVENCITREC" DATE NOT NULL,
"DTPAGOITREC" DATE,
"STATUSITREC" CHAR(2) CHARACTER SET NONE NOT NULL,
"CODEMPPN" INTEGER,
"CODFILIALPN" SMALLINT,
"CODPLAN" CHAR(13) CHARACTER SET NONE,
"OBSITREC" VARCHAR(250) CHARACTER SET NONE,
"CODEMPCA" INTEGER,
"CODFILIALCA" SMALLINT,
"NUMCONTA" CHAR(10) CHARACTER SET NONE,
"CODEMPBO" INTEGER,
"CODFILIALBO" SMALLINT,
"CODBANCO" CHAR(3) CHARACTER SET NONE,
"CODEMPTC" INTEGER,
"CODFILIALTC" SMALLINT,
"CODTIPOCOB" INTEGER,
"CODEMPCB" INTEGER,
"CODFILIALCB" SMALLINT,
"CODCARTCOB" CHAR(2) CHARACTER SET NONE,
"DOCLANCAITREC" CHAR(10) CHARACTER SET NONE,
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CODEMPCC" INTEGER,
"CODFILIALCC" SMALLINT,
"ANOCC" SMALLINT,
"CODCC" CHAR(19) CHARACTER SET NONE,
"VLRCOMIITREC" "NUMERICDN" DEFAULT 0,
"IMPRECIBOITREC" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"RECIBOITREC" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"ALTUSUITREC" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNITRECEBERTGAI" FOR "FNITRECEBER"
ACTIVE AFTER INSERT POSITION 0 
AS
BEGIN
  EXECUTE PROCEDURE vdgeracomissaosp(new.CODEMP, new.CODFILIAL, new.CODREC, new.NPARCITREC,
    new.VLRCOMIITREC, new.DTVENCITREC);
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNRECEBER"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODREC" INTEGER NOT NULL,
"CODEMPBO" INTEGER,
"CODFILIALBO" SMALLINT,
"CODBANCO" CHAR(3) CHARACTER SET NONE,
"CODEMPPG" INTEGER NOT NULL,
"CODFILIALPG" SMALLINT NOT NULL,
"CODPLANOPAG" INTEGER NOT NULL,
"CODEMPCL" INTEGER NOT NULL,
"CODFILIALCL" SMALLINT NOT NULL,
"CODCLI" INTEGER NOT NULL,
"CODEMPVD" INTEGER,
"CODFILIALVD" SMALLINT,
"CODVEND" INTEGER,
"CODEMPVA" INTEGER,
"CODFILIALVA" SMALLINT,
"TIPOVENDA" CHAR(1) CHARACTER SET NONE,
"CODVENDA" INTEGER,
"CODEMPTC" INTEGER,
"CODFILIALTC" SMALLINT,
"CODTIPOCOB" INTEGER,
"CODEMPCB" INTEGER,
"CODFILIALCB" SMALLINT,
"CODCARTCOB" CHAR(2) CHARACTER SET NONE,
"VLRREC" "NUMERICDN" NOT NULL,
"VLRDESCREC" "NUMERICDN",
"VLRMULTAREC" "NUMERICDN",
"VLRJUROSREC" "NUMERICDN",
"VLRPARCREC" "NUMERICDN" NOT NULL,
"VLRPAGOREC" "NUMERICDN",
"VLRAPAGREC" "NUMERICDN",
"DATAREC" DATE NOT NULL,
"STATUSREC" CHAR(2) CHARACTER SET NONE NOT NULL,
"VLRCOMIREC" "NUMERICDN",
"DTQUITREC" DATE,
"DOCREC" INTEGER NOT NULL,
"NROPARCREC" INTEGER DEFAULT 0,
"OBSREC" VARCHAR(250) CHARACTER SET NONE,
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"ALTUSUREC" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
CREATE TABLE "VDCOMISSAO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCOMI" INTEGER NOT NULL,
"TIPOCOMI" CHAR(1) CHARACTER SET NONE DEFAULT 'F' NOT NULL,
"CODEMPRC" INTEGER NOT NULL,
"CODFILIALRC" SMALLINT NOT NULL,
"CODREC" INTEGER NOT NULL,
"NPARCITREC" INTEGER NOT NULL,
"VLRVENDACOMI" "NUMERICDN" NOT NULL,
"VLRCOMI" "NUMERICDN" NOT NULL,
"VLRPAGOCOMI" "NUMERICDN" DEFAULT 0 NOT NULL,
"VLRAPAGCOMI" "NUMERICDN" DEFAULT 0 NOT NULL,
"DATACOMI" DATE NOT NULL,
"DTVENCCOMI" DATE NOT NULL,
"DTPAGTOCOMI" DATE,
"STATUSCOMI" CHAR(2) CHARACTER SET NONE NOT NULL,
"CODEMPCI" INTEGER,
"CODFILIALCI" SMALLINT,
"CODPCOMI" INTEGER,
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CODEMPCT" INTEGER,
"CODFILIALCT" SMALLINT,
"CODPCOMIANT" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "FNADICLANCASP01"("ICODREC" INTEGER,
"INPARCITREC" INTEGER,
"SNUMCONTA" CHAR(10) CHARACTER SET NONE,
"ICODEMPCA" INTEGER,
"ICODFILIALCA" INTEGER,
"ICODCLI" INTEGER,
"ICODEMPCL" INTEGER,
"ICODFILIALCL" INTEGER,
"SCODPLAN" CHAR(13) CHARACTER SET NONE,
"ICODEMPPN" INTEGER,
"ICODFILIALPN" INTEGER,
"IANOCC" INTEGER,
"SCODCC" CHAR(19) CHARACTER SET NONE,
"ICODEMPCC" INTEGER,
"ICODFILIALCC" INTEGER,
"DDTPAGOITREC" DATE,
"SDOCLANCAITREC" CHAR(10) CHARACTER SET NONE,
"SOBSITREC" CHAR(50) CHARACTER SET NONE,
"DVLRPAGOITREC" NUMERIC(18,2),
"ICODEMP" INTEGER,
"ICODFILIAL" SMALLINT)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNITRECEBERTGAU" FOR "FNITRECEBER"
ACTIVE AFTER UPDATE POSITION 0 
AS
DECLARE VARIABLE ICODCLI INTEGER;
DECLARE VARIABLE ICODEMPCL INTEGER;
DECLARE VARIABLE ICODFILIALCL INTEGER;
BEGIN
  IF ((old.STATUSITREC='R1' AND new.STATUSITREC in ('RP','RL'))
     OR (old.STATUSITREC in ('RP','RL') AND new.STATUSITREC in ('RP','RL') AND new.VLRPAGOITREC > 0)) THEN
  BEGIN
     SELECT CODCLI,CODEMPCL,CODFILIALCL FROM FNRECEBER WHERE CODEMP=new.CODEMP AND
        CODFILIAL=new.CODFILIAL AND CODREC=new.CODREC
        INTO ICODCLI,ICODEMPCL,ICODFILIALCL;
     IF ((new.VLRPAGOITREC-old.VLRPAGOITREC) > 0) THEN
     BEGIN
        EXECUTE PROCEDURE FNADICLANCASP01(new.CodRec,new.NParcItRec,new.PDVITREC,new.NumConta,new.CODEMPCA,new.CODFILIALCA,:ICODCLI,:ICODEMPCL,:ICODFILIALCL,
                           new.CodPlan,new.CODEMPPN,new.CODFILIALPN,new.ANOCC,new.CODCC,new.CODEMPCC,new.CODFILIALCC,new.DtPagoItRec,new.DocLancaItRec,
                           SUBSTRING(new.ObsItRec FROM 1 FOR 50),new.VlrPagoItRec-old.VlrPagoItRec,new.CODEMP,new.CODFILIAL);
     END
     IF (new.STATUSITREC = 'RP') THEN
     BEGIN
         UPDATE VDCOMISSAO SET STATUSCOMI='C2'
            WHERE CODREC=old.CODREC
            AND CODEMPRC=old.CODEMP
            AND CODFILIALRC=old.CODFILIAL
            AND NPARCITREC=old.NPARCITREC
            AND NOT STATUSCOMI IN ('CP','C2')
            AND CODEMP=old.CODEMP;
     END
  END
  ELSE IF (old.VLRCOMIITREC != new.VLRCOMIITREC) THEN
  BEGIN
     EXECUTE PROCEDURE vdgeracomissaosp(new.CODEMP, new.CODFILIAL, new.CODREC,
        new.NPARCITREC, new.VLRCOMIITREC, new.DTVENCITREC);
  END
  IF ( (new.ALTUSUITREC='S') AND ( (old.VLRITREC!=new.VLRITREC) OR
       (old.VLRDESCITREC!=new.VLRDESCITREC) OR (old.VLRMULTAITREC!=new.VLRMULTAITREC) OR
       (old.VLRJUROSITREC!=new.VLRJUROSITREC) OR (old.VLRPARCITREC!=new.VLRPARCITREC) OR
       (old.VLRPAGOITREC!=new.VLRPAGOITREC) OR (old.VLRAPAGITREC!=new.VLRAPAGITREC) ) ) THEN
     UPDATE FNRECEBER SET VLRREC = VLRREC - old.VLRITREC + new.VLRITREC,
         VLRDESCREC = VLRDESCREC - old.VLRDESCITREC + new.VLRDESCITREC,
         VLRMULTAREC = VLRMULTAREC - old.VLRMULTAITREC + new.VLRMULTAITREC,
         VLRJUROSREC = VLRJUROSREC - old.VLRJUROSITREC + new.VLRJUROSITREC,
         VLRPARCREC = VLRPARCREC - old.VLRPARCITREC + new.VLRPARCITREC,
         VLRPAGOREC = VLRPAGOREC - old.VLRPAGOITREC + new.VLRPAGOITREC,
         VLRAPAGREC = VLRAPAGREC - old.VLRAPAGITREC + new.VLRAPAGITREC,
         ALTUSUREC = 'S' WHERE CODREC=new.CODREC
        AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNITRECEBERTGBD" FOR "FNITRECEBER"
ACTIVE BEFORE DELETE POSITION 0 
AS
DECLARE VARIABLE IFILIALCOMI INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(old.CODEMP,'VDCOMISSAO') INTO IFILIALCOMI;
  IF (old.STATUSITREC not in ('RP','RL') ) THEN
    DELETE FROM VDCOMISSAO WHERE CODREC=old.CODREC AND NPARCITREC=old.NPARCITREC
           AND CODEMP=old.CODEMP AND CODFILIAL = :IFILIALCOMI;
  ELSE
    EXCEPTION FNITRECEBEREX01;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNITRECEBERTGBI" FOR "FNITRECEBER"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  if (new.vlrparcitrec is null) then
     new.vlrparcitrec = 0;
  if (new.vlrdescitrec is null) then
     new.vlrdescitrec = 0;
  if (new.vlrjurositrec is null) then
     new.vlrjurositrec = 0;
  if (new.vlrmultaitrec is null) then
     new.vlrmultaitrec = 0;
  new.vlritrec = new.vlrparcitrec - new.vlrdescitrec + new.vlrjurositrec + new.vlrmultaitrec;
  new.vlrapagitrec = new.vlritrec - new.vlrpagoitrec;
  if (new.vlrapagitrec<0) then
      new.vlrapagitrec = 0;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNITRECEBERTGBU" FOR "FNITRECEBER"
ACTIVE BEFORE UPDATE POSITION 0 
AS
DECLARE VARIABLE SCODFILIALCI SMALLINT;
DECLARE VARIABLE SCODFILIALLC SMALLINT;
DECLARE VARIABLE SCODFILIALPF SMALLINT;
DECLARE VARIABLE CCOMISPDUPL CHAR(1);
DECLARE VARIABLE NVLRPARCREC NUMERIC(15, 5);
DECLARE VARIABLE NVLRCOMIREC NUMERIC(15, 5);
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( new.ALTUSUITREC IS NULL ) THEN /* Para não permitir flag de usuário nulo */
     new.ALTUSUITREC = 'S';
  IF ( (old.STATUSITREC IN ('RP','RL') )  AND (new.STATUSITREC='R1') ) THEN
  BEGIN
    SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNCOMISSAO') INTO :SCODFILIALCI;
    SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNLANCA') INTO :SCODFILIALLC;
    UPDATE VDCOMISSAO SET STATUSCOMI='C1'
           WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC
           AND CODEMPRC = new.CODEMP AND CODFILIALRC=new.CODFILIAL
           AND CODEMP=new.CODEMP AND CODFILIAL=:SCODFILIALCI
           AND STATUSCOMI NOT IN ('CE') AND TIPOCOMI='R';
    DELETE FROM FNLANCA WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC
           AND CODEMPRC= new.CODEMP AND CODFILIALRC=new.CODFILIAL
           AND CODEMP=new.CODEMP AND CODFILIAL = :SCODFILIALLC;
    new.VLRPAGOITREC = 0;
  END
  new.VLRITREC = new.VLRPARCITREC - new.VLRDESCITREC + new.VLRJUROSITREC + new.VLRMULTAITREC;
  new.VLRAPAGITREC = new.VLRITREC - new.VLRPAGOITREC;
  if (new.VLRAPAGITREC < 0) then /* se o valor a pagar for maior que zero */
    new.VLRAPAGITREC = 0;  /* então valor a pagar será zero */
  if (new.VLRAPAGITREC=0) then /* se o valor a pagar for igual a zero */
    new.STATUSITREC = 'RP';  /* então o status será RP(pagamento completo) */
  else if (new.VLRPAGOITREC>0) then /* caso contrário e o valor pago maior que zero */
    new.STATUSITREC = 'RL'; /*  então o status será RL(pagamento parcial) */
  /*
    Esta seção é destinada e ajustar as comissões conforme os valores de parcelas
    caso o preferências esteja ajustado para isso.
  */
  IF ( (new.VLRPARCITREC!=old.VLRPARCITREC) AND (new.VLRPARCITREC!=0) ) THEN
  BEGIN
     SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :SCODFILIALPF;
     SELECT P1.COMISPDUPL  FROM SGPREFERE1 P1
         WHERE P1.CODEMP=new.CODEMP AND P1.CODFILIAL=:SCODFILIALPF INTO :CCOMISPDUPL;
     IF (CCOMISPDUPL='S') THEN
     BEGIN
        SELECT V.VLRLIQVENDA, R.VLRCOMIREC FROM FNRECEBER R, VDVENDA V
          WHERE R.CODEMP=new.CODEMP AND R.CODFILIAL=new.CODFILIAL AND
              R.CODREC=new.CODREC AND V.CODEMP=R.CODEMPVA AND V.CODFILIAL=R.CODFILIALVA AND
              V.TIPOVENDA=R.TIPOVENDA AND V.CODVENDA=R.CODVENDA INTO :NVLRPARCREC, :NVLRCOMIREC;
        IF (NVLRPARCREC!=0) THEN
          new.VLRCOMIITREC = cast( new.VLRPARCITREC * :NVLRCOMIREC / :NVLRPARCREC as NUMERIC(15, 5) );
     END
  END
  IF ((old.IMPRECIBOITREC='N') AND (new.IMPRECIBOITREC='S') AND (new.RECIBOITREC IS NULL)) THEN
  BEGIN
     SELECT ISEQ FROM SPGERANUM(new.CODEMP,new.CODFILIAL,'RB') INTO new.RECIBOITREC;
  END
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNITTBJUROS"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTBJ" INTEGER NOT NULL,
"ANOITTBJ" SMALLINT NOT NULL,
"MESITTBJ" SMALLINT NOT NULL,
"PERCITTBJ" NUMERIC(7,3) DEFAULT 0 NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNITTBJUROSTGBU" FOR "FNITTBJUROS"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNSUBLANCA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODLANCA" INTEGER NOT NULL,
"CODSUBLANCA" INTEGER NOT NULL,
"CODEMPPN" INTEGER NOT NULL,
"CODFILIALPN" SMALLINT NOT NULL,
"CODPLAN" CHAR(13) CHARACTER SET NONE NOT NULL,
"STATUSSUBLANCA" CHAR(2) CHARACTER SET NONE NOT NULL,
"ORIGSUBLANCA" CHAR(1) CHARACTER SET NONE,
"DTPREVSUBLANCA" DATE,
"DATASUBLANCA" DATE,
"VLRSUBLANCA" "NUMERICDN" DEFAULT 0,
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CODEMPCC" INTEGER,
"CODFILIALCC" SMALLINT,
"ANOCC" SMALLINT,
"CODCC" CHAR(19) CHARACTER SET NONE,
"CODEMPCL" INTEGER,
"CODFILIALCL" SMALLINT,
"CODCLI" INTEGER,
"CODEMPFR" INTEGER,
"CODFILIALFR" SMALLINT,
"CODFOR" INTEGER,
"HISTSUBLANCA" CHAR(50) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNLANCATGAI" FOR "FNLANCA"
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE IFILIALPLAN INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPLANEJAMENTO') INTO IFILIALPLAN;
  INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPPN,CODFILIALPN,CODPLAN,DTPREVSUBLANCA,DATASUBLANCA,VLRSUBLANCA,ORIGSUBLANCA,FLAG)
                       VALUES (new.CODEMP,new.CODFILIAL,new.CODLANCA,0,new.CODEMP,:IFILIALPLAN,new.CODPLAN,new.DTPREVLANCA,new.DATALANCA,new.VLRLANCA,'S',new.FLAG);
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNLANCATGAU" FOR "FNLANCA"
ACTIVE AFTER UPDATE POSITION 0 
AS
BEGIN
  UPDATE FNSUBLANCA SET DTPREVSUBLANCA=new.DTPREVLANCA,
         DATASUBLANCA=new.DATALANCA,VLRSUBLANCA=new.VLRLANCA,FLAG=new.FLAG
         WHERE CODLANCA=old.CODLANCA AND CODSUBLANCA=0
         AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNLANCATGBD" FOR "FNLANCA"
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  DELETE FROM FNSUBLANCA WHERE CODLANCA=old.CODLANCA
         AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNLANCATGBI" FOR "FNLANCA"
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  new.STATUSLANCA = 'L1';
  IF (new.HISTLANCA IS NULL) THEN
    new.HISTLANCA = new.HISTBLANCA;
  IF (new.DTPREVLANCA IS NULL) THEN
    new.DTPREVLANCA = new.DATALANCA;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNLANCATGBU" FOR "FNLANCA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNLIBCRED"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODLCRED" INTEGER NOT NULL,
"CODVENDA" INTEGER NOT NULL,
"DTAEMITLCRED" DATE DEFAULT 'now' NOT NULL,
"VLRAUTORIZLCRED" "NUMERICDN" DEFAULT 0 NOT NULL,
"VLRUTILLCRED" "NUMERICDN" DEFAULT 0 NOT NULL,
"CODEMPUS" INTEGER,
"CODFILIALUS" SMALLINT,
"IDUSU" CHAR(8) CHARACTER SET NONE,
"DTAUTILLCRED" DATE,
"SITLCRED" CHAR(1) CHARACTER SET NONE DEFAULT 'L' NOT NULL,
"CODEMPCL" INTEGER NOT NULL,
"CODFILIALCL" SMALLINT NOT NULL,
"CODCLI" INTEGER NOT NULL,
"DTAVCTOLCRED" DATE DEFAULT 'today' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNLIBCREDTGBI" FOR "FNLIBCRED"
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGUSUARIO') INTO new.CODFILIALUS;
  new.CODEMPUS = new.CODEMP;
  new.IDUSU=lower(USER);
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNLIBCREDTGBU" FOR "FNLIBCRED"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNMODBOLETO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"CODMODBOL" INTEGER NOT NULL,
"DESCMODBOL" CHAR(30) CHARACTER SET NONE NOT NULL,
"TXAMODBOL" VARCHAR(10000) CHARACTER SET NONE DEFAULT ' ' NOT NULL,
"PREIMPMODBOL" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"CARTCOB" CHAR(2) CHARACTER SET NONE DEFAULT '' NOT NULL,
"MDECOB" CHAR(2) CHARACTER SET NONE DEFAULT '21' NOT NULL,
"ACEITEMODBOL" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"CLASSMODBOL" VARCHAR(80) CHARACTER SET NONE,
"ESPDOCMODBOL" CHAR(3) CHARACTER SET NONE,
"DESCLPMODBOL" VARCHAR(80) CHARACTER SET NONE,
"INSTPAGMODBOL" VARCHAR(500) CHARACTER SET NONE,
"CODEMPCC" INTEGER,
"CODFILIALCC" SMALLINT,
"NUMCONTA" CHAR(10) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNMODBOLETOTGBU" FOR "FNMODBOLETO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNMOEDA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODMOEDA" CHAR(4) CHARACTER SET NONE NOT NULL,
"TIPOMOEDA" CHAR(1) CHARACTER SET NONE NOT NULL,
"ATUALIZAMOEDA" CHAR(1) CHARACTER SET NONE NOT NULL,
"SINGMOEDA" CHAR(20) CHARACTER SET NONE NOT NULL,
"PLURMOEDA" CHAR(20) CHARACTER SET NONE NOT NULL,
"CODFBNMOEDA" CHAR(1) CHARACTER SET NONE DEFAULT '9' NOT NULL,
"DECSMOEDA" CHAR(20) CHARACTER SET NONE,
"DECPMOEDA" CHAR(20) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNMOEDATGBU" FOR "FNMOEDA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNPARCPAG"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPLANOPAG" INTEGER NOT NULL,
"NROPARCPAG" INTEGER NOT NULL,
"PERCPAG" NUMERIC(9,5),
"DIASPAG" INTEGER,
"DESCPARCPAG" CHAR(30) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
CREATE TABLE "FNPLANOPAG"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPLANOPAG" INTEGER NOT NULL,
"DESCPLANOPAG" CHAR(40) CHARACTER SET NONE,
"PARCPLANOPAG" INTEGER NOT NULL,
"APORCPLANOPAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"AUTOBAIXAPLANOPAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CODEMPCA" INTEGER,
"CODFILIALCA" SMALLINT,
"NUMCONTA" CHAR(10) CHARACTER SET NONE,
"CODEMPPN" INTEGER,
"CODFILIALPN" SMALLINT,
"CODPLAN" CHAR(13) CHARACTER SET NONE,
"CODEMPCC" INTEGER,
"CODFILIALCC" SMALLINT,
"ANOCC" SMALLINT,
"CODCC" CHAR(19) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"ATIVOPLANOPAG" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"CVPLANOPAG" CHAR(1) CHARACTER SET NONE DEFAULT 'A' NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPAGARTGAI" FOR "FNPAGAR"
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE dVlrPAG NUMERIC(15, 5);
DECLARE VARIABLE dPercPag NUMERIC(11,6);
DECLARE VARIABLE dResto NUMERIC(15, 5);
DECLARE VARIABLE iNumParc INTEGER;
DECLARE VARIABLE iDiasPag INTEGER;
DECLARE VARIABLE i INTEGER;
DECLARE VARIABLE IFILIALPP INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPLANOPAG') INTO IFILIALPP;
  IF (new.VLRPAG IS NULL) THEN new.VLRPAG = 0;
  IF (new.VLRDESCPAG IS NULL) THEN new.VLRDESCPAG = 0;
  IF (new.VLRJUROSPAG IS NULL) THEN new.VLRJUROSPAG = 0;
  IF (new.VLRMULTAPAG IS NULL) THEN new.VLRMULTAPAG = 0;
  IF (new.VLRPARCPAG IS NULL) THEN new.VLRPARCPAG = 0;
  IF (new.VLRAPAGPAG IS NULL) THEN new.VLRAPAGPAG = 0;
  IF (new.VLRPAGOPAG IS NULL) THEN new.VLRPAGOPAG = 0;
  i = 0;
  dResto = new.VLRPAG;
  SELECT PARCPLANOPAG FROM FNPLANOPAG WHERE CODPLANOPAG=new.CODPLANOPAG
         AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPP INTO :iNumParc;
  FOR SELECT PERCPAG,DIASPAG FROM FNPARCPAG WHERE CODPLANOPAG=new.CODPLANOPAG
             AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPP ORDER BY DIASPAG
             INTO :dPercPag,:iDiasPag
             DO
  BEGIN
    i = i+1;
    dVlrPAG = cast(cast(new.VLRPAG*dPercPag as NUMERIC(15, 5))/100 AS NUMERIC(15, 5));
    dResto = dResto-dVlrPAG;
    IF (i = iNumParc) THEN
    BEGIN
      dVlrPAG=dVlrPAG+dResto;
    END
    INSERT INTO FNITPAGAR (CODEMP,CODFILIAL,CODPAG,NPARCPAG,VLRITPAG,VLRDESCITPAG,VLRMULTAITPAG,
                           VLRJUROSITPAG,VLRPARCITPAG,VLRPAGOITPAG,VLRAPAGITPAG,
                           DTITPAG,DTVENCITPAG,STATUSITPAG,VLRADICITPAG,FLAG,OBSITPAG,
                           CODEMPTC,CODFILIALTC,CODTIPOCOB) VALUES
                           (new.CODEMP,new.CODFILIAL,new.CODPAG,:i,:dVlrPAG,0,0,0,:dVlrPAG,0,:dVlrPAG,
                            new.DATAPAG,new.DATAPAG+:iDiasPag,'P1',new.VLRADICPAG,new.FLAG,new.OBSPAG,
                            new.CODEMPTC,new.CODFILIALTC,new.CODTIPOCOB);
  END
  new.NROPARCPAG = :i;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPAGARTGBD" FOR "FNPAGAR"
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  DELETE FROM FNITPAGAR WHERE CODPAG = old.CODPAG
         AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPAGARTGBI" FOR "FNPAGAR"
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  IF (new.VLRDESCPAG IS NULL) THEN new.VLRDESCPAG = 0;
  IF (new.VLRJUROSPAG IS NULL) THEN new.VLRJUROSPAG = 0;
  IF (new.VLRMULTAPAG IS NULL) THEN new.VLRMULTAPAG = 0;
  IF (new.VLRPARCPAG IS NULL) THEN new.VLRPARCPAG = 0;
  IF (new.VLRPAGOPAG IS NULL) THEN new.VLRPAGOPAG = 0;
  IF (new.STATUSPAG IS NULL) THEN new.STATUSPAG = 'P1';
  new.VLRPAG = new.VLRPARCPAG - new.VLRDESCPAG + new.VLRJUROSPAG + new.VLRADICPAG +
  new.VLRMULTAPAG;
  new.VLRAPAGPAG = new.VLRPAG - new.VLRPAGOPAG;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPAGARTGBU" FOR "FNPAGAR"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNPAGTOCOMI"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPCOMI" INTEGER NOT NULL,
"CODEMPPN" INTEGER NOT NULL,
"CODFILIALPN" SMALLINT NOT NULL,
"CODPLAN" CHAR(13) CHARACTER SET NONE NOT NULL,
"CODEMPCA" INTEGER NOT NULL,
"CODFILIALCA" SMALLINT NOT NULL,
"NUMCONTA" CHAR(10) CHARACTER SET NONE NOT NULL,
"VLRPCOMI" "NUMERICDN" DEFAULT 0,
"DOCPCOMI" INTEGER NOT NULL,
"OBSPCOMI" VARCHAR(300) CHARACTER SET NONE,
"DATAPCOMI" DATE NOT NULL,
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPAGTOCOMITGAI" FOR "FNPAGTOCOMI"
ACTIVE AFTER INSERT POSITION 0 
AS
  DECLARE VARIABLE iCodLanca INTEGER;
  DECLARE VARIABLE sCodPlanConta CHAR(13);
  DECLARE VARIABLE iPlanEmp INTEGER;
  DECLARE VARIABLE iPlanFilial INTEGER;
  DECLARE VARIABLE IFILIALLANCA INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNLANCA') INTO IFILIALLANCA;
  SELECT CODPLAN,CODEMP,CODFILIAL FROM FNCONTA WHERE NUMCONTA=new.NUMCONTA
         AND CODEMP=new.CODEMPCA AND CODFILIAL = new.CODFILIALCA INTO :sCodPlanConta,:iPlanEmp,:iPlanFilial;
  SELECT ISEQ FROM SPGERANUM(new.CODEMP,new.CODFILIAL,'LA') INTO :iCodLanca;
  INSERT INTO FNLANCA (CODEMP,CODFILIAL,CODLANCA,CODEMPCI,CODFILIALCI,CODPCOMI,CODEMPPN,CODFILIALPN,CODPLAN,DATALANCA,DOCLANCA,
                     HISTBLANCA,DTPREVLANCA,VLRLANCA,FLAG)
            VALUES (new.CODEMP,new.CODFILIAL,:iCodLanca,new.CODEMP,new.CODFILIAL,new.CODPCOMI,:iPlanEmp,:iPlanFilial,:sCodPlanConta,new.DATAPCOMI,
                   new.DOCPCOMI,new.OBSPCOMI,new.DATAPCOMI,0,new.FLAG);
  INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPPN,CODFILIALPN,CODPLAN,ORIGSUBLANCA,DATASUBLANCA,DTPREVSUBLANCA,VLRSUBLANCA,FLAG)
            VALUES (new.CODEMP,new.CODFILIAL,:iCodLanca,1,new.CODEMPPN,new.CODFILIALPN,new.CODPLAN,'S',new.DATAPCOMI,new.DATAPCOMI,new.VLRPCOMI,new.FLAG);
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPAGTOCOMITGBD" FOR "FNPAGTOCOMI"
ACTIVE BEFORE DELETE POSITION 0 
AS
DECLARE VARIABLE IFILIALLANCA INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(old.CODEMP,'FNLANCA') INTO IFILIALLANCA;
  DELETE FROM FNLANCA WHERE CODPCOMI=old.codpcomi
         AND CODEMPCI=old.CODEMP AND CODFILIALCI=old.CODFILIAL
         AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALLANCA;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPAGTOCOMITGBU" FOR "FNPAGTOCOMI"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPARCPAGTGBU" FOR "FNPARCPAG"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNPLANEJAMENTO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPLAN" CHAR(13) CHARACTER SET NONE NOT NULL,
"DESCPLAN" CHAR(50) CHARACTER SET NONE NOT NULL,
"NIVELPLAN" INTEGER NOT NULL,
"CODREDPLAN" INTEGER,
"CODEMPSP" INTEGER,
"CODFILIALSP" SMALLINT,
"CODSUBPLAN" CHAR(13) CHARACTER SET NONE,
"TIPOPLAN" CHAR(1) CHARACTER SET NONE NOT NULL,
"FINPLAN" CHAR(2) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPLANEJAMENTOTGBI" FOR "FNPLANEJAMENTO"
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE iCodredplan Integer;
BEGIN
   IF (new.NIVELPLAN=6) THEN
   BEGIN
     iCodredplan = 0;
     SELECT MAX(CODREDPLAN) FROM FNPLANEJAMENTO WHERE CODEMP=new.CODEMP
            AND CODFILIAL = new.CODFILIAL INTO :iCodredplan;
     new.CODREDPLAN = iCodredplan + 1;
   END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPLANEJAMENTOTGBU" FOR "FNPLANEJAMENTO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPLANOPAGTGAI" FOR "FNPLANOPAG"
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE i Integer;
DECLARE VARIABLE iDias Integer;
DECLARE VARIABLE dPerc NUMERIC(10,6);
DECLARE VARIABLE dTotPerc NUMERIC(10,6);
BEGIN
   IF (new.PARCPLANOPAG>0) THEN
   BEGIN
     i = 1;
     dTotPerc = 0;
     dPerc = 100.000000/new.PARCPLANOPAG;
     WHILE (i<=new.PARCPLANOPAG) DO
     BEGIN
        iDias = (i-1)*30;
        IF (i = new.PARCPLANOPAG) THEN
          dPerc = 100.000000-dTotPerc;
        INSERT INTO FNPARCPAG (CODEMP,CODFILIAL,CODPLANOPAG,NROPARCPAG,PERCPAG,DIASPAG)
               VALUES (new.CODEMP,new.CODFILIAL,new.CODPLANOPAG,:i,:dPerc,:iDias);
        dTotPerc = dTotPerc + dPerc;
        i = i + 1;
     END
   END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPLANOPAGTGBD" FOR "FNPLANOPAG"
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  DELETE FROM FNPARCPAG WHERE CODPLANOPAG=old.CODPLANOPAG
         AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNPLANOPAGTGBU" FOR "FNPLANOPAG"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNRECEBERRGBD" FOR "FNRECEBER"
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
    DELETE FROM FNITRECEBER WHERE CODREC = old.CODREC
         AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "FNGERAITRECEBERSP01"("CALTVLR" CHAR(1) CHARACTER SET NONE,
"ICODEMP" INTEGER,
"SCODFILIAL" SMALLINT,
"ICODREC" INTEGER,
"ICODEMPPG" INTEGER,
"SCODFILIALPG" SMALLINT,
"ICODPLANOPAG" INTEGER,
"NVLRREC" NUMERIC(15,5),
"DDATAREC" DATE,
"CFLAG" CHAR(1) CHARACTER SET NONE,
"ICODEMPBO" INTEGER,
"SCODFILIALBO" SMALLINT,
"CCODBANCO" CHAR(3) CHARACTER SET NONE,
"ICODEMPTC" INTEGER,
"SCODFILIALTC" SMALLINT,
"ICODTIPOCOB" INTEGER,
"ICODEMPCB" INTEGER,
"SCODFILIALCB" SMALLINT,
"CODCARTCOB" CHAR(2) CHARACTER SET NONE,
"NVLRCOMIREC" NUMERIC(15,5),
"OBSREC" VARCHAR(250) CHARACTER SET NONE)
 RETURNS("I" INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNRECEBERTGAI" FOR "FNRECEBER"
ACTIVE AFTER INSERT POSITION 0 
AS
  DECLARE VARIABLE NPARCREC INTEGER;
  DECLARE VARIABLE CODFILIALPP SMALLINT;
  DECLARE VARIABLE NUMCONTA CHAR(10);
  DECLARE VARIABLE CODFILIALCA SMALLINT;
  DECLARE VARIABLE CODPLAN CHAR(13);
  DECLARE VARIABLE CODFILIALPN SMALLINT;
  DECLARE VARIABLE CODCC CHAR(19);
  DECLARE VARIABLE ANOCC SMALLINT;
  DECLARE VARIABLE CODFILIALCC SMALLINT;
  DECLARE VARIABLE CODFILIALIR SMALLINT;
  DECLARE VARIABLE CODFILIALCL SMALLINT;
  DECLARE VARIABLE ATIVOCLI CHAR(1);
  DECLARE VARIABLE NUMRESTR INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'VDCLIENTE') INTO CODFILIALCL;
  SELECT C.ATIVOCLI  FROM VDCLIENTE C WHERE C.CODEMP=NEW.CODEMP AND
     C.CODFILIAL=:CODFILIALCL AND C.CODCLI=NEW.CODCLI INTO :ATIVOCLI;
  IF (ATIVOCLI<>'S') THEN
  BEGIN
     EXCEPTION FNRECEBEREX01;
  END
  SELECT COUNT(*) FROM FNRESTRICAO R
    WHERE R.CODEMP=NEW.CODEMP AND R.CODFILIAL=:CODFILIALCL AND
      R.CODCLI=NEW.CODCLI AND R.SITRESTR IN ('I') INTO :NUMRESTR;
  IF ( (NUMRESTR IS NOT NULL) AND (NUMRESTR>0) ) THEN
  BEGIN
     IF (NUMRESTR=1) THEN
     BEGIN
        EXCEPTION FNRECEBEREX02 'Cliente possui '||RTRIM(CAST(NUMRESTR AS CHAR(10)))||' restrição!';
     END
     ELSE
     BEGIN
        EXCEPTION FNRECEBEREX02 'Cliente possui '||RTRIM(CAST(NUMRESTR AS CHAR(10)))||' restrições!';
     END
  END
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNPLANOPAG') INTO CODFILIALPP;
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNPLANEJAMENTO') INTO CODFILIALPN;
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNCENTROCUSTO') INTO CODFILIALCC;
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNITRECEBER') INTO CODFILIALIR;
  SELECT I FROM fngeraitrecebersp01('S',new.CODEMP,
    new.CODFILIAL, new.CODREC, new.CODEMPPG, new.CODFILIALPG, new.CODPLANOPAG,
    new.VLRREC, new.DATAREC, new.FLAG, new.CODEMPBO, new.CODFILIALBO,
    new.CODBANCO, new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
    new.CODEMPCB, new.CODFILIALCB, new.CODCARTCOB,
    new.VLRCOMIREC, new.OBSREC) INTO new.NROPARCREC;

/* Se a parcela do plano de pagamento tiver marcado para autobaixa, então é realizada a baixa automática. */
  FOR SELECT PP.NUMCONTA,PP.CODFILIALCA,PP.CODPLAN,PP.CODFILIALPN,PP.CODCC,PP.ANOCC,PP.CODFILIALCC,PC.NROPARCPAG
      FROM FNPARCPAG PC, FNPLANOPAG PP
      WHERE
        PP.CODEMP=NEW.CODEMP AND PP.CODFILIAL=:CODFILIALPP AND PP.CODPLANOPAG=NEW.CODPLANOPAG AND
        PC.CODEMP=PP.CODEMP AND PC.CODFILIAL=PP.CODFILIAL AND PC.CODPLANOPAG=PP.CODPLANOPAG AND
        PC.AUTOBAIXAPARC='S'
      INTO NUMCONTA,CODFILIALCA,CODPLAN,CODFILIALPN,CODCC,ANOCC,CODFILIALCC,NPARCREC
  DO
  BEGIN
    UPDATE FNITRECEBER SET
      NUMCONTA=:NUMCONTA,
      CODEMPCA=NEW.CODEMP,
      CODFILIALCA=:CODFILIALCA,
      CODPLAN=:CODPLAN,
      CODEMPPN=NEW.CODEMP,
      CODFILIALPN=:CODFILIALPN,
      ANOCC=:ANOCC,
      CODCC=:CODCC,
      CODEMPCC=NEW.CODEMP,
      CODFILIALCC=:CODFILIALCC,
      DOCLANCAITREC='AUTO',
      DTPAGOITREC=NEW.DATAREC,
      VLRPAGOITREC=VLRPARCITREC,
      VLRDESCITREC=0,
      VLRJUROSITREC=0,
      OBSITREC='BAIXA AUTOMÁTICA',
      STATUSITREC='RP'
      WHERE CODREC=NEW.CODREC AND CODEMP=NEW.CODEMP AND CODFILIAL=:CODFILIALIR AND NPARCITREC=:NPARCREC;
  END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "FNITRECEBERSP01"("ICODEMP" INTEGER,
"SCODFILIAL" SMALLINT,
"ICODREC" INTEGER,
"NVLRPARCREC" NUMERIC(15,5),
"NVLRCOMIREC" NUMERIC(15,5),
"INROPARCREC" INTEGER,
"CCLASCOMIS" CHAR(1) CHARACTER SET NONE)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNRECEBERTGAU" FOR "FNRECEBER"
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE INPARCOLD INTEGER;
  DECLARE VARIABLE INPARCNEW INTEGER;
  DECLARE VARIABLE CALTVLR CHAR(1);
BEGIN
  IF ( ((old.CODPLANOPAG<>new.CODPLANOPAG) OR
       (old.FLAG<>new.FLAG) OR
       (old.VLRREC<>new.VLRREC) OR
       (old.DATAREC<>new.DATAREC)) AND
       (new.ALTUSUREC != 'S') ) THEN
  BEGIN

    IF (old.CODPLANOPAG<>new.CODPLANOPAG) THEN
    BEGIN
       SELECT PP.PARCPLANOPAG FROM FNPLANOPAG PP WHERE CODEMP=old.CODEMPPG and
           PP.CODFILIAL=old.CODFILIALPG AND
           PP.CODPLANOPAG=old.CODPLANOPAG INTO :INPARCOLD;
       SELECT PP.PARCPLANOPAG FROM FNPLANOPAG PP WHERE CODEMP=new.CODEMPPG and
           PP.CODFILIAL=new.CODFILIALPG AND
           PP.CODPLANOPAG=new.CODPLANOPAG INTO :INPARCNEW;
       IF (INPARCNEW != INPARCOLD) THEN
           DELETE FROM FNITRECEBER WHERE CODREC=new.CODREC
           AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL;
    END
    IF (new.VLRREC!=old.VLRREC) THEN
       CALTVLR = 'S';
    ELSE
       CALTVLR = 'N';
    SELECT I FROM fngeraitrecebersp01(:CALTVLR,  new.CODEMP,
       new.CODFILIAL, new.CODREC, new.CODEMPPG, new.CODFILIALPG, new.CODPLANOPAG,
       new.VLRREC, new.DATAREC, new.FLAG, new.CODEMPBO, new.CODFILIALBO,
       new.CODBANCO, new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
       new.CODEMPCB, new.CODFILIALCB, new.CODCARTCOB,
       new.VLRCOMIREC, new.OBSREC)
       INTO new.NROPARCREC;
  END
/* Atualiza os itens para eles atualizarem a comissao de forma distribuida. */
  IF (old.VLRCOMIREC != new.VLRCOMIREC) THEN
    EXECUTE PROCEDURE FNITRECEBERSP01(new.CODEMP,new.CODFILIAL,new.CODREC,
       new.VLRPARCREC,new.VLRCOMIREC,new.NROPARCREC,'N');
/*  ELSE IF (old.ALTUSUREC = 'S' AND old.ALTUSUREC='N') THEN
    EXECUTE PROCEDURE FNITRECEBERSP01(new.CODEMP,new.CODFILIAL,new.CODREC,
       new.VLRPARCREC,new.VLRCOMIREC,new.NROPARCREC);*/
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNRECEBERTGBI" FOR "FNRECEBER"
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  IF (new.VLRREC IS NULL) THEN new.VLRREC = 0;
  IF (new.VLRDESCREC IS NULL) THEN new.VLRDESCREC = 0;
  IF (new.VLRJUROSREC IS NULL) THEN new.VLRJUROSREC = 0;
  IF (new.VLRMULTAREC IS NULL) THEN new.VLRMULTAREC = 0;
  IF (new.VLRPARCREC IS NULL) THEN new.VLRPARCREC = 0;
  IF (new.VLRAPAGREC IS NULL) THEN new.VLRAPAGREC = 0;
  IF (new.VLRPAGOREC IS NULL) THEN new.VLRPAGOREC = 0;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNRECEBERTGBU" FOR "FNRECEBER"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNSALDOLANCA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODEMPPN" INTEGER NOT NULL,
"CODFILIALPN" INTEGER NOT NULL,
"CODPLAN" CHAR(13) CHARACTER SET NONE NOT NULL,
"DATASL" DATE NOT NULL,
"PREVSL" "NUMERICDN",
"SALDOSL" "NUMERICDN" NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNSALDOLANCATGBI" FOR "FNSALDOLANCA"
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  if (new.SALDOSL is null) then
     new.SALDOSL = 0;
  if (new.PREVSL is null) then
     new.PREVSL = 0;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNSALDOLANCATGBU" FOR "FNSALDOLANCA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNSUBLANCATGAD" FOR "FNSUBLANCA"
ACTIVE AFTER DELETE POSITION 0 
AS
DECLARE VARIABLE dDataSl DATE;
DECLARE VARIABLE dSaldoSl NUMERIC(15, 5);
DECLARE VARIABLE sCodplan CHAR(13);
DECLARE VARIABLE dSaldoAnt NUMERIC(15, 5);
DECLARE VARIABLE IFILIALSALDO INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(old.CODEMPPN,'FNSALDOLANCA') INTO IFILIALSALDO;
   SELECT CODPLAN,DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=old.CODPLAN
          AND DATASL=old.DATASUBLANCA AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALSALDO
          INTO :sCodplan,:dDataSl,:dSaldoSl;
   IF (:sCodplan IS NULL ) THEN
   BEGIN
      SELECT SALDOSL FROM FNSALDOLANCA SL1 WHERE SL1.CODPLAN=old.CODPLAN
             AND SL1.DATASL=(
                            SELECT MAX(SL2.DATASL) FROM FNSALDOLANCA SL2 WHERE
                                   SL2.CODPLAN=SL1.CODPLAN AND SL2.DATASL<old.DATASUBLANCA
                                   AND SL2.CODEMP=old.CODEMP AND SL2.CODFILIAL=:IFILIALSALDO
                            )
             AND SL1.CODEMP=old.CODEMP AND SL1.CODFILIAL=:IFILIALSALDO INTO :dSaldoAnt;
      IF (:dSaldoAnt IS NULL) THEN
         dSaldoAnt = 0;
      INSERT INTO FNSALDOLANCA (CODEMP,CODFILIAL,CODEMPPN,CODFILIALPN,CODPLAN,DATASL,SALDOSL)
             VALUES (old.CODEMPPN,old.CODFILIALPN,old.CODEMPPN,old.CODFILIALPN,old.CODPLAN,old.DATASUBLANCA,:dSaldoAnt);
      UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL - old.VLRSUBLANCA
             WHERE CODPLAN=old.CODPLAN AND DATASL>old.DATASUBLANCA
             AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALSALDO;
   END
   ELSE
   BEGIN
      UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL - old.VLRSUBLANCA
             WHERE CODPLAN=old.CODPLAN AND DATASL>=old.DATASUBLANCA
             AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALSALDO;
   END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNSUBLANCATGAI" FOR "FNSUBLANCA"
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE dDataSl DATE;
DECLARE VARIABLE dSaldoSl NUMERIC(15, 5);
DECLARE VARIABLE sCodplan CHAR(13);
DECLARE VARIABLE dSaldoAnt NUMERIC(15, 5);
DECLARE VARIABLE IFILIALSALDO INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNSALDOLANCA') INTO IFILIALSALDO;
   SELECT CODPLAN,DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=new.CODPLAN
          AND DATASL=new.DATASUBLANCA AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALSALDO
          INTO :sCodplan,:dDataSl,:dSaldoSl;
   IF (:sCodplan IS NULL ) THEN
   BEGIN
      SELECT SALDOSL FROM FNSALDOLANCA SL1 WHERE SL1.CODPLAN=new.CODPLAN
             AND SL1.DATASL=(
                            SELECT MAX(SL2.DATASL) FROM FNSALDOLANCA SL2 WHERE
                                   SL2.CODPLAN=SL1.CODPLAN AND SL2.DATASL<new.DATASUBLANCA
                                   AND SL2.CODEMP=new.CODEMP AND SL2.CODFILIAL=:IFILIALSALDO
                            )
              AND SL1.CODEMP=new.CODEMP AND SL1.CODFILIAL = :IFILIALSALDO INTO :dSaldoAnt;
      IF (:dSaldoAnt IS NULL) THEN
         dSaldoAnt = 0;
      INSERT INTO FNSALDOLANCA (CODEMP,CODFILIAL,CODPLAN,CODEMPPN,CODFILIALPN,DATASL,SALDOSL)
             VALUES (new.CODEMPPN,:IFILIALSALDO,new.CODPLAN,new.CODEMPPN,new.CODFILIALPN,new.DATASUBLANCA,:dSaldoAnt+new.VLRSUBLANCA);
      UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL + new.VLRSUBLANCA
             WHERE CODPLAN=new.CODPLAN AND DATASL>new.DATASUBLANCA
             AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALSALDO;
   END
   ELSE
   BEGIN
      UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL + new.VLRSUBLANCA
             WHERE CODPLAN=new.CODPLAN AND DATASL>=new.DATASUBLANCA
             AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALSALDO;
   END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNSUBLANCATGAU" FOR "FNSUBLANCA"
ACTIVE AFTER UPDATE POSITION 0 
AS
DECLARE VARIABLE dDataSl DATE;
DECLARE VARIABLE dSaldoSl NUMERIC(15, 5);
DECLARE VARIABLE sCodplan CHAR(13);
DECLARE VARIABLE dSaldoAnt NUMERIC(15, 5);
DECLARE VARIABLE IFILIALSALDO INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNSALDOLANCA') INTO IFILIALSALDO;
   IF ( (old.DATASUBLANCA <> new.DATASUBLANCA) OR (old.VLRSUBLANCA<>new.VLRSUBLANCA) ) THEN
   BEGIN
/*Verifica se já existe saldo no dia da nova data:*/
     SELECT CODPLAN,DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=new.CODPLAN
            AND DATASL=new.DATASUBLANCA AND CODEMP=new.CODEMPPN AND CODFILIAL=:IFILIALSALDO
            INTO :sCodplan,:dDataSl,:dSaldoSl;
/*Se não existir, cria um saldo para o nova data:*/
     IF (sCodplan IS NULL ) THEN
     BEGIN
/*Pega o ultimo saldo anterior a data do lançamento:*/
        SELECT SALDOSL FROM FNSALDOLANCA SL1 WHERE SL1.CODPLAN=new.CODPLAN
               AND SL1.DATASL=(
                              SELECT MAX(SL2.DATASL) FROM FNSALDOLANCA SL2 WHERE
                                     SL2.CODPLAN=SL1.CODPLAN AND SL2.DATASL<new.DATASUBLANCA
                                     AND SL2.CODEMP=new.CODEMPPN AND SL2.CODFILIAL=:IFILIALSALDO
                              )
               AND SL1.CODEMP=new.CODEMPPN AND SL1.CODFILIAL=:IFILIALSALDO INTO :dSaldoAnt;
/*Cria um saldo para este dia e atualiza saldos possíveis que tiverem na frente:*/
        IF (:dSaldoAnt IS NULL) THEN
           dSaldoAnt = 0;
        INSERT INTO FNSALDOLANCA (CODEMP,CODFILIAL,CODPLAN,CODEMPPN,CODFILIALPN,DATASL,SALDOSL)
               VALUES (new.CODEMP,:IFILIALSALDO,new.CODPLAN,new.CODEMPPN,new.CODFILIALPN,new.DATASUBLANCA,:dSaldoAnt + new.VLRSUBLANCA);
        UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL + new.VLRSUBLANCA
               WHERE CODPLAN=new.CODPLAN AND DATASL>new.DATASUBLANCA
               AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALSALDO;
     END
/*Caso contrário só atualiza o saldo:*/
     ELSE
     BEGIN
        UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL + new.VLRSUBLANCA
               WHERE CODPLAN=new.CODPLAN AND DATASL>=new.DATASUBLANCA
               AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALSALDO;
     END
   END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNSUBLANCATGBD" FOR "FNSUBLANCA"
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  IF (old.CODSUBLANCA > 0) THEN
    UPDATE FNLANCA SET VLRLANCA = VLRLANCA - (old.VLRSUBLANCA*-1) WHERE
      CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL AND
      CODLANCA=old.CODLANCA;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNSUBLANCATGBI" FOR "FNSUBLANCA"
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE sEhTransf CHAR(1);
  DECLARE VARIABLE sTipoPlan CHAR(1);
  DECLARE VARIABLE dDataLanca DATE;
  DECLARE VARIABLE dDtPrevLanca DATE;
  DECLARE VARIABLE sHistSubLanc CHAR(50);
BEGIN
  /*IF ( new.VLRSUBLANCA = 0 ) THEN
     EXCEPTION FNSUBLANCAEX04;         */
  SELECT HISTBLANCA FROM FNLANCA WHERE CODLANCA = new.CODLANCA
     AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO sHistSubLanc;
  IF (new.HISTSUBLANCA IS NULL) THEN
      new.HISTSUBLANCA = sHistSubLanc;
  IF (new.CODSUBLANCA IS NULL) THEN
    SELECT MAX(CODSUBLANCA) FROM FNSUBLANCA WHERE CODLANCA = new.CODLANCA
           AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.CODSUBLANCA;
  new.STATUSSUBLANCA = 'S1';
  SELECT TRANSFLANCA,DATALANCA,DTPREVLANCA FROM FNLANCA WHERE CODLANCA = new.CODLANCA
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO sEhTransf,dDataLanca,dDtPrevLanca;
  SELECT TIPOPLAN FROM FNPLANEJAMENTO WHERE CODPLAN = new.CODPLAN
         AND CODEMP=new.CODEMPPN AND CODFILIAL = new.CODFILIALPN INTO sTipoPlan;
  new.DATASUBLANCA = dDataLanca;
  IF (new.CODSUBLANCA > 0) THEN
  BEGIN
    new.ORIGSUBLANCA = 'N';
  END
  new.STATUSSUBLANCA = 'S1';
  new.DTPREVSUBLANCA = dDtPrevLanca;
  IF (sEhTransf = 'S') THEN
  BEGIN
   IF (new.CODSUBLANCA = 2) THEN
     EXCEPTION FNSUBLANCAEX01;
   ELSE IF (sTipoPlan IN ('D','R')) THEN
     EXCEPTION FNSUBLANCAEX02;
  END
  ELSE
    IF ((new.CODSUBLANCA != 0) AND (sTipoPlan IN ('C','B'))) THEN
      EXCEPTION FNSUBLANCAEX03;
  UPDATE FNLANCA SET STATUSLANCA = 'L2', VLRLANCA=(VLRLANCA-new.VLRSUBLANCA)
         WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNSUBLANCATGBU" FOR "FNSUBLANCA"
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE sEhTransf CHAR(1);
  DECLARE VARIABLE sTipoPlan CHAR(1);
  DECLARE VARIABLE IFILIALSALDO INTEGER;
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /*IF ( new.VLRSUBLANCA = 0 ) THEN
     EXCEPTION FNSUBLANCAEX04;   */
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNSALDOLANCA') INTO IFILIALSALDO;
  SELECT TIPOPLAN FROM FNPLANEJAMENTO WHERE CODPLAN = new.CODPLAN
         AND CODEMP=new.CODEMPPN AND CODFILIAL = new.CODFILIALPN INTO sTipoPlan;
  SELECT TRANSFLANCA FROM FNLANCA WHERE CODLANCA = new.CODLANCA
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO sEhTransf;
  IF (sEhTransf = 'S') THEN
  BEGIN
      IF (new.CODSUBLANCA = 2) THEN
     EXCEPTION FNSUBLANCAEX01;
   ELSE IF (sTipoPlan IN ('D','R')) THEN
     EXCEPTION FNSUBLANCAEX02;
  END
  ELSE
    IF ((new.CODSUBLANCA != 0) AND (sTipoPlan IN ('C','B'))) THEN
      EXCEPTION FNSUBLANCAEX03;
  IF ((new.CODSUBLANCA != 0) AND (old.VLRSUBLANCA <> new.VLRSUBLANCA)) THEN
    UPDATE FNLANCA SET VLRLANCA = ((VLRLANCA+old.VLRSUBLANCA)-new.VLRSUBLANCA)
           WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
  IF ( (old.DATASUBLANCA <> new.DATASUBLANCA) OR (old.VLRSUBLANCA<>new.VLRSUBLANCA) ) THEN
    UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL - old.VLRSUBLANCA
           WHERE CODPLAN=old.CODPLAN AND DATASL>=old.DATASUBLANCA
           AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALSALDO;
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNTBJUROS"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTBJ" INTEGER NOT NULL,
"DESCTBJ" CHAR(50) CHARACTER SET NONE NOT NULL,
"TIPOTBJ" CHAR(1) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNTBJUROSTGBU" FOR "FNTBJUROS"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNTIPOCOB"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTIPOCOB" INTEGER NOT NULL,
"DESCTIPOCOB" CHAR(40) CHARACTER SET NONE NOT NULL,
"TIPOFEBRABAN" CHAR(2) CHARACTER SET NONE DEFAULT '00' NOT NULL,
"DUPLCOB" CHAR(8) CHARACTER SET NONE,
"OBRIGCARTCOB" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNTIPOCOBTGBU" FOR "FNTIPOCOB"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "FNTIPOCRED"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTPCRED" INTEGER NOT NULL,
"DESCTPCRED" CHAR(50) CHARACTER SET NONE NOT NULL,
"VLRTPCRED" "NUMERICDN" NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "FNTIPOCREDTGBU" FOR "FNTIPOCRED"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFCLFISCALTGBU" FOR "LFCLFISCAL"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFITCLFISCAL"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"CODFISC" CHAR(13) CHARACTER SET NONE NOT NULL,
"CODITFISC" INTEGER NOT NULL,
"ORIGFISC" CHAR(1) CHARACTER SET NONE NOT NULL,
"CODEMPTT" INTEGER NOT NULL,
"CODFILIALTT" INTEGER NOT NULL,
"TIPOFISC" CHAR(2) CHARACTER SET NONE NOT NULL,
"TPREDICMSFISC" CHAR(1) CHARACTER SET NONE DEFAULT 'B' NOT NULL,
"REDFISC" NUMERIC(9,2),
"CODTRATTRIB" CHAR(2) CHARACTER SET NONE NOT NULL,
"NOUFITFISC" CHAR(1) CHARACTER SET WIN1252 DEFAULT 'N' NOT NULL,
"CODEMPFC" INTEGER,
"CODFILIALFC" INTEGER,
"CODFISCCLI" INTEGER,
"ALIQFISC" NUMERIC(9,2),
"ALIQLFISC" NUMERIC(9,2),
"ALIQIPIFISC" NUMERIC(6,2) DEFAULT 0 NOT NULL,
"CODEMPME" INTEGER,
"CODFILIALME" SMALLINT,
"CODMENS" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFITCLFISCALTGBU" FOR "LFITCLFISCAL"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFITNATOPER"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"CODNAT" CHAR(4) CHARACTER SET NONE NOT NULL,
"CODITNATOPER" INTEGER NOT NULL,
"CODEMPTI" INTEGER NOT NULL,
"CODFILIALTI" INTEGER NOT NULL,
"UFTI" CHAR(2) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFITNATOPERTGBU" FOR "LFITNATOPER"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFITREGRAFISCAL"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODREGRA" CHAR(4) CHARACTER SET NONE NOT NULL,
"CODNAT" CHAR(4) CHARACTER SET NONE NOT NULL,
"NOUFITRF" CHAR(1) CHARACTER SET NONE NOT NULL,
"CVITRF" CHAR(1) CHARACTER SET NONE NOT NULL,
"CODEMPTM" INTEGER,
"CODFILIALTM" SMALLINT,
"CODTIPOMOV" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFITREGRAFISCALTGBU" FOR "LFITREGRAFISCAL"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFLIVROFISCAL"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"TIPOLF" CHAR(1) CHARACTER SET NONE NOT NULL,
"ANOMESLF" CHAR(6) CHARACTER SET NONE NOT NULL,
"CODLF" INTEGER NOT NULL,
"CODEMPET" INTEGER NOT NULL,
"CODFILIALET" SMALLINT NOT NULL,
"CODEMITLF" INTEGER NOT NULL,
"SERIELF" CHAR(4) CHARACTER SET NONE NOT NULL,
"DOCINILF" INTEGER NOT NULL,
"DTEMITLF" DATE NOT NULL,
"DTESLF" DATE NOT NULL,
"CODEMPNT" INTEGER,
"CODFILIALNT" SMALLINT,
"CODNAT" CHAR(4) CHARACTER SET NONE,
"DOCFIMLF" INTEGER NOT NULL,
"ESPECIELF" CHAR(3) CHARACTER SET NONE NOT NULL,
"UFLF" CHAR(2) CHARACTER SET NONE NOT NULL,
"VLRCONTABILLF" "NUMERICDN" DEFAULT 0,
"VLRBASEICMSLF" "NUMERICDN" DEFAULT 0,
"ALIQICMSLF" NUMERIC(7,3) DEFAULT 0,
"VLRICMSLF" "NUMERICDN" DEFAULT 0,
"VLRISENTASICMSLF" "NUMERICDN" DEFAULT 0,
"VLROUTRASICMSLF" "NUMERICDN" DEFAULT 0,
"VLRBASEIPILF" "NUMERICDN" DEFAULT 0,
"ALIQIPILF" NUMERIC(7,3) DEFAULT 0,
"VLRIPILF" "NUMERICDN" DEFAULT 0,
"VLRISENTASIPILF" "NUMERICDN" DEFAULT 0,
"VLROUTRASIPILF" "NUMERICDN" DEFAULT 0,
"OBSLF" CHAR(30) CHARACTER SET NONE,
"CODEMPMN" INTEGER,
"CODFILIALMN" SMALLINT,
"CODMODNOTA" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFLIVROFISCALTGBU" FOR "LFLIVROFISCAL"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFMENSAGEM"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODMENS" INTEGER NOT NULL,
"MENS" VARCHAR(10000) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFMENSAGEMTGBU" FOR "LFMENSAGEM"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFMODNOTA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODMODNOTA" INTEGER NOT NULL,
"DESCMODNOTA" CHAR(30) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFMODNOTATGBU" FOR "LFMODNOTA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFNATOPER"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODNAT" CHAR(4) CHARACTER SET NONE NOT NULL,
"DESCNAT" CHAR(60) CHARACTER SET NONE NOT NULL,
"IMPDTSAIDANAT" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"ALIQENAT" NUMERIC(6,2) DEFAULT 0 NOT NULL,
"ALIQFNAT" NUMERIC(6,2) DEFAULT 0 NOT NULL,
"TXTNAT" VARCHAR(500) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFNATOPERTGBU" FOR "LFNATOPER"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFREGRAFISCAL"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODREGRA" CHAR(4) CHARACTER SET NONE NOT NULL,
"DESCREGRA" CHAR(50) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFREGRAFISCALTGBU" FOR "LFREGRAFISCAL"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFSERIE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"SERIE" CHAR(4) CHARACTER SET NONE NOT NULL,
"DOCSERIE" INTEGER DEFAULT 1 NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFSERIETGBI" FOR "LFSERIE"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
   if (new.DOCSERIE IS NULL) then
      new.DOCSERIE = 1;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFSERIETGBU" FOR "LFSERIE"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFTABICMS"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"UFTI" CHAR(2) CHARACTER SET NONE NOT NULL,
"ALIQTI" NUMERIC(9,2) NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFTABICMSTGBU" FOR "LFTABICMS"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFTIPOFISCCLI"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"CODFISCCLI" INTEGER NOT NULL,
"DESCFISCCLI" CHAR(40) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFTIPOFISCCLITGBU" FOR "LFTIPOFISCCLI"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "LFTRATTRIB"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTRATTRIB" CHAR(2) CHARACTER SET NONE NOT NULL,
"DESCTRATTRIB" CHAR(60) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "LFTRATTRIBTGBU" FOR "LFTRATTRIB"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PPESTRUTURA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"SEQEST" SMALLINT DEFAULT 0 NOT NULL,
"DESCEST" CHAR(50) CHARACTER SET NONE NOT NULL,
"QTDEST" "NUMERICDN" NOT NULL,
"REFPROD" CHAR(13) CHARACTER SET NONE NOT NULL,
"ATIVOEST" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"CODEMPML" INTEGER,
"CODFILIALML" SMALLINT,
"CODMODLOTE" INTEGER,
"NRODIASVALID" SMALLINT,
"GLOTEOPP" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL);
COMMIT WORK;
CREATE TABLE "PPESTRUFASE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"SEQEST" SMALLINT DEFAULT 0 NOT NULL,
"SEQEF" SMALLINT NOT NULL,
"CODEMPFS" INTEGER NOT NULL,
"CODFILIALFS" SMALLINT NOT NULL,
"CODFASE" INTEGER NOT NULL,
"CODEMPTR" INTEGER NOT NULL,
"CODFILIALTR" SMALLINT NOT NULL,
"CODTPREC" INTEGER NOT NULL,
"TEMPOEF" "NUMERICDN" DEFAULT 0 NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"FINALIZAOP" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"INSTRUCOES" VARCHAR(5000) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPESTRUFASETGAD" FOR "PPESTRUFASE"
ACTIVE AFTER DELETE POSITION 0 
AS
declare variable iSeqEf smallint;
begin
  IF(old.finalizaop = 'S') then
  begin
    for select max(seqef) from ppestrufase ef where ef.codemp=old.codemp and
        ef.codfilial=old.codfilial and ef.codprod = old.codprod and
        ef.seqest = old.seqest into :iSeqEf do
        begin
            update ppestrutura et set et.ativoest='N' where et.codemp=old.codemp and
                et.codfilial = old.codfilial and et.codprod=old.codprod and
                et.seqest = old.seqest;
        end
  end
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPESTRUFASETGBIBU" FOR "PPESTRUFASE"
ACTIVE  POSITION 1 
AS
declare variable iFinaliza smallint;
begin
  if (NEW.finalizaop='S') then
  BEGIN
    SELECT COUNT(1) FROM PPESTRUFASE EF
        WHERE EF.CODEMP=NEW.CODEMP AND EF.CODFILIAL=NEW.CODFILIAL AND
              EF.CODPROD = NEW.codprod AND
              EF.SEQEST = NEW.SEQEST AND EF.FINALIZAOP='S' into :iFinaliza;
        if(:iFinaliza>0) then
        begin
           exception ppestrufase01;
        end
  END
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPESTRUFASETGBU" FOR "PPESTRUFASE"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPESTRUTURATGBIBU" FOR "PPESTRUTURA"
ACTIVE  POSITION 0 
AS
declare variable iFinaliza smallint;
begin
  if (new.REFPROD IS NULL) then
    SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
  IF(NEW.ativoest='S' AND NEW.ativoest!=OLD.ativoest) THEN
  BEGIN
    select count(1) from ppestrufase ef
        where ef.codemp=new.codemp and ef.codfilial=new.codfilial and
        ef.codprod=new.codprod and ef.seqest=new.seqest and ef.finalizaop='S'
        into :iFinaliza;
    if ((:iFinaliza is null) or (:iFinaliza<1) ) then
    begin
      exception ppestruturaex01;
    end
  END
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPESTRUTURATGBU" FOR "PPESTRUTURA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PPFASE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODFASE" INTEGER NOT NULL,
"DESCFASE" CHAR(50) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"TIPOFASE" CHAR(2) CHARACTER SET NONE NOT NULL,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPFASETGBU" FOR "PPFASE"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PPITESTRUTURA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"SEQEST" SMALLINT DEFAULT 0 NOT NULL,
"SEQITEST" SMALLINT NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPRODPD" INTEGER NOT NULL,
"CODEMPFS" INTEGER NOT NULL,
"CODFILIALFS" SMALLINT NOT NULL,
"CODFASE" INTEGER NOT NULL,
"SEQEF" SMALLINT NOT NULL,
"QTDITEST" "NUMERICDN" NOT NULL,
"RMAAUTOITEST" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"REFPROD" CHAR(13) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"REFPRODPD" CHAR(13) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPITESTRUTURATGBI" FOR "PPITESTRUTURA"
ACTIVE BEFORE INSERT POSITION 0 
as
begin
  new.DTINS=cast('now' AS DATE);
  new.idusuins=USER;
  new.hins = cast('now' AS TIME);
  if (new.REFPROD IS NULL) then
    SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPITESTRUTURATGBU" FOR "PPITESTRUTURA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.REFPROD IS NULL) then
    SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.REFPROD;
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PPITOP"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODOP" INTEGER NOT NULL,
"SEQOP" SMALLINT DEFAULT 0 NOT NULL,
"SEQITOP" SMALLINT NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"QTDITOP" "NUMERICDN" DEFAULT 0 NOT NULL,
"CODEMPFS" INTEGER NOT NULL,
"CODFILIALFS" SMALLINT NOT NULL,
"CODFASE" INTEGER NOT NULL,
"CODEMPLE" INTEGER,
"CODFILIALLE" SMALLINT,
"CODLOTE" CHAR(13) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"REFPROD" CHAR(13) CHARACTER SET NONE NOT NULL,
"GERARMA" CHAR(1) CHARACTER SET NONE NOT NULL,
"QTDCOPIAITOP" "NUMERICDN",
"CODLOTERAT" CHAR(13) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPITOPTGAU" FOR "PPITOP"
ACTIVE AFTER UPDATE POSITION 0 
AS
begin
  if(new.qtdcopiaitop is not null) then
  begin
    if( (new.qtdcopiaitop>0) and (old.qtdcopiaitop is null) ) then
    begin
        insert into ppitop (codemp,codfilial,codop,seqop,seqitop,
                               codemppd, codfilialpd,codprod,refprod,
                               qtditop, codempfs,codfilialfs, codfase,
                               codemple,codfilialle,codlote,
                               gerarma) values
                              (new.codemp,new.codfilial,new.codop,new.seqop,
                              (select (max(op.seqitop)+1) from ppitop op where op.codemp=codemp and
                                  op.codfilial=codfilial and op.codop=codop),
                               new.codemppd,new.codfilialpd,new.codprod,new.refprod,
                              new.qtdcopiaitop,new.codempfs,new.codfilialfs,new.codfase,
                              new.codemple, new.codfilialle,new.codloterat,
                              new.gerarma
                              );
    end
  end
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPITOPTGBI" FOR "PPITOP"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
   SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD AND
    CODFILIAL=new.CODFILIALPD AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PPOP"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODOP" INTEGER NOT NULL,
"SEQOP" SMALLINT DEFAULT 0 NOT NULL,
"DTEMITOP" DATE DEFAULT 'now' NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"SEQEST" SMALLINT DEFAULT 0 NOT NULL,
"REFPROD" CHAR(13) CHARACTER SET NONE NOT NULL,
"DTFABROP" DATE NOT NULL,
"QTDPREVPRODOP" "NUMERICDN" NOT NULL,
"QTDFINALPRODOP" "NUMERICDN" DEFAULT 0 NOT NULL,
"DTVALIDPDOP" DATE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"SITOP" CHAR(2) CHARACTER SET NONE DEFAULT 'II' NOT NULL,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"CODEMPLE" INTEGER,
"CODFILIALLE" SMALLINT,
"CODLOTE" CHAR(13) CHARACTER SET NONE,
"CODEMPTM" INTEGER NOT NULL,
"CODFILIALTM" SMALLINT NOT NULL,
"CODTIPOMOV" INTEGER NOT NULL,
"CODEMPAX" INTEGER NOT NULL,
"CODFILIALAX" SMALLINT NOT NULL,
"CODALMOX" INTEGER NOT NULL,
"JUSTFICQTDPROD" VARCHAR(500) CHARACTER SET NONE,
"CODEMPOPM" INTEGER,
"CODFILIALOPM" SMALLINT,
"CODOPM" INTEGER,
"SEQOPM" SMALLINT,
"QTDDISTPOP" "NUMERICDN" DEFAULT 0 NOT NULL,
"QTDDISTIOP" "NUMERICDN" DEFAULT 0 NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPITOPTGBI02" FOR "PPITOP"
ACTIVE BEFORE INSERT POSITION 0 
AS
   declare variable csaldo char(1);
begin
   if (new.SEQOP=0) then
     csaldo = 'S';
   else
   begin
     FOR SELECT OP.CODEMPLE, OP.CODFILIALLE, OP.CODLOTE
        FROM PPOP OP, PPOP OD
        WHERE OD.CODEMP=new.CODEMP AND OD.CODFILIAL=new.CODFILIAL AND
          OD.CODOP=new.CODOP AND OD.SEQOP=new.SEQOP AND
          OP.CODEMP=OD.CODEMPOPM AND OP.CODFILIAL=OD.CODFILIALOPM AND
          OP.CODOP=OD.CODOPM AND OP.SEQOP=OD.SEQOPM AND
          OP.CODEMPPD=new.CODEMPPD AND OP.CODFILIALPD=new.CODFILIALPD AND
          OP.CODPROD=new.CODPROD
        INTO new.CODEMPLE, new.CODFILIALLE, new.CODLOTE DO
        BEGIN
          csaldo='N';
        END
   end
   if (((csaldo='S') or (csaldo is null)) and (new.codlote is null)) then
     SELECT FIRST 1 L.CODEMP, L.CODFILIAL, L.CODLOTE
        FROM EQLOTE L
        WHERE L.CODPROD=NEW.codprod AND L.CODFILIAL=NEW.codfilialpd AND L.SLDLIQLOTE>0
        AND L.CODEMP=NEW.codemppd  AND L.VENCTOLOTE>=cast('today' as date)
        ORDER BY L.VENCTOLOTE, L.CODLOTE
        INTO new.codemple, new.codfilialle, new.codlote;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPITOPTGBU" FOR "PPITOP"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMPPD AND
    CODFILIAL=new.CODFILIALPD AND CODPROD=new.CODPROD INTO new.REFPROD;
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PPOPFASE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODOP" INTEGER NOT NULL,
"SEQOP" SMALLINT DEFAULT 0 NOT NULL,
"SEQOF" SMALLINT NOT NULL,
"CODEMPFS" INTEGER NOT NULL,
"CODFILIALFS" SMALLINT NOT NULL,
"CODFASE" INTEGER NOT NULL,
"CODEMPRP" INTEGER NOT NULL,
"CODFILIALRP" SMALLINT NOT NULL,
"CODRECP" INTEGER NOT NULL,
"TEMPOOF" "NUMERICDN" DEFAULT 0 NOT NULL,
"CODEMPTR" INTEGER NOT NULL,
"CODFILIALTR" SMALLINT NOT NULL,
"CODTPREC" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"DATAINIPRODFS" DATE,
"HINIPRODFS" TIME,
"DATAFIMPRODFS" DATE,
"HFIMPRODFS" TIME,
"OBSFS" VARCHAR(500) CHARACTER SET NONE,
"SITFS" CHAR(2) CHARACTER SET NONE DEFAULT 'PE');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPOPFASETGBU0" FOR "PPOPFASE"
ACTIVE BEFORE UPDATE POSITION 0 
as
declare variable finaliza char(2);
declare variable qtdpe smallint;
declare variable icodemptm int;
declare variable icodfilialtm smallint;
declare variable icodtipomov integer;
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if ((new.sitfs!='FN') and (new.datafimprodfs is not null)) then
  BEGIN
    new.sitfs = 'FN';

    select ef.finalizaop from ppestrufase ef, ppopfase pf, ppop op where
                    ef.codemp = op.codemppd and ef.codfilial = op.codfilialpd and
                    ef.codprod = op.codprod and ef.seqest = op.seqest and
                    ef.codempfs = pf.codempfs and ef.codfilialfs = pf.codfilialfs and
                    ef.codfase = pf.codfase and pf.codemp = op.codemp and
                    pf.codfilial = op.codfilial and pf.codop = op.codop and
                    pf.seqop = op.seqop and
                    pf.seqof = new.seqof and op.codemp=new.codemp and
                    op.codfilial=new.codfilial and op.codop=new.codop and
                    op.seqop=new.seqop and ef.seqef = pf.seqof
                    into :finaliza;

    if (:finaliza='S') then
    begin
        select count(1) from ppopfase pf where pf.codemp = new.codemp and
            pf.codfilial=new.codfilial
            and pf.codop=new.codop and pf.seqop=new.seqop and pf.sitfs<>'FN' into :qtdpe;
        if(:qtdpe>1) then
        begin
          exception ppopfase 'O processo não poderá ser concluído, pois existem fases pendentes!';
        end
    end

  END

end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "PPATUDISTOPSP"("ICODEMP" INTEGER,
"SCODFILIAL" SMALLINT,
"ICODOP" INTEGER,
"SSEQOP" SMALLINT,
"NQTDDISTOLD" NUMERIC(15,5),
"NQTDDISTNEW" NUMERIC(15,5))
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPOPTGAD" FOR "PPOP"
ACTIVE AFTER DELETE POSITION 0 
AS
declare variable preco decimal;
begin
  select sum(pd.custompmprod) from ppitop it, eqproduto pd where it.codemp=old.codemp and it.codfilial=it.codfilial and
    it.codop=old.codop and it.seqop=old.seqop and
    pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and pd.codprod=it.codprod into :preco;

   EXECUTE PROCEDURE EQMOVPRODIUDSP('D',old.CODEMPPD, old.CODFILIALPD, old.CODPROD,
        old.CODEMPLE, old.CODFILIALLE, old.codlote, old.codemptm,
        old.codfilialtm, old.codtipomov, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, null, null, null, null, old.codemp, old.codfilial, old.codop, old.seqop,
        null, null, null,
        old.dtfabrop, old.codop, 'N', old.qtdfinalprodop,:preco,
        old.codempax, old.codfilialax, old.codalmox );

   if (old.CODOPM is not null) then
      EXECUTE PROCEDURE PPATUDISTOPSP(old.CODEMPOPM, old.CODFILIALOPM, old.CODOPM,
        old.SEQOPM, old.QTDDISTIOP, 0);

end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "PPITOPSP01"("ICODEMP" INTEGER,
"ICODFILIAL" SMALLINT,
"ICODOP" INTEGER,
"ISEQOP" SMALLINT)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPOPTGAI" FOR "PPOP"
ACTIVE AFTER INSERT POSITION 0 
as
declare variable preco numeric;
declare variable qtdest numeric;
begin
   EXECUTE PROCEDURE PPITOPSP01(new.CODEMP, new.CODFILIAL, new.CODOP, new.SEQOP);

   select sum(pd.custompmprod) from ppitop it, eqproduto pd where it.codemp=new.codemp and
   it.codfilial=it.codfilial and it.codop=new.codop and it.seqop=new.seqop and
   pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and
   pd.codprod=it.codprod into :preco;

   select pe.qtdest from ppestrutura pe
      where pe.codemp=new.codemppd and pe.codfilial=new.codfilialpd and
      pe.codprod=new.codprod and pe.seqest=new.seqest into :qtdest;

   EXECUTE PROCEDURE EQMOVPRODIUDSP('I',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
        new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
        new.codfilialtm, new.codtipomov, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, null, null, null, null,new.codemp, new.codfilial,new.codop, new.seqop,
        null, null,  null, new.dtfabrop, new.codop,
        'N',new.qtdfinalprodop,cast(:preco as numeric(15,5)),
        NEW.codempax, NEW.codfilialax, NEW.codalmox );
   if (new.CODOPM is not null) then
      EXECUTE PROCEDURE PPATUDISTOPSP(new.CODEMPOPM, new.CODFILIALOPM, new.CODOPM,
        new.SEQOPM, 0, new.QTDDISTIOP);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPOPTGAU" FOR "PPOP"
ACTIVE AFTER UPDATE POSITION 0 
as
declare variable preco decimal;
declare variable qtdest decimal;
begin
   if (old.qtdprevprodop <> new.qtdprevprodop ) then
   begin
     DELETE FROM PPITOP WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND
       CODOP=new.CODOP and SEQOP=new.SEQOP;
     DELETE FROM PPOPFASE WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND
       CODOP=new.CODOP AND SEQOP=new.SEQOP;
     EXECUTE PROCEDURE PPITOPSP01(new.CODEMP, new.CODFILIAL, new.CODOP, new.SEQOP);
   end

   select sum(pd.custompmprod) from ppitop it, eqproduto pd where it.codemp=new.codemp and it.codfilial=it.codfilial
        and it.codop=new.codop and it.seqop=new.seqop and
        pd.codemp=it.codemppd and pd.codfilial=it.codfilialpd and
        pd.codprod=it.codprod into :preco;

   select pe.qtdest from ppestrutura pe
      where pe.codemp=new.codemppd and pe.codfilial=new.codfilialpd and
      pe.codprod=new.codprod and pe.seqest=new.seqest into :qtdest;

   if(new.qtdfinalprodop>0) then
       EXECUTE PROCEDURE EQMOVPRODIUDSP('U',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
        new.CODEMPLE, new.CODFILIALLE, new.codlote, new.codemptm,
        new.codfilialtm, new.codtipomov, null, null, null ,null, null,
        null, null, null, null, null, null,
        null, null, null, null, null,new.codemp, new.codfilial,new.codop,new.seqop,
        null, null, null, new.dtfabrop, new.codop, 'N', new.qtdfinalprodop,:preco,
        NEW.codempax, NEW.codfilialax, NEW.codalmox );

   if (new.CODOPM is not null) then
      EXECUTE PROCEDURE PPATUDISTOPSP(new.CODEMPOPM, new.CODFILIALOPM, new.CODOPM,
        new.SEQOPM, old.QTDDISTIOP, new.QTDDISTIOP);

end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPOPTGBI" FOR "PPOP"
ACTIVE BEFORE INSERT POSITION 0 
as
begin
   SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP AND
    CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD INTO new.REFPROD;
   new.SITOP = 'GO';
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPOPTGBU" FOR "PPOP"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);
    SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP AND
    CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD INTO new.REFPROD;

    if(new.qtdfinalprodop>0 and new.qtdfinalprodop<>old.qtdfinalprodop) then
          select coalesce(tm.codemptm,tm.codemp),coalesce(tm.codfilialtm,tm.codfilial),coalesce(tm.codtipomovtm,tm.codtipomov)
           from eqtipomov tm, ppop op
            where tm.codemp=op.codemptm and tm.codfilial=op.codfilialtm and tm.codtipomov=op.codtipomov
             and op.codemp=new.codemp and op.codfilial=new.codfilial and op.codop=new.codop and
             op.seqop=new.seqop
           into new.codemptm,new.codfilialtm,new.codtipomov;
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PPRECURSO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODRECP" INTEGER NOT NULL,
"DESCRECP" CHAR(50) CHARACTER SET NONE NOT NULL,
"CODEMPTR" INTEGER NOT NULL,
"CODFILIALTR" SMALLINT NOT NULL,
"CODTPREC" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPRECURSOTGBU" FOR "PPRECURSO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PPTIPOREC"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTPREC" INTEGER NOT NULL,
"DESCTPREC" CHAR(50) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PPTIPORECTGBU" FOR "PPTIPOREC"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PVCAIXAIMP"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCAIXA" INTEGER NOT NULL,
"CODIMP" INTEGER NOT NULL,
"IMPPAD" CHAR(1) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PVCAIXAIMPTGBU" FOR "PVCAIXAIMP"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "PVVALIDFAIXACAIXASP"("ICODEMP" INTEGER,
"ICODFILIAL" SMALLINT,
"ICODCAIXA" INTEGER,
"NEWSEQINI" INTEGER,
"NEWSEQMAX" INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PVCAIXA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCAIXA" INTEGER NOT NULL,
"DESCCAIXA" CHAR(40) CHARACTER SET NONE NOT NULL,
"ECFCAIXA" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"MODODEMO" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"TEFCAIXA" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CODEMPET" INTEGER NOT NULL,
"CODFILIALET" SMALLINT NOT NULL,
"CODEST" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"SEQINI" INTEGER,
"SEQMAX" INTEGER);
COMMIT WORK;
CREATE TABLE "PVSEQUENCIA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCAIXA" INTEGER NOT NULL,
"SEQCAIXA" INTEGER DEFAULT 1 NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PVCAIXATGBU" FOR "PVCAIXA"
ACTIVE BEFORE UPDATE POSITION 0 
as
  DECLARE VARIABLE ICOUNTSEQ INTEGER;
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT=cast('now' AS TIME);
  
  IF ((old.SEQINI<>new.SEQINI) or (old.SEQMAX<>new.SEQMAX) ) THEN
  BEGIN
     SELECT COUNT(SEQCAIXA) FROM PVSEQUENCIA
        WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL
        AND CODCAIXA=new.CODCAIXA
        INTO :ICOUNTSEQ;
     IF (:ICOUNTSEQ > 0) THEN
        EXCEPTION PVSEQCAIXA01 'JÁ EXISTEM VENDAS DENTRO DESTA FAIXA DE VENDA';
  END

  EXECUTE PROCEDURE PVVALIDFAIXACAIXASP(new.CODEMP, new.CODFILIAL, new.CODCAIXA, new.SEQINI, new.SEQMAX);

end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PVLEITURAX"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCAIXA" INTEGER NOT NULL,
"DTLX" DATE NOT NULL,
"TT01" "NUMERICDN",
"TT02" "NUMERICDN",
"TT03" "NUMERICDN",
"TT04" "NUMERICDN",
"TT05" "NUMERICDN",
"TT06" "NUMERICDN",
"TT07" "NUMERICDN",
"TT08" "NUMERICDN",
"TT09" "NUMERICDN",
"TT10" "NUMERICDN",
"TT11" "NUMERICDN",
"TT12" "NUMERICDN",
"TT13" "NUMERICDN",
"TT14" "NUMERICDN",
"TT15" "NUMERICDN",
"TT16" "NUMERICDN",
"TISENCAO" "NUMERICDN",
"TNINCIDENCIA" "NUMERICDN",
"TSUBSTITUICAO" "NUMERICDN",
"TN1" "NUMERICDN",
"TN2" "NUMERICDN",
"TN3" "NUMERICDN",
"TN4" "NUMERICDN",
"TN5" "NUMERICDN",
"TN6" "NUMERICDN",
"TN7" "NUMERICDN",
"TN8" "NUMERICDN",
"TN9" "NUMERICDN",
"TSANGRIA" "NUMERICDN",
"TSUPRIMENTO" "NUMERICDN",
"TGTOTAL" "NUMERICDN",
"ALIQ01" "NUMERICDN",
"ALIQ02" "NUMERICDN",
"ALIQ03" "NUMERICDN",
"ALIQ04" "NUMERICDN",
"ALIQ05" "NUMERICDN",
"ALIQ06" "NUMERICDN",
"ALIQ07" "NUMERICDN",
"ALIQ08" "NUMERICDN",
"ALIQ09" "NUMERICDN",
"ALIQ10" "NUMERICDN",
"ALIQ11" "NUMERICDN",
"ALIQ12" NUMERIC(15,3),
"ALIQ13" NUMERIC(15,3),
"ALIQ14" NUMERIC(15,3),
"ALIQ15" NUMERIC(15,3),
"ALIQ16" NUMERIC(15,3),
"VLRCONTABILLX" NUMERIC(15,3),
"VLRBASECALCLX" NUMERIC(15,3),
"NUMCANCLX" INTEGER,
"NUMREDLX" INTEGER,
"VLRCANCLX" NUMERIC(15,3),
"VLRDESCLX" NUMERIC(15,3),
"CONTALX" NUMERIC(15,3),
"VLROUTROSRECLX" NUMERIC(15,3),
"ULTCUPOMLX" INTEGER,
"PRIMCUPOMLX" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PVLEITURAXTGBU" FOR "PVLEITURAX"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PVMOVCAIXA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCAIXA" INTEGER NOT NULL,
"DTAMOV" DATE NOT NULL,
"NROMOV" INTEGER NOT NULL,
"TIPOMOV" CHAR(1) CHARACTER SET NONE NOT NULL,
"VLRMOV" "NUMERICDN" NOT NULL,
"VLRSLDMOV" "NUMERICDN",
"CODEMPUS" INTEGER NOT NULL,
"CODFILIALUS" SMALLINT NOT NULL,
"IDUSU" CHAR(8) CHARACTER SET NONE NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PVMOVCAIXATGBI" FOR "PVMOVCAIXA"
ACTIVE BEFORE INSERT POSITION 0 
as
declare variable iMov INTEGER;
declare variable dSaldo NUMERIC(15, 5);
begin
  if (new.vlrsldmov is NULL) then
  BEGIN
    SELECT MAX(NROMOV) FROM PVMOVCAIXA WHERE CODEMP=new.CODEMP
      AND CODFILIAL=new.CODFILIAL AND CODCAIXA=new.CODCAIXA
      AND DTAMOV=new.DTAMOV INTO iMov;
    SELECT coalesce(vlrsldmov,0) FROM PVMOVCAIXA WHERE CODEMP=new.CODEMP
      AND CODFILIAL=new.CODFILIAL AND CODCAIXA=new.CODCAIXA
      AND DTAMOV=new.DTAMOV AND NROMOV=:iMov INTO dSaldo;
    new.vlrsldmov = dSaldo + new.vlrmov;
  END
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "PVSEQMOVCAIXA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCAIXA" INTEGER NOT NULL,
"DTAMOV" DATE NOT NULL,
"NROMOV" INTEGER DEFAULT 0 NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" DATE DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "PVSEQMOVCAIXATGBU" FOR "PVSEQMOVCAIXA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGACESSOEU"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"IDUSU" CHAR(8) CHARACTER SET NONE NOT NULL,
"CODEMPFL" INTEGER NOT NULL,
"CODFILIALFL" SMALLINT NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGACESSOEUTGBU" FOR "SGACESSOEU"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGACESSOMG"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"IDGRPUSU" CHAR(8) CHARACTER SET NONE NOT NULL,
"CODSIS" INTEGER NOT NULL,
"CODMODU" INTEGER NOT NULL,
"CODMENU" INTEGER NOT NULL,
"TPACESSOMG" CHAR(1) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGACESSOMGTGBU" FOR "SGACESSOMG"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGAGENTE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"TIPOAGE" CHAR(5) CHARACTER SET NONE NOT NULL,
"CODAGE" INTEGER NOT NULL,
"DESCAGE" CHAR(50) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT user,
"DTALT" DATE,
"HALT" TIME,
"IDUSUALT" CHAR(8) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGAGENTETGBU" FOR "SGAGENTE"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGATRIBUICAO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"IDATRIB" CHAR(10) CHARACTER SET NONE NOT NULL,
"DESCATRIB" CHAR(50) CHARACTER SET NONE NOT NULL,
"RMAATRIB" CHAR(2) CHARACTER SET NONE NOT NULL,
"OBSATRIB" VARCHAR(500) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGATRIBUICAOTGBU" FOR "SGATRIBUICAO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGATRIBUSU"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"IDATRIB" CHAR(10) CHARACTER SET NONE NOT NULL,
"CODEMPUU" INTEGER NOT NULL,
"CODFILIALUU" SMALLINT NOT NULL,
"IDUSU" CHAR(8) CHARACTER SET NONE NOT NULL,
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT user,
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE,
"DTALT" DATE,
"HALT" TIME);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGATRIBUSUTGBU" FOR "SGATRIBUSU"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGEMPRESA"("CODEMP" INTEGER NOT NULL,
"RAZEMP" CHAR(50) CHARACTER SET NONE,
"NOMEEMP" CHAR(50) CHARACTER SET NONE,
"CNPJEMP" CHAR(14) CHARACTER SET NONE,
"INSCEMP" CHAR(15) CHARACTER SET NONE,
"ENDEMP" CHAR(50) CHARACTER SET NONE,
"NUMEMP" INTEGER,
"COMPLEMP" CHAR(20) CHARACTER SET NONE,
"BAIREMP" CHAR(30) CHARACTER SET NONE,
"CEPEMP" CHAR(8) CHARACTER SET NONE,
"CIDEMP" CHAR(30) CHARACTER SET NONE,
"UFEMP" CHAR(2) CHARACTER SET NONE,
"FONEEMP" CHAR(12) CHARACTER SET NONE,
"FAXEMP" CHAR(8) CHARACTER SET NONE,
"EMAILEMP" CHAR(50) CHARACTER SET NONE,
"WWWEMP" CHAR(50) CHARACTER SET NONE,
"CODEANEMP" CHAR(6) CHARACTER SET NONE,
"CODPAISEMP" CHAR(3) CHARACTER SET NONE,
"PERCISSEMP" NUMERIC(6,2) DEFAULT 0,
"NOMECONTEMP" CHAR(40) CHARACTER SET NONE,
"MULTIALMOXEMP" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"FOTOEMP" BLOB SEGMENT SIZE 50,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGEMPRESATGBU" FOR "SGEMPRESA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGEQVCLIFOR"("CODEMPCL" INTEGER NOT NULL,
"CODFILIALCL" INTEGER NOT NULL,
"CODCLI" INTEGER NOT NULL,
"CODEMPFR" INTEGER NOT NULL,
"CODFILIALFR" INTEGER NOT NULL,
"CODFOR" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGEQVCLIFORTGBU0" FOR "SGEQVCLIFOR"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT=cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGESTACAOIMP"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODEST" INTEGER NOT NULL,
"NROIMP" SMALLINT NOT NULL,
"CODEMPIP" INTEGER NOT NULL,
"CODFILIALIP" SMALLINT NOT NULL,
"CODIMP" INTEGER NOT NULL,
"CODEMPPP" INTEGER NOT NULL,
"CODFILIALPP" SMALLINT NOT NULL,
"CODPAPEL" CHAR(10) CHARACTER SET NONE NOT NULL,
"PORTAWIN" CHAR(50) CHARACTER SET NONE NOT NULL,
"PORTALIN" CHAR(50) CHARACTER SET NONE NOT NULL,
"IMPPAD" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"TIPOUSOIMP" CHAR(2) CHARACTER SET NONE NOT NULL,
"IMPGRAFICA" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT user,
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE,
"DTALT" DATE,
"HALT" TIME);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGESTACAOIMPTGBU" FOR "SGESTACAOIMP"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGESTACAO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODEST" SMALLINT NOT NULL,
"DESCEST" CHAR(50) CHARACTER SET NONE NOT NULL,
"MODODEMOEST" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"IDUSUINS" CHAR(8) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"HINS" TIME DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE,
"DTALT" DATE,
"HALT" TIME);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGESTACAOTGBU" FOR "SGESTACAO"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGFILIAL"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"RAZFILIAL" CHAR(50) CHARACTER SET NONE NOT NULL,
"NOMEFILIAL" CHAR(50) CHARACTER SET NONE NOT NULL,
"MZFILIAL" CHAR(1) CHARACTER SET NONE NOT NULL,
"CNPJFILIAL" CHAR(14) CHARACTER SET NONE,
"INSCFILIAL" CHAR(15) CHARACTER SET NONE,
"ENDFILIAL" CHAR(50) CHARACTER SET NONE,
"NUMFILIAL" INTEGER,
"COMPLFILIAL" CHAR(20) CHARACTER SET NONE,
"BAIRFILIAL" CHAR(30) CHARACTER SET NONE,
"CEPFILIAL" CHAR(8) CHARACTER SET NONE,
"CIDFILIAL" CHAR(30) CHARACTER SET NONE,
"UFFILIAL" CHAR(2) CHARACTER SET NONE,
"FONEFILIAL" CHAR(12) CHARACTER SET NONE,
"FAXFILIAL" CHAR(8) CHARACTER SET NONE,
"EMAILFILIAL" CHAR(50) CHARACTER SET NONE,
"WWWFILIAL" CHAR(50) CHARACTER SET NONE,
"CODDISTFILIAL" INTEGER,
"PERCPISFILIAL" NUMERIC(5,2) DEFAULT 0,
"PERCCOFINSFILIAL" NUMERIC(5,2) DEFAULT 0,
"PERCIRFILIAL" NUMERIC(5,2) DEFAULT 0,
"PERCCSOCIALFILIAL" NUMERIC(5,2) DEFAULT 0,
"SIMPLESFILIAL" CHAR(1) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGFILIALTGBU" FOR "SGFILIAL"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGFLUXO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODFLUXO" INTEGER NOT NULL,
"DESCFLUXO" CHAR(50) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGFLUXOTGBU" FOR "SGFLUXO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGGATILHO"("CODEMP" INTEGER NOT NULL,
"CODOBJ" INTEGER NOT NULL,
"DISPGAT" CHAR(2) CHARACTER SET NONE NOT NULL,
"ATIVOGAT" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGGATILHOTGBU" FOR "SGGATILHO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGGRAUINST"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODGRI" INTEGER NOT NULL,
"DESCGRI" CHAR(50) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGGRAUINSTTGBU" FOR "SGGRAUINST"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGGRPUSU"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"IDGRPUSU" CHAR(8) CHARACTER SET NONE NOT NULL,
"NOMEGRPUSU" CHAR(50) CHARACTER SET NONE NOT NULL,
"COMENTGRPUSU" VARCHAR(10000) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGGRPUSUTGBU" FOR "SGGRPUSU"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGIMPRESSORA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODIMP" INTEGER NOT NULL,
"DESCIMP" CHAR(40) CHARACTER SET NONE NOT NULL,
"TIPOIMP" CHAR(2) CHARACTER SET NONE NOT NULL,
"LINPAGIMP" INTEGER,
"NSERIEIMP" CHAR(15) CHARACTER SET NONE,
"PORTAWINIMP" CHAR(4) CHARACTER SET NONE,
"PORTALINIMP" CHAR(60) CHARACTER SET NONE,
"CODEMPPL" INTEGER,
"CODFILIALPL" SMALLINT,
"CODPAPEL" CHAR(10) CHARACTER SET NONE,
"DESTIMP" CHAR(2) CHARACTER SET NONE DEFAULT 'TO',
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGIMPRESSORATGBU" FOR "SGIMPRESSORA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGITFLUXO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODFLUXO" INTEGER NOT NULL,
"SEQITFLUXO" SMALLINT NOT NULL,
"CODEMPPC" INTEGER NOT NULL,
"CODFILIALPC" SMALLINT NOT NULL,
"CODPROC" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" DATE DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGITFLUXOTGBU" FOR "SGITFLUXO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGITPREFERE6"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODEMPBO" INTEGER NOT NULL,
"CODFILIALBO" SMALLINT NOT NULL,
"CODBANCO" CHAR(3) CHARACTER SET NONE NOT NULL,
"TIPOFEBRABAN" CHAR(2) CHARACTER SET NONE NOT NULL,
"MDECOB" CHAR(2) CHARACTER SET NONE NOT NULL,
"CODCONV" VARCHAR(20) CHARACTER SET NONE,
"CONVCOB" VARCHAR(10) CHARACTER SET NONE,
"VERLAYOUT" VARCHAR(2) CHARACTER SET NONE,
"IDENTSERV" VARCHAR(17) CHARACTER SET NONE,
"CONTACOMPR" VARCHAR(16) CHARACTER SET NONE,
"IDENTAMBCLI" VARCHAR(1) CHARACTER SET NONE,
"IDENTAMBBCO" VARCHAR(1) CHARACTER SET NONE,
"NROSEQ" INTEGER,
"CODEMPCA" INTEGER,
"CODFILIALCA" SMALLINT,
"NUMCONTA" CHAR(10) CHARACTER SET NONE,
"FORCADTIT" SMALLINT DEFAULT 1,
"TIPODOC" SMALLINT DEFAULT 1,
"IDENTEMITBOL" SMALLINT DEFAULT 1,
"IDENTDISTBOL" SMALLINT DEFAULT 1,
"ESPECTIT" SMALLINT DEFAULT 1,
"CODJUROS" SMALLINT DEFAULT 1,
"VLRPERCJUROS" NUMERIC(15,5) DEFAULT 0.0,
"CODDESC" SMALLINT DEFAULT 1,
"VLRPERCDESC" NUMERIC(15,5) DEFAULT 0.0,
"CODPROT" SMALLINT DEFAULT 3,
"DIASPROT" SMALLINT DEFAULT 0,
"CODBAIXADEV" SMALLINT DEFAULT 1,
"DIASBAIXADEV" SMALLINT DEFAULT 1,
"DTINS" DATE DEFAULT 'now' NOT NULL,
"HINS" TIME DEFAULT 'now' NOT NULL,
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER NOT NULL,
"DTALT" DATE DEFAULT 'now' NOT NULL,
"HALT" TIME DEFAULT 'now' NOT NULL,
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGITPREFERE6TGBU" FOR "SGITPREFERE6"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGITPROCESSO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROC" INTEGER NOT NULL,
"SEQITPROC" SMALLINT NOT NULL,
"CODEMPTA" INTEGER NOT NULL,
"CODFILIALTA" SMALLINT NOT NULL,
"CODTAREFA" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" DATE DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGITPROCESSOTGBU" FOR "SGITPROCESSO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGITTABELA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTB" SMALLINT NOT NULL,
"CODITTB" INTEGER NOT NULL,
"DESCITTB" CHAR(50) CHARACTER SET NONE NOT NULL,
"PADRAOITTB" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGITTABELATGBU" FOR "SGITTABELA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGMENUOBJ"("CODEMP" INTEGER NOT NULL,
"IDOBJ" CHAR(30) CHARACTER SET NONE NOT NULL,
"CODSIS" INTEGER NOT NULL,
"CODMODU" INTEGER NOT NULL,
"CODMENU" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGMENUOBJTGBU" FOR "SGMENUOBJ"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGMENU"("CODSIS" INTEGER NOT NULL,
"CODMODU" INTEGER NOT NULL,
"CODMENU" INTEGER NOT NULL,
"DESCMENU" "CHARMIDDLEDN" NOT NULL,
"NOMEMENU" "CHARMIDDLEDN" NOT NULL,
"PLANOMENU" CHAR(1) CHARACTER SET NONE DEFAULT 'O' NOT NULL,
"ACAOMENU" CHAR(100) CHARACTER SET NONE NOT NULL,
"CODSISPAI" INTEGER,
"CODMODUPAI" INTEGER,
"CODMENUPAI" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGMENUTGBI" FOR "SGMENU"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  if (new.CODSIS=1) then
  begin
     if (new.NOMEMENU is null) then
        new.NOMEMENU = new.DESCMENU;
     if (new.ACAOMENU is null) then
        new.ACAOMENU = cast(new.CODMENU as CHAR(30));
  end 
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGMENUTGBU" FOR "SGMENU"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGMODETIQUETA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"CODMODETIQ" INTEGER NOT NULL,
"DESCMODETIQ" CHAR(30) CHARACTER SET NONE NOT NULL,
"NCOLMODETIQ" SMALLINT DEFAULT 0 NOT NULL,
"EECMODETIQ" SMALLINT DEFAULT 0 NOT NULL,
"TXAMODETIQ" VARCHAR(1000) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"CODEMPPL" INTEGER,
"CODFILIALPL" SMALLINT,
"CODPAPEL" CHAR(10) CHARACTER SET NONE,
"COMPRIMIDO" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGMODETIQUETATGBU" FOR "SGMODETIQUETA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGMODULO"("CODSIS" INTEGER NOT NULL,
"CODMODU" INTEGER NOT NULL,
"DESCMODU" CHAR(50) CHARACTER SET NONE NOT NULL,
"COMENTMODU" VARCHAR(10000) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGMODULOTGBU" FOR "SGMODULO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGOBJETOTB"("CODEMP" INTEGER NOT NULL,
"IDOBJ" CHAR(30) CHARACTER SET NONE NOT NULL,
"CODEMPTB" INTEGER NOT NULL,
"CODFILIALTB" SMALLINT NOT NULL,
"CODTB" SMALLINT NOT NULL,
"OBRIGOBJTB" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGOBJETOTBTGBU" FOR "SGOBJETOTB"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGOBJETO"("CODEMP" INTEGER NOT NULL,
"IDOBJ" CHAR(30) CHARACTER SET NONE NOT NULL,
"DESCOBJ" CHAR(50) CHARACTER SET NONE NOT NULL,
"TIPOOBJ" CHAR(2) CHARACTER SET NONE NOT NULL,
"COMENTOBJ" VARCHAR(10000) CHARACTER SET NONE,
"USOMEOBJ" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"SIGLAOBJ" CHAR(8) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGOBJETOTGBU" FOR "SGOBJETO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGPAPEL"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPAPEL" CHAR(10) CHARACTER SET NONE NOT NULL,
"DESCPAPEL" CHAR(40) CHARACTER SET NONE,
"LINPAPEL" INTEGER,
"ALTPAPEL" INTEGER,
"LARGPAPEL" INTEGER,
"CLASSNOTAPAPEL" CHAR(20) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"COLPAPEL" SMALLINT);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGPAPELTGBU" FOR "SGPAPEL"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGPREFERE1TGBU" FOR "SGPREFERE1"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGPREFERE2TGBU" FOR "SGPREFERE2"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGPREFERE3"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"SMTPMAIL" CHAR(40) CHARACTER SET NONE,
"SMTPSSLMAIL" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"SMTPAUTMAIL" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"PORTAMAIL" INTEGER DEFAULT 25,
"USERMAIL" CHAR(40) CHARACTER SET NONE,
"PASSMAIL" CHAR(40) CHARACTER SET NONE,
"ENDMAIL" VARCHAR(60) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGPREFERE3TGBU" FOR "SGPREFERE3"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGPREFERE4"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"CODTIPOMOV" INTEGER,
"CODEMPTM" INTEGER,
"CODFILIALTM" INTEGER,
"CODEMPPP" INTEGER,
"CODFILIALPP" SMALLINT,
"CODPLANOPAG" INTEGER,
"CODEMPCL" INTEGER,
"CODFILIALCL" SMALLINT,
"CODCLI" INTEGER,
"CODEMPPD" INTEGER,
"CODFILIALPD" SMALLINT,
"CODPROD" INTEGER,
"PRAZO" SMALLINT,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"ADICPDV" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"APROVORC" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"DIASVENCORC" INTEGER,
"USABUSCAGENPROD" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"AUTOFECHAVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"USALOTEORC" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"HABRECEBER" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGPREFERE4TGBU" FOR "SGPREFERE4"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGPREFERE5"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"CLASSOP" CHAR(20) CHARACTER SET NONE,
"NOMERESP" CHAR(50) CHARACTER SET NONE,
"IDENTPROFRESP" CHAR(30) CHARACTER SET NONE,
"CARGORESP" CHAR(30) CHARACTER SET NONE,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"CODTIPOMOV" INTEGER,
"CODEMPTM" SMALLINT,
"CODFILIALTM" SMALLINT,
"SITRMAOP" CHAR(2) CHARACTER SET NONE DEFAULT 'PE');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGPREFERE5_BU0" FOR "SGPREFERE5"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGPREFERE6"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"NOMEEMP" VARCHAR(20) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now' NOT NULL,
"HINS" TIME DEFAULT 'now' NOT NULL,
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER NOT NULL,
"DTALT" DATE DEFAULT 'now' NOT NULL,
"HALT" TIME DEFAULT 'now' NOT NULL,
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGPREFERE6TGBU" FOR "SGPREFERE6"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGPROCESSO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROC" INTEGER NOT NULL,
"DESCPROC" CHAR(50) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGPROCESSOTGBU" FOR "SGPROCESSO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGSEQUENCIA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"SGTAB" CHAR(2) CHARACTER SET NONE NOT NULL,
"NROSEQ" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGSEQUENCIATGBU" FOR "SGSEQUENCIA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGSISTEMA"("CODSIS" INTEGER NOT NULL,
"DESCSIS" CHAR(50) CHARACTER SET NONE NOT NULL,
"COMENTSIS" VARCHAR(10000) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGSISTEMATGBU" FOR "SGSISTEMA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGTABELA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTB" SMALLINT NOT NULL,
"DESCTB" CHAR(50) CHARACTER SET NONE NOT NULL,
"SIGLATB" CHAR(10) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGTABELATGBU" FOR "SGTABELA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGTAREFA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTAREFA" INTEGER NOT NULL,
"DESCTAREFA" CHAR(50) CHARACTER SET NONE NOT NULL,
"CODEMPOB" INTEGER NOT NULL,
"CODOBJ" INTEGER NOT NULL,
"TIPOTAREFA" CHAR(2) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGTAREFATGBU" FOR "SGTAREFA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGTRATARET"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROC" INTEGER NOT NULL,
"SEQITPROC" SMALLINT NOT NULL,
"CODTRATRET" SMALLINT NOT NULL,
"TIPOTRATRET" CHAR(2) CHARACTER SET NONE NOT NULL,
"CODEMPGT" INTEGER,
"CODFILIALGT" SMALLINT,
"SEQITPROCGT" SMALLINT,
"CODPROCGT" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGTRATARETAI" FOR "SGTRATARET"
ACTIVE AFTER INSERT POSITION 0 
as
begin
  IF (new.CODPROCGT IS NULL AND NOT new.SEQITPROCGT IS NULL) THEN
    new.CODPROCGT = new.CODPROC;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGTRATARETTGBU" FOR "SGTRATARET"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "SGAGENTEUIDSP"("CIUD" CHAR(1) CHARACTER SET NONE,
"ICODEMP" INTEGER,
"CTIPOAGE" CHAR(5) CHARACTER SET NONE,
"ICODAGE" INTEGER,
"CDESCAGE" CHAR(50) CHARACTER SET NONE)
 RETURNS("CODEMP" INTEGER,
"CODFILIAL" SMALLINT,
"TIPOAGE" CHAR(5) CHARACTER SET NONE,
"CODAGE" INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGUSUARIO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"IDUSU" CHAR(8) CHARACTER SET NONE NOT NULL,
"NOMEUSU" CHAR(50) CHARACTER SET NONE NOT NULL,
"CODEMPIG" INTEGER,
"CODFILIALIG" SMALLINT,
"IDGRPUSU" CHAR(8) CHARACTER SET NONE,
"CODEMPCC" INTEGER,
"CODFILIALCC" SMALLINT,
"ANOCC" SMALLINT,
"CODCC" CHAR(19) CHARACTER SET NONE,
"PNOMEUSU" CHAR(20) CHARACTER SET NONE,
"UNOMEUSU" CHAR(20) CHARACTER SET NONE,
"COMENTUSU" VARCHAR(10000) CHARACTER SET NONE,
"BAIXOCUSTOUSU" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CODALMOX" INTEGER,
"CODEMPAM" INTEGER,
"CODFILIALAM" SMALLINT,
"ABREGAVETAUSU" CHAR(1) CHARACTER SET NONE DEFAULT 'S',
"APROVCPSOLICITACAOUSU" CHAR(2) CHARACTER SET NONE DEFAULT 'ND',
"ALMOXARIFEUSU" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CODEMPAE" INTEGER,
"CODFILIALAE" SMALLINT,
"TIPOAGE" CHAR(5) CHARACTER SET NONE,
"CODAGE" INTEGER,
"APROVRMAUSU" CHAR(2) CHARACTER SET NONE DEFAULT 'ND',
"COMPRASUSU" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"ALTPARCVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"APROVRECEITA" CHAR(1) CHARACTER SET NONE DEFAULT 'N');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGUSUARIOTGBD" FOR "SGUSUARIO"
ACTIVE BEFORE DELETE POSITION 0 
AS
  DECLARE VARIABLE CODAGE INTEGER;
begin
  SELECT CODAGE FROM SGAGENTEUIDSP('D', old.CODEMP, old.TIPOAGE, old.CODAGE, old.NOMEUSU)
     INTO :CODAGE;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGUSUARIOTGBI" FOR "SGUSUARIO"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
   SELECT CODEMP, CODFILIAL, TIPOAGE, CODAGE
      FROM SGAGENTEUIDSP('I',new.CODEMP, 'SGUSU', null, new.NOMEUSU)
        INTO new.CODEMPAE, new.CODFILIALAE, new.TIPOAGE, new.CODAGE;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGUSUARIOTGBU" FOR "SGUSUARIO"
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE CUID CHAR(1);
/*  declare variable CTEMP CHAR(256); */
begin
   IF (new.CODAGE IS NULL) THEN
      CUID = 'I';
   else
      CUID = 'U';
  /* CTEMP = printlog('CUID: '||:CUID);
   CTEMP = printlog('codemp: '||NEW.CODEMP);
   CTEMP = printlog('codfilial: '||NEW.CODFILIAL);
   CTEMP = printlog('CODAGE: '||NEW.CODAGE);
   */
   SELECT CODEMP, CODFILIAL, TIPOAGE, CODAGE
      FROM SGAGENTEUIDSP(:CUID,new.CODEMP, 'SGUSU', new.CODAGE, new.NOMEUSU)
        INTO new.CODEMPAE, new.CODFILIALAE, new.TIPOAGE, new.CODAGE;
   /*CTEMP = printlog('CUID: '||:CUID);
   CTEMP = printlog('codemp: '||NEW.CODEMP);
   CTEMP = printlog('codfilial: '||NEW.CODFILIAL);
   CTEMP = printlog('CODAGE: '||NEW.CODAGE);
   */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGVARIAVEL"("IDVAR" CHAR(18) CHARACTER SET NONE NOT NULL,
"IDCON" INTEGER NOT NULL,
"VLRINTEGER" INTEGER,
"VLRCHAR1" CHAR(20) CHARACTER SET NONE,
"VLRCHAR2" CHAR(50) CHARACTER SET NONE,
"VLRDECIMAL" "NUMERICDN",
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "SGVARIAVELTGBU" FOR "SGVARIAVEL"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT=cast('now'AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "TKATIVIDADE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODATIV" INTEGER NOT NULL,
"DESCATIV" CHAR(50) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "TKATIVIDADETGBU" FOR "TKATIVIDADE"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "TKCONTATO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCTO" INTEGER NOT NULL,
"RAZCTO" CHAR(50) CHARACTER SET NONE NOT NULL,
"CODEMPVD" INTEGER,
"CODFILIALVD" SMALLINT,
"CODVEND" INTEGER,
"CODEMPSR" INTEGER NOT NULL,
"CODFILIALSR" SMALLINT NOT NULL,
"CODSETOR" INTEGER NOT NULL,
"NOMECTO" CHAR(50) CHARACTER SET NONE NOT NULL,
"DATACTO" DATE DEFAULT 'today' NOT NULL,
"PESSOACTO" CHAR(1) CHARACTER SET NONE NOT NULL,
"ATIVOCTO" CHAR(1) CHARACTER SET NONE NOT NULL,
"CNPJCTO" CHAR(14) CHARACTER SET NONE,
"INSCCTO" CHAR(15) CHARACTER SET NONE,
"CPFCTO" CHAR(11) CHARACTER SET NONE,
"RGCTO" CHAR(10) CHARACTER SET NONE,
"ENDCTO" CHAR(50) CHARACTER SET NONE,
"NUMCTO" INTEGER,
"COMPLCTO" CHAR(20) CHARACTER SET NONE,
"BAIRCTO" CHAR(30) CHARACTER SET NONE,
"CIDCTO" CHAR(30) CHARACTER SET NONE,
"UFCTO" CHAR(2) CHARACTER SET NONE,
"CEPCTO" CHAR(8) CHARACTER SET NONE,
"FONECTO" CHAR(12) CHARACTER SET NONE,
"FAXCTO" CHAR(8) CHARACTER SET NONE,
"EMAILCTO" CHAR(50) CHARACTER SET NONE,
"CONTCTO" CHAR(40) CHARACTER SET NONE,
"CARGOCONTCTO" CHAR(30) CHARACTER SET NONE,
"OBSCTO" VARCHAR(10000) CHARACTER SET NONE,
"REMOVCTO" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"CODEMPTI" INTEGER,
"CODFILIALTI" SMALLINT,
"CODTPIMP" INTEGER,
"CODEMPSO" INTEGER,
"CODFILIALSO" SMALLINT,
"CODSETORCTO" INTEGER,
"NUMEMPCTO" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "TKCONTATOTGBU" FOR "TKCONTATO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "TKCTOATIV"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCTO" INTEGER NOT NULL,
"CODEMPAV" INTEGER NOT NULL,
"CODFILIALAV" SMALLINT NOT NULL,
"CODATIV" INTEGER NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "TKCTOATIVTGBU" FOR "TKCTOATIV"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "TKHISTORICO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODHISTTK" INTEGER NOT NULL,
"DATAHISTTK" DATE NOT NULL,
"HORAHISTTK" TIME NOT NULL,
"CODEMPCO" INTEGER,
"CODFILIALCO" SMALLINT,
"CODCTO" INTEGER,
"CODEMPCL" INTEGER,
"CODFILIALCL" SMALLINT,
"CODCLI" INTEGER,
"DESCHISTTK" VARCHAR(10000) CHARACTER SET NONE NOT NULL,
"CODEMPAE" INTEGER NOT NULL,
"CODFILIALAE" SMALLINT NOT NULL,
"CODATEND" INTEGER NOT NULL,
"SITHISTTK" CHAR(2) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"TIPOHISTTK" CHAR(1) CHARACTER SET NONE DEFAULT 'H');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "TKHISTORICOTGBU" FOR "TKHISTORICO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "TKSETORCTO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODSETORCTO" INTEGER NOT NULL,
"DESCSETORCTO" CHAR(50) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "TKSETORCTOTGBU" FOR "TKSETORCTO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "TKTIPOIMP"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTPIMP" INTEGER NOT NULL,
"DESCTPIMP" CHAR(50) CHARACTER SET NONE NOT NULL,
"TRANSBINTPIMP" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"CSEPTPIMP" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"ENTERLNTPIMP" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"SEPTPIMP" CHAR(10) CHARACTER SET NONE,
"LAYOUTTPIMP" VARCHAR(256) CHARACTER SET NONE,
"DELCRTTPIMP" SMALLINT,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "TKTIPOIMPTGBU" FOR "TKTIPOIMP"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDAUXVENDA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"TIPOVENDA" CHAR(1) CHARACTER SET NONE NOT NULL,
"CODVENDA" INTEGER NOT NULL,
"CODAUXV" SMALLINT NOT NULL,
"CPFCLIAUXV" CHAR(11) CHARACTER SET NONE,
"NOMECLIAUXV" CHAR(50) CHARACTER SET NONE,
"ENDCLIAUXV" CHAR(50) CHARACTER SET NONE,
"NUMCLIAUXV" INTEGER,
"CIDCLIAUXV" CHAR(30) CHARACTER SET NONE,
"UFCLIAUXV" CHAR(2) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDAUXVENDATGBU" FOR "VDAUXVENDA"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDCLASCLI"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCLASCLI" INTEGER NOT NULL,
"DESCCLASCLI" CHAR(40) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"SIGLACLASCLI" CHAR(3) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDCLASCLITGBU" FOR "VDCLASCLI"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDCLCOMIS"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"CODCLCOMIS" INTEGER NOT NULL,
"DESCCLCOMIS" CHAR(50) CHARACTER SET NONE NOT NULL,
"PERCFATCLCOMIS" NUMERIC(9,2),
"PERCPGTOCLCOMIS" NUMERIC(9,2));
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDCLCOMISTGBI" FOR "VDCLCOMIS"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  if ( (new.percfatclcomis+new.percpgtoclcomis) != 100.00) then
  begin
     exception VDCLCOMISEX01;
  end
  /* Trigger text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDCLCOMISTGBU" FOR "VDCLCOMIS"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  if ( (new.percfatclcomis+new.percpgtoclcomis) != 100.00) then
  begin
     exception VDCLCOMISEX01;
  end
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDCLIENTEFOR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCLI" INTEGER NOT NULL,
"CODEMPFR" INTEGER NOT NULL,
"CODFILIALFR" SMALLINT NOT NULL,
"CODFOR" INTEGER NOT NULL,
"CODCLIFOR" INTEGER,
"CODCPCLIFOR" CHAR(10) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDCLIENTEFORTGBU" FOR "VDCLIENTEFOR"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDCLIENTE"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODCLI" INTEGER NOT NULL,
"RAZCLI" CHAR(50) CHARACTER SET NONE NOT NULL,
"NOMECLI" CHAR(50) CHARACTER SET NONE NOT NULL,
"CODEMPCC" INTEGER,
"CODFILIALCC" SMALLINT,
"CODCLASCLI" INTEGER,
"CODEMPVD" INTEGER,
"CODFILIALVD" SMALLINT,
"CODVEND" INTEGER,
"CODEMPTC" INTEGER,
"CODFILIALTC" SMALLINT,
"CODTIPOCOB" INTEGER,
"CODEMPPG" INTEGER,
"CODFILIALPG" SMALLINT,
"CODPLANOPAG" INTEGER,
"CODEMPTN" INTEGER,
"CODFILIALTN" SMALLINT,
"CODTRAN" INTEGER,
"CODEMPBO" INTEGER,
"CODFILIALBO" SMALLINT,
"CODBANCO" CHAR(3) CHARACTER SET NONE,
"CODEMPSR" INTEGER,
"CODFILIALSR" SMALLINT,
"CODSETOR" INTEGER,
"CODEMPTI" INTEGER NOT NULL,
"CODFILIALTI" SMALLINT NOT NULL,
"CODTIPOCLI" INTEGER NOT NULL,
"CODTPCRED" INTEGER,
"CODFILIALTR" INTEGER,
"CODEMPTR" INTEGER,
"CODFISCCLI" INTEGER,
"CODEMPFC" INTEGER,
"CODFILIALFC" INTEGER,
"CODPAIS" SMALLINT,
"CODEMPEC" INTEGER,
"CODFILIALEC" SMALLINT,
"CODTBEC" SMALLINT,
"CODITTBEC" INTEGER,
"CODEMPHP" INTEGER,
"CODFILIALHP" SMALLINT,
"CODHIST" INTEGER,
"CODEMPCB" INTEGER,
"CODFILIALCB" SMALLINT,
"CODCARTCOB" CHAR(2) CHARACTER SET NONE,
"DATACLI" DATE DEFAULT 'today' NOT NULL,
"PESSOACLI" CHAR(1) CHARACTER SET NONE NOT NULL,
"ATIVOCLI" CHAR(1) CHARACTER SET NONE NOT NULL,
"CNPJCLI" CHAR(14) CHARACTER SET NONE,
"INSCCLI" CHAR(15) CHARACTER SET NONE,
"CPFCLI" CHAR(11) CHARACTER SET NONE,
"RGCLI" CHAR(10) CHARACTER SET NONE,
"SSPCLI" CHAR(10) CHARACTER SET NONE,
"ENDCLI" CHAR(50) CHARACTER SET NONE,
"NUMCLI" INTEGER,
"COMPLCLI" CHAR(20) CHARACTER SET NONE,
"BAIRCLI" CHAR(30) CHARACTER SET NONE,
"CIDCLI" CHAR(30) CHARACTER SET NONE,
"UFCLI" CHAR(2) CHARACTER SET NONE,
"CEPCLI" CHAR(8) CHARACTER SET NONE,
"DDDCLI" CHAR(4) CHARACTER SET NONE,
"FONECLI" CHAR(12) CHARACTER SET NONE,
"RAMALCLI" CHAR(6) CHARACTER SET NONE,
"DDDFAXCLI" CHAR(4) CHARACTER SET NONE,
"FAXCLI" CHAR(8) CHARACTER SET NONE,
"EMAILCLI" CHAR(50) CHARACTER SET NONE,
"CONTCLI" CHAR(40) CHARACTER SET NONE,
"ENDCOB" CHAR(50) CHARACTER SET NONE,
"NUMCOB" INTEGER,
"COMPLCOB" CHAR(20) CHARACTER SET NONE,
"BAIRCOB" CHAR(30) CHARACTER SET NONE,
"CIDCOB" CHAR(30) CHARACTER SET NONE,
"UFCOB" CHAR(2) CHARACTER SET NONE,
"CEPCOB" CHAR(8) CHARACTER SET NONE,
"DDDFONECOB" CHAR(4) CHARACTER SET NONE,
"FONECOB" CHAR(12) CHARACTER SET NONE,
"DDDFAXCOB" CHAR(4) CHARACTER SET NONE,
"FAXCOB" CHAR(8) CHARACTER SET NONE,
"ENDENT" CHAR(50) CHARACTER SET NONE,
"NUMENT" INTEGER,
"COMPLENT" CHAR(20) CHARACTER SET NONE,
"BAIRENT" CHAR(30) CHARACTER SET NONE,
"CIDENT" CHAR(30) CHARACTER SET NONE,
"UFENT" CHAR(2) CHARACTER SET NONE,
"CEPENT" CHAR(8) CHARACTER SET NONE,
"DDDFONEENT" CHAR(4) CHARACTER SET NONE,
"FONEENT" CHAR(12) CHARACTER SET NONE,
"DDDFAXENT" CHAR(4) CHARACTER SET NONE,
"FAXENT" CHAR(8) CHARACTER SET NONE,
"OBSCLI" VARCHAR(10000) CHARACTER SET NONE,
"AGENCIACLI" CHAR(6) CHARACTER SET NONE,
"CODEMPPQ" INTEGER,
"CODFILIALPQ" SMALLINT,
"CODPESQ" INTEGER,
"INCRACLI" CHAR(15) CHARACTER SET NONE,
"DTINITR" DATE,
"DTVENCTOTR" DATE,
"NIRFCLI" CHAR(15) CHARACTER SET NONE,
"SIMPLESCLI" CHAR(1) CHARACTER SET NONE,
"DDDCELCLI" CHAR(4) CHARACTER SET NONE,
"CELCLI" CHAR(8) CHARACTER SET NONE,
"NATCLI" CHAR(30) CHARACTER SET NONE,
"UFNATCLI" CHAR(2) CHARACTER SET NONE,
"TEMPORESCLI" CHAR(20) CHARACTER SET NONE,
"APELIDOCLI" CHAR(30) CHARACTER SET NONE,
"SITECLI" CHAR(50) CHARACTER SET NONE,
"CODCONTDEB" VARCHAR(20) CHARACTER SET NONE,
"CODCONTCRED" VARCHAR(20) CHARACTER SET NONE,
"CODCLICONTAB" VARCHAR(20) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT user,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDCLIENTETGBI" FOR "VDCLIENTE"
ACTIVE BEFORE INSERT POSITION 0 
as
begin
  if (new.codpesq is null) then new.codpesq = new.codcli;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDCLIENTETGBU" FOR "VDCLIENTE"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  if (new.codpesq is null) then new.codpesq = new.codcli;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDCOMISSAOTGBD" FOR "VDCOMISSAO"
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  IF (old.STATUSCOMI = 'CP') THEN
    EXCEPTION VDCOMISSAOEX01;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDCOMISSAOTGBI" FOR "VDCOMISSAO"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  new.DTINS = cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  IF ( new.VLRCOMI IS NULL) THEN
    new.VLRCOMI = 0;
  IF ( new.VLRPAGOCOMI IS NULL ) THEN
    new.VLRPAGOCOMI = 0;
  new.VLRAPAGCOMI = new.VLRCOMI - new.VLRPAGOCOMI;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDCOMISSAOTGBU" FOR "VDCOMISSAO"
ACTIVE BEFORE UPDATE POSITION 0 
AS
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( OLD.STATUSCOMI = 'CP' AND NEW.STATUSCOMI = 'C1' ) then
    EXCEPTION VDCOMISSAOEX01;
  ELSE if ( OLD.STATUSCOMI='CP' AND NEW.STATUSCOMI='CP' AND OLD.VLRCOMI!=NEW.VLRCOMI ) then
    EXCEPTION VDCOMISSAOEX01;
  ELSE IF ( OLD.STATUSCOMI = 'C1' AND NEW.STATUSCOMI = 'CP' ) then
    EXCEPTION VDCOMISSAOEX02;
  ELSE IF ( OLD.STATUSCOMI = 'CP' AND NEW.STATUSCOMI = 'CD' ) THEN /* Estorno de comissões */
  BEGIN
     new.STATUSCOMI ='C2';
     new.CODEMPCI = null;
     new.CODFILIALCI = null;
     new.CODPCOMI = null;
     new.VLRPAGOCOMI = 0;
  END
  IF ( new.VLRCOMI IS NULL) THEN
    new.VLRCOMI = 0;
  IF ( new.VLRPAGOCOMI IS NULL ) THEN
    new.VLRPAGOCOMI = 0;
  new.VLRAPAGCOMI = new.VLRCOMI - new.VLRPAGOCOMI;
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDFOTOPROD"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODFOTOPROD" INTEGER NOT NULL,
"DESCFOTOPROD" CHAR(40) CHARACTER SET NONE NOT NULL,
"TIPOFOTOPROD" CHAR(1) CHARACTER SET NONE NOT NULL,
"LARGFOTOPROD" INTEGER NOT NULL,
"ALTFOTOPROD" INTEGER NOT NULL,
"FOTOPROD" BLOB SEGMENT SIZE 50 NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDFOTOPRODTGBU" FOR "VDFOTOPROD"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDFRETEVD"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"TIPOVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'V' NOT NULL,
"CODVENDA" INTEGER NOT NULL,
"CODEMPTN" INTEGER,
"CODFILIALTN" SMALLINT,
"CODTRAN" INTEGER,
"TIPOFRETEVD" CHAR(1) CHARACTER SET NONE NOT NULL,
"PLACAFRETEVD" CHAR(10) CHARACTER SET NONE NOT NULL,
"UFFRETEVD" CHAR(2) CHARACTER SET NONE NOT NULL,
"VLRFRETEVD" "NUMERICDN" NOT NULL,
"QTDFRETEVD" "NUMERICDN" NOT NULL,
"PESOBRUTVD" "NUMERICDN" NOT NULL,
"PESOLIQVD" "NUMERICDN" NOT NULL,
"ESPFRETEVD" CHAR(10) CHARACTER SET NONE NOT NULL,
"MARCAFRETEVD" CHAR(10) CHARACTER SET NONE NOT NULL,
"CONHECFRETEVD" CHAR(13) CHARACTER SET NONE,
"PERCVENDAFRETEVD" NUMERIC(9,2),
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"ADICFRETEVD" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDFRETEVDTGAI" FOR "VDFRETEVD"
ACTIVE BEFORE INSERT POSITION 0 
AS 
DECLARE VARIABLE VLRLIQVENDA NUMERIC(9,2);
BEGIN
  SELECT VLRLIQVENDA FROM VDVENDA WHERE TIPOVENDA=new.TIPOVENDA AND CODVENDA=new.CODVENDA AND
    CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL INTO VLRLIQVENDA;
  IF (NOT VLRLIQVENDA IS NULL AND VLRLIQVENDA > 0 AND NOT new.PERCVENDAFRETEVD > 0) THEN
    new.PERCVENDAFRETEVD = (new.VLRFRETEVD/:VLRLIQVENDA)*100;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDFRETEVDTGBU" FOR "VDFRETEVD"
ACTIVE BEFORE UPDATE POSITION 0 
AS
DECLARE VARIABLE VLRLIQVENDA NUMERIC(9,2);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT VLRLIQVENDA FROM VDVENDA WHERE TIPOVENDA=new.TIPOVENDA AND CODVENDA=new.CODVENDA AND
    CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL INTO VLRLIQVENDA;
  IF (NOT VLRLIQVENDA IS NULL AND VLRLIQVENDA > 0) THEN
    new.PERCVENDAFRETEVD = (new.VLRFRETEVD/:VLRLIQVENDA)*100;
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDITKIT"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODKIT" INTEGER NOT NULL,
"SEQITKIT" SMALLINT NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"REFPROD" CHAR(13) CHARACTER SET NONE NOT NULL,
"QTDITKIT" "NUMERICDN" DEFAULT 0 NOT NULL,
"PRECOITKIT" "NUMERICDN" DEFAULT 0 NOT NULL,
"VLRTOTITKIT" "NUMERICDN" DEFAULT 0 NOT NULL,
"IDUSUINS" CHAR(8) CHARACTER SET NONE,
"DTINS" DATE,
"HINS" TIME,
"IDUSUALT" CHAR(8) CHARACTER SET NONE,
"DTALT" DATE,
"HALT" TIME);
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "EQREFPRODSP"("CODEMP" INTEGER,
"CODFILIAL" SMALLINT,
"CODPROD" INTEGER)
 RETURNS("REFPROD" CHAR(13) CHARACTER SET NONE)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITKITTGBI" FOR "VDITKIT"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  /* Trigger text */
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITKITTGBU" FOR "VDITKIT"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  /* Trigger text */
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDORCAMENTO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"TIPOORC" CHAR(1) CHARACTER SET NONE DEFAULT 'O' NOT NULL,
"CODORC" INTEGER NOT NULL,
"CODEMPAE" INTEGER,
"CODFILIALAE" SMALLINT,
"CODATEND" INTEGER,
"CODEMPCV" INTEGER,
"CODFILIALCV" SMALLINT,
"CODCONV" INTEGER,
"DTORC" DATE NOT NULL,
"DTVENCORC" DATE NOT NULL,
"VLRPRODORC" "NUMERICDN",
"PERCDESCORC" NUMERIC(9,2),
"VLRDESCORC" "NUMERICDN",
"PERCADICORC" NUMERIC(15,5),
"VLRADICORC" "NUMERICDN",
"VLRDESCITORC" "NUMERICDN",
"VLRLIQORC" "NUMERICDN",
"STATUSORC" CHAR(2) CHARACTER SET NONE NOT NULL,
"OBSORC" VARCHAR(10000) CHARACTER SET NONE,
"CODPLANOPAG" INTEGER,
"CODFILIALPG" INTEGER,
"CODEMPPG" INTEGER,
"TXT01" CHAR(20) CHARACTER SET NONE,
"CODEMPVD" INTEGER NOT NULL,
"CODFILIALVD" SMALLINT NOT NULL,
"CODVEND" INTEGER NOT NULL,
"CODEMPCL" INTEGER NOT NULL,
"CODFILIALCL" SMALLINT NOT NULL,
"CODCLI" INTEGER NOT NULL,
"CODTPCONV" INTEGER,
"CODFILIALTC" INTEGER,
"CODEMPTC" INTEGER,
"PRAZOENTORC" SMALLINT,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"EMMANUT" CHAR(1) CHARACTER SET NONE,
"CODCLCOMIS" INTEGER,
"CODEMPCM" SMALLINT,
"CODFILIALCM" INTEGER);
COMMIT WORK;
CREATE TABLE "VDITORCAMENTO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"TIPOORC" CHAR(1) CHARACTER SET NONE DEFAULT 'O' NOT NULL,
"CODORC" INTEGER NOT NULL,
"CODITORC" INTEGER NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODEMPAX" INTEGER NOT NULL,
"CODFILIALAX" SMALLINT NOT NULL,
"CODALMOX" INTEGER NOT NULL,
"QTDITORC" "NUMERICDN" NOT NULL,
"PRECOITORC" "NUMERICDN" NOT NULL,
"PERCDESCITORC" NUMERIC(9,2),
"VLRDESCITORC" "NUMERICDN",
"VLRLIQITORC" "NUMERICDN",
"VLRPRODITORC" "NUMERICDN",
"REFPROD" CHAR(13) CHARACTER SET NONE,
"NUMAUTORIZORC" CHAR(15) CHARACTER SET NONE,
"ACEITEITORC" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"APROVITORC" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"EMITITORC" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"VENCAUTORIZORC" DATE,
"STRDESCITORC" CHAR(50) CHARACTER SET NONE,
"OBSITORC" VARCHAR(502) CHARACTER SET NONE,
"STATUSITORC" CHAR(2) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"CODEMPPE" INTEGER,
"CODFILIALPE" SMALLINT,
"CODPE" INTEGER,
"DIASPE" SMALLINT,
"EMMANUT" CHAR(1) CHARACTER SET NONE,
"CODEMPLG" INTEGER,
"CODFILIALLG" INTEGER,
"CODLOG" INTEGER,
"CODEMPLE" INTEGER,
"CODFILIALLE" SMALLINT,
"CODLOTE" CHAR(13) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITORCAMENTOTGAD" FOR "VDITORCAMENTO"
ACTIVE AFTER DELETE POSITION 0 
AS
BEGIN
  IF ( not ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) THEN
  BEGIN

    UPDATE VDORCAMENTO SET VLRDESCITORC = VLRDESCITORC -old.VLRDESCITORC,
         VLRPRODORC = VLRPRODORC - old.VLRPRODITORC,
         VLRLIQORC = VLRLIQORC - old.VLRLIQITORC
         WHERE CODORC=old.CODORC AND TIPOORC='O' AND
         CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
  END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITORCAMENTOTGAU" FOR "VDITORCAMENTO"
ACTIVE AFTER UPDATE POSITION 0 
AS
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) ) THEN
  BEGIN

     UPDATE VDORCAMENTO SET VLRDESCITORC = VLRDESCITORC -old.VLRDESCITORC + new.VLRDESCITORC,
           VLRPRODORC = VLRPRODORC - old.VLRPRODITORC + new.VLRPRODITORC,
           VLRLIQORC = VLRLIQORC - old.VLRLIQITORC + new.VLRLIQITORC
           WHERE CODORC=new.CODORC AND TIPOORC='O'
           AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
  END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITORCAMENTOTGBI" FOR "VDITORCAMENTO"
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE sRefProd CHAR(13);
BEGIN
  IF (new.VLRDESCITORC IS NULL) THEN new.VLRDESCITORC = 0;
  IF (new.VLRLIQITORC IS NULL) THEN new.VLRLIQITORC = 0;
  IF (new.VLRLIQITORC = 0) THEN
      new.VLRLIQITORC = (new.QTDITORC * new.PRECOITORC) - new.VLRDESCITORC;
  new.TIPOORC = 'O';
  SELECT P.REFPROD FROM EQPRODUTO P
         WHERE P.CODPROD=new.CODPROD AND P.CODEMP=new.CODEMPPD
         AND P.CODFILIAL = new.CODFILIALPD
         INTO sRefProd;
  IF (new.REFPROD IS NULL) THEN new.REFPROD = sRefProd;
  UPDATE VDORCAMENTO SET VLRDESCITORC = VLRDESCITORC + new.VLRDESCITORC,
         VLRPRODORC = VLRPRODORC + new.VLRPRODITORC,
         VLRLIQORC = VLRLIQORC + new.VLRLIQITORC
         WHERE CODORC=new.CODORC AND TIPOORC=new.TIPOORC
         AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITORCAMENTOTGBU" FOR "VDITORCAMENTO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  IF ( new.EMMANUT IS NULL) THEN
      new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN

    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);
    IF (new.VLRPRODITORC IS NULL) THEN new.VLRPRODITORC = 0;
    IF (new.VLRDESCITORC IS NULL) THEN new.VLRDESCITORC = 0;
    IF (new.VLRLIQITORC IS NULL) THEN new.VLRLIQITORC = 0;
  END

end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDITROMANEIO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODROMA" INTEGER NOT NULL,
"CODITROMA" INTEGER NOT NULL,
"CODEMPVA" INTEGER NOT NULL,
"CODFILIALVA" SMALLINT NOT NULL,
"TIPOVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'V' NOT NULL,
"CODVENDA" INTEGER NOT NULL,
"DTPREVITROMA" DATE NOT NULL,
"FLAG" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITROMANEIOTGBU" FOR "VDITROMANEIO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDITVENDA"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"TIPOVENDA" CHAR(1) CHARACTER SET NONE DEFAULT 'V' NOT NULL,
"CODVENDA" INTEGER NOT NULL,
"CODITVENDA" INTEGER NOT NULL,
"CODEMPNT" INTEGER NOT NULL,
"CODFILIALNT" SMALLINT NOT NULL,
"CODNAT" CHAR(4) CHARACTER SET NONE NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODEMPLE" INTEGER,
"CODFILIALLE" SMALLINT,
"CODLOTE" CHAR(13) CHARACTER SET NONE,
"CODEMPAX" INTEGER NOT NULL,
"CODFILIALAX" SMALLINT NOT NULL,
"CODALMOX" INTEGER NOT NULL,
"QTDITVENDA" "NUMERICDN" NOT NULL,
"PRECOITVENDA" "NUMERICDN" NOT NULL,
"PERCDESCITVENDA" NUMERIC(9,2),
"VLRDESCITVENDA" "NUMERICDN",
"PERCICMSITVENDA" NUMERIC(9,2),
"VLRBASEICMSITVENDA" "NUMERICDN",
"VLRICMSITVENDA" "NUMERICDN",
"PERCIPIITVENDA" NUMERIC(9,2),
"VLRBASEIPIITVENDA" "NUMERICDN",
"VLRIPIITVENDA" "NUMERICDN",
"VLRLIQITVENDA" "NUMERICDN",
"PERCCOMISITVENDA" NUMERIC(9,2),
"VLRCOMISITVENDA" "NUMERICDN",
"VLRADICITVENDA" "NUMERICDN",
"PERCISSITVENDA" NUMERIC(9,2),
"VLRISSITVENDA" "NUMERICDN",
"VLRFRETEITVENDA" "NUMERICDN",
"VLRPRODITVENDA" "NUMERICDN",
"VLRISENTASITVENDA" "NUMERICDN",
"VLROUTRASITVENDA" "NUMERICDN",
"REFPROD" CHAR(13) CHARACTER SET NONE,
"VLRBASEISSITVENDA" "NUMERICDN" DEFAULT 0,
"OBSITVENDA" VARCHAR(502) CHARACTER SET NONE,
"ORIGFISC" CHAR(1) CHARACTER SET NONE,
"CODEMPTT" INTEGER,
"CODFILIALTT" INTEGER,
"CODTRATTRIB" CHAR(2) CHARACTER SET NONE,
"TIPOFISC" CHAR(2) CHARACTER SET NONE,
"CODEMPME" INTEGER,
"CODFILIALME" SMALLINT,
"CODMENS" INTEGER,
"STRDESCITVENDA" CHAR(50) CHARACTER SET NONE,
"QTDDEVITVENDA" "NUMERICDN" DEFAULT 0,
"CODEMPLG" INTEGER,
"CODFILIALLG" SMALLINT,
"CODLOG" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"EMMANUT" CHAR(1) CHARACTER SET NONE DEFAULT 'N',
"CANCITVENDA" CHAR(1) CHARACTER SET NONE,
"CODEMPPE" INTEGER,
"CODFILIALPE" SMALLINT,
"CODPE" INTEGER,
"DIASPE" SMALLINT,
"CODEMPCV" INTEGER,
"CODFILIALCV" SMALLINT,
"CODCONV" INTEGER);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITVENDATGAD" FOR "VDITVENDA"
ACTIVE AFTER DELETE POSITION 0 
AS
  DECLARE VARIABLE DDTVENDA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCVENDA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
BEGIN
  IF ( not ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) THEN
  BEGIN
      UPDATE VDVENDA SET
         VLRPRODVENDA = VLRPRODVENDA - old.VLRPRODITVENDA,
         VLRBASEICMSVENDA = VLRBASEICMSVENDA - old.VLRBASEICMSITVENDA,
         VLRICMSVENDA = VLRICMSVENDA -old.VLRICMSITVENDA,
         VLRISENTASVENDA = VLRISENTASVENDA - old.VLRISENTASITVENDA,
         VLROUTRASVENDA = VLROUTRASVENDA - old.VLROUTRASITVENDA,
         VLRBASEIPIVENDA = VLRBASEIPIVENDA - old.VLRBASEIPIITVENDA,
         VLRIPIVENDA = VLRIPIVENDA - old.VLRIPIITVENDA,
         VLRLIQVENDA = VLRLIQVENDA - old.VLRLIQITVENDA,
         VLRCOMISVENDA = VLRCOMISVENDA - old.VLRCOMISITVENDA,
         VLRBASEISSVENDA = VLRBASEISSVENDA - old.VLRBASEISSITVENDA,
         VLRISSVENDA = VLRISSVENDA - old.VLRISSITVENDA,
         VLRDESCITVENDA = VLRDESCITVENDA - old.VLRDESCITVENDA
         WHERE CODVENDA=old.CODVENDA AND TIPOVENDA=old.TIPOVENDA AND
         CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
      SELECT V.DTEMITVENDA, V.FLAG, V.DOCVENDA,
          V.CODEMPTM, V.CODFILIALTM, V.CODTIPOMOV
       FROM VDVENDA V  WHERE V.CODVENDA = old.CODVENDA AND
          V.CODEMP=old.CODEMP AND V.CODFILIAL = old.CODFILIAL AND
          V.TIPOVENDA=old.TIPOVENDA
      INTO :DDTVENDA, :CFLAG, :IDOCVENDA, :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV;
      EXECUTE PROCEDURE EQMOVPRODIUDSP('D', old.CODEMPPD, old.CODFILIALPD,
         old.CODPROD, old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
         :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV, null, null, null,
         null, null, null, null,
         old.CODEMP, old.CODFILIAL, old.TIPOVENDA, old.CODVENDA, old.CODITVENDA,
          null, null, null, null,null,null, null, null,
         old.CODEMPNT, old.CODFILIALNT, old.CODNAT, :DDTVENDA,
         :IDOCVENDA, :CFLAG, old.QTDITVENDA, old.PRECOITVENDA,
         old.CODEMPAX, old.CODFILIALAX, old.CODALMOX);
  END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITVENDATGAI" FOR "VDITVENDA"
ACTIVE AFTER INSERT POSITION 0 
AS
  DECLARE VARIABLE DDTVENDA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE CFISCALTIPOMOV CHAR(1);
  DECLARE VARIABLE IDOCVENDA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
  DECLARE VARIABLE NPRECO NUMERIC(15, 5);
BEGIN
  SELECT VD.DTEMITVENDA, VD.FLAG, VD.DOCVENDA,
      VD.CODEMPTM, VD.CODFILIALTM, VD.CODTIPOMOV, TM.FISCALTIPOMOV
    FROM EQTIPOMOV TM, VDVENDA VD WHERE
      TM.CODTIPOMOV=VD.CODTIPOMOV AND TM.CODFILIAL=VD.CODFILIALTM AND TM.CODEMP=VD.CODEMPTM
      AND VD.TIPOVENDA=new.TIPOVENDA AND VD.CODVENDA=new.CODVENDA AND VD.CODFILIAL=new.CODFILIAL
      AND VD.CODEMP=new.CODEMP
    INTO :DDTVENDA, :CFLAG, :IDOCVENDA, :ICODEMPTM,
      :SCODFILIALTM, :ICODTIPOMOV,:CFISCALTIPOMOV;
  IF (CFISCALTIPOMOV = 'S') THEN
  BEGIN
    IF (new.CODTRATTRIB IS NULL) THEN
      SELECT CF.ORIGFISC,CF.CODEMPTT,CF.CODFILIALTT,CF.CODTRATTRIB FROM
        LFCLFISCAL CF, EQPRODUTO P WHERE P.CODEMP=new.CODEMPPD AND
        P.CODFILIAL=new.CODFILIALPD AND P.CODPROD=new.CODPROD AND
        CF.CODEMP = P.CODEMPFC AND CF.CODFILIAL=P.CODFILIALFC AND
        CF.CODFISC=P.CODFISC INTO new.ORIGFISC,new.CODEMPTT,new.CODFILIALTT,new.CODTRATTRIB;
  END
  IF (new.QTDITVENDA != 0 ) THEN
     NPRECO = new.VLRLIQITVENDA/new.QTDITVENDA;
  ELSE
     NPRECO = new.PRECOITVENDA;
  EXECUTE PROCEDURE EQMOVPRODIUDSP('I', new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
       new.CODEMPLE, new.CODFILIALLE, new.CODLOTE, :ICODEMPTM, :SCODFILIALTM,
       :ICODTIPOMOV, null, null, null, null, null, null, null,
       new.CODEMP, new.CODFILIAL, new.TIPOVENDA, new.CODVENDA, new.CODITVENDA,
       null, null, null, null,null,null,null, null,
       new.CODEMPNT, new.CODFILIALNT, new.CODNAT,
       :DDTVENDA, :IDOCVENDA, :CFLAG, new.QTDITVENDA, :NPRECO,
       new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITVENDATGAU" FOR "VDITVENDA"
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE DDTVENDA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCVENDA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
  DECLARE VARIABLE CSTATUS CHAR(2);
  DECLARE VARIABLE CTIPOPROD CHAR(1);
  DECLARE VARIABLE NPRECO NUMERIC(15, 5);
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) ) THEN
  BEGIN
      IF ( (new.CANCITVENDA is not null) AND (new.CANCITVENDA = 'S') ) THEN
      BEGIN
        UPDATE VDITORCAMENTO IO SET IO.EMITITORC='N'
          WHERE EXISTS (SELECT * FROM VDVENDAORC VO
            WHERE VO.CODEMP=new.CODEMP AND VO.CODFILIAL=new.CODFILIAL AND
            VO.TIPOVENDA=new.TIPOVENDA AND VO.CODVENDA=new.CODVENDA AND VO.CODITVENDA=new.CODITVENDA AND
            VO.CODEMPOR=IO.CODEMP AND VO.CODFILIALOR=IO.CODFILIAL AND
            VO.TIPOORC=IO.TIPOORC AND VO.CODORC=IO.CODORC AND VO.CODITORC=IO.CODITORC);
      END
      IF (NOT new.CODMENS = old.CODMENS) THEN
      BEGIN
        SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'LFMENSAGEM') INTO new.CODFILIALME;
        new.CODEMPME = new.CODEMP;
      END
      SELECT VD.DTEMITVENDA,VD.DOCVENDA,VD.STATUSVENDA,VD.FLAG,
             VD.CODEMPTM, VD.CODFILIALTM, VD.CODTIPOMOV
        FROM VDVENDA VD
        WHERE VD.CODVENDA = new.CODVENDA AND VD.TIPOVENDA = new.TIPOVENDA
            AND VD.CODEMP=new.CODEMP AND VD.CODFILIAL = new.CODFILIAL
        INTO :DDTVENDA, :IDOCVENDA, :CSTATUS, :CFLAG, :ICODEMPTM,
          :SCODFILIALTM, :ICODTIPOMOV;
      SELECT TIPOPROD FROM EQPRODUTO WHERE CODPROD=old.CODPROD
             AND CODEMP=old.CODEMPPD AND CODFILIAL = old.CODFILIALPD
         INTO CTIPOPROD;
      if (substr(:CSTATUS,1,1)!='C') then
      BEGIN
        UPDATE VDVENDA SET VLRDESCITVENDA = VLRDESCITVENDA -old.VLRDESCITVENDA + new.VLRDESCITVENDA,
               VLRPRODVENDA = VLRPRODVENDA - old.VLRPRODITVENDA + new.VLRPRODITVENDA,
               VLRBASEICMSVENDA = VLRBASEICMSVENDA - old.VLRBASEICMSITVENDA + new.VLRBASEICMSITVENDA,
               VLRICMSVENDA = VLRICMSVENDA -old.VLRICMSITVENDA + new.VLRICMSITVENDA,
               VLRISENTASVENDA = VLRISENTASVENDA - old.VLRISENTASITVENDA + new.VLRISENTASITVENDA,
               VLROUTRASVENDA = VLROUTRASVENDA - old.VLROUTRASITVENDA + new.VLROUTRASITVENDA,
               VLRBASEIPIVENDA = VLRBASEIPIVENDA - old.VLRBASEIPIITVENDA + new.VLRBASEIPIITVENDA,
               VLRIPIVENDA = VLRIPIVENDA - old.VLRIPIITVENDA + new.VLRIPIITVENDA,
               VLRLIQVENDA = VLRLIQVENDA - old.VLRLIQITVENDA + new.VLRLIQITVENDA,
               VLRCOMISVENDA = VLRCOMISVENDA - old.VLRCOMISITVENDA + new.VLRCOMISITVENDA,
               VLRBASEISSVENDA = VLRBASEISSVENDA - old.VLRBASEISSITVENDA + new.VLRBASEISSITVENDA,
               VLRISSVENDA = VLRISSVENDA - old.VLRISSITVENDA + new.VLRISSITVENDA
               WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA
               AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
        IF (SUBSTR(CSTATUS,1,1) = 'P') THEN
          CSTATUS = 'PV';
        ELSE IF (SUBSTR(CSTATUS,1,1) = 'V') THEN
          CSTATUS = 'VD';
      END
      IF (new.QTDITVENDA = 0) THEN
         NPRECO = new.PRECOITVENDA;
      ELSE
         NPRECO = new.VLRLIQITVENDA/new.QTDITVENDA;
      EXECUTE PROCEDURE EQMOVPRODIUDSP('U',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
        new.CODEMPLE, new.CODFILIALLE, new.CODLOTE, :ICODEMPTM,
        :SCODFILIALTM, :ICODTIPOMOV, null, null, null ,null, null,
        null, null, new.CODEMP, new.CODFILIAL, new.TIPOVENDA, new.CODVENDA,
        new.CODITVENDA, null, null, null, null,null,null,null, null,
        new.CODEMPNT, new.CODFILIALNT,
        new.CODNAT, :DDTVENDA, :IDOCVENDA, :CFLAG, new.QTDITVENDA, :NPRECO,
        new.CODEMPAX, new.CODFILIALAX, new.CODALMOX);
   END
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDVENDAORC"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" INTEGER NOT NULL,
"TIPOVENDA" CHAR(1) CHARACTER SET NONE NOT NULL,
"CODVENDA" INTEGER NOT NULL,
"CODITVENDA" INTEGER NOT NULL,
"CODEMPOR" INTEGER NOT NULL,
"CODFILIALOR" INTEGER NOT NULL,
"TIPOORC" CHAR(1) CHARACTER SET NONE NOT NULL,
"CODORC" INTEGER NOT NULL,
"CODITORC" INTEGER NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITVENDATGBD" FOR "VDITVENDA"
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  DELETE FROM VDVENDAORC WHERE CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL
    AND TIPOVENDA=old.TIPOVENDA AND CODVENDA=old.CODVENDA AND CODITVENDA=old.CODITVENDA;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITVENDATGBI" FOR "VDITVENDA"
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE sRefProd CHAR(13);
  DECLARE VARIABLE sTipoProd CHAR(1);
  DECLARE VARIABLE IFILIALPREF INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO IFILIALPREF;
  IF (new.VLRDESCITVENDA IS NULL) THEN new.VLRDESCITVENDA = 0;
  IF (new.VLRBASEICMSITVENDA IS NULL) THEN new.VLRBASEICMSITVENDA = 0;
  IF (new.VLRICMSITVENDA IS NULL) THEN new.VLRICMSITVENDA = 0;
  IF (new.VLRBASEIPIITVENDA IS NULL) THEN new.VLRBASEIPIITVENDA = 0;
  IF (new.VLRIPIITVENDA IS NULL) THEN new.VLRIPIITVENDA = 0;
  IF (new.VLRLIQITVENDA IS NULL) THEN new.VLRLIQITVENDA = 0;
  IF (new.VLRCOMISITVENDA IS NULL) THEN new.VLRCOMISITVENDA = 0;
  IF (new.VLRADICITVENDA IS NULL) THEN new.VLRADICITVENDA = 0;
  IF (new.VLRISSITVENDA IS NULL) THEN new.VLRISSITVENDA = 0;
  IF (new.VLRFRETEITVENDA IS NULL) THEN new.VLRFRETEITVENDA = 0;
  IF (new.TIPOVENDA IS NULL) THEN new.TIPOVENDA = 'V';
  IF (new.VLRLIQITVENDA = 0) THEN
      new.VLRLIQITVENDA = (new.QTDITVENDA * new.PRECOITVENDA) +
         new.VLRADICITVENDA + new.VLRFRETEITVENDA - new.VLRDESCITVENDA;
  IF (new.CODALMOX IS NULL) THEN
       SELECT CODEMPAX,CODFILIALAX,CODALMOX FROM EQPRODUTO WHERE
          CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD AND
          CODPROD=new.CODPROD
       INTO new.CODEMPAX, new.CODFILIALAX,new.CODALMOX;
  IF (NOT new.CODMENS IS NULL) THEN
    SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'LFMENSAGEM') INTO new.CODFILIALME;
     new.CODEMPME = new.CODEMP;
  SELECT P.REFPROD,P.TIPOPROD FROM LFCLFISCAL F, EQPRODUTO P
         WHERE P.CODPROD=new.CODPROD AND F.CODFISC = P.CODFISC
         AND F.CODEMP = P.CODEMPFC AND F.CODFILIAL = P.CODFILIALFC
         AND P.CODEMP=new.CODEMPPD AND P.CODFILIAL = new.CODFILIALPD
         INTO sRefProd,sTipoProd;
  IF (new.REFPROD IS NULL) THEN new.REFPROD = sRefProd;
  IF (sTipoProd = 'S') THEN
  BEGIN
    SELECT PERCISSEMP FROM SGEMPRESA WHERE
      CODEMP=new.CODEMP INTO new.PERCISSITVENDA;
    IF (new.PERCISSITVENDA != 0) THEN
    BEGIN
      new.VLRBASEISSITVENDA = new.VLRLIQITVENDA;
      new.VLRISSITVENDA = new.VLRBASEISSITVENDA*(new.PERCISSITVENDA/100);
    END
  END
  ELSE
    new.VLRBASEISSITVENDA = 0;
  IF (new.TIPOFISC = 'II') THEN
  BEGIN
    new.VLRISENTASITVENDA = new.VLRLIQITVENDA;
    new.VLRBASEICMSITVENDA = 0;
    new.PERCICMSITVENDA = 0;
    new.VLRICMSITVENDA = 0;
    new.VLROUTRASITVENDA = 0;
  END
  ELSE IF (new.TIPOFISC = 'FF') THEN
  BEGIN
    new.VLROUTRASITVENDA = new.VLRLIQITVENDA;
    new.VLRBASEICMSITVENDA = 0;
    new.PERCICMSITVENDA = 0;
    new.VLRICMSITVENDA = 0;
    new.VLRISENTASITVENDA = 0;
  END
  ELSE IF (new.TIPOFISC = 'NN') THEN
  BEGIN
    new.VLROUTRASITVENDA = new.VLRLIQITVENDA;
    new.VLRBASEICMSITVENDA = 0;
    new.PERCICMSITVENDA = 0;
    new.VLRICMSITVENDA = 0;
    new.VLRISENTASITVENDA = 0;
  END
  ELSE IF (new.TIPOFISC = 'TT') THEN
  BEGIN
    new.VLROUTRASITVENDA = 0;
    new.VLRISENTASITVENDA = 0;
  END
  UPDATE VDVENDA SET VLRDESCITVENDA = VLRDESCITVENDA + new.VLRDESCITVENDA,
         VLRPRODVENDA = VLRPRODVENDA + new.VLRPRODITVENDA,
         VLRBASEICMSVENDA = VLRBASEICMSVENDA + new.VLRBASEICMSITVENDA,
         VLRICMSVENDA = VLRICMSVENDA + new.VLRICMSITVENDA,
         VLRISENTASVENDA = VLRISENTASVENDA + new.VLRISENTASITVENDA,
         VLROUTRASVENDA = VLROUTRASVENDA + new.VLROUTRASITVENDA,
         VLRBASEIPIVENDA = VLRBASEIPIVENDA + new.VLRBASEIPIITVENDA,
         VLRIPIVENDA = VLRIPIVENDA + new.VLRIPIITVENDA,
         VLRLIQVENDA = VLRLIQVENDA + new.VLRLIQITVENDA,
         VLRBASEISSVENDA = VLRBASEISSVENDA + new.VLRBASEISSITVENDA,
         VLRISSVENDA = VLRISSVENDA + new.VLRISSITVENDA,
         VLRCOMISVENDA = VLRCOMISVENDA + new.VLRCOMISITVENDA
         WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA
         AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDITVENDATGBU" FOR "VDITVENDA"
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE sTipoFisc CHAR(2);
  DECLARE VARIABLE sRefProd CHAR(13);
  DECLARE VARIABLE sTipoProd CHAR(1);
  declare variable iCodFilialPref SMALLINT;
  DECLARE VARIABLE NTMP NUMERIC(15, 5);
BEGIN
  IF ( new.EMMANUT IS NULL) THEN
      new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      SELECT ICODFILIAL FROM sgretfilial(new.CODEMP, 'SGPREFERE1') INTO :iCodFilialPref;
      IF (new.CODPROD != old.CODPROD) THEN
        EXCEPTION VDITVENDAEX01;
      IF (new.CODLOTE != old.CODLOTE) THEN
        EXCEPTION VDITVENDAEX02;

      IF (new.CODALMOX IS NULL) THEN
         SELECT CODEMPAX,CODFILIALAX,CODALMOX FROM EQPRODUTO WHERE
          CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD AND
          CODPROD=new.CODPROD
         INTO new.CODEMPAX, new.CODFILIALAX,new.CODALMOX;

      IF (old.CODALMOX IS NOT NULL) THEN
      BEGIN
         IF (old.CODALMOX!=new.CODALMOX) THEN
            EXCEPTION EQALMOX01;
      END
      SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
             AND CODEMP=new.CODEMPPD AND CODFILIAL = new.codfilialpd INTO sRefProd;
      IF (new.REFPROD IS NULL) THEN new.REFPROD = sRefProd;
      SELECT F.TIPOFISC,P.TIPOPROD FROM LFCLFISCAL F, EQPRODUTO P WHERE P.CODPROD=new.CODPROD
             AND F.CODFISC = P.CODFISC AND F.CODEMP=new.codemp AND F.CODFILIAL = P.CODFILIALFC
             AND P.CODEMP=new.CODEMP AND P.CODFILIAL = new.codfilialpd
             INTO :sTipoFisc,:sTipoProd;

      IF ( (new.CANCITVENDA is not null) AND (new.CANCITVENDA = 'S') ) THEN
      BEGIN
          new.QTDITVENDA = 0;
          new.VLRLIQITVENDA = 0;
          new.VLRPRODITVENDA = 0;
          new.VLRBASEICMSITVENDA = 0;
          new.VLRBASEIPIITVENDA = 0;
          new.VLRDESCITVENDA = 0;
      END

    /****
      Desconto:
    ****/
      IF ( (new.VLRLIQITVENDA = 0) AND ( (new.CANCITVENDA IS NULL) OR (new.CANCITVENDA!='S') ) ) THEN
          new.VLRLIQITVENDA = (new.QTDITVENDA * new.PRECOITVENDA) +
             new.VLRADICITVENDA + new.VLRFRETEITVENDA - new.VLRDESCITVENDA;
      ELSE IF (new.VLRDESCITVENDA > 0 AND new.QTDITVENDA > 0) THEN
      BEGIN
        NTMP = new.VLRLIQITVENDA/new.QTDITVENDA;
        NTMP = NTMP * new.QTDITVENDA;
        new.VLRDESCITVENDA = new.VLRDESCITVENDA + (new.VLRLIQITVENDA-NTMP);
        new.VLRLIQITVENDA = new.VLRLIQITVENDA - old.VLRDESCITVENDA + new.VLRDESCITVENDA;
      END
      IF (sTipoProd = 'S') THEN
      BEGIN
        SELECT PERCISSEMP FROM SGEMPRESA WHERE CODEMP=new.CODEMP INTO new.PERCISSITVENDA;
        IF (new.PERCISSITVENDA != 0) THEN
        BEGIN
          new.VLRBASEISSITVENDA = new.VLRLIQITVENDA;
          new.VLRISSITVENDA = new.VLRBASEISSITVENDA*(new.PERCISSITVENDA/100);
        END
      END
      ELSE
        new.VLRBASEISSITVENDA = 0;
      IF (sTipoFisc = 'II') THEN
      BEGIN
        new.VLRISENTASITVENDA = new.VLRLIQITVENDA;
        new.VLRBASEICMSITVENDA = 0;
        new.PERCICMSITVENDA = 0;
        new.VLRICMSITVENDA = 0;
        new.VLROUTRASITVENDA = 0;
      END
      ELSE IF (sTipoFisc = 'FF') THEN
      BEGIN
        new.VLROUTRASITVENDA = new.VLRLIQITVENDA;
        new.VLRBASEICMSITVENDA = 0;
        new.PERCICMSITVENDA = 0;
        new.VLRICMSITVENDA = 0;
        new.VLRISENTASITVENDA = 0;
      END
      ELSE IF (sTipoFisc = 'NN') THEN
      BEGIN
        new.VLROUTRASITVENDA = new.VLRLIQITVENDA;
        new.VLRBASEICMSITVENDA = 0;
        new.PERCICMSITVENDA = 0;
        new.VLRICMSITVENDA = 0;
        new.VLRISENTASITVENDA = 0;
      END
      ELSE IF (sTipoFisc = 'TT') THEN
      BEGIN
        new.VLROUTRASITVENDA = 0;
        new.VLRISENTASITVENDA = 0;
      END
   END
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDKIT"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODKIT" INTEGER NOT NULL,
"CODEMPPD" INTEGER NOT NULL,
"CODFILIALPD" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"REFPROD" CHAR(13) CHARACTER SET NONE NOT NULL,
"QTDKIT" "NUMERICDN" DEFAULT 0 NOT NULL,
"PRECOKIT" "NUMERICDN" DEFAULT 0 NOT NULL,
"VLRTOTKIT" "NUMERICDN" DEFAULT 0 NOT NULL,
"DTINS" DATE,
"HINS" TIME,
"IDUSUINS" CHAR(8) CHARACTER SET NONE,
"DTALT" DATE,
"HALT" TIME,
"IDUSUALT" CHAR(8) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDKITTGBI" FOR "VDKIT"
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
  /* Trigger text */
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDKITTGBU" FOR "VDKIT"
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
  /* Trigger text */
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDSTATUSORC"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"TIPOORC" CHAR(1) CHARACTER SET NONE NOT NULL,
"CODORC" INTEGER NOT NULL,
"CODEMPTB" INTEGER NOT NULL,
"CODFILIALTB" SMALLINT NOT NULL,
"CODTB" SMALLINT NOT NULL,
"CODITTB" SMALLINT NOT NULL,
"DTASTORC" DATE DEFAULT 'today' NOT NULL,
"HORASTORC" TIME DEFAULT 'now' NOT NULL,
"MOTIVOSTORC" VARCHAR(10000) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDORCAMENTOTGAI" FOR "VDORCAMENTO"
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE iCodFilialTb SMALLINT;
DECLARE VARIABLE iCodFilialSt SMALLINT;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'VDSTATUSORC') INTO :iCodFilialSt;
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGTABELA') INTO :iCodFilialTb;
  INSERT INTO VDSTATUSORC (CODEMP,CODFILIAL,TIPOORC,CODORC,CODEMPTB,CODFILIALTB,CODTB,CODITTB,MOTIVOSTORC)
     SELECT new.CODEMP, new.CODFILIAL, new.TIPOORC, new.CODORC, new.CODEMP,
         :iCodFilialTb, OTB.CODTB, ITB.CODITTB,'SITUAÇÃO INICIAL'
      FROM SGOBJETOTB OTB,SGITTABELA ITB WHERE OTB.CODEMP=new.CODEMP AND OTB.CODFILIALTB=:iCodFilialTb AND
        OTB.IDOBJ='VDSTATUSORC' AND ITB.CODEMP=new.CODEMP AND ITB.CODFILIAL=OTB.CODFILIALTB AND
        ITB.CODTB=OTB.CODTB AND ITB.PADRAOITTB='S';
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDORCAMENTOTGBD" FOR "VDORCAMENTO"
ACTIVE BEFORE DELETE POSITION 0 
as
begin
  DELETE FROM atatendimentoorc WHERE CODORC=old.CODORC
    AND CODFILIAL=old.CODFILIAL AND CODEMP=old.CODEMP;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "VDCLIENTEATIVOSP"("ICODEMP" INTEGER,
"SCODFILIAL" SMALLINT,
"ICODCLI" INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDORCAMENTOTGBI" FOR "VDORCAMENTO"
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  IF (new.VLRPRODORC IS NULL) THEN new.VLRPRODORC = 0;
  IF (new.VLRDESCORC IS NULL) THEN new.VLRDESCORC = 0;
  IF (new.VLRADICORC IS NULL) THEN new.VLRADICORC = 0;
  IF (new.VLRDESCITORC IS NULL) THEN new.VLRDESCITORC = 0;
  IF (new.VLRLIQORC IS NULL) THEN new.VLRLIQORC = 0;
  IF (new.CODCONV IS NOT NULL AND new.CODCLI IS NULL) THEN
  BEGIN
       SELECT CODCLI,CODEMPCL,CODFILIALCL,CODTPCONV,CODFILIALTC,CODEMPTC FROM ATCONVENIADO
          WHERE CODEMP=new.CODEMPCV AND CODFILIAL=new.CODFILIALCV
          AND CODCONV=new.CODCONV INTO new.CODCLI,new.CODEMPCL,new.CODFILIALCL,
          new.CODTPCONV,new.CODFILIALTC,new.CODEMPTC;
  END
  EXECUTE PROCEDURE VDCLIENTEATIVOSP(new.CODEMPCL, new.CODFILIALCL, new.CODCLI);
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDORCAMENTOTGBU" FOR "VDORCAMENTO"
ACTIVE BEFORE UPDATE POSITION 0 
AS
DECLARE VARIABLE ICODATENDO INTEGER;
DECLARE VARIABLE ICODSETOR INTEGER;
DECLARE VARIABLE IFILIALPREF INTEGER;
DECLARE VARIABLE IFILIALUSU INTEGER;
BEGIN
  if (new.EMMANUT is null) then
     new.EMMANUT = 'N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  begin
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      SELECT CODCLI,CODEMPCL,CODFILIALCL,CODTPCONV,CODFILIALTC,CODEMPTC FROM ATCONVENIADO
            WHERE CODEMP=new.CODEMPCV AND CODFILIAL=new.CODFILIALCV
            AND CODCONV=new.CODCONV INTO new.CODCLI,new.CODEMPCL,new.CODFILIALCL,
            new.CODTPCONV,new.CODFILIALTC,new.CODEMPTC;
      IF (NOT new.CODCONV = old.CODCONV) THEN
      BEGIN
        SELECT CODCLI,CODEMPCL,CODFILIALCL FROM ATCONVENIADO
          WHERE CODEMP=new.CODEMPCV AND CODFILIAL=new.CODFILIALCV
           AND CODCONV=new.CODCONV INTO new.CODCLI,new.CODEMPCL,new.CODFILIALCL;
      END
      IF (old.STATUSORC = 'OA' AND new.STATUSORC = 'OC') THEN
      BEGIN
        SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE2') INTO IFILIALPREF;
        SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGUSUARIO') INTO IFILIALUSU;
        SELECT CODSETAT2,CODTPATENDO3 FROM SGPREFERE2
          WHERE CODEMP=new.CODEMP AND CODFILIAL=:IFILIALPREF
          INTO ICODSETOR,ICODATENDO;
        EXECUTE PROCEDURE ATADICATENDIMENTOSP(
          new.CODCONV,:ICODATENDO,new.CODATEND,
          ICODSETOR,NULL,new.CODEMP,:IFILIALUSU,new.CODORC
        );
      END

      EXECUTE PROCEDURE VDCLIENTEATIVOSP(new.CODEMPCL, new.CODFILIALCL, new.CODCLI);

      IF (new.VLRDESCORC IS NULL) THEN
        new.VLRDESCORC = 0;

      new.VLRDESCORC = new.VLRDESCORC - old.VLRDESCITORC;
      new.VLRDESCORC = new.VLRDESCORC + new.VLRDESCITORC;

      new.VLRLIQORC = new.VLRPRODORC - new.VLRDESCORC + new.VLRADICORC;
  END
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDPRECOPROD"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODPROD" INTEGER NOT NULL,
"CODPRECOPROD" INTEGER NOT NULL,
"CODEMPTB" INTEGER NOT NULL,
"CODFILIALTB" SMALLINT NOT NULL,
"CODTAB" INTEGER NOT NULL,
"CODEMPCC" INTEGER,
"CODFILIALCC" SMALLINT,
"CODCLASCLI" INTEGER,
"CODEMPPG" INTEGER NOT NULL,
"CODFILIALPG" SMALLINT NOT NULL,
"CODPLANOPAG" INTEGER NOT NULL,
"PRECOPROD" "NUMERICDN" NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDPRECOPRODTGBU" FOR "VDPRECOPROD"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDROMANEIO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODROMA" INTEGER NOT NULL,
"DATAROMA" DATE NOT NULL,
"DTSAIDAROMA" DATE NOT NULL,
"DTPREVROMA" DATE NOT NULL,
"DTENTREGAROMA" DATE,
"STATUSROMA" CHAR(2) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDROMANEIOTGBU" FOR "VDROMANEIO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDSETOR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODSETOR" INTEGER NOT NULL,
"DESCSETOR" CHAR(40) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now' NOT NULL,
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDSETORTGBU" FOR "VDSETOR"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDSTATUSORCTGBU" FOR "VDSTATUSORC"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDTABPRECO"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTAB" INTEGER NOT NULL,
"DESCTAB" CHAR(40) CHARACTER SET NONE NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now');
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDTABPRECOTGBU" FOR "VDTABPRECO"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDTIPOCLI"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTIPOCLI" INTEGER NOT NULL,
"DESCTIPOCLI" CHAR(40) CHARACTER SET NONE NOT NULL,
"CHEQTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"FISTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"JURTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"FILTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"LOCTRABTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"REFCOMLTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"BANCTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"REFPESTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"CONJTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"VEICTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"IMOVTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"TERRATIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"PESAUTCPTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"AVALTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"SOCIOTIPOCLI" CHAR(1) CHARACTER SET NONE DEFAULT 'N' NOT NULL,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"SIGLATIPOCLI" CHAR(3) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDTIPOCLITGBU" FOR "VDTIPOCLI"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDTRANSP"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODTRAN" INTEGER NOT NULL,
"RAZTRAN" CHAR(50) CHARACTER SET NONE NOT NULL,
"NOMETRAN" CHAR(40) CHARACTER SET NONE NOT NULL,
"CNPJTRAN" CHAR(14) CHARACTER SET NONE,
"CPFTRAN" CHAR(11) CHARACTER SET NONE,
"INSCTRAN" CHAR(15) CHARACTER SET NONE,
"ENDTRAN" CHAR(50) CHARACTER SET NONE,
"NUMTRAN" INTEGER,
"COMPLTRAN" CHAR(20) CHARACTER SET NONE,
"BAIRTRAN" CHAR(30) CHARACTER SET NONE,
"CIDTRAN" CHAR(30) CHARACTER SET NONE,
"CEPTRAN" CHAR(8) CHARACTER SET NONE,
"FONETRAN" CHAR(12) CHARACTER SET NONE,
"FAXTRAN" CHAR(8) CHARACTER SET NONE,
"UFTRAN" CHAR(2) CHARACTER SET NONE,
"TIPOTRAN" CHAR(1) CHARACTER SET NONE DEFAULT 'T',
"CELTRAN" CHAR(8) CHARACTER SET NONE,
"CONTTRAN" CHAR(40) CHARACTER SET NONE,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"DDDFONETRAN" CHAR(4) CHARACTER SET NONE,
"DDDFAXTRAN" CHAR(4) CHARACTER SET NONE,
"DDDCELTRAN" CHAR(4) CHARACTER SET NONE);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDTRANSPTGBU" FOR "VDTRANSP"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDVENDAORCTGAD" FOR "VDVENDAORC"
ACTIVE AFTER DELETE POSITION 0 
AS
begin
  UPDATE VDITORCAMENTO SET EMITITORC='N'
    WHERE CODEMP=old.CODEMPOR AND CODFILIAL=old.CODFILIALOR AND
       TIPOORC=old.TIPOORC AND CODORC=old.CODORC AND CODITORC=old.CODITORC;
  UPDATE VDORCAMENTO SET STATUSORC='OL'
    WHERE CODEMP=old.CODEMPOR AND CODFILIAL=old.CODFILIALOR AND
       TIPOORC=old.TIPOORC AND CODORC=old.CODORC;
end
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "FNADICRECEBERSP01"("CTIPOVENDA" CHAR(1) CHARACTER SET NONE,
"ICODVENDA" INTEGER,
"ICODEMPTC" INTEGER,
"ICODFILIALTC" INTEGER,
"CODTIPOCOB" INTEGER,
"ICODEMPPG" INTEGER,
"ICODFILIALPG" SMALLINT,
"CODPLANOPAG" INTEGER,
"ICODEMPCL" INTEGER,
"ICODFILIALCL" SMALLINT,
"CODCLI" INTEGER,
"ICODEMPVD" INTEGER,
"ICODFILIALVD" SMALLINT,
"CODVEND" INTEGER,
"VLRLIQVENDA" NUMERIC(15,5),
"DTSAIDAVENDA" DATE,
"VLRCOMISVENDA" NUMERIC(15,5),
"DOCVENDA" INTEGER,
"ICODEMPBO" INTEGER,
"ICODFILIALBO" SMALLINT,
"CODBANCO" CHAR(3) CHARACTER SET NONE,
"ICODEMP" INTEGER,
"ICODFILIAL" SMALLINT,
"CODEMPCB" INTEGER,
"CODFILIALCB" SMALLINT,
"CODCARTCOB" CHAR(2) CHARACTER SET NONE,
"FLAG" CHAR(1) CHARACTER SET NONE)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "SGCONEXAO"("NRCONEXAO" INTEGER NOT NULL,
"CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"IDUSU" CHAR(10) CHARACTER SET NONE NOT NULL,
"CODFILIALSEL" SMALLINT NOT NULL,
"CODTERM" INTEGER,
"CONECTADO" INTEGER DEFAULT 0 NOT NULL);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDVENDATGAU" FOR "VDVENDA"
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE ICODREC INTEGER;
  DECLARE VARIABLE UFCLI CHAR(2);
  DECLARE VARIABLE UFFLAG CHAR;
  DECLARE VARIABLE ICODFILIAL SMALLINT;
  DECLARE VARIABLE SCODFILIALRC SMALLINT;
  DECLARE VARIABLE ICODITVENDA INTEGER;
  DECLARE VARIABLE ICODEMPPD INTEGER;
  DECLARE VARIABLE ICODFILIALPD SMALLINT;
  DECLARE VARIABLE ICODPROD INTEGER;
  DECLARE VARIABLE PERCRED NUMERIC(9,2);
  DECLARE VARIABLE PERCIT NUMERIC(9,2);
  DECLARE VARIABLE PERCICMSITVENDA NUMERIC(9,2);
  DECLARE VARIABLE PERCDESCITVENDA NUMERIC(9,2);
  DECLARE VARIABLE PERCIPIITVENDA NUMERIC(9,2);
  DECLARE VARIABLE TIPOFISC CHAR(2);
  DECLARE VARIABLE VLRDESCITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE VLRBASEIPIITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE VLRBASEICMSITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE VLRIPIITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE VLRPRODITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE VLRLIQITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE VLRICMSITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE TIPOMOV CHAR(2);
  DECLARE VARIABLE VLRMFINTIPOMOV CHAR(1);
  DECLARE VARIABLE VLRTMP NUMERIC(15, 5);
  DECLARE VARIABLE QTDITVENDA NUMERIC(9,2);
  DECLARE VARIABLE NVLRPARCREC NUMERIC(15, 5);
  DECLARE VARIABLE NVLRCOMIREC NUMERIC(15, 5);
  DECLARE VARIABLE SNROPARCREC SMALLINT;
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN
    /**
      ITVENDA
    **/
      SELECT CODFILIALSEL FROM SGCONEXAO WHERE NRCONEXAO=CURRENT_CONNECTION AND
          CONECTADO > 0 INTO ICODFILIAL;
    /*Informações fiscais.:*/
      SELECT C.UFCLI FROM VDCLIENTE C WHERE C.CODCLI=new.CODCLI AND
        C.CODFILIAL=new.CODFILIALCL AND C.CODEMP=new.CODEMPCL INTO UFCLI;
      UFFLAG = 'N';
      SELECT 'S' FROM SGFILIAL WHERE CODEMP=new.CODEMP
        AND CODFILIAL=:ICODFILIAL AND UFFILIAL=:UFCLI INTO UFFLAG;
      IF (NOT new.VLRDESCVENDA = old.VLRDESCVENDA) THEN
      BEGIN
    /* Distribuindo o desconto: */
        FOR SELECT CODITVENDA,CODEMPPD,CODFILIALPD,CODPROD,PERCDESCITVENDA,PERCICMSITVENDA,
          VLRDESCITVENDA,VLRLIQITVENDA,VLRPRODITVENDA,QTDITVENDA FROM VDITVENDA WHERE CODEMP=new.CODEMP AND
          CODFILIAL=new.CODFILIAL AND CODVENDA=new.CODVENDA AND TIPOVENDA=new.tipovenda INTO ICODITVENDA,ICODEMPPD,ICODFILIALPD,ICODPROD,
          PERCDESCITVENDA,PERCICMSITVENDA,VLRDESCITVENDA,VLRLIQITVENDA,VLRPRODITVENDA,QTDITVENDA DO
        BEGIN
    /* Calculo do item.: */
          PERCIT = 0;
          IF (new.VLRPRODVENDA > 0 AND NOT new.VLRDESCITVENDA > 0 AND new.VLRDESCVENDA > 0) THEN
          BEGIN
            PERCIT = (100*VLRPRODITVENDA) / new.VLRPRODVENDA;
            VLRDESCITVENDA = (new.VLRDESCVENDA  * PERCIT) / 100;
          END
    /*Busca informações fiscais.:*/
          SELECT FIRST 1 C.REDFISC,C.ALIQIPIFISC,C.TIPOFISC
            FROM EQPRODUTO P, LFCLFISCAL C, LFITREGRAFISCAL R WHERE
            P.CODPROD = :ICODPROD AND P.CODFILIAL = :ICODFILIALPD AND
            P.CODEMP = :ICODEMPPD AND C.CODFISC = P.CODFISC AND C.CODFILIAL = P.CODFILIALFC AND
            C.CODEMP = P.CODEMPFC AND R.CODREGRA = C.CODREGRA AND R.CODFILIAL = C.CODFILIALRA AND
            R.CODEMP = C.CODEMPRA AND R.CVITRF = 'V' AND R.NOUFITRF=:UFFLAG INTO
            PERCRED,PERCIPIITVENDA,TIPOFISC;
          IF (PERCRED IS NULL) THEN
            PERCRED = 0;
          IF (PERCIPIITVENDA IS NULL) THEN
            PERCIPIITVENDA = 0;
          IF (PERCICMSITVENDA IS NULL) THEN
            PERCICMSITVENDA = 0;
          VLRLIQITVENDA = VLRPRODITVENDA - VLRDESCITVENDA;
          VLRBASEIPIITVENDA = 0;
          VLRBASEICMSITVENDA = 0;
          VLRICMSITVENDA = 0;
          VLRIPIITVENDA = 0;
          IF (QTDITVENDA > 0) THEN
          BEGIN
            VLRTMP = VLRLIQITVENDA/QTDITVENDA;
            VLRDESCITVENDA = VLRPRODITVENDA - (VLRTMP*QTDITVENDA);
            VLRLIQITVENDA = VLRPRODITVENDA - VLRDESCITVENDA;
          END
          IF ( TIPOFISC = 'II') THEN
          BEGIN
            PERCICMSITVENDA = 0;
            VLRICMSITVENDA = 0;
            VLRBASEICMSITVENDA = 0;
            PERCIPIITVENDA = 0;
            VLRIPIITVENDA = 0;
            VLRBASEIPIITVENDA = 0;
          END
          ELSE IF ( TIPOFISC = 'FF') THEN
          BEGIN
            PERCICMSITVENDA = 0;
            VLRICMSITVENDA = 0;
            VLRBASEICMSITVENDA = 0;
            PERCIPIITVENDA = 0;
            VLRIPIITVENDA = 0;
            VLRBASEIPIITVENDA = 0;
          END
          ELSE IF ( TIPOFISC = 'NN') THEN
          BEGIN
            PERCICMSITVENDA = 0;
            VLRICMSITVENDA = 0;
            VLRBASEICMSITVENDA = 0;
            PERCIPIITVENDA = 0;
            VLRIPIITVENDA = 0;
            VLRBASEIPIITVENDA = 0;
          END
          ELSE IF ( TIPOFISC = 'TT') THEN
          BEGIN
            VLRBASEICMSITVENDA = VLRLIQITVENDA - (VLRPRODITVENDA*(PERCRED/100));
            VLRBASEIPIITVENDA = VLRLIQITVENDA;
            VLRICMSITVENDA = VLRBASEICMSITVENDA*(PERCICMSITVENDA/100);
            VLRIPIITVENDA = VLRBASEIPIITVENDA*(PERCIPIITVENDA/100);
          END
          UPDATE VDITVENDA SET
              VLRBASEICMSITVENDA = :VLRBASEICMSITVENDA,
              VLRBASEIPIITVENDA = :VLRBASEIPIITVENDA,
              VLRICMSITVENDA = :VLRICMSITVENDA,
              VLRIPIITVENDA = :VLRIPIITVENDA,
              VLRDESCITVENDA = :VLRDESCITVENDA,
              VLRLIQITVENDA = :VLRLIQITVENDA
          WHERE
              CODEMP=new.CODEMP AND
              CODFILIAL=new.CODFILIAL AND
              CODVENDA=new.CODVENDA AND
              CODITVENDA=:ICODITVENDA and
              TIPOVENDA=NEW.tipovenda;
        END
      END
    /**
      Financeiro:
    **/
      SELECT TIPOMOV, VLRMFINTIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
             AND CODEMP=new.CODEMPTM AND CODFILIAL=new.CODFILIALTM INTO TIPOMOV, VLRMFINTIPOMOV;
      SELECT CODREC FROM FNRECEBER WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA
             AND CODEMP=new.CODEMP AND CODFILIALVA=new.CODFILIAL INTO iCodRec;
      IF ((NOT TIPOMOV IN ('DV','TR')) AND
         ((iCodRec IS NULL) OR (
         (new.CODPLANOPAG != old.CODPLANOPAG) OR
         (new.CODCLI != old.CODCLI) OR
         (new.CODVEND != old.CODVEND) OR
         (new.VLRLIQVENDA != old.VLRLIQVENDA) OR
         (new.DTEMITVENDA != old.DTEMITVENDA) OR
         (new.DOCVENDA != old.DOCVENDA) OR
         (new.CODBANCO != old.CODBANCO)))) THEN
      BEGIN
        IF ((SUBSTR(old.STATUSVENDA,1,1) = 'P') AND (SUBSTR(new.STATUSVENDA,1,1) = 'V' )) THEN
        BEGIN
           IF (new.VLRLIQVENDA > 0) THEN
               EXECUTE PROCEDURE FNADICRECEBERSP01(
                   new.TIPOVENDA, new.CODVENDA,
                   new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
                   new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,
                   new.CODEMPCL,new.CODFILIALCL,new.CODCLI,
                   new.CODEMPVD,new.CODFILIALVD,new.CODVEND,
                   new.VLRLIQVENDA,new.DTSAIDAVENDA,new.VLRCOMISVENDA,new.DOCVENDA,
                   new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,
                   new.CODEMP,new.CODFILIAL,
                   new.CODEMPCB, new.CODFILIALCB, new.CODCARTCOB, new.FLAG);
           ELSE
               DELETE FROM FNRECEBER WHERE CODVENDA = new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND
                   CODEMP=new.CODEMP AND CODFILIALVA = new.CODFILIAL;
        END
        IF ((new.STATUSVENDA IN ('P2','V2')) AND (old.STATUSVENDA IN ('P1','V1'))) THEN
        BEGIN
           IF (new.VLRLIQVENDA > 0) THEN
               EXECUTE PROCEDURE FNADICRECEBERSP01(
                   new.TIPOVENDA, new.CODVENDA,
                   new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
                   new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,
                   new.CODEMPCL,new.CODFILIALCL,new.CODCLI,
                   new.CODEMPVD,new.CODFILIALVD,new.CODVEND,
                   new.VLRLIQVENDA,new.DTSAIDAVENDA,new.VLRCOMISVENDA,new.DOCVENDA,
                   new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,
                   new.CODEMP,new.CODFILIAL,
                   new.CODEMPCB, new.CODFILIALCB, new.CODCARTCOB, new.FLAG);
           ELSE
               DELETE FROM FNRECEBER WHERE CODVENDA = new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND
                   CODEMP=new.CODEMP AND CODFILIALVA = new.CODFILIAL;
        END
        ELSE IF ((new.STATUSVENDA IN ('P2','V2')) AND (old.STATUSVENDA IN ('P2','V2'))) THEN
        BEGIN
           IF (new.VLRLIQVENDA > 0) THEN
               EXECUTE PROCEDURE FNADICRECEBERSP01(
                   new.TIPOVENDA, new.CODVENDA,
                   new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
                   new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,
                   new.CODEMPCL,new.CODFILIALCL,new.CODCLI,
                   new.CODEMPVD,new.CODFILIALVD,new.CODVEND,
                   new.VLRLIQVENDA,new.DTSAIDAVENDA,new.VLRCOMISVENDA,new.DOCVENDA,
                   new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,
                   new.CODEMP,new.CODFILIAL,
                   new.CODEMPCB, new.CODFILIALCB, new.CODCARTCOB, new.FLAG);
           ELSE
               DELETE FROM FNRECEBER WHERE CODVENDA = new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND
                   CODEMP=new.CODEMP AND CODFILIALVA = new.CODFILIAL;
        END
        ELSE IF ((new.STATUSVENDA IN ('P3','V3')) AND (old.STATUSVENDA IN ('P3','V3'))) THEN
        BEGIN
           IF (new.VLRLIQVENDA > 0) THEN
               EXECUTE PROCEDURE FNADICRECEBERSP01(
                   new.TIPOVENDA, new.CODVENDA,
                   new.CODEMPTC, new.CODFILIALTC, new.CODTIPOCOB,
                   new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,
                   new.CODEMPCL,new.CODFILIALCL,new.CODCLI,
                   new.CODEMPVD,new.CODFILIALVD,new.CODVEND,
                   new.VLRLIQVENDA,new.DTSAIDAVENDA,new.VLRCOMISVENDA,new.DOCVENDA,
                   new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,
                   new.CODEMP,new.CODFILIAL,
                   new.CODEMPCB, new.CODFILIALCB, new.CODCARTCOB,
                   new.FLAG);
           ELSE
               DELETE FROM FNRECEBER WHERE CODVENDA = new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND
                   CODEMP=new.CODEMP AND CODFILIALVA = new.CODFILIAL;
        END
      END
      IF (old.VLRCOMISVENDA != new.VLRCOMISVENDA) THEN
      BEGIN
          UPDATE FNRECEBER SET VLRCOMIREC=new.VLRCOMISVENDA
          WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=NEW.tipovenda AND CODEMPVD=new.CODEMP AND
                CODFILIALVD=new.CODFILIAL;
      END
      ELSE IF (old.CODCLCOMIS != new.CODCLCOMIS) THEN
      BEGIN
          SELECT R.CODFILIAL,R.CODREC,R.VLRPARCREC,R.VLRCOMIREC,R.NROPARCREC
              FROM FNRECEBER R
              WHERE R.CODVENDA=new.CODVENDA AND R.TIPOVENDA=new.TIPOVENDA
              AND R.CODEMPVA=new.CODEMP AND R.CODFILIALVA=new.CODFILIAL
              INTO :SCODFILIALRC, :ICODREC, :NVLRPARCREC, :NVLRCOMIREC, :SNROPARCREC;
          EXECUTE PROCEDURE FNITRECEBERSP01(new.CODEMP,:SCODFILIALRC,:ICODREC,
                :NVLRPARCREC,:NVLRCOMIREC,:SNROPARCREC,'S');
      END
      /**
        Testa valor das parcelas x valor da venda
      **/
      IF ((old.STATUSVENDA IN ('P2','V2')) AND (new.STATUSVENDA IN ('P3','V3')) AND (VLRMFINTIPOMOV<>'S') ) THEN
      BEGIN
        SELECT VLRPARCREC FROM FNRECEBER
            WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA
            AND CODEMPVA=new.CODEMP AND CODFILIALVA = new.CODFILIAL INTO :nVlrParcRec;
        IF (new.VLRLIQVENDA != :nVlrParcRec) THEN
            EXCEPTION VDVENDAEX06;
      END
    /**
     Movimento do estoque
    **/
    /* Avisa os itens que a data de saida foi alterada */
      IF ( (new.DTSAIDAVENDA != old.DTSAIDAVENDA) OR
           (new.CODTIPOMOV!=old.CODTIPOMOV) OR
           ( new.DOCVENDA != old.DOCVENDA )  ) THEN
        UPDATE VDITVENDA SET CODITVENDA=CODITVENDA WHERE
             CODVENDA = old.CODVENDA AND TIPOVENDA = old.TIPOVENDA
             AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
      ELSE IF ((substr(new.STATUSVENDA,1,1)='C') AND (substr(old.STATUSVENDA,1,1) IN ('P','V'))) THEN
      BEGIN
        UPDATE VDITVENDA SET QTDITVENDA=0 WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND
           CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
        DELETE FROM FNRECEBER WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND
           CODEMP=new.CODEMP AND CODFILIALVA=new.CODFILIAL;
        DELETE FROM VDVENDAORC WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND
           CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA;
      END
   END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDVENDATGBD" FOR "VDVENDA"
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  IF ( not ( ( old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) THEN
  BEGIN
      if ( (old.BLOQVENDA IS NOT NULL) AND (old.BLOQVENDA='S') ) then
         EXCEPTION VDVENDAEX05 'ESTA VENDA ESTÁ BLOQUEADA!!!';
      DELETE FROM VDFRETEVD WHERE CODVENDA=old.CODVENDA  AND TIPOVENDA=old.TIPOVENDA
             AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
  END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "SGRETCAIXA" RETURNS("CODEMP" INTEGER,
"CODFILIAL" SMALLINT,
"CODTERM" INTEGER)
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE PROCEDURE "FNLIBCREDSP"("CODVENDA" INTEGER,
"CODCLI" INTEGER,
"CODEMPCL" INTEGER,
"CODFILIALCL" INTEGER,
"VLRLIB" NUMERIC(18,3))
 AS
 BEGIN EXIT; END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDVENDATGBI" FOR "VDVENDA"
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE sTipoMov CHAR(2);
BEGIN
  EXECUTE PROCEDURE VDCLIENTEATIVOSP(new.CODEMPCL, new.CODFILIALCL, new.CODCLI);
  EXECUTE PROCEDURE FNLIBCREDSP(new.CODVENDA,new.CODCLI,new.CODEMPCL,new.CODFILIALCL,null);
  IF (new.VLRPRODVENDA IS NULL) THEN new.VLRPRODVENDA = 0;
  IF (new.VLRDESCVENDA IS NULL) THEN new.VLRDESCVENDA = 0;
  IF (new.VLRDESCITVENDA IS NULL) THEN new.VLRDESCITVENDA = 0;
  IF (new.VLRVENDA IS NULL) THEN new.VLRVENDA = 0;
  IF (new.VLRBASEICMSVENDA IS NULL) THEN new.VLRBASEICMSVENDA = 0;
  IF (new.VLRICMSVENDA IS NULL) THEN new.VLRICMSVENDA = 0;
  IF (new.VLRPISVENDA IS NULL) THEN new.VLRPISVENDA = 0;
  IF (new.VLRCOFINSVENDA IS NULL) THEN new.VLRCOFINSVENDA = 0;
  IF (new.VLRIRVENDA IS NULL) THEN new.VLRIRVENDA = 0;
  IF (new.VLRCSOCIALVENDA IS NULL) THEN new.VLRCSOCIALVENDA = 0;
  IF (new.VLRISENTASVENDA IS NULL) THEN new.VLRISENTASVENDA = 0;
  IF (new.VLROUTRASVENDA IS NULL) THEN new.VLROUTRASVENDA = 0;
  IF (new.VLRBASEIPIVENDA IS NULL) THEN new.VLRBASEIPIVENDA = 0;
  IF (new.VLRIPIVENDA IS NULL) THEN new.VLRIPIVENDA = 0;
  IF (new.VLRLIQVENDA IS NULL) THEN new.VLRLIQVENDA = 0;
  IF (new.VLRCOMISVENDA IS NULL) THEN new.VLRCOMISVENDA = 0;
  IF (new.VLRFRETEVENDA IS NULL) THEN new.VLRFRETEVENDA = 0;
  IF (new.VLRADICVENDA IS NULL) THEN new.VLRADICVENDA = 0;
  IF (new.TIPOVENDA IS NULL) THEN new.TIPOVENDA = 'V';
  IF (new.VLRBASEISSVENDA IS NULL) THEN new.VLRBASEISSVENDA = 0;
  IF (new.VLRISSVENDA IS NULL) THEN new.VLRISSVENDA = 0;
  IF (new.VLRPISVENDA IS NULL) THEN new.VLRPISVENDA = 0;
  IF (new.VLRCOFINSVENDA IS NULL) THEN new.VLRCOFINSVENDA = 0;
  IF (new.VLRIRVENDA IS NULL) THEN new.VLRIRVENDA = 0;
  IF (new.VLRCSOCIALVENDA IS NULL) THEN new.VLRCSOCIALVENDA = 0;

  SELECT CODTERM FROM SGRETCAIXA INTO new.CODCAIXA;
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'PVCAIXA') INTO new.CODFILIALCX;
  new.CODEMPCX = new.CODEMP;
  IF (NOT new.tipovenda = 'E') THEN -- Se for ECF não precisa buscar o DOC, porque o DOC é o numero do cupom.
      SELECT DOC FROM LFNOVODOCSP(new.Serie,new.CODEMP,new.CODFILIAL) INTO new.DocVenda;
  SELECT TIPOMOV,FISCALTIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIALTM INTO sTipoMov,new.FLAG;
  IF ( new.FLAG <> 'S') THEN
  BEGIN
     new.FLAG = 'N';
  END
  if ((new.STATUSVENDA is null) OR (RTRIM(new.STATUSVENDA) = '*')) then
  BEGIN
     IF (sTipoMov = 'VD') THEN new.STATUSVENDA = 'V1';
     ELSE new.STATUSVENDA = 'P1';
  END
END
^

SET TERM ; ^
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDVENDATGBU" FOR "VDVENDA"
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE ICODFILIAL INTEGER;
  DECLARE VARIABLE ICODITVENDA INTEGER;
  DECLARE VARIABLE iCodTipoMov INTEGER;
  DECLARE VARIABLE sSerie CHAR(4);
  DECLARE VARIABLE iCodFilialPref smallint;
  DECLARE VARIABLE dDesc NUMERIC(15, 5);
  DECLARE VARIABLE PERCPISFILIAL NUMERIC(9,2);
  DECLARE VARIABLE PERCCOFINSFILIAL NUMERIC(9,2);
  DECLARE VARIABLE PERCIRFILIAL NUMERIC(9,2);
  DECLARE VARIABLE PERCCSOCIALFILIAL NUMERIC(9,2);
  DECLARE VARIABLE VLRPRODITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE QTDITVENDA NUMERIC(9,2);
  DECLARE VARIABLE VLRCOMISITVENDA NUMERIC(15, 5);
  DECLARE VARIABLE PERCCOMISITVENDA NUMERIC(9,2);
  DECLARE VARIABLE SIMPLESFILIAL CHAR(1);
  DECLARE VARIABLE SIMPLESCLI CHAR(1);
  DECLARE VARIABLE PESSOACLI CHAR(1);          
  DECLARE VARIABLE NVLRFRETE NUMERIC(15,5);
  DECLARE VARIABLE CADICFRETEVD CHAR(1);
BEGIN
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  if (new.BLOQVENDA IS NULL) then
     new.BLOQVENDA='N';
  if ( ( (old.BLOQVENDA IS  NULL) OR (old.BLOQVENDA='N') ) AND (new.BLOQVENDA='S') )  then
  begin
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=user;
      new.HALT=cast('now' AS TIME);
  end
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      EXECUTE PROCEDURE VDCLIENTEATIVOSP(new.CODEMPCL, new.CODFILIALCL, new.CODCLI);
      if ( (old.BLOQVENDA IS NOT NULL AND old.BLOQVENDA='S') or (new.BLOQVENDA='S') ) then
         EXCEPTION VDVENDAEX05 'ESTA VENDA ESTÁ BLOQUEADA!!!';
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=user;
      new.HALT=cast('now' AS TIME);
      SELECT CODFILIALSEL FROM SGCONEXAO WHERE NRCONEXAO=CURRENT_CONNECTION AND
          CONECTADO > 0 INTO ICODFILIAL;
      EXECUTE PROCEDURE FNLIBCREDSP(new.CODVENDA,new.CODCLI,new.CODEMPCL,new.CODFILIALCL,new.VLRLIQVENDA);
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP, 'SGPREFERE1') INTO iCodFilialPref;
      IF (substr(old.STATUSVENDA,1,1) = 'C') THEN
        EXCEPTION VDVENDAEX05;
      IF (substr(old.STATUSVENDA,1,1) = 'D') THEN
        EXCEPTION VDVENDAEX05 'ESTA VENDA FOI DEVOLVIDA!';
      IF ((SUBSTR(old.STATUSVENDA,1,1) = 'P') AND (SUBSTR(new.STATUSVENDA,1,1) = 'V' ) AND new.IMPNOTAVENDA = 'N') THEN
      BEGIN
        SELECT T2.CODTIPOMOV, T2.SERIE FROM EQTIPOMOV T2, EQTIPOMOV T WHERE T2.CODEMP=T.CODEMPTM
               AND T2.CODFILIAL=T.CODFILIALTM AND T2.CODTIPOMOV = T.CODTIPOMOVTM
               AND T.CODEMP=new.CODEMPTM AND T.CODFILIAL=new.CODFILIALTM AND T.CODTIPOMOV=new.CODTIPOMOV
               INTO :iCodTipoMov, :sSerie;
        IF (iCodTipoMov IS NULL) THEN
          SELECT T.CODTIPOMOV, T.SERIE FROM SGPREFERE1 P, EQTIPOMOV T WHERE P.CODEMPTM=T.CODEMP AND
                 P.CODFILIALTM=T.CODFILIAL AND P.CODTIPOMOV = T.CODTIPOMOV
                 AND P.CODEMP=new.CODEMP AND P.CODFILIAL = :iCodFilialPref INTO :iCodTipoMov, :sSerie;
        new.CODTIPOMOV = :iCodTipoMov;
        new.SERIE = :sSerie;
        IF ( ( not (old.IMPNOTAVENDA = 'S') ) AND ( not (new.IMPNOTAVENDA = 'S') ) ) THEN
        BEGIN
            SELECT DOC FROM LFNOVODOCSP(new.Serie,new.CODEMP,new.CODFILIAL) INTO new.DocVenda;
            new.IMPNOTAVENDA = 'S';
        END
      END
      SELECT FISCALTIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
             AND CODEMP=new.CODEMP AND CODFILIAL = new.codfilialtm INTO new.FLAG;
      IF (new.FLAG<>'S') THEN
        new.FLAG = 'N';
      SELECT VLRFRETEVD, ADICFRETEVD FROM VDFRETEVD WHERE CODVENDA=old.CODVENDA AND TIPOVENDA=old.TIPOVENDA AND ADICFRETEVD = 'S'
             AND CODEMP=old.CODEMP AND CODFILIAL = old.codfilial INTO new.VLRFRETEVENDA, :CADICFRETEVD;
      IF (new.VLRDESCVENDA IS NULL) THEN
        new.VLRDESCVENDA = 0;
      IF (new.VLRDESCITVENDA IS NULL) THEN
        new.VLRDESCITVENDA = 0;
      IF (new.VLRADICVENDA IS NULL) THEN
        new.VLRADICVENDA = 0;
      IF (new.VLRFRETEVENDA IS NULL) THEN
        new.VLRFRETEVENDA = 0;
      IF (new.VLRPRODVENDA IS NULL) THEN
        new.VLRPRODVENDA = 0;
      IF (new.VLRIPIVENDA IS NULL) THEN
        new.VLRIPIVENDA = 0;
      IF (new.VLRBASEICMSVENDA IS NULL) THEN
        new.VLRBASEICMSVENDA = 0;
      IF (new.VLRDESCITVENDA > 0) THEN
        dDesc = new.VLRDESCITVENDA;
      ELSE
        dDesc = new.VLRDESCVENDA;
      SELECT C.SIMPLESCLI,C.PESSOACLI FROM VDCLIENTE C WHERE C.CODCLI=new.CODCLI AND
        C.CODFILIAL=new.CODFILIALCL AND C.CODEMP=new.CODEMPCL INTO SIMPLESCLI,PESSOACLI;
      SELECT SIMPLESFILIAL,PERCPISFILIAL,PERCCOFINSFILIAL,PERCIRFILIAL,PERCCSOCIALFILIAL
        FROM SGFILIAL WHERE CODEMP=new.CODEMP AND CODFILIAL=:ICODFILIAL
        INTO SIMPLESFILIAL,PERCPISFILIAL,PERCCOFINSFILIAL,PERCIRFILIAL,PERCCSOCIALFILIAL;
      IF (SIMPLESFILIAL = 'N') THEN
      BEGIN
        new.VLRPISVENDA = (new.VLRBASEISSVENDA/100)*PERCPISFILIAL;
        new.VLRCOFINSVENDA = (new.VLRBASEISSVENDA/100)*PERCCOFINSFILIAL;
        new.VLRIRVENDA = (new.VLRBASEISSVENDA/100)*PERCIRFILIAL;
        new.VLRCSOCIALVENDA = (new.VLRBASEISSVENDA/100)*PERCCSOCIALFILIAL;
      END
      ELSE
      BEGIN
        new.VLRPISVENDA = 0;
        new.VLRCOFINSVENDA = 0;
        new.VLRIRVENDA = 0;
        new.VLRCSOCIALVENDA = 0;
      END
      if (CADICFRETEVD = 'S') then
         NVLRFRETE = new.VLRFRETEVENDA;
      else
         NVLRFRETE = 0;

      new.VLRLIQVENDA = coalesce(new.VLRPRODVENDA,0) -
                        coalesce(dDesc,0) +
                        coalesce(new.VLRADICVENDA,0) +
                        coalesce(:NVLRFRETE,0) +
                        coalesce(new.VLRIPIVENDA,0);

      IF (SIMPLESCLI = 'N' AND PESSOACLI = 'J') THEN
        new.VLRLIQVENDA = CAST( coalesce(new.VLRLIQVENDA,0) -
                                coalesce(new.VLRPISVENDA,0) -
                                coalesce(new.VLRCOFINSVENDA,0) -
                                coalesce(new.VLRIRVENDA,0) -
                                coalesce(new.VLRCSOCIALVENDA,0) AS NUMERIC(15, 5));
      IF ((substr(old.STATUSVENDA,1,1) IN ('P','V')) AND (substr(new.STATUSVENDA,1,1)='C')) THEN
      BEGIN
          new.VLRDESCITVENDA = 0;
          new.VLRPRODVENDA = 0;
          new.VLRBASEICMSVENDA = 0;
          new.VLRICMSVENDA = 0;
          new.VLRISENTASVENDA = 0;
          new.VLROUTRASVENDA = 0;
          new.VLRBASEIPIVENDA = 0;
          new.VLRIPIVENDA = 0;
          new.VLRLIQVENDA = 0;
          new.VLRCOMISVENDA = 0;
          new.VLRISSVENDA = 0;
          new.VLRBASEISSVENDA = 0;
      END
    /**
       COMISSAO
    **/
      IF ((NOT NEW.VLRCOMISVENDA IS NULL) AND
          (NEW.VLRLIQVENDA > 0) AND
          ((NOT NEW.VLRDESCVENDA = OLD.VLRDESCVENDA) OR (NOT NEW.PERCMCOMISVENDA = OLD.PERCMCOMISVENDA))) then
      BEGIN
        /* Distribuindo a comissao: */
        FOR SELECT CODITVENDA,VLRPRODITVENDA,QTDITVENDA,VLRCOMISITVENDA,vlrdescitvenda,iv.perccomisitvenda
            FROM VDITVENDA IV
            WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND CODVENDA=new.CODVENDA and tipovenda=new.tipovenda
            INTO ICODITVENDA,VLRPRODITVENDA,QTDITVENDA,VLRCOMISITVENDA,VLRDESCITVENDA,PERCCOMISITVENDA DO
        BEGIN
          /* Calculo do item.: */
          /* INCLUIDO PARA DISTRIBUIR A COMISSAO MENOS O DESCONTO PROPORCIONALMENTE*/
          PERCIT = 0;
          IF (new.VLRPRODVENDA > 0 AND NOT new.VLRDESCITVENDA > 0 AND new.VLRDESCVENDA > 0) THEN
          BEGIN
            PERCIT = (100*VLRPRODITVENDA) / new.VLRPRODVENDA;
            VLRDESCITVENDA = (new.VLRDESCVENDA  * PERCIT) / 100;
          END
          IF (new.VLRPRODVENDA > 0 AND new.PERCMCOMISVENDA > 0) THEN
          BEGIN
            PERCCOMISITVENDA = new.PERCMCOMISVENDA;
            /* Retira.. */
            new.VLRCOMISVENDA = new.VLRCOMISVENDA - VLRCOMISITVENDA;
            /* Atualiza.. */
            VLRCOMISITVENDA = ((VLRPRODITVENDA - VLRDESCITVENDA) * PERCCOMISITVENDA) / 100;
            /* Adiciona.. */
            new.VLRCOMISVENDA = new.VLRCOMISVENDA + VLRCOMISITVENDA;
          END
          UPDATE VDITVENDA SET VLRCOMISITVENDA=:VLRCOMISITVENDA,PERCCOMISITVENDA=:PERCCOMISITVENDA
          WHERE CODITVENDA=:ICODITVENDA AND CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
        END
      END
      /* Calcula o percentual medio da comissao */
      ELSE IF (new.PERCMCOMISVENDA = old.PERCMCOMISVENDA AND new.VLRLIQVENDA > 0) THEN
          new.PERCMCOMISVENDA = (new.VLRCOMISVENDA/new.VLRLIQVENDA)*100.000;

      IF (new.STATUSVENDA = 'V4') THEN
      BEGIN
        new.IMPNOTAVENDA = 'S';
        new.STATUSVENDA = 'V3';
      END
      IF ((new.IMPNOTAVENDA = 'S') AND (old.IMPNOTAVENDA = 'S')) THEN
      BEGIN
        new.DOCVENDA = old.DOCVENDA;
      END
  END
END
^

SET TERM ; ^
COMMIT WORK;
CREATE TABLE "VDVENDEDOR"("CODEMP" INTEGER NOT NULL,
"CODFILIAL" SMALLINT NOT NULL,
"CODVEND" INTEGER NOT NULL,
"NOMEVEND" CHAR(40) CHARACTER SET NONE,
"ENDVEND" CHAR(50) CHARACTER SET NONE,
"NUMVEND" INTEGER,
"COMPLVEND" CHAR(20) CHARACTER SET NONE,
"BAIRVEND" CHAR(30) CHARACTER SET NONE,
"CIDVEND" CHAR(30) CHARACTER SET NONE,
"CEPVEND" CHAR(8) CHARACTER SET NONE,
"UFVEND" CHAR(2) CHARACTER SET NONE,
"FONEVEND" CHAR(12) CHARACTER SET NONE,
"FAXVEND" CHAR(8) CHARACTER SET NONE,
"EMAILVEND" CHAR(50) CHARACTER SET NONE,
"PERCCOMVEND" NUMERIC(7,3),
"COMIPIVEND" CHAR(1) CHARACTER SET NONE,
"CODEMPPN" INTEGER,
"CODFILIALPN" SMALLINT,
"CODPLAN" CHAR(13) CHARACTER SET NONE,
"CPFVEND" CHAR(11) CHARACTER SET NONE,
"RGVEND" CHAR(10) CHARACTER SET NONE,
"CNPJVEND" CHAR(14) CHARACTER SET NONE,
"INSCVEND" CHAR(15) CHARACTER SET NONE,
"CELVEND" CHAR(12) CHARACTER SET NONE,
"CODEMPSE" INTEGER,
"CODFILIALSE" INTEGER,
"CODSETOR" INTEGER,
"CODEMPCM" INTEGER,
"CODFILIALCM" INTEGER,
"CODCLCOMIS" INTEGER,
"DTINS" DATE DEFAULT 'now',
"IDUSUINS" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"DTALT" DATE DEFAULT 'now',
"IDUSUALT" CHAR(8) CHARACTER SET NONE DEFAULT USER,
"CODFORNVEND" CHAR(13) CHARACTER SET NONE,
"HINS" TIME DEFAULT 'now',
"HALT" TIME DEFAULT 'now',
"CODFUNC" INTEGER,
"CODEMPFU" INTEGER,
"CODFILIALFU" SMALLINT,
"DDDFONEVEND" CHAR(4) CHARACTER SET NONE,
"DDDFAXVEND" CHAR(4) CHARACTER SET NONE,
"DDDCELVEND" CHAR(4) CHARACTER SET NONE,
"SSPVEND" CHAR(10) CHARACTER SET NONE,
"OBSVEND" VARCHAR(500) CHARACTER SET NONE,
"ATIVOCOMIS" CHAR(1) CHARACTER SET NONE DEFAULT 'S' NOT NULL,
"IMGASSVEND" BLOB SEGMENT SIZE 50);
COMMIT WORK;
SET TERM ^ ;
CREATE TRIGGER "VDVENDEDORTGBU" FOR "VDVENDEDOR"
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT=cast('now'AS TIME);
end
^

SET TERM ; ^
COMMIT WORK;

/* (c) 1998-2002 by Boris Loboda, barry@audit.kharkov.com */