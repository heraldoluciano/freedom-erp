 
SET SQL DIALECT 3; 
 
/* CREATE DATABASE 'freedom.fdb' DEFAULT CHARACTER SET NONE */


/*  External Function declarations */
DECLARE EXTERNAL FUNCTION ABS 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_abs' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION ACOS 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_acos' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION ADDDAY 
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addDay' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ADDHOUR 
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addHour' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ADDMILLISECOND 
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addMilliSecond' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ADDMINUTE 
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addMinute' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ADDMONTH 
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addMonth' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ADDSECOND 
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addSecond' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ADDWEEK 
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addWeek' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ADDYEAR 
TIMESTAMP, INTEGER
RETURNS TIMESTAMP 
ENTRY_POINT 'addYear' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION ASCII_CHAR 
INTEGER
RETURNS CSTRING(1) CHARACTER SET NONE FREE_IT
ENTRY_POINT 'IB_UDF_ascii_char' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION ASCII_VAL 
CHAR(1) CHARACTER SET NONE
RETURNS INTEGER BY VALUE 
ENTRY_POINT 'IB_UDF_ascii_val' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION ASIN 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_asin' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION ATAN 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_atan' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION ATAN2 
DOUBLE PRECISION, DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_atan2' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION BIN_AND 
INTEGER, INTEGER
RETURNS INTEGER BY VALUE 
ENTRY_POINT 'IB_UDF_bin_and' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION BIN_OR 
INTEGER, INTEGER
RETURNS INTEGER BY VALUE 
ENTRY_POINT 'IB_UDF_bin_or' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION BIN_XOR 
INTEGER, INTEGER
RETURNS INTEGER BY VALUE 
ENTRY_POINT 'IB_UDF_bin_xor' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION CEILING 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_ceiling' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION COS 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_cos' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION COSH 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_cosh' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION COT 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_cot' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION DIV 
INTEGER, INTEGER
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_div' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION DNULLIF 
DOUBLE PRECISION BY DESCRIPTOR, DOUBLE PRECISION BY DESCRIPTOR
RETURNS DOUBLE PRECISION BY DESCRIPTOR 
ENTRY_POINT 'dNullIf' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION DNVL 
DOUBLE PRECISION BY DESCRIPTOR, DOUBLE PRECISION BY DESCRIPTOR
RETURNS DOUBLE PRECISION BY DESCRIPTOR 
ENTRY_POINT 'idNvl' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION DOW 
TIMESTAMP, VARCHAR(15) CHARACTER SET NONE
RETURNS PARAMETER 2
ENTRY_POINT 'DOW' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION DPOWER 
DOUBLE PRECISION BY DESCRIPTOR, DOUBLE PRECISION BY DESCRIPTOR, DOUBLE PRECISION BY DESCRIPTOR
RETURNS PARAMETER 3
ENTRY_POINT 'power' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION FLOOR 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_floor' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION GETEXACTTIMESTAMP 
TIMESTAMP
RETURNS PARAMETER 1
ENTRY_POINT 'getExactTimestamp' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION I64NULLIF 
NUMERIC(18, 4) BY DESCRIPTOR, NUMERIC(18, 4) BY DESCRIPTOR
RETURNS NUMERIC(18, 4) BY DESCRIPTOR 
ENTRY_POINT 'iNullIf' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION I64NVL 
NUMERIC(18, 0) BY DESCRIPTOR, NUMERIC(18, 0) BY DESCRIPTOR
RETURNS NUMERIC(18, 0) BY DESCRIPTOR 
ENTRY_POINT 'idNvl' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION I64ROUND 
NUMERIC(18, 4) BY DESCRIPTOR, NUMERIC(18, 4) BY DESCRIPTOR
RETURNS PARAMETER 2
ENTRY_POINT 'fbround' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION I64TRUNCATE 
NUMERIC(18, 0) BY DESCRIPTOR, NUMERIC(18, 0) BY DESCRIPTOR
RETURNS PARAMETER 2
ENTRY_POINT 'fbtruncate' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION INULLIF 
INTEGER BY DESCRIPTOR, INTEGER BY DESCRIPTOR
RETURNS INTEGER BY DESCRIPTOR 
ENTRY_POINT 'iNullIf' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION INVL 
INTEGER BY DESCRIPTOR, INTEGER BY DESCRIPTOR
RETURNS INTEGER BY DESCRIPTOR 
ENTRY_POINT 'idNvl' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION LN 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_ln' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION LOG 
DOUBLE PRECISION, DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_log' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION LOG10 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_log10' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION LOWER 
CSTRING(80) CHARACTER SET NONE
RETURNS CSTRING(80) CHARACTER SET NONE FREE_IT
ENTRY_POINT 'IB_UDF_lower' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION LTRIM 
CSTRING(80) CHARACTER SET NONE
RETURNS CSTRING(80) CHARACTER SET NONE FREE_IT
ENTRY_POINT 'IB_UDF_ltrim' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION MOD 
INTEGER, INTEGER
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_mod' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION PI 

RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_pi' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION RAND 

RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_rand' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION ROUND 
INTEGER BY DESCRIPTOR, INTEGER BY DESCRIPTOR
RETURNS PARAMETER 2
ENTRY_POINT 'fbround' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION RTRIM 
CSTRING(80) CHARACTER SET NONE
RETURNS CSTRING(80) CHARACTER SET NONE FREE_IT
ENTRY_POINT 'IB_UDF_rtrim' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION SDOW 
TIMESTAMP, VARCHAR(5) CHARACTER SET NONE
RETURNS PARAMETER 2
ENTRY_POINT 'SDOW' MODULE_NAME 'fbudf';

DECLARE EXTERNAL FUNCTION SIGN 
DOUBLE PRECISION
RETURNS INTEGER BY VALUE 
ENTRY_POINT 'IB_UDF_sign' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION SIN 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_sin' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION SINH 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_sinh' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION SQRT 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_sqrt' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION STRLEN 
CSTRING(32767) CHARACTER SET NONE
RETURNS INTEGER BY VALUE 
ENTRY_POINT 'IB_UDF_strlen' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION SUBSTR 
CSTRING(80) CHARACTER SET NONE, SMALLINT, SMALLINT
RETURNS CSTRING(80) CHARACTER SET NONE FREE_IT
ENTRY_POINT 'IB_UDF_substr' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION TAN 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_tan' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION TANH 
DOUBLE PRECISION
RETURNS DOUBLE PRECISION BY VALUE 
ENTRY_POINT 'IB_UDF_tanh' MODULE_NAME 'ib_udf';

DECLARE EXTERNAL FUNCTION TRUNCATE 
INTEGER BY DESCRIPTOR, INTEGER BY DESCRIPTOR
RETURNS PARAMETER 2
ENTRY_POINT 'fbtruncate' MODULE_NAME 'fbudf';


CREATE GENERATOR SGOBJETOINC;


/* Table: ATAGENDA, Owner: SYSDBA */
CREATE TABLE ATAGENDA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODAG INTEGER NOT NULL,
        CODEMPSA INTEGER NOT NULL,
        CODFILIALSA SMALLINT NOT NULL,
        CODSETAT INTEGER NOT NULL,
        DTACADAG DATE DEFAULT 'today' NOT NULL,
        HORACATAG TIME DEFAULT 'now' NOT NULL,
        DTAAG DATE DEFAULT 'today' NOT NULL,
        HORAAG TIME DEFAULT 'now' NOT NULL,
        DESCAGENDA CHAR(50) NOT NULL,
        CODEMPAE INTEGER,
        CODFILIALAE SMALLINT,
        CODATEND INTEGER,
        DTAATENDAG DATE,
        HORAATENDAG TIME,
        OBSAGENDA VARCHAR(10000),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now');

/* Table: ATATENDENTE, Owner: SYSDBA */
CREATE TABLE ATATENDENTE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODATEND INTEGER NOT NULL,
        NOMEATEND CHAR(50) NOT NULL,
        CODEMPTA INTEGER NOT NULL,
        CODFILIALTA SMALLINT NOT NULL,
        CODTPATEND INTEGER NOT NULL,
        RGATEND CHAR(10),
        ENDATEND CHAR(50),
        BAIRATEND CHAR(30),
        CIDATEND CHAR(30),
        CEPATEND CHAR(8),
        FONEATEND CHAR(12),
        FAXATEND CHAR(8),
        EMAILATEND CHAR(60),
        NUMATEND INTEGER,
        UFATEND CHAR(2),
        CELATEND CHAR(8),
        IDENTIFICATEND CHAR(18),
        CODEMPUS INTEGER,
        CODFILIALUS INTEGER,
        IDUSU CHAR(8),
        CPFATEND CHAR(11),
        CODVEND INTEGER,
        CODEMPVE INTEGER,
        CODFILIALVE INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATATENDENTEPK PRIMARY KEY (CODATEND, CODFILIAL, CODEMP));

/* Table: ATATENDIMENTO, Owner: SYSDBA */
CREATE TABLE ATATENDIMENTO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODATENDO INTEGER NOT NULL,
        CODCONV INTEGER NOT NULL,
        CODEMPCV INTEGER NOT NULL,
        CODFILIALCV INTEGER NOT NULL,
        CODEMPTO INTEGER NOT NULL,
        CODFILIALTO SMALLINT NOT NULL,
        CODTPATENDO INTEGER NOT NULL,
        CODEMPAE INTEGER NOT NULL,
        CODFILIALAE SMALLINT NOT NULL,
        CODATEND INTEGER NOT NULL,
        CODEMPSA INTEGER NOT NULL,
        CODFILIALSA INTEGER NOT NULL,
        CODSETAT INTEGER NOT NULL,
        DATAATENDO DATE DEFAULT 'today' NOT NULL,
        HORAATENDO TIME DEFAULT 'now' NOT NULL,
        OBSATENDO VARCHAR(10000),
        STATUSATENDO CHAR(2) NOT NULL,
        IDUSU CHAR(8) NOT NULL,
        CODEMPUS INTEGER NOT NULL,
        CODFILIALUS INTEGER NOT NULL,
        DOCATENDO INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATATENDIMENTOPK PRIMARY KEY (CODATENDO, CODFILIAL, CODEMP));

/* Table: ATATENDIMENTOORC, Owner: SYSDBA */
CREATE TABLE ATATENDIMENTOORC (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODATENDO INTEGER NOT NULL,
        CODEMPOC INTEGER NOT NULL,
        CODFILIALOC SMALLINT NOT NULL,
        TIPOORC CHAR(1) NOT NULL,
        CODORC INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATATENDIMENTOORCPK PRIMARY KEY (CODATENDO, CODFILIAL, CODEMP, CODORC, TIPOORC, CODFILIALOC, CODEMPOC));

/* Table: ATATRIBUICAO, Owner: SYSDBA */
CREATE TABLE ATATRIBUICAO (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        CODATRIB CHAR(15) NOT NULL,
        DESCATRIB CHAR(50) NOT NULL,
        OBSATRIB VARCHAR(10000),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATATRIBUICAOPK PRIMARY KEY (CODATRIB, CODFILIAL, CODEMP));

/* Table: ATCONVATRIB, Owner: SYSDBA */
CREATE TABLE ATCONVATRIB (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCONV INTEGER NOT NULL,
        SEQCONVATRIB SMALLINT NOT NULL,
        CODEMPAB INTEGER NOT NULL,
        CODFILIALAB SMALLINT NOT NULL,
        CODATRIB CHAR(15) NOT NULL,
        OBSCONVATRIB VARCHAR(10000),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATCONVATRIBPK PRIMARY KEY (CODCONV, SEQCONVATRIB, CODFILIAL, CODEMP));

/* Table: ATCONVATRIBTB, Owner: SYSDBA */
CREATE TABLE ATCONVATRIBTB (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCONV INTEGER NOT NULL,
        SEQCONVATRIB SMALLINT NOT NULL,
        CODEMPTB INTEGER NOT NULL,
        CODFILIALTB SMALLINT NOT NULL,
        CODTB SMALLINT NOT NULL,
        CODITTB INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATCONVATRIBTB PRIMARY KEY (CODITTB, CODTB, CODFILIALTB, CODEMPTB, SEQCONVATRIB, CODCONV, CODFILIAL, CODEMP));

/* Table: ATCONVENIADO, Owner: SYSDBA */
CREATE TABLE ATCONVENIADO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCONV INTEGER NOT NULL,
        NOMECONV CHAR(50) NOT NULL,
        CODEMPTC INTEGER NOT NULL,
        CODFILIALTC SMALLINT NOT NULL,
        CODTPCONV INTEGER NOT NULL,
        DTNASCCONV DATE NOT NULL,
        CODEMPAE INTEGER,
        CODFILIALAE SMALLINT,
        CODATEND INTEGER,
        CODEMPGI INTEGER,
        CODFILIALGI SMALLINT,
        CODGRI INTEGER,
        RGCONV CHAR(10),
        CPFCONV CHAR(11),
        ENDCONV CHAR(50),
        NUMCONV INTEGER,
        BAIRCONV CHAR(30),
        CIDCONV CHAR(30),
        CEPCONV CHAR(8),
        FONECONV CHAR(12),
        FAXCONV CHAR(8),
        EMAILCONV CHAR(60),
        PAICONV CHAR(50),
        MAECONV CHAR(50),
        RGPAICONV CHAR(10),
        RGMAECONV CHAR(10),
        CNSCONV CHAR(15),
        CODEMPCL INTEGER,
        CODFILIALCL INTEGER,
        CODCLI INTEGER,
        UFCONV CHAR(2),
        CELCONV CHAR(8),
        SEXOCONV CHAR(1),
        IDENTIFICCONV CHAR(20),
        COMPLCONV CHAR(20),
        CODEMPEC INTEGER,
        CODFILIALEC SMALLINT,
        CODENC INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT 'now',
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATCONVENIADOPK PRIMARY KEY (CODCONV, CODFILIAL, CODEMP));

/* Table: ATENCAMINHADOR, Owner: SYSDBA */
CREATE TABLE ATENCAMINHADOR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODENC INTEGER NOT NULL,
        NOMEENC CHAR(50) NOT NULL,
        ENDENC CHAR(50),
        NUMENC INTEGER,
        COMPLENC CHAR(30),
        CIDENC CHAR(30),
        BAIRENC CHAR(30),
        UFENC CHAR(2),
        CEPENC CHAR(8),
        FONEENC CHAR(12),
        FAXENC CHAR(8),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATENCAMINHADORPK PRIMARY KEY (CODENC, CODFILIAL, CODEMP));

/* Table: ATSETOR, Owner: SYSDBA */
CREATE TABLE ATSETOR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODSETAT INTEGER NOT NULL,
        DESCSETAT CHAR(50) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATSETORPK PRIMARY KEY (CODSETAT, CODFILIAL, CODEMP));

/* Table: ATSETORATENDENTE, Owner: SYSDBA */
CREATE TABLE ATSETORATENDENTE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODSETAT INTEGER NOT NULL,
        CODEMPAE INTEGER NOT NULL,
        CODFILIALAE SMALLINT NOT NULL,
        CODATEND INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATSETORATENDENTEPK PRIMARY KEY (CODSETAT, CODFILIAL, CODEMP, CODATEND, CODFILIALAE, CODEMPAE));

/* Table: ATTIPOATEND, Owner: SYSDBA */
CREATE TABLE ATTIPOATEND (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTPATEND INTEGER NOT NULL,
        DESCTPATEND CHAR(50) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATTIPOATENDPK PRIMARY KEY (CODTPATEND, CODFILIAL, CODEMP));

/* Table: ATTIPOATENDO, Owner: SYSDBA */
CREATE TABLE ATTIPOATENDO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTPATENDO INTEGER NOT NULL,
        DESCTPATENDO CHAR(50) NOT NULL,
        CODEMPFX INTEGER,
        CODFILIALFX SMALLINT,
        CODFLUXO INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATTIPOATENDOPK PRIMARY KEY (CODTPATENDO, CODFILIAL, CODEMP));

/* Table: ATTIPOATENDOSETOR, Owner: SYSDBA */
CREATE TABLE ATTIPOATENDOSETOR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTPATENDO INTEGER NOT NULL,
        CODEMPST INTEGER NOT NULL,
        CODFILIALST SMALLINT NOT NULL,
        CODSETAT INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATTIPOATENDOSETORPK PRIMARY KEY (CODSETAT, CODFILIALST, CODEMPST, CODTPATENDO, CODFILIAL, CODEMP));

/* Table: ATTIPOCONV, Owner: SYSDBA */
CREATE TABLE ATTIPOCONV (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTPCONV INTEGER NOT NULL,
        DESCTPCONV CHAR(50) NOT NULL,
        CLASSTPCONV CHAR(20),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT ATTIPOCONVPK PRIMARY KEY (CODTPCONV, CODFILIAL, CODEMP));

/* Table: CPCOMPRA, Owner: SYSDBA */
CREATE TABLE CPCOMPRA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCOMPRA INTEGER NOT NULL,
        CODEMPPG INTEGER NOT NULL,
        CODFILIALPG SMALLINT NOT NULL,
        CODPLANOPAG INTEGER NOT NULL,
        CODEMPFR INTEGER NOT NULL,
        CODFILIALFR SMALLINT NOT NULL,
        CODFOR INTEGER NOT NULL,
        CODEMPSE INTEGER NOT NULL,
        CODFILIALSE SMALLINT NOT NULL,
        SERIE CHAR(4) NOT NULL,
        CODEMPTM INTEGER NOT NULL,
        CODFILIALTM SMALLINT NOT NULL,
        CODTIPOMOV INTEGER NOT NULL,
        DOCCOMPRA INTEGER NOT NULL,
        DTENTCOMPRA DATE NOT NULL,
        DTEMITCOMPRA DATE NOT NULL,
        VLRPRODCOMPRA NUMERIC(15, 3),
        PERCDESCCOMPRA NUMERIC(6, 2),
        VLRDESCCOMPRA NUMERIC(15, 3),
        VLRDESCITCOMPRA NUMERIC(15, 3),
        VLRCOMPRA NUMERIC(15, 3),
        VLRBASEICMSCOMPRA NUMERIC(15, 3),
        VLRICMSCOMPRA NUMERIC(15, 3),
        VLRISENTASCOMPRA NUMERIC(15, 3),
        VLROUTRASCOMPRA NUMERIC(15, 3),
        VLRBASEIPICOMPRA NUMERIC(15, 3),
        VLRLIQCOMPRA NUMERIC(15, 3),
        STATUSCOMPRA CHAR(2) NOT NULL,
        VLRFRETECOMPRA NUMERIC(15, 3),
        VLRADICCOMPRA NUMERIC(15, 3),
        PERCIPICOMPRA NUMERIC(6, 2),
        VLRIPICOMPRA NUMERIC(15, 3),
        CODEMPBO INTEGER,
        CODFILIALBO SMALLINT,
        CODBANCO CHAR(3),
        FLAG CHAR(1) DEFAULT 'N',
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
        EMMANUT CHAR(1) DEFAULT 'N' NOT NULL,
        BLOQCOMPRA CHAR(1) DEFAULT 'N' NOT NULL,
CONSTRAINT CPCOMPRAPK PRIMARY KEY (CODCOMPRA, CODFILIAL, CODEMP));

/* Table: CPCOMPRAVENDA, Owner: SYSDBA */
CREATE TABLE CPCOMPRAVENDA (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        CODCOMPRA INTEGER NOT NULL,
        CODITCOMPRA INTEGER NOT NULL,
        CODEMPVD INTEGER NOT NULL,
        CODFILIALVD INTEGER NOT NULL,
        TIPOVENDA CHAR(1) NOT NULL,
        CODVENDA INTEGER NOT NULL,
        CODITVENDA INTEGER NOT NULL,
        QTDDEV NUMERIC(18, 3) NOT NULL,
CONSTRAINT CPCOMPRAVENDAPK PRIMARY KEY (CODITCOMPRA, CODCOMPRA, CODFILIAL, CODEMP));

/* Table: CPEQUIVCFOP, Owner: SYSDBA */
CREATE TABLE CPEQUIVCFOP (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODNAT CHAR(4) NOT NULL,
        CODEMPND INTEGER NOT NULL,
        CODFILIALND SMALLINT NOT NULL,
        CODNATND CHAR(4) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8),
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT CPEQUIVCFOPPK PRIMARY KEY (CODNAT, CODFILIAL, CODEMP));

/* Table: CPFORNECED, Owner: SYSDBA */
CREATE TABLE CPFORNECED (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODFOR INTEGER NOT NULL,
        RAZFOR CHAR(50) NOT NULL,
        CODEMPTF INTEGER NOT NULL,
        CODFILIALTF SMALLINT NOT NULL,
        CODTIPOFOR INTEGER NOT NULL,
        CODEMPBO INTEGER,
        CODFILIALBO SMALLINT,
        CODBANCO CHAR(3),
        NOMEFOR CHAR(50) NOT NULL,
        DATAFOR DATE DEFAULT 'today' NOT NULL,
        ATIVOFOR CHAR(1),
        PESSOAFOR CHAR(1) NOT NULL,
        CNPJFOR CHAR(14),
        CPFFOR CHAR(11),
        INSCFOR CHAR(15),
        RGFOR CHAR(10),
        ENDFOR CHAR(50),
        NUMFOR INTEGER,
        COMPLFOR CHAR(20),
        BAIRFOR CHAR(30),
        CEPFOR CHAR(8),
        CIDFOR CHAR(30),
        UFFOR CHAR(2),
        CONTFOR CHAR(40),
        FONEFOR CHAR(12),
        FAXFOR CHAR(8),
        AGENCIAFOR CHAR(6),
        CONTAFOR CHAR(10),
        EMAILFOR CHAR(50),
        OBSFOR VARCHAR(10000),
        CELFOR CHAR(8),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        CLIFOR CHAR(1) DEFAULT 'F',
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT CPFORNECEDPK PRIMARY KEY (CODFOR, CODFILIAL, CODEMP));

/* Table: CPITCOMPRA, Owner: SYSDBA */
CREATE TABLE CPITCOMPRA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCOMPRA INTEGER NOT NULL,
        CODITCOMPRA INTEGER NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        CODEMPLE INTEGER,
        CODFILIALLE SMALLINT,
        CODLOTE CHAR(13),
        CODEMPNT INTEGER NOT NULL,
        CODFILIALNT SMALLINT NOT NULL,
        CODNAT CHAR(4) NOT NULL,
        QTDITCOMPRA NUMERIC(15, 3) NOT NULL,
        PRECOITCOMPRA NUMERIC(15, 3) NOT NULL,
        PERCDESCITCOMPRA NUMERIC(9, 2),
        VLRDESCITCOMPRA NUMERIC(15, 3),
        PERCICMSITCOMPRA NUMERIC(9, 2),
        VLRBASEICMSITCOMPRA NUMERIC(15, 3),
        VLRICMSITCOMPRA NUMERIC(15, 3),
        PERCIPIITCOMPRA NUMERIC(9, 2),
        VLRBASEIPIITCOMPRA NUMERIC(15, 3),
        VLRIPIITCOMPRA NUMERIC(15, 3),
        VLRLIQITCOMPRA NUMERIC(15, 3),
        VLRADICITCOMPRA NUMERIC(15, 3),
        VLRFRETEITCOMPRA NUMERIC(15, 3),
        VLRISENTASITCOMPRA NUMERIC(15, 3),
        VLROUTRASITCOMPRA NUMERIC(15, 3),
        VLRPRODITCOMPRA NUMERIC(15, 3),
        CUSTOITCOMPRA NUMERIC(15, 3) DEFAULT 0,
        REFPROD CHAR(13),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
        CUSTOVDITCOMPRA NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        EMMANUT CHAR(1) DEFAULT 'N' NOT NULL,
CONSTRAINT CPITCOMPRAPK PRIMARY KEY (CODITCOMPRA, CODCOMPRA, CODFILIAL, CODEMP));

/* Table: CPITSOLICITACAO, Owner: SYSDBA */
CREATE TABLE CPITSOLICITACAO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODSOL INTEGER NOT NULL,
        CODITSOL SMALLINT NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        REFPROD CHAR(13) NOT NULL,
        QTDITSOL NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        QTDAPROVITSOL NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        IDUSUITSOL CHAR(8) DEFAULT USER NOT NULL,
        DTITSOL DATE DEFAULT 'now' NOT NULL,
        IDUSUAPROVITSOL CHAR(8),
        DTAPROVITSOL DATE,
        SITAPROVITSOL CHAR(2) DEFAULT 'PE' NOT NULL,
        SITCOMPITSOL CHAR(2) DEFAULT 'PE' NOT NULL,
        SITITSOL CHAR(2) DEFAULT 'PE' NOT NULL,
CONSTRAINT CPITSOLICITACAOPK PRIMARY KEY (CODSOL, CODITSOL, CODFILIAL, CODEMP));

/* Table: CPPRODFOR, Owner: SYSDBA */
CREATE TABLE CPPRODFOR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        CODFOR INTEGER NOT NULL,
        REFPRODFOR CHAR(21),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT CPPRODFORPK PRIMARY KEY (CODFOR, CODPROD, CODFILIAL, CODEMP));

/* Table: CPSOLICITACAO, Owner: SYSDBA */
CREATE TABLE CPSOLICITACAO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODSOL INTEGER NOT NULL,
        DTEMITSOL DATE NOT NULL,
        SITSOL CHAR(2) DEFAULT 'PE' NOT NULL,
        ORIGSOL CHAR(2) DEFAULT 'AX' NOT NULL,
        MOTIVOSOL VARCHAR(10000),
        DTINS DATE DEFAULT 'now',
        HINS TIME DEFAULT 'now',
        DTALT DATE,
        HALT TIME,
        IDUSUINS CHAR(8) DEFAULT USER,
        IDUSUALT CHAR(8),
CONSTRAINT CPSOLICITACAOPK PRIMARY KEY (CODSOL, CODFILIAL, CODEMP));

/* Table: CPTABFOR, Owner: SYSDBA */
CREATE TABLE CPTABFOR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODFOR INTEGER NOT NULL,
        REFPRODTFOR CHAR(21) NOT NULL,
        DESCPRODTFOR CHAR(50) NOT NULL,
        PRECOPRODTFOR NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        CODEMPPD INTEGER,
        CODFILIALPD SMALLINT,
        CODPROD INTEGER,
        REFORIGTFOR CHAR(18),
        LINHATFOR CHAR(30),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT CPTABFORPK PRIMARY KEY (REFPRODTFOR, CODFOR, CODFILIAL, CODEMP));

/* Table: CPTIPOFOR, Owner: SYSDBA */
CREATE TABLE CPTIPOFOR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTIPOFOR INTEGER NOT NULL,
        DESCTIPOFOR CHAR(40),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT CPTIPOFORPK PRIMARY KEY (CODTIPOFOR, CODFILIAL, CODEMP));

/* Table: EQALMOX, Owner: SYSDBA */
CREATE TABLE EQALMOX (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODALMOX INTEGER NOT NULL,
        DESCALMOX CHAR(40) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQALMOXPK PRIMARY KEY (CODALMOX, CODFILIAL, CODEMP));

/* Table: EQFATCONV, Owner: SYSDBA */
CREATE TABLE EQFATCONV (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        CODUNID CHAR(8) NOT NULL,
        FATCONV NUMERIC(10, 3) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQFATCONVPK PRIMARY KEY (CODUNID, CODPROD, CODFILIAL, CODEMP));

/* Table: EQGRUPO, Owner: SYSDBA */
CREATE TABLE EQGRUPO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODGRUP CHAR(14) NOT NULL,
        DESCGRUP CHAR(50) NOT NULL,
        NIVELGRUP INTEGER,
        CODEMPSG INTEGER,
        CODFILIALSG SMALLINT,
        CODSUBGRUP CHAR(14),
        SIGLAGRUP CHAR(10),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQGRUPOPK PRIMARY KEY (CODGRUP, CODFILIAL, CODEMP));

/* Table: EQINVPROD, Owner: SYSDBA */
CREATE TABLE EQINVPROD (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODINVPROD INTEGER NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        CODEMPLE INTEGER,
        CODFILIALLE SMALLINT,
        CODLOTE CHAR(13),
        CODEMPTM INTEGER NOT NULL,
        CODFILIALTM SMALLINT NOT NULL,
        CODTIPOMOV INTEGER NOT NULL,
        DATAINVP DATE NOT NULL,
        QTDINVP NUMERIC(15, 3) NOT NULL,
        PRECOINVP NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        CODEMPAX INTEGER NOT NULL,
        CODFILIALAX SMALLINT NOT NULL,
        CODALMOX INTEGER NOT NULL,
        REFPROD CHAR(13),
        SLDATUALINVP NUMERIC(15, 3),
        SLDDIGINVP NUMERIC(15, 3),
        FLAG CHAR(1) DEFAULT 'S',
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQINVPRODPK PRIMARY KEY (CODINVPROD, CODFILIAL, CODEMP));

/* Table: EQITMODGRADE, Owner: SYSDBA */
CREATE TABLE EQITMODGRADE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODMODG INTEGER NOT NULL,
        CODITMODG INTEGER NOT NULL,
        REFITMODG CHAR(6),
        CODEMPVG INTEGER NOT NULL,
        CODFILIALVG SMALLINT NOT NULL,
        CODVARG INTEGER NOT NULL,
        CODFABITMODG CHAR(6),
        CODBARITMODG CHAR(6),
        DESCITMODG CHAR(20) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQITMODGRADEPK PRIMARY KEY (CODITMODG, CODMODG, CODFILIAL, CODEMP));

/* Table: EQITRMA, Owner: SYSDBA */
CREATE TABLE EQITRMA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODRMA INTEGER NOT NULL,
        CODITRMA SMALLINT NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        QTDITRMA NUMERIC(15, 3) NOT NULL,
        PRECOITRMA NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        SITGERITRMA CHAR(2) DEFAULT '00' NOT NULL,
        SITDIRITRMA CHAR(2) DEFAULT '00' NOT NULL,
        SITEXPITRMA CHAR(2) DEFAULT '00' NOT NULL,
        QTDAGERITRMA NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        QTDADIRITRMA NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        QTDEXPITRMA NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        CODEMPLE INTEGER,
        CODFILIALLE SMALLINT,
        CODLOTE CHAR(13),
        REFPROD CHAR(13),
        DTAAGERITRMA DATE,
        DTAADIRITRMA DATE,
        DTAEXPITRMA DATE,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQITRMAPK PRIMARY KEY (CODRMA, CODITRMA, CODFILIAL, CODEMP));

/* Table: EQLANCTOEXP, Owner: SYSDBA */
CREATE TABLE EQLANCTOEXP (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODLEXP INTEGER NOT NULL,
        CODEMPTE INTEGER NOT NULL,
        CODFILIALTE SMALLINT NOT NULL,
        CODTIPOEXP INTEGER NOT NULL,
        CODEMPCL INTEGER NOT NULL,
        CODFILIALCL SMALLINT NOT NULL,
        CODCLI INTEGER NOT NULL,
        DTLEXP DATE NOT NULL,
        QTDLEXP INTEGER NOT NULL,
        DTRETLEXP DATE,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQLANCTOEXPPK PRIMARY KEY (CODLEXP, CODFILIAL, CODEMP));

/* Table: EQLOTE, Owner: SYSDBA */
CREATE TABLE EQLOTE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        CODLOTE CHAR(13) NOT NULL,
        VENCTOLOTE DATE NOT NULL,
        SLDLOTE NUMERIC(15, 3),
        SLDRESLOTE NUMERIC(15, 3),
        SLDCONSIGLOTE NUMERIC(15, 3),
        SLDLIQLOTE NUMERIC(15, 3),
        DINILOTE DATE,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQLOTEPK PRIMARY KEY (CODLOTE, CODPROD, CODFILIAL, CODEMP));

/* Table: EQMARCA, Owner: SYSDBA */
CREATE TABLE EQMARCA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODMARCA CHAR(6) NOT NULL,
        DESCMARCA CHAR(40) NOT NULL,
        SIGLAMARCA CHAR(20),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQMARCAPK PRIMARY KEY (CODMARCA, CODFILIAL, CODEMP));

/* Table: EQMODGRADE, Owner: SYSDBA */
CREATE TABLE EQMODGRADE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODMODG INTEGER NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        DESCMODG CHAR(40) NOT NULL,
        DESCPRODMODG CHAR(20) NOT NULL,
        REFMODG CHAR(10) NOT NULL,
        CODFABMODG CHAR(10) NOT NULL,
        CODBARMODG CHAR(10) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQMODGRADEPK PRIMARY KEY (CODMODG, CODFILIAL, CODEMP));

/* Table: EQMOVEXP, Owner: SYSDBA */
CREATE TABLE EQMOVEXP (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODMOVEXP INTEGER NOT NULL,
        CODEMPTE INTEGER NOT NULL,
        CODFILIALTE SMALLINT NOT NULL,
        CODTIPOEXP INTEGER NOT NULL,
        CODEMPCL INTEGER NOT NULL,
        CODFILIALCL SMALLINT NOT NULL,
        CODCLI INTEGER NOT NULL,
        DTSAIMOVEXP DATE NOT NULL,
        QTDMOVEXP INTEGER NOT NULL,
        DTENTMOVEXP DATE,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQMOVEXPPK PRIMARY KEY (CODMOVEXP, CODFILIAL, CODEMP));

/* Table: EQMOVPROD, Owner: SYSDBA */
CREATE TABLE EQMOVPROD (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODMOVPROD INTEGER NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        CODEMPVD INTEGER,
        CODFILIALVD SMALLINT,
        TIPOVENDA CHAR(1),
        CODVENDA INTEGER,
        CODITVENDA INTEGER,
        CODEMPLE INTEGER,
        CODFILIALLE SMALLINT,
        CODLOTE CHAR(13),
        CODEMPTM INTEGER NOT NULL,
        CODFILIALTM SMALLINT NOT NULL,
        CODTIPOMOV INTEGER NOT NULL,
        CODEMPCP INTEGER,
        CODFILIALCP SMALLINT,
        CODCOMPRA INTEGER,
        CODITCOMPRA INTEGER,
        CODEMPIV INTEGER,
        CODFILIALIV SMALLINT,
        CODINVPROD INTEGER,
        DTMOVPROD DATE NOT NULL,
        TIPOMOVPROD CHAR(1) NOT NULL,
        ESTOQMOVPROD CHAR(1) DEFAULT 'S' NOT NULL,
        QTDMOVPROD NUMERIC(15, 3) NOT NULL,
        CUSTOMPMMOVPROD NUMERIC(15, 3) DEFAULT 0,
        FLAG CHAR(1) DEFAULT 'N',
        CODEMPNT INTEGER,
        CODFILIALNT SMALLINT,
        CODNAT CHAR(4),
        DOCMOVPROD INTEGER,
        PRECOMOVPROD NUMERIC(15, 3),
        SLDMOVPROD NUMERIC(15, 3),
        CODEMPRM INTEGER,
        CODFILIALRM SMALLINT,
        CODRMA INTEGER,
        CODITRMA SMALLINT,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQMOVPRODPK PRIMARY KEY (CODMOVPROD, CODFILIAL, CODEMP));

/* Table: EQPRODUTO, Owner: SYSDBA */
CREATE TABLE EQPRODUTO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        DESCPROD CHAR(50) NOT NULL,
        REFPROD CHAR(13) NOT NULL,
        CODEMPAX INTEGER NOT NULL,
        CODFILIALAX SMALLINT NOT NULL,
        CODALMOX INTEGER NOT NULL,
        CODEMPMA INTEGER NOT NULL,
        CODFILIALMA SMALLINT NOT NULL,
        CODMOEDA CHAR(4) NOT NULL,
        CODEMPUD INTEGER NOT NULL,
        CODFILIALUD SMALLINT NOT NULL,
        CODUNID CHAR(8) NOT NULL,
        CODEMPFC INTEGER NOT NULL,
        CODFILIALFC SMALLINT NOT NULL,
        CODFISC CHAR(13) NOT NULL,
        CODEMPMC INTEGER NOT NULL,
        CODFILIALMC SMALLINT NOT NULL,
        CODMARCA CHAR(6) NOT NULL,
        DESCAUXPROD CHAR(40),
        TIPOPROD CHAR(1) NOT NULL,
        CVPROD CHAR(1) NOT NULL,
        CODEMPGP INTEGER NOT NULL,
        CODFILIALGP SMALLINT NOT NULL,
        CODGRUP CHAR(14) NOT NULL,
        CODBARPROD CHAR(13),
        CLOTEPROD CHAR(1) NOT NULL,
        CODFABPROD CHAR(13),
        COMISPROD NUMERIC(6, 2),
        PESOLIQPROD NUMERIC(10, 3),
        PESOBRUTPROD NUMERIC(10, 3),
        QTDMINPROD NUMERIC(15, 3),
        QTDMAXPROD NUMERIC(15, 3),
        DTMPMPROD DATE,
        CUSTOMPMPROD NUMERIC(15, 3) DEFAULT 0,
        CUSTOPEPSPROD NUMERIC(15, 3) DEFAULT 0,
        PRECOBASEPROD NUMERIC(15, 3),
        SLDPROD NUMERIC(15, 3),
        SLDRESPROD NUMERIC(15, 3),
        SLDCONSIGPROD NUMERIC(15, 3),
        SLDLIQPROD NUMERIC(15, 3),
        ATIVOPROD CHAR(1) DEFAULT 'S',
        DTULTCPPROD DATE,
        QTDULTCPPROD NUMERIC(15, 3),
        DESCCOMPPROD VARCHAR(500),
        VERIFPROD CHAR(1) DEFAULT 'S',
        LOCALPROD CHAR(15),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQPRODUTOPK PRIMARY KEY (CODPROD, CODFILIAL, CODEMP));

/* Table: EQRMA, Owner: SYSDBA */
CREATE TABLE EQRMA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODRMA INTEGER NOT NULL,
        CODEMPCC INTEGER NOT NULL,
        CODFILIALCC SMALLINT NOT NULL,
        ANOCC SMALLINT NOT NULL,
        CODCC CHAR(19) NOT NULL,
        CODEMPUU INTEGER NOT NULL,
        CODFILIALUU SMALLINT NOT NULL,
        IDUSU CHAR(8) NOT NULL,
        SITGERRMA CHAR(2) DEFAULT '00' NOT NULL,
        SITDIRRMA CHAR(2) DEFAULT '00' NOT NULL,
        SITEXPRMA CHAR(2) DEFAULT '00' NOT NULL,
        DTAREQRMA DATE DEFAULT 'today' NOT NULL,
        CODEMPTM INTEGER NOT NULL,
        CODFILIALTM SMALLINT NOT NULL,
        CODTIPOMOV INTEGER NOT NULL,
        DTAEXPRMA DATE,
        CODEMPUG INTEGER,
        CODFILIALUG SMALLINT,
        IDUSUG CHAR(8),
        CODEMPUD INTEGER,
        CODFILIALUD SMALLINT,
        IDUSUD CHAR(8),
        DTAAGERRMA DATE,
        DTAADIRRMA DATE,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQRMAPK PRIMARY KEY (CODRMA, CODFILIAL, CODEMP));

/* Table: EQRMAAL, Owner: SYSDBA */
CREATE TABLE EQRMAAL (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODRMA INTEGER NOT NULL,
        TIPORMAAL CHAR(1) DEFAULT 'L' NOT NULL,
        CODEMPUU INTEGER NOT NULL,
        CODFILIALUU SMALLINT NOT NULL,
        IDUSU CHAR(8) NOT NULL,
CONSTRAINT EQRMAALPK PRIMARY KEY (CODRMA, TIPORMAAL, CODFILIAL, CODEMP, IDUSU, CODFILIALUU, CODEMPUU));

/* Table: EQSALDOPROD, Owner: SYSDBA */
CREATE TABLE EQSALDOPROD (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        SLDPROD NUMERIC(15, 3),
        CODEMPAX INTEGER NOT NULL,
        CODFILIALAX SMALLINT NOT NULL,
        CODALMOX INTEGER NOT NULL,
        SLDRESPROD NUMERIC(15, 3),
        SLDCONSIGPROD NUMERIC(15, 3),
        SLDLIQPROD NUMERIC(15, 3),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQSALDOPRODPK PRIMARY KEY (CODALMOX, CODPROD, CODFILIAL, CODEMP));

/* Table: EQSIMILAR, Owner: SYSDBA */
CREATE TABLE EQSIMILAR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        REFPRODSIM CHAR(21) NOT NULL,
        CODEMPPD INTEGER,
        CODFILIALPD SMALLINT,
        CODPROD INTEGER,
        REFPROD CHAR(13),
        REFPRODSIMFK CHAR(21),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQSIMILARPK PRIMARY KEY (REFPRODSIM, CODFILIAL, CODEMP));

/* Table: EQTIPOEXP, Owner: SYSDBA */
CREATE TABLE EQTIPOEXP (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTIPOEXP INTEGER NOT NULL,
        DESCTIPOEXP CHAR(40) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQTIPOEXPPK PRIMARY KEY (CODTIPOEXP, CODFILIAL, CODEMP));

/* Table: EQTIPOMOV, Owner: SYSDBA */
CREATE TABLE EQTIPOMOV (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTIPOMOV INTEGER NOT NULL,
        CODEMPMN INTEGER NOT NULL,
        CODFILIALMN SMALLINT NOT NULL,
        CODMODNOTA INTEGER NOT NULL,
        CODEMPSE INTEGER NOT NULL,
        CODFILIALSE SMALLINT NOT NULL,
        SERIE CHAR(4) NOT NULL,
        DESCTIPOMOV CHAR(40) NOT NULL,
        ESTIPOMOV CHAR(1) NOT NULL,
        FISCALTIPOMOV CHAR(1) NOT NULL,
        ESTOQTIPOMOV CHAR(1) NOT NULL,
        TIPOMOV CHAR(2) NOT NULL,
        CODEMPTB INTEGER,
        CODFILIALTB SMALLINT,
        CODTAB INTEGER,
        ESPECIETIPOMOV CHAR(4),
        CODEMPTM INTEGER,
        CODFILIALTM SMALLINT,
        CODTIPOMOVTM INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQTIPOMOVPK PRIMARY KEY (CODTIPOMOV, CODFILIAL, CODEMP));

/* Table: EQUNIDADE, Owner: SYSDBA */
CREATE TABLE EQUNIDADE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODUNID CHAR(8) NOT NULL,
        DESCUNID CHAR(40) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQUNIDADEPK PRIMARY KEY (CODUNID, CODFILIAL, CODEMP));

/* Table: EQVARGRADE, Owner: SYSDBA */
CREATE TABLE EQVARGRADE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODVARG INTEGER NOT NULL,
        DESCVARG CHAR(30) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT EQVARGRADEPK PRIMARY KEY (CODVARG, CODFILIAL, CODEMP));

/* Table: FNBANCO, Owner: SYSDBA */
CREATE TABLE FNBANCO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODBANCO CHAR(3) NOT NULL,
        NOMEBANCO CHAR(40) NOT NULL,
        CODEMPMB INTEGER,
        CODFILIALMB INTEGER,
        CODMODBOL INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNBANCOPK PRIMARY KEY (CODBANCO, CODFILIAL, CODEMP));

/* Table: FNCC, Owner: SYSDBA */
CREATE TABLE FNCC (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        ANOCC SMALLINT NOT NULL,
        CODCC CHAR(19) NOT NULL,
        DESCCC CHAR(50) NOT NULL,
        NIVELCC INTEGER NOT NULL,
        CODREDCC INTEGER,
        CODEMPSCC INTEGER,
        CODFILIALSCC SMALLINT,
        ANOSCC SMALLINT,
        CODSUBCC CHAR(19),
        SIGLACC CHAR(10) DEFAULT '' NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNCCPK PRIMARY KEY (CODCC, ANOCC, CODFILIAL, CODEMP));

/* Table: FNCONTA, Owner: SYSDBA */
CREATE TABLE FNCONTA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        NUMCONTA CHAR(10) NOT NULL,
        DESCCONTA CHAR(50) NOT NULL,
        CODEMPMA INTEGER NOT NULL,
        CODFILIALMA SMALLINT NOT NULL,
        CODMOEDA CHAR(4) NOT NULL,
        CODEMPBO INTEGER,
        CODFILIALBO SMALLINT,
        CODBANCO CHAR(3),
        CODEMPPN INTEGER NOT NULL,
        CODFILIALPN SMALLINT NOT NULL,
        CODPLAN CHAR(13) NOT NULL,
        TIPOCONTA CHAR(1) NOT NULL,
        DATACONTA DATE NOT NULL,
        AGENCIACONTA CHAR(6),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNCONTAPK PRIMARY KEY (NUMCONTA, CODFILIAL, CODEMP));

/* Table: FNCOTMOEDA, Owner: SYSDBA */
CREATE TABLE FNCOTMOEDA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODMOEDA CHAR(4) NOT NULL,
        DATACOT DATE NOT NULL,
        VALORCOT NUMERIC(15, 3) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNCOTMOEDAPK PRIMARY KEY (DATACOT, CODMOEDA, CODFILIAL, CODEMP));

/* Table: FNITPAGAR, Owner: SYSDBA */
CREATE TABLE FNITPAGAR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPAG INTEGER NOT NULL,
        NPARCPAG INTEGER NOT NULL,
        VLRITPAG NUMERIC(15, 3) NOT NULL,
        VLRDESCITPAG NUMERIC(15, 3),
        VLRMULTAITPAG NUMERIC(15, 3),
        VLRJUROSITPAG NUMERIC(15, 3),
        VLRPARCITPAG NUMERIC(15, 3) NOT NULL,
        VLRPAGOITPAG NUMERIC(15, 3),
        VLRAPAGITPAG NUMERIC(15, 3),
        DTITPAG DATE NOT NULL,
        DTVENCITPAG DATE NOT NULL,
        DTPAGOITPAG DATE,
        STATUSITPAG CHAR(2) NOT NULL,
        CODEMPCA INTEGER,
        CODFILIALCA SMALLINT,
        NUMCONTA CHAR(10),
        CODEMPPN INTEGER,
        CODFILIALPN SMALLINT,
        CODPLAN CHAR(13),
        DOCLANCAITPAG CHAR(10),
        OBSITPAG CHAR(50),
        VLRADICITPAG NUMERIC(15, 3) DEFAULT 0,
        FLAG CHAR(1) DEFAULT 'N',
        CODEMPCC INTEGER,
        CODFILIALCC SMALLINT,
        ANOCC SMALLINT,
        CODCC CHAR(19),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNITPAGARPK PRIMARY KEY (NPARCPAG, CODPAG, CODFILIAL, CODEMP));

/* Table: FNITRECEBER, Owner: SYSDBA */
CREATE TABLE FNITRECEBER (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODREC INTEGER NOT NULL,
        NPARCITREC INTEGER NOT NULL,
        VLRITREC NUMERIC(15, 3) NOT NULL,
        VLRDESCITREC NUMERIC(15, 3),
        VLRMULTAITREC NUMERIC(15, 3),
        VLRJUROSITREC NUMERIC(15, 3),
        VLRPARCITREC NUMERIC(15, 3),
        VLRPAGOITREC NUMERIC(15, 3),
        VLRAPAGITREC NUMERIC(15, 3),
        DTITREC DATE NOT NULL,
        DTVENCITREC DATE NOT NULL,
        DTPAGOITREC DATE,
        STATUSITREC CHAR(2) NOT NULL,
        CODEMPPN INTEGER,
        CODFILIALPN SMALLINT,
        CODPLAN CHAR(13),
        OBSITREC VARCHAR(250),
        CODEMPCA INTEGER,
        CODFILIALCA SMALLINT,
        NUMCONTA CHAR(10),
        CODEMPBO INTEGER,
        CODFILIALBO SMALLINT,
        CODBANCO CHAR(3),
        DOCLANCAITREC CHAR(10),
        FLAG CHAR(1) DEFAULT 'N',
        CODEMPCC INTEGER,
        CODFILIALCC SMALLINT,
        ANOCC SMALLINT,
        CODCC CHAR(19),
        VLRCOMIITREC NUMERIC(15, 3) DEFAULT 0,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
        ALTUSUITREC CHAR(1) DEFAULT 'S' NOT NULL,
CONSTRAINT FNITRECEBERPK PRIMARY KEY (NPARCITREC, CODREC, CODFILIAL, CODEMP));

/* Table: FNITTBJUROS, Owner: SYSDBA */
CREATE TABLE FNITTBJUROS (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTBJ INTEGER NOT NULL,
        ANOITTBJ SMALLINT NOT NULL,
        MESITTBJ SMALLINT NOT NULL,
        PERCITTBJ NUMERIC(7, 3) DEFAULT 0 NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNITTBJUROSPK PRIMARY KEY (CODTBJ, MESITTBJ, ANOITTBJ, CODFILIAL, CODEMP));

/* Table: FNLANCA, Owner: SYSDBA */
CREATE TABLE FNLANCA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODLANCA INTEGER NOT NULL,
        CODCOMI INTEGER,
        CODEMPPG INTEGER,
        CODFILIALPG SMALLINT,
        CODPAG INTEGER,
        NPARCPAG INTEGER,
        CODEMPRC INTEGER,
        CODFILIALRC SMALLINT,
        CODREC INTEGER,
        NPARCITREC INTEGER,
        CODEMPPN INTEGER NOT NULL,
        CODFILIALPN SMALLINT NOT NULL,
        CODPLAN CHAR(13) NOT NULL,
        DATALANCA DATE NOT NULL,
        DOCLANCA CHAR(15),
        HISTBLANCA CHAR(50) NOT NULL,
        HISTLANCA VARCHAR(10000),
        TRANSFLANCA CHAR(1) DEFAULT 'N',
        STATUSLANCA CHAR(2),
        DTPREVLANCA DATE,
        DTPREVSUBLANCA DATE,
        VLRLANCA NUMERIC(15, 3) DEFAULT 0,
        CODEMPCI INTEGER,
        CODFILIALCI SMALLINT,
        CODPCOMI INTEGER,
        FLAG CHAR(1) DEFAULT 'N',
        TIPOLANCA CHAR(1) DEFAULT 'A' NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNLANCAPK PRIMARY KEY (CODLANCA, CODFILIAL, CODEMP));

/* Table: FNLIBCRED, Owner: SYSDBA */
CREATE TABLE FNLIBCRED (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODLCRED INTEGER NOT NULL,
        CODVENDA INTEGER NOT NULL,
        DTAEMITLCRED DATE DEFAULT 'now' NOT NULL,
        VLRAUTORIZLCRED NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        VLRUTILLCRED NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        CODEMPUS INTEGER,
        CODFILIALUS SMALLINT,
        IDUSU CHAR(8),
        DTAUTILLCRED DATE,
        SITLCRED CHAR(1) DEFAULT 'L' NOT NULL,
        CODEMPCL INTEGER NOT NULL,
        CODFILIALCL SMALLINT NOT NULL,
        CODCLI INTEGER NOT NULL,
        DTAVCTOLCRED DATE DEFAULT 'today' NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNLIBCREDPK PRIMARY KEY (CODLCRED, CODFILIAL, CODEMP));

/* Table: FNMODBOLETO, Owner: SYSDBA */
CREATE TABLE FNMODBOLETO (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        CODMODBOL INTEGER NOT NULL,
        DESCMODBOL CHAR(30) NOT NULL,
        TXAMODBOL VARCHAR(10000) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNMODBOLETOPK PRIMARY KEY (CODMODBOL, CODFILIAL, CODEMP));

/* Table: FNMOEDA, Owner: SYSDBA */
CREATE TABLE FNMOEDA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODMOEDA CHAR(4) NOT NULL,
        TIPOMOEDA CHAR(1) NOT NULL,
        ATUALIZAMOEDA CHAR(1) NOT NULL,
        SINGMOEDA CHAR(20) NOT NULL,
        PLURMOEDA CHAR(20) NOT NULL,
        DECSMOEDA CHAR(20),
        DECPMOEDA CHAR(20),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNMOEDAPK PRIMARY KEY (CODMOEDA, CODFILIAL, CODEMP));

/* Table: FNPAGAR, Owner: SYSDBA */
CREATE TABLE FNPAGAR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPAG INTEGER NOT NULL,
        CODEMPCP INTEGER,
        CODFILIALCP SMALLINT,
        CODCOMPRA INTEGER,
        CODEMPPG INTEGER NOT NULL,
        CODFILIALPG SMALLINT NOT NULL,
        CODPLANOPAG INTEGER NOT NULL,
        CODEMPFR INTEGER NOT NULL,
        CODFILIALFR SMALLINT NOT NULL,
        CODFOR INTEGER NOT NULL,
        CODEMPBO INTEGER,
        CODFILIALBO SMALLINT,
        CODBANCO CHAR(3),
        VLRDESCPAG NUMERIC(15, 3),
        VLRMULTAPAG NUMERIC(15, 3),
        VLRJUROSPAG NUMERIC(15, 3),
        VLRPARCPAG NUMERIC(15, 3) NOT NULL,
        VLRPAGOPAG NUMERIC(15, 3),
        VLRAPAGPAG NUMERIC(15, 3),
        DATAPAG DATE,
        STATUSPAG CHAR(2) NOT NULL,
        DTQUITPAG DATE,
        DOCPAG INTEGER NOT NULL,
        VLRPAG NUMERIC(15, 3) DEFAULT 0,
        NROPARCPAG INTEGER DEFAULT 0,
        OBSPAG CHAR(50),
        VLRADICPAG NUMERIC(15, 3) DEFAULT 0,
        FLAG CHAR(1) DEFAULT 'N',
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNPAGARPK PRIMARY KEY (CODPAG, CODFILIAL, CODEMP));

/* Table: FNPAGTOCOMI, Owner: SYSDBA */
CREATE TABLE FNPAGTOCOMI (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPCOMI INTEGER NOT NULL,
        CODEMPPN INTEGER NOT NULL,
        CODFILIALPN SMALLINT NOT NULL,
        CODPLAN CHAR(13) NOT NULL,
        CODEMPCA INTEGER NOT NULL,
        CODFILIALCA SMALLINT NOT NULL,
        NUMCONTA CHAR(10) NOT NULL,
        VLRPCOMI NUMERIC(15, 3) DEFAULT 0,
        DOCPCOMI INTEGER NOT NULL,
        OBSPCOMI CHAR(50),
        DATAPCOMI DATE NOT NULL,
        FLAG CHAR(1) DEFAULT 'N',
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNPAGTOCOMIPK PRIMARY KEY (CODPCOMI, CODFILIAL, CODEMP));

/* Table: FNPARCPAG, Owner: SYSDBA */
CREATE TABLE FNPARCPAG (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPLANOPAG INTEGER NOT NULL,
        NROPARCPAG INTEGER NOT NULL,
        PERCPAG NUMERIC(7, 6),
        DIASPAG INTEGER,
        DESCPARCPAG CHAR(30),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNPARCPAGPK PRIMARY KEY (NROPARCPAG, CODPLANOPAG, CODFILIAL, CODEMP));

/* Table: FNPLANEJAMENTO, Owner: SYSDBA */
CREATE TABLE FNPLANEJAMENTO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPLAN CHAR(13) NOT NULL,
        DESCPLAN CHAR(50) NOT NULL,
        NIVELPLAN INTEGER NOT NULL,
        CODREDPLAN INTEGER,
        CODEMPSP INTEGER,
        CODFILIALSP SMALLINT,
        CODSUBPLAN CHAR(13),
        TIPOPLAN CHAR(1) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNPLANEJAMENTOPK PRIMARY KEY (CODPLAN, CODFILIAL, CODEMP));

/* Table: FNPLANOPAG, Owner: SYSDBA */
CREATE TABLE FNPLANOPAG (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPLANOPAG INTEGER NOT NULL,
        DESCPLANOPAG CHAR(40),
        PARCPLANOPAG INTEGER NOT NULL,
        AUTOBAIXAPLANOPAG CHAR(1) DEFAULT 'N',
        CODEMPCA INTEGER,
        CODFILIALCA SMALLINT,
        NUMCONTA CHAR(10),
        CODEMPPN INTEGER,
        CODFILIALPN SMALLINT,
        CODPLAN CHAR(13),
        CODEMPCC INTEGER,
        CODFILIALCC SMALLINT,
        ANOCC SMALLINT,
        CODCC CHAR(19),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNPLANOPAGPK PRIMARY KEY (CODPLANOPAG, CODFILIAL, CODEMP));

/* Table: FNRECEBER, Owner: SYSDBA */
CREATE TABLE FNRECEBER (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODREC INTEGER NOT NULL,
        CODEMPBO INTEGER,
        CODFILIALBO SMALLINT,
        CODBANCO CHAR(3),
        CODEMPPG INTEGER NOT NULL,
        CODFILIALPG SMALLINT NOT NULL,
        CODPLANOPAG INTEGER NOT NULL,
        CODEMPCL INTEGER NOT NULL,
        CODFILIALCL SMALLINT NOT NULL,
        CODCLI INTEGER NOT NULL,
        CODEMPVD INTEGER,
        CODFILIALVD SMALLINT,
        CODVEND INTEGER,
        CODEMPVA INTEGER,
        CODFILIALVA SMALLINT,
        TIPOVENDA CHAR(1),
        CODVENDA INTEGER,
        VLRREC NUMERIC(15, 3) NOT NULL,
        VLRDESCREC NUMERIC(15, 3),
        VLRMULTAREC NUMERIC(15, 3),
        VLRJUROSREC NUMERIC(15, 3),
        VLRPARCREC NUMERIC(15, 3) NOT NULL,
        VLRPAGOREC NUMERIC(15, 3),
        VLRAPAGREC NUMERIC(15, 3),
        DATAREC DATE NOT NULL,
        STATUSREC CHAR(2) NOT NULL,
        VLRCOMIREC NUMERIC(15, 3),
        DTQUITREC DATE,
        DOCREC INTEGER NOT NULL,
        NROPARCREC INTEGER DEFAULT 0,
        OBSREC VARCHAR(250),
        FLAG CHAR(1) DEFAULT 'N',
        ALTUSUREC CHAR(1) DEFAULT 'N',
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNRECEBERPK PRIMARY KEY (CODREC, CODFILIAL, CODEMP));

/* Table: FNSALDOLANCA, Owner: SYSDBA */
CREATE TABLE FNSALDOLANCA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODEMPPN INTEGER NOT NULL,
        CODFILIALPN INTEGER NOT NULL,
        CODPLAN CHAR(13) NOT NULL,
        DATASL DATE NOT NULL,
        PREVSL NUMERIC(15, 3),
        SALDOSL NUMERIC(15, 3) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNSALDOLANCAPK PRIMARY KEY (DATASL, CODFILIALPN, CODEMPPN, CODPLAN, CODFILIAL, CODEMP));

/* Table: FNSUBLANCA, Owner: SYSDBA */
CREATE TABLE FNSUBLANCA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODLANCA INTEGER NOT NULL,
        CODSUBLANCA INTEGER NOT NULL,
        CODEMPPN INTEGER NOT NULL,
        CODFILIALPN SMALLINT NOT NULL,
        CODPLAN CHAR(13) NOT NULL,
        STATUSSUBLANCA CHAR(2) NOT NULL,
        ORIGSUBLANCA CHAR(1),
        DTPREVSUBLANCA DATE,
        DATASUBLANCA DATE,
        VLRSUBLANCA NUMERIC(15, 3) DEFAULT 0,
        FLAG CHAR(1) DEFAULT 'N',
        CODEMPCC INTEGER,
        CODFILIALCC SMALLINT,
        ANOCC SMALLINT,
        CODCC CHAR(19),
        CODEMPCL INTEGER,
        CODFILIALCL SMALLINT,
        CODCLI INTEGER,
        CODEMPFR INTEGER,
        CODFILIALFR SMALLINT,
        CODFOR INTEGER,
        HISTSUBLANCA CHAR(50),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNSUBLANCAPK PRIMARY KEY (CODSUBLANCA, CODLANCA, CODFILIAL, CODEMP));

/* Table: FNTBJUROS, Owner: SYSDBA */
CREATE TABLE FNTBJUROS (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTBJ INTEGER NOT NULL,
        DESCTBJ CHAR(50) NOT NULL,
        TIPOTBJ CHAR(1) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNTBJUROSPK PRIMARY KEY (CODTBJ, CODFILIAL, CODEMP));

/* Table: FNTIPOCOB, Owner: SYSDBA */
CREATE TABLE FNTIPOCOB (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTIPOCOB INTEGER NOT NULL,
        DESCTIPOCOB CHAR(40) NOT NULL,
        DUPLCOB CHAR(8),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNTIPOCOBPK PRIMARY KEY (CODTIPOCOB, CODFILIAL, CODEMP));

/* Table: FNTIPOCRED, Owner: SYSDBA */
CREATE TABLE FNTIPOCRED (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTPCRED INTEGER NOT NULL,
        DESCTPCRED CHAR(50) NOT NULL,
        VLRTPCRED NUMERIC(15, 3) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT FNTIPOCREDPK PRIMARY KEY (CODTPCRED, CODFILIAL, CODEMP));

/* Table: LFCLFISCAL, Owner: SYSDBA */
CREATE TABLE LFCLFISCAL (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODFISC CHAR(13) NOT NULL,
        DESCFISC CHAR(50) NOT NULL,
        TIPOFISC CHAR(2) NOT NULL,
        ALIQFISC NUMERIC(6, 2),
        ALIQLFISC NUMERIC(6, 2),
        REDFISC NUMERIC(6, 2),
        ALIQIPIFISC NUMERIC(6, 2),
        CODEMPRA INTEGER NOT NULL,
        CODFILIALRA SMALLINT NOT NULL,
        CODREGRA CHAR(4) NOT NULL,
        ORIGFISC CHAR(1),
        CODEMPTT INTEGER,
        CODFILIALTT SMALLINT,
        CODTRATTRIB CHAR(2),
        CODEMPME INTEGER,
        CODFILIALME SMALLINT,
        CODMENS INTEGER,
        SITPISFISC CHAR(1) DEFAULT 'T',
        SITCOFINSFISC CHAR(1) DEFAULT 'T',
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFCLFISCALPK PRIMARY KEY (CODFISC, CODFILIAL, CODEMP));

/* Table: LFITCLFISCAL, Owner: SYSDBA */
CREATE TABLE LFITCLFISCAL (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        CODFISC CHAR(13) NOT NULL,
        CODITFISC INTEGER NOT NULL,
        ORIGFISC CHAR(1) NOT NULL,
        CODEMPTT INTEGER NOT NULL,
        CODFILIALTT INTEGER NOT NULL,
        TIPOFISC CHAR(2) NOT NULL,
        REDFISC NUMERIC(9, 2),
        CODTRATTRIB CHAR(2) NOT NULL,
        NOUFITFISC CHAR(1) CHARACTER SET WIN1252 DEFAULT 'N' NOT NULL,
        CODEMPFC INTEGER,
        CODFILIALFC INTEGER,
        CODFISCCLI INTEGER,
        ALIQFISC NUMERIC(9, 2),
        ALIQLFISC NUMERIC(9, 2),
        CODEMPME INTEGER,
        CODFILIALME SMALLINT,
        CODMENS INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFITCLFISCAL PRIMARY KEY (CODEMP, CODFILIAL, CODFISC, CODITFISC));

/* Table: LFITNATOPER, Owner: SYSDBA */
CREATE TABLE LFITNATOPER (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        CODNAT CHAR(4) NOT NULL,
        CODITNATOPER INTEGER NOT NULL,
        CODEMPTI INTEGER NOT NULL,
        CODFILIALTI INTEGER NOT NULL,
        UFTI CHAR(2) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFITNATOPER PRIMARY KEY (CODITNATOPER, CODNAT, CODFILIAL, CODEMP));

/* Table: LFITREGRAFISCAL, Owner: SYSDBA */
CREATE TABLE LFITREGRAFISCAL (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODREGRA CHAR(4) NOT NULL,
        CODNAT CHAR(4) NOT NULL,
        NOUFITRF CHAR(1) NOT NULL,
        CVITRF CHAR(1) NOT NULL,
        CODEMPTM INTEGER,
        CODFILIALTM SMALLINT,
        CODTIPOMOV INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFITREGRAFISCALPK PRIMARY KEY (CODNAT, CODREGRA, CODFILIAL, CODEMP));

/* Table: LFLIVROFISCAL, Owner: SYSDBA */
CREATE TABLE LFLIVROFISCAL (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        TIPOLF CHAR(1) NOT NULL,
        ANOMESLF CHAR(6) NOT NULL,
        CODLF INTEGER NOT NULL,
        CODEMPET INTEGER NOT NULL,
        CODFILIALET SMALLINT NOT NULL,
        CODEMITLF INTEGER NOT NULL,
        SERIELF CHAR(4) NOT NULL,
        DOCINILF INTEGER NOT NULL,
        DTEMITLF DATE NOT NULL,
        DTESLF DATE NOT NULL,
        CODEMPNT INTEGER,
        CODFILIALNT SMALLINT,
        CODNAT CHAR(4),
        DOCFIMLF INTEGER NOT NULL,
        ESPECIELF CHAR(3) NOT NULL,
        UFLF CHAR(2) NOT NULL,
        VLRCONTABILLF NUMERIC(15, 3) DEFAULT 0,
        VLRBASEICMSLF NUMERIC(15, 3) DEFAULT 0,
        ALIQICMSLF NUMERIC(7, 3) DEFAULT 0,
        VLRICMSLF NUMERIC(15, 3) DEFAULT 0,
        VLRISENTASICMSLF NUMERIC(15, 3) DEFAULT 0,
        VLROUTRASICMSLF NUMERIC(15, 3) DEFAULT 0,
        VLRBASEIPILF NUMERIC(15, 3) DEFAULT 0,
        ALIQIPILF NUMERIC(7, 3) DEFAULT 0,
        VLRIPILF NUMERIC(15, 3) DEFAULT 0,
        VLRISENTASIPILF NUMERIC(15, 3) DEFAULT 0,
        VLROUTRASIPILF NUMERIC(15, 3) DEFAULT 0,
        OBSLF CHAR(30),
        CODEMPMN INTEGER,
        CODFILIALMN SMALLINT,
        CODMODNOTA INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFLIVROFISCALPK PRIMARY KEY (CODLF, ANOMESLF, TIPOLF, CODFILIAL, CODEMP));

/* Table: LFMENSAGEM, Owner: SYSDBA */
CREATE TABLE LFMENSAGEM (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODMENS INTEGER NOT NULL,
        MENS VARCHAR(10000) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFMENSAGEMPK PRIMARY KEY (CODMENS, CODFILIAL, CODEMP));

/* Table: LFMODNOTA, Owner: SYSDBA */
CREATE TABLE LFMODNOTA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODMODNOTA INTEGER NOT NULL,
        DESCMODNOTA CHAR(30) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFMODNOTAPK PRIMARY KEY (CODMODNOTA, CODFILIAL, CODEMP));

/* Table: LFNATOPER, Owner: SYSDBA */
CREATE TABLE LFNATOPER (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODNAT CHAR(4) NOT NULL,
        DESCNAT CHAR(60) NOT NULL,
        IMPDTSAIDANAT CHAR(1) DEFAULT 'S' NOT NULL,
        ALIQENAT NUMERIC(6, 2) DEFAULT 0 NOT NULL,
        ALIQFNAT NUMERIC(6, 2) DEFAULT 0 NOT NULL,
        TXTNAT VARCHAR(500),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFNATOPERPK PRIMARY KEY (CODNAT, CODFILIAL, CODEMP));

/* Table: LFREGRAFISCAL, Owner: SYSDBA */
CREATE TABLE LFREGRAFISCAL (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODREGRA CHAR(4) NOT NULL,
        DESCREGRA CHAR(50),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFREGRAFISCALPK PRIMARY KEY (CODREGRA, CODFILIAL, CODEMP));

/* Table: LFSERIE, Owner: SYSDBA */
CREATE TABLE LFSERIE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        SERIE CHAR(4) NOT NULL,
        DOCSERIE INTEGER DEFAULT 1 NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFSERIEPK PRIMARY KEY (SERIE, CODFILIAL, CODEMP));

/* Table: LFTABICMS, Owner: SYSDBA */
CREATE TABLE LFTABICMS (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        UFTI CHAR(2) NOT NULL,
        ALIQTI NUMERIC(9, 2) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFTABICMSPK PRIMARY KEY (UFTI, CODFILIAL, CODEMP));

/* Table: LFTIPOFISCCLI, Owner: SYSDBA */
CREATE TABLE LFTIPOFISCCLI (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        CODFISCCLI INTEGER NOT NULL,
        DESCFISCCLI CHAR(40) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFTIPOFISCCLIPK PRIMARY KEY (CODFISCCLI, CODFILIAL, CODEMP));

/* Table: LFTRATTRIB, Owner: SYSDBA */
CREATE TABLE LFTRATTRIB (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTRATTRIB CHAR(2) NOT NULL,
        DESCTRATTRIB CHAR(60) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT LFTRATTRIBPK PRIMARY KEY (CODTRATTRIB, CODFILIAL, CODEMP));

/* Table: PPESTRUFASE, Owner: SYSDBA */
CREATE TABLE PPESTRUFASE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        SEQEF SMALLINT NOT NULL,
        CODEMPFS INTEGER NOT NULL,
        CODFILIALFS SMALLINT NOT NULL,
        CODFASE INTEGER NOT NULL,
        CODEMPTR INTEGER NOT NULL,
        CODFILIALTR SMALLINT NOT NULL,
        CODTPREC INTEGER NOT NULL,
        TEMPOEF NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PPESTRUFASEPK PRIMARY KEY (CODPROD, SEQEF, CODFILIAL, CODEMP));

/* Table: PPESTRUTURA, Owner: SYSDBA */
CREATE TABLE PPESTRUTURA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        DESCEST CHAR(50) NOT NULL,
        QTDEST NUMERIC(15, 3) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PPESTRUTURAPK PRIMARY KEY (CODPROD, CODFILIAL, CODEMP));

/* Table: PPFASE, Owner: SYSDBA */
CREATE TABLE PPFASE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODFASE INTEGER NOT NULL,
        DESCFASE CHAR(50) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        TIPOFASE CHAR(2) NOT NULL,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PPFASEPK PRIMARY KEY (CODFASE, CODFILIAL, CODEMP));

/* Table: PPITESTRUTURA, Owner: SYSDBA */
CREATE TABLE PPITESTRUTURA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        SEQITEST SMALLINT NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPRODPD INTEGER NOT NULL,
        CODEMPFS INTEGER NOT NULL,
        CODFILIALFS SMALLINT NOT NULL,
        CODFASE INTEGER NOT NULL,
        QTDITEST NUMERIC(15, 3) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PPITESTRUTURAPK PRIMARY KEY (CODPROD, SEQITEST, CODFILIAL, CODEMP));

/* Table: PPITOP, Owner: SYSDBA */
CREATE TABLE PPITOP (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODOP INTEGER NOT NULL,
        SEQITOP SMALLINT NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        QTDITOP NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        CODEMPFS INTEGER NOT NULL,
        CODFILIALFS SMALLINT NOT NULL,
        CODFASE INTEGER NOT NULL,
        CODEMPLE INTEGER,
        CODFILIALLE SMALLINT,
        CODLOTE CHAR(13),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PPITOPPK PRIMARY KEY (CODOP, SEQITOP, CODFILIAL, CODEMP));

/* Table: PPOP, Owner: SYSDBA */
CREATE TABLE PPOP (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODOP INTEGER NOT NULL,
        DTEMITOP DATE NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        REFPROD CHAR(13) NOT NULL,
        DTFABROP DATE NOT NULL,
        QTDPRODOP NUMERIC(15, 3) NOT NULL,
        DTVALIDPDOP DATE NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        SITOP CHAR(2) DEFAULT 'II' NOT NULL,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PPOPPK PRIMARY KEY (CODOP, CODFILIAL, CODEMP));

/* Table: PPOPFASE, Owner: SYSDBA */
CREATE TABLE PPOPFASE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODOP INTEGER NOT NULL,
        SEQOF SMALLINT NOT NULL,
        CODEMPFS INTEGER NOT NULL,
        CODFILIALFS SMALLINT NOT NULL,
        CODFASE INTEGER NOT NULL,
        CODEMPRP INTEGER NOT NULL,
        CODFILIALRP SMALLINT NOT NULL,
        CODRECP INTEGER NOT NULL,
        TEMPOOF NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PPOPFASEPK PRIMARY KEY (CODOP, SEQOF, CODFILIAL, CODEMP));

/* Table: PPRECURSO, Owner: SYSDBA */
CREATE TABLE PPRECURSO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODRECP INTEGER NOT NULL,
        DESCRECP CHAR(50) NOT NULL,
        CODEMPTR INTEGER NOT NULL,
        CODFILIALTR SMALLINT NOT NULL,
        CODTPREC INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PPRECURSOPK PRIMARY KEY (CODRECP, CODFILIAL, CODEMP));

/* Table: PPTIPOREC, Owner: SYSDBA */
CREATE TABLE PPTIPOREC (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTPREC INTEGER NOT NULL,
        DESCTPREC CHAR(50) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PPTIPORECPK PRIMARY KEY (CODTPREC, CODFILIAL, CODEMP));

/* Table: PVCAIXA, Owner: SYSDBA */
CREATE TABLE PVCAIXA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCAIXA INTEGER NOT NULL,
        DESCCAIXA CHAR(40) NOT NULL,
        ECFCAIXA CHAR(1) NOT NULL,
        MODODEMO CHAR(1) DEFAULT 'S' NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PVCAIXAPK PRIMARY KEY (CODCAIXA, CODFILIAL, CODEMP));

/* Table: PVCAIXAIMP, Owner: SYSDBA */
CREATE TABLE PVCAIXAIMP (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCAIXA INTEGER NOT NULL,
        CODIMP INTEGER NOT NULL,
        IMPPAD CHAR(1),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PVCAIXAIMPPK PRIMARY KEY (CODIMP, CODCAIXA, CODFILIAL, CODEMP));

/* Table: PVLEITURAX, Owner: SYSDBA */
CREATE TABLE PVLEITURAX (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCAIXA INTEGER NOT NULL,
        DTLX DATE NOT NULL,
        TT01 NUMERIC(15, 3),
        TT02 NUMERIC(15, 3),
        TT03 NUMERIC(15, 3),
        TT04 NUMERIC(15, 3),
        TT05 NUMERIC(15, 3),
        TT06 NUMERIC(15, 3),
        TT07 NUMERIC(15, 3),
        TT08 NUMERIC(15, 3),
        TT09 NUMERIC(15, 3),
        TT10 NUMERIC(15, 3),
        TT11 NUMERIC(15, 3),
        TT12 NUMERIC(15, 3),
        TT13 NUMERIC(15, 3),
        TT14 NUMERIC(15, 3),
        TT15 NUMERIC(15, 3),
        TT16 NUMERIC(15, 3),
        TISENCAO NUMERIC(15, 3),
        TNINCIDENCIA NUMERIC(15, 3),
        TSUBSTITUICAO NUMERIC(15, 3),
        TN1 NUMERIC(15, 3),
        TN2 NUMERIC(15, 3),
        TN3 NUMERIC(15, 3),
        TN4 NUMERIC(15, 3),
        TN5 NUMERIC(15, 3),
        TN6 NUMERIC(15, 3),
        TN7 NUMERIC(15, 3),
        TN8 NUMERIC(15, 3),
        TN9 NUMERIC(15, 3),
        TSANGRIA NUMERIC(15, 3),
        TSUPRIMENTO NUMERIC(15, 3),
        TGTOTAL NUMERIC(15, 3),
        ALIQ01 NUMERIC(15, 3),
        ALIQ02 NUMERIC(15, 3),
        ALIQ03 NUMERIC(15, 3),
        ALIQ04 NUMERIC(15, 3),
        ALIQ05 NUMERIC(15, 3),
        ALIQ06 NUMERIC(15, 3),
        ALIQ07 NUMERIC(15, 3),
        ALIQ08 NUMERIC(15, 3),
        ALIQ09 NUMERIC(15, 3),
        ALIQ10 NUMERIC(15, 3),
        ALIQ11 NUMERIC(15, 3),
        ALIQ12 NUMERIC(15, 3),
        ALIQ13 NUMERIC(15, 3),
        ALIQ14 NUMERIC(15, 3),
        ALIQ15 NUMERIC(15, 3),
        ALIQ16 NUMERIC(15, 3),
        VLRCONTABILLX NUMERIC(15, 3),
        VLRBASECALCLX NUMERIC(15, 3),
        NUMCANCLX INTEGER,
        NUMREDLX INTEGER,
        VLRCANCLX NUMERIC(15, 3),
        VLRDESCLX NUMERIC(15, 3),
        CONTALX NUMERIC(15, 3),
        VLROUTROSRECLX NUMERIC(15, 3),
        ULTCUPOMLX INTEGER,
        PRIMCUPOMLX INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
PRIMARY KEY (CODEMP, CODFILIAL, CODCAIXA, DTLX));

/* Table: PVMOVCAIXA, Owner: SYSDBA */
CREATE TABLE PVMOVCAIXA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCAIXA INTEGER NOT NULL,
        DTAMOV DATE NOT NULL,
        NROMOV INTEGER NOT NULL,
        TIPOMOV CHAR(1) NOT NULL,
        VLRMOV NUMERIC(15, 3) NOT NULL,
        VLRSLDMOV NUMERIC(15, 3) NOT NULL,
        CODEMPUS INTEGER NOT NULL,
        CODFILIALUS SMALLINT NOT NULL,
        IDUSU CHAR(8) NOT NULL,
CONSTRAINT PVMOVCAIXAPK PRIMARY KEY (NROMOV, DTAMOV, CODCAIXA, CODFILIAL, CODEMP));

/* Table: PVSEQMOVCAIXA, Owner: SYSDBA */
CREATE TABLE PVSEQMOVCAIXA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCAIXA INTEGER NOT NULL,
        DTAMOV DATE NOT NULL,
        NROMOV INTEGER DEFAULT 0 NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS DATE DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PVSEQMOVCAIXA PRIMARY KEY (DTAMOV, CODCAIXA, CODFILIAL, CODEMP));

/* Table: SGACESSOEU, Owner: SYSDBA */
CREATE TABLE SGACESSOEU (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        IDUSU CHAR(8) NOT NULL,
        CODEMPFL INTEGER NOT NULL,
        CODFILIALFL SMALLINT NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGACESSOEUPK PRIMARY KEY (CODFILIALFL, CODEMPFL, IDUSU, CODEMP, CODFILIAL));

/* Table: SGACESSOMG, Owner: SYSDBA */
CREATE TABLE SGACESSOMG (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        IDGRPUSU CHAR(8) NOT NULL,
        CODSIS INTEGER NOT NULL,
        CODMODU INTEGER NOT NULL,
        CODMENU INTEGER NOT NULL,
        TPACESSOMG CHAR(1) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGACESSOMGPK PRIMARY KEY (CODMENU, CODMODU, CODSIS, IDGRPUSU, CODFILIAL, CODEMP));

/* Table: SGACESSOMU, Owner: SYSDBA */
CREATE TABLE SGACESSOMU (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        IDUSU CHAR(8) NOT NULL,
        CODSIS INTEGER NOT NULL,
        CODMODU INTEGER NOT NULL,
        CODMENU INTEGER NOT NULL,
        TPACESSOMU CHAR(1) NOT NULL,
        PLANOMU CHAR(1) DEFAULT 'O' NOT NULL,
CONSTRAINT SGACESSOMUPK PRIMARY KEY (CODMENU, CODMODU, CODSIS, IDUSU, CODFILIAL, CODEMP));

/* Table: SGAGENDA, Owner: SYSDBA */
CREATE TABLE SGAGENDA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODAGD INTEGER NOT NULL,
        OBJORIGAGD CHAR(5) NOT NULL,
        CODEMPCH INTEGER DEFAULT 0 NOT NULL,
        CODFILIALCH SMALLINT DEFAULT 0 NOT NULL,
        CODCHAVE INTEGER DEFAULT 0 NOT NULL,
        DATAAGD DATE NOT NULL,
        DTAINIAGD DATE NOT NULL,
        HRINIAGD TIME NOT NULL,
        DTAFIMAGD DATE NOT NULL,
        HRFIMAGD TIME NOT NULL,
        ASSUNTOAGD CHAR(50) NOT NULL,
        DESCAGD VARCHAR(10000) NOT NULL,
        TIPOAGD CHAR(2) NOT NULL,
        PRIORAGD SMALLINT NOT NULL,
        CODEMPUO INTEGER NOT NULL,
        CODFILIALUO SMALLINT NOT NULL,
        IDUSUO CHAR(8) NOT NULL,
        CODEMPUD INTEGER NOT NULL,
        CODFILIALUD SMALLINT NOT NULL,
        IDUSUD CHAR(8) NOT NULL,
        SITAGD CHAR(2) NOT NULL,
CONSTRAINT SGAGENDAPK PRIMARY KEY (CODAGD, CODFILIAL, CODEMP));

/* Table: SGATRIBUICAO, Owner: SYSDBA */
CREATE TABLE SGATRIBUICAO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        IDATRIB CHAR(10) NOT NULL,
        DESCATRIB CHAR(50) NOT NULL,
        RMAATRIB CHAR(2) NOT NULL,
        OBSATRIB VARCHAR(500),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGATRIBUICAOPK PRIMARY KEY (IDATRIB, CODFILIAL, CODEMP));

/* Table: SGATRIBUSU, Owner: SYSDBA */
CREATE TABLE SGATRIBUSU (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        IDATRIB CHAR(10) NOT NULL,
        CODEMPUU INTEGER NOT NULL,
        CODFILIALUU SMALLINT NOT NULL,
        IDUSU CHAR(8) NOT NULL,
CONSTRAINT SGATRIBUSUPK PRIMARY KEY (IDUSU, CODFILIALUU, CODEMPUU, IDATRIB, CODFILIAL, CODEMP));

/* Table: SGCONEXAO, Owner: SYSDBA */
CREATE TABLE SGCONEXAO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        IDUSU CHAR(10) NOT NULL,
        CODFILIALSEL SMALLINT NOT NULL,
        CODTERM INTEGER,
        CONECTADO INTEGER DEFAULT 0 NOT NULL,
CONSTRAINT SGCONEXAOPK PRIMARY KEY (IDUSU, CODFILIAL, CODEMP));

/* Table: SGEMPRESA, Owner: SYSDBA */
CREATE TABLE SGEMPRESA (CODEMP INTEGER NOT NULL,
        RAZEMP CHAR(50),
        NOMEEMP CHAR(50),
        CNPJEMP CHAR(14),
        INSCEMP CHAR(15),
        ENDEMP CHAR(50),
        NUMEMP INTEGER,
        COMPLEMP CHAR(20),
        BAIREMP CHAR(30),
        CEPEMP CHAR(8),
        CIDEMP CHAR(30),
        UFEMP CHAR(2),
        FONEEMP CHAR(12),
        FAXEMP CHAR(8),
        EMAILEMP CHAR(50),
        WWWEMP CHAR(50),
        CODEANEMP CHAR(6),
        CODPAISEMP CHAR(3),
        PERCISSEMP NUMERIC(6, 2) DEFAULT 0,
        NOMECONTEMP CHAR(40),
        FOTOEMP BLOB SUB_TYPE -1 SEGMENT SIZE 65000,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGEMPRESAPK PRIMARY KEY (CODEMP));

/* Table: SGEQVCLIFOR, Owner: SYSDBA */
CREATE TABLE SGEQVCLIFOR (CODEMPCL INTEGER NOT NULL,
        CODFILIALCL INTEGER NOT NULL,
        CODCLI INTEGER NOT NULL,
        CODEMPFR INTEGER NOT NULL,
        CODFILIALFR INTEGER NOT NULL,
        CODFOR INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGEQVCLIFORPK PRIMARY KEY (CODCLI, CODFILIALCL, CODEMPCL, CODFOR, CODFILIALFR, CODEMPFR));

/* Table: SGESTACAO, Owner: SYSDBA */
CREATE TABLE SGESTACAO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODEST SMALLINT NOT NULL,
        DESCEST CHAR(50) NOT NULL,
CONSTRAINT SGESTACAOPK PRIMARY KEY (CODEST, CODFILIAL, CODEMP));

/* Table: SGFILIAL, Owner: SYSDBA */
CREATE TABLE SGFILIAL (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        RAZFILIAL CHAR(50) NOT NULL,
        NOMEFILIAL CHAR(50) NOT NULL,
        MZFILIAL CHAR(1) NOT NULL,
        CNPJFILIAL CHAR(14),
        INSCFILIAL CHAR(15),
        ENDFILIAL CHAR(50),
        NUMFILIAL INTEGER,
        COMPLFILIAL CHAR(20),
        BAIRFILIAL CHAR(30),
        CEPFILIAL CHAR(8),
        CIDFILIAL CHAR(30),
        UFFILIAL CHAR(2),
        FONEFILIAL CHAR(12),
        FAXFILIAL CHAR(8),
        EMAILFILIAL CHAR(50),
        WWWFILIAL CHAR(50),
        CODDISTFILIAL INTEGER,
        PERCPISFILIAL NUMERIC(5, 2) DEFAULT 0,
        PERCCOFINSFILIAL NUMERIC(5, 2) DEFAULT 0,
        PERCIRFILIAL NUMERIC(5, 2) DEFAULT 0,
        PERCCSOCIALFILIAL NUMERIC(5, 2) DEFAULT 0,
        SIMPLESFILIAL CHAR(1),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGFILIALPK PRIMARY KEY (CODFILIAL, CODEMP));

/* Table: SGFLUXO, Owner: SYSDBA */
CREATE TABLE SGFLUXO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODFLUXO INTEGER NOT NULL,
        DESCFLUXO CHAR(50) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGFLUXOPK PRIMARY KEY (CODFLUXO, CODFILIAL, CODEMP));

/* Table: SGGATILHO, Owner: SYSDBA */
CREATE TABLE SGGATILHO (CODEMP INTEGER NOT NULL,
        CODOBJ INTEGER NOT NULL,
        DISPGAT CHAR(2) NOT NULL,
        ATIVOGAT CHAR(1) DEFAULT 'S' NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGGATILHOPK PRIMARY KEY (CODOBJ, DISPGAT, CODEMP));

/* Table: SGGRAUINST, Owner: SYSDBA */
CREATE TABLE SGGRAUINST (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODGRI INTEGER NOT NULL,
        DESCGRI CHAR(50) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGGRAUINSTPK PRIMARY KEY (CODGRI, CODFILIAL, CODEMP));

/* Table: SGGRPUSU, Owner: SYSDBA */
CREATE TABLE SGGRPUSU (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        IDGRPUSU CHAR(8) NOT NULL,
        NOMEGRPUSU CHAR(50) NOT NULL,
        COMENTGRPUSU VARCHAR(10000),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGGRPUSUPK PRIMARY KEY (IDGRPUSU, CODFILIAL, CODEMP));

/* Table: SGIMPRESSORA, Owner: SYSDBA */
CREATE TABLE SGIMPRESSORA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODIMP INTEGER NOT NULL,
        DESCIMP CHAR(40) NOT NULL,
        TIPOIMP CHAR(2) NOT NULL,
        LINPAGIMP INTEGER NOT NULL,
        NSERIEIMP CHAR(15),
        PORTAWINIMP CHAR(4),
        PORTALINIMP CHAR(60),
        CODEMPPL INTEGER,
        CODFILIALPL SMALLINT,
        CODPAPEL CHAR(10),
        DESTIMP CHAR(2) DEFAULT 'TO',
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGIMPRESSORAPK PRIMARY KEY (CODIMP, CODFILIAL, CODEMP));

/* Table: SGITFLUXO, Owner: SYSDBA */
CREATE TABLE SGITFLUXO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODFLUXO INTEGER NOT NULL,
        SEQITFLUXO SMALLINT NOT NULL,
        CODEMPPC INTEGER NOT NULL,
        CODFILIALPC SMALLINT NOT NULL,
        CODPROC INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS DATE DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGITFLUXOPK PRIMARY KEY (CODFLUXO, SEQITFLUXO, CODFILIAL, CODEMP));

/* Table: SGITPROCESSO, Owner: SYSDBA */
CREATE TABLE SGITPROCESSO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROC INTEGER NOT NULL,
        SEQITPROC SMALLINT NOT NULL,
        CODEMPTA INTEGER NOT NULL,
        CODFILIALTA SMALLINT NOT NULL,
        CODTAREFA INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT DATE DEFAULT 'now',
CONSTRAINT SGITPROCESSOPK PRIMARY KEY (CODPROC, SEQITPROC, CODFILIAL, CODEMP));

/* Table: SGITTABELA, Owner: SYSDBA */
CREATE TABLE SGITTABELA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTB SMALLINT NOT NULL,
        CODITTB INTEGER NOT NULL,
        DESCITTB CHAR(50) NOT NULL,
        PADRAOITTB CHAR(1) DEFAULT 'N' NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGITTABELAPK PRIMARY KEY (CODITTB, CODTB, CODFILIAL, CODEMP));

/* Table: SGLOG, Owner: SYSDBA */
CREATE TABLE SGLOG (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODLOG INTEGER NOT NULL,
        DATALOG DATE NOT NULL,
        HORALOG TIME DEFAULT 'now' NOT NULL,
        CODEMPUS INTEGER NOT NULL,
        CODFILIALUS SMALLINT NOT NULL,
        IDUSU CHAR(8) NOT NULL,
        CLASLOG CHAR(2) DEFAULT 01 NOT NULL,
        TIPOLOG CHAR(3) NOT NULL,
        CODEMPCX INTEGER NOT NULL,
        CODFILIALCX SMALLINT NOT NULL,
        CODCAIXA INTEGER NOT NULL,
        DESCLOG CHAR(60) NOT NULL,
        OBSLOG VARCHAR(1000),
CONSTRAINT SGLOGPK PRIMARY KEY (CODLOG, CODFILIAL, CODEMP));

/* Table: SGMENU, Owner: SYSDBA */
CREATE TABLE SGMENU (CODSIS INTEGER NOT NULL,
        CODMODU INTEGER NOT NULL,
        CODMENU INTEGER NOT NULL,
        DESCMENU CHAR(50) NOT NULL,
        NOMEMENU CHAR(30) NOT NULL,
        PLANOMENU CHAR(1) DEFAULT 'O' NOT NULL,
        ACAOMENU CHAR(100) NOT NULL,
        CODSISPAI INTEGER,
        CODMODUPAI INTEGER,
        CODMENUPAI INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGMENUPK PRIMARY KEY (CODMENU, CODMODU, CODSIS));

/* Table: SGMENUOBJ, Owner: SYSDBA */
CREATE TABLE SGMENUOBJ (CODEMP INTEGER NOT NULL,
        CODOBJ INTEGER NOT NULL,
        CODSIS INTEGER NOT NULL,
        CODMODU INTEGER NOT NULL,
        CODMENU INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGMENUOBJPK PRIMARY KEY (CODMENU, CODMODU, CODSIS, CODOBJ, CODEMP));

/* Table: SGMODETIQUETA, Owner: SYSDBA */
CREATE TABLE SGMODETIQUETA (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        CODMODETIQ INTEGER NOT NULL,
        DESCMODETIQ CHAR(30) NOT NULL,
        NCOLMODETIQ SMALLINT,
        TXAMODETIQ VARCHAR(1000) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
        CODEMPPL INTEGER,
        CODFILIALPL SMALLINT,
        CODPAPEL CHAR(10),
CONSTRAINT SGMODETIQUETAPK PRIMARY KEY (CODMODETIQ, CODFILIAL, CODEMP));

/* Table: SGMODULO, Owner: SYSDBA */
CREATE TABLE SGMODULO (CODSIS INTEGER NOT NULL,
        CODMODU INTEGER NOT NULL,
        DESCMODU CHAR(50) NOT NULL,
        COMENTMODU VARCHAR(10000),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGMODULOPK PRIMARY KEY (CODMODU, CODSIS));

/* Table: SGOBJETO, Owner: SYSDBA */
CREATE TABLE SGOBJETO (CODEMP INTEGER NOT NULL,
        CODOBJ INTEGER NOT NULL,
        NOMEOBJ CHAR(30) NOT NULL,
        DESCOBJ CHAR(50) NOT NULL,
        TIPOOBJ CHAR(2) NOT NULL,
        COMENTOBJ VARCHAR(10000),
        USOMEOBJ CHAR(1) DEFAULT 'N',
        SIGLAOBJ CHAR(8),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGOBJETOPK PRIMARY KEY (CODOBJ, CODEMP));

/* Table: SGOBJETOTB, Owner: SYSDBA */
CREATE TABLE SGOBJETOTB (CODEMP INTEGER NOT NULL,
        CODOBJ INTEGER NOT NULL,
        CODEMPTB INTEGER NOT NULL,
        CODFILIALTB SMALLINT NOT NULL,
        CODTB SMALLINT NOT NULL,
        OBRIGOBJTB CHAR(1) DEFAULT 'N' NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGOBJETOTBPK PRIMARY KEY (CODTB, CODFILIALTB, CODEMPTB, CODOBJ, CODEMP));

/* Table: SGPAIS, Owner: SYSDBA */
CREATE TABLE SGPAIS (CODPAIS SMALLINT NOT NULL,
        NOMEPAIS CHAR(50) NOT NULL,
        SIGLAPAIS CHAR(10) NOT NULL,
        DDIPAIS SMALLINT,
CONSTRAINT SGPAISPK PRIMARY KEY (CODPAIS));

/* Table: SGPAPEL, Owner: SYSDBA */
CREATE TABLE SGPAPEL (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPAPEL CHAR(10) NOT NULL,
        DESCPAPEL CHAR(40),
        LINPAPEL INTEGER,
        ALTPAPEL INTEGER,
        LARGPAPEL INTEGER,
        CLASSNOTAPAPEL CHAR(20),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
        COLPAPEL SMALLINT,
CONSTRAINT SGPAPELPK PRIMARY KEY (CODPAPEL, CODFILIAL, CODEMP));

/* Table: SGPREFERE1, Owner: SYSDBA */
CREATE TABLE SGPREFERE1 (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        USAREFPROD CHAR(1) NOT NULL,
        CODTIPOMOV INTEGER,
        CODEMPTM SMALLINT,
        CODFILIALTM SMALLINT,
        USAPEDSEQ CHAR(1),
        FILTRO CHAR(2),
        USALIQREL CHAR(1) DEFAULT 'N',
        TIPOPRECOCUSTO CHAR(1) DEFAULT 'M' NOT NULL,
        ANOCENTROCUSTO SMALLINT,
        OBSORCPAD VARCHAR(10000),
        CODTIPOMOV2 INTEGER,
        CODFILIALT2 SMALLINT,
        CODEMPT2 INTEGER,
        CLASSORC CHAR(20),
        TITORCTXT01 CHAR(20),
        CODTIPOMOV3 INTEGER,
        CODFILIALT3 SMALLINT,
        CODEMPT3 INTEGER,
        ORDNOTA CHAR(1),
        SETORVENDA CHAR(1) DEFAULT 'C',
        PREFCRED CHAR(1),
        LCREDGLOBAL CHAR(1) DEFAULT 'S' NOT NULL,
        CODEMPMO INTEGER NOT NULL,
        CODFILIALMO INTEGER NOT NULL,
        CODMOEDA CHAR(4) NOT NULL,
        CODTIPOMOV4 INTEGER,
        CODFILIALT4 INTEGER,
        CODEMPT4 INTEGER,
        USACLASCOMIS CHAR(1),
        PERCPRECOCUSTO NUMERIC(9, 2) DEFAULT 0 NOT NULL,
        CODGRUP CHAR(14),
        CODFILIALGP INTEGER,
        CODEMPGP INTEGER,
        CODMARCA CHAR(6),
        CODFILIALMC INTEGER,
        CODEMPMC INTEGER,
        RGCLIOBRIG CHAR(1) DEFAULT 'S' NOT NULL,
        TABFRETEVD CHAR(1) DEFAULT 'S' NOT NULL,
        TABADICVD CHAR(1) DEFAULT 'S' NOT NULL,
        TRAVATMNFVD CHAR(1) DEFAULT 'S' NOT NULL,
        TIPOVALIDORC CHAR(1) DEFAULT 'D',
        CLIMESMOCNPJ CHAR(1) DEFAULT 'N',
        CODTBJ INTEGER,
        CODEMPTJ INTEGER,
        CODFILIALTJ INTEGER,
        CNPJOBRIGCLI CHAR(1) DEFAULT 'S' NOT NULL,
        JUROSPOSCALC CHAR(1),
        CODEMPFR INTEGER,
        CODFILIALFR INTEGER,
        CODFOR INTEGER,
        CODEMPTN INTEGER,
        CODFILIALTN SMALLINT,
        CODTRAN INTEGER,
        CODEMPTF INTEGER,
        CODFILIALTF INTEGER,
        CODTIPOFOR INTEGER,
        CODEMPT5 INTEGER,
        CODFILIALT5 INTEGER,
        CODTIPOMOV5 INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
        ESTLOTNEG CHAR(1) DEFAULT 'N',
        ESTNEG CHAR(1) DEFAULT 'N',
        NATVENDA CHAR(1) DEFAULT 'S',
        CUSTOSICMS CHAR(1) DEFAULT 'S' NOT NULL,
        CODEMPPG INTEGER,
        CODFILIALPG SMALLINT,
        CODPLANOPAG INTEGER,
        CODEMPTB INTEGER,
        CODFILIALTB SMALLINT,
        CODTAB INTEGER,
        CODEMPCE INTEGER,
        CODFILIALCE SMALLINT,
        CODCLASCLI INTEGER,
        CASASDEC SMALLINT default 2,
        COMISPDUPL CHAR(1) DEFAULT 'S',
        CODEMPT6 INTEGER,
        CODFILIALT6 SMALLINT,
        CODTIPOMOV6 INTEGER,
        BLOQVENDA CHAR(1) DEFAULT 'S' NOT NULL,
CONSTRAINT SGPREFERE1PK PRIMARY KEY (CODFILIAL, CODEMP));

/* Table: SGPREFERE2, Owner: SYSDBA */
CREATE TABLE SGPREFERE2 (CODFILIAL INTEGER NOT NULL,
        CODEMP INTEGER NOT NULL,
        CODTPATENDO INTEGER,
        CODFILIALTO INTEGER,
        CODEMPTO INTEGER,
        CODTPATENDO2 INTEGER,
        CODFILIALT2 INTEGER,
        CODEMPT2 INTEGER,
        CODTPATENDO3 INTEGER,
        CODFILIALT3 INTEGER,
        CODEMPT3 INTEGER,
        CODSETAT INTEGER,
        CODFILIALSA INTEGER,
        CODEMPSA INTEGER,
        CODSETAT2 INTEGER,
        CODFILIALS2 INTEGER,
        CODEMPS2 INTEGER,
        CODEMPAE INTEGER,
        CODFILIALAE SMALLINT,
        CODATEND INTEGER,
        CLASSMEDIDA CHAR(20),
        CODEMPTI INTEGER,
        CODFILIALTI SMALLINT,
        CODTIPOCLI INTEGER,
        CODEMPCI INTEGER,
        CODFILIALCI SMALLINT,
        CODCLASCLI INTEGER,
        CODEMPTA INTEGER,
        CODFILIALTA SMALLINT,
        CODTBA SMALLINT,
        CODITTBA INTEGER,
        CODEMPTV INTEGER,
        CODFILIALTV SMALLINT,
        CODTBV SMALLINT,
        CODITTBV INTEGER,
        CODEMPVD INTEGER NOT NULL,
        CODFILIALVD SMALLINT NOT NULL,
        CODVEND INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT PKSGPREFERE2 PRIMARY KEY (CODFILIAL, CODEMP));

/* Table: SGPREFERE3, Owner: SYSDBA */
CREATE TABLE SGPREFERE3 (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        SMTPMAIL CHAR(40),
        USERMAIL CHAR(40),
        PASSMAIL CHAR(40),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now');

/* Table: SGPREFERE4, Owner: SYSDBA */
CREATE TABLE SGPREFERE4 (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        CODTIPOMOV INTEGER NOT NULL,
        CODEMPTM INTEGER NOT NULL,
        CODFILIALTM INTEGER NOT NULL,
        CODEMPPP INTEGER NOT NULL,
        CODFILIALPP SMALLINT NOT NULL,
        CODPLANOPAG INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGPREFERE4PK PRIMARY KEY (CODFILIAL, CODEMP));

/* Table: SGPREFERE5, Owner: SYSDBA */
CREATE TABLE SGPREFERE5 (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        CLASSOP CHAR(20),
        NOMERESP CHAR(50),
        IDENTPROFRESP CHAR(30),
        CARGORESP CHAR(30),
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGPREFERE5PK PRIMARY KEY (CODFILIAL, CODEMP));

/* Table: SGPROCESSO, Owner: SYSDBA */
CREATE TABLE SGPROCESSO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROC INTEGER NOT NULL,
        DESCPROC CHAR(50) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGPROCESSOPK PRIMARY KEY (CODPROC, CODFILIAL, CODEMP));

/* Table: SGSEQUENCIA, Owner: SYSDBA */
CREATE TABLE SGSEQUENCIA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        SGTAB CHAR(2) NOT NULL,
        NROSEQ INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGSEQUENCIAPK PRIMARY KEY (SGTAB, CODFILIAL, CODEMP));

/* Table: SGSISTEMA, Owner: SYSDBA */
CREATE TABLE SGSISTEMA (CODSIS INTEGER NOT NULL,
        DESCSIS CHAR(50) NOT NULL,
        COMENTSIS VARCHAR(10000),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGSISTEMAPK PRIMARY KEY (CODSIS));

/* Table: SGTABELA, Owner: SYSDBA */
CREATE TABLE SGTABELA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTB SMALLINT NOT NULL,
        DESCTB CHAR(50) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGTABELAPK PRIMARY KEY (CODTB, CODFILIAL, CODEMP));

/* Table: SGTAREFA, Owner: SYSDBA */
CREATE TABLE SGTAREFA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTAREFA INTEGER NOT NULL,
        DESCTAREFA CHAR(50) NOT NULL,
        CODEMPOB INTEGER NOT NULL,
        CODOBJ INTEGER NOT NULL,
        TIPOTAREFA CHAR(2) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGTAREFAPK PRIMARY KEY (CODTAREFA, CODFILIAL, CODEMP));

/* Table: SGTRATARET, Owner: SYSDBA */
CREATE TABLE SGTRATARET (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROC INTEGER NOT NULL,
        SEQITPROC SMALLINT NOT NULL,
        CODTRATRET SMALLINT NOT NULL,
        TIPOTRATRET CHAR(2) NOT NULL,
        CODEMPGT INTEGER,
        CODFILIALGT SMALLINT,
        SEQITPROCGT SMALLINT,
        CODPROCGT INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGTRATARETPK PRIMARY KEY (CODPROC, CODTRATRET, SEQITPROC, CODFILIAL, CODEMP));

/* Table: SGUSUARIO, Owner: SYSDBA */
CREATE TABLE SGUSUARIO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        IDUSU CHAR(8) NOT NULL,
        NOMEUSU CHAR(50) NOT NULL,
        CODEMPIG INTEGER,
        CODFILIALIG SMALLINT,
        IDGRPUSU CHAR(8),
        CODEMPCC INTEGER,
        CODFILIALCC SMALLINT,
        ANOCC SMALLINT,
        CODCC CHAR(19),
        PNOMEUSU CHAR(20),
        UNOMEUSU CHAR(20),
        COMENTUSU VARCHAR(10000),
        BAIXOCUSTOUSU CHAR(1) DEFAULT 'N',
CONSTRAINT SGUSUARIOPK PRIMARY KEY (IDUSU, CODFILIAL, CODEMP));

/* Table: SGVARIAVEL, Owner: SYSDBA */
CREATE TABLE SGVARIAVEL (IDVAR CHAR(18) NOT NULL,
        IDCON INTEGER NOT NULL,
        VLRINTEGER INTEGER,
        VLRCHAR1 CHAR(20),
        VLRCHAR2 CHAR(50),
        VLRDECIMAL NUMERIC(15, 3),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT SGVARIAVELPK PRIMARY KEY (IDVAR, IDCON));

/* Table: SVAVALIACAO, Owner: SYSDBA */
CREATE TABLE SVAVALIACAO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODOS INTEGER NOT NULL,
        CODITOS SMALLINT NOT NULL,
        CODAVAL SMALLINT NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        REFPROD CHAR(13) NOT NULL,
        QTDAVAL NUMERIC(15, 3) NOT NULL,
        PRECOAVAL NUMERIC(15, 3) NOT NULL,
        VLRTOTAVAL NUMERIC(15, 3) NOT NULL,
        VLRDESCAVAL NUMERIC(15, 3) NOT NULL,
        VLRLIQAVAL NUMERIC(15, 3) NOT NULL,
        SITAVAL CHAR(2) NOT NULL,
        SITAPROVAVAL CHAR(2) NOT NULL,
CONSTRAINT SVAVALIACAOPK PRIMARY KEY (CODOS, CODITOS, CODAVAL, CODFILIAL, CODEMP));

/* Table: SVEXECUCAO, Owner: SYSDBA */
CREATE TABLE SVEXECUCAO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODOS INTEGER NOT NULL,
        CODITOS INTEGER NOT NULL,
        CODEXEC SMALLINT NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        REFPROD CHAR(13) NOT NULL,
        SITEXEC CHAR(2) NOT NULL,
        QTDEXEC NUMERIC(15, 3) NOT NULL,
        PRECOEXEC NUMERIC(15, 3) NOT NULL,
        VLRTOTEXEC NUMERIC(15, 3) NOT NULL,
        VLRDESCEXEC NUMERIC(15, 3) NOT NULL,
        VLRLIQEXEC NUMERIC(15, 3) NOT NULL,
        DTEXEC DATE,
        OBSEXEC VARCHAR(1000),
CONSTRAINT SVEXECUCAOPK PRIMARY KEY (CODOS, CODITOS, CODEXEC, CODFILIAL, CODEMP));

/* Table: SVITOS, Owner: SYSDBA */
CREATE TABLE SVITOS (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODOS INTEGER NOT NULL,
        CODITOS SMALLINT NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        REFPROD CHAR(13) NOT NULL,
        QTDITOS NUMERIC(15, 3) NOT NULL,
        PRECOITOS NUMERIC(15, 3) NOT NULL,
        SITITOS CHAR(2) NOT NULL,
        OBSITOS VARCHAR(1000),
CONSTRAINT SVITOSPK PRIMARY KEY (CODOS, CODITOS, CODFILIAL, CODEMP));

/* Table: SVOS, Owner: SYSDBA */
CREATE TABLE SVOS (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODOS INTEGER NOT NULL,
        CODEMPCL INTEGER NOT NULL,
        CODFILIALCL SMALLINT NOT NULL,
        CODCLI INTEGER NOT NULL,
        DTENTOS DATE NOT NULL,
        SITOS CHAR(2) NOT NULL,
        CODEMPCV INTEGER,
        CODFILIALCV SMALLINT,
        CODCONV INTEGER,
        DTPREVOS DATE,
        DTSAIOS DATE,
        DESCOS VARCHAR(1000),
        OBSOS VARCHAR(1000),
CONSTRAINT SVOSPK PRIMARY KEY (CODOS, CODFILIAL, CODEMP));

/* Table: TKATIVIDADE, Owner: SYSDBA */
CREATE TABLE TKATIVIDADE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODATIV INTEGER NOT NULL,
        DESCATIV CHAR(50) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT TKATIVIDADEPK PRIMARY KEY (CODATIV, CODFILIAL, CODEMP));

/* Table: TKCONTATO, Owner: SYSDBA */
CREATE TABLE TKCONTATO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCTO INTEGER NOT NULL,
        RAZCTO CHAR(50) NOT NULL,
        CODEMPVD INTEGER,
        CODFILIALVD SMALLINT,
        CODVEND INTEGER,
        CODEMPSR INTEGER NOT NULL,
        CODFILIALSR SMALLINT NOT NULL,
        CODSETOR INTEGER NOT NULL,
        NOMECTO CHAR(50) NOT NULL,
        DATACTO DATE DEFAULT 'today' NOT NULL,
        PESSOACTO CHAR(1) NOT NULL,
        ATIVOCTO CHAR(1) NOT NULL,
        CNPJCTO CHAR(14),
        INSCCTO CHAR(15),
        CPFCTO CHAR(11),
        RGCTO CHAR(10),
        ENDCTO CHAR(50),
        NUMCTO INTEGER,
        COMPLCTO CHAR(20),
        BAIRCTO CHAR(30),
        CIDCTO CHAR(30),
        UFCTO CHAR(2),
        CEPCTO CHAR(8),
        FONECTO CHAR(12),
        FAXCTO CHAR(8),
        EMAILCTO CHAR(50),
        CONTCTO CHAR(40),
        CARGOCONTCTO CHAR(30),
        OBSCTO VARCHAR(10000),
        REMOVCTO CHAR(1) DEFAULT 'N' NOT NULL,
        CODEMPTI INTEGER,
        CODFILIALTI SMALLINT,
        CODTPIMP INTEGER,
        CODEMPSO INTEGER,
        CODFILIALSO SMALLINT,
        CODSETORCTO INTEGER,
        NUMEMPCTO INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT TKCONTATOPK PRIMARY KEY (CODCTO, CODFILIAL, CODEMP));

/* Table: TKCTOATIV, Owner: SYSDBA */
CREATE TABLE TKCTOATIV (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCTO INTEGER NOT NULL,
        CODEMPAV INTEGER NOT NULL,
        CODFILIALAV SMALLINT NOT NULL,
        CODATIV INTEGER NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT TKCTOATIVPK PRIMARY KEY (CODCTO, CODFILIAL, CODEMP, CODATIV, CODFILIALAV, CODEMPAV));

/* Table: TKHISTORICO, Owner: SYSDBA */
CREATE TABLE TKHISTORICO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODHISTTK INTEGER NOT NULL,
        DATAHISTTK DATE NOT NULL,
        HORAHISTTK TIME NOT NULL,
        CODEMPCO INTEGER,
        CODFILIALCO SMALLINT,
        CODCTO INTEGER,
        CODEMPCL INTEGER,
        CODFILIALCL SMALLINT,
        CODCLI INTEGER,
        DESCHISTTK VARCHAR(10000) NOT NULL,
        CODEMPAE INTEGER NOT NULL,
        CODFILIALAE SMALLINT NOT NULL,
        CODATEND INTEGER NOT NULL,
        SITHISTTK CHAR(2) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT TKHISTORICOPK PRIMARY KEY (CODHISTTK, CODFILIAL, CODEMP));

/* Table: TKSETORCTO, Owner: SYSDBA */
CREATE TABLE TKSETORCTO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODSETORCTO INTEGER NOT NULL,
        DESCSETORCTO CHAR(50) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT TKSETORCTOPK PRIMARY KEY (CODSETORCTO, CODFILIAL, CODEMP));

/* Table: TKTIPOIMP, Owner: SYSDBA */
CREATE TABLE TKTIPOIMP (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTPIMP INTEGER NOT NULL,
        DESCTPIMP CHAR(50) NOT NULL,
        TRANSBINTPIMP CHAR(1) DEFAULT 'N' NOT NULL,
        CSEPTPIMP CHAR(1) DEFAULT 'N' NOT NULL,
        ENTERLNTPIMP CHAR(1) DEFAULT 'S' NOT NULL,
        SEPTPIMP CHAR(10),
        LAYOUTTPIMP VARCHAR(256),
        DELCRTTPIMP SMALLINT,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT TKTIPOIMPPK PRIMARY KEY (CODTPIMP, CODFILIAL, CODEMP));

/* Table: VDAUXVENDA, Owner: SYSDBA */
CREATE TABLE VDAUXVENDA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        TIPOVENDA CHAR(1) NOT NULL,
        CODVENDA INTEGER NOT NULL,
        CODAUXV SMALLINT NOT NULL,
        CPFCLIAUXV CHAR(11),
        NOMECLIAUXV CHAR(50),
        CIDCLIAUXV CHAR(30),
        UFCLIAUXV CHAR(2),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDAUXVENDAPK PRIMARY KEY (CODVENDA, CODAUXV, TIPOVENDA, CODFILIAL, CODEMP));

/* Table: VDCLASCLI, Owner: SYSDBA */
CREATE TABLE VDCLASCLI (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCLASCLI INTEGER NOT NULL,
        DESCCLASCLI CHAR(40) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDCLASCLIPK PRIMARY KEY (CODCLASCLI, CODFILIAL, CODEMP));

/* Table: VDCLCOMIS, Owner: SYSDBA */
CREATE TABLE VDCLCOMIS (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        CODCLCOMIS INTEGER NOT NULL,
        DESCCLCOMIS CHAR(50) NOT NULL,
        PERCFATCLCOMIS NUMERIC(9, 2),
        PERCPGTOCLCOMIS NUMERIC(9, 2),
CONSTRAINT VDCLCOMISPK PRIMARY KEY (CODCLCOMIS, CODFILIAL, CODEMP));

/* Table: VDCLIENTE, Owner: SYSDBA */
CREATE TABLE VDCLIENTE (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCLI INTEGER NOT NULL,
        RAZCLI CHAR(50) NOT NULL,
        CODEMPCC INTEGER,
        CODFILIALCC SMALLINT,
        CODCLASCLI INTEGER,
        CODEMPVD INTEGER,
        CODFILIALVD SMALLINT,
        CODVEND INTEGER,
        CODEMPTC INTEGER,
        CODFILIALTC SMALLINT,
        CODTIPOCOB INTEGER,
        CODEMPPG INTEGER,
        CODFILIALPG SMALLINT,
        CODPLANOPAG INTEGER,
        CODEMPTN INTEGER,
        CODFILIALTN SMALLINT,
        CODTRAN INTEGER,
        CODEMPBO INTEGER,
        CODFILIALBO SMALLINT,
        CODBANCO CHAR(3),
        CODEMPSR INTEGER,
        CODFILIALSR SMALLINT,
        CODSETOR INTEGER,
        NOMECLI CHAR(50) NOT NULL,
        CODEMPTI INTEGER NOT NULL,
        CODFILIALTI SMALLINT NOT NULL,
        CODTIPOCLI INTEGER NOT NULL,
        DATACLI DATE DEFAULT 'today' NOT NULL,
        PESSOACLI CHAR(1) NOT NULL,
        ATIVOCLI CHAR(1) NOT NULL,
        CNPJCLI CHAR(14),
        INSCCLI CHAR(15),
        CPFCLI CHAR(11),
        RGCLI CHAR(10),
        ENDCLI CHAR(50),
        NUMCLI INTEGER,
        COMPLCLI CHAR(20),
        BAIRCLI CHAR(30),
        CIDCLI CHAR(30),
        UFCLI CHAR(2),
        CEPCLI CHAR(8),
        FONECLI CHAR(12),
        RAMALCLI CHAR(6),
        FAXCLI CHAR(8),
        EMAILCLI CHAR(50),
        CONTCLI CHAR(40),
        ENDCOB CHAR(50),
        NUMCOB INTEGER,
        COMPLCOB CHAR(20),
        BAIRCOB CHAR(30),
        CIDCOB CHAR(30),
        UFCOB CHAR(2),
        CEPCOB CHAR(8),
        FONECOB CHAR(12),
        FAXCOB CHAR(8),
        ENDENT CHAR(50),
        NUMENT INTEGER,
        COMPLENT CHAR(20),
        BAIRENT CHAR(30),
        CIDENT CHAR(30),
        UFENT CHAR(2),
        CEPENT CHAR(8),
        FONEENT CHAR(12),
        FAXENT CHAR(8),
        OBSCLI VARCHAR(10000),
        AGENCIACLI CHAR(6),
        CODEMPPQ INTEGER,
        CODFILIALPQ SMALLINT,
        CODPESQ INTEGER,
        INCRACLI CHAR(15),
        CODTPCRED INTEGER,
        CODFILIALTR INTEGER,
        CODEMPTR INTEGER,
        DTVENCTOTR DATE,
        NIRFCLI CHAR(15),
        CODFISCCLI INTEGER,
        CODEMPFC INTEGER,
        CODFILIALFC INTEGER,
        SIMPLESCLI CHAR(1),
        CELCLI CHAR(8),
        CODPAIS SMALLINT,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT user,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDCLIENTEPK PRIMARY KEY (CODCLI, CODFILIAL, CODEMP));

/* Table: VDCLIENTEFOR, Owner: SYSDBA */
CREATE TABLE VDCLIENTEFOR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCLI INTEGER NOT NULL,
        CODEMPFR INTEGER NOT NULL,
        CODFILIALFR SMALLINT NOT NULL,
        CODFOR INTEGER NOT NULL,
        CODCLIFOR INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDCLIENTEFORPK PRIMARY KEY (CODCLI, CODFILIAL, CODEMP, CODFOR, CODFILIALFR, CODEMPFR));

/* Table: VDCOMISSAO, Owner: SYSDBA */
CREATE TABLE VDCOMISSAO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCOMI INTEGER NOT NULL,
        TIPOCOMI CHAR(1) DEFAULT 'F' NOT NULL,
        CODEMPRC INTEGER NOT NULL,
        CODFILIALRC SMALLINT NOT NULL,
        CODREC INTEGER NOT NULL,
        NPARCITREC INTEGER NOT NULL,
        VLRVENDACOMI NUMERIC(15, 3) NOT NULL,
        VLRCOMI NUMERIC(15, 3) NOT NULL,
        VLRPAGOCOMI NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        VLRAPAGCOMI NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        DATACOMI DATE NOT NULL,
        DTVENCCOMI DATE NOT NULL,
        DTPAGTOCOMI DATE,
        STATUSCOMI CHAR(2) NOT NULL,
        CODEMPCI INTEGER,
        CODFILIALCI SMALLINT,
        CODPCOMI INTEGER,
        FLAG CHAR(1) DEFAULT 'N',
        CODEMPCT INTEGER,
        CODFILIALCT SMALLINT,
        CODPCOMIANT INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDCOMISSAOPK PRIMARY KEY (CODCOMI, CODFILIAL, CODEMP));

/* Table: VDFOTOPROD, Owner: SYSDBA */
CREATE TABLE VDFOTOPROD (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        CODFOTOPROD INTEGER NOT NULL,
        DESCFOTOPROD CHAR(40) NOT NULL,
        TIPOFOTOPROD CHAR(1) NOT NULL,
        LARGFOTOPROD INTEGER NOT NULL,
        ALTFOTOPROD INTEGER NOT NULL,
        FOTOPROD BLOB SUB_TYPE TEXT SEGMENT SIZE 536 NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDFOTOPRODPK PRIMARY KEY (CODFOTOPROD, CODPROD, CODFILIAL, CODEMP));

/* Table: VDFRETEVD, Owner: SYSDBA */
CREATE TABLE VDFRETEVD (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        TIPOVENDA CHAR(1) DEFAULT 'V' NOT NULL,
        CODVENDA INTEGER NOT NULL,
        CODEMPTN INTEGER,
        CODFILIALTN SMALLINT,
        CODTRAN INTEGER,
        TIPOFRETEVD CHAR(1) NOT NULL,
        PLACAFRETEVD CHAR(10) NOT NULL,
        UFFRETEVD CHAR(2) NOT NULL,
        VLRFRETEVD NUMERIC(15, 3) NOT NULL,
        QTDFRETEVD NUMERIC(15, 3) NOT NULL,
        PESOBRUTVD NUMERIC(15, 3) NOT NULL,
        PESOLIQVD NUMERIC(15, 3) NOT NULL,
        ESPFRETEVD CHAR(10) NOT NULL,
        MARCAFRETEVD CHAR(10) NOT NULL,
        CONHECFRETEVD CHAR(13),
        PERCVENDAFRETEVD NUMERIC(9, 2),
        FLAG CHAR(1) DEFAULT 'N',
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDFRETEVDPK PRIMARY KEY (CODVENDA, CODFILIAL, CODEMP));

/* Table: VDITKIT, Owner: SYSDBA */
CREATE TABLE VDITKIT (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODKIT INTEGER NOT NULL,
        SEQITKIT SMALLINT NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        REFPROD CHAR(13) NOT NULL,
        QTDITKIT NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        PRECOITKIT NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        VLRTOTITKIT NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        IDUSUINS CHAR(8),
        DTINS DATE,
        HINS TIME,
        IDUSUALT CHAR(8),
        DTALT DATE,
        HALT TIME,
CONSTRAINT VDITKITPK PRIMARY KEY (CODKIT, SEQITKIT, CODFILIAL, CODEMP));

/* Table: VDITORCAMENTO, Owner: SYSDBA */
CREATE TABLE VDITORCAMENTO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        TIPOORC CHAR(1) DEFAULT 'O' NOT NULL,
        CODORC INTEGER NOT NULL,
        CODITORC INTEGER NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        QTDITORC NUMERIC(15, 3) NOT NULL,
        PRECOITORC NUMERIC(15, 3) NOT NULL,
        PERCDESCITORC NUMERIC(9, 2),
        VLRDESCITORC NUMERIC(15, 3),
        VLRLIQITORC NUMERIC(15, 3),
        VLRPRODITORC NUMERIC(15, 3),
        REFPROD CHAR(13),
        NUMAUTORIZORC CHAR(15),
        ACEITEITORC CHAR(1) DEFAULT 'N' NOT NULL,
        APROVITORC CHAR(1) DEFAULT 'N' NOT NULL,
        EMITITORC CHAR(1) DEFAULT 'N' NOT NULL,
        VENCAUTORIZORC DATE,
        STRDESCITORC CHAR(50),
        OBSITORC VARCHAR(502),
        STATUSITORC CHAR(2),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDITORCAMENTOPK PRIMARY KEY (CODORC, CODITORC, TIPOORC, CODFILIAL, CODEMP));

/* Table: VDITROMANEIO, Owner: SYSDBA */
CREATE TABLE VDITROMANEIO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODROMA INTEGER NOT NULL,
        CODITROMA INTEGER NOT NULL,
        CODEMPVA INTEGER NOT NULL,
        CODFILIALVA SMALLINT NOT NULL,
        TIPOVENDA CHAR(1) DEFAULT 'V' NOT NULL,
        CODVENDA INTEGER NOT NULL,
        DTPREVITROMA DATE NOT NULL,
        FLAG CHAR(1) DEFAULT 'N',
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDITROMANEIO PRIMARY KEY (CODITROMA, CODROMA, CODFILIAL, CODEMP));

/* Table: VDITVENDA, Owner: SYSDBA */
CREATE TABLE VDITVENDA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        TIPOVENDA CHAR(1) DEFAULT 'V' NOT NULL,
        CODVENDA INTEGER NOT NULL,
        CODITVENDA INTEGER NOT NULL,
        CODEMPNT INTEGER NOT NULL,
        CODFILIALNT SMALLINT NOT NULL,
        CODNAT CHAR(4) NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        CODEMPLE INTEGER,
        CODFILIALLE SMALLINT,
        CODLOTE CHAR(13),
        QTDITVENDA NUMERIC(15, 3) NOT NULL,
        PRECOITVENDA NUMERIC(15, 3) NOT NULL,
        PERCDESCITVENDA NUMERIC(9, 2),
        VLRDESCITVENDA NUMERIC(15, 3),
        PERCICMSITVENDA NUMERIC(9, 2),
        VLRBASEICMSITVENDA NUMERIC(15, 3),
        VLRICMSITVENDA NUMERIC(15, 3),
        PERCIPIITVENDA NUMERIC(9, 2),
        VLRBASEIPIITVENDA NUMERIC(15, 3),
        VLRIPIITVENDA NUMERIC(15, 3),
        VLRLIQITVENDA NUMERIC(15, 3),
        PERCCOMISITVENDA NUMERIC(9, 2),
        VLRCOMISITVENDA NUMERIC(15, 3),
        VLRADICITVENDA NUMERIC(15, 3),
        PERCISSITVENDA NUMERIC(9, 2),
        VLRISSITVENDA NUMERIC(15, 3),
        VLRFRETEITVENDA NUMERIC(15, 3),
        VLRPRODITVENDA NUMERIC(15, 3),
        VLRISENTASITVENDA NUMERIC(15, 3),
        VLROUTRASITVENDA NUMERIC(15, 3),
        REFPROD CHAR(13),
        VLRBASEISSITVENDA NUMERIC(15, 3) DEFAULT 0,
        OBSITVENDA VARCHAR(502),
        ORIGFISC CHAR(1),
        CODEMPTT INTEGER,
        CODFILIALTT INTEGER,
        CODTRATTRIB CHAR(2),
        TIPOFISC CHAR(2),
        CODEMPME INTEGER,
        CODFILIALME SMALLINT,
        CODMENS INTEGER,
        STRDESCITVENDA CHAR(50),
        QTDDEVITVENDA NUMERIC(18, 2) DEFAULT 0,
        CODEMPLG INTEGER,
        CODFILIALLG SMALLINT,
        CODLOG INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
        EMMANUT CHAR(1) DEFAULT 'N',
CONSTRAINT VDITVENDAPK PRIMARY KEY (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIAL, CODEMP));

/* Table: VDKIT, Owner: SYSDBA */
CREATE TABLE VDKIT (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODKIT INTEGER NOT NULL,
        CODEMPPD INTEGER NOT NULL,
        CODFILIALPD SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        REFPROD CHAR(13) NOT NULL,
        QTDKIT NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        PRECOKIT NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        VLRTOTKIT NUMERIC(15, 3) DEFAULT 0 NOT NULL,
        DTINS DATE,
        HINS TIME,
        IDUSUINS CHAR(8),
        DTALT DATE,
        HALT TIME,
        IDUSUALT CHAR(8),
CONSTRAINT VDKITPK PRIMARY KEY (CODKIT, CODFILIAL, CODEMP));

/* Table: VDOBSCLI, Owner: SYSDBA */
CREATE TABLE VDOBSCLI (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODCLI INTEGER NOT NULL,
        SEQOBSCLI INTEGER NOT NULL,
        DTOBSCLI DATE NOT NULL,
        HOBSCLI TIME NOT NULL,
        TXTOBSCLI VARCHAR(10000) NOT NULL,
CONSTRAINT VDOBSCLIPK PRIMARY KEY (CODCLI, SEQOBSCLI, CODFILIAL, CODEMP));

/* Table: VDORCAMENTO, Owner: SYSDBA */
CREATE TABLE VDORCAMENTO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        TIPOORC CHAR(1) DEFAULT 'O' NOT NULL,
        CODORC INTEGER NOT NULL,
        CODEMPAE INTEGER,
        CODFILIALAE SMALLINT,
        CODATEND INTEGER,
        CODEMPCV INTEGER,
        CODFILIALCV SMALLINT,
        CODCONV INTEGER,
        DTORC DATE NOT NULL,
        DTVENCORC DATE NOT NULL,
        VLRPRODORC NUMERIC(15, 3),
        PERCDESCORC NUMERIC(9, 2),
        VLRDESCORC NUMERIC(15, 3),
        VLRADICORC NUMERIC(15, 3),
        VLRDESCITORC NUMERIC(15, 3),
        VLRLIQORC NUMERIC(15, 3),
        STATUSORC CHAR(2) NOT NULL,
        OBSORC VARCHAR(10000),
        CODPLANOPAG INTEGER,
        CODFILIALPG INTEGER,
        CODEMPPG INTEGER,
        TXT01 CHAR(20),
        CODEMPVD INTEGER NOT NULL,
        CODFILIALVD SMALLINT NOT NULL,
        CODVEND INTEGER NOT NULL,
        CODEMPCL INTEGER NOT NULL,
        CODFILIALCL SMALLINT NOT NULL,
        CODCLI INTEGER NOT NULL,
        CODTPCONV INTEGER,
        CODFILIALTC INTEGER,
        CODEMPTC INTEGER,
        PRAZOENTORC SMALLINT,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDORCAMENTOPK PRIMARY KEY (CODORC, TIPOORC, CODFILIAL, CODEMP));

/* Table: VDPRECOPROD, Owner: SYSDBA */
CREATE TABLE VDPRECOPROD (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODPROD INTEGER NOT NULL,
        CODPRECOPROD INTEGER NOT NULL,
        CODEMPTB INTEGER NOT NULL,
        CODFILIALTB SMALLINT NOT NULL,
        CODTAB INTEGER NOT NULL,
        CODEMPCC INTEGER,
        CODFILIALCC SMALLINT,
        CODCLASCLI INTEGER,
        CODEMPPG INTEGER NOT NULL,
        CODFILIALPG SMALLINT NOT NULL,
        CODPLANOPAG INTEGER NOT NULL,
        PRECOPROD NUMERIC(15, 3) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDPRECOPRODPK PRIMARY KEY (CODPRECOPROD, CODPROD, CODFILIAL, CODEMP));

/* Table: VDROMANEIO, Owner: SYSDBA */
CREATE TABLE VDROMANEIO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODROMA INTEGER NOT NULL,
        DATAROMA DATE NOT NULL,
        DTSAIDAROMA DATE NOT NULL,
        DTPREVROMA DATE NOT NULL,
        DTENTREGAROMA DATE,
        STATUSROMA CHAR(2) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDROMANEIOPK PRIMARY KEY (CODROMA, CODFILIAL, CODEMP));

/* Table: VDSETOR, Owner: SYSDBA */
CREATE TABLE VDSETOR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODSETOR INTEGER NOT NULL,
        DESCSETOR CHAR(40) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now' NOT NULL,
        HALT TIME DEFAULT 'now',
CONSTRAINT VDSETORPK PRIMARY KEY (CODSETOR, CODFILIAL, CODEMP));

/* Table: VDSTATUSORC, Owner: SYSDBA */
CREATE TABLE VDSTATUSORC (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        TIPOORC CHAR(1) NOT NULL,
        CODORC INTEGER NOT NULL,
        CODEMPTB INTEGER NOT NULL,
        CODFILIALTB SMALLINT NOT NULL,
        CODTB SMALLINT NOT NULL,
        CODITTB SMALLINT NOT NULL,
        DTASTORC DATE DEFAULT 'today' NOT NULL,
        HORASTORC TIME DEFAULT 'now' NOT NULL,
        MOTIVOSTORC VARCHAR(10000),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDSTATUSORCPK PRIMARY KEY (CODORC, TIPOORC, CODFILIAL, CODEMP, CODITTB, CODTB, CODFILIALTB, CODEMPTB));

/* Table: VDTABPRECO, Owner: SYSDBA */
CREATE TABLE VDTABPRECO (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTAB INTEGER NOT NULL,
        DESCTAB CHAR(40) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDTABPRECOPK PRIMARY KEY (CODTAB, CODFILIAL, CODEMP));

/* Table: VDTIPOCLI, Owner: SYSDBA */
CREATE TABLE VDTIPOCLI (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTIPOCLI INTEGER NOT NULL,
        DESCTIPOCLI CHAR(40) NOT NULL,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDTIPOCLIPK PRIMARY KEY (CODTIPOCLI, CODFILIAL, CODEMP));

/* Table: VDTRANSP, Owner: SYSDBA */
CREATE TABLE VDTRANSP (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODTRAN INTEGER NOT NULL,
        RAZTRAN CHAR(50) NOT NULL,
        NOMETRAN CHAR(40) NOT NULL,
        CNPJTRAN CHAR(14),
        INSCTRAN CHAR(15),
        ENDTRAN CHAR(50),
        NUMTRAN INTEGER,
        COMPLTRAN CHAR(20),
        BAIRTRAN CHAR(30),
        CIDTRAN CHAR(30),
        CEPTRAN CHAR(8),
        FONETRAN CHAR(12),
        FAXTRAN CHAR(8),
        UFTRAN CHAR(2),
        TIPOTRAN CHAR(1) DEFAULT 'T',
        CELTRAN CHAR(8),
        CONTTRAN CHAR(40),
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDTRANSPPK PRIMARY KEY (CODTRAN, CODFILIAL, CODEMP));

/* Table: VDVENDA, Owner: SYSDBA */
CREATE TABLE VDVENDA (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        TIPOVENDA CHAR(1) DEFAULT 'V' NOT NULL,
        CODVENDA INTEGER NOT NULL,
        CODEMPVD INTEGER,
        CODFILIALVD SMALLINT,
        CODVEND INTEGER,
        CODEMPCL INTEGER NOT NULL,
        CODFILIALCL SMALLINT NOT NULL,
        CODCLI INTEGER NOT NULL,
        CODEMPPG INTEGER NOT NULL,
        CODFILIALPG SMALLINT NOT NULL,
        CODPLANOPAG INTEGER NOT NULL,
        CODEMPSE INTEGER NOT NULL,
        CODFILIALSE SMALLINT NOT NULL,
        SERIE CHAR(4) NOT NULL,
        CODEMPTM INTEGER NOT NULL,
        CODFILIALTM SMALLINT NOT NULL,
        CODTIPOMOV INTEGER NOT NULL,
        CODEMPCX INTEGER,
        CODFILIALCX SMALLINT,
        CODCAIXA INTEGER,
        DOCVENDA INTEGER NOT NULL,
        DTSAIDAVENDA DATE NOT NULL,
        DTEMITVENDA DATE NOT NULL,
        VLRPRODVENDA NUMERIC(15, 3),
        PERCDESCVENDA NUMERIC(9, 2),
        VLRDESCVENDA NUMERIC(15, 3),
        VLRDESCITVENDA NUMERIC(15, 3),
        VLRVENDA NUMERIC(15, 3),
        VLRBASEICMSVENDA NUMERIC(15, 3),
        VLRICMSVENDA NUMERIC(15, 3),
        VLRISENTASVENDA NUMERIC(15, 3),
        VLROUTRASVENDA NUMERIC(15, 3),
        VLRBASEIPIVENDA NUMERIC(15, 3),
        VLRLIQVENDA NUMERIC(15, 3),
        PERCCOMISVENDA NUMERIC(9, 2),
        VLRCOMISVENDA NUMERIC(15, 3),
        STATUSVENDA CHAR(2) NOT NULL,
        VLRFRETEVENDA NUMERIC(15, 3),
        VLRADICVENDA NUMERIC(15, 3),
        VLRIPIVENDA NUMERIC(15, 3),
        OBSVENDA VARCHAR(10000),
        CODEMPBO INTEGER,
        CODFILIALBO SMALLINT,
        CODBANCO CHAR(3),
        VLRBASEISSVENDA NUMERIC(15, 3) DEFAULT 0,
        VLRISSVENDA NUMERIC(15, 3) DEFAULT 0,
        IMPNOTAVENDA CHAR(1) DEFAULT 'N',
        FLAG CHAR(1) DEFAULT 'N',
        CODCLASCOMIS CHAR(1),
        VLRPISVENDA NUMERIC(15, 3) DEFAULT 0,
        VLRCOFINSVENDA NUMERIC(15, 3) DEFAULT 0,
        VLRIRVENDA NUMERIC(15, 3) DEFAULT 0,
        VLRCSOCIALVENDA NUMERIC(15, 3) DEFAULT 0,
        PERCMCOMISVENDA NUMERIC(7, 3) DEFAULT 0,
        CODEMPCM INTEGER,
        CODFILIALCM INTEGER,
        CODCLCOMIS INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
        EMMANUT CHAR(1) DEFAULT 'N',
        BLOQVENDA CHAR(1) DEFAULT 'N' NOT NULL,
CONSTRAINT VDVENDAPK PRIMARY KEY (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP));

/* Table: VDVENDAORC, Owner: SYSDBA */
CREATE TABLE VDVENDAORC (CODEMP INTEGER NOT NULL,
        CODFILIAL INTEGER NOT NULL,
        TIPOVENDA CHAR(1) NOT NULL,
        CODVENDA INTEGER NOT NULL,
        CODITVENDA INTEGER NOT NULL,
        CODEMPOR INTEGER NOT NULL,
        CODFILIALOR INTEGER NOT NULL,
        TIPOORC CHAR(1),
        CODORC INTEGER NOT NULL,
        CODITORC INTEGER NOT NULL,
CONSTRAINT VDVENDAORCPK PRIMARY KEY (CODITVENDA, CODVENDA, TIPOVENDA, CODFILIAL, CODEMP, CODITORC, CODORC, CODFILIALOR, CODEMPOR));

/* Table: VDVENDEDOR, Owner: SYSDBA */
CREATE TABLE VDVENDEDOR (CODEMP INTEGER NOT NULL,
        CODFILIAL SMALLINT NOT NULL,
        CODVEND INTEGER NOT NULL,
        NOMEVEND CHAR(40),
        ENDVEND CHAR(50),
        NUMVEND INTEGER,
        COMPLVEND CHAR(20),
        BAIRVEND CHAR(30),
        CIDVEND CHAR(30),
        CEPVEND CHAR(8),
        UFVEND CHAR(2),
        FONEVEND CHAR(12),
        FAXVEND CHAR(8),
        EMAILVEND CHAR(50),
        PERCCOMVEND NUMERIC(7, 3),
        COMIPIVEND CHAR(1),
        CODEMPPN INTEGER,
        CODFILIALPN SMALLINT,
        CODPLAN CHAR(13),
        CPFVEND CHAR(11),
        RGVEND CHAR(10),
        CNPJVEND CHAR(14),
        INSCVEND CHAR(15),
        CELVEND CHAR(12),
        CODEMPSE INTEGER,
        CODFILIALSE INTEGER,
        CODSETOR INTEGER,
        CODEMPCM INTEGER,
        CODFILIALCM INTEGER,
        CODCLCOMIS INTEGER,
        DTINS DATE DEFAULT 'now',
        IDUSUINS CHAR(8) DEFAULT USER,
        DTALT DATE DEFAULT 'now',
        IDUSUALT CHAR(8) DEFAULT USER,
        CODFORNVEND CHAR(13),
        HINS TIME DEFAULT 'now',
        HALT TIME DEFAULT 'now',
CONSTRAINT VDVENDEDORPK PRIMARY KEY (CODVEND, CODFILIAL, CODEMP));

/*  Index definitions for all user tables */
CREATE INDEX CPFORNECEDIDX01 ON CPFORNECED(RAZFOR);
CREATE INDEX CPPRODFORIDX01 ON CPPRODFOR(REFPRODFOR, CODFILIAL, CODEMP);
CREATE INDEX CPTIPOFORICX01 ON CPTIPOFOR(DESCTIPOFOR);
CREATE INDEX EQMOVPRODIDX01 ON EQMOVPROD(CODLOTE, CODPROD);
CREATE UNIQUE INDEX EQPRODUTOIDX01 ON EQPRODUTO(REFPROD);
CREATE INDEX EQPRODUTOIDX02 ON EQPRODUTO(DESCPROD);
CREATE INDEX EQSIMILARIDX01 ON EQSIMILAR(REFPRODSIMFK);
CREATE INDEX EQUNIDADEIDX01 ON EQUNIDADE(DESCUNID);
CREATE INDEX FNBANCOIDX01 ON FNBANCO(NOMEBANCO);
CREATE INDEX FNCCIDX01 ON FNCC(DESCCC);
CREATE INDEX FNCCIDX02 ON FNCC(CODREDCC, CODEMP, CODFILIAL);
CREATE UNIQUE INDEX FNCONTAIDX01 ON FNCONTA(CODPLAN);
CREATE INDEX FNLANCAIDX01 ON FNLANCA(DATALANCA, CODFILIAL, CODEMP);
CREATE INDEX FNPLANEJAMENTOIDX01 ON FNPLANEJAMENTO(DESCPLAN);
CREATE INDEX FNPLANOPAGIDX01 ON FNPLANOPAG(DESCPLANOPAG);
CREATE INDEX FNSUBLANCAIDX01 ON FNSUBLANCA(DATASUBLANCA, CODSUBLANCA, CODLANCA, CODFILIAL, CODEMP);
CREATE INDEX FNTIPOCOBIDX01 ON FNTIPOCOB(DESCTIPOCOB);
CREATE INDEX SGLOGIDX01 ON SGLOG(DATALOG);
CREATE INDEX SGLOGIDX02 ON SGLOG(TIPOLOG);
CREATE INDEX VDCLIENTEIDX01 ON VDCLIENTE(NOMECLI);
CREATE INDEX VDCLIENTEIDX02 ON VDCLIENTE(RAZCLI);
CREATE INDEX VDCOMISSAOIDX01 ON VDCOMISSAO(CODREC, NPARCITREC);
CREATE INDEX VDSETORIDX01 ON VDSETOR(DESCSETOR);
CREATE INDEX VDTIPOCLIIDX01 ON VDTIPOCLI(DESCTIPOCLI);
CREATE INDEX VDTRANSPIDX01 ON VDTRANSP(RAZTRAN);
CREATE INDEX VDVENDAIDX01 ON VDVENDA(DTEMITVENDA);
CREATE INDEX VDVENDAIDX02 ON VDVENDA(DTSAIDAVENDA);
CREATE INDEX VDVENDEDORIDX01 ON VDVENDEDOR(NOMEVEND);
 
ALTER TABLE ATATENDENTE ADD CONSTRAINT ATATENDENTEFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE ATATENDENTE ADD CONSTRAINT ATATENDENTEFKSGUSUARIO FOREIGN KEY (IDUSU, CODFILIALUS, CODEMPUS) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE ATATENDENTE ADD CONSTRAINT ATATENDENTEFKVDVENDEDOR FOREIGN KEY (CODVEND, CODFILIALVE, CODEMPVE) REFERENCES VDVENDEDOR (CODVEND, CODFILIAL, CODEMP);
 
ALTER TABLE ATATENDIMENTO ADD CONSTRAINT ATATENDIMENTOFKATATENDENTE FOREIGN KEY (CODATEND, CODFILIALAE, CODEMPAE) REFERENCES ATATENDENTE (CODATEND, CODFILIAL, CODEMP);
 
ALTER TABLE ATATENDIMENTO ADD CONSTRAINT ATATENDIMENTOFKATCONVENIADO FOREIGN KEY (CODCONV, CODFILIALCV, CODEMPCV) REFERENCES ATCONVENIADO (CODCONV, CODFILIAL, CODEMP);
 
ALTER TABLE ATATENDIMENTO ADD CONSTRAINT ATATENDIMENTOFKATTIPOATENDO FOREIGN KEY (CODTPATENDO, CODFILIALTO, CODEMPTO) REFERENCES ATTIPOATENDO (CODTPATENDO, CODFILIAL, CODEMP);
 
ALTER TABLE ATATENDIMENTO ADD CONSTRAINT ATATENDIMENTOFKSETOR FOREIGN KEY (CODSETAT, CODFILIALSA, CODEMPSA) REFERENCES ATSETOR (CODSETAT, CODFILIAL, CODEMP);
 
ALTER TABLE ATATENDIMENTO ADD CONSTRAINT ATATENDIMENTOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE ATATENDIMENTO ADD CONSTRAINT ATATENDIMENTOFKSGUSUARIO FOREIGN KEY (IDUSU, CODFILIALUS, CODEMPUS) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE ATATENDIMENTOORC ADD CONSTRAINT ATATENDIMENTOORCFKATATENDIMENTO FOREIGN KEY (CODATENDO, CODFILIAL, CODEMP) REFERENCES ATATENDIMENTO (CODATENDO, CODFILIAL, CODEMP);
 
ALTER TABLE ATATENDIMENTOORC ADD CONSTRAINT ATATENDIMENTOORCFKVDORCAMENTO FOREIGN KEY (CODORC, TIPOORC, CODFILIALOC, CODEMPOC) REFERENCES VDORCAMENTO (CODORC, TIPOORC, CODFILIAL, CODEMP);
 
ALTER TABLE ATATRIBUICAO ADD CONSTRAINT ATATRIBUICAOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE ATCONVATRIB ADD CONSTRAINT ATCONVATRIBFKATATRIBUICAO FOREIGN KEY (CODATRIB, CODFILIALAB, CODEMPAB) REFERENCES ATATRIBUICAO (CODATRIB, CODFILIAL, CODEMP);
 
ALTER TABLE ATCONVATRIB ADD CONSTRAINT ATCONVATRIBFKATCONVENIADO FOREIGN KEY (CODCONV, CODFILIAL, CODEMP) REFERENCES ATCONVENIADO (CODCONV, CODFILIAL, CODEMP);
 
ALTER TABLE ATCONVATRIBTB ADD CONSTRAINT ATCONVATRIBTBFKATCONVATRIB FOREIGN KEY (CODCONV, SEQCONVATRIB, CODFILIAL, CODEMP) REFERENCES ATCONVATRIB (CODCONV, SEQCONVATRIB, CODFILIAL, CODEMP);
 
ALTER TABLE ATCONVATRIBTB ADD CONSTRAINT ATCONVATRIBTBFKSGITTABELA FOREIGN KEY (CODITTB, CODTB, CODFILIALTB, CODEMPTB) REFERENCES SGITTABELA (CODITTB, CODTB, CODFILIAL, CODEMP);
 
ALTER TABLE ATCONVENIADO ADD CONSTRAINT ATCONVENIADOFKATENCAMINH FOREIGN KEY (CODENC, CODFILIALEC, CODEMPEC) REFERENCES ATENCAMINHADOR (CODENC, CODFILIAL, CODEMP);
 
ALTER TABLE ATCONVENIADO ADD CONSTRAINT ATCONVENIADOFKATENCAMINHADOR FOREIGN KEY (CODENC, CODFILIALEC, CODEMPEC) REFERENCES ATENCAMINHADOR (CODENC, CODFILIAL, CODEMP);
 
ALTER TABLE ATCONVENIADO ADD CONSTRAINT ATCONVENIADOFKATTIPOCONV FOREIGN KEY (CODTPCONV, CODFILIALTC, CODEMPTC) REFERENCES ATTIPOCONV (CODTPCONV, CODFILIAL, CODEMP);
 
ALTER TABLE ATCONVENIADO ADD CONSTRAINT ATCONVENIADOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE ATCONVENIADO ADD CONSTRAINT ATCONVENIADOFKSGGRAUINST FOREIGN KEY (CODGRI, CODFILIALGI, CODEMPGI) REFERENCES SGGRAUINST (CODGRI, CODFILIAL, CODEMP);
 
ALTER TABLE ATENCAMINHADOR ADD CONSTRAINT ATENCAMINHADORFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE ATSETOR ADD CONSTRAINT ATSETORFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE ATSETORATENDENTE ADD CONSTRAINT ATSETORATENDENTEFKATATENDENTE FOREIGN KEY (CODATEND, CODFILIALAE, CODEMPAE) REFERENCES ATATENDENTE (CODATEND, CODFILIAL, CODEMP);
 
ALTER TABLE ATSETORATENDENTE ADD CONSTRAINT ATSETORATENDENTEFKATSETOR FOREIGN KEY (CODSETAT, CODFILIAL, CODEMP) REFERENCES ATSETOR (CODSETAT, CODFILIAL, CODEMP);
 
ALTER TABLE ATTIPOATEND ADD CONSTRAINT ATTIPOATENDFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE ATTIPOATENDO ADD CONSTRAINT ATTIPOATENDOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE ATTIPOATENDO ADD CONSTRAINT ATTIPOATENDOFLUXO FOREIGN KEY (CODFLUXO, CODFILIALFX, CODEMPFX) REFERENCES SGFLUXO (CODFLUXO, CODFILIAL, CODEMP);
 
ALTER TABLE ATTIPOATENDOSETOR ADD CONSTRAINT ATTIPOATENDOSETORFKATSETOR FOREIGN KEY (CODSETAT, CODFILIALST, CODEMPST) REFERENCES ATSETOR (CODSETAT, CODFILIAL, CODEMP);
 
ALTER TABLE ATTIPOATENDOSETOR ADD CONSTRAINT ATTIPOATENDOSETORFKATTIPOATENDO FOREIGN KEY (CODTPATENDO, CODFILIAL, CODEMP) REFERENCES ATTIPOATENDO (CODTPATENDO, CODFILIAL, CODEMP);
 
ALTER TABLE ATTIPOCONV ADD CONSTRAINT ATTIPOCONVFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE CPCOMPRA ADD CONSTRAINT CPCOMPRAFKCPFORNECED FOREIGN KEY (CODFOR, CODFILIALFR, CODEMPFR) REFERENCES CPFORNECED (CODFOR, CODFILIAL, CODEMP);
 
ALTER TABLE CPCOMPRA ADD CONSTRAINT CPCOMPRAFKEQTIPOMOV FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE CPCOMPRA ADD CONSTRAINT CPCOMPRAFKFNBANCO FOREIGN KEY (CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNBANCO (CODBANCO, CODFILIAL, CODEMP);
 
ALTER TABLE CPCOMPRA ADD CONSTRAINT CPCOMPRAFKFNPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPG, CODEMPPG) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);
 
ALTER TABLE CPCOMPRA ADD CONSTRAINT CPCOMPRAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE CPCOMPRAVENDA ADD CONSTRAINT CPCOMPRAVENDAFKCPITCOMPRA FOREIGN KEY (CODITCOMPRA, CODCOMPRA, CODFILIAL, CODEMP) REFERENCES CPITCOMPRA (CODITCOMPRA, CODCOMPRA, CODFILIAL, CODEMP);
 
ALTER TABLE CPCOMPRAVENDA ADD CONSTRAINT CPCOMPRAVENDAFKVDITVENDA FOREIGN KEY (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIALVD, CODEMPVD) REFERENCES VDITVENDA (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIAL, CODEMP);
 
ALTER TABLE CPEQUIVCFOP ADD CONSTRAINT CPEQUIVCFOPFKLFNATOPER FOREIGN KEY (CODNAT, CODFILIAL, CODEMP) REFERENCES LFNATOPER (CODNAT, CODFILIAL, CODEMP);
 
ALTER TABLE CPEQUIVCFOP ADD CONSTRAINT CPEQUIVCFOPFKLFNATOPERD FOREIGN KEY (CODNATND, CODFILIALND, CODEMPND) REFERENCES LFNATOPER (CODNAT, CODFILIAL, CODEMP);
 
ALTER TABLE CPFORNECED ADD CONSTRAINT CPFORNECEDFKCPTIPOFOR FOREIGN KEY (CODTIPOFOR, CODFILIALTF, CODEMPTF) REFERENCES CPTIPOFOR (CODTIPOFOR, CODFILIAL, CODEMP);
 
ALTER TABLE CPFORNECED ADD CONSTRAINT CPFORNECEDFKFNBANCO FOREIGN KEY (CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNBANCO (CODBANCO, CODFILIAL, CODEMP);
 
ALTER TABLE CPFORNECED ADD CONSTRAINT CPFORNECEDFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE CPITCOMPRA ADD CONSTRAINT CPITCOMPRAFKCPCOMPRA FOREIGN KEY (CODCOMPRA, CODFILIAL, CODEMP) REFERENCES CPCOMPRA (CODCOMPRA, CODFILIAL, CODEMP);
 
ALTER TABLE CPITCOMPRA ADD CONSTRAINT CPITCOMPRAFKEQLOTE FOREIGN KEY (CODLOTE, CODPROD, CODFILIALLE, CODEMPLE) REFERENCES EQLOTE (CODLOTE, CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE CPITCOMPRA ADD CONSTRAINT CPITCOMPRAFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE CPITCOMPRA ADD CONSTRAINT CPITCOMPRAFKLFNATOPER FOREIGN KEY (CODNAT, CODFILIALNT, CODEMPNT) REFERENCES LFNATOPER (CODNAT, CODFILIAL, CODEMP);
 
ALTER TABLE CPITSOLICITACAO ADD CONSTRAINT CPITSOLICITACAOFKCPSOLICITA FOREIGN KEY (CODSOL, CODFILIAL, CODEMP) REFERENCES CPSOLICITACAO (CODSOL, CODFILIAL, CODEMP);
 
ALTER TABLE CPPRODFOR ADD CONSTRAINT CPPRODFORFKCPFORNECED FOREIGN KEY (CODFOR, CODFILIAL, CODEMP) REFERENCES CPFORNECED (CODFOR, CODFILIAL, CODEMP);
 
ALTER TABLE CPPRODFOR ADD CONSTRAINT CPPRODFORFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE CPTABFOR ADD CONSTRAINT CPTABFORFKCPFORNECED FOREIGN KEY (CODFOR, CODFILIAL, CODEMP) REFERENCES CPFORNECED (CODFOR, CODFILIAL, CODEMP);
 
ALTER TABLE CPTABFOR ADD CONSTRAINT CPTABFORFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE CPTIPOFOR ADD CONSTRAINT CPTIPOFORFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQALMOX ADD CONSTRAINT EQALMOXFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQFATCONV ADD CONSTRAINT EQFATCONVFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIAL, CODEMP) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQFATCONV ADD CONSTRAINT EQFATCONVFKEQUNIDADE FOREIGN KEY (CODUNID, CODFILIAL, CODEMP) REFERENCES EQUNIDADE (CODUNID, CODFILIAL, CODEMP);
 
ALTER TABLE EQFATCONV ADD CONSTRAINT EQFATCONVFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQGRUPO ADD CONSTRAINT EQGRUPOFKEQGRUPO FOREIGN KEY (CODSUBGRUP, CODFILIAL, CODEMP) REFERENCES EQGRUPO (CODGRUP, CODFILIAL, CODEMP);
 
ALTER TABLE EQGRUPO ADD CONSTRAINT EQGRUPOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQINVPROD ADD CONSTRAINT EQINVPRODFKEQALMOX FOREIGN KEY (CODALMOX, CODFILIALAX, CODEMPAX) REFERENCES EQALMOX (CODALMOX, CODFILIAL, CODEMP);
 
ALTER TABLE EQINVPROD ADD CONSTRAINT EQINVPRODFKEQLOTE FOREIGN KEY (CODLOTE, CODPROD, CODFILIALLE, CODEMPLE) REFERENCES EQLOTE (CODLOTE, CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQINVPROD ADD CONSTRAINT EQINVPRODFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQINVPROD ADD CONSTRAINT EQINVPRODFKEQTIPOMOV FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE EQINVPROD ADD CONSTRAINT EQINVPRODFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQITMODGRADE ADD CONSTRAINT EGITMODGRADEFKEQMODGRADE FOREIGN KEY (CODMODG, CODFILIAL, CODEMP) REFERENCES EQMODGRADE (CODMODG, CODFILIAL, CODEMP);
 
ALTER TABLE EQITMODGRADE ADD CONSTRAINT EGITMODGRADEFKEQVARGRADE FOREIGN KEY (CODVARG, CODFILIAL, CODEMP) REFERENCES EQVARGRADE (CODVARG, CODFILIAL, CODEMP);
 
ALTER TABLE EQITRMA ADD CONSTRAINT EQITRMAFKEQLOTE FOREIGN KEY (CODLOTE, CODPROD, CODFILIALLE, CODEMPLE) REFERENCES EQLOTE (CODLOTE, CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQITRMA ADD CONSTRAINT EQITRMAFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQITRMA ADD CONSTRAINT EQITRMAFKEQRMA FOREIGN KEY (CODRMA, CODFILIAL, CODEMP) REFERENCES EQRMA (CODRMA, CODFILIAL, CODEMP);
 
ALTER TABLE EQLANCTOEXP ADD CONSTRAINT EQLANCTOEXPFKEQTIPOEXP FOREIGN KEY (CODTIPOEXP, CODFILIALTE, CODEMPTE) REFERENCES EQTIPOEXP (CODTIPOEXP, CODFILIAL, CODEMP);
 
ALTER TABLE EQLANCTOEXP ADD CONSTRAINT EQLANCTOEXPFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQLANCTOEXP ADD CONSTRAINT EQLANCTOEXPFKVDCLIENTE FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);
 
ALTER TABLE EQLOTE ADD CONSTRAINT EQLOTEFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIAL, CODEMP) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQLOTE ADD CONSTRAINT EQLOTEFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQMARCA ADD CONSTRAINT EQMARCAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQMODGRADE ADD CONSTRAINT EQMODGRADEFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQMODGRADE ADD CONSTRAINT EQMODGRADEFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQMOVEXP ADD CONSTRAINT EQMOVEXPFKEQTIPOEXP FOREIGN KEY (CODTIPOEXP, CODFILIALTE, CODEMPTE) REFERENCES EQTIPOEXP (CODTIPOEXP, CODFILIAL, CODEMP);
 
ALTER TABLE EQMOVEXP ADD CONSTRAINT EQMOVEXPFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQMOVEXP ADD CONSTRAINT EQMOVEXPFKVDCLIENTE FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);
 
ALTER TABLE EQMOVPROD ADD CONSTRAINT EQMOVPRODFKCPITCOMPRA FOREIGN KEY (CODITCOMPRA, CODCOMPRA, CODFILIALCP, CODEMPCP) REFERENCES CPITCOMPRA (CODITCOMPRA, CODCOMPRA, CODFILIAL, CODEMP);
 
ALTER TABLE EQMOVPROD ADD CONSTRAINT EQMOVPRODFKEQINVPROD FOREIGN KEY (CODINVPROD, CODFILIALIV, CODEMPIV) REFERENCES EQINVPROD (CODINVPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQMOVPROD ADD CONSTRAINT EQMOVPRODFKEQITRMA FOREIGN KEY (CODRMA, CODITRMA, CODFILIALRM, CODEMPRM) REFERENCES EQITRMA (CODRMA, CODITRMA, CODFILIAL, CODEMP);
 
ALTER TABLE EQMOVPROD ADD CONSTRAINT EQMOVPRODFKEQLOTE FOREIGN KEY (CODLOTE, CODPROD, CODFILIALLE, CODEMPLE) REFERENCES EQLOTE (CODLOTE, CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQMOVPROD ADD CONSTRAINT EQMOVPRODFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQMOVPROD ADD CONSTRAINT EQMOVPRODFKEQTIPOMOV FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE EQMOVPROD ADD CONSTRAINT EQMOVPRODFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQMOVPROD ADD CONSTRAINT EQMOVPRODFKVDITVENDA FOREIGN KEY (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIALVD, CODEMPVD) REFERENCES VDITVENDA (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIAL, CODEMP);
 
ALTER TABLE EQPRODUTO ADD CONSTRAINT EQPRODUTOFKEQALMOX FOREIGN KEY (CODALMOX, CODFILIALAX, CODEMPAX) REFERENCES EQALMOX (CODALMOX, CODFILIAL, CODEMP);
 
ALTER TABLE EQPRODUTO ADD CONSTRAINT EQPRODUTOFKEQGRUPO FOREIGN KEY (CODGRUP, CODFILIALGP, CODEMPGP) REFERENCES EQGRUPO (CODGRUP, CODFILIAL, CODEMP);
 
ALTER TABLE EQPRODUTO ADD CONSTRAINT EQPRODUTOFKEQMARCA FOREIGN KEY (CODMARCA, CODFILIALMC, CODEMPMC) REFERENCES EQMARCA (CODMARCA, CODFILIAL, CODEMP);
 
ALTER TABLE EQPRODUTO ADD CONSTRAINT EQPRODUTOFKEQUNIDADE FOREIGN KEY (CODUNID, CODFILIALUD, CODEMPUD) REFERENCES EQUNIDADE (CODUNID, CODFILIAL, CODEMP);
 
ALTER TABLE EQPRODUTO ADD CONSTRAINT EQPRODUTOFKFNMOEDA FOREIGN KEY (CODMOEDA, CODFILIALMA, CODEMPMA) REFERENCES FNMOEDA (CODMOEDA, CODFILIAL, CODEMP);
 
ALTER TABLE EQPRODUTO ADD CONSTRAINT EQPRODUTOFKLFCLFISCAL FOREIGN KEY (CODFISC, CODFILIALFC, CODEMPFC) REFERENCES LFCLFISCAL (CODFISC, CODFILIAL, CODEMP);
 
ALTER TABLE EQPRODUTO ADD CONSTRAINT EQPRODUTOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQRMA ADD CONSTRAINT EQRMAFKEQTIPOMOV FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE EQRMA ADD CONSTRAINT EQRMAFKFNCC FOREIGN KEY (CODCC, ANOCC, CODFILIALCC, CODEMPCC) REFERENCES FNCC (CODCC, ANOCC, CODFILIAL, CODEMP);
 
ALTER TABLE EQRMA ADD CONSTRAINT EQRMAFKSGUSUARIO FOREIGN KEY (IDUSU, CODFILIALUU, CODEMPUU) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE EQRMA ADD CONSTRAINT EQRMAFKSGUSUARIOD FOREIGN KEY (IDUSUD, CODFILIALUD, CODEMPUD) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE EQRMA ADD CONSTRAINT EQRMAFKSGUSUARIOG FOREIGN KEY (IDUSUG, CODFILIALUG, CODEMPUG) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE EQRMAAL ADD CONSTRAINT EQRMAALFKEQRMA FOREIGN KEY (CODRMA, CODFILIAL, CODEMP) REFERENCES EQRMA (CODRMA, CODFILIAL, CODEMP);
 
ALTER TABLE EQRMAAL ADD CONSTRAINT EQRMAALFKSGUSUARIO FOREIGN KEY (IDUSU, CODFILIALUU, CODEMPUU) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE EQSALDOPROD ADD CONSTRAINT EQSOLDOPRODFKEQALMOX FOREIGN KEY (CODALMOX, CODFILIALAX, CODEMPAX) REFERENCES EQALMOX (CODALMOX, CODFILIAL, CODEMP);
 
ALTER TABLE EQSALDOPROD ADD CONSTRAINT EQSOLDOPRODFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIAL, CODEMP) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQSIMILAR ADD CONSTRAINT EQSIMILARFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE EQTIPOEXP ADD CONSTRAINT EQTIPOEXPFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQTIPOMOV ADD CONSTRAINT EQTIPOMOVFKEQTIPOMOV FOREIGN KEY (CODTIPOMOVTM, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE EQTIPOMOV ADD CONSTRAINT EQTIPOMOVFKLFMODNOTA FOREIGN KEY (CODMODNOTA, CODFILIALMN, CODEMPMN) REFERENCES LFMODNOTA (CODMODNOTA, CODFILIAL, CODEMP);
 
ALTER TABLE EQTIPOMOV ADD CONSTRAINT EQTIPOMOVFKLFSERIE FOREIGN KEY (SERIE, CODFILIALSE, CODEMPSE) REFERENCES LFSERIE (SERIE, CODFILIAL, CODEMP);
 
ALTER TABLE EQTIPOMOV ADD CONSTRAINT EQTIPOMOVFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQTIPOMOV ADD CONSTRAINT EQTIPOMOVFKVDTABPRECO FOREIGN KEY (CODTAB, CODFILIALTB, CODEMPTB) REFERENCES VDTABPRECO (CODTAB, CODFILIAL, CODEMP);
 
ALTER TABLE EQUNIDADE ADD CONSTRAINT EQUNIDADEFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE EQVARGRADE ADD CONSTRAINT EQVARGRADEFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNBANCO ADD CONSTRAINT FNBANCOFKFNMODBOLETO FOREIGN KEY (CODMODBOL, CODFILIALMB, CODEMPMB) REFERENCES FNMODBOLETO (CODMODBOL, CODFILIAL, CODEMP);
 
ALTER TABLE FNBANCO ADD CONSTRAINT FNBANCOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNCC ADD CONSTRAINT FNCCFKFNCC FOREIGN KEY (CODSUBCC, ANOSCC, CODFILIAL, CODEMP) REFERENCES FNCC (CODCC, ANOCC, CODFILIAL, CODEMP);
 
ALTER TABLE FNCC ADD CONSTRAINT FNCCFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNCONTA ADD CONSTRAINT FNCONTAFKFNBANCO FOREIGN KEY (CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNBANCO (CODBANCO, CODFILIAL, CODEMP);
 
ALTER TABLE FNCONTA ADD CONSTRAINT FNCONTAFKFNMOEDA FOREIGN KEY (CODMOEDA, CODFILIALMA, CODEMPMA) REFERENCES FNMOEDA (CODMOEDA, CODFILIAL, CODEMP);
 
ALTER TABLE FNCONTA ADD CONSTRAINT FNCONTAFKFNPLANEJAMENTO FOREIGN KEY (CODPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, CODFILIAL, CODEMP);
 
ALTER TABLE FNCONTA ADD CONSTRAINT FNCONTAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNCOTMOEDA ADD CONSTRAINT FNCOTMOEDAFKFNMOEDA FOREIGN KEY (CODMOEDA, CODFILIAL, CODEMP) REFERENCES FNMOEDA (CODMOEDA, CODFILIAL, CODEMP);
 
ALTER TABLE FNCOTMOEDA ADD CONSTRAINT FNCOTMOEDAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNITPAGAR ADD CONSTRAINT FNITPAGARFKFNCONTA FOREIGN KEY (NUMCONTA, CODFILIALCA, CODEMPCA) REFERENCES FNCONTA (NUMCONTA, CODFILIAL, CODEMP);
 
ALTER TABLE FNITPAGAR ADD CONSTRAINT FNITPAGARFKFNPAGAR FOREIGN KEY (CODPAG, CODFILIAL, CODEMP) REFERENCES FNPAGAR (CODPAG, CODFILIAL, CODEMP);
 
ALTER TABLE FNITPAGAR ADD CONSTRAINT FNITPAGARFKFNPLANEJAMENTO FOREIGN KEY (CODPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, CODFILIAL, CODEMP);
 
ALTER TABLE FNITRECEBER ADD CONSTRAINT FNITRECEBERFKFNBANCO FOREIGN KEY (CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNBANCO (CODBANCO, CODFILIAL, CODEMP);
 
ALTER TABLE FNITRECEBER ADD CONSTRAINT FNITRECEBERFKFNCONTA FOREIGN KEY (NUMCONTA, CODFILIALCA, CODEMPCA) REFERENCES FNCONTA (NUMCONTA, CODFILIAL, CODEMP);
 
ALTER TABLE FNITRECEBER ADD CONSTRAINT FNITRECEBERFKFNPLANEJAMENTO FOREIGN KEY (CODPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, CODFILIAL, CODEMP);
 
ALTER TABLE FNITRECEBER ADD CONSTRAINT FNITRECEBERFKFNRECEBER FOREIGN KEY (CODREC, CODFILIAL, CODEMP) REFERENCES FNRECEBER (CODREC, CODFILIAL, CODEMP);
 
ALTER TABLE FNITTBJUROS ADD CONSTRAINT FNITTBJUROSFKFNTBJUROS FOREIGN KEY (CODTBJ, CODFILIAL, CODEMP) REFERENCES FNTBJUROS (CODTBJ, CODFILIAL, CODEMP);
 
ALTER TABLE FNLANCA ADD CONSTRAINT FNLANCAFKFNITPAGAR FOREIGN KEY (NPARCPAG, CODPAG, CODFILIALPG, CODEMPPG) REFERENCES FNITPAGAR (NPARCPAG, CODPAG, CODFILIAL, CODEMP);
 
ALTER TABLE FNLANCA ADD CONSTRAINT FNLANCAFKFNITRECEBER FOREIGN KEY (NPARCITREC, CODREC, CODFILIALRC, CODEMPRC) REFERENCES FNITRECEBER (NPARCITREC, CODREC, CODFILIAL, CODEMP);
 
ALTER TABLE FNLANCA ADD CONSTRAINT FNLANCAFKFNPAGTOCOMI FOREIGN KEY (CODPCOMI, CODFILIALCI, CODEMPCI) REFERENCES FNPAGTOCOMI (CODPCOMI, CODFILIAL, CODEMP);
 
ALTER TABLE FNLANCA ADD CONSTRAINT FNLANCAFKFNPLANEJAMENTO FOREIGN KEY (CODPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, CODFILIAL, CODEMP);
 
ALTER TABLE FNLANCA ADD CONSTRAINT FNLANCAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNLANCA ADD CONSTRAINT FNLANCAFKVDCOMISSAO FOREIGN KEY (CODCOMI, CODFILIAL, CODEMP) REFERENCES VDCOMISSAO (CODCOMI, CODFILIAL, CODEMP);
 
ALTER TABLE FNLIBCRED ADD CONSTRAINT FNLIBCREDFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNLIBCRED ADD CONSTRAINT FNLIBCREDFKSGUSUARIO FOREIGN KEY (IDUSU, CODFILIALUS, CODEMPUS) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE FNLIBCRED ADD CONSTRAINT FNLIBCREDFKVDCLIENTE FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);
 
ALTER TABLE FNMOEDA ADD CONSTRAINT FNMOEDAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNPAGAR ADD CONSTRAINT FNPAGARFKCPCOMPRA FOREIGN KEY (CODCOMPRA, CODFILIALCP, CODEMPCP) REFERENCES CPCOMPRA (CODCOMPRA, CODFILIAL, CODEMP);
 
ALTER TABLE FNPAGAR ADD CONSTRAINT FNPAGARFKCPFORNECED FOREIGN KEY (CODFOR, CODFILIALFR, CODEMPFR) REFERENCES CPFORNECED (CODFOR, CODFILIAL, CODEMP);
 
ALTER TABLE FNPAGAR ADD CONSTRAINT FNPAGARFKFNBANCO FOREIGN KEY (CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNBANCO (CODBANCO, CODFILIAL, CODEMP);
 
ALTER TABLE FNPAGAR ADD CONSTRAINT FNPAGARFKFNPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPG, CODEMPPG) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);
 
ALTER TABLE FNPAGAR ADD CONSTRAINT FNPAGARFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNPAGTOCOMI ADD CONSTRAINT FNPAGTOCOMIFKFNCONTA FOREIGN KEY (NUMCONTA, CODFILIAL, CODEMP) REFERENCES FNCONTA (NUMCONTA, CODFILIAL, CODEMP);
 
ALTER TABLE FNPAGTOCOMI ADD CONSTRAINT FNPAGTOCOMIFKFNPLANEJAMENTO FOREIGN KEY (CODPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, CODFILIAL, CODEMP);
 
ALTER TABLE FNPAGTOCOMI ADD CONSTRAINT FNPAGTOCOMIFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNPARCPAG ADD CONSTRAINT FNPARCPAGFKFNPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIAL, CODEMP) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);
 
ALTER TABLE FNPLANEJAMENTO ADD CONSTRAINT FNPLANEJAMENTOFKFNPLANEJAMENTO FOREIGN KEY (CODSUBPLAN, CODFILIAL, CODEMP) REFERENCES FNPLANEJAMENTO (CODPLAN, CODFILIAL, CODEMP);
 
ALTER TABLE FNPLANEJAMENTO ADD CONSTRAINT FNPLANEJAMENTOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNPLANOPAG ADD CONSTRAINT FNPLANOPAGFKFNCC FOREIGN KEY (CODCC, ANOCC, CODFILIALCC, CODEMPCC) REFERENCES FNCC (CODCC, ANOCC, CODFILIAL, CODEMP);
 
ALTER TABLE FNPLANOPAG ADD CONSTRAINT FNPLANOPAGFKFNCONTA FOREIGN KEY (NUMCONTA, CODFILIALCA, CODEMPCA) REFERENCES FNCONTA (NUMCONTA, CODFILIAL, CODEMP);
 
ALTER TABLE FNPLANOPAG ADD CONSTRAINT FNPLANOPAGFKFNPLANEJAMENTO FOREIGN KEY (CODPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, CODFILIAL, CODEMP);
 
ALTER TABLE FNPLANOPAG ADD CONSTRAINT FNPLANOPAGFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNRECEBER ADD CONSTRAINT FNRECEBERFKFNBANCO FOREIGN KEY (CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNBANCO (CODBANCO, CODFILIAL, CODEMP);
 
ALTER TABLE FNRECEBER ADD CONSTRAINT FNRECEBERFKFNPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPG, CODEMPPG) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);
 
ALTER TABLE FNRECEBER ADD CONSTRAINT FNRECEBERFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNRECEBER ADD CONSTRAINT FNRECEBERFKVDCLIENTE FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);
 
ALTER TABLE FNRECEBER ADD CONSTRAINT FNRECEBERFKVDVENDA FOREIGN KEY (CODVENDA, TIPOVENDA, CODFILIALVA, CODEMPVA) REFERENCES VDVENDA (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP);
 
ALTER TABLE FNRECEBER ADD CONSTRAINT FNRECEBERFKVDVENDEDOR FOREIGN KEY (CODVEND, CODFILIALVD, CODEMPVD) REFERENCES VDVENDEDOR (CODVEND, CODFILIAL, CODEMP);
 
ALTER TABLE FNSALDOLANCA ADD CONSTRAINT FNSALDOLANCAFKFNPLANEJAMENTO FOREIGN KEY (CODPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, CODFILIAL, CODEMP);
 
ALTER TABLE FNSALDOLANCA ADD CONSTRAINT FNSALDOLANCAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNSUBLANCA ADD CONSTRAINT FNSUBLANCAFKCPFORNECED FOREIGN KEY (CODFOR, CODFILIALFR, CODEMPFR) REFERENCES CPFORNECED (CODFOR, CODFILIAL, CODEMP);
 
ALTER TABLE FNSUBLANCA ADD CONSTRAINT FNSUBLANCAFKFNCC FOREIGN KEY (CODCC, ANOCC, CODFILIALCC, CODEMPCC) REFERENCES FNCC (CODCC, ANOCC, CODFILIAL, CODEMP);
 
ALTER TABLE FNSUBLANCA ADD CONSTRAINT FNSUBLANCAFKFNLANCA FOREIGN KEY (CODLANCA, CODFILIAL, CODEMP) REFERENCES FNLANCA (CODLANCA, CODFILIAL, CODEMP);
 
ALTER TABLE FNSUBLANCA ADD CONSTRAINT FNSUBLANCAFKFNPLANEJAMENTO FOREIGN KEY (CODPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, CODFILIAL, CODEMP);
 
ALTER TABLE FNSUBLANCA ADD CONSTRAINT FNSUBLANCAFKVDCLIENTE FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);
 
ALTER TABLE FNTBJUROS ADD CONSTRAINT FNTBJUROSFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE FNTIPOCOB ADD CONSTRAINT FNTIPOCOBFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE LFCLFISCAL ADD CONSTRAINT LFCLFISCALFKLFMENSAGEM FOREIGN KEY (CODMENS, CODFILIALME, CODEMPME) REFERENCES LFMENSAGEM (CODMENS, CODFILIAL, CODEMP);
 
ALTER TABLE LFCLFISCAL ADD CONSTRAINT LFCLFISCALFKLFREGRAFISCAL FOREIGN KEY (CODREGRA, CODFILIALRA, CODEMPRA) REFERENCES LFREGRAFISCAL (CODREGRA, CODFILIAL, CODEMP);
 
ALTER TABLE LFCLFISCAL ADD CONSTRAINT LFCLFISCALFKLFTRATTRIB FOREIGN KEY (CODTRATTRIB, CODFILIALTT, CODEMPTT) REFERENCES LFTRATTRIB (CODTRATTRIB, CODFILIAL, CODEMP);
 
ALTER TABLE LFCLFISCAL ADD CONSTRAINT LFCLFISCALFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE LFITCLFISCAL ADD CONSTRAINT LFITCLFISCALFKLFCLFISCAL FOREIGN KEY (CODFISC, CODFILIAL, CODEMP) REFERENCES LFCLFISCAL (CODFISC, CODFILIAL, CODEMP);
 
ALTER TABLE LFITCLFISCAL ADD CONSTRAINT LFITCLFISCALFKLFMENSAGEM FOREIGN KEY (CODMENS, CODFILIALME, CODEMPME) REFERENCES LFMENSAGEM (CODMENS, CODFILIAL, CODEMP);
 
ALTER TABLE LFITCLFISCAL ADD CONSTRAINT LFITCLFISCALFKLFTIPOFISCCLI FOREIGN KEY (CODFISCCLI, CODFILIALFC, CODEMPFC) REFERENCES LFTIPOFISCCLI (CODFISCCLI, CODFILIAL, CODEMP);
 
ALTER TABLE LFITCLFISCAL ADD CONSTRAINT LFITCLFISCALFKLFTRATTRIB FOREIGN KEY (CODTRATTRIB, CODFILIALTT, CODEMPTT) REFERENCES LFTRATTRIB (CODTRATTRIB, CODFILIAL, CODEMP);
 
ALTER TABLE LFITNATOPER ADD CONSTRAINT LFITNATOPERFKLFTABICMS FOREIGN KEY (UFTI, CODFILIALTI, CODEMPTI) REFERENCES LFTABICMS (UFTI, CODFILIAL, CODEMP);
 
ALTER TABLE LFITREGRAFISCAL ADD CONSTRAINT LFITREGRAFISCALFKEQTIPOMOV FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE LFITREGRAFISCAL ADD CONSTRAINT LFITREGRAFISCALFKLFNATOPER FOREIGN KEY (CODNAT, CODFILIAL, CODEMP) REFERENCES LFNATOPER (CODNAT, CODFILIAL, CODEMP);
 
ALTER TABLE LFITREGRAFISCAL ADD CONSTRAINT LFITREGRAFISCALFKLFREGRAFISCAL FOREIGN KEY (CODREGRA, CODFILIAL, CODEMP) REFERENCES LFREGRAFISCAL (CODREGRA, CODFILIAL, CODEMP);
 
ALTER TABLE LFLIVROFISCAL ADD CONSTRAINT LFLIVROFISCALFKLFNATOPER FOREIGN KEY (CODNAT, CODFILIALNT, CODEMPNT) REFERENCES LFNATOPER (CODNAT, CODFILIAL, CODEMP);
 
ALTER TABLE LFLIVROFISCAL ADD CONSTRAINT LFLIVROFISCALFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE LFMODNOTA ADD CONSTRAINT LFMODNOTAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE LFNATOPER ADD CONSTRAINT LFNATOPERFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE LFREGRAFISCAL ADD CONSTRAINT LFREGRAFISCALFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE LFSERIE ADD CONSTRAINT LFSERIEFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE LFTRATTRIB ADD CONSTRAINT LFTRATTRIBFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE PPESTRUFASE ADD CONSTRAINT PPESTRUFASEFKPPFASE FOREIGN KEY (CODFASE, CODFILIALFS, CODEMPFS) REFERENCES PPFASE (CODFASE, CODFILIAL, CODEMP);
 
ALTER TABLE PPESTRUFASE ADD CONSTRAINT PPESTRUFASEFKPPSTRUTURA FOREIGN KEY (CODPROD, CODFILIAL, CODEMP) REFERENCES PPESTRUTURA (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE PPESTRUFASE ADD CONSTRAINT PPESTRUFASEFKPPTIPOREC FOREIGN KEY (CODTPREC, CODFILIALTR, CODEMPTR) REFERENCES PPTIPOREC (CODTPREC, CODFILIAL, CODEMP);
 
ALTER TABLE PPESTRUFASE ADD CONSTRAINT PPESTRUFASEFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE PPESTRUTURA ADD CONSTRAINT PPESTRUTURAFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIAL, CODEMP) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE PPFASE ADD CONSTRAINT PPFASEFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE PPITESTRUTURA ADD CONSTRAINT PPITESTRUTURAFKEQPRODUTO FOREIGN KEY (CODPRODPD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE PPITESTRUTURA ADD CONSTRAINT PPITESTRUTURAFKPPESTRUTURA FOREIGN KEY (CODPROD, CODFILIAL, CODEMP) REFERENCES PPESTRUTURA (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE PPITESTRUTURA ADD CONSTRAINT PPITESTRUTURAFKPPFASE FOREIGN KEY (CODFASE, CODFILIALFS, CODEMPFS) REFERENCES PPFASE (CODFASE, CODFILIAL, CODEMP);
 
ALTER TABLE PPITOP ADD CONSTRAINT PPITOPFKEQLOTE FOREIGN KEY (CODLOTE, CODPROD, CODFILIALLE, CODEMPLE) REFERENCES EQLOTE (CODLOTE, CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE PPITOP ADD CONSTRAINT PPITOPFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE PPITOP ADD CONSTRAINT PPITOPFKPPFASE FOREIGN KEY (CODFASE, CODFILIALFS, CODEMPFS) REFERENCES PPFASE (CODFASE, CODFILIAL, CODEMP);
 
ALTER TABLE PPOP ADD CONSTRAINT PPOPFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE PPOPFASE ADD CONSTRAINT PPOPFASEFKPPFASE FOREIGN KEY (CODFASE, CODFILIALFS, CODEMPFS) REFERENCES PPFASE (CODFASE, CODFILIAL, CODEMP);
 
ALTER TABLE PPOPFASE ADD CONSTRAINT PPOPFASEFKPPOP FOREIGN KEY (CODOP, CODFILIAL, CODEMP) REFERENCES PPOP (CODOP, CODFILIAL, CODEMP);
 
ALTER TABLE PPOPFASE ADD CONSTRAINT PPOPFASEFKPPRECURSO FOREIGN KEY (CODRECP, CODFILIALRP, CODEMPRP) REFERENCES PPRECURSO (CODRECP, CODFILIAL, CODEMP);
 
ALTER TABLE PPRECURSO ADD CONSTRAINT PPRECURSOFKPPTIPOREC FOREIGN KEY (CODTPREC, CODFILIALTR, CODEMPTR) REFERENCES PPTIPOREC (CODTPREC, CODFILIAL, CODEMP);
 
ALTER TABLE PPRECURSO ADD CONSTRAINT PPRECURSOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE PPTIPOREC ADD CONSTRAINT PPTIPORECFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE PVCAIXAIMP ADD CONSTRAINT PVCAIXAIMPFKPVCAIXA FOREIGN KEY (CODCAIXA, CODFILIAL, CODEMP) REFERENCES PVCAIXA (CODCAIXA, CODFILIAL, CODEMP);
 
ALTER TABLE PVCAIXAIMP ADD CONSTRAINT PVCAIXAIMPFKSGIMPRESSORA FOREIGN KEY (CODIMP, CODFILIAL, CODEMP) REFERENCES SGIMPRESSORA (CODIMP, CODFILIAL, CODEMP);
 
ALTER TABLE PVMOVCAIXA ADD CONSTRAINT PVMOVCAIXAFKSGUSUARIO FOREIGN KEY (IDUSU, CODFILIALUS, CODEMPUS) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE SGACESSOEU ADD CONSTRAINT SGACESSOEUFKSGFILIAL FOREIGN KEY (CODFILIALFL, CODEMPFL) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGACESSOEU ADD CONSTRAINT SGACESSOEUFKSGUSUARIO FOREIGN KEY (IDUSU, CODFILIAL, CODEMP) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE SGACESSOMG ADD CONSTRAINT SGACESSOMGFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGACESSOMU ADD CONSTRAINT SGACESSOMUFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGAGENDA ADD CONSTRAINT SGAGENDAFKSGUSUARIOD FOREIGN KEY (IDUSUD, CODFILIALUD, CODEMPUD) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE SGAGENDA ADD CONSTRAINT SGAGENDAFKSGUSUARIOO FOREIGN KEY (IDUSUO, CODFILIALUO, CODEMPUO) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE SGATRIBUICAO ADD CONSTRAINT SGATRIBUICAOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGATRIBUSU ADD CONSTRAINT SGATRIBUSUFKSGATRIBUICAO FOREIGN KEY (IDATRIB, CODFILIAL, CODEMP) REFERENCES SGATRIBUICAO (IDATRIB, CODFILIAL, CODEMP);
 
ALTER TABLE SGATRIBUSU ADD CONSTRAINT SGATRIBUSUSGUSUARIO FOREIGN KEY (IDUSU, CODFILIALUU, CODEMPUU) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE SGCONEXAO ADD CONSTRAINT SGCONEXAOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGCONEXAO ADD CONSTRAINT SGCONEXAOFKSGUSUARIO FOREIGN KEY (IDUSU, CODFILIAL, CODEMP) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE SGEQVCLIFOR ADD CONSTRAINT SGEQVCLIFORFKCPFORNECED FOREIGN KEY (CODFOR, CODFILIALFR, CODEMPFR) REFERENCES CPFORNECED (CODFOR, CODFILIAL, CODEMP);
 
ALTER TABLE SGEQVCLIFOR ADD CONSTRAINT SGEQVCLIFORFKVDCLIENTE FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);
 
ALTER TABLE SGGRAUINST ADD CONSTRAINT SGGRAUINSTFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGGRPUSU ADD CONSTRAINT SGGRPUSUFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGIMPRESSORA ADD CONSTRAINT SGIMPRESSORAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGITFLUXO ADD CONSTRAINT SGITFLUXOFKSGFLUXO FOREIGN KEY (CODFLUXO, CODFILIAL, CODEMP) REFERENCES SGFLUXO (CODFLUXO, CODFILIAL, CODEMP);
 
ALTER TABLE SGITFLUXO ADD CONSTRAINT SGITFLUXOFKSGPROCESSO FOREIGN KEY (CODPROC, CODFILIALPC, CODEMPPC) REFERENCES SGPROCESSO (CODPROC, CODFILIAL, CODEMP);
 
ALTER TABLE SGITPROCESSO ADD CONSTRAINT SGITPROCESSOFKSGPROCESSO FOREIGN KEY (CODPROC, CODFILIAL, CODEMP) REFERENCES SGPROCESSO (CODPROC, CODFILIAL, CODEMP);
 
ALTER TABLE SGITTABELA ADD CONSTRAINT SGITTABELAFKSGTABELA FOREIGN KEY (CODTB, CODFILIAL, CODEMP) REFERENCES SGTABELA (CODTB, CODFILIAL, CODEMP);
 
ALTER TABLE SGLOG ADD CONSTRAINT SGLOGFKPVCAIXA FOREIGN KEY (CODCAIXA, CODFILIALCX, CODEMPCX) REFERENCES PVCAIXA (CODCAIXA, CODFILIAL, CODEMP);
 
ALTER TABLE SGLOG ADD CONSTRAINT SGLOGFKSGUSUARIO FOREIGN KEY (IDUSU, CODFILIALUS, CODEMPUS) REFERENCES SGUSUARIO (IDUSU, CODFILIAL, CODEMP);
 
ALTER TABLE SGMENU ADD CONSTRAINT SGMENUFKSGMODULO FOREIGN KEY (CODMODU, CODSIS) REFERENCES SGMODULO (CODMODU, CODSIS);
 
ALTER TABLE SGMENUOBJ ADD CONSTRAINT SGMENUOBJFKSGMENU FOREIGN KEY (CODMENU, CODMODU, CODSIS) REFERENCES SGMENU (CODMENU, CODMODU, CODSIS);
 
ALTER TABLE SGMENUOBJ ADD CONSTRAINT SGMENUOBJFKSGOBJETO FOREIGN KEY (CODOBJ, CODEMP) REFERENCES SGOBJETO (CODOBJ, CODEMP);
 
ALTER TABLE SGMODETIQUETA ADD CONSTRAINT SGMODETIQUETAFKSGPAPEL FOREIGN KEY (CODPAPEL, CODFILIALPL, CODEMPPL) REFERENCES SGPAPEL (CODPAPEL, CODFILIAL, CODEMP);
 
ALTER TABLE SGOBJETO ADD CONSTRAINT SGOBJETOFKSGEMPRESA FOREIGN KEY (CODEMP) REFERENCES SGEMPRESA (CODEMP);
 
ALTER TABLE SGOBJETOTB ADD CONSTRAINT SGOBJETOTBFKSGOBJETO FOREIGN KEY (CODOBJ, CODEMP) REFERENCES SGOBJETO (CODOBJ, CODEMP);
 
ALTER TABLE SGOBJETOTB ADD CONSTRAINT SGOBJETOTBFKSGTABELA FOREIGN KEY (CODTB, CODFILIALTB, CODEMPTB) REFERENCES SGTABELA (CODTB, CODFILIAL, CODEMP);
 
ALTER TABLE SGPAPEL ADD CONSTRAINT SGPAPELFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FK2EQTIPOMOV FOREIGN KEY (CODTIPOMOV2, CODFILIALT2, CODEMPT2) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FK3EQTIPOMOV FOREIGN KEY (CODTIPOMOV3, CODFILIALT3, CODEMPT3) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FK4EQTIPOMOV FOREIGN KEY (CODTIPOMOV4, CODFILIALT4, CODEMPT4) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FK5EQTIPOMOV FOREIGN KEY (CODTIPOMOV5, CODFILIALT5, CODEMPT5) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FK6EQTIPOMOV FOREIGN KEY (CODTIPOMOV6, CODFILIALT6, CODEMPT6) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKCPFORNECED FOREIGN KEY (CODFOR, CODFILIALFR, CODEMPFR) REFERENCES CPFORNECED (CODFOR, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKCPTIPOFOR FOREIGN KEY (CODTIPOFOR, CODFILIALTF, CODEMPTF) REFERENCES CPTIPOFOR (CODTIPOFOR, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKEQGRUPO FOREIGN KEY (CODGRUP, CODFILIALGP, CODEMPGP) REFERENCES EQGRUPO (CODGRUP, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKEQMARCA FOREIGN KEY (CODMARCA, CODFILIALMC, CODEMPMC) REFERENCES EQMARCA (CODMARCA, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKEQTIPOMOV FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKFNMOEDA FOREIGN KEY (CODMOEDA, CODFILIALMO, CODEMPMO) REFERENCES FNMOEDA (CODMOEDA, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKFNPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPG, CODEMPPG) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP) ON UPDATE NO ACTION ON DELETE NO ACTION;
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKFNTBJUROS FOREIGN KEY (CODTBJ, CODFILIALTJ, CODEMPTJ) REFERENCES FNTBJUROS (CODTBJ, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKSGEMPRESA FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKVDCLASCLI FOREIGN KEY (CODCLASCLI, CODFILIALCE, CODEMPCE) REFERENCES VDCLASCLI (CODCLASCLI, CODFILIAL, CODEMP) ON UPDATE NO ACTION ON DELETE NO ACTION;
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKVDTABPRECO FOREIGN KEY (CODTAB, CODFILIALTB, CODEMPTB) REFERENCES VDTABPRECO (CODTAB, CODFILIAL, CODEMP) ON UPDATE NO ACTION ON DELETE NO ACTION;
 
ALTER TABLE SGPREFERE1 ADD CONSTRAINT SGPREFERE1FKVDTRANSP FOREIGN KEY (CODTRAN, CODFILIALTN, CODEMPTN) REFERENCES VDTRANSP (CODTRAN, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE2 ADD CONSTRAINT SGPREFERE2FK2ATTIPOATENDO FOREIGN KEY (CODTPATENDO2, CODFILIALT2, CODEMPT2) REFERENCES ATTIPOATENDO (CODTPATENDO, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE2 ADD CONSTRAINT SGPREFERE2FK3ATTIPOATENDO FOREIGN KEY (CODTPATENDO3, CODFILIALT3, CODEMPT3) REFERENCES ATTIPOATENDO (CODTPATENDO, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE2 ADD CONSTRAINT SGPREFERE2FKATATENDENTE FOREIGN KEY (CODATEND, CODFILIALAE, CODEMPAE) REFERENCES ATATENDENTE (CODATEND, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE2 ADD CONSTRAINT SGPREFERE2FKATTIPOATENDO FOREIGN KEY (CODTPATENDO, CODFILIALTO, CODEMPTO) REFERENCES ATTIPOATENDO (CODTPATENDO, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE2 ADD CONSTRAINT SGPREFERE2FKSGITTABELA FOREIGN KEY (CODITTBA, CODTBA, CODFILIALTA, CODEMPTA) REFERENCES SGITTABELA (CODITTB, CODTB, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE2 ADD CONSTRAINT SGPREFERE2FKSGITTABELA02 FOREIGN KEY (CODITTBV, CODTBV, CODFILIALTV, CODEMPTV) REFERENCES SGITTABELA (CODITTB, CODTB, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE2 ADD CONSTRAINT SGPREFERE2FKVDCLASCLI FOREIGN KEY (CODCLASCLI, CODFILIALCI, CODEMPCI) REFERENCES VDCLASCLI (CODCLASCLI, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE2 ADD CONSTRAINT SGPREFERE2FKVDTIPOCLI FOREIGN KEY (CODTIPOCLI, CODFILIALTI, CODEMPTI) REFERENCES VDTIPOCLI (CODTIPOCLI, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE2 ADD CONSTRAINT SGPREFERE2FKVDVENDEDOR FOREIGN KEY (CODVEND, CODFILIALVD, CODEMPVD) REFERENCES VDVENDEDOR (CODVEND, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE4 ADD CONSTRAINT SGPREFERE4FKEQTIPOMOV FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE4 ADD CONSTRAINT SGPREFERE4FKPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPP, CODEMPPP) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE4 ADD CONSTRAINT SGPREFERE4FKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGPREFERE5 ADD CONSTRAINT SGPREFERE5FKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGSEQUENCIA ADD CONSTRAINT SGSEQUENCIAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGTABELA ADD CONSTRAINT SGTABELAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGTRATARET ADD CONSTRAINT SGTRATARETFKSGITPROCESSO FOREIGN KEY (CODPROC, SEQITPROC, CODFILIAL, CODEMP) REFERENCES SGITPROCESSO (CODPROC, SEQITPROC, CODFILIAL, CODEMP);
 
ALTER TABLE SGTRATARET ADD CONSTRAINT SGTRATARETFKSGITPROCESSO2 FOREIGN KEY (CODPROCGT, SEQITPROCGT, CODFILIALGT, CODEMPGT) REFERENCES SGITPROCESSO (CODPROC, SEQITPROC, CODFILIAL, CODEMP);
 
ALTER TABLE SGUSUARIO ADD CONSTRAINT SGUSUARIOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE SGUSUARIO ADD CONSTRAINT SGUSUARIOFKSGGRPUSU FOREIGN KEY (IDGRPUSU, CODFILIALIG, CODEMPIG) REFERENCES SGGRPUSU (IDGRPUSU, CODFILIAL, CODEMP);
 
ALTER TABLE SVAVALIACAO ADD CONSTRAINT SVAVALIACAOFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE SVAVALIACAO ADD CONSTRAINT SVAVALIACAOFKSVITOS FOREIGN KEY (CODOS, CODITOS, CODFILIAL, CODEMP) REFERENCES SVITOS (CODOS, CODITOS, CODFILIAL, CODEMP);
 
ALTER TABLE SVEXECUCAO ADD CONSTRAINT SVEXECUCAOFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE SVEXECUCAO ADD CONSTRAINT SVEXECUCAOFKSVITOS FOREIGN KEY (CODOS, CODITOS, CODFILIAL, CODEMP) REFERENCES SVITOS (CODOS, CODITOS, CODFILIAL, CODEMP);
 
ALTER TABLE SVITOS ADD CONSTRAINT SVITOSFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE SVITOS ADD CONSTRAINT SVITOSFKSVOS FOREIGN KEY (CODOS, CODFILIAL, CODEMP) REFERENCES SVOS (CODOS, CODFILIAL, CODEMP);
 
ALTER TABLE SVOS ADD CONSTRAINT SVOSFKSVCONVENIADO FOREIGN KEY (CODCONV, CODFILIALCV, CODEMPCV) REFERENCES ATCONVENIADO (CODCONV, CODFILIAL, CODEMP);
 
ALTER TABLE SVOS ADD CONSTRAINT SVOSFKVDCLIENTE FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);
 
ALTER TABLE TKCONTATO ADD CONSTRAINT TKCONTATOFKSETORCTO FOREIGN KEY (CODSETORCTO, CODFILIALSO, CODEMPSO) REFERENCES TKSETORCTO (CODSETORCTO, CODFILIAL, CODEMP);
 
ALTER TABLE TKCONTATO ADD CONSTRAINT TKCONTATOFKTKTIPOIMP FOREIGN KEY (CODTPIMP, CODFILIALTI, CODEMPTI) REFERENCES TKTIPOIMP (CODTPIMP, CODFILIAL, CODEMP);
 
ALTER TABLE TKCONTATO ADD CONSTRAINT TKCONTATOFKVDSETOR FOREIGN KEY (CODSETOR, CODFILIALSR, CODEMPSR) REFERENCES VDSETOR (CODSETOR, CODFILIAL, CODEMP);
 
ALTER TABLE TKCONTATO ADD CONSTRAINT TKCONTATOFKVDVENDEDOR FOREIGN KEY (CODVEND, CODFILIALVD, CODEMPVD) REFERENCES VDVENDEDOR (CODVEND, CODFILIAL, CODEMP);
 
ALTER TABLE TKCTOATIV ADD CONSTRAINT TKCTOATIVFKTKATIVIDADE FOREIGN KEY (CODATIV, CODFILIALAV, CODEMPAV) REFERENCES TKATIVIDADE (CODATIV, CODFILIAL, CODEMP);
 
ALTER TABLE TKCTOATIV ADD CONSTRAINT TKCTOATIVFKTKCONTATO FOREIGN KEY (CODCTO, CODFILIAL, CODEMP) REFERENCES TKCONTATO (CODCTO, CODFILIAL, CODEMP);
 
ALTER TABLE TKHISTORICO ADD CONSTRAINT TKHISTORICOFKATATENDENTE FOREIGN KEY (CODATEND, CODFILIALAE, CODEMPAE) REFERENCES ATATENDENTE (CODATEND, CODFILIAL, CODEMP);
 
ALTER TABLE TKHISTORICO ADD CONSTRAINT TKHISTORICOFKTKCONTATO FOREIGN KEY (CODCTO, CODFILIALCO, CODEMPCO) REFERENCES TKCONTATO (CODCTO, CODFILIAL, CODEMP);
 
ALTER TABLE TKHISTORICO ADD CONSTRAINT TKHISTORICOFKVDCLIENTE FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);
 
ALTER TABLE VDAUXVENDA ADD CONSTRAINT VDAUXVENDAFKVDVENDA FOREIGN KEY (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP) REFERENCES VDVENDA (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP);
 
ALTER TABLE VDCLASCLI ADD CONSTRAINT VDCLASCLIFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKFNBANCO FOREIGN KEY (CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNBANCO (CODBANCO, CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKFNPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPG, CODEMPPG) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKFNTIPOCOB FOREIGN KEY (CODTIPOCOB, CODFILIALTC, CODEMPTC) REFERENCES FNTIPOCOB (CODTIPOCOB, CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKFNTIPOCRED FOREIGN KEY (CODTPCRED, CODFILIALTR, CODEMPTR) REFERENCES FNTIPOCRED (CODTPCRED, CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKLFTIPOFISCCLI FOREIGN KEY (CODFISCCLI, CODFILIALFC, CODEMPFC) REFERENCES LFTIPOFISCCLI (CODFISCCLI, CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKSGPAIS FOREIGN KEY (CODPAIS) REFERENCES SGPAIS (CODPAIS);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKVDCLASCLI FOREIGN KEY (CODCLASCLI, CODFILIALCC, CODEMPCC) REFERENCES VDCLASCLI (CODCLASCLI, CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKVDSETOR FOREIGN KEY (CODSETOR, CODFILIALSR, CODEMPSR) REFERENCES VDSETOR (CODSETOR, CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKVDTIPOCLI FOREIGN KEY (CODTIPOCLI, CODFILIALTC, CODEMPTC) REFERENCES VDTIPOCLI (CODTIPOCLI, CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLIENTEFKVDTRANSP FOREIGN KEY (CODTRAN, CODFILIALTN, CODEMPTN) REFERENCES VDTRANSP (CODTRAN, CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTE ADD CONSTRAINT VDCLINTEFKVDVENDEDOR FOREIGN KEY (CODVEND, CODFILIALVD, CODEMPVD) REFERENCES VDVENDEDOR (CODVEND, CODFILIAL, CODEMP);
 
ALTER TABLE VDCLIENTEFOR ADD CONSTRAINT VDCLIENTEFORFKCPFORNECED FOREIGN KEY (CODFOR, CODFILIALFR, CODEMPFR) REFERENCES CPFORNECED (CODFOR, CODFILIAL, CODEMP);
 
ALTER TABLE VDCOMISSAO ADD CONSTRAINT VDCOMISSAOFKFNITRECEBER FOREIGN KEY (NPARCITREC, CODREC, CODFILIALRC, CODEMP) REFERENCES FNITRECEBER (NPARCITREC, CODREC, CODFILIAL, CODEMP);
 
ALTER TABLE VDCOMISSAO ADD CONSTRAINT VDCOMISSAOFKFNPAGTOCOMI FOREIGN KEY (CODPCOMI, CODFILIALCI, CODEMP) REFERENCES FNPAGTOCOMI (CODPCOMI, CODFILIAL, CODEMP);
 
ALTER TABLE VDCOMISSAO ADD CONSTRAINT VDCOMISSAOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE VDFOTOPROD ADD CONSTRAINT VDFOTOPRODFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIAL, CODEMP) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE VDFRETEVD ADD CONSTRAINT VDFRETEVDFKVDTRANSP FOREIGN KEY (CODTRAN, CODFILIALTN, CODEMPTN) REFERENCES VDTRANSP (CODTRAN, CODFILIAL, CODEMP);
 
ALTER TABLE VDFRETEVD ADD CONSTRAINT VDFRETEVDFKVDVENDA FOREIGN KEY (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP) REFERENCES VDVENDA (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP);
 
ALTER TABLE VDITKIT ADD CONSTRAINT VDITKITFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE VDITKIT ADD CONSTRAINT VDITKITFKVDKIT FOREIGN KEY (CODKIT, CODFILIAL, CODEMP) REFERENCES VDKIT (CODKIT, CODFILIAL, CODEMP);
 
ALTER TABLE VDITORCAMENTO ADD CONSTRAINT VDITORCAMENTOFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE VDITORCAMENTO ADD CONSTRAINT VDITORCAMENTOFKVDORCAMENTO FOREIGN KEY (CODORC, TIPOORC, CODFILIAL, CODEMP) REFERENCES VDORCAMENTO (CODORC, TIPOORC, CODFILIAL, CODEMP);
 
ALTER TABLE VDITROMANEIO ADD CONSTRAINT VDITROMANEIOFKVDROMANEIO FOREIGN KEY (CODROMA, CODFILIAL, CODEMP) REFERENCES VDROMANEIO (CODROMA, CODFILIAL, CODEMP);
 
ALTER TABLE VDITROMANEIO ADD CONSTRAINT VDITROMANEIOFKVDVENDA FOREIGN KEY (CODVENDA, TIPOVENDA, CODFILIALVA, CODEMPVA) REFERENCES VDVENDA (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP);
 
ALTER TABLE VDITVENDA ADD CONSTRAINT VDITVENDAFKEQLOTE FOREIGN KEY (CODLOTE, CODPROD, CODFILIALLE, CODEMPLE) REFERENCES EQLOTE (CODLOTE, CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE VDITVENDA ADD CONSTRAINT VDITVENDAFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE VDITVENDA ADD CONSTRAINT VDITVENDAFKLFMENSAGEM FOREIGN KEY (CODMENS, CODFILIALME, CODEMPME) REFERENCES LFMENSAGEM (CODMENS, CODFILIAL, CODEMP);
 
ALTER TABLE VDITVENDA ADD CONSTRAINT VDITVENDAFKLFNATOPER FOREIGN KEY (CODNAT, CODFILIALNT, CODEMPNT) REFERENCES LFNATOPER (CODNAT, CODFILIAL, CODEMP);
 
ALTER TABLE VDITVENDA ADD CONSTRAINT VDITVENDAFKLFTRATTRIB FOREIGN KEY (CODTRATTRIB, CODFILIALTT, CODEMPTT) REFERENCES LFTRATTRIB (CODTRATTRIB, CODFILIAL, CODEMP);
 
ALTER TABLE VDITVENDA ADD CONSTRAINT VDITVENDAFKSGLOG FOREIGN KEY (CODLOG, CODFILIALLG, CODEMPLG) REFERENCES SGLOG (CODLOG, CODFILIAL, CODEMP);
 
ALTER TABLE VDITVENDA ADD CONSTRAINT VDITVENDAFKVDVENDA FOREIGN KEY (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP) REFERENCES VDVENDA (CODVENDA, TIPOVENDA, CODFILIAL, CODEMP);
 
ALTER TABLE VDKIT ADD CONSTRAINT VDKITFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIALPD, CODEMPPD) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE VDOBSCLI ADD CONSTRAINT VDOBSCLIFKVDCLIENTE FOREIGN KEY (CODCLI, CODFILIAL, CODEMP) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);
 
ALTER TABLE VDORCAMENTO ADD CONSTRAINT VDORCAMENTOFKATATENDENTE FOREIGN KEY (CODATEND, CODFILIALAE, CODEMPAE) REFERENCES ATATENDENTE (CODATEND, CODFILIAL, CODEMP);
 
ALTER TABLE VDORCAMENTO ADD CONSTRAINT VDORCAMENTOFKATCONVENIADO FOREIGN KEY (CODCONV, CODFILIALCV, CODEMPCV) REFERENCES ATCONVENIADO (CODCONV, CODFILIAL, CODEMP);
 
ALTER TABLE VDORCAMENTO ADD CONSTRAINT VDORCAMENTOFKATTIPOCONV FOREIGN KEY (CODTPCONV, CODFILIALTC, CODEMPTC) REFERENCES ATTIPOCONV (CODTPCONV, CODFILIAL, CODEMP);
 
ALTER TABLE VDORCAMENTO ADD CONSTRAINT VDORCAMENTOFKFNPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPG, CODEMPPG) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);
 
ALTER TABLE VDORCAMENTO ADD CONSTRAINT VDORCAMENTOFKVDCLIENTE FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);
 
ALTER TABLE VDORCAMENTO ADD CONSTRAINT VDORCAMENTOFKVDVENDEDOR FOREIGN KEY (CODVEND, CODFILIALVD, CODEMPVD) REFERENCES VDVENDEDOR (CODVEND, CODFILIAL, CODEMP);
 
ALTER TABLE VDPRECOPROD ADD CONSTRAINT VDPRECOPRODFKEQPRODUTO FOREIGN KEY (CODPROD, CODFILIAL, CODEMP) REFERENCES EQPRODUTO (CODPROD, CODFILIAL, CODEMP);
 
ALTER TABLE VDPRECOPROD ADD CONSTRAINT VDPRECOPRODFKFNPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPG, CODEMPPG) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);
 
ALTER TABLE VDPRECOPROD ADD CONSTRAINT VDPRECOPRODFKVDCLASCLI FOREIGN KEY (CODCLASCLI, CODFILIALCC, CODEMPCC) REFERENCES VDCLASCLI (CODCLASCLI, CODFILIAL, CODEMP);
 
ALTER TABLE VDPRECOPROD ADD CONSTRAINT VDPRECOPRODFKVDTABPRECO FOREIGN KEY (CODTAB, CODFILIALTB, CODEMPTB) REFERENCES VDTABPRECO (CODTAB, CODFILIAL, CODEMP);
 
ALTER TABLE VDROMANEIO ADD CONSTRAINT VDROMANEIOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE VDSETOR ADD CONSTRAINT VDSETORFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE VDSTATUSORC ADD CONSTRAINT VDSTATUSORCFKSGITTABELA FOREIGN KEY (CODITTB, CODTB, CODFILIALTB, CODEMPTB) REFERENCES SGITTABELA (CODITTB, CODTB, CODFILIAL, CODEMP);
 
ALTER TABLE VDSTATUSORC ADD CONSTRAINT VDSTATUSORCFKVDORCAMENTO FOREIGN KEY (CODORC, TIPOORC, CODFILIAL, CODEMP) REFERENCES VDORCAMENTO (CODORC, TIPOORC, CODFILIAL, CODEMP);
 
ALTER TABLE VDTABPRECO ADD CONSTRAINT VDTABPRECOFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE VDTIPOCLI ADD CONSTRAINT VDTIPOCLIFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE VDTRANSP ADD CONSTRAINT VDTRANSPFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKEQTIPOMOV FOREIGN KEY (CODTIPOMOV, CODFILIALTM, CODEMPTM) REFERENCES EQTIPOMOV (CODTIPOMOV, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKFNBANCO FOREIGN KEY (CODBANCO, CODFILIALBO, CODEMPBO) REFERENCES FNBANCO (CODBANCO, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKFNPLANOPAG FOREIGN KEY (CODPLANOPAG, CODFILIALPG, CODEMPPG) REFERENCES FNPLANOPAG (CODPLANOPAG, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKLFSERIE FOREIGN KEY (SERIE, CODFILIALSE, CODEMPSE) REFERENCES LFSERIE (SERIE, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKPVCAIXA FOREIGN KEY (CODCAIXA, CODFILIALCX, CODEMPCX) REFERENCES PVCAIXA (CODCAIXA, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKVDCLCOMIS FOREIGN KEY (CODCLCOMIS, CODFILIALCM, CODEMPCM) REFERENCES VDCLCOMIS (CODCLCOMIS, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKVDCLIENTE FOREIGN KEY (CODCLI, CODFILIALCL, CODEMPCL) REFERENCES VDCLIENTE (CODCLI, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDA ADD CONSTRAINT VDVENDAFKVDVENDEDOR FOREIGN KEY (CODVEND, CODFILIALVD, CODEMPVD) REFERENCES VDVENDEDOR (CODVEND, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDAORC ADD CONSTRAINT VDVENDAORCFKVDITVENDA FOREIGN KEY (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIAL, CODEMP) REFERENCES VDITVENDA (CODVENDA, CODITVENDA, TIPOVENDA, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDAORC ADD CONSTRAINT VDVENDAORCFKVDORCAMENTO FOREIGN KEY (CODORC, CODITORC, TIPOORC, CODFILIALOR, CODEMPOR) REFERENCES VDITORCAMENTO (CODORC, CODITORC, TIPOORC, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDEDOR ADD CONSTRAINT VDVENDEDORFKFNPLANEJAMENTO FOREIGN KEY (CODPLAN, CODFILIALPN, CODEMPPN) REFERENCES FNPLANEJAMENTO (CODPLAN, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDEDOR ADD CONSTRAINT VDVENDEDORFKSGFILIAL FOREIGN KEY (CODFILIAL, CODEMP) REFERENCES SGFILIAL (CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDEDOR ADD CONSTRAINT VDVENDEDORFKVDCLCOMIS FOREIGN KEY (CODCLCOMIS, CODFILIALCM, CODEMPCM) REFERENCES VDCLCOMIS (CODCLCOMIS, CODFILIAL, CODEMP);
 
ALTER TABLE VDVENDEDOR ADD CONSTRAINT VDVENDEDORFKVDSETOR FOREIGN KEY (CODSETOR, CODFILIALSE, CODEMPSE) REFERENCES VDSETOR (CODSETOR, CODFILIAL, CODEMP);
 
 ALTER TABLE ATCONVENIADO ADD 
        CHECK (SEXOCONV IN ('M','F'));
 
 ALTER TABLE VDTRANSP ADD 
        CHECK (TIPOTRAN IN ('T','C'));
 
 ALTER TABLE PVCAIXAIMP ADD 
        CONSTRAINT PVCAIXAIMPCK CHECK(IMPPAD IN ('S', 'N'));
 
 ALTER TABLE SGPREFERE1 ADD 
        CONSTRAINT SGPREFERE1CK01 CHECK(usapedseq in ('S','N'));
 
 ALTER TABLE SGPREFERE1 ADD 
        CONSTRAINT SGPREFERE1CK02 CHECK(tipoprecocusto in ('M','P'));
 
 ALTER TABLE VDCLIENTE ADD 
        CONSTRAINT VDCLIENTECK01 CHECK(PESSOACLI IN ('F', 'J'));
 
 ALTER TABLE VDCLIENTE ADD 
        CONSTRAINT VDCLIENTECK02 CHECK(ATIVOCLI IN ('S', 'N'));

/*  Exceptions */
CREATE EXCEPTION CPCOMPRAEX03 'COMPRA NO PODE SER MAIS ALTERADA!';
CREATE EXCEPTION CPCOMPRAEX04 'VALOR DA COMPRA  DIFERENTE DO VALOR A RECEBER!';
CREATE EXCEPTION CPITCOMPRAEX01 'PRODUTO NO PODE SER ALTERADO!';
CREATE EXCEPTION CPITCOMPRAEX02 'LOTE NO PODE SER ALTERADO!';
CREATE EXCEPTION EQINVPRODEX01 'O PRODUTO NO PODE SER ALTERADO!';
CREATE EXCEPTION EQINVPRODEX02 'O LOTE NO PODE SER ALTERADO!';
CREATE EXCEPTION EQINVPRODEX03 'A DATA NO PODE SER ALTERADA!';
CREATE EXCEPTION EQINVPRODEX04 'O ALMOXARIFADO NO PODE SER ALTERADO!';
CREATE EXCEPTION EQINVPRODEX05 'CDIGO DO LOTE  REQUERIDO';
CREATE EXCEPTION EQLOTEEX01 'ESTOQUE DO LOTE ZERADO!';
CREATE EXCEPTION EQPRODUTOEX01 'ESTOQUE ZERADO!';
CREATE EXCEPTION EQTIPOMOVEX01 'MOVIMENTO DE COMPRA NO PODE TER TABELA DE PREO!';
CREATE EXCEPTION EQTIPOMOVEX02 'TABELA DE PREO EM BRANCO!';
CREATE EXCEPTION FNITRECEBEREX01 'PARCELA J FOI PAGA!';
CREATE EXCEPTION FNPAGAREX01 'PARCELA J FOI PAGA!';
CREATE EXCEPTION FNSUBLANCAEX01 'NO  POSSVEL ADICIONAR DOIS SUBLANAMENTOS PARA UMA TRANSFERNCIA!';
CREATE EXCEPTION FNSUBLANCAEX02 'CONTAS DE DESPESAS OU RECEITAS NO PODEM PARTICIPAR DE TRANSFERNCIAS!';
CREATE EXCEPTION FNSUBLANCAEX03 'CONTAS DE BANCOS OU CAIXAS S PODEM SE INTERAGIREM EM TRANSFERNCIAS!';
CREATE EXCEPTION FNSUBSLANCAEX01 'NO  POSSVEL ADICIONAR DOIS SUBLANAMENTOS PARA UMA TRANSFERNCIA!';
CREATE EXCEPTION FNSUBSLANCAEX02 'CONTAS DE DESPESAS OU RECEITAS NO PODEM PARTICIPAR DE TRANSFERNCIAS!';
CREATE EXCEPTION FNSUBSLANCAEX03 'CONTAS DE BANCOS OU CAIXAS S PODEM SE INTERAGIREM EM TRANSFERNCIAS!';
CREATE EXCEPTION SGCONEXAOEX01 'Banco de dados est conectado com este usurio em outra filial!';
CREATE EXCEPTION SGCONEXAOEX02 'Usurio invlido.';
CREATE EXCEPTION SGFILIALEX01 'EMPRESA NO POSSUI MATRIZ!';
CREATE EXCEPTION SGFILIALEX02 'NO FOI POSSVEL ENCONTRAR FILIAL ATIVA PARA ESTE USURIO!';
CREATE EXCEPTION VDCLCOMISEX01 'PERCENTUAL TOTAL DE DISTRIBUIO INVLIDO!';
CREATE EXCEPTION VDCOMISSAOEX01 'COMISSAO JA FOI PAGA!';
CREATE EXCEPTION VDCOMISSAOEX02 'COMISSAO NAO FOI LIBERADA!';
CREATE EXCEPTION VDITVENDAEX01 'PRODUTO NO PODE SER ALTERADO!';
CREATE EXCEPTION VDITVENDAEX02 'LOTE NO PODE SER ALTERADO!';
CREATE EXCEPTION VDITVENDAEX03 'NO FOI POSSVEL ENCONTRAR A NATUREZA DA OPERAO';
CREATE EXCEPTION VDVENDAEX01 'ERRO LIVRE!!!!';
CREATE EXCEPTION VDVENDAEX02 'Venda no foi liberada!';
CREATE EXCEPTION VDVENDAEX03 'Valor da venda ultrapassa o valor liberado!';
CREATE EXCEPTION VDVENDAEX04 'Valor da venda ultrapassa o crdito pr-aprovado!';
CREATE EXCEPTION VDVENDAEX05 'ESTA VENDA FOI CANCELADA!';
CREATE EXCEPTION VDVENDAEX06 'O TOTAL DA NOTA NO CONFERE COM TOTAL DAS PARCELAS!';
COMMIT WORK;
SET AUTODDL OFF;
SET TERM ^ ;

/* Stored procedures */
CREATE PROCEDURE ATADICATENDIMENTOSP (ICODCONV INTEGER,
ICODTIPOATENDO INTEGER,
ICODATEND INTEGER,
ICODSETOR INTEGER,
VOBSATENDO VARCHAR(10000) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL INTEGER,
IDOC INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE ATBUSCAPRECOSP (ICODPROD INTEGER,
ICODCONV INTEGER,
ICODEMPCV INTEGER,
ICODFILIALCV SMALLINT,
ICODPLANOPAG INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE CPADICFORSP (CODEMP INTEGER,
CODFILIAL INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE CPCOMPRASP01 (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
NQTD NUMERIC(15, 3),
NVLRTOT NUMERIC(15, 3),
NVLRICMS NUMERIC(15, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE CPGERAENTRADASP (CODEMP INTEGER,
CODFILIAL INTEGER,
CODFILIALVD INTEGER,
TIPOVENDA CHAR(1) CHARACTER SET NONE,
CODVENDA INTEGER,
CITEM CHAR(1) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE CPGERAITENTRADASP (CODEMP INTEGER,
CODFILIAL INTEGER,
CODCOMPRA INTEGER,
CODFILIALVD INTEGER,
TIPOVENDA CHAR(1) CHARACTER SET NONE,
CODVENDA INTEGER,
CODITVENDA INTEGER,
QTDIT INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQADICPRODUTOSP (ICODPROD INTEGER,
SDESCPROD CHAR(50) CHARACTER SET NONE,
SDESCAUXPROD CHAR(40) CHARACTER SET NONE,
SREFPROD CHAR(13) CHARACTER SET NONE,
SCODFABPROD CHAR(13) CHARACTER SET NONE,
SCODBARPROD CHAR(13) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQBUSCASIMILARSP (CODEMP INTEGER,
CODFILIAL CHAR(8) CHARACTER SET NONE,
IPROD INTEGER,
SREFPROD CHAR(13) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQCALCPEPSSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
NSLDPROD NUMERIC(15, 3),
DTESTOQ DATE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQCOPIAPROD (ICODPROD INTEGER,
ICODEMP INTEGER,
ICODFILIAL INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODATEQSP (ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE CHAR(13) CHARACTER SET NONE,
SOPERADOR SMALLINT,
NQTDMOVPRODOLD NUMERIC(15, 3),
NQTDMOVPRODNEW NUMERIC(15, 3),
ICODINVPROD INTEGER,
ICODCOMPRA INTEGER,
DDTULTCPPROD DATE,
NQTDULTCPPROD NUMERIC(15, 3),
DDTMPMPROD DATE,
NCUSTOMPMPROD NUMERIC(15, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODCKCPSP (ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODCOMPRA INTEGER,
ICODINVPROD INTEGER,
DDTMOVPROD DATE,
NQTDMOVPROD NUMERIC(15, 3),
NCUSTOMPMMOVPROD NUMERIC(15, 2))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODCKTMSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODTIPOMOV INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODCKUTMSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPOLD INTEGER,
SCODFILIALOLD SMALLINT,
ICODTIPOMOVOLD INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODCSLDSP (ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
NQTDMOVPROD NUMERIC(15, 3),
NPRECOMOVPROD NUMERIC(15, 3),
NCUSTOMPMMOVPROD NUMERIC(15, 3),
NSLDMOVPROD NUMERIC(15, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODDSP (ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
DDTMOVPROD DATE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODISP (ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE CHAR(13) CHARACTER SET NONE,
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4) CHARACTER SET NONE,
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR(1) CHARACTER SET NONE,
NQTDMOVPROD NUMERIC(15, 3),
NPRECOMOVPROD NUMERIC(15, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODIUDSP (CIUD CHAR(1) CHARACTER SET NONE,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE CHAR(13) CHARACTER SET NONE,
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4) CHARACTER SET NONE,
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR(1) CHARACTER SET NONE,
NQTDMOVPROD NUMERIC(15, 3),
NPRECOMOVPROD NUMERIC(15, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODPRCSLDSP (SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
DDTMOVPROD DATE,
DDTMOVPRODPRC DATE,
NSLDMOVPROD NUMERIC(15, 3),
NCUSTOMPMMOVPROD NUMERIC(15, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODRETCODSP (ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODSEQSP (ICODEMP INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODSLDSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
DDTMOVPROD DATE,
NCUSTOMPMMOVPROD NUMERIC(15, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQMOVPRODUSP (ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE CHAR(13) CHARACTER SET NONE,
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4) CHARACTER SET NONE,
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR(1) CHARACTER SET NONE,
NQTDMOVPROD NUMERIC(15, 3),
NPRECOMOVPROD NUMERIC(15, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQREFPRODSP (CODEMP INTEGER,
CODFILIAL SMALLINT,
CODPROD INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQRELDEMANDASP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
SCODFILIALPD SMALLINT,
DDTINI DATE,
DDTFIM DATE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQRELINVPRODSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
CTIPOCUSTO CHAR(1) CHARACTER SET NONE,
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14) CHARACTER SET NONE,
DDTESTOQ DATE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE EQRELPEPSSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DTESTOQ DATE,
ICODEMPMC INTEGER,
SCODFILIALMC SMALLINT,
CCODMARCA CHAR(6) CHARACTER SET NONE,
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE FNADICITRECEBERSP01 (CALTVLR CHAR(1) CHARACTER SET NONE,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRDESCITREC NUMERIC(15, 3),
NVLRMULTAITREC NUMERIC(15, 3),
NVLRJUROSITREC NUMERIC(15, 3),
NVLRPARCITREC NUMERIC(15, 3),
NVLRPAGOITREC NUMERIC(15, 3),
DDTITREC DATE,
DDTVENCITREC DATE,
CSTATUSITREC CHAR(2) CHARACTER SET NONE,
CFLAG CHAR(1) CHARACTER SET NONE,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3) CHARACTER SET NONE,
NVLRCOMIITREC NUMERIC(15, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE FNADICLANCASP01 (ICODREC INTEGER,
INPARCITREC INTEGER,
SNUMCONTA CHAR(10) CHARACTER SET NONE,
ICODEMPCA INTEGER,
ICODFILIALCA INTEGER,
ICODCLI INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL INTEGER,
SCODPLAN CHAR(13) CHARACTER SET NONE,
ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
IANOCC INTEGER,
SCODCC CHAR(19) CHARACTER SET NONE,
ICODEMPCC INTEGER,
ICODFILIALCC INTEGER,
DDTPAGOITREC DATE,
SDOCLANCAITREC CHAR(10) CHARACTER SET NONE,
SOBSITREC CHAR(50) CHARACTER SET NONE,
DVLRPAGOITREC NUMERIC(18, 2),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE FNADICLANCASP02 (ICODPAG INTEGER,
INPARCPAG INTEGER,
SNUMCONTA CHAR(10) CHARACTER SET NONE,
ICODEMPCA INTEGER,
ICODFILIALCA INTEGER,
ICODFOR INTEGER,
ICODEMPFR INTEGER,
ICODFILIALFR INTEGER,
SCODPLAN CHAR(13) CHARACTER SET NONE,
ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
IANOCC INTEGER,
SCODCC CHAR(19) CHARACTER SET NONE,
ICODEMPCC INTEGER,
ICODFILIALCC INTEGER,
DDTPAGOITPAG DATE,
SDOCLANCAITPAG CHAR(10) CHARACTER SET NONE,
SOBSITPAG CHAR(50) CHARACTER SET NONE,
DVLRPAGOITPAG NUMERIC(15, 2),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE FNADICPAGARSP01 (CODCOMPRA INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
ICODEMPFR INTEGER,
ICODFILIALFR SMALLINT,
CODFOR INTEGER,
VLRLIQCOMPRA NUMERIC(18, 2),
DTSAIDACOMPRA DATE,
DOCCOMPRA INTEGER,
ICODEMPBO INTEGER,
ICODFILIALBO SMALLINT,
CODBANCO CHAR(3) CHARACTER SET NONE,
FLAG CHAR(1) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE FNADICRECEBERSP01 (CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL SMALLINT,
CODCLI INTEGER,
ICODEMPVD INTEGER,
ICODFILIALVD SMALLINT,
CODVEND INTEGER,
VLRLIQVENDA NUMERIC(15, 2),
DTSAIDAVENDA DATE,
VLRCOMISVENDA NUMERIC(15, 3),
DOCVENDA INTEGER,
ICODEMPBO INTEGER,
ICODFILIALBO SMALLINT,
CODBANCO CHAR(3) CHARACTER SET NONE,
FLAG CHAR(1) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE FNCHECAPGTOSP (ICODCLI INTEGER,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE FNDELETARECEBERSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE FNGERAITRECEBERSP01 (CALTVLR CHAR(1) CHARACTER SET NONE,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
ICODEMPPG INTEGER,
SCODFILIALPG SMALLINT,
ICODPLANOPAG INTEGER,
NVLRREC NUMERIC(15, 3),
DDATAREC DATE,
CFLAG CHAR(1) CHARACTER SET NONE,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3) CHARACTER SET NONE,
NVLRCOMIREC NUMERIC(15, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE FNITRECEBERSP01 (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
NVLRPARCREC NUMERIC(15, 3),
NVLRCOMIREC NUMERIC(15, 3),
INROPARCREC INTEGER,
CCLASCOMIS CHAR(1) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE FNLIBCREDSP (CODVENDA INTEGER,
CODCLI INTEGER,
CODEMPCL INTEGER,
CODFILIALCL INTEGER,
VLRLIB NUMERIC(18, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE FNSALDOPLANSP (ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
SCODPLANANT CHAR(13) CHARACTER SET NONE,
DDATAANT DATE,
DVLRANT NUMERIC(15, 2),
SCODPLANATU CHAR(13) CHARACTER SET NONE,
DDATAATU DATE,
DVLRATU NUMERIC(15, 2))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE LFBUSCAFISCALSP (FILIALATUAL INTEGER,
CODEMP INTEGER,
CODFILIAL INTEGER,
CODPROD INTEGER,
CODEMPCL INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE LFBUSCAICMSSP (CODNAT CHAR(4) CHARACTER SET NONE,
ESTCLI CHAR(2) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE LFBUSCANATSP (FILIALATUAL INTEGER,
CODEMP INTEGER,
CODFILIAL INTEGER,
CODPROD INTEGER,
CODEMPCL INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER,
CODEMPFR INTEGER,
CODFILIALFR INTEGER,
CODFOR INTEGER,
CODFILIALTM SMALLINT,
CODTIPOMOV INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE LFNOVODOCSP (SSERIE CHAR(4) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE PPITOPSP01 (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
ICODOP INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE PVABRECAIXASP (ICODCAIXA INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER,
NVLRINICAIXA NUMERIC(15, 3),
DDTAMOV DATE,
ICODFILIALUS SMALLINT,
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE PVADICMOVCAIXASP01 (ICODCAIXA INTEGER,
NVLRINICAIXA NUMERIC(18, 3),
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DDTAMOV DATE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE PVFECHAVENDASP (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
NVALOR NUMERIC(18, 3),
ITERM INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE PVRETMOVCAIXASP (ICODCAIXA INTEGER,
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DDTAMOV DATE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE PVSANGRIASP (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
NVALOR NUMERIC(18, 3),
ITERM INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE PVSUPRIMENTOSP (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
NVALOR NUMERIC(18, 3),
ITERM INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE PVVERIFCAIXASP (ICODCAIXA INTEGER,
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DDTAMOV DATE,
ICODFILIALUS SMALLINT,
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE SGFIMCONSP (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE SGINICONSP (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
CIDUSU CHAR(8) CHARACTER SET NONE,
ICODFILIALSEL SMALLINT,
ICODTERM SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE SGLOGSP01 (CODEMP INTEGER,
IDUSU CHAR(8) CHARACTER SET NONE,
CLASLOG CHAR(2) CHARACTER SET NONE,
TIPOLOG CHAR(3) CHARACTER SET NONE,
DESCLOG CHAR(60) CHARACTER SET NONE,
OBSLOG VARCHAR(1000) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE SGRETCAIXA (CODEMP INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE SGRETFILIAL (ICODEMP INTEGER,
SNOMETAB CHAR(30) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE SGSETAGENDASP (CODAGD INTEGER,
CODEMP INTEGER,
OBJORIGAGD CHAR(5) CHARACTER SET NONE,
CODFILIALCH INTEGER,
CODCHAVE INTEGER,
DTAINIAGD DATE,
HRINIAGD TIME,
DTAFIMAGD DATE,
HRFIMAGD TIME,
ASSUNTOAGD CHAR(50) CHARACTER SET NONE,
DESCAGD VARCHAR(10000) CHARACTER SET NONE,
TIPOAGD CHAR(2) CHARACTER SET NONE,
PRIORAGD SMALLINT,
CODFILIALUO INTEGER,
IDUSUO CHAR(8) CHARACTER SET NONE,
CODFILIALUD INTEGER,
IDUSUD CHAR(8) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE SGUPACESSOMUSP (ICODEMP INTEGER,
ICODFILIAL INTEGER,
SIDUSU CHAR(8) CHARACTER SET NONE,
ICODSIS INTEGER,
ICODMODU INTEGER,
ICODMENU INTEGER,
CTPACESSOMU CHAR(1) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE SGUPMENUSP01 (ICODSIS INTEGER,
ICODMODU INTEGER,
ICODMENU INTEGER,
SDESCMENU CHAR(50) CHARACTER SET NONE,
ICODSISPAI INTEGER,
ICODMODUPAI INTEGER,
ICODMENUPAI INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE SPGERANUM (ICODEMP INTEGER,
ICODFILIAL INTEGER,
STAB CHAR(2) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE TKCONTTOCLI (CODEMP INTEGER,
CODFILIAL INTEGER,
CODCTO INTEGER,
CODFILIALTI INTEGER,
CODTIPOCLI INTEGER,
CODFILIALCC INTEGER,
CODCLASCLI INTEGER,
CODFILIALSR INTEGER,
CODSETOR INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE TKSETHISTSP (CODHISTTK INTEGER,
CODEMP INTEGER,
CODFILIALCO INTEGER,
CODCTO INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER,
DESCHISTTK VARCHAR(10000) CHARACTER SET NONE,
CODFILIALAE INTEGER,
CODATEND INTEGER,
SITHISTTK CHAR(2) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDADICCOMISSAOSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRVENDACOMI NUMERIC(15, 3),
NVLRCOMI NUMERIC(15, 3),
DDATACOMI DATE,
DDTVENCCOMI DATE,
CTIPOCOMI CHAR(1) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDADICITEMPDVSP (CODVENDA INTEGER,
CODEMP INTEGER,
CODFILIAL CHAR(8) CHARACTER SET NONE,
CODPROD INTEGER,
CODEMPPD INTEGER,
CODFILIALPD INTEGER,
QTDITVENDA NUMERIC(9, 2),
VLRPRECOITVENDA NUMERIC(18, 3))
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDADICITVENDAORCSP (FILIALATUAL INTEGER,
ICODVENDA INTEGER,
ICODORC INTEGER,
ICODITORC INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDADICVENDAORCSP (ICODORC INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDBAIXACOMISSAOSP (STIPO CHAR(1) CHARACTER SET NONE,
DINI DATE,
DFIM DATE,
ICODVEND INTEGER,
ICODEMPVD INTEGER,
ICODFILIALVD SMALLINT,
SCODCONTA CHAR(10) CHARACTER SET NONE,
ICODEMPCA INTEGER,
ICODFILIALCA SMALLINT,
SCODPLAN CHAR(13) CHARACTER SET NONE,
ICODEMPPN INTEGER,
ICODFILIALPN SMALLINT,
DDATA DATE,
IDOC INTEGER,
DVLR NUMERIC(15, 2),
SOBS CHAR(50) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDBLOQVENDASP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
CBLOQVENDA CHAR(1) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDBUSCAPRECOSP (ICODPROD INTEGER,
ICODCLI INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL SMALLINT,
ICODPLANOPAG INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPTM INTEGER,
ICODFILIALTM SMALLINT,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDCOPIAORCSP (CODEMP INTEGER,
CODFILIAL INTEGER,
CODORC INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDDESBAIXACOMISSAOSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODVEND INTEGER,
CORDEM CHAR(1) CHARACTER SET NONE,
DINI DATE,
DFIM DATE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDESTORNACOMISSAOSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
ICODVEND INTEGER,
DINI DATE,
DFIM DATE,
CORDEM CHAR(1) CHARACTER SET NONE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDEVOLUVENDAS (ICODEMP SMALLINT,
ICODFILIAL SMALLINT,
DATAINI DATE,
DATAFIM DATE,
ICODTIPOCLI SMALLINT,
ICODCLI SMALLINT)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDGERACOMISSAOSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRCOMIITREC NUMERIC(15, 3),
DDTVENCITREC DATE)
AS 
BEGIN EXIT; END ^
CREATE PROCEDURE VDGERAESTORNOCOMISP AS 
BEGIN EXIT; END ^

ALTER PROCEDURE ATADICATENDIMENTOSP (ICODCONV INTEGER,
ICODTIPOATENDO INTEGER,
ICODATEND INTEGER,
ICODSETOR INTEGER,
VOBSATENDO VARCHAR(10000) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL INTEGER,
IDOC INTEGER)
AS 

DECLARE VARIABLE ICODATENDO INTEGER;
DECLARE VARIABLE IFILIALATENDO INTEGER;
DECLARE VARIABLE IFILIALCONV INTEGER;
DECLARE VARIABLE IFILIALTIPOATENDO INTEGER;
DECLARE VARIABLE IFILIALATEND INTEGER;
DECLARE VARIABLE IFILIALSETOR INTEGER;
DECLARE VARIABLE IFILIALPREF INTEGER;
DECLARE VARIABLE IFILIALVEND INTEGER;
DECLARE VARIABLE IFILIALORC INTEGER;
DECLARE VARIABLE ICODTPATENDOLEV INTEGER; /*TIPO DE ATENDIMENTO PARA LEVANTAMENTOS*/
DECLARE VARIABLE ICODORC INTEGER;
DECLARE VARIABLE ICODCLI INTEGER;
DECLARE VARIABLE ICODVEND INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATATENDIMENTO') INTO IFILIALATENDO;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATCONVENIADO') INTO IFILIALCONV;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATTIPOATENDO') INTO IFILIALTIPOATENDO;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATATENDENTE') INTO IFILIALATEND;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'ATSETOR') INTO IFILIALSETOR;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'VDORCAMENTO') INTO IFILIALORC;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'SGPREFERE2') INTO IFILIALPREF;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'VDVENDEDOR') INTO IFILIALVEND;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALATENDO,'AT') INTO ICODATENDO;
  SELECT CODTPATENDO FROM SGPREFERE2 WHERE CODEMP=:ICODEMP AND CODFILIAL=:IFILIALPREF INTO ICODTPATENDOLEV;
  INSERT INTO ATATENDIMENTO (
    CODEMP,CODFILIAL,CODATENDO,CODCONV,
    CODEMPCV,CODFILIALCV,CODEMPTO,
    CODFILIALTO,CODTPATENDO,CODEMPAE,
    CODFILIALAE,CODATEND,CODEMPSA,CODFILIALSA,
    CODSETAT,STATUSATENDO,OBSATENDO,IDUSU,CODEMPUS,CODFILIALUS,DOCATENDO)
  VALUES
  (
    :ICODEMP,:IFILIALATENDO,:ICODATENDO,:ICODCONV,
    :ICODEMP,:IFILIALCONV,:ICODEMP,
    :IFILIALTIPOATENDO,:ICODTIPOATENDO,:ICODEMP,
    :IFILIALATEND,:ICODATEND,:ICODEMP,:IFILIALSETOR,
    :ICODSETOR,'AA',:VOBSATENDO,lower(USER),:ICODEMP,:ICODFILIAL,:IDOC
  );
/*  SELECT CODORC FROM ATATENDIMENTOORC WHERE CODEMP=:ICODEMP
    AND CODFILIAL=:IFILIALORC AND CODORC=:IDOC INTO ICODORC;*/
  IF (ICODTIPOATENDO = ICODTPATENDOLEV/* AND ICODORC IS NULL*/) THEN
  BEGIN
    SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALORC,'OC') INTO ICODORC;
    SELECT CODFILIALVD,CODVEND FROM SGPREFERE2 WHERE
      CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO IFILIALVEND,ICODVEND;
    INSERT INTO VDORCAMENTO (CODEMP,CODFILIAL,TIPOORC,CODORC,CODEMPCV,CODFILIALCV,CODCONV,
        DTORC,DTVENCORC,STATUSORC,CODEMPVD,CODFILIALVD,CODVEND)
      VALUES
      (
        :ICODEMP,:IFILIALORC,'O',:ICODORC,:ICODEMP,:IFILIALCONV,:ICODCONV,
        CAST ('today' AS DATE),CAST ('today' AS DATE),'OA',:ICODEMP,:IFILIALVEND,:ICODVEND
      );


    INSERT INTO ATATENDIMENTOORC (CODEMP,CODFILIAL,CODATENDO,CODEMPOC,CODFILIALOC,TIPOORC,CODORC)
      VALUES
        (:ICODEMP,:IFILIALORC,:ICODATENDO,:ICODEMP,:IFILIALORC,'O',:ICODORC);

    UPDATE ATATENDIMENTO SET DOCATENDO = :IDOC WHERE
      CODEMP=:ICODEMP AND CODFILIAL=:IFILIALATENDO AND CODATENDO=:ICODATENDO;
  END

END ^

ALTER PROCEDURE ATBUSCAPRECOSP (ICODPROD INTEGER,
ICODCONV INTEGER,
ICODEMPCV INTEGER,
ICODFILIALCV SMALLINT,
ICODPLANOPAG INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
RETURNS (PRECO NUMERIC(15, 2))
AS 

DECLARE VARIABLE iCodTipoMov INTEGER;
  DECLARE VARIABLE iCodEmpTM INTEGER;
  DECLARE VARIABLE iCodFilialTM INTEGER;
  DECLARE VARIABLE iCodCli INTEGER;
  DECLARE VARIABLE iCodEmpCli INTEGER;
  DECLARE VARIABLE iCodFilialCli INTEGER;
BEGIN
  SELECT CODTIPOMOV2,CODEMPT2,CODFILIALT2 FROM SGPREFERE1 WHERE CODEMP=:ICODEMP
         AND CODFILIAL=:ICODFILIAL INTO iCodTipoMov,iCodEmpTM,iCodFilialTM;
  SELECT CODCLI,CODEMPCL,CODFILIALCL FROM ATCONVENIADO WHERE CODCONV=:ICODCONV
         AND CODEMP=:ICODEMPCV AND CODFILIAL=:ICODFILIALCV INTO iCodCli,iCodEmpCli,iCodFilialCli;

  SELECT PRECO FROM VDBUSCAPRECOSP(:ICODPROD,:iCodCli,:iCodEmpCli,:iCodFilialCli,:ICODPLANOPAG,:ICODEMPPG,
    :ICODFILIALPG,:iCodTipoMov,:iCodEmpTM,:iCodFilialTM,:ICODEMP,:ICODFILIAL) INTO PRECO;

  SUSPEND;
END ^

ALTER PROCEDURE CPADICFORSP (CODEMP INTEGER,
CODFILIAL INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER)
RETURNS (CODFOR INTEGER)
AS 

DECLARE VARIABLE CODTIPOFOR INTEGER;
DECLARE VARIABLE CODFILIALTF INTEGER;
DECLARE VARIABLE CODFILIALFR INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'CPFORNECED') INTO CODFILIALFR;
  SELECT P.CODTIPOFOR,P.CODFILIALTF FROM SGPREFERE1 P WHERE P.CODEMP=:CODEMP
    AND P.CODFILIAL=:CODFILIAL INTO CODTIPOFOR,CODFILIALTF;
  SELECT MAX(CODFOR)+1 FROM CPFORNECED WHERE CODEMP=:CODEMP
    AND CODFILIAL=:CODFILIALFR INTO CODFOR;
  INSERT INTO CPFORNECED (CODEMP,CODFILIAL,CODFOR,RAZFOR,CODEMPTF,CODFILIALTF,
                        CODTIPOFOR,CODEMPBO,CODFILIALBO,CODBANCO,NOMEFOR,
                        DATAFOR,ATIVOFOR,PESSOAFOR,CNPJFOR,CPFFOR,INSCFOR,
                        RGFOR,ENDFOR,NUMFOR,COMPLFOR,BAIRFOR,CEPFOR,CIDFOR,
                        UFFOR,CONTFOR,FONEFOR,FAXFOR,AGENCIAFOR,CONTAFOR,
                        EMAILFOR,OBSFOR,CELFOR,CLIFOR)
                 SELECT :CODEMP,:CODFILIALFR,:CODFOR,RAZCLI,:CODEMP,:CODFILIALTF,
                        :CODTIPOFOR,NULL,NULL,NULL,NOMECLI,
                        DATACLI,ATIVOCLI,PESSOACLI,CNPJCLI,CPFCLI,INSCCLI,
                        RGCLI,ENDCLI,NUMCLI,COMPLCLI,BAIRCLI,CEPCLI,CIDCLI,
                        UFCLI,CONTCLI,FONECLI,FAXCLI,NULL,NULL,
                        EMAILCLI,OBSCLI,CELCLI,'C' FROM VDCLIENTE WHERE
                        CODCLI=:CODCLI AND CODFILIAL=:CODFILIALCL AND
                        CODEMP=:CODEMP;
  SUSPEND;
END ^

ALTER PROCEDURE CPCOMPRASP01 (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
NQTD NUMERIC(15, 3),
NVLRTOT NUMERIC(15, 3),
NVLRICMS NUMERIC(15, 3))
RETURNS (NVLRCUSTO NUMERIC(15, 3))
AS 

DECLARE VARIABLE CCUSTOSICMS CHAR(1);
begin
  /* Procedure Text */
  if (NQTD!=0) then
  begin
    SELECT CUSTOSICMS FROM SGPREFERE1 WHERE CODEMP=:iCodEmp
       AND CODFILIAL=:sCodFilial INTO :cCustoSICMS;
    if (cCustoSICMS IS NULL) then
       cCustoSICMS = 'N';
    if (cCustoSICMS='S') then
    begin
       NVLRCUSTO = cast( (NVLRTOT - NVLRICMS) / NQTD AS NUMERIC(15,2) );
    end
    else
    begin
       NVLRCUSTO = cast( NVLRTOT / NQTD AS NUMERIC(15,2) );
    end
  end
  else
  begin
    NVLRCUSTO = 0;
  end
  suspend;
end ^

ALTER PROCEDURE CPGERAENTRADASP (CODEMP INTEGER,
CODFILIAL INTEGER,
CODFILIALVD INTEGER,
TIPOVENDA CHAR(1) CHARACTER SET NONE,
CODVENDA INTEGER,
CITEM CHAR(1) CHARACTER SET NONE)
RETURNS (CODCOMPRA INTEGER)
AS 

DECLARE VARIABLE STATUSVENDA CHAR(2);
DECLARE VARIABLE CODCLI INTEGER;
DECLARE VARIABLE CODFILIALCL INTEGER;
DECLARE VARIABLE CODFILIALCP INTEGER;
DECLARE VARIABLE CODTIPOMOV INTEGER;
DECLARE VARIABLE CODFILIALTM INTEGER;
DECLARE VARIABLE SERIE INTEGER;
DECLARE VARIABLE CODFILIALSE INTEGER;
DECLARE VARIABLE DOC INTEGER;
DECLARE VARIABLE CODFOR INTEGER;
DECLARE VARIABLE CODFILIALFR INTEGER;
DECLARE VARIABLE CODITVENDA INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'CPFORNECED') INTO CODFILIALFR;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'CPCOMPRA') INTO CODFILIALCP;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'VDCLINTE') INTO CODFILIALCL;

  SELECT ISEQ FROM SPGERANUM(:CODEMP,:CODFILIAL,'CP') INTO CODCOMPRA;

  SELECT CODCLI,CODFILIALCL,STATUSVENDA FROM VDVENDA WHERE CODVENDA=:CODVENDA
    AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL INTO CODCLI,CODFILIALCL,STATUSVENDA;
  IF (SUBSTRING (STATUSVENDA FROM 1 FOR 1) = 'C') THEN
    EXCEPTION VDVENDAEX05;
  
  SELECT CODFOR FROM CPADICFORSP(:CODEMP,:CODFILIAL,:CODFILIALCL,:CODCLI) INTO CODFOR;

  SELECT P.CODTIPOMOV5,P.CODFILIALT5,
    T.SERIE,T.CODFILIALSE FROM SGPREFERE1 P, EQTIPOMOV T WHERE P.CODEMP=:CODEMP
    AND P.CODFILIAL=:CODFILIAL AND T.CODTIPOMOV=P.CODTIPOMOV5 AND
    T.CODEMP=P.CODEMPT5 AND T.CODFILIAL=P.CODFILIALT5
    INTO CODTIPOMOV,CODFILIALTM,SERIE,CODFILIALSE;

  SELECT * FROM LFNOVODOCSP(:SERIE,:CODEMP,:CODFILIALSE) INTO DOC;

  INSERT INTO CPCOMPRA (CODEMP,CODFILIAL,CODCOMPRA,CODEMPPG,CODFILIALPG,CODPLANOPAG,
                        CODEMPFR,CODFILIALFR,CODFOR,CODEMPSE,CODFILIALSE,SERIE,
                        CODEMPTM,CODFILIALTM,CODTIPOMOV,DOCCOMPRA,DTENTCOMPRA,DTEMITCOMPRA)
                 SELECT :CODEMP,:CODFILIAL,:CODCOMPRA,CODEMPPG,CODFILIALPG,CODPLANOPAG,
                        :CODEMP,:CODFILIALFR,:CODFOR,:CODEMP,:CODFILIALSE,:SERIE,
                        CODEMP,:CODFILIALTM,:CODTIPOMOV,:DOC,DTSAIDAVENDA,DTEMITVENDA FROM
                        VDVENDA WHERE CODEMP=:CODEMP AND CODFILIAL=:CODFILIALVD AND
                        CODVENDA=:CODVENDA;
  IF (CITEM = 'S') THEN
    EXECUTE PROCEDURE CPGERAITENTRADASP(:CODEMP,:CODFILIALCP,:CODCOMPRA,:CODFILIALVD,:TIPOVENDA,:CODVENDA,NULL,NULL);
    
  UPDATE VDVENDA SET STATUSVENDA='DV' WHERE TIPOVENDA=:TIPOVENDA AND CODVENDA=:CODVENDA
    AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIALVD;
  
  SUSPEND;
END ^

ALTER PROCEDURE CPGERAITENTRADASP (CODEMP INTEGER,
CODFILIAL INTEGER,
CODCOMPRA INTEGER,
CODFILIALVD INTEGER,
TIPOVENDA CHAR(1) CHARACTER SET NONE,
CODVENDA INTEGER,
CODITVENDA INTEGER,
QTDIT INTEGER)
AS 

DECLARE VARIABLE CODITCOMPRA INTEGER;
DECLARE VARIABLE CODFILIALTM INTEGER;
DECLARE VARIABLE CODTIPOMOV INTEGER;
DECLARE VARIABLE CODFILIALFR INTEGER;
DECLARE VARIABLE CODFOR INTEGER;
DECLARE VARIABLE CODNAT CHAR(4);
DECLARE VARIABLE CODFILIALNT INTEGER;
DECLARE VARIABLE PERCICMSITCOMPRA DECIMAL(9,2);
DECLARE VARIABLE CODFILIALPD INTEGER;
DECLARE VARIABLE CODPROD INTEGER;
DECLARE VARIABLE CODFILIALLE INTEGER;
DECLARE VARIABLE CODLOTE CHAR(13);
DECLARE VARIABLE QTDITVENDA NUMERIC(18,3);
DECLARE VARIABLE QTDDEVITVENDA NUMERIC(18,3);
DECLARE VARIABLE PRECOITVENDA NUMERIC(18,3);
DECLARE VARIABLE PERCDESCITVENDA NUMERIC(9,2);
DECLARE VARIABLE VLRDESCITVENDA NUMERIC(18,3);
DECLARE VARIABLE PERCICMSITVENDA NUMERIC(9,2);
DECLARE VARIABLE VLRBASEICMSITVENDA NUMERIC(18,3);
DECLARE VARIABLE VLRICMSITVENDA NUMERIC(18,3);
DECLARE VARIABLE PERCIPIITVENDA NUMERIC(9,2);
DECLARE VARIABLE VLRBASEIPIITVENDA NUMERIC(18,3);
DECLARE VARIABLE VLRIPIITVENDA NUMERIC(18,3);
DECLARE VARIABLE VLRLIQITVENDA NUMERIC(18,3);
DECLARE VARIABLE VLRADICITVENDA NUMERIC(18,3);
DECLARE VARIABLE VLRFRETEITVENDA NUMERIC(18,3);
DECLARE VARIABLE VLRISENTASITVENDA NUMERIC(18,3);
DECLARE VARIABLE VLROUTRASITVENDA NUMERIC(18,3);
DECLARE VARIABLE VLRPRODITVENDA NUMERIC(18,3);
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'LFNATOPER') INTO CODFILIALNT;
  SELECT CODFOR,CODFILIALFR,CODTIPOMOV,CODFILIALTM FROM CPCOMPRA WHERE CODCOMPRA=:CODCOMPRA
    AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL INTO
    :CODFOR,:CODFILIALFR,:CODTIPOMOV,:CODFILIALTM;
  FOR SELECT CODITVENDA,CODFILIALPD,CODPROD,CODFILIALLE,CODLOTE,
             QTDITVENDA,PRECOITVENDA,PERCDESCITVENDA,VLRDESCITVENDA,PERCICMSITVENDA,
             VLRBASEICMSITVENDA,VLRICMSITVENDA,PERCIPIITVENDA,VLRBASEIPIITVENDA,
             VLRIPIITVENDA,VLRLIQITVENDA,VLRADICITVENDA,VLRFRETEITVENDA,VLRISENTASITVENDA,
             VLROUTRASITVENDA,VLRPRODITVENDA,VLRPRODITVENDA FROM VDITVENDA WHERE
             CODEMP=:CODEMP AND CODFILIAL=:CODFILIALVD AND CODVENDA=:CODVENDA AND
             (:CODITVENDA IS NULL OR CODITVENDA=:CODITVENDA)
             ORDER BY CODITVENDA INTO CODITCOMPRA,CODFILIALPD,CODPROD,CODFILIALLE,CODLOTE,
             QTDITVENDA,PRECOITVENDA,PERCDESCITVENDA,VLRDESCITVENDA,PERCICMSITVENDA,
             VLRBASEICMSITVENDA,VLRICMSITVENDA,PERCIPIITVENDA,VLRBASEIPIITVENDA,
             VLRIPIITVENDA,VLRLIQITVENDA,VLRADICITVENDA,VLRFRETEITVENDA,VLRISENTASITVENDA,
             VLROUTRASITVENDA,VLRPRODITVENDA,VLRPRODITVENDA DO
  BEGIN
      IF (QTDIT IS NULL) THEN
        QTDIT = QTDITVENDA;
      SELECT SUM(QTDDEV) FROM CPCOMPRAVENDA WHERE TIPOVENDA=:TIPOVENDA
        AND CODVENDA=:CODVENDA AND CODITVENDA=:CODITVENDA
        AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL INTO QTDDEVITVENDA;
      IF (QTDIT > QTDITVENDA OR QTDIT+QTDDEVITVENDA > QTDITVENDA) THEN
        EXCEPTION VDVENDAEX01 'O ITEM: '||CAST(CODITVENDA AS CHAR(3))||' DO PEDIDO: '||
          CAST(CODVENDA AS CHAR(6))||' JA FOI DEVOLVIDO!';
        
      SELECT CODNAT FROM LFBUSCANATSP (:CODFILIAL,:CODEMP,:CODFILIALPD,:CODPROD,NULL,NULL,NULL,
                                   :CODEMP,:CODFILIALFR,:CODFOR,:CODFILIALTM,:CODTIPOMOV) INTO CODNAT;
      INSERT INTO CPITCOMPRA (CODEMP,CODFILIAL,CODCOMPRA,CODITCOMPRA,CODEMPPD,CODFILIALPD,CODPROD,
                              CODEMPLE,CODFILIALLE,CODLOTE,CODEMPNT,CODFILIALNT,CODNAT,QTDITCOMPRA,
                              PRECOITCOMPRA,PERCDESCITCOMPRA,VLRDESCITCOMPRA,PERCICMSITCOMPRA,
                              VLRBASEICMSITCOMPRA,VLRICMSITCOMPRA,PERCIPIITCOMPRA,VLRBASEIPIITCOMPRA,
                              VLRIPIITCOMPRA,VLRLIQITCOMPRA,VLRADICITCOMPRA,VLRFRETEITCOMPRA,
                              VLRISENTASITCOMPRA,VLROUTRASITCOMPRA,VLRPRODITCOMPRA,CUSTOITCOMPRA)
                       VALUES (:CODEMP,:CODFILIAL,:CODCOMPRA,:CODITCOMPRA,:CODEMP,:CODFILIALPD,:CODPROD,
                              :CODEMP,:CODFILIALLE,:CODLOTE,:CODEMP,:CODFILIALNT,:CODNAT,:QTDIT,
                              :PRECOITVENDA,:PERCDESCITVENDA,:VLRDESCITVENDA,:PERCICMSITVENDA,
                              :VLRBASEICMSITVENDA,:VLRICMSITVENDA,:PERCIPIITVENDA,:VLRBASEIPIITVENDA,
                              :VLRIPIITVENDA,:VLRLIQITVENDA,:VLRADICITVENDA,:VLRFRETEITVENDA,
                              :VLRISENTASITVENDA,:VLROUTRASITVENDA,:VLRPRODITVENDA,:VLRPRODITVENDA);

      INSERT INTO CPCOMPRAVENDA(CODEMP,CODFILIAL,CODCOMPRA,CODITCOMPRA,CODEMPVD,
                                CODFILIALVD,TIPOVENDA,CODVENDA,CODITVENDA,QTDDEV)
                       VALUES (:CODEMP,:CODFILIAL,:CODCOMPRA,:CODITCOMPRA,:CODEMP,
                               :CODFILIALVD,:TIPOVENDA,:CODVENDA,:CODITCOMPRA,:QTDIT);
  END
  SUSPEND;
END ^

ALTER PROCEDURE EQADICPRODUTOSP (ICODPROD INTEGER,
SDESCPROD CHAR(50) CHARACTER SET NONE,
SDESCAUXPROD CHAR(40) CHARACTER SET NONE,
SREFPROD CHAR(13) CHARACTER SET NONE,
SCODFABPROD CHAR(13) CHARACTER SET NONE,
SCODBARPROD CHAR(13) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 

DECLARE VARIABLE iCodnovo INTEGER;
  DECLARE VARIABLE CODALMOX INTEGER;
  DECLARE VARIABLE CODEMPAX INTEGER;
  DECLARE VARIABLE CODFILIALAX INTEGER;
  DECLARE VARIABLE CODMOEDA CHAR(4);
  DECLARE VARIABLE CODEMPMA INTEGER;
  DECLARE VARIABLE CODFILIALMA INTEGER;
  DECLARE VARIABLE CODUNID CHAR(8);
  DECLARE VARIABLE CODEMPUD INTEGER;
  DECLARE VARIABLE CODFILIALUD INTEGER;
  DECLARE VARIABLE CODFISC CHAR(10);
  DECLARE VARIABLE CODEMPFC INTEGER;
  DECLARE VARIABLE CODFILIALFC INTEGER;
  DECLARE VARIABLE CODMARCA CHAR(6);
  DECLARE VARIABLE CODEMPMC INTEGER;
  DECLARE VARIABLE CODFILIALMC INTEGER;
  DECLARE VARIABLE CODGRUP CHAR(10);
  DECLARE VARIABLE CODEMPGP INTEGER;
  DECLARE VARIABLE CODFILIALGP INTEGER;
  DECLARE VARIABLE TIPOPROD CHAR(1);
  DECLARE VARIABLE CVPROD CHAR(1);
  DECLARE VARIABLE CLOTEPROD CHAR(1);
  DECLARE VARIABLE COMISPROD DECIMAL(6,2);
  DECLARE VARIABLE PESOLIQPROD DECIMAL(10,2);
  DECLARE VARIABLE PESOBRUTPROD DECIMAL(10,2);
  DECLARE VARIABLE QTDMINPROD DECIMAL(15,2);
  DECLARE VARIABLE QTDMAXPROD DECIMAL(15,2);
  DECLARE VARIABLE PRECOBASEPROD DECIMAL(15,2);
BEGIN
  BEGIN
    BEGIN
      iCodnovo = CAST(SREFPROD AS INTEGER);
--Se no conseguir converter para int causa uma excesso e entra neste bloco:
      WHEN ANY DO
      BEGIN
        SELECT MAX(CODPROD) FROM EQPRODUTO
           WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :iCodnovo;
        iCodnovo = iCodnovo + 1;
      END
    END
    SELECT CODALMOX,CODEMPAX,CODFILIALAX,CODMOEDA,CODEMPMA,CODFILIALMA,CODUNID,CODEMPUD,CODFILIALUD,CODFISC,CODEMPFC,CODFILIALFC,CODMARCA,CODEMPMC,CODFILIALMC,CODGRUP,CODEMPGP,CODFILIALGP,TIPOPROD,
           CVPROD,CLOTEPROD,COMISPROD,PESOLIQPROD,PESOBRUTPROD,QTDMINPROD,
           QTDMAXPROD,PRECOBASEPROD FROM EQPRODUTO WHERE CODPROD=:iCodprod
           AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
           INTO
           :CODALMOX,:CODEMPAX,:CODFILIALAX,:CODMOEDA,:CODEMPMA,:CODFILIALMA,:CODUNID,:CODEMPUD,:CODFILIALUD,:CODFISC,:CODEMPFC,:CODFILIALFC,:CODMARCA,:CODEMPMC,:CODFILIALMC,:CODGRUP,:CODEMPGP,:CODFILIALGP,:TIPOPROD,
           :CVPROD,:CLOTEPROD,:COMISPROD,:PESOLIQPROD,:PESOBRUTPROD,:QTDMINPROD,
           :QTDMAXPROD,:PRECOBASEPROD;
    INSERT INTO EQPRODUTO (CODEMP,CODFILIAL,CODPROD,REFPROD,CODALMOX,CODEMPAX,CODFILIALAX,CODMOEDA,CODEMPMA,CODFILIALMA,CODUNID,CODEMPUD,CODFILIALUD,CODFISC,CODEMPFC,CODFILIALFC,CODMARCA,CODEMPMC,CODFILIALMC,
           CODGRUP,CODEMPGP,CODFILIALGP,TIPOPROD,CVPROD,DESCPROD,DESCAUXPROD,CLOTEPROD,CODBARPROD,CODFABPROD,
           COMISPROD,PESOLIQPROD,PESOBRUTPROD,QTDMINPROD,QTDMAXPROD,PRECOBASEPROD)
           VALUES (
                  :ICODEMP,:ICODFILIAL,:iCodnovo,:sRefProd,:CODALMOX,:CODEMPAX,:CODFILIALAX,:CODMOEDA,:CODEMPMA,:CODFILIALMA,:CODUNID,:CODEMPUD,:CODFILIALUD,:CODFISC,:CODEMPFC,:CODFILIALFC,:CODMARCA,:CODEMPMC,:CODFILIALMC,
                  :CODGRUP,:CODEMPGP,:CODFILIALGP,:TIPOPROD,:CVPROD,:sDescprod,:sDescAuxprod,:CLOTEPROD,:sCodbarprod,:sCodfabprod,
                  :COMISPROD,:PESOLIQPROD,:PESOBRUTPROD,:QTDMINPROD,:QTDMAXPROD,:PRECOBASEPROD
           );
    INSERT INTO VDPRECOPROD (CODEMP,CODFILIAL,CODPROD,CODPRECOPROD,CODCLASCLI,CODEMPCC,CODFILIALCC,CODTAB,CODEMPTB,CODFILIALTB,CODPLANOPAG,CODEMPPG,CODFILIALPG,PRECOPROD)
           SELECT :ICODEMP,:ICODFILIAL,:iCodnovo,CODPRECOPROD,CODCLASCLI,CODEMPCC,CODFILIALCC,
                  CODTAB,CODEMPTB,CODFILIALTB,CODPLANOPAG,CODEMPPG,CODFILIALPG,PRECOPROD FROM VDPRECOPROD WHERE CODPROD=:iCodprod
                  AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL;
  END
  SUSPEND;
END ^

ALTER PROCEDURE EQBUSCASIMILARSP (CODEMP INTEGER,
CODFILIAL CHAR(8) CHARACTER SET NONE,
IPROD INTEGER,
SREFPROD CHAR(13) CHARACTER SET NONE)
RETURNS (SRET CHAR(13) CHARACTER SET NONE,
IRET INTEGER,
CORIG CHAR(1) CHARACTER SET NONE,
ICODFOR INTEGER,
SRAZFOR CHAR(50) CHARACTER SET NONE,
NPRECO NUMERIC(15, 3),
SSIM CHAR(18) CHARACTER SET NONE,
SSIMMASTER CHAR(18) CHARACTER SET NONE)
AS 

DECLARE VARIABLE SFK CHAR(21);
DECLARE VARIABLE SBUSCA CHAR(21);
BEGIN
  IF (IPROD IS NULL) THEN
  BEGIN
    SELECT CODPROD FROM EQPRODUTO WHERE CODEMP=:CODEMP
      AND CODFILIAL=:CODFILIAL AND REFPROD=:SREFPROD
      INTO IPROD;
    SBUSCA = CAST(SREFPROD AS CHAR(21));
  END
  ELSE
  BEGIN
    SBUSCA = CAST(IPROD AS VARCHAR(21));
  END
  FOR SELECT 'S',S.REFPRODSIM,S.REFPRODSIMFK,CAST(NULL AS INTEGER),
    CAST(NULL AS CHAR(50)),CAST(NULL AS NUMERIC(15,3)),
    S.CODPROD,(SELECT P.REFPROD FROM EQPRODUTO P WHERE P.CODPROD=S.CODPROD
    AND P.CODEMP=S.CODEMP AND P.CODFILIAL=S.CODFILIAL)
    FROM EQSIMILAR S WHERE
    (S.CODPROD = :IPROD OR S.REFPRODSIM = :SBUSCA)
    AND S.CODEMP=:CODEMP AND S.CODFILIAL=:CODFILIAL INTO
    CORIG,SSIM,SFK,ICODFOR,SRAZFOR,NPRECO,IRET,SRET DO
  BEGIN
    SSIMMASTER = SSIM;
    SUSPEND;
    FOR SELECT 'K',S.REFPRODSIM,S.REFPRODSIMFK,CAST(NULL AS INTEGER),
      CAST(NULL AS CHAR(50)),CAST(NULL AS NUMERIC(15,3)),
      S.CODPROD,(SELECT P.REFPROD FROM EQPRODUTO P WHERE P.CODPROD=S.CODPROD
      AND P.CODEMP=S.CODEMP AND P.CODFILIAL=S.CODFILIAL)
      FROM EQSIMILAR S WHERE
      (S.REFPRODSIMFK = :SFK OR S.CODPROD=:IRET) AND NOT S.REFPRODSIM=:SSIMMASTER
      AND S.CODEMP=:CODEMP AND S.CODFILIAL=:CODFILIAL INTO
      CORIG,SSIM,SFK,ICODFOR,SRAZFOR,NPRECO,IRET,SRET DO
    BEGIN
      SUSPEND;
    END
  END

  FOR SELECT 'C',C.REFPRODFOR,C.CODFOR,F.RAZFOR,CAST(NULL AS NUMERIC(15,3)),
    P.CODPROD,(SELECT P.REFPROD FROM EQPRODUTO P WHERE P.CODPROD=C.CODPROD
    AND P.CODEMP=C.CODEMP AND P.CODFILIAL=C.CODFILIAL)
    FROM CPPRODFOR C, EQPRODUTO P, CPFORNECED F
    WHERE (C.CODPROD = :IPROD OR C.REFPRODFOR = :SBUSCA)
    AND C.CODEMP=:CODEMP AND C.CODFILIAL=:CODFILIAL AND P.CODEMP=C.CODEMP
    AND P.CODFILIAL=C.CODFILIAL AND P.CODPROD=C.CODPROD
    AND F.CODEMP=C.CODEMP AND F.CODFILIAL=C.CODFILIAL
    AND F.CODFOR=C.CODFOR
    UNION
    SELECT 'T',T.REFPRODTFOR,T.CODFOR,F.RAZFOR,T.PRECOPRODTFOR,
    (SELECT P.CODPROD FROM EQPRODUTO P WHERE P.CODEMP=T.CODEMPPD
    AND P.CODFILIAL=T.CODFILIALPD AND P.CODPROD=T.CODPROD),
    (SELECT P.REFPROD FROM EQPRODUTO P WHERE P.CODPROD=T.CODPROD
    AND P.CODEMP=T.CODEMP AND P.CODFILIAL=T.CODFILIAL)
    FROM CPTABFOR T, CPFORNECED F
    WHERE T.REFPRODTFOR = :SBUSCA AND T.CODEMP=:CODEMP
    AND T.CODFILIAL=:CODFILIAL AND F.CODEMP=T.CODEMP
    AND F.CODFILIAL=T.CODFILIAL AND F.CODFOR=T.CODFOR INTO
    CORIG,SSIM,ICODFOR,SRAZFOR,NPRECO,SRET,IRET DO
  BEGIN
    SUSPEND;
  END
END ^

ALTER PROCEDURE EQCALCPEPSSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODPROD INTEGER,
NSLDPROD NUMERIC(15, 3),
DTESTOQ DATE)
RETURNS (NCUSTOPEPS NUMERIC(15, 3))
AS 

DECLARE VARIABLE DTTEMP DATE;
DECLARE VARIABLE NCUSTO NUMERIC(15,3);
DECLARE VARIABLE NQTD NUMERIC(15,3);
DECLARE VARIABLE NRESTO NUMERIC(15,3);
DECLARE VARIABLE NCUSTOTOT NUMERIC(15,3);
DECLARE VARIABLE NSLDTMP NUMERIC(15,3);
begin
  /* Procedure que retorna o clculo do custo peps */
  NCUSTO = 0;
  NCUSTOTOT = 0;
  NRESTO = 0;
  NCUSTOPEPS = 0;
  IF ( (NSLDPROD IS NOT NULL) AND (NSLDPROD != 0) ) THEN
  BEGIN
      NSLDTMP = NSLDPROD;
      FOR SELECT MP.DTMOVPROD,MP.QTDMOVPROD,MP.PRECOMOVPROD
        FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE MP.CODEMPPD=:ICODEMP AND MP.CODFILIALPD=:SCODFILIAL AND MP.CODPROD=:ICODPROD AND
           MP.CODEMPTM=TM.CODEMP AND MP.CODFILIALTM=TM.CODFILIAL AND MP.CODTIPOMOV=TM.CODTIPOMOV AND
           MP.TIPOMOVPROD IN ('E','I') AND TM.TIPOMOV IN ('IV','CP','PC') AND
           MP.DTMOVPROD<=:DTESTOQ
         ORDER BY MP.DTMOVPROD DESC, MP.CODMOVPROD DESC
         INTO :DTTEMP,:NQTD,:NCUSTO DO
      BEGIN
         IF (NQTD IS NULL) THEN
            NQTD = 0;
         IF ( (NCUSTO IS NULL) ) THEN
            NCUSTO = 0;
         NRESTO = NSLDTMP - NQTD;
         IF (NRESTO<=0) THEN
         BEGIN
           NCUSTOTOT = NCUSTOTOT + (NCUSTO * (NQTD+NRESTO) );
           BREAK;
         END
         ELSE
         BEGIN
           NCUSTOTOT = NCUSTOTOT + (NCUSTO * NQTD);
           NSLDTMP = NSLDTMP - NQTD;
         END
      END
      NCUSTOPEPS = NCUSTOTOT / NSLDPROD;
  END
  suspend;
end ^

ALTER PROCEDURE EQCOPIAPROD (ICODPROD INTEGER,
ICODEMP INTEGER,
ICODFILIAL INTEGER)
RETURNS (ICOD INTEGER)
AS 

DECLARE VARIABLE INOVOCOD INTEGER;
BEGIN
  SELECT MAX(CODPROD)+1 FROM EQPRODUTO
    WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO INOVOCOD;
  INSERT INTO EQPRODUTO
      (CODPROD,CODEMP,CODFILIAL,DESCPROD,REFPROD,CODEMPAX,
      CODFILIALAX,CODALMOX,CODEMPMA,CODFILIALMA,CODMOEDA,CODEMPUD,
      CODFILIALUD,CODUNID,CODEMPFC,CODFILIALFC,CODFISC,CODEMPMC,
      CODFILIALMC,CODMARCA,DESCAUXPROD,TIPOPROD,CVPROD,CODEMPGP,
      CODFILIALGP,CODGRUP,CODBARPROD,CLOTEPROD,CODFABPROD,
      COMISPROD,PESOLIQPROD,PESOBRUTPROD,QTDMINPROD,QTDMAXPROD,
      CUSTOMPMPROD,CUSTOPEPSPROD,PRECOBASEPROD,SLDPROD,SLDRESPROD,
      SLDCONSIGPROD,SLDLIQPROD,ATIVOPROD,DTULTCPPROD,QTDULTCPPROD,
      DESCCOMPPROD)
    SELECT :INOVOCOD,:ICODEMP,:ICODFILIAL,DESCPROD,:INOVOCOD,CODEMPAX,
      CODFILIALAX,CODALMOX,CODEMPMA,CODFILIALMA,CODMOEDA,CODEMPUD,
      CODFILIALUD,CODUNID,CODEMPFC,CODFILIALFC,CODFISC,CODEMPMC,
      CODFILIALMC,CODMARCA,DESCAUXPROD,TIPOPROD,CVPROD,CODEMPGP,
      CODFILIALGP,CODGRUP,CODBARPROD,CLOTEPROD,CODFABPROD,COMISPROD,
      PESOLIQPROD,PESOBRUTPROD,QTDMINPROD,QTDMAXPROD,CUSTOMPMPROD,
      CUSTOPEPSPROD,PRECOBASEPROD,SLDPROD,SLDRESPROD,SLDCONSIGPROD,
      SLDLIQPROD,ATIVOPROD,DTULTCPPROD,QTDULTCPPROD,DESCCOMPPROD FROM
      EQPRODUTO WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND
      CODPROD=:ICODPROD;

    INSERT INTO VDPRECOPROD (CODEMP,CODFILIAL,CODPROD,CODPRECOPROD,
        CODEMPTB,CODFILIALTB,CODTAB,CODEMPCC,CODFILIALCC,CODCLASCLI,
        CODEMPPG,CODFILIALPG,CODPLANOPAG,PRECOPROD)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODPRECOPROD,
        CODEMPTB,CODFILIALTB,CODTAB,CODEMPCC,CODFILIALCC,CODCLASCLI,
        CODEMPPG,CODFILIALPG,CODPLANOPAG,PRECOPROD FROM VDPRECOPROD
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND
          CODPROD=:ICODPROD;

    INSERT INTO EQFATCONV (CODEMP,CODFILIAL,CODPROD,CODUNID,FATCONV)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODUNID,FATCONV FROM EQFATCONV
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;

    INSERT INTO CPPRODFOR (CODEMP,CODFILIAL,CODPROD,CODFOR,REFPRODFOR)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODFOR,REFPRODFOR FROM CPPRODFOR
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;
        
    INSERT INTO EQLOTE (CODEMP,CODFILIAL,CODPROD,CODLOTE,VENCTOLOTE,
        SLDLOTE,SLDRESLOTE,SLDCONSIGLOTE,SLDLIQLOTE,DINILOTE)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODLOTE,VENCTOLOTE,
        SLDLOTE,SLDRESLOTE,SLDCONSIGLOTE,SLDLIQLOTE,DINILOTE FROM EQLOTE
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;
        
    INSERT INTO VDFOTOPROD (CODEMP,CODFILIAL,CODPROD,CODFOTOPROD,DESCFOTOPROD,
        TIPOFOTOPROD,LARGFOTOPROD,ALTFOTOPROD,FOTOPROD)
      SELECT CODEMP,CODFILIAL,:INOVOCOD,CODFOTOPROD,DESCFOTOPROD,
        TIPOFOTOPROD,LARGFOTOPROD,ALTFOTOPROD,FOTOPROD FROM VDFOTOPROD
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND CODPROD=:ICODPROD;
   ICOD = INOVOCOD;
   SUSPEND;
END ^

ALTER PROCEDURE EQMOVPRODATEQSP (ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE CHAR(13) CHARACTER SET NONE,
SOPERADOR SMALLINT,
NQTDMOVPRODOLD NUMERIC(15, 3),
NQTDMOVPRODNEW NUMERIC(15, 3),
ICODINVPROD INTEGER,
ICODCOMPRA INTEGER,
DDTULTCPPROD DATE,
NQTDULTCPPROD NUMERIC(15, 3),
DDTMPMPROD DATE,
NCUSTOMPMPROD NUMERIC(15, 3))
AS 

DECLARE VARIABLE CCLOTEPROD CHAR(1);
DECLARE VARIABLE ICODALMOX INTEGER;
DECLARE VARIABLE ICODEMPAX INTEGER;
DECLARE VARIABLE SCODFILIALAX SMALLINT;
begin
  /* Procedure de atualizao do estoque */
  if ( (ICODINVPROD IS NOT NULL) OR (ICODCOMPRA IS NOT NULL ) ) THEN
    UPDATE EQPRODUTO SET SLDPROD = SLDPROD+((:NQTDMOVPRODNEW-:NQTDMOVPRODOLD)*:SOPERADOR),
           DTULTCPPROD=:DDTULTCPPROD, QTDULTCPPROD=:NQTDULTCPPROD,
           DTMPMPROD=:DDTMPMPROD, CUSTOMPMPROD=:NCUSTOMPMPROD
       WHERE CODPROD=:ICODPROD  AND CODEMP=:ICODEMPPD AND CODFILIAL=:SCODFILIALPD;
  ELSE
    UPDATE EQPRODUTO SET SLDPROD = SLDPROD+((:NQTDMOVPRODNEW-:NQTDMOVPRODOLD)*:SOPERADOR)
            WHERE CODPROD=:ICODPROD AND CODEMP=:ICODEMPPD AND CODFILIAL=:SCODFILIALPD;

  SELECT CLOTEPROD, CODALMOX,CODEMPAX,CODFILIALAX FROM EQPRODUTO
     WHERE CODPROD = :ICODPROD AND CODEMP=:ICODEMPPD AND CODFILIAL = :SCODFILIALPD
      INTO :CCLOTEPROD, :ICODALMOX, :ICODEMPAX, :SCODFILIALAX;
    
  UPDATE EQSALDOPROD SET SLDPROD = SLDPROD+((:NQTDMOVPRODNEW-:NQTDMOVPRODOLD)*:SOPERADOR)
         WHERE CODPROD=:ICODPROD AND CODALMOX = :ICODALMOX
           AND CODEMPAX = :ICODEMPAX AND CODFILIALAX = :SCODFILIALAX
           AND CODEMP=:ICODEMPPD AND CODFILIAL=:SCODFILIALPD;

  IF (CCLOTEPROD = 'S') THEN
  BEGIN
    IF (CCODLOTE IS NULL) THEN
    BEGIN
      EXCEPTION EQPRODUTOEX01 'ESTE MOVIMENTO PRECISA DE UM LOTE!';
    END
    ELSE
    BEGIN
      UPDATE EQLOTE SET SLDLOTE = SLDLOTE+((:NQTDMOVPRODNEW-:NQTDMOVPRODOLD)*:SOPERADOR)
           WHERE CODLOTE=:CCODLOTE AND CODPROD=:ICODPROD
           AND CODEMP=:ICODEMPLE AND CODFILIAL=:SCODFILIALLE;
    END
  END

  suspend;
end ^

ALTER PROCEDURE EQMOVPRODCKCPSP (ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODCOMPRA INTEGER,
ICODINVPROD INTEGER,
DDTMOVPROD DATE,
NQTDMOVPROD NUMERIC(15, 3),
NCUSTOMPMMOVPROD NUMERIC(15, 2))
RETURNS (DDTULTCPPROD DATE,
NQTDULTCPPROD NUMERIC(15, 3),
DDTMPMPROD DATE,
NCUSTOMPMPROD NUMERIC(15, 3))
AS 

begin
  /* Procedure para checar data da ltima compra */
  NCUSTOMPMPROD = 0;
  if (NCUSTOMPMMOVPROD IS NULL) then
     NCUSTOMPMMOVPROD = 0;
  if ( (ICODINVPROD IS NOT NULL) OR (ICODCOMPRA IS NOT NULL) ) then
  begin
     SELECT DTULTCPPROD,QTDULTCPPROD,DTMPMPROD, CUSTOMPMPROD FROM EQPRODUTO WHERE CODPROD=:ICODPROD
          AND CODEMP=:ICODEMPPD AND CODFILIAL = :SCODFILIALPD
          INTO :DDTULTCPPROD, :NQTDULTCPPROD, :DDTMPMPROD, :NCUSTOMPMPROD;
      if (NQTDULTCPPROD IS NULL) then
         NQTDULTCPPROD = 0;
      if (NCUSTOMPMPROD IS NULL) then
         NCUSTOMPMPROD = 0;
      if ( ICODCOMPRA IS NOT NULL ) then
      begin
         if ( (DDTMOVPROD>DDTULTCPPROD) OR (DDTULTCPPROD IS NULL) ) then
         begin
             DDTULTCPPROD = DDTMOVPROD;
             NQTDULTCPPROD = NQTDMOVPROD;
         end
      end
      if ( ( ICODINVPROD IS NOT NULL) OR (ICODCOMPRA IS NOT NULL) ) then
      begin
         if ( (DDTMOVPROD>=DDTMPMPROD OR DDTMPMPROD IS NULL) AND
              (NCUSTOMPMMOVPROD>0)  ) then
         begin
            DDTMPMPROD = DDTMOVPROD;
            NCUSTOMPMPROD = NCUSTOMPMMOVPROD;
         end
      end
  end


  suspend;
end ^

ALTER PROCEDURE EQMOVPRODCKTMSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODTIPOMOV INTEGER)
RETURNS (CESTIPOMOV CHAR(1) CHARACTER SET NONE,
SOPERADOR SMALLINT)
AS 

DECLARE VARIABLE CESTOQTIPOMOV CHAR(1);
begin
  /* Verifique se  para contar estoque */
  SELECT TM.ESTIPOMOV, TM.ESTOQTIPOMOV FROM EQTIPOMOV TM WHERE TM.CODEMP=:ICODEMP AND
     TM.CODFILIAL = :SCODFILIAL AND TM.CODTIPOMOV = :ICODTIPOMOV
     INTO :CESTIPOMOV, :CESTOQTIPOMOV;
  SOPERADOR = 0;
  if (CESTOQTIPOMOV='S') then
  begin
     if (CESTIPOMOV='S') then
        SOPERADOR = -1;
     else
        SOPERADOR = 1;
  end
  suspend;
end ^

ALTER PROCEDURE EQMOVPRODCKUTMSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPOLD INTEGER,
SCODFILIALOLD SMALLINT,
ICODTIPOMOVOLD INTEGER)
RETURNS (CALTTM CHAR(1) CHARACTER SET NONE)
AS 

DECLARE VARIABLE CESTIPOMOV CHAR(1);
DECLARE VARIABLE CESTOQTIPOMOV CHAR(1);
DECLARE VARIABLE CESTIPOMOVOLD CHAR(1);
DECLARE VARIABLE CESTOQTIPOMOVOLD CHAR(1);
begin
  /* Verifica se h alterao no tipo de movimento para reprocessamento de estoque */
  CALTTM = 'N';
  SELECT TM.ESTIPOMOV, TM.ESTOQTIPOMOV FROM EQTIPOMOV TM
     WHERE TM.CODEMP=:ICODEMP AND TM.CODFILIAL=:SCODFILIAL
      AND TM.CODTIPOMOV=:ICODTIPOMOV
     INTO :CESTIPOMOV, :CESTOQTIPOMOV;

  SELECT TM.ESTIPOMOV, TM.ESTOQTIPOMOV FROM EQTIPOMOV TM
     WHERE TM.CODEMP=:ICODEMPOLD AND TM.CODFILIAL=:SCODFILIALOLD
      AND TM.CODTIPOMOV=:ICODTIPOMOVOLD
     INTO :CESTIPOMOVOLD, :CESTOQTIPOMOVOLD;

  if ( (CESTIPOMOV!=CESTIPOMOVOLD) OR (CESTOQTIPOMOV!=CESTOQTIPOMOVOLD) OR
       (CESTIPOMOVOLD IS NULL) OR (CESTOQTIPOMOVOLD IS NULL)  ) then
     CALTTM = 'S';
  suspend;
end ^

ALTER PROCEDURE EQMOVPRODCSLDSP (ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
NQTDMOVPROD NUMERIC(15, 3),
NPRECOMOVPROD NUMERIC(15, 3),
NCUSTOMPMMOVPROD NUMERIC(15, 3),
NSLDMOVPROD NUMERIC(15, 3))
RETURNS (NCUSTOMPM NUMERIC(15, 3),
NSALDO NUMERIC(15, 3),
CESTOQMOVPROD CHAR(1) CHARACTER SET NONE,
CTIPOMOVPROD CHAR(1) CHARACTER SET NONE,
SOPERADOR SMALLINT)
AS 

begin
  /* Procedure que retorna o clculo de custo e saldo */
  NCUSTOMPM = 0;
  NSALDO = 0;
  SELECT CESTIPOMOV, SOPERADOR
     FROM EQMOVPRODCKTMSP( :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV)
     INTO :CTIPOMOVPROD, :SOPERADOR;
  if (SOPERADOR=0) then
  begin
     CESTOQMOVPROD = 'N';
     NSALDO = NSLDMOVPROD;
  end
  else
  begin  -- verifica se  para controlar estoque
     CESTOQMOVPROD = 'S';
     NSALDO = NSLDMOVPROD + CAST ( (NQTDMOVPROD * SOPERADOR) AS NUMERIC(15,3) );
  end
  if ( (NSALDO > NSLDMOVPROD) AND (NSALDO > 0) ) then
  begin
    if ( (NSLDMOVPROD * NCUSTOMPMMOVPROD)  < 0) then
       NCUSTOMPM = NPRECOMOVPROD;
    else
       NCUSTOMPM = ( (NSLDMOVPROD * NCUSTOMPMMOVPROD) +
           (NQTDMOVPROD * NPRECOMOVPROD) ) / NSALDO ;
  end
  else
      NCUSTOMPM = NCUSTOMPMMOVPROD;

  suspend;
end ^

ALTER PROCEDURE EQMOVPRODDSP (ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
DDTMOVPROD DATE)
AS 

DECLARE VARIABLE ICODEMP INTEGER;
DECLARE VARIABLE SCODFILIAL SMALLINT;
DECLARE VARIABLE ICODMOVPROD INTEGER;
DECLARE VARIABLE NSLDMOVPROD NUMERIC(15,3);
DECLARE VARIABLE NCUSTOMPMMOVPROD NUMERIC(15,3);
begin
  /* Procedure de deleo da tabela eqmovprod */
  SELECT ICODEMP, SCODFILIAL, ICODMOVPROD FROM EQMOVPRODRETCODSP(:ICODEMPIV, :SCODFILIALIV, :ICODINVPROD, :ICODEMPCP,
    :SCODFILIALCP, :ICODCOMPRA, :SCODITCOMPRA, :ICODEMPVD, :SCODFILIALVD,
    :CTIPOVENDA, :ICODVENDA, :SCODITVENDA, :ICODEMPRM, :SCODFILIALRM, :ICODRMA,
    :SCODITRMA) INTO :ICODEMP, :SCODFILIAL, :ICODMOVPROD;

  SELECT NSALDO, NCUSTOMPM FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD,
   :ICODEMPPD, :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, 0)
     INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD ;

  -- DELETAR EQMOVPROD
  DELETE FROM EQMOVPROD WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL
    AND CODMOVPROD=:ICODMOVPROD;

  -- REPROCESSAR ESTOQUE
  EXECUTE PROCEDURE EQMOVPRODPRCSLDSP( :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
    :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, null, :NSLDMOVPROD, :NCUSTOMPMMOVPROD);

  -- ATUALIZA CUSTO NO CADASTRO DE PRODUTOS
  -- OPERADOR 1 PARA EFETUAR A ATUALIZAO SEMPRE
 -- EXECUTE PROCEDURE EQMOVPRODATCUSTSP( 1, :ICODEMP, :SCODFILIAL,
   --:ICODMOVPROD,  :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, 0);

  suspend;
end ^

ALTER PROCEDURE EQMOVPRODISP (ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE CHAR(13) CHARACTER SET NONE,
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4) CHARACTER SET NONE,
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR(1) CHARACTER SET NONE,
NQTDMOVPROD NUMERIC(15, 3),
NPRECOMOVPROD NUMERIC(15, 3))
AS 

DECLARE VARIABLE SCODFILIAL SMALLINT;
DECLARE VARIABLE ICODMOVPROD INTEGER;
DECLARE VARIABLE CESTOQMOVPROD CHAR(1);
DECLARE VARIABLE CTIPOMOVPROD CHAR(1);
DECLARE VARIABLE NSLDMOVPROD NUMERIC(15,3);
DECLARE VARIABLE NCUSTOMPMMOVPROD NUMERIC(15,3);
DECLARE VARIABLE SOPERADOR SMALLINT;
begin
  /* Procedure de insero na tabela eqmovprod */

  SELECT NSALDO, NCUSTOMPM FROM EQMOVPRODSLDSP(null, null, null, :ICODEMPPD,
     :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, :NPRECOMOVPROD)
     INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD ;

  -- Verifica se haver mudana de saldo
  SELECT NSALDO, NCUSTOMPM, CESTOQMOVPROD, CTIPOMOVPROD, SOPERADOR FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
      :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPROD)
      INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :CESTOQMOVPROD, :CTIPOMOVPROD, :SOPERADOR;

  SELECT SCODFILIAL, ICODMOVPROD FROM EQMOVPRODSEQSP(:ICODEMPPD)
     INTO :SCODFILIAL, :ICODMOVPROD;  -- encontra o prximo cdigo e a filial

   INSERT INTO EQMOVPROD ( CODEMP, CODFILIAL, CODMOVPROD,
      CODEMPPD, CODFILIALPD , CODPROD , CODEMPLE ,
      CODFILIALLE , CODLOTE , CODEMPTM, CODFILIALTM,
      CODTIPOMOV, CODEMPIV , CODFILIALIV , CODINVPROD ,
      CODEMPCP , CODFILIALCP , CODCOMPRA , CODITCOMPRA , CODEMPVD ,
      CODFILIALVD , TIPOVENDA , CODVENDA , CODITVENDA , CODEMPRM ,
      CODFILIALRM , CODRMA , CODITRMA , CODEMPNT , CODFILIALNT ,
      CODNAT , DTMOVPROD , DOCMOVPROD , FLAG , QTDMOVPROD ,
      PRECOMOVPROD, ESTOQMOVPROD, TIPOMOVPROD, SLDMOVPROD, CUSTOMPMMOVPROD )
   VALUES ( :ICODEMPPD, :SCODFILIAL, :ICODMOVPROD,
    :ICODEMPPD , :SCODFILIALPD , :ICODPROD , :ICODEMPLE ,
    :SCODFILIALLE , :CCODLOTE , :ICODEMPTM, :SCODFILIALTM,
    :ICODTIPOMOV, :ICODEMPIV , :SCODFILIALIV ,
    :ICODINVPROD , :ICODEMPCP , :SCODFILIALCP , :ICODCOMPRA ,
    :SCODITCOMPRA , :ICODEMPVD , :SCODFILIALVD , :CTIPOVENDA ,
    :ICODVENDA , :SCODITVENDA , :ICODEMPRM , :SCODFILIALRM ,
    :ICODRMA , :SCODITRMA , :ICODEMPNT , :SCODFILIALNT , :CCODNAT ,
    :DDTMOVPROD , :IDOCMOVPROD , :CFLAG , :NQTDMOVPROD ,
    :NPRECOMOVPROD, :CESTOQMOVPROD, :CTIPOMOVPROD, :NSLDMOVPROD, :NCUSTOMPMMOVPROD );

  -- REPROCESSAR ESTOQUE

  EXECUTE PROCEDURE EQMOVPRODPRCSLDSP( :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
    :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, null, :NSLDMOVPROD, :NCUSTOMPMMOVPROD);

  -- ATUALIZA O CUSTO NO CADASTRO DE PRODUTOS
 -- EXECUTE PROCEDURE EQMOVPRODATCUSTSP(:SOPERADOR, :ICODEMPPD, :SCODFILIAL,
   --   :ICODMOVPROD, :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, :NCUSTOMPMMOVPROD);


  suspend;
end ^

ALTER PROCEDURE EQMOVPRODIUDSP (CIUD CHAR(1) CHARACTER SET NONE,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE CHAR(13) CHARACTER SET NONE,
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4) CHARACTER SET NONE,
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR(1) CHARACTER SET NONE,
NQTDMOVPROD NUMERIC(15, 3),
NPRECOMOVPROD NUMERIC(15, 3))
AS 

begin
  /* Procedure que controle INSERT, UPDATE E DELETE da tabela eqmovprod */
  if (CIUD='I') then -- SE FOR INSERT
     execute procedure EQMOVPRODISP( ICODEMPPD, SCODFILIALPD, ICODPROD,
         ICODEMPLE, SCODFILIALLE, CCODLOTE, ICODEMPTM, SCODFILIALTM, ICODTIPOMOV,
         ICODEMPIV, SCODFILIALIV, ICODINVPROD, ICODEMPCP, SCODFILIALCP, ICODCOMPRA,
         SCODITCOMPRA, ICODEMPVD, SCODFILIALVD, CTIPOVENDA, ICODVENDA, SCODITVENDA,
         ICODEMPRM, SCODFILIALRM, ICODRMA, SCODITRMA, ICODEMPNT, SCODFILIALNT,
         CCODNAT, DDTMOVPROD, IDOCMOVPROD, CFLAG, NQTDMOVPROD, NPRECOMOVPROD);
  else if (CIUD='U') then
     execute procedure EQMOVPRODUSP( ICODEMPPD, SCODFILIALPD, ICODPROD,
         ICODEMPLE, SCODFILIALLE, CCODLOTE, ICODEMPTM, SCODFILIALTM, ICODTIPOMOV,
         ICODEMPIV, SCODFILIALIV, ICODINVPROD, ICODEMPCP, SCODFILIALCP, ICODCOMPRA,
         SCODITCOMPRA, ICODEMPVD, SCODFILIALVD, CTIPOVENDA, ICODVENDA, SCODITVENDA,
         ICODEMPRM, SCODFILIALRM, ICODRMA, SCODITRMA, ICODEMPNT, SCODFILIALNT,
         CCODNAT, DDTMOVPROD, IDOCMOVPROD, CFLAG, NQTDMOVPROD, NPRECOMOVPROD);
  else if (CIUD='D') then
     execute procedure EQMOVPRODDSP( ICODEMPPD, SCODFILIALPD, ICODPROD, ICODEMPIV,
         SCODFILIALIV, ICODINVPROD, ICODEMPCP, SCODFILIALCP, ICODCOMPRA, SCODITCOMPRA,
         ICODEMPVD, SCODFILIALVD, CTIPOVENDA, ICODVENDA, SCODITVENDA,
         ICODEMPRM, SCODFILIALRM, ICODRMA, SCODITRMA, DDTMOVPROD);
  suspend;
end ^

ALTER PROCEDURE EQMOVPRODPRCSLDSP (SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
DDTMOVPROD DATE,
DDTMOVPRODPRC DATE,
NSLDMOVPROD NUMERIC(15, 3),
NCUSTOMPMMOVPROD NUMERIC(15, 3))
AS 

DECLARE VARIABLE ICODEMPTM INTEGER;
DECLARE VARIABLE SCODFILIALTM SMALLINT;
DECLARE VARIABLE ICODTIPOMOV INTEGER;
DECLARE VARIABLE NQTDMOVPROD NUMERIC(15,3);
DECLARE VARIABLE NPRECOMOVPROD NUMERIC(15,3);
DECLARE VARIABLE ICODMOVPRODPRC INTEGER;
DECLARE VARIABLE CESTOQMOVPROD CHAR(1);
begin
  /* Procedure de processamento de estoque */
  FOR SELECT MP.CODEMPTM, MP.CODFILIALTM, MP.CODTIPOMOV ,
    MP.QTDMOVPROD, MP.PRECOMOVPROD , MP.CODMOVPROD
    FROM EQMOVPROD MP
    WHERE MP.CODEMPPD=:ICODEMPPD AND MP.CODFILIALPD=:SCODFILIALPD AND
       MP.CODPROD=:ICODPROD AND MP.CODEMP=:ICODEMPPD AND MP.CODFILIAL=:SCODFILIAL AND
       ( (MP.DTMOVPROD = :DDTMOVPROD AND MP.CODMOVPROD > :ICODMOVPROD) OR
         (MP.DTMOVPROD>:DDTMOVPROD) ) AND
       ( (:DDTMOVPRODPRC IS NULL) OR
         (MP.DTMOVPROD = :DDTMOVPRODPRC AND MP.CODMOVPROD < :ICODMOVPROD) OR
         (MP.DTMOVPROD < :DDTMOVPRODPRC) )
    ORDER BY MP.DTMOVPROD, MP.CODMOVPROD
    INTO :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV,
     :NQTDMOVPROD, :NPRECOMOVPROD, :ICODMOVPRODPRC DO
  BEGIN
      SELECT NSALDO, NCUSTOMPM, CESTOQMOVPROD FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
        :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMMOVPROD, :NSLDMOVPROD)
      INTO :NSLDMOVPROD, :NCUSTOMPMMOVPROD, :CESTOQMOVPROD;

      UPDATE EQMOVPROD SET SLDMOVPROD=:NSLDMOVPROD, CUSTOMPMMOVPROD=:NCUSTOMPMMOVPROD,
        ESTOQMOVPROD=:CESTOQMOVPROD
        WHERE CODEMP=:ICODEMPPD AND CODFILIAL=:SCODFILIAL AND CODMOVPROD=:ICODMOVPRODPRC;

  END
  suspend;
end ^

ALTER PROCEDURE EQMOVPRODRETCODSP (ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT)
RETURNS (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER)
AS 

begin
  /* Retorna o cdigo do movimento de estoque */
  if (ICODINVPROD IS NOT NULL) then
     SELECT MP.CODEMP, MP.CODFILIAL, MP.CODMOVPROD FROM EQMOVPROD MP
       WHERE MP.CODEMPIV=:ICODEMPIV AND MP.CODFILIALIV=:SCODFILIALIV
         AND MP.CODINVPROD=:ICODINVPROD
       INTO  :ICODEMP, :SCODFILIAL, :ICODMOVPROD;
  else if (ICODCOMPRA IS NOT NULL) then
     SELECT MP.CODEMP, MP.CODFILIAL, MP.CODMOVPROD FROM EQMOVPROD MP
       WHERE MP.CODEMPCP=:ICODEMPCP AND MP.CODFILIALCP=:SCODFILIALCP
         AND MP.CODCOMPRA=:ICODCOMPRA AND MP.CODITCOMPRA=:SCODITCOMPRA
       INTO  :ICODEMP, :SCODFILIAL, :ICODMOVPROD;
  else if (ICODVENDA IS NOT NULL) then
     SELECT MP.CODEMP, MP.CODFILIAL, MP.CODMOVPROD FROM EQMOVPROD MP
       WHERE MP.CODEMPVD=:ICODEMPVD AND MP.CODFILIALVD=:SCODFILIALVD
         AND MP.TIPOVENDA=:CTIPOVENDA AND MP.CODVENDA=:ICODVENDA
         AND MP.CODITVENDA=:SCODITVENDA
       INTO  :ICODEMP, :SCODFILIAL, :ICODMOVPROD;
  else if (ICODRMA IS NOT NULL) then
     SELECT MP.CODEMP, MP.CODFILIAL, MP.CODMOVPROD FROM EQMOVPROD MP
       WHERE MP.CODEMPRM=:ICODEMPRM AND MP.CODFILIALRM=:SCODFILIALRM
         AND MP.CODRMA=:ICODRMA AND MP.CODITRMA=:SCODITRMA
       INTO  :ICODEMP, :SCODFILIAL, :ICODMOVPROD;

  suspend;
end ^

ALTER PROCEDURE EQMOVPRODSEQSP (ICODEMP INTEGER)
RETURNS (SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER)
AS 

begin
  /* Busca o cdigo sequencial da tabela eqmovprod */
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP, 'EQMOVPROD') INTO :SCODFILIAL ;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP, :SCODFILIAL, 'MP' ) INTO :ICODMOVPROD ;
  suspend;
end ^

ALTER PROCEDURE EQMOVPRODSLDSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODMOVPROD INTEGER,
ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
DDTMOVPROD DATE,
NCUSTOMPMMOVPROD NUMERIC(15, 3))
RETURNS (NSALDO NUMERIC(15, 3),
NCUSTOMPM NUMERIC(15, 3),
ICODMOVPRODSLD INTEGER)
AS 

begin
  /* Procedure que busca saldo e custo mdio */
  NSALDO = 0;
  NCUSTOMPM = 0;
  if (NCUSTOMPMMOVPROD IS NULL) then
     NCUSTOMPMMOVPROD = 0;
  if (ICODMOVPROD IS NULL) then
     SELECT FIRST 1 M.SLDMOVPROD, M.CUSTOMPMMOVPROD, M.CODMOVPROD
        FROM EQMOVPROD M
        WHERE M.CODEMPPD = :ICODEMPPD AND
          M.CODFILIALPD = :SCODFILIALPD AND
          M.CODPROD = :ICODPROD AND
          M.DTMOVPROD <= :DDTMOVPROD
        ORDER BY M.DTMOVPROD DESC, M.CODMOVPROD DESC
        INTO :NSALDO, :NCUSTOMPM, :ICODMOVPRODSLD;
   else
     SELECT FIRST 1 M.SLDMOVPROD, M.CUSTOMPMMOVPROD, M.CODMOVPROD
        FROM EQMOVPROD M
        WHERE M.CODEMP = :ICODEMP AND
          M.CODFILIAL = :SCODFILIAL AND
          M.CODEMPPD = :ICODEMPPD AND
          M.CODFILIALPD = :SCODFILIALPD AND
          M.CODPROD = :ICODPROD AND
          ( (M.DTMOVPROD = :DDTMOVPROD AND M.CODMOVPROD < :ICODMOVPROD ) OR
            (M.DTMOVPROD < :DDTMOVPROD ) )
        ORDER BY M.DTMOVPROD DESC, M.CODMOVPROD DESC
        INTO :NSALDO, :NCUSTOMPM, :ICODMOVPRODSLD;
    if (NSALDO IS NULL) then
       NSALDO = 0;
    if (NCUSTOMPM IS NULL) then
       NCUSTOMPM = NCUSTOMPMMOVPROD;
  suspend;
end ^

ALTER PROCEDURE EQMOVPRODUSP (ICODEMPPD INTEGER,
SCODFILIALPD SMALLINT,
ICODPROD INTEGER,
ICODEMPLE INTEGER,
SCODFILIALLE SMALLINT,
CCODLOTE CHAR(13) CHARACTER SET NONE,
ICODEMPTM INTEGER,
SCODFILIALTM SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPIV INTEGER,
SCODFILIALIV SMALLINT,
ICODINVPROD INTEGER,
ICODEMPCP INTEGER,
SCODFILIALCP SMALLINT,
ICODCOMPRA INTEGER,
SCODITCOMPRA SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
SCODITVENDA SMALLINT,
ICODEMPRM INTEGER,
SCODFILIALRM SMALLINT,
ICODRMA INTEGER,
SCODITRMA SMALLINT,
ICODEMPNT INTEGER,
SCODFILIALNT SMALLINT,
CCODNAT CHAR(4) CHARACTER SET NONE,
DDTMOVPROD DATE,
IDOCMOVPROD INTEGER,
CFLAG CHAR(1) CHARACTER SET NONE,
NQTDMOVPROD NUMERIC(15, 3),
NPRECOMOVPROD NUMERIC(15, 3))
AS 

DECLARE VARIABLE ICODEMP INTEGER;
DECLARE VARIABLE SCODFILIAL SMALLINT;
DECLARE VARIABLE ICODMOVPROD INTEGER;
DECLARE VARIABLE NSLDPRC NUMERIC(15,3);
DECLARE VARIABLE NCUSTOMPMPRC NUMERIC(15,3);
DECLARE VARIABLE NSLDLC NUMERIC(15,3);
DECLARE VARIABLE NCUSTOMPMLC NUMERIC(15,3);
DECLARE VARIABLE DDTMOVPRODOLD DATE;
DECLARE VARIABLE NPRECOMOVPRODOLD NUMERIC(15,3);
DECLARE VARIABLE NQTDMOVPRODOLD NUMERIC(15,3);
DECLARE VARIABLE ICODEMPTMOLD INTEGER;
DECLARE VARIABLE SCODFILIALTMOLD SMALLINT;
DECLARE VARIABLE ICODTIPOMOVOLD INTEGER;
DECLARE VARIABLE CALTTM CHAR(1);
DECLARE VARIABLE DDTPRC DATE;
DECLARE VARIABLE DDTPRCATE DATE;
DECLARE VARIABLE CESTOQMOVPROD CHAR(1);
DECLARE VARIABLE SOPERADOR SMALLINT;
begin
  /* Procedure de atualizao da tabela eqmovprod */

  DDTPRCATE = NULL; -- At onde deve ser processando o estoque

  SOPERADOR = 0; -- Pe o status do operador em modo zero

  -- localiza movprod

  SELECT ICODEMP, SCODFILIAL, ICODMOVPROD
    FROM EQMOVPRODRETCODSP(:ICODEMPIV, :SCODFILIALIV, :ICODINVPROD, :ICODEMPCP,
      :SCODFILIALCP, :ICODCOMPRA, :SCODITCOMPRA, :ICODEMPVD, :SCODFILIALVD,
      :CTIPOVENDA, :ICODVENDA, :SCODITVENDA, :ICODEMPRM, :SCODFILIALRM,
      :ICODRMA, :SCODITRMA)
    INTO :ICODEMP, :SCODFILIAL, :ICODMOVPROD;

  -- traz valores antigos
  SELECT MP.CODEMPTM, MP.CODFILIALTM, MP.CODTIPOMOV, MP.DTMOVPROD,
       MP.PRECOMOVPROD, MP.QTDMOVPROD  FROM EQMOVPROD MP
     WHERE MP.CODEMP=:ICODEMP AND MP.CODFILIAL=:SCODFILIAL AND MP.CODMOVPROD=:ICODMOVPROD
     INTO :ICODEMPTMOLD, :SCODFILIALTMOLD, :ICODTIPOMOVOLD, :DDTMOVPRODOLD,
       :NPRECOMOVPRODOLD, :NQTDMOVPRODOLD;

   -- abaixo verificao se a alterao de tipo de movimento mexe no estoque
   SELECT CALTTM FROM EQMOVPRODCKUTMSP(:ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV,
      :ICODEMPTMOLD, :SCODFILIALTMOLD, :ICODTIPOMOVOLD) INTO :CALTTM;


   -- verifica se h relevncia para reprocessamento
   if ( (DDTMOVPROD!=DDTMOVPRODOLD) OR (CALTTM='S') OR
        (NPRECOMOVPROD!=NPRECOMOVPRODOLD) OR (NQTDMOVPROD!=NQTDMOVPRODOLD) ) then
   begin
      if ( DDTMOVPRODOLD IS NULL) then
         DDTMOVPRODOLD = DDTMOVPROD; -- garantir que a data antiga no e nula;
      -- verifica qual data  menor para reprocessamento
      if ( DDTMOVPROD<=DDTMOVPRODOLD ) then
      begin
          DDTPRC = DDTMOVPROD;
          -- verifica lanamento anterior e traz custo e saldo
          SELECT NSALDO, NCUSTOMPM
             FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
             :SCODFILIALPD, :ICODPROD, :DDTPRC, :NPRECOMOVPROD)
             INTO :NSLDPRC, :NCUSTOMPMPRC ;

          -- verifica se havera mudana de saldo
          SELECT NSALDO, NCUSTOMPM, CESTOQMOVPROD, SOPERADOR
              FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
              :ICODTIPOMOV, :NQTDMOVPROD, :NPRECOMOVPROD, :NCUSTOMPMPRC, :NSLDPRC)
              INTO :NSLDPRC, :NCUSTOMPMPRC, :CESTOQMOVPROD, :SOPERADOR;

          NCUSTOMPMLC = NCUSTOMPMPRC;
          NSLDLC = NSLDPRC;
      end
      else
      begin
          DDTPRC = DDTMOVPRODOLD;
          DDTPRCATE = DDTMOVPROD;
          -- verifica lanamento anterior e traz custo e saldo
          SELECT NSALDO, NCUSTOMPM
             FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
             :SCODFILIALPD, :ICODPROD, :DDTPRC, 0)
             INTO :NSLDPRC, :NCUSTOMPMPRC ;

          -- verifica lanamento anterior e traz custo e saldo
          SELECT NSALDO, NCUSTOMPM
             FROM EQMOVPRODSLDSP(:ICODEMP, :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
             :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, :NCUSTOMPMLC)
             INTO :NSLDLC, :NCUSTOMPMLC ;

          -- verifica se havera mudana de saldo
          SELECT NSALDO, NCUSTOMPM, CESTOQMOVPROD
              FROM EQMOVPRODCSLDSP(:ICODEMPTM, :SCODFILIALTM,
              :ICODTIPOMOV, (:NQTDMOVPROD-:NQTDMOVPRODOLD), :NPRECOMOVPROD, :NCUSTOMPMLC, :NSLDLC)
              INTO :NSLDLC, :NCUSTOMPMLC, :CESTOQMOVPROD;

      end

      -- REPROCESSAR ESTOQUE

      EXECUTE PROCEDURE EQMOVPRODPRCSLDSP( :SCODFILIAL, :ICODMOVPROD, :ICODEMPPD,
        :SCODFILIALPD, :ICODPROD, :DDTPRC, :DDTPRCATE, :NSLDPRC,
        :NCUSTOMPMPRC);


      -- ATUALIZA CUSTO NO CADASTRO DE PRODUTOS

    --  EXECUTE PROCEDURE EQMOVPRODATCUSTSP( :SOPERADOR, :ICODEMP, :SCODFILIAL,
      --   :ICODMOVPROD, :SCODFILIALPD, :ICODPROD, :DDTMOVPROD, :NCUSTOMPMLC);

       -- faz update  (Obs. o update tem que ser a ltima tarefa por questes de
          -- ndice

      UPDATE EQMOVPROD SET DTMOVPROD=:DDTMOVPROD,
         QTDMOVPROD=:NQTDMOVPROD, PRECOMOVPROD=:NPRECOMOVPROD,
         SLDMOVPROD=:NSLDLC, CUSTOMPMMOVPROD=:NCUSTOMPMLC,
         FLAG=:CFLAG, CODEMPNT=:ICODEMPNT, CODFILIALNT=:SCODFILIALNT,
         CODNAT=:CCODNAT, DOCMOVPROD=:IDOCMOVPROD, CODEMPTM=:ICODEMPTM,
         CODFILIALTM=:SCODFILIALTM, CODTIPOMOV=:ICODTIPOMOV, CODEMPLE=:ICODEMPLE,
         CODFILIALLE=:SCODFILIALLE, CODLOTE=:CCODLOTE, ESTOQMOVPROD=:CESTOQMOVPROD
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODMOVPROD=:ICODMOVPROD;

   end
   else -- caso no tenha nenhuma alterao relevnte para processamento
      UPDATE EQMOVPROD SET FLAG=:CFLAG, CODEMPNT=:ICODEMPNT, CODFILIALNT=:SCODFILIALNT,
         CODNAT=:CCODNAT, DOCMOVPROD=:IDOCMOVPROD, CODEMPTM=:ICODEMPTM,
         CODFILIALTM=:SCODFILIALTM, CODTIPOMOV=:ICODTIPOMOV, CODEMPLE=:ICODEMPLE,
         CODFILIALLE=:SCODFILIALLE, CODLOTE=:CCODLOTE
        WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODMOVPROD=:ICODMOVPROD;
   suspend;
end ^

ALTER PROCEDURE EQREFPRODSP (CODEMP INTEGER,
CODFILIAL SMALLINT,
CODPROD INTEGER)
RETURNS (REFPROD CHAR(13) CHARACTER SET NONE)
AS 

begin
  /* Procedure Text */
  SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=:CODPROD AND
     CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL INTO :REFPROD;
  suspend;
end ^

ALTER PROCEDURE EQRELDEMANDASP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
SCODFILIALPD SMALLINT,
DDTINI DATE,
DDTFIM DATE)
RETURNS (CODMARCA CHAR(6) CHARACTER SET NONE,
CODGRUP CHAR(14) CHARACTER SET NONE,
CODPROD INTEGER,
REFPROD CHAR(13) CHARACTER SET NONE,
DESCPROD CHAR(50) CHARACTER SET NONE,
DESCGRUP CHAR(50) CHARACTER SET NONE,
SLDINI NUMERIC(15, 3),
VLRCOMPRAS NUMERIC(15, 3),
VLRDEVENT NUMERIC(15, 3),
VLROUTENT NUMERIC(15, 3),
VLRVENDAS NUMERIC(15, 3),
VLRDEVSAI NUMERIC(15, 3),
VLROUTSAI NUMERIC(15, 3),
SLDFIM NUMERIC(15, 3))
AS 

begin
  /* Stored procedure de relatrio de demanda */
  FOR SELECT P.CODMARCA, P.CODGRUP,P.CODPROD,
     P.REFPROD, P.DESCPROD,G.DESCGRUP,
     (SELECT FIRST 1 SLDMOVPROD FROM EQMOVPROD MP
      WHERE MP.CODEMP=:ICODEMP AND MP.CODFILIAL=:SCODFILIAL AND
         MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
         MP.CODPROD=P.CODPROD AND MP.DTMOVPROD<:DDTINI
         ORDER BY MP.DTMOVPROD DESC, MP.CODMOVPROD DESC ) SLDINI,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV IN ('CP','PC') AND TM.ESTIPOMOV = 'E') VLRCOMPRAS,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV ='DV' AND TM.ESTIPOMOV = 'E') VLRDEVENT,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP , EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV NOT IN ('CP','PC','DV') AND TM.ESTIPOMOV IN ('E','I')) VLROUTENT,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV IN ('VD','PV') AND TM.ESTIPOMOV = 'S') VLRVENDAS,
     (SELECT SUM(MP.QTDMOVPROD)
         FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV ='DV' AND TM.ESTIPOMOV = 'S') VLRDEVSAI,
     (SELECT SUM(MP.QTDMOVPROD)
        FROM EQMOVPROD MP, EQTIPOMOV TM
         WHERE TM.CODEMP=MP.CODEMPTM AND TM.CODFILIAL=MP.CODFILIALTM AND
           TM.CODTIPOMOV=MP.CODTIPOMOV AND MP.CODPROD=P.CODPROD AND
           MP.CODEMPPD=P.CODEMP AND MP.CODFILIALPD=P.CODFILIAL AND
           MP.DTMOVPROD BETWEEN :DDTINI AND :DDTFIM AND MP.ESTOQMOVPROD='S' AND
           TM.TIPOMOV NOT IN ('VD','PV','DV') AND TM.ESTIPOMOV = 'S') VLROUTSAI
     FROM EQPRODUTO P, EQGRUPO G
         WHERE G.CODGRUP=P.CODGRUP AND G.CODEMP=P.CODEMPGP AND
           G.CODFILIAL=P.CODFILIALGP AND P.CODEMP=:ICODEMP AND
           P.CODFILIAL=:SCODFILIALPD AND P.ATIVOPROD='S'
     INTO :CODMARCA, :CODGRUP, :CODPROD, :REFPROD, :DESCPROD, :DESCGRUP,
        :SLDINI, :VLRCOMPRAS, :VLRDEVENT,  :VLROUTENT,
         :VLRVENDAS, :VLRDEVSAI, :VLROUTSAI DO
     BEGIN
        if (SLDINI IS NULL) then
           SLDINI = 0;
        if (VLROUTSAI IS NULL) then
           VLROUTSAI = 0;
        if (VLROUTENT IS NULL) then
           VLROUTENT = 0;
        if (VLRDEVSAI IS NULL) then
           VLRDEVSAI = 0;
        if (VLRDEVENT IS NULL) then
           VLRDEVENT = 0;
        if (VLRCOMPRAS IS NULL) then
           VLRCOMPRAS = 0;
        if (VLRVENDAS IS NULL) then
           VLRVENDAS = 0;
        SLDFIM = SLDINI + VLRCOMPRAS + VLRDEVENT + VLROUTENT -
           VLRVENDAS - VLRDEVSAI - VLROUTSAI;
        suspend;
     END
end ^

ALTER PROCEDURE EQRELINVPRODSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
CTIPOCUSTO CHAR(1) CHARACTER SET NONE,
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14) CHARACTER SET NONE,
DDTESTOQ DATE)
RETURNS (CODPROD INTEGER,
REFPROD CHAR(13) CHARACTER SET NONE,
DESCPROD CHAR(50) CHARACTER SET NONE,
CODGRUP CHAR(14) CHARACTER SET NONE,
SALDO NUMERIC(15, 3),
CUSTO NUMERIC(15, 3),
VLRESTOQ NUMERIC(15, 4))
AS 

DECLARE VARIABLE NCUSTOMPM NUMERIC(15,3);
begin
  /* Relatrio de estoque */
  if (CCODGRUP IS NOT NULL) then
  begin
     CCODGRUP = rtrim(CCODGRUP);
     if (strlen(CCODGRUP)<14) then
        CCODGRUP = CCODGRUP || '%';
  end
  FOR SELECT P.CODPROD, P.REFPROD, P.DESCPROD, P.CODGRUP
    FROM EQPRODUTO P
    WHERE P.CODEMP=:ICODEMP AND P.CODFILIAL=:SCODFILIAL AND
          ( ( :CCODGRUP IS NULL ) OR
            (P.CODGRUP LIKE :CCODGRUP AND P.CODEMPGP=:ICODEMPGP AND
             P.CODFILIALGP=:SCODFILIALGP) )
    INTO :CODPROD, :REFPROD, :DESCPROD, :CODGRUP DO
  BEGIN
     SELECT NSALDO, NCUSTOMPM FROM EQMOVPRODSLDSP(null, null, null, :ICODEMP,
        :SCODFILIAL, :CODPROD, :DDTESTOQ, 0)
       INTO :SALDO, :NCUSTOMPM;
     if (CTIPOCUSTO='M') then
        CUSTO = NCUSTOMPM;
     else
        SELECT NCUSTOPEPS FROM EQCALCPEPSSP(:ICODEMP, :SCODFILIAL, :CODPROD,
          :SALDO, :DDTESTOQ)
        INTO :CUSTO;
     VLRESTOQ = CUSTO * SALDO;
     SUSPEND;
  END
end ^

ALTER PROCEDURE EQRELPEPSSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
DTESTOQ DATE,
ICODEMPMC INTEGER,
SCODFILIALMC SMALLINT,
CCODMARCA CHAR(6) CHARACTER SET NONE,
ICODEMPGP INTEGER,
SCODFILIALGP SMALLINT,
CCODGRUP CHAR(14) CHARACTER SET NONE)
RETURNS (CODPROD INTEGER,
REFPROD CHAR(13) CHARACTER SET NONE,
DESCPROD CHAR(50) CHARACTER SET NONE,
SLDPROD NUMERIC(15, 3),
CUSTOUNIT NUMERIC(15, 3),
CUSTOTOT NUMERIC(15, 3))
AS 

begin
  /* Procedure Text */
  IF (ICODEMPGP IS NOT NULL) THEN
  BEGIN
    IF (STRLEN(RTRIM(CCODGRUP))<14) THEN
       CCODGRUP = RTRIM(CCODGRUP)||'%';
  END

  FOR SELECT P.CODPROD,P.REFPROD,P.DESCPROD,
     (SELECT FIRST 1 M.SLDMOVPROD
     FROM EQMOVPROD M
     WHERE M.CODEMPPD=P.CODEMP AND
           M.CODFILIAL=P.CODFILIAL AND
           M.CODPROD=P.CODPROD AND
           M.DTMOVPROD<=:DTESTOQ
     ORDER BY P.CODPROD, M.DTMOVPROD DESC , M.CODMOVPROD DESC
     )
   FROM EQPRODUTO P
   WHERE P.CODEMP = :ICODEMP AND P.CODFILIAL = :SCODFILIAL AND
   ( (:ICODEMPMC IS NULL) OR (P.CODEMPMC=:ICODEMPMC AND P.CODFILIALMC=:SCODFILIALMC AND
      P.CODMARCA=:CCODMARCA) ) AND
   ((:ICODEMPGP IS NULL) OR (P.CODEMPGP=:ICODEMPGP AND P.CODFILIALGP=:SCODFILIALGP AND
      P.CODGRUP LIKE :CCODGRUP) )
   INTO :CODPROD, :REFPROD, :DESCPROD, :SLDPROD DO
  BEGIN
     CUSTOUNIT = 0;
     CUSTOTOT = 0;
     IF (SLDPROD IS NULL) THEN
        SLDPROD = 0;
     IF (SLDPROD!=0) THEN
     BEGIN
         SELECT NCUSTOPEPS FROM EQCALCPEPSSP(:ICODEMP,:SCODFILIAL,:CODPROD,:SLDPROD,:DTESTOQ)
            INTO :CUSTOUNIT;
         IF (CUSTOUNIT!=0) THEN
         BEGIN
            CUSTOTOT = CUSTOUNIT*SLDPROD;
         END
     END
     SUSPEND;
  END
end ^

ALTER PROCEDURE FNADICITRECEBERSP01 (CALTVLR CHAR(1) CHARACTER SET NONE,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRDESCITREC NUMERIC(15, 3),
NVLRMULTAITREC NUMERIC(15, 3),
NVLRJUROSITREC NUMERIC(15, 3),
NVLRPARCITREC NUMERIC(15, 3),
NVLRPAGOITREC NUMERIC(15, 3),
DDTITREC DATE,
DDTVENCITREC DATE,
CSTATUSITREC CHAR(2) CHARACTER SET NONE,
CFLAG CHAR(1) CHARACTER SET NONE,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3) CHARACTER SET NONE,
NVLRCOMIITREC NUMERIC(15, 3))
AS 

DECLARE VARIABLE INPARCITRECOLD INTEGER;
begin
   SELECT IR.NPARCITREC FROM FNITRECEBER IR WHERE IR.CODEMP=:ICODEMP AND
     IR.CODFILIAL=:SCODFILIAL AND IR.CODREC=:ICODREC AND
     IR.NPARCITREC=:INPARCITREC INTO :INPARCITRECOLD;

   IF (INPARCITRECOLD IS NULL) THEN
     /* Faz insero na tabela de parcelas do contas a receber */
       INSERT INTO FNITRECEBER (CODEMP,CODFILIAL,CODREC,NPARCITREC,VLRDESCITREC,VLRMULTAITREC,
              VLRJUROSITREC,VLRPARCITREC,VLRPAGOITREC,DTITREC,DTVENCITREC,
              STATUSITREC,FLAG,CODEMPBO,CODFILIALBO,CODBANCO,VLRCOMIITREC)
              VALUES
             (:ICODEMP,:SCODFILIAL,:ICODREC,:INPARCITREC,:NVLRDESCITREC,:NVLRMULTAITREC,
             :NVLRJUROSITREC,:NVLRPARCITREC,:NVLRPAGOITREC, :DDTITREC,:DDTVENCITREC,
             :CSTATUSITREC,:CFLAG,:ICODEMPBO,:SCODFILIALBO,:CCODBANCO,:NVLRCOMIITREC);
   ELSE
   BEGIN
       IF (CALTVLR='S') THEN -- Flag que indica se  para mudar os valores do contas areceber
           UPDATE FNITRECEBER SET ALTUSUITREC='N',VLRDESCITREC=:NVLRDESCITREC,VLRMULTAITREC=:NVLRMULTAITREC,
                  VLRJUROSITREC=:NVLRJUROSITREC,VLRPARCITREC=:NVLRPARCITREC,
                  VLRPAGOITREC=:NVLRPAGOITREC,DTITREC=:DDTITREC,STATUSITREC=:CSTATUSITREC,
                  FLAG=:CFLAG,CODEMPBO=:ICODEMPBO,CODFILIALBO=:SCODFILIALBO,
                  CODBANCO=:CCODBANCO,VLRCOMIITREC=:NVLRCOMIITREC
            WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODREC=:ICODREC AND
                NPARCITREC=:INPARCITREC;
       ELSE
           UPDATE FNITRECEBER SET ALTUSUITREC='N',DTITREC=:DDTITREC,
                  STATUSITREC=:CSTATUSITREC, FLAG=:CFLAG,CODEMPBO=:ICODEMPBO,
                  CODFILIALBO=:SCODFILIALBO,CODBANCO=:CCODBANCO,
                  VLRCOMIITREC=:NVLRCOMIITREC
            WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND CODREC=:ICODREC AND
                NPARCITREC=:INPARCITREC;
  END
  suspend;
end ^

ALTER PROCEDURE FNADICLANCASP01 (ICODREC INTEGER,
INPARCITREC INTEGER,
SNUMCONTA CHAR(10) CHARACTER SET NONE,
ICODEMPCA INTEGER,
ICODFILIALCA INTEGER,
ICODCLI INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL INTEGER,
SCODPLAN CHAR(13) CHARACTER SET NONE,
ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
IANOCC INTEGER,
SCODCC CHAR(19) CHARACTER SET NONE,
ICODEMPCC INTEGER,
ICODFILIALCC INTEGER,
DDTPAGOITREC DATE,
SDOCLANCAITREC CHAR(10) CHARACTER SET NONE,
SOBSITREC CHAR(50) CHARACTER SET NONE,
DVLRPAGOITREC NUMERIC(18, 2),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 

DECLARE VARIABLE ICODLANCA INTEGER;
DECLARE VARIABLE SCODPLANCONTA CHAR(13);
DECLARE VARIABLE ICODEMPPCONTA INTEGER;
DECLARE VARIABLE ICODFILIALPCONTA INTEGER;
DECLARE VARIABLE CFLAG CHAR(1);
DECLARE VARIABLE IFILIALLANCA INTEGER;
DECLARE VARIABLE TIPOLANCA CHAR(1);
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNLANCA') INTO IFILIALLANCA;
  SELECT CODPLAN,CODEMPPN,CODFILIALPN FROM FNCONTA WHERE NUMCONTA = :SNUMCONTA
         AND CODEMP=:ICODEMPCA AND CODFILIAL=:ICODFILIALCA INTO :sCodPlanConta,:iCodEmpPConta,:iCodFilialPConta;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALLANCA,'LA') INTO ICODLANCA;
  SELECT FLAG FROM FNRECEBER WHERE CODREC=:ICODREC
         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :cFlag;

  IF (ICODCLI IS NULL) THEN
    TIPOLANCA = 'A';
  ELSE
    TIPOLANCA = 'C';

  INSERT INTO FNLANCA (TIPOLANCA,CODEMP,CODFILIAL,CODLANCA,CODEMPRC,CODFILIALRC,CODREC,NPARCITREC,CODEMPPN,CODFILIALPN,CODPLAN,DATALANCA,DOCLANCA,
         HISTBLANCA,DTPREVLANCA,VLRLANCA,FLAG)
         VALUES (
                 :TIPOLANCA,:ICODEMP,:IFILIALLANCA,:iCodLanca,:ICODEMP,:ICODFILIAL,:ICODREC,:iNParcItRec,:iCodEmpPConta,:iCodFilialPConta,:sCodPlanConta,:dDtPagoItRec,
                 :sDocLancaItRec,:sObsItRec,:dDtPagoItRec,0,:cFlag
          );
  INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPCL,CODFILIALCL,CODCLI,CODEMPPN,CODFILIALPN,CODPLAN,CODEMPCC,CODFILIALCC,ANOCC,CODCC,ORIGSUBLANCA,DATASUBLANCA,DTPREVSUBLANCA,VLRSUBLANCA,FLAG)
         VALUES (
                :ICODEMP,:IFILIALLANCA,:iCodLanca,1,:ICODEMPCL,:ICODFILIALCL,:ICODCLI,:ICODEMPPN,:ICODFILIALPN,:SCODPLAN,:ICODEMPCC,:ICODFILIALCC,:IANOCC,:SCODCC,'S',:dDtPagoItRec,:dDtPagoItRec,:dVlrPagoItRec*-1,:cFlag
         );
END ^

ALTER PROCEDURE FNADICLANCASP02 (ICODPAG INTEGER,
INPARCPAG INTEGER,
SNUMCONTA CHAR(10) CHARACTER SET NONE,
ICODEMPCA INTEGER,
ICODFILIALCA INTEGER,
ICODFOR INTEGER,
ICODEMPFR INTEGER,
ICODFILIALFR INTEGER,
SCODPLAN CHAR(13) CHARACTER SET NONE,
ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
IANOCC INTEGER,
SCODCC CHAR(19) CHARACTER SET NONE,
ICODEMPCC INTEGER,
ICODFILIALCC INTEGER,
DDTPAGOITPAG DATE,
SDOCLANCAITPAG CHAR(10) CHARACTER SET NONE,
SOBSITPAG CHAR(50) CHARACTER SET NONE,
DVLRPAGOITPAG NUMERIC(15, 2),
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 

DECLARE VARIABLE iCodLanca INTEGER;
  DECLARE VARIABLE sCodPlanConta CHAR(13);
  DECLARE VARIABLE iCodEmpPConta INTEGER;
  DECLARE VARIABLE iCodFilialPConta INTEGER;
  DECLARE VARIABLE cFlag CHAR(1);
  DECLARE VARIABLE IFILIALLANCA INTEGER;
  DECLARE VARIABLE TIPOLANCA CHAR;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNLANCA') INTO IFILIALLANCA;
  SELECT CODPLAN,CODEMP,CODFILIAL FROM FNCONTA WHERE NUMCONTA=:sNumConta
         AND CODEMP=:ICODEMPCA AND CODFILIAL=:ICODFILIALCA INTO :sCodPlanConta,:iCodEmpPConta,:iCodFilialPConta;
  SELECT ISEQ FROM SPGERANUM(:iCODEMP,:IFILIALLANCA,'LA') INTO :iCodLanca;
  SELECT FLAG FROM FNPAGAR WHERE CODPAG=:iCodPag
         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :cFlag;

  IF (ICODFOR IS NULL) THEN
    TIPOLANCA = 'A';
  ELSE
    TIPOLANCA = 'F';

  INSERT INTO FNLANCA (TIPOLANCA,CODEMP,CODFILIAL,CODLANCA,CODEMPPG,CODFILIALPG,CODPAG,NPARCPAG,CODEMPPN,CODFILIALPN,CODPLAN,DATALANCA,DOCLANCA,
         HISTBLANCA,DTPREVLANCA,VLRLANCA,FLAG)
         VALUES (
                :TIPOLANCA,:ICODEMP,:IFILIALLANCA,:iCodLanca,:ICODEMP,:ICODFILIAL,:iCodPag,:iNParcPag,:iCodEmpPConta,:iCodFilialPConta,:sCodPlanConta,:dDtPagoItPag,
                :sDocLancaItPag,:sObsItPag,:dDtPagoItPag,0,:cFlag
         );
  INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPFR,CODFILIALFR,CODFOR,CODEMPPN,CODFILIALPN,CODPLAN,CODEMPCC,CODFILIALCC,ANOCC,CODCC,ORIGSUBLANCA,DATASUBLANCA,DTPREVSUBLANCA,VLRSUBLANCA,FLAG)
         VALUES (:ICODEMP,:IFILIALLANCA,:iCodLanca,1,:ICODEMPFR,:ICODFILIALFR,:ICODFOR,:ICODEMPPN,:ICODFILIALPN,:sCodplan,:ICODEMPCC,:ICODFILIALCC,:IANOCC,:SCODCC,'E',:dDtPagoItPag,:dDtPagoItPag,:dVlrPagoItPag,:cFlag);
END ^

ALTER PROCEDURE FNADICPAGARSP01 (CODCOMPRA INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
ICODEMPFR INTEGER,
ICODFILIALFR SMALLINT,
CODFOR INTEGER,
VLRLIQCOMPRA NUMERIC(18, 2),
DTSAIDACOMPRA DATE,
DOCCOMPRA INTEGER,
ICODEMPBO INTEGER,
ICODFILIALBO SMALLINT,
CODBANCO CHAR(3) CHARACTER SET NONE,
FLAG CHAR(1) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 

DECLARE VARIABLE ICODPAGAR INTEGER;
  DECLARE VARIABLE IFILIALPAGAR INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNPAGAR') INTO IFILIALPAGAR;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALPAGAR,'PA') INTO ICODPAGAR;
  INSERT INTO FNPAGAR (CODEMP,CODFILIAL,CODPAG,CODPLANOPAG,CODEMPPG,CODFILIALPG,CODFOR,CODEMPFR,CODFILIALFR,CODCOMPRA,CODEMPCP,CODFILIALCP,VLRPAG,
                      VLRDESCPAG,VLRMULTAPAG,VLRJUROSPAG,VLRPARCPAG,VLRPAGOPAG,
                      VLRAPAGPAG,DATAPAG,STATUSPAG,DOCPAG,CODBANCO,CODEMPBO,CODFILIALBO,FLAG)
                      VALUES (
                             :ICODEMP,:IFILIALPAGAR,:ICODPAGAR,:CodPlanoPag,:ICODEMPPG,:ICODFILIALPG,:CodFor,:ICODEMPFR,:ICODFILIALFR,:CodCompra,:ICODEMP,:ICODFILIAL,:VlrLiqCompra,
                             0,0,0,:VlrLiqCompra,0,:VlrLiqCompra,:dtSaidaCompra,'P1',:DocCompra,
                             :CodBanco,:ICODEMPBO,:ICODFILIALBO,:FLAG
                      );
END ^

ALTER PROCEDURE FNADICRECEBERSP01 (CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
CODPLANOPAG INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL SMALLINT,
CODCLI INTEGER,
ICODEMPVD INTEGER,
ICODFILIALVD SMALLINT,
CODVEND INTEGER,
VLRLIQVENDA NUMERIC(15, 2),
DTSAIDAVENDA DATE,
VLRCOMISVENDA NUMERIC(15, 3),
DOCVENDA INTEGER,
ICODEMPBO INTEGER,
ICODFILIALBO SMALLINT,
CODBANCO CHAR(3) CHARACTER SET NONE,
FLAG CHAR(1) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 

DECLARE VARIABLE ICODREC INTEGER;
DECLARE VARIABLE SCODFILIALRC SMALLINT;
BEGIN
  SELECT R.CODREC,R.CODFILIAL FROM FNRECEBER R
     WHERE R.CODEMPVA=:ICODEMP AND R.CODFILIALVA=:ICODFILIAL AND
       R.TIPOVENDA=:CTIPOVENDA AND R.CODVENDA=:ICODVENDA
     INTO :ICODREC,:SCODFILIALRC;

  IF (ICODREC IS NULL) THEN
  BEGIN
     SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNRECEBER') INTO SCODFILIALRC;
     SELECT ISEQ FROM SPGERANUM(:ICODEMP,:SCODFILIALRC,'RC') INTO :ICODREC;

     INSERT INTO FNRECEBER (CODEMP,CODFILIAL,CODREC,CODPLANOPAG,CODEMPPG,CODFILIALPG,CODCLI,
              CODEMPCL,CODFILIALCL,CODVEND,CODEMPVD,CODFILIALVD,TIPOVENDA,CODVENDA,
              CODEMPVA,CODFILIALVA,VLRREC,
              VLRDESCREC,VLRMULTAREC,VLRJUROSREC,VLRPARCREC,VLRPAGOREC,
              VLRAPAGREC,DATAREC,STATUSREC,VLRCOMIREC,DOCREC,CODBANCO,CODEMPBO,CODFILIALBO,FLAG)
              VALUES (
                     :ICODEMP,:SCODFILIALRC,:ICODREC,:CodPlanoPag,:ICODEMPPG,:ICODFILIALPG,:CodCli,
                     :ICODEMPCL,:ICODFILIALCL,:CodVend,:ICODEMPVD,:ICODFILIALVD,:CTIPOVENDA,:ICodVenda,
                     :ICODEMP,:ICODFILIAL,:VlrLiqVenda,
                     0,0,0,:VlrLiqVenda,0,:VlrLiqVenda,:dtSaidaVenda,'R1',
                     :VlrComisVenda,:DocVenda,:CodBanco,:ICODEMPBO,:ICODFILIALBO,:FLAG
              );
  END
  ELSE
  BEGIN
    UPDATE FNRECEBER SET ALTUSUREC='N',CODPLANOPAG=:CodPlanoPag,
              CODEMPPG=:ICODEMPPG,CODFILIALPG=:ICODFILIALPG,CODCLI=:CodCli,
              CODEMPCL=:ICODEMPCL,CODFILIALCL=:ICODFILIALCL,
              CODVEND=:CodVend,CODEMPVD=:ICODEMPVD,CODFILIALVD=:ICODFILIALVD,
              VLRREC=:VlrLiqVenda,VLRDESCREC=0,VLRMULTAREC=0,VLRJUROSREC=0,
              VLRPARCREC=:VlrLiqVenda,VLRPAGOREC=0,VLRAPAGREC=:VlrLiqVenda,
              DATAREC=:dtSaidaVenda,STATUSREC='R1',VLRCOMIREC=:VlrComisVenda,
              DOCREC=:DocVenda,CODBANCO=:CodBanco,CODEMPBO=:ICODEMPBO,
              CODFILIALBO=:ICODFILIALBO,FLAG=:FLAG
         WHERE CODREC=:ICODREC AND CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIALRC;
    UPDATE FNITRECEBER SET ALTUSUITREC='S' -- Atualiza os itens de contas a
    --receber para ajustar automaticamente os valores no cabealho
         WHERE CODREC=:ICODREC AND CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIALRC;
   END

END ^

ALTER PROCEDURE FNCHECAPGTOSP (ICODCLI INTEGER,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
RETURNS (SRETORNO CHAR(1) CHARACTER SET NONE)
AS 

DECLARE VARIABLE iLinhas INTEGER;
DECLARE VARIABLE IFILIALRECEBER INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNRECEBER') INTO IFILIALRECEBER;
  SELECT COUNT(*) FROM FNITRECEBER IT WHERE CODREC
         IN (
            SELECT CODREC FROM FNRECEBER REC WHERE REC.CODCLI = :iCodCli
                   AND REC.CODEMPCL=:ICODEMP AND REC.CODFILIALCL=:ICODFILIAL
                   AND REC.CODREC = IT.CODREC
                   AND CODEMP=IT.CODEMP AND CODFILIAL=IT.CODFILIAL
         )
         AND STATUSITREC != 'RP'
         AND IT.CODEMP=:ICODEMP AND IT.CODFILIAL=:IFILIALRECEBER INTO iLinhas;
  IF (iLinhas > 0) THEN
    sRetorno = 'N';
  ELSE
    sRetorno = 'S';
  SUSPEND;
END ^

ALTER PROCEDURE FNDELETARECEBERSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER)
RETURNS (SDELETADO SMALLINT)
AS 

DECLARE VARIABLE ICONTADOR INTEGER;
begin
  /* Procedure Text */
  SELECT COUNT(*) FROM FNRECEBER R, FNLANCA L
    WHERE R.CODVENDA=:ICODVENDA AND R.TIPOVENDA=:CTIPOVENDA AND
     R.CODEMPVA=:ICODEMP AND R.CODFILIALVA=:SCODFILIAL AND
     L.CODEMPRC=R.CODEMP AND L.CODFILIALRC=R.CODFILIAL AND
     L.CODREC=R.CODREC
    INTO :ICONTADOR;
  IF (ICONTADOR IS NULL) THEN
     ICONTADOR = 0;
  IF (ICONTADOR=0) THEN
  BEGIN
     SDELETADO = 1;
     DELETE FROM FNRECEBER WHERE CODVENDA=:ICODVENDA AND TIPOVENDA=:CTIPOVENDA AND
       CODEMPVA=:ICODEMP AND CODFILIALVA=:SCODFILIAL;
  END
  ELSE
  BEGIN
     SDELETADO = 0;
  END
  suspend;
end ^

ALTER PROCEDURE FNGERAITRECEBERSP01 (CALTVLR CHAR(1) CHARACTER SET NONE,
ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
ICODEMPPG INTEGER,
SCODFILIALPG SMALLINT,
ICODPLANOPAG INTEGER,
NVLRREC NUMERIC(15, 3),
DDATAREC DATE,
CFLAG CHAR(1) CHARACTER SET NONE,
ICODEMPBO INTEGER,
SCODFILIALBO SMALLINT,
CCODBANCO CHAR(3) CHARACTER SET NONE,
NVLRCOMIREC NUMERIC(15, 3))
RETURNS (I INTEGER)
AS 

DECLARE VARIABLE NPERC NUMERIC(10,6);
DECLARE VARIABLE NPERCPAG NUMERIC(10,6);
DECLARE VARIABLE NRESTO NUMERIC(15,2);
DECLARE VARIABLE INUMPARC INTEGER;
DECLARE VARIABLE IDIASPAG INTEGER;
DECLARE VARIABLE NRESTOCOMI NUMERIC(15,2);
DECLARE VARIABLE NVLRCOMIITREC NUMERIC(15,3);
DECLARE VARIABLE NVLRITREC NUMERIC(15,3);
begin
  /* Procedure Text */
  i = 0;
  nPerc = 100.000000;
  nResto = nVLRREC;
  nRestoComi = nVLRCOMIREC;
  SELECT PARCPLANOPAG FROM FNPLANOPAG WHERE CODPLANOPAG=:iCODPLANOPAG
         AND CODEMP=:iCODEMPPG AND CODFILIAL = :sCODFILIALPG INTO :iNumParc;
  FOR SELECT PERCPAG,DIASPAG FROM FNPARCPAG WHERE CODPLANOPAG=:iCODPLANOPAG
             AND CODEMP=:iCODEMPPG AND CODFILIAL = :sCODFILIALPG ORDER BY DIASPAG
             INTO :nPercPag,:iDiasPag DO
  BEGIN
    i = i+1;
    nVlrItRec = cast(cast(nVLRREC*nPercPag as decimal(15,2))/nPerc as decimal(15,2));
    nResto = nResto-nVlrItRec;
    IF (i = iNumParc) THEN
    BEGIN
      nVlrItRec=nVlrItRec+nResto;
    END
    nVlrComiItRec = cast(cast(nVlrComiRec*nPercPag as decimal(15,2))/nPerc as decimal(15,2));
    nRestoComi = nRestoComi-nVlrComiItRec;
    if (i = iNumParc) then
    begin
      nVlrComiItRec = nVlrComiItRec+nRestoComi;
    end

    EXECUTE PROCEDURE fnadicitrecebersp01 (:cALTVLR, :iCODEMP,:sCODFILIAL,:iCODREC,:i,0,0,0,:nVlrItRec,0,
                            :dDATAREC,:dDATAREC+:iDiasPag,'R1',:cFLAG,:iCODEMPBO,:sCODFILIALBO,
                            :cCODBANCO,:NVLRCOMIITREC);
  END
  suspend;
end ^

ALTER PROCEDURE FNITRECEBERSP01 (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
NVLRPARCREC NUMERIC(15, 3),
NVLRCOMIREC NUMERIC(15, 3),
INROPARCREC INTEGER,
CCLASCOMIS CHAR(1) CHARACTER SET NONE)
AS 

DECLARE VARIABLE INPARCITREC INTEGER;
DECLARE VARIABLE NVLRPARCITREC NUMERIC(15,3);
DECLARE VARIABLE NPERC NUMERIC(10,6);
DECLARE VARIABLE NVLRCOMIITREC NUMERIC(15,3);
DECLARE VARIABLE NRESTO NUMERIC(15,3);
DECLARE VARIABLE DVENCITREC DATE;
begin
  /* Procedure que atualiza a comisso na tabela ITRECEBER */
  nResto = nVlrComiRec;
  FOR SELECT NPARCITREC,VLRPARCITREC,DTVENCITREC FROM FNITRECEBER WHERE CODEMP=:iCodEmp AND
          CODFILIAL=:sCodFilial AND CODREC=:iCodRec
          ORDER BY NPARCITREC
          INTO :iNParcItRec , :nVlrParcItRec, :dVencItRec DO
  BEGIN
     nPerc = nVlrParcItRec/nVlrParcRec;
     nVlrComiItRec = cast( (nVlrComiRec * nPerc) as Decimal(15,2) );
     nResto = nResto - nVlrComiItRec;
     IF (iNParcItRec=iNroParcRec) THEN
     BEGIN
        nVlrComiItRec = nVlrComiItRec + nResto;
     END
     UPDATE FNITRECEBER SET VLRCOMIITREC=:nVlrComiItRec WHERE CODEMP=:iCodEmp AND
          CODFILIAL=:sCodFilial AND CODREC=:iCodRec AND NPARCITREC=:iNParcItRec;
     IF (CCLASCOMIS='S') THEN
        EXECUTE PROCEDURE vdgeracomissaosp(:iCodEmp, :sCodFilial, :iCodRec,
           :iNParcItRec, :nVlrComiItRec, :dVencItRec);
  END
  suspend;
end ^

ALTER PROCEDURE FNLIBCREDSP (CODVENDA INTEGER,
CODCLI INTEGER,
CODEMPCL INTEGER,
CODFILIALCL INTEGER,
VLRLIB NUMERIC(18, 3))
AS 

DECLARE VARIABLE PREFCRED CHAR;
DECLARE VARIABLE CODFILIAL INTEGER;
DECLARE VARIABLE VLRTPCRED NUMERIC(15, 3);
DECLARE VARIABLE VLRAUTORIZ NUMERIC(15, 3);
DECLARE VARIABLE CODLIB INTEGER;
DECLARE VARIABLE IFILIALUS INTEGER;
DECLARE VARIABLE ECF CHAR;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMPCL,'FNLIBCRED') INTO CODFILIAL;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMPCL,'SGUSUARIO') INTO IFILIALUS;
  SELECT PREFCRED FROM SGPREFERE1 WHERE CODEMP=:CODEMPCL
    AND CODFILIAL=:CODFILIAL INTO PREFCRED;

  SELECT ECFCAIXA FROM PVCAIXA CX, SGCONEXAO CON WHERE
    CX.CODFILIAL=CON.CODFILIALSEL AND CX.CODEMP=CON.CODEMP AND
    CX.CODCAIXA=CON.CODTERM AND  CON.CODEMP=:CODEMPCL AND
    UPPER(CON.IDUSU)=UPPER(USER) AND CONECTADO > 0 INTO ECF;

  IF (PREFCRED = 'N' OR ECF='S') THEN /* No verificar */
    EXIT;
  ELSE IF (PREFCRED = 'L') THEN /*Liberar se no ultrapassar o crdito pr aprovado */
  BEGIN
    SELECT VLRTPCRED FROM FNTIPOCRED TC, VDCLIENTE CL
      WHERE CL.CODCLI=:CODCLI AND CL.CODEMP=:CODEMPCL
      AND CL.CODFILIAL=:CODFILIALCL AND TC.CODTPCRED=CL.CODTPCRED
      AND TC.CODEMP=CL.CODEMPTR AND TC.CODFILIAL=CL.CODFILIALTR
      AND CAST('today' AS DATE) <= CL.DTVENCTOTR INTO VLRTPCRED;

    IF (VLRTPCRED > 0) THEN
    BEGIN
      IF (VLRLIB IS NULL) THEN
        EXIT;
      ELSE IF (VLRLIB <= VLRTPCRED) THEN
        EXIT;
      ELSE
        EXCEPTION VDVENDAEX04; /*Valor pre-aprovado insuficiente*/
    END
    ELSE
    BEGIN
      /* Caso no seja possvel liberar por credito pr-aprovado ento verifica liberao*/
      PREFCRED = 'A';
    END
  END
  IF (PREFCRED = 'A') THEN /* Aguardar liberao */
  BEGIN
    SELECT VLRAUTORIZLCRED,CODLCRED FROM FNLIBCRED WHERE CODEMP=:CODEMPCL
      AND CODFILIAL=:CODFILIAL AND CODCLI=:CODCLI AND CODEMPCL=:CODEMPCL
      AND CODFILIALCL=:CODFILIALCL AND CODVENDA=:CODVENDA
      AND DTAVCTOLCRED >= CAST('today' AS DATE) INTO VLRAUTORIZ,CODLIB;
    IF (VLRAUTORIZ > 0) THEN
    BEGIN
      IF (VLRLIB IS NULL) THEN
        EXIT;
      ELSE IF (VLRLIB <= VLRAUTORIZ) THEN
        UPDATE FNLIBCRED SET VLRUTILLCRED=:VLRLIB,SITLCRED='L',
          IDUSU=lower(USER),CODEMPUS=:CODEMPCL,CODFILIALUS=:IFILIALUS,
          DTAUTILLCRED=CAST('today' AS DATE)
          WHERE CODLCRED=:CODLIB AND CODEMP=:CODEMPCL
          AND CODFILIAL=:IFILIALUS;
      ELSE
        EXCEPTION VDVENDAEX03; /*Valor liberado insuficiente*/
    END
    ELSE
      EXCEPTION VDVENDAEX02; /*Venda no foi liberada*/
  END
  SUSPEND;
END ^

ALTER PROCEDURE FNSALDOPLANSP (ICODEMPPN INTEGER,
ICODFILIALPN INTEGER,
SCODPLANANT CHAR(13) CHARACTER SET NONE,
DDATAANT DATE,
DVLRANT NUMERIC(15, 2),
SCODPLANATU CHAR(13) CHARACTER SET NONE,
DDATAATU DATE,
DVLRATU NUMERIC(15, 2))
RETURNS (SRETORNO CHAR(1) CHARACTER SET NONE)
AS 

DECLARE VARIABLE sCodPlan CHAR(13);
  DECLARE VARIABLE dDataSl DATE;
  DECLARE VARIABLE dTmp DATE;
  DECLARE VARIABLE dSaldoSl DECIMAL(15,2);
  DECLARE VARIABLE dSaldoSlAnt DECIMAL(15,2);
  DECLARE VARIABLE IFILIALSALDO INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMPPN,'FNSALDOLANCA') INTO IFILIALSALDO;
  IF (dVlrAnt IS NULL) THEN
     dVlrAnt = 0;
  IF (dVlrAtu IS NULL) THEN
     dVlrAtu = 0;
  IF ((sCodPlanAnt IS NOT NULL) AND (rtrim(sCodPlanAnt) != '')) THEN
  BEGIN
    SELECT CODPLAN,DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=:sCodPlanAnt
           AND DATASL =: dDataAnt AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
           AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN INTO sCodPlan,dDataSl,dSaldoSl;
    IF ((sCodPlan = sCodPlanAnt) AND (dDataSl = dDataAnt)) THEN
    BEGIN
      UPDATE FNSALDOLANCA SET SALDOSL =:dSaldoSl-:dVlrAnt WHERE CODPLAN=:sCodPlanAnt
             AND DATASL =:dDataAnt AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
             AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN;
      FOR SELECT DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=:sCodplanAnt
          AND DATASL >:dDataAnt AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
          AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN INTO :dTmp,:dSaldoSlAnt DO
      BEGIN
         if (:dSaldoSlAnt IS NULL) THEN
            dSaldoSlAnt = 0;
         UPDATE FNSALDOLANCA SET SALDOSL = :dSaldoSlAnt-:dVlrAnt WHERE CODPLAN=:sCodplanAnt
                AND DATASL =:dTmp AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
                AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN;
        SUSPEND;
      END
    END
    ELSE
    BEGIN
      SELECT SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=:sCodPlanAnt
             AND DATASL<:dDataAnt AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
             AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN INTO dSaldoSlAnt;
      IF (dSaldoSlAnt IS NULL) THEN
          dSaldoSlAnt = 0;
      INSERT INTO FNSALDOLANCA (CODEMP,CODFILIAL,CODPLAN,CODFILIALPN,CODEMPPN,DATASL,PREVSL,SALDOSL)
             VALUES (
                    :ICODEMPPN,:IFILIALSALDO,:sCodPlanAnt,:ICODEMPPN,:ICODFILIALPN,:dDataAnt,0,:dSaldoSlAnt-:dVlrAnt
             );
      FOR SELECT DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=:sCodplanAnt
                 AND DATASL >:dDataAnt AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
                 AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN INTO :dTmp,:dSaldoSlAnt DO
      BEGIN
        if (:dSaldoSlAnt IS NULL) THEN
           dSaldoSlAnt = 0;
        UPDATE FNSALDOLANCA SET SALDOSL = :dSaldoSlAnt-:dVlrAnt WHERE CODPLAN=:sCodplanAnt
               AND DATASL =:dTmp AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
               AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN;
        SUSPEND;
      END
    END
  END
  IF ( (sCodPlanAtu IS NOT NULL) AND (rtrim(sCodPlanAtu) != '')) THEN
  BEGIN
    SELECT CODPLAN,DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=:sCodPlanAtu
           AND DATASL =: dDataAtu AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
  AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN INTO sCodPlan,dDataSl,dSaldoSl;
    IF ((sCodPlan = sCodPlanAtu) AND (dDataSl = dDataAtu)) THEN
    BEGIN
      UPDATE FNSALDOLANCA SET SALDOSL =:dSaldoSl+:dVlrAtu WHERE CODPLAN=:sCodPlanAtu
             AND DATASL =:dDataAtu AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
             AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN;
      FOR SELECT DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=:sCodplanAtu
                 AND DATASL >:dDataAtu AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
                 AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN INTO :dTmp,:dSaldoSlAnt DO
      BEGIN
        if (:dSaldoSlAnt IS NULL) THEN
           dSaldoSlAnt = 0;
        UPDATE FNSALDOLANCA SET SALDOSL = :dSaldoSlAnt+:dVlrAtu WHERE CODPLAN=:sCodplanAtu
               AND DATASL =:dTmp AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
               AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN;
        SUSPEND;
      END
    END
    ELSE
    BEGIN
      SELECT SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=:sCodPlanAtu
             AND DATASL<:dDataAtu AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
             AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN INTO dSaldoSlAnt;
      IF (dSaldoSlAnt IS NULL) THEN
          dSaldoSlAnt = 0;
      INSERT INTO FNSALDOLANCA (CODEMP,CODFILIAL,CODPLAN,CODEMPPN,CODFILIALPN,DATASL,PREVSL,SALDOSL)
             VALUES (
                    :ICODEMPPN,:IFILIALSALDO,:sCodPlanAtu,:ICODEMPPN,:ICODFILIALPN,:dDataAtu,0,:dSaldoSlAnt+:dVlrAtu
             );
      FOR SELECT DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=:sCodplanAtu
                 AND DATASL >:dDataAtu AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
                 AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN INTO :dTmp,:dSaldoSlAnt DO
      BEGIN
        if (:dSaldoSlAnt IS NULL) THEN
           dSaldoSlAnt = 0;
        UPDATE FNSALDOLANCA SET SALDOSL = :dSaldoSlAnt+:dVlrAtu WHERE CODPLAN=:sCodplanAtu
               AND DATASL =:dTmp AND CODEMP=:ICODEMPPN AND CODFILIAL=:IFILIALSALDO
               AND CODEMP=:ICODEMPPN AND CODFILIAL=:ICODFILIALPN;
        SUSPEND;
      END
    END
  END
  SUSPEND;
END ^

ALTER PROCEDURE LFBUSCAFISCALSP (FILIALATUAL INTEGER,
CODEMP INTEGER,
CODFILIAL INTEGER,
CODPROD INTEGER,
CODEMPCL INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER)
RETURNS (ORIGFISC CHAR(1) CHARACTER SET NONE,
CODTRATTRIB CHAR(2) CHARACTER SET NONE,
REDFISC NUMERIC(9, 2),
TIPOFISC CHAR(2) CHARACTER SET NONE,
CODMENS INTEGER,
ALIQFISC NUMERIC(9, 2))
AS 

DECLARE VARIABLE NOESTCLI CHAR;
  DECLARE VARIABLE ITMP INTEGER;
  DECLARE VARIABLE CODFISCCLI INTEGER;
  DECLARE VARIABLE CODEMPFC INTEGER;
  DECLARE VARIABLE CODFILIALFC INTEGER;
BEGIN
 SELECT (SELECT COUNT(F.UFFILIAL) FROM SGFILIAL F
  WHERE F.CODEMP=:CODEMP AND F.CODFILIAL=:FILIALATUAL
  AND F.UFFILIAL=C.UFCLI), CODFISCCLI,CODEMPFC,CODFILIALFC
  FROM VDCLIENTE C WHERE C.CODCLI=:CODCLI
  AND C.CODEMP=:CODEMPCL AND C.CODFILIAL=:CODFILIALCL
 INTO ITMP,CODFISCCLI,CODEMPFC,CODFILIALFC;

 IF (ITMP > 0) THEN
  NOESTCLI='S';
 ELSE
  NOESTCLI='N';


 FOR SELECT IT.ORIGFISC,IT.CODTRATTRIB,IT.REDFISC,IT.ALIQFISC,IT.TIPOFISC,IT.CODMENS
  FROM LFITCLFISCAL IT, EQPRODUTO P WHERE P.CODPROD=:CODPROD
  AND P.CODFILIAL=:CODFILIAL AND P.CODEMP=P.CODEMP
  AND IT.CODEMP=P.CODEMPFC AND IT.CODFILIAL=P.CODFILIALFC
  AND IT.CODFISC=P.CODFISC AND IT.NOUFITFISC=:NOESTCLI
  AND (
           (IT.CODFISCCLI IS NULL AND :CODFISCCLI IS NOT NULL)
        OR (IT.CODFISCCLI IS NULL AND :CODFISCCLI IS NULL)
        OR (IT.CODFISCCLI=:CODFISCCLI AND IT.CODEMPFC=:CODEMPFC AND IT.CODFILIALFC=:CODFILIALFC)
      )
  ORDER BY IT.CODITFISC
 INTO ORIGFISC,CODTRATTRIB,REDFISC,ALIQFISC,TIPOFISC,CODMENS DO
 BEGIN
/*   EXCEPTION VDVENDAEX01; */
   SUSPEND;
   EXIT;
 END

/*S vem para c se as SELECTs acima no tiverem retornado nenhum valor.*/

 SELECT F.ORIGFISC,F.CODTRATTRIB,F.REDFISC,F.ALIQFISC,F.TIPOFISC
  FROM LFCLFISCAL F, EQPRODUTO P WHERE P.CODPROD=:CODPROD
  AND P.CODFILIAL=:CODFILIAL AND P.CODEMP=:CODEMP
  AND F.CODEMP=P.CODEMPFC AND F.CODFILIAL=P.CODFILIALFC AND F.CODFISC=P.CODFISC
 INTO ORIGFISC,CODTRATTRIB,REDFISC,ALIQFISC,TIPOFISC;
 SUSPEND;
END ^

ALTER PROCEDURE LFBUSCAICMSSP (CODNAT CHAR(4) CHARACTER SET NONE,
ESTCLI CHAR(2) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
RETURNS (PERCICMS NUMERIC(9, 2))
AS 

DECLARE VARIABLE EstEmp CHAR(2);
BEGIN
  SELECT UFFILIAL FROM SGFILIAL WHERE CODEMP=:ICODEMP
    AND CODFILIAL=:ICODFILIAL INTO :EstEmp;
  IF (EstCli = EstEmp) then
    SELECT ALIQENAT FROM LFNATOPER WHERE CODNAT=:CodNat
           AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :PercICMS;
  ELSE
  BEGIN
    SELECT TI.ALIQTI FROM LFTABICMS TI, LFITNATOPER INO WHERE
      TI.CODEMP = INO.CODEMPTI AND TI.CODFILIAL=INO.CODFILIALTI
      AND TI.UFTI = INO.UFTI AND INO.CODEMP=:ICODEMP AND
      INO.CODFILIAL=:ICODFILIAL AND INO.CODNAT=:CodNat AND
      INO.UFTI=:EstCli INTO :PercICMS;
    IF (PercICMS IS NULL) THEN
      SELECT ALIQFNAT FROM LFNATOPER WHERE CODNAT=:CodNat
        AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :PercICMS;
  END
  SUSPEND;
END ^

ALTER PROCEDURE LFBUSCANATSP (FILIALATUAL INTEGER,
CODEMP INTEGER,
CODFILIAL INTEGER,
CODPROD INTEGER,
CODEMPCL INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER,
CODEMPFR INTEGER,
CODFILIALFR INTEGER,
CODFOR INTEGER,
CODFILIALTM SMALLINT,
CODTIPOMOV INTEGER)
RETURNS (CODNAT CHAR(4) CHARACTER SET NONE)
AS 

DECLARE VARIABLE NOEST CHAR;
  DECLARE VARIABLE CV CHAR;
  DECLARE VARIABLE ITMP INTEGER;
BEGIN
 IF (CODFOR IS NULL) THEN
 BEGIN
  SELECT COUNT(F.UFFILIAL) FROM SGFILIAL F, VDCLIENTE C
   WHERE F.CODEMP=:CODEMP AND F.CODFILIAL=:FILIALATUAL
   AND C.CODCLI=:CODCLI AND C.CODEMP=:CODEMPCL
   AND C.CODFILIAL=:CODFILIALCL AND F.UFFILIAL=C.UFCLI INTO ITMP;
  CV = 'V';
 END
 ELSE
 BEGIN
  SELECT COUNT(F.UFFILIAL) FROM SGFILIAL F, CPFORNECED FO
   WHERE F.CODEMP=:CODEMP AND F.CODFILIAL=:FILIALATUAL
   AND FO.CODFOR=:CODFOR AND FO.CODEMP=:CODEMPFR
   AND FO.CODFILIAL=:CODFILIALFR AND F.UFFILIAL=FO.UFFOR INTO ITMP;
  CV = 'C';
 END

 IF (ITMP > 0) THEN
  NOEST='S';
 ELSE
  NOEST='N';

 SELECT FIRST 1 R.CODNAT FROM EQPRODUTO P, LFITREGRAFISCAL R, LFCLFISCAL C WHERE
   P.CODPROD=:CODPROD AND P.CODFILIAL=:CODFILIAL AND P.CODEMP=:CODEMP
   AND C.CODFISC = P.CODFISC AND C.CODFILIAL = P.CODFILIALFC
   AND C.CODEMP = P.CODEMPFC AND R.CODREGRA = C.CODREGRA
   AND R.CODFILIAL = C.CODFILIALRA AND R.CODEMP = C.CODEMPRA
   AND R.CODEMPTM=:CODEMP AND R.CODFILIALTM=:CODFILIALTM AND
   R.CODTIPOMOV=:CODTIPOMOV AND R.CVITRF=:CV AND NOUFITRF=:NOEST
 INTO CODNAT;
 IF (CODNAT IS NULL) THEN
 BEGIN
   SELECT FIRST 1 R.CODNAT FROM EQPRODUTO P, LFITREGRAFISCAL R, LFCLFISCAL C WHERE
     P.CODPROD=:CODPROD AND P.CODFILIAL=:CODFILIAL AND P.CODEMP=:CODEMP
     AND C.CODFISC = P.CODFISC AND C.CODFILIAL = P.CODFILIALFC
     AND C.CODEMP = P.CODEMPFC AND R.CODREGRA = C.CODREGRA
     AND R.CODFILIAL = C.CODFILIALRA AND R.CODEMP = C.CODEMPRA
     AND R.CVITRF=:CV AND NOUFITRF=:NOEST
   INTO CODNAT;
 END
 SUSPEND;

END ^

ALTER PROCEDURE LFNOVODOCSP (SSERIE CHAR(4) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
RETURNS (DOC INTEGER)
AS 

BEGIN
  SELECT DOCSERIE FROM LFSERIE WHERE SERIE=:sSerie
         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :Doc;
  IF ((Doc IS NULL) OR (Doc = 0)) THEN
    Doc = 1;
  ELSE
    Doc = Doc + 1;
  UPDATE LFSERIE SET DOCSERIE=:Doc WHERE SERIE=:sSerie
         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL;
  SUSPEND;
END ^

ALTER PROCEDURE PPITOPSP01 (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
ICODOP INTEGER)
AS 

DECLARE VARIABLE iCodEmpPd INTEGER;
 DECLARE VARIABLE iCodFilialPd SMALLINT;
 DECLARE VARIABLE iSeqItEst SMALLINT;
 DECLARE VARIABLE iCodProdPd INTEGER;
 DECLARE VARIABLE dQtdItOp DECIMAL(15,3);
 DECLARE VARIABLE iCodEmpLe INTEGER;
 DECLARE VARIABLE iCodFilialLe SMALLINT;
 DECLARE VARIABLE cCodLote CHAR(13);
 DECLARE VARIABLE iCodEmpFs INTEGER;
 DECLARE VARIABLE iCodFilialFs SMALLINT;
 DECLARE VARIABLE iCodFase INTEGER;
 DECLARE VARIABLE iCodEmpTr INTEGER;
 DECLARE VARIABLE iCodFilialTr SMALLINT;
 DECLARE VARIABLE iCodTpRec INTEGER;
 DECLARE VARIABLE iCodEmpRp INTEGER;
 DECLARE VARIABLE iCodFilialRp SMALLINT;
 DECLARE VARIABLE iCodRecP INTEGER;
 DECLARE VARIABLE dTempoOf DECIMAL(15,3);
 DECLARE VARIABLE iSeqOf SMALLINT;


BEGIN
   FOR SELECT EF.SEQEF, EF.CODEMPFS, EF.CODFILIALFS, EF.CODFASE,
      EF.CODEMPTR, EF.CODFILIALTR, EF.CODTPREC, EF.TEMPOEF
      FROM PPESTRUFASE EF, PPOP O, PPESTRUTURA E
      WHERE O.CODEMP=:iCodEmp AND O.CODFILIAL=:iCodFilial AND
       O.CODOP=:iCodOp AND E.CODEMP=O.CODEMPPD AND E.CODFILIAL=O.CODFILIALPD AND
       E.CODPROD=O.CODPROD AND EF.CODEMP=E.CODEMP AND EF.CODFILIAL=E.CODFILIAL AND
       EF.CODPROD=E.CODPROD
       INTO :iSeqOf, :iCodEmpFs, :iCodFilialFs, :iCodFase,
         :iCodEmpTr, :iCodFilialTr, :iCodTpRec, :dTempoOf
         DO
   BEGIN
       SELECT FIRST 1 CODEMP,CODFILIAL,CODRECP FROM PPRECURSO R
         WHERE R.CODEMP=:iCodEmpTr AND R.CODFILIAL=:iCodFilialTr AND
           R.CODTPREC=:iCodTpRec
         INTO :iCodEmpRp, :iCodFilialRp, :iCodRecP;

       INSERT INTO PPOPFASE (CODEMP,CODFILIAL,CODOP,SEQOF,CODEMPFS,
          CODFILIALFS,CODFASE,CODEMPRP,CODFILIALRP,CODRECP,TEMPOOF)
          VALUES (:iCodEmp,:iCodFilial,:iCodOp,:iSeqOf,:iCodEmpFs,
          :iCodFilialFs,:iCodFase,:iCodEmpRp,:iCodFilialRp,:iCodRecP,:dTempoOf);
   END

   FOR SELECT IE.CODEMPPD,IE.CODFILIALPD,IE.SEQITEST,IE.CODPRODPD,
     IE.CODEMPFS,IE.CODFILIALFS,IE.CODFASE,
     CAST( CAST(IE.QTDITEST AS DECIMAL(15,3) ) /
           CAST(E.QTDEST AS DECIMAL(15,3) ) *
           CAST(O.QTDPRODOP AS DECIMAL(15,3)) AS DECIMAL(15,2)),
     (SELECT MIN(L.CODLOTE) FROM EQLOTE L WHERE
     L.CODEMP=E.CODEMP AND L.CODFILIAL=E.CODFILIAL AND
     L.CODPROD=E.CODPROD AND L.SLDLIQLOTE>0 AND L.VENCTOLOTE =
     ( SELECT MIN(LS.VENCTOLOTE) FROM EQLOTE LS WHERE LS.CODPROD=L.CODPROD
     AND LS.CODFILIAL=L.CODFILIAL AND LS.CODEMP=L.CODEMP AND LS.SLDLIQLOTE>0)) CODLOTE
     FROM PPITESTRUTURA IE, PPESTRUTURA E, PPOP O
     WHERE IE.CODEMP=E.CODEMP AND IE.CODFILIAL=E.CODFILIAL AND
     IE.CODPROD=E.CODPROD AND O.CODEMPPD=E.CODEMP AND O.CODFILIALPD=E.CODFILIAL AND
     O.CODPROD=E.CODPROD AND O.CODEMP=:iCodEmp AND O.CODFILIAL=:iCodFilial AND O.CODOP=:iCodOp
     INTO :iCodEmpPd, :iCodFilialPd, :iSeqItEst, :iCodProdPd,
          :iCodEmpFs, :iCodFilialFs, :iCodFase, :dQtdItOp, :cCodLote DO
   BEGIN
     IF (:cCodLote IS NULL ) then
     BEGIN
        iCodEmpLe = null;
        iCodFilialLe = null;
     END
     ELSE
     BEGIN
        iCodEmpLe = iCodEmpPd;
        iCodFilialLe = iCodFilialPd;
     END
     INSERT INTO PPITOP (CODEMP,CODFILIAL,CODOP,SEQITOP,CODEMPPD,CODFILIALPD,
        CODPROD,CODEMPFS,CODFILIALFS,CODFASE,QTDITOP,CODEMPLE,CODFILIALLE,CODLOTE)
        VALUES (:iCodEmp, :iCodFilial, :iCodOp, :iSeqItEst, :iCodEmpPd, :iCodFilialPd,
        :iCodProdPd, :iCodEmpFs, :iCodFilialFs, :iCodFase, :dQtdItOp,
        :iCodEmpLe, :iCodFilialLe, :cCodLote);
   END
   /* Procedure Text */
   SUSPEND;
END ^

ALTER PROCEDURE PVABRECAIXASP (ICODCAIXA INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER,
NVLRINICAIXA NUMERIC(15, 3),
DDTAMOV DATE,
ICODFILIALUS SMALLINT,
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 

DECLARE VARIABLE INROMOV INTEGER ;
BEGIN
    SELECT NROMOV FROM PVSEQMOVCAIXA WHERE DTAMOV=:DDTAMOV AND CODCAIXA=:ICODCAIXA
          AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :INROMOV;
    IF (INROMOV IS NULL) THEN
    BEGIN
       INROMOV = 1;
       INSERT INTO PVSEQMOVCAIXA (DTAMOV,CODCAIXA,CODEMP,CODFILIAL,NROMOV)
          VALUES (:DDTAMOV, :ICODCAIXA, :ICODEMP, :ICODFILIAL, :INROMOV);
    END
    ELSE
    BEGIN
       INROMOV = INROMOV + 1;
       UPDATE PVSEQMOVCAIXA SET NROMOV=:INROMOV WHERE DTAMOV=:DDTAMOV AND CODCAIXA=:ICODCAIXA AND
            CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL;
    END
    INSERT INTO PVMOVCAIXA (CODCAIXA,CODFILIAL,CODEMP,DTAMOV,NROMOV,TIPOMOV,VLRSLDMOV,VLRMOV,CODEMPUS,CODFILIALUS,IDUSU) VALUES
      (:iCodCaixa,:iCodFilial,:iCodEmp,:DDTAMOV,:INROMOV,'A',:nVlrIniCaixa,:nVlrIniCaixa,:iCodEmp,:iCodFilialUs,:cIdUsu);
  SUSPEND;
END ^

ALTER PROCEDURE PVADICMOVCAIXASP01 (ICODCAIXA INTEGER,
NVLRINICAIXA NUMERIC(18, 3),
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DDTAMOV DATE)
AS 

DECLARE VARIABLE ICODMOVCAIXA INTEGER;
BEGIN
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:ICODFILIAL,'MC') INTO ICODMOVCAIXA;
  INSERT INTO PVMOVCAIXA (CODEMP,CODFILIAL,CODCAIXA,DTAMOV,NROMOV,TIPOMOV,VLRSLDMOV,VLRMOV)
         VALUES (
                :ICODEMP,:ICODFILIAL,:iCodCaixa,:DDTAMOV,
                :ICODMOVCAIXA,'A',:nVlrIniCaixa,:nVlrIniCaixa
         );
  SUSPEND;
END ^

ALTER PROCEDURE PVFECHAVENDASP (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
NVALOR NUMERIC(18, 3),
ITERM INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 

DECLARE VARIABLE ICODMOVCAIXA INTEGER;
DECLARE VARIABLE IFILIALUSU INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'SGUSUARIO') INTO IFILIALUSU;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:ICODFILIAL,'MC') INTO ICODMOVCAIXA;
  INSERT INTO PVMOVCAIXA (CODEMP,CODFILIAL,CODCAIXA,DTAMOV,NROMOV,TIPOMOV,VLRMOV,CODEMPUS,CODFILIALUS,IDUSU)
         VALUES (
                :ICODEMP,:ICODFILIAL,:ITERM,:DDTAMOV,
                :ICODMOVCAIXA,'V',:NVALOR,:ICODEMP,:IFILIALUSU,:CIDUSU
         );
  SUSPEND;
END ^

ALTER PROCEDURE PVRETMOVCAIXASP (ICODCAIXA INTEGER,
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DDTAMOV DATE)
RETURNS (DDTAMOVRET DATE,
CTIPOMOV CHAR(1) CHARACTER SET NONE,
DVLRSLDMOV NUMERIC(15, 3),
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 

BEGIN
  SELECT DTAMOV,TIPOMOV,VLRSLDMOV,IDUSU FROM PVMOVCAIXA WHERE
         NROMOV = (
                  SELECT MAX(NROMOV) FROM PVMOVCAIXA WHERE
                         CODCAIXA=:ICODCAIXA
                         AND DTAMOV =:DDTAMOV
                         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
                  )
         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND
           DTAMOV=:DDTAMOV INTO :DDTAMOVRET, :CTIPOMOV, :DVLRSLDMOV, :CIDUSU;

  SUSPEND;
END ^

ALTER PROCEDURE PVSANGRIASP (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
NVALOR NUMERIC(18, 3),
ITERM INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 

DECLARE VARIABLE ICODMOVCAIXA INTEGER;
DECLARE VARIABLE IFILIALUSU INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'SGUSUARIO') INTO IFILIALUSU;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:ICODFILIAL,'MC') INTO ICODMOVCAIXA;
  INSERT INTO PVMOVCAIXA (CODEMP,CODFILIAL,CODCAIXA,DTAMOV,NROMOV,TIPOMOV,VLRMOV,CODEMPUS,CODFILIALUS,IDUSU)
         VALUES (
                :ICODEMP,:ICODFILIAL,:ITERM,:DDTAMOV,
                :ICODMOVCAIXA,'S',:NVALOR*-1,:ICODEMP,:IFILIALUSU,:CIDUSU
         );
  SUSPEND;
END ^

ALTER PROCEDURE PVSUPRIMENTOSP (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
NVALOR NUMERIC(18, 3),
ITERM INTEGER,
DDTAMOV DATE,
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 

DECLARE VARIABLE ICODMOVCAIXA INTEGER;
DECLARE VARIABLE IFILIALUSU INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'SGUSUARIO') INTO IFILIALUSU;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:ICODFILIAL,'MC') INTO ICODMOVCAIXA;
  INSERT INTO PVMOVCAIXA (CODEMP,CODFILIAL,CODCAIXA,DTAMOV,NROMOV,TIPOMOV,VLRMOV,CODEMPUS,CODFILIALUS,IDUSU)
         VALUES (
                :ICODEMP,:ICODFILIAL,:ITERM,:DDTAMOV,
                :ICODMOVCAIXA,'U',:NVALOR,:ICODEMP,:IFILIALUSU,:CIDUSU
         );
  SUSPEND;
END ^

ALTER PROCEDURE PVVERIFCAIXASP (ICODCAIXA INTEGER,
ICODEMP INTEGER,
ICODFILIAL SMALLINT,
DDTAMOV DATE,
ICODFILIALUS SMALLINT,
CIDUSU CHAR(8) CHARACTER SET NONE)
RETURNS (IRETORNO INTEGER)
AS 

declare variable cTMP CHAR(1);
  declare variable cIDUSUANT CHAR(8);
  declare variable iCODFILIALANT SMALLINT;
BEGIN
  iRetorno = -1;
  SELECT TIPOMOV,IDUSU,CODFILIALUS FROM PVMOVCAIXA WHERE
         NROMOV = (
                  SELECT MAX(NROMOV) FROM PVMOVCAIXA WHERE
                         CODCAIXA=:ICODCAIXA
                         AND DTAMOV = :DDTAMOV
                         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
                  )
         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND
           DTAMOV=:DDTAMOV INTO :cTMP, :cIDUSUANT, :iCodFilialAnt;
  if ( (cTMP IS NULL) OR (cTMP = 'F') ) then
  BEGIN
    iRetorno = 0; /*Caixa OK*/
    SUSPEND;
    EXIT;
  END
  else if (cTMP in ('A','S','U','V')) then
  BEGIN
    if ( (cIDUSU=cIDUSUANT) AND (iCodFilialUs=iCodFilialAnt) )then
       iRetorno = 2; /*Caixa aberto*/
    else
       iRetorno = 4;
    SUSPEND;
    EXIT;
  END
  else if (cTMP = 'Z') then
  BEGIN
    iRetorno = 3; /*Jah foi realizada reduoZ neste dia*/
    SUSPEND;
    EXIT;
  END
  SUSPEND;
END ^

ALTER PROCEDURE SGFIMCONSP (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
CIDUSU CHAR(8) CHARACTER SET NONE)
AS 

declare variable iConectado INTEGER;
begin
  /* Procedure Text */
  SELECT CONECTADO FROM SGCONEXAO WHERE CODEMP=:iCodemp AND
     CODFILIAL=:iCodfilial AND IDUSU=:cIdUsu INTO :iConectado;
  if (iConectado is not null) then
     UPDATE SGCONEXAO SET CONECTADO=CONECTADO-1
        WHERE CODEMP=:iCodemp AND CODFILIAL=:iCodfilial AND IDUSU=:cIdUsu;
  suspend;
end ^

ALTER PROCEDURE SGINICONSP (ICODEMP INTEGER,
ICODFILIAL SMALLINT,
CIDUSU CHAR(8) CHARACTER SET NONE,
ICODFILIALSEL SMALLINT,
ICODTERM SMALLINT)
AS 

declare variable iConectado INTEGER;
  declare variable iConta INTEGER;
  declare variable iCodFilialSelCX SMALLINT;
begin
  /* Procedure Text */
  SELECT COUNT(IDUSU) FROM SGUSUARIO WHERE CODEMP=:iCodemp AND
     CODFILIAL=:iCodfilial AND IDUSU=:cIdUsu INTO :iConta;

  if (iConta = 0) then
    EXCEPTION SGCONEXAOEX02;

  SELECT CONECTADO, CODFILIALSEL FROM SGCONEXAO WHERE CODEMP=:iCodemp AND
     CODFILIAL=:iCodfilial AND IDUSU=:cIdUsu INTO :iConectado, iCodFilialSelCX;
  if (iConectado is null) then
      INSERT INTO SGCONEXAO (CODEMP,CODFILIAL,IDUSU,CODFILIALSEL,CONECTADO,CODTERM)
        VALUES (:iCodemp, :iCodfilial, :cIdusu, :iCodfilialSel, 1, :iCodTerm);
  else
  begin
      if (iConectado<=0) then
         UPDATE SGCONEXAO SET CONECTADO=1, CODFILIALSEL=:iCodfilialSel, CODTERM = :iCodTerm
            WHERE CODEMP=:iCodemp AND CODFILIAL=:iCodfilial AND IDUSU=:cIdUsu;
      else
      begin
         if (not (iCodfilialSelCX=iCodfilialSel) ) then
            EXCEPTION SGCONEXAOEX01;
         else
            UPDATE SGCONEXAO SET CONECTADO=CONECTADO+1, CODTERM = :iCodTerm
               WHERE CODEMP=:iCodemp AND CODFILIAL=:iCodfilial AND IDUSU=:cIdUsu;
      end
  end
  suspend;
end ^

ALTER PROCEDURE SGLOGSP01 (CODEMP INTEGER,
IDUSU CHAR(8) CHARACTER SET NONE,
CLASLOG CHAR(2) CHARACTER SET NONE,
TIPOLOG CHAR(3) CHARACTER SET NONE,
DESCLOG CHAR(60) CHARACTER SET NONE,
OBSLOG VARCHAR(1000) CHARACTER SET NONE)
RETURNS (CODFILIAL SMALLINT,
CODLOG INTEGER)
AS 

DECLARE VARIABLE CODCAIXA INTEGER;
BEGIN
  SELECT CODFILIALSEL,CODTERM FROM SGCONEXAO WHERE CODEMP=:CODEMP AND UPPER(IDUSU)=UPPER(USER)
    AND CONECTADO > 0 INTO CODFILIAL,CODCAIXA;
  SELECT ISEQ FROM SPGERANUM(:CODEMP,:CODFILIAL,'LG') INTO CODLOG;
  INSERT INTO SGLOG(CODEMP,CODFILIAL,CODLOG,CODEMPUS,CODFILIALUS,IDUSU,
               CLASLOG,TIPOLOG,CODEMPCX,CODFILIALCX,CODCAIXA,
        DESCLOG,OBSLOG) VALUES
              (:CODEMP,:CODFILIAL,:CODLOG,:CODEMP,:CODFILIAL,:IDUSU,
               :CLASLOG,:TIPOLOG,:CODEMP,:CODFILIAL,:CODCAIXA,
               :DESCLOG,:OBSLOG);
  SUSPEND;
END ^

ALTER PROCEDURE SGRETCAIXA (CODEMP INTEGER)
RETURNS (CODTERM INTEGER)
AS 

DECLARE VARIABLE CODFILIAL INTEGER;
begin
  SELECT CODFILIALSEL,CODTERM FROM SGCONEXAO WHERE CODEMP=:CODEMP AND UPPER(IDUSU)=UPPER(USER)
    AND CONECTADO > 0 INTO CODFILIAL,CODTERM;
  SUSPEND;
end ^

ALTER PROCEDURE SGRETFILIAL (ICODEMP INTEGER,
SNOMETAB CHAR(30) CHARACTER SET NONE)
RETURNS (ICODFILIAL INTEGER)
AS 

DECLARE VARIABLE sEhME CHAR(1);
begin
  SELECT USOMEOBJ FROM SGOBJETO WHERE TIPOOBJ='TB' AND NOMEOBJ=:SNOMETAB
    INTO sEhME;
  IF (sEhME = 'N') THEN
  BEGIN
    SELECT CODFILIALSEL FROM SGCONEXAO WHERE CODEMP=:ICODEMP AND UPPER(IDUSU)=UPPER(USER)
      AND CONECTADO > 0 INTO ICODFILIAL;
  END
  ELSE
  BEGIN
    SELECT FL.CODFILIAL FROM SGFILIAL FL WHERE
      FL.CODEMP = :ICODEMP AND FL.MZFILIAL='S'
      INTO ICODFILIAL;
    IF (ICODFILIAL IS NULL) THEN
      EXCEPTION SGFILIALEX01;
  END
  IF (ICODFILIAL IS NULL) THEN
  BEGIN
    EXCEPTION SGFILIALEX02;
  END
  SUSPEND;
end ^

ALTER PROCEDURE SGSETAGENDASP (CODAGD INTEGER,
CODEMP INTEGER,
OBJORIGAGD CHAR(5) CHARACTER SET NONE,
CODFILIALCH INTEGER,
CODCHAVE INTEGER,
DTAINIAGD DATE,
HRINIAGD TIME,
DTAFIMAGD DATE,
HRFIMAGD TIME,
ASSUNTOAGD CHAR(50) CHARACTER SET NONE,
DESCAGD VARCHAR(10000) CHARACTER SET NONE,
TIPOAGD CHAR(2) CHARACTER SET NONE,
PRIORAGD SMALLINT,
CODFILIALUO INTEGER,
IDUSUO CHAR(8) CHARACTER SET NONE,
CODFILIALUD INTEGER,
IDUSUD CHAR(8) CHARACTER SET NONE)
RETURNS (IRET INTEGER)
AS 

DECLARE VARIABLE IFILIALAGD INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'SGAGENDA') INTO IFILIALAGD;
  IF (CODAGD = 0) THEN
  BEGIN
    SELECT ISEQ FROM SPGERANUM(:CODEMP,:IFILIALAGD,'AG') INTO CODAGD;
    INSERT INTO SGAGENDA(CODEMP,CODFILIAL,CODAGD,OBJORIGAGD,CODEMPCH,CODFILIALCH,CODCHAVE,
      DATAAGD,DTAINIAGD,HRINIAGD,DTAFIMAGD,HRFIMAGD,ASSUNTOAGD,DESCAGD,TIPOAGD,PRIORAGD,
      CODEMPUO,CODFILIALUO,IDUSUO,CODEMPUD,CODFILIALUD,IDUSUD,SITAGD)
      VALUES (:CODEMP,:IFILIALAGD,:CODAGD,:OBJORIGAGD,:CODEMP,:CODFILIALCH,:CODCHAVE,
      CAST('today' AS DATE),:DTAINIAGD,:HRINIAGD,:DTAFIMAGD,:HRFIMAGD,:ASSUNTOAGD,:DESCAGD,:TIPOAGD,:PRIORAGD,
      :CODEMP,:CODFILIALUO,:IDUSUO,:CODEMP,:CODFILIALUD,:IDUSUD,'AI');
  END
  ELSE
    UPDATE SGAGENDA SET OBJORIGAGD=:OBJORIGAGD,CODEMPCH=:CODEMP,CODFILIALCH=:CODFILIALCH,
      CODCHAVE=:CODCHAVE,DTAINIAGD=:DTAINIAGD,HRINIAGD=:HRINIAGD,DTAFIMAGD=:DTAFIMAGD,
      HRFIMAGD=:HRFIMAGD,ASSUNTOAGD=:ASSUNTOAGD,DESCAGD=:DESCAGD,TIPOAGD=:TIPOAGD,
      PRIORAGD=:PRIORAGD,CODEMPUO=:CODEMP,CODFILIALUO=:CODFILIALUO,IDUSUO=:IDUSUO,
      CODEMPUD=:CODEMP,CODFILIALUD=:CODFILIALUD,IDUSUD=:IDUSUD
      WHERE CODEMP=:CODEMP AND CODFILIAL=:IFILIALAGD AND CODAGD=:CODAGD;
  IRET = CODAGD;
  SUSPEND;
END ^

ALTER PROCEDURE SGUPACESSOMUSP (ICODEMP INTEGER,
ICODFILIAL INTEGER,
SIDUSU CHAR(8) CHARACTER SET NONE,
ICODSIS INTEGER,
ICODMODU INTEGER,
ICODMENU INTEGER,
CTPACESSOMU CHAR(1) CHARACTER SET NONE)
AS 

BEGIN
  DELETE FROM SGACESSOMU WHERE CODEMP = :ICODEMP
         AND CODFILIAL = :ICODFILIAL
         AND IDUSU = :SIDUSU
         AND CODSIS =:ICODSIS
         AND CODMODU =:ICODMODU
         AND CODMENU =:ICODMENU;
  INSERT INTO SGACESSOMU (CODEMP,CODFILIAL,IDUSU,CODSIS,CODMODU,CODMENU,TPACESSOMU)
         VALUES (
                :ICODEMP,
                :ICODFILIAL,
                :SIDUSU,
                :ICODSIS,
                :ICODMODU,
                :ICODMENU,
                :CTPACESSOMU
         );
  SUSPEND;
END ^

ALTER PROCEDURE SGUPMENUSP01 (ICODSIS INTEGER,
ICODMODU INTEGER,
ICODMENU INTEGER,
SDESCMENU CHAR(50) CHARACTER SET NONE,
ICODSISPAI INTEGER,
ICODMODUPAI INTEGER,
ICODMENUPAI INTEGER)
AS 

DECLARE VARIABLE iTmp INTEGER;
BEGIN
  SELECT COUNT(*) FROM SGMENU WHERE CODSIS =:iCodSis
         AND CODMODU =:iCodModu
         AND CODMENU =:iCodMenu INTO :iTmp;
  IF (iTmp > 0) THEN
  BEGIN
    UPDATE SGMENU
      SET
        DESCMENU = :sDescMenu,
        CODSISPAI = :iCodSisPai,
        CODMODUPAI = :iCodModuPai,
        CODMENUPAI = :iCodMenuPai
      WHERE
        CODSIS = :iCodSis AND
        CODMODU = :iCodModu AND
        CODMENU = :iCodMenu;
  END
  ELSE
  BEGIN
    INSERT INTO SGMENU (CODSIS,CODMODU,CODMENU,DESCMENU,CODSISPAI,CODMODUPAI,CODMENUPAI)
           VALUES (
                  :iCodSis,
                  :iCodModu,
                  :iCodMenu,
                  :sDescMenu,
                  :iCodSisPai,
                  :iCodModuPai,
                  :iCodMenuPai
           );
  END
  SUSPEND;
END ^

ALTER PROCEDURE SPGERANUM (ICODEMP INTEGER,
ICODFILIAL INTEGER,
STAB CHAR(2) CHARACTER SET NONE)
RETURNS (ISEQ INTEGER)
AS 

begin
  ISEQ = NULL;
  SELECT NROSEQ FROM SGSEQUENCIA
    WHERE CODEMP=:iCodEmp AND
      CODFILIAL=:iCodFilial AND
      SGTAB=:STAB INTO :ISEQ;
   IF (ISEQ IS NULL) THEN
   BEGIN
     INSERT INTO SGSEQUENCIA (CODEMP,CODFILIAL,SGTAB,NROSEQ)
            VALUES (:ICODEMP,:ICODFILIAL,:STAB,0);
     ISEQ = 1;
   END
   UPDATE SGSEQUENCIA SET NROSEQ=:ISEQ+1 WHERE
          CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
          AND SGTAB=:STAB;
  SUSPEND;
end ^

ALTER PROCEDURE TKCONTTOCLI (CODEMP INTEGER,
CODFILIAL INTEGER,
CODCTO INTEGER,
CODFILIALTI INTEGER,
CODTIPOCLI INTEGER,
CODFILIALCC INTEGER,
CODCLASCLI INTEGER,
CODFILIALSR INTEGER,
CODSETOR INTEGER)
RETURNS (IRET INTEGER)
AS 

DECLARE VARIABLE ICODCLI INTEGER;
DECLARE VARIABLE IFILIALCLI INTEGER;
BEGIN
  SELECT MAX(CODCLI)+1 FROM VDCLIENTE WHERE CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL INTO ICODCLI;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP, 'VDCLIENTE') INTO IFILIALCLI;
  INSERT INTO VDCLIENTE (CODEMP,CODFILIAL,CODCLI,RAZCLI,CODEMPCC,CODFILIALCC,CODCLASCLI,
  CODEMPVD,CODFILIALVD,CODVEND,CODEMPSR,CODFILIALSR,CODSETOR,NOMECLI,CODEMPTI,CODFILIALTI,
  CODTIPOCLI,DATACLI,PESSOACLI,ATIVOCLI,CNPJCLI,INSCCLI,CPFCLI,RGCLI,ENDCLI,NUMCLI,
  COMPLCLI,BAIRCLI,CIDCLI,UFCLI,CEPCLI,FONECLI,FAXCLI,EMAILCLI,CONTCLI)
    SELECT :CODEMP,:IFILIALCLI,:ICODCLI,RAZCTO,:CODEMP,:CODFILIALCC,:CODCLASCLI,
    CODEMPVD,CODFILIALVD,CODVEND,:CODEMP,:CODFILIALSR,:CODSETOR,NOMECTO,:CODEMP,:CODFILIALTI,
    :CODTIPOCLI,DATACTO,PESSOACTO,ATIVOCTO,CNPJCTO,INSCCTO,CPFCTO,RGCTO,ENDCTO,NUMCTO,
    COMPLCTO,BAIRCTO,CIDCTO,UFCTO,CEPCTO,FONECTO,FAXCTO,EMAILCTO,CONTCTO FROM TKCONTATO WHERE
    CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL AND CODCTO=:CODCTO;

    IRET = ICODCLI;
  SUSPEND;
END ^

ALTER PROCEDURE TKSETHISTSP (CODHISTTK INTEGER,
CODEMP INTEGER,
CODFILIALCO INTEGER,
CODCTO INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER,
DESCHISTTK VARCHAR(10000) CHARACTER SET NONE,
CODFILIALAE INTEGER,
CODATEND INTEGER,
SITHISTTK CHAR(2) CHARACTER SET NONE)
RETURNS (IRET INTEGER)
AS 

DECLARE VARIABLE IFILIALHIST INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'TKHISTORICO') INTO IFILIALHIST;
  IF (CODHISTTK = 0) THEN
  BEGIN
    SELECT ISEQ FROM SPGERANUM(:CODEMP,:IFILIALHIST,'HI') INTO CODHISTTK;
    INSERT INTO TKHISTORICO(CODEMP,CODFILIAL,CODHISTTK,DATAHISTTK,HORAHISTTK,CODEMPCO,CODFILIALCO,
      CODCTO,CODEMPCL,CODFILIALCL,CODCLI,DESCHISTTK,CODEMPAE,CODFILIALAE,CODATEND,SITHISTTK)
      VALUES (:CODEMP,:IFILIALHIST,:CODHISTTK,CAST('today' AS DATE),CAST('now' AS TIME),:CODEMP,:CODFILIALCO,
      :CODCTO,:CODEMP,:CODFILIALCL,:CODCLI,:DESCHISTTK,:CODEMP,:CODFILIALAE,:CODATEND,:SITHISTTK);
  END
  ELSE
  BEGIN
    UPDATE TKHISTORICO SET CODEMPCO=:CODEMP,CODFILIALCO=:CODFILIALCO,
      CODCTO=:CODCTO,CODEMPCL=:CODEMP,CODFILIALCL=:CODFILIALCL,
      CODCLI=:CODCLI,DESCHISTTK=:DESCHISTTK,CODEMPAE=:CODEMP,
      CODFILIALAE=:CODFILIALAE,CODATEND=:CODATEND,SITHISTTK=:SITHISTTK
      WHERE CODEMP=:CODEMP AND CODFILIAL=:IFILIALHIST AND CODHISTTK=:CODHISTTK;
    IF (NOT SITHISTTK IN ('AG')) THEN
      DELETE FROM SGAGENDA WHERE OBJORIGAGD='HISTO' AND CODEMPCH=:CODEMP AND
        CODFILIALCH=:IFILIALHIST AND CODCHAVE=:CODHISTTK;
  END
  SUSPEND;
END ^

ALTER PROCEDURE VDADICCOMISSAOSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRVENDACOMI NUMERIC(15, 3),
NVLRCOMI NUMERIC(15, 3),
DDATACOMI DATE,
DDTVENCCOMI DATE,
CTIPOCOMI CHAR(1) CHARACTER SET NONE)
AS 

DECLARE VARIABLE SCODFILIALCS SMALLINT;
DECLARE VARIABLE ICODCOMI INTEGER;
DECLARE VARIABLE CSTATUSCOMI CHAR(2);
begin
  /* Adiciona comisso na tabela vdcomissao*/
  IF ( (nVlrComi is null) OR  (nVlrComi=0) ) THEN -- se o valor for zero
  BEGIN
     -- ento deleta a comisso gerada
     DELETE FROM VDCOMISSAO WHERE CODEMPRC=:iCodEmp AND CODFILIALRC=:sCodFilial AND
        CODREC=:iCodRec AND NPARCITREC=:iNParcItRec AND TIPOCOMI=:cTipoComi;
  END
  ELSE IF (nVlrComi<0) THEN -- Caso seja um estorno de comisso
  BEGIN
     SELECT MAX(CODCOMI) FROM VDCOMISSAO WHERE CODEMP=:ICODEMP AND
        CODFILIAL = :SCODFILIALCS INTO iCodComi;
     IF (:iCodComi IS NULL) THEN
        iCodComi = 1;
     ELSE
        iCodComi = iCodComi+1;
     INSERT INTO VDCOMISSAO (CODEMP,CODFILIAL,CODCOMI,CODEMPRC,CODFILIALRC,CODREC,STATUSCOMI,
               NPARCITREC,VLRVENDACOMI,VLRCOMI,DATACOMI,DTVENCCOMI,STATUSCOMI,TIPOCOMI)
              VALUES ( :iCodEmp,:sCodFilialCs,:iCodComi,:iCodEmp,:sCodFilial,:iCodRec,:cStatusComi,
              :iNParcItRec,:nVlrVendaComi,:nVlrComi,:dDataComi,:dDtVencComi,'CE',:cTipoComi);
     nVlrComi = nVlrComi * -1; -- Transforma o valor da comisso em positivo e programa para o proximo pagto.
     INSERT INTO VDCOMISSAO (CODEMP,CODFILIAL,CODCOMI,CODEMPRC,CODFILIALRC,CODREC,STATUSCOMI,
               NPARCITREC,VLRVENDACOMI,VLRCOMI,DATACOMI,DTVENCCOMI,STATUSCOMI,TIPOCOMI)
              VALUES ( :iCodEmp,:sCodFilialCs,:iCodComi,:iCodEmp,:sCodFilial,:iCodRec,:cStatusComi,
              :iNParcItRec,:nVlrVendaComi,:nVlrComi,:dDataComi,:dDtVencComi,'C1',:cTipoComi);
  END
  ELSE
  BEGIN
     IF (cTipoComi='F') THEN
        cStatusComi = 'C2';
     ELSE
        cStatusComi = 'C1';
     SELECT ICODFILIAL FROM sgretfilial(:ICODEMP,'VDCOMISSAO') INTO :SCODFILIALCS;
     SELECT CODCOMI FROM VDCOMISSAO WHERE CODEMP=:iCodEmp AND CODFILIALRC=:sCodFilial AND
        CODREC=:iCodRec AND NPARCITREC=:iNParcItRec AND TIPOCOMI=:cTipoComi
        INTO :iCodComi;
     IF (iCodComi IS NULL) THEN  -- se no encontrou a comisso
     BEGIN --ento insere
        SELECT MAX(CODCOMI) FROM VDCOMISSAO WHERE CODEMP=:ICODEMP AND
           CODFILIAL = :SCODFILIALCS INTO iCodComi;
        IF (:iCodComi IS NULL) THEN
          iCodComi = 1;
        ELSE
          iCodComi = iCodComi+1;
        INSERT INTO VDCOMISSAO (CODEMP,CODFILIAL,CODCOMI,CODEMPRC,CODFILIALRC,CODREC,STATUSCOMI,
               NPARCITREC,VLRVENDACOMI,VLRCOMI,DATACOMI,DTVENCCOMI,STATUSCOMI,TIPOCOMI)
              VALUES ( :iCodEmp,:sCodFilialCs,:iCodComi,:iCodEmp,:sCodFilial,:iCodRec,:cStatusComi,
              :iNParcItRec,:nVlrVendaComi,:nVlrComi,:dDataComi,:dDtVencComi,:cStatusComi,:cTipoComi);
     END
     ELSE -- se encontrou a comisso atualiza
     BEGIN
        UPDATE VDCOMISSAO SET VLRVENDACOMI=:nVlrVendaComi, VLRCOMI=:nVlrComi,
            DATACOMI=:dDataComi, DTVENCCOMI=:dDtVencComi, STATUSCOMI=:cStatusComi
        WHERE CODEMP=:iCodEmp AND CODFILIAL=:sCodFilialCs AND CODCOMI=:iCodComi
            AND STATUSCOMI!='CP' ;
     END
  END
  suspend;
end ^

ALTER PROCEDURE VDADICITEMPDVSP (CODVENDA INTEGER,
CODEMP INTEGER,
CODFILIAL CHAR(8) CHARACTER SET NONE,
CODPROD INTEGER,
CODEMPPD INTEGER,
CODFILIALPD INTEGER,
QTDITVENDA NUMERIC(9, 2),
VLRPRECOITVENDA NUMERIC(18, 3))
RETURNS (CODITVENDA INTEGER,
PERCICMSITVENDA NUMERIC(9, 2),
VLRBASEICMSITVENDA NUMERIC(18, 3),
VLRICMSITVENDA NUMERIC(18, 3),
VLRLIQITVENDA NUMERIC(18, 3))
AS 

DECLARE VARIABLE ICODFILIALIT SMALLINT;
DECLARE VARIABLE ICODFILIALNT SMALLINT;
DECLARE VARIABLE ICODCLI INTEGER;
DECLARE VARIABLE ICODFILIALCL INTEGER;
DECLARE VARIABLE ICODTIPOMOV INTEGER;
DECLARE VARIABLE ICODFILIALTM INTEGER;
DECLARE VARIABLE SCODNAT CHAR(4);
DECLARE VARIABLE ICODFILIALLE SMALLINT;
DECLARE VARIABLE SCODLOTE CHAR(13);
DECLARE VARIABLE TIPOFISC CHAR(2);
DECLARE VARIABLE SORIGFISC CHAR(1);
DECLARE VARIABLE SCODTRATTRIB CHAR(2);
DECLARE VARIABLE ICODFILIALTT SMALLINT;
DECLARE VARIABLE ICODFILIALME SMALLINT;
DECLARE VARIABLE ICODMENS SMALLINT;
DECLARE VARIABLE PERCIPIITVENDA NUMERIC(9,2);
DECLARE VARIABLE VLRBASEIPIITVENDA DECIMAL(15,3);
DECLARE VARIABLE VLRIPIITVENDA DECIMAL(15,3);
DECLARE VARIABLE IQTDITVENDA INTEGER;
DECLARE VARIABLE VLRPRODITVENDA DECIMAL(15,3);
DECLARE VARIABLE SREFPROD CHAR(13);
DECLARE VARIABLE OBSITORC VARCHAR(500);
DECLARE VARIABLE UFCLI CHAR(2);
DECLARE VARIABLE UFFLAG CHAR(1);
DECLARE VARIABLE PERCRED NUMERIC(9,2);
DECLARE VARIABLE CLOTEPROD CHAR(1);
DECLARE VARIABLE NUMLIB INTEGER;
begin

  SELECT MAX(CODITVENDA)+1 FROM VDITVENDA WHERE CODVENDA=:CODVENDA
    AND CODFILIAL=:CODFILIAL AND CODEMP=:CODEMP INTO CODITVENDA;

  IF (CODITVENDA IS NULL) THEN
    CODITVENDA = 1;

/*Informaes da Venda.:*/

  SELECT V.CODCLI,V.CODFILIALCL,C.UFCLI,V.CODTIPOMOV,V.CODFILIALTM FROM VDVENDA V, VDCLIENTE C
    WHERE V.CODEMP=:CODEMP AND V.CODFILIAL=:CODFILIAL
    AND V.CODVENDA=:CODVENDA AND V.TIPOVENDA='E' AND
    C.CODCLI=V.CODCLI AND C.CODEMP=V.CODEMPCL AND
    C.CODFILIAL=V.CODFILIALCL INTO ICODCLI,ICODFILIALCL,UFCLI,ICODTIPOMOV,ICODFILIALTM;


  UFFLAG = 'N';

  SELECT 'S' FROM SGFILIAL  WHERE CODEMP=CODEMP
    AND CODFILIAL=:CODFILIAL AND UFFILIAL=:UFCLI INTO UFFLAG;


  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'LFNATOPER') INTO ICODFILIALNT;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'LFTRATTRIB') INTO ICODFILIALTT;
  SELECT ICODFILIAL FROM SGRETFILIAL(:CODEMP,'LFMENSAGEM') INTO ICODFILIALME;
  SELECT C.ALIQIPIFISC,P.CLOTEPROD
    FROM EQPRODUTO P, LFCLFISCAL C WHERE
    P.CODPROD = :CODPROD AND P.CODFILIAL = :CODFILIALPD AND
    P.CODEMP = :CODEMPPD AND C.CODFISC = P.CODFISC AND C.CODFILIAL = P.CODFILIALFC AND
    C.CODEMP = P.CODEMPFC INTO PERCIPIITVENDA,CLOTEPROD;

  SELECT CODNAT FROM
    LFBUSCANATSP(:CODFILIAL,:CODEMP,:CODFILIALPD,
                 :CODPROD,:CODEMP,:ICODFILIALCL,
                 :ICODCLI,NULL,NULL,NULL,:ICODFILIALTM,:ICODTIPOMOV)
    INTO SCODNAT;

  IF (SCODNAT IS NULL) THEN
    EXCEPTION VDITVENDAEX03;

  SELECT TIPOFISC,REDFISC,CODTRATTRIB,ORIGFISC,CODMENS,ALIQFISC FROM
    LFBUSCAFISCALSP(:CODFILIAL,:CODEMP,:CODFILIALPD,:CODPROD,:CODEMP,:ICODFILIALCL,:ICODCLI)
    INTO TIPOFISC,PERCRED,SCODTRATTRIB,SORIGFISC,ICODMENS,PERCICMSITVENDA;

/*Cod Lote.:*/

  IF (CLOTEPROD = 'S') THEN
  BEGIN
    SELECT MIN(L.CODLOTE) FROM EQLOTE L WHERE
      L.CODPROD=:CODPROD AND L.CODFILIAL=:CODFILIALPD AND L.SLDLIQLOTE>0
      AND L.CODEMP=:CODEMP AND L.VENCTOLOTE = (
      SELECT MIN(VENCTOLOTE) FROM EQLOTE LS WHERE LS.CODPROD=L.CODPROD
        AND LS.CODFILIAL=L.CODFILIAL AND LS.CODEMP=L.CODEMP AND LS.SLDLIQLOTE>0
        AND VENCTOLOTE >= CAST('today' AS DATE)
      ) INTO SCODLOTE;
    ICODFILIALLE = CODFILIALPD;
  END

/*  exception vdvendaex01 'chegou aki 5!'; */

  VLRPRODITVENDA = QTDITVENDA*VLRPRECOITVENDA;
  VLRBASEIPIITVENDA = 0;
  VLRBASEICMSITVENDA = 0;
  VLRICMSITVENDA = 0;
  VLRIPIITVENDA = 0;

  IF ( TIPOFISC = 'II') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'FF') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'NN') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'TT') THEN
  BEGIN
    IF (PERCICMSITVENDA = 0 OR PERCICMSITVENDA IS NULL) THEN
      SELECT * FROM LFBUSCAICMSSP (:SCODNAT,:UFCLI,:CODEMP,:CODFILIAL) INTO PERCICMSITVENDA;
    IF (PERCRED IS NULL) THEN
      PERCRED = 0;
    VLRBASEICMSITVENDA = VLRPRODITVENDA - (VLRPRODITVENDA*(PERCRED/100));
    VLRBASEIPIITVENDA = VLRPRODITVENDA;
    VLRICMSITVENDA = VLRBASEICMSITVENDA*(PERCICMSITVENDA/100);
    VLRIPIITVENDA = VLRBASEIPIITVENDA*(PERCIPIITVENDA/100);
  END
  VLRLIQITVENDA=VLRPRODITVENDA+VLRIPIITVENDA;
  INSERT INTO VDITVENDA (CODEMP,CODFILIAL,TIPOVENDA,CODVENDA,CODITVENDA,CODEMPNT,CODFILIALNT,CODNAT,CODEMPPD,
     CODFILIALPD,CODPROD,CODEMPLE,CODFILIALLE,CODLOTE,QTDITVENDA,PRECOITVENDA,PERCDESCITVENDA,
     VLRDESCITVENDA,PERCICMSITVENDA,VLRBASEICMSITVENDA,VLRICMSITVENDA,PERCIPIITVENDA,VLRBASEIPIITVENDA,
     VLRIPIITVENDA,VLRLIQITVENDA,VLRPRODITVENDA,REFPROD,ORIGFISC,CODEMPTT,CODFILIALTT,CODTRATTRIB,
     TIPOFISC,CODEMPME,CODFILIALME,CODMENS,OBSITVENDA) VALUES (:CODEMP,:CODFILIAL,'E',:CODVENDA,:CODITVENDA,
     :CODEMP,:ICODFILIALNT,:SCODNAT,:CODEMP,:CODFILIALPD,:CODPROD,:CODEMP,:CODFILIALPD,:SCODLOTE,
     :QTDITVENDA,:VLRPRECOITVENDA,0,0,:PERCICMSITVENDA,:VLRBASEICMSITVENDA,
     :VLRICMSITVENDA,:PERCIPIITVENDA,:VLRBASEIPIITVENDA,:VLRIPIITVENDA,:VLRLIQITVENDA,:VLRPRODITVENDA,
     :SREFPROD,:SORIGFISC,:CODEMP,:ICODFILIALTT,:SCODTRATTRIB,:TIPOFISC,:CODEMP,:ICODFILIALME,
     :ICODMENS,:OBSITORC);
  SUSPEND;
END ^

ALTER PROCEDURE VDADICITVENDAORCSP (FILIALATUAL INTEGER,
ICODVENDA INTEGER,
ICODORC INTEGER,
ICODITORC INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER)
AS 

declare variable ICODITVENDA INTEGER   /*Variaveis buscadas: */;
     declare variable ICODFILIALIT SMALLINT;
     declare variable ICODFILIALNT SMALLINT;
     declare variable ICODCLI INTEGER;
     declare variable ICODFILIALTM INTEGER;
     declare variable ICODTIPOMOV INTEGER;
     declare variable ICODFILIALCL INTEGER;
     declare variable SCODNAT CHAR(4);
     declare variable ICODFILIALLE SMALLINT;
     declare variable SCODLOTE CHAR(13);
     declare variable TIPOFISC CHAR(2);
     declare variable SORIGFISC CHAR;
     declare variable SCODTRATTRIB CHAR(2);
     declare variable ICODFILIALTT SMALLINT;
     declare variable ICODFILIALME SMALLINT;
     declare variable ICODMENS SMALLINT;
     declare variable PERCICMSITVENDA DECIMAL(9,2);
     declare variable VLRBASEICMSITVENDA DECIMAL(15,3);
     declare variable VLRICMSITVENDA DECIMAL(15,3);
     declare variable PERCIPIITVENDA DECIMAL(9,2);
     declare variable VLRBASEIPIITVENDA DECIMAL(15,3);
     declare variable VLRIPIITVENDA DECIMAL(15,3);
     declare variable ICODPROD INTEGER   /*Variaveis herdadas do itoramento: */;
     declare variable ICODFILIALPD INTEGER;
     declare variable IQTDITVENDA INTEGER;
     declare variable VLRPRECOITVENDA DECIMAL(15,3);
     declare variable PERCDESCITVENDA DECIMAL(9,2);
     declare variable VLRDESCITVENDA DECIMAL(15,3);
     declare variable VLRLIQITVENDA DECIMAL(15,3);
     declare variable VLRPRODITVENDA DECIMAL(15,3);
     declare variable SREFPROD CHAR(13);
     declare variable OBSITORC VARCHAR(500);
     declare variable UFCLI CHAR(2)   /*Variaveis temporrias: */;
     declare variable UFFLAG CHAR;
     declare variable PERCRED DECIMAL(9,2);
     declare variable CLOTEPROD CHAR;
     declare variable NUMLIB INTEGER;
     declare variable ICONTA1 INTEGER;
     declare variable ICONTA2 INTEGER;
begin


  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'VDVENDA') INTO ICODFILIALIT;
  SELECT MAX(CODITVENDA)+1 FROM VDITVENDA WHERE CODVENDA=:ICODVENDA
    AND CODFILIAL=:ICODFILIALIT AND CODEMP=:ICODEMP INTO ICODITVENDA;

  IF (ICODITVENDA IS NULL) THEN
    ICODITVENDA = 1;

/*Informaes do Orcamento.:*/

  SELECT CODCLI,CODFILIALCL FROM VDORCAMENTO
    WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
    AND CODORC=:ICODORC INTO ICODCLI,ICODFILIALCL;

/*Informaes do ItOrcamento.:*/

  SELECT CODEMPPD,CODFILIALPD,CODPROD,QTDITORC,PRECOITORC,PERCDESCITORC,VLRDESCITORC,
         VLRLIQITORC,VLRPRODITORC,REFPROD,OBSITORC FROM VDITORCAMENTO WHERE
         CODITORC=:ICODITORC AND CODORC=:ICODORC AND CODFILIAL=:ICODFILIAL AND CODEMP=:ICODEMP
         INTO ICODEMP,ICODFILIALPD,ICODPROD,IQTDITVENDA,VLRPRECOITVENDA,PERCDESCITVENDA,VLRDESCITVENDA,
           VLRLIQITVENDA,VLRPRODITVENDA,SREFPROD,:OBSITORC;

/*Informaes fiscais.:*/

  SELECT C.UFCLI FROM VDORCAMENTO O, VDCLIENTE C WHERE
    O.CODORC=:ICODORC AND O.CODFILIAL=:ICODFILIAL AND O.CODEMP=:ICODEMP AND
    C.CODCLI=O.CODCLI AND C.CODFILIAL=O.CODFILIALCL AND C.CODEMP=O.CODEMPCL
    INTO UFCLI;

  UFFLAG = 'N';

  SELECT 'S' FROM SGFILIAL  WHERE CODEMP=:ICODEMP
    AND CODFILIAL=:ICODFILIAL AND UFFILIAL=:UFCLI INTO UFFLAG;

  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'VDVENDA') INTO ICODFILIALIT;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'LFNATOPER') INTO ICODFILIALNT;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'LFTRATTRIB') INTO ICODFILIALTT;
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'LFMENSAGEM') INTO ICODFILIALME;

  SELECT C.ALIQIPIFISC,P.CLOTEPROD
    FROM VDITORCAMENTO IT, EQPRODUTO P, LFCLFISCAL C WHERE
    IT.CODEMP=:ICODEMP AND IT.CODFILIAL=:ICODFILIAL AND IT.CODITORC=:ICODITORC AND
    IT.CODORC=:ICODORC AND P.CODPROD = IT.CODPROD AND P.CODFILIAL = IT.CODFILIALPD AND
    P.CODEMP = IT.CODEMPPD AND C.CODFISC = P.CODFISC AND C.CODFILIAL = P.CODFILIALFC AND
    C.CODEMP = P.CODEMPFC INTO PERCIPIITVENDA,CLOTEPROD;

  SELECT CODTIPOMOV,CODFILIALTM FROM VDVENDA WHERE
    CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
    AND CODVENDA=:ICODVENDA AND TIPOVENDA='V'
  INTO ICODTIPOMOV,ICODFILIALTM;

  SELECT CODNAT FROM
    LFBUSCANATSP(:FILIALATUAL,:ICODEMP,:ICODFILIALPD,
      :ICODPROD,:ICODEMP,:ICODFILIALCL,:ICODCLI,
      NULL,NULL,NULL,:ICODFILIALTM,:ICODTIPOMOV)
    INTO SCODNAT;
    
  IF (SCODNAT IS NULL) THEN
    EXCEPTION VDITVENDAEX03;

  SELECT TIPOFISC,REDFISC,CODTRATTRIB,ORIGFISC,CODMENS,ALIQFISC FROM
    LFBUSCAFISCALSP(:FILIALATUAL,:ICODEMP,:ICODFILIALPD,:ICODPROD,:ICODEMP,:ICODFILIALCL,:ICODCLI)
    INTO TIPOFISC,PERCRED,SCODTRATTRIB,SORIGFISC,ICODMENS,PERCICMSITVENDA;

/*Cod Lote.:*/

  IF (CLOTEPROD = 'S') THEN
  BEGIN
    SELECT FIRST 1 L.CODLOTE FROM EQLOTE L WHERE
      L.CODPROD=:ICODPROD AND L.CODFILIAL=:ICODFILIALPD
       AND L.CODEMP=:ICODEMP AND L.VENCTOLOTE =
         (
           SELECT MIN(VENCTOLOTE) FROM EQLOTE LS WHERE LS.CODPROD=L.CODPROD AND LS.CODFILIAL=L.CODFILIAL
             AND LS.CODEMP=L.CODEMP AND LS.SLDLIQLOTE>=:IQTDITVENDA
         ) AND L.SLDLIQLOTE>=:IQTDITVENDA INTO SCODLOTE;
    ICODFILIALLE = ICODFILIALPD;
  END

  VLRLIQITVENDA = VLRPRODITVENDA - VLRDESCITVENDA;
  VLRBASEIPIITVENDA = 0;
  VLRBASEICMSITVENDA = 0;
  VLRICMSITVENDA = 0;
  VLRIPIITVENDA = 0;

  IF ( TIPOFISC = 'II') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'FF') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'NN') THEN
  BEGIN
    PERCICMSITVENDA = 0;
    VLRICMSITVENDA = 0;
    VLRBASEICMSITVENDA = 0;
    PERCIPIITVENDA = 0;
    VLRIPIITVENDA = 0;
    VLRBASEIPIITVENDA = 0;
  END
  ELSE IF ( TIPOFISC = 'TT') THEN
  BEGIN
    IF (PERCICMSITVENDA = 0 OR PERCICMSITVENDA IS NULL) THEN
      SELECT * FROM LFBUSCAICMSSP (:SCODNAT,:UFCLI,:ICODEMP,:ICODFILIAL) INTO PERCICMSITVENDA;
    IF (PERCRED IS NULL) THEN
      PERCRED = 0;
    VLRBASEICMSITVENDA = VLRPRODITVENDA - (VLRPRODITVENDA*(PERCRED/100));
    VLRBASEIPIITVENDA = VLRPRODITVENDA;
    VLRICMSITVENDA = VLRBASEICMSITVENDA*(PERCICMSITVENDA/100);
    VLRIPIITVENDA = VLRBASEIPIITVENDA*(PERCIPIITVENDA/100);
  END

  INSERT INTO VDITVENDA (CODEMP,CODFILIAL,CODVENDA,CODITVENDA,CODEMPNT,CODFILIALNT,CODNAT,CODEMPPD,
     CODFILIALPD,CODPROD,CODEMPLE,CODFILIALLE,CODLOTE,QTDITVENDA,PRECOITVENDA,PERCDESCITVENDA,VLRDESCITVENDA,
     PERCICMSITVENDA,VLRBASEICMSITVENDA,VLRICMSITVENDA,PERCIPIITVENDA,VLRBASEIPIITVENDA,VLRIPIITVENDA,
     VLRLIQITVENDA,VLRPRODITVENDA,REFPROD,ORIGFISC,CODEMPTT,CODFILIALTT,CODTRATTRIB,TIPOFISC,
     CODEMPME,CODFILIALME,CODMENS,OBSITVENDA) VALUES (:ICODEMP,:ICODFILIAL,:ICODVENDA,:ICODITVENDA,:ICODEMP,
     :ICODFILIALNT,:SCODNAT,:ICODEMP,:ICODFILIALPD,:ICODPROD,:ICODEMP,:ICODFILIALPD,:SCODLOTE,:IQTDITVENDA,
     :VLRPRECOITVENDA,:PERCDESCITVENDA,:VLRDESCITVENDA,:PERCICMSITVENDA,:VLRBASEICMSITVENDA,:VLRICMSITVENDA,
     :PERCIPIITVENDA,:VLRBASEIPIITVENDA,:VLRIPIITVENDA,:VLRLIQITVENDA,:VLRPRODITVENDA,:SREFPROD,:SORIGFISC,
     :ICODEMP,:ICODFILIALTT,:SCODTRATTRIB,:TIPOFISC,:ICODEMP,:ICODFILIALME,:ICODMENS,:OBSITORC);

  UPDATE VDITORCAMENTO SET EMITITORC='S' WHERE CODITORC=:ICODITORC AND CODORC=:ICODORC
    AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL;
    
  SELECT COUNT(*) FROM VDITORCAMENTO WHERE CODORC=:ICODORC
    AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND EMITITORC='S' INTO ICONTA1;
  SELECT COUNT(*) FROM VDITORCAMENTO WHERE CODORC=:ICODORC
    AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO ICONTA2;

  IF (ICONTA1 = ICONTA2) THEN
  BEGIN
    UPDATE VDORCAMENTO SET STATUSORC='OV' WHERE
      CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL AND
      CODORC=:ICODORC;
  END

  INSERT INTO VDVENDAORC (CODEMP,CODFILIAL,TIPOVENDA,CODVENDA,CODITVENDA,
                          CODEMPOR,CODFILIALOR,TIPOORC,CODORC,CODITORC) VALUES
                         (:ICODEMP,:ICODFILIAL,'V',:ICODVENDA,:ICODITVENDA,
                          :ICODEMP,:ICODFILIAL,'O',:ICODORC,:ICODITORC);
                         
    
    
end ^

ALTER PROCEDURE VDADICVENDAORCSP (ICODORC INTEGER,
ICODFILIAL SMALLINT,
ICODEMP INTEGER)
RETURNS (IRET INTEGER)
AS 

/*Variaveis buscadas:*/
  DECLARE VARIABLE ICODVENDA INTEGER;
  DECLARE VARIABLE IFILIALVD SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
  DECLARE VARIABLE IFILIALTM SMALLINT;
  DECLARE VARIABLE SSERIE CHAR(4);
  DECLARE VARIABLE IFILIALSE SMALLINT;
  DECLARE VARIABLE SSTATUSVENDA CHAR(2);
  DECLARE VARIABLE DPERCCOMVEND DECIMAL(9,2);
/*Variaveis herdadas do oramento:*/
  DECLARE VARIABLE ICODVEND INTEGER;
  DECLARE VARIABLE ICODFILIALVD INTEGER;
  DECLARE VARIABLE ICODCLI INTEGER;
  DECLARE VARIABLE ICODFILIALCL INTEGER;
  DECLARE VARIABLE ICODPLANOPAG INTEGER;
  DECLARE VARIABLE ICODFILIALPG INTEGER;
/*Variaveis temporrias:*/
  DECLARE VARIABLE USAPEDSEQ CHAR;
  DECLARE VARIABLE ICONTA INTEGER;

BEGIN

/*Cod. Tipo Mov e Sequencia:*/
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'EQTIPOMOV') INTO IFILIALTM;
  SELECT COUNT(P.TIPOPROD) FROM EQPRODUTO P, VDITORCAMENTO I WHERE
    P.CODPROD=I.CODPROD AND P.CODFILIAL=I.CODFILIALPD AND P.CODEMP=I.CODEMPPD
    AND P.TIPOPROD = 'S' AND I.CODORC=:ICODORC
    AND I.CODFILIAL=:ICODFILIAL AND I.CODEMP=:ICODEMP INTO ICONTA;
    
  IF (ICONTA > 0) THEN
    SELECT CODTIPOMOV4,USAPEDSEQ FROM SGPREFERE1
      WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
      INTO ICODTIPOMOV,USAPEDSEQ;
  IF (ICODTIPOMOV IS NULL) THEN  /* CASO AINDA O IF DE CIMA NAO TENHA PREECHIDO... */
    SELECT CODTIPOMOV3,USAPEDSEQ FROM SGPREFERE1
      WHERE CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL
      INTO ICODTIPOMOV,USAPEDSEQ;

/*Informaes basicas:*/

  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'VDVENDA') INTO IFILIALVD;
  IF (USAPEDSEQ='S') THEN
    SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALVD,'VD') INTO ICODVENDA;
  ELSE
    SELECT MAX(CODVENDA)+1 FROM VDVENDA
      WHERE CODEMP=:ICODEMP AND CODFILIAL=:IFILIALVD
      INTO ICODVENDA;

/*Serie:*/
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'LFSERIE') INTO IFILIALSE;
  SELECT SERIE FROM EQTIPOMOV WHERE CODEMP=:ICODEMP AND CODFILIAL=:IFILIALTM AND CODTIPOMOV=:ICODTIPOMOV INTO SSERIE;

/*Status:*/
  SSTATUSVENDA = 'P1';

/*Busca no oramento:*/
  SELECT O.CODFILIALVD,O.CODVEND,O.CODFILIALCL,O.CODCLI,O.CODFILIALPG,O.CODPLANOPAG,VE.PERCCOMVEND
         FROM VDORCAMENTO O, VDVENDEDOR VE WHERE O.CODORC=:ICODORC
    AND O.CODFILIAL=:ICODFILIAL AND O.CODEMP=:ICODEMP
    AND VE.CODEMP=O.CODEMP AND VE.CODFILIAL=O.CODFILIALVD
    AND VE.CODVEND=O.CODVEND INTO
           :ICODFILIALVD,:ICODVEND,:ICODFILIALCL,:ICODCLI,:ICODFILIALPG,:ICODPLANOPAG,DPERCCOMVEND;

  INSERT INTO VDVENDA (CODEMP,CODFILIAL,CODVENDA,CODEMPVD,CODFILIALVD,CODVEND,CODEMPCL,CODFILIALCL,CODCLI,
                CODEMPPG,CODFILIALPG,CODPLANOPAG,CODEMPSE,CODFILIALSE,SERIE,CODEMPTM,CODFILIALTM,
                CODTIPOMOV,DTSAIDAVENDA,DTEMITVENDA,STATUSVENDA,PERCCOMISVENDA) VALUES (
                :ICODEMP,:IFILIALVD,:ICODVENDA,:ICODEMP,:ICODFILIALVD,:ICODVEND,:ICODEMP,:ICODFILIALCL,:ICODCLI,
                :ICODEMP,:ICODFILIALPG,:ICODPLANOPAG,:ICODEMP,:IFILIALSE,:SSERIE,:ICODEMP,:IFILIALTM,
                :ICODTIPOMOV,CAST('today' AS DATE),CAST('today' AS DATE),:SSTATUSVENDA,:DPERCCOMVEND);

  IRET = ICODVENDA;

  SUSPEND;
END ^

ALTER PROCEDURE VDBAIXACOMISSAOSP (STIPO CHAR(1) CHARACTER SET NONE,
DINI DATE,
DFIM DATE,
ICODVEND INTEGER,
ICODEMPVD INTEGER,
ICODFILIALVD SMALLINT,
SCODCONTA CHAR(10) CHARACTER SET NONE,
ICODEMPCA INTEGER,
ICODFILIALCA SMALLINT,
SCODPLAN CHAR(13) CHARACTER SET NONE,
ICODEMPPN INTEGER,
ICODFILIALPN SMALLINT,
DDATA DATE,
IDOC INTEGER,
DVLR NUMERIC(15, 2),
SOBS CHAR(50) CHARACTER SET NONE,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
AS 

DECLARE VARIABLE ICODPCOMI INTEGER;
DECLARE VARIABLE ICODCOMI INTEGER;
DECLARE VARIABLE ICODEMPCOMI INTEGER;
DECLARE VARIABLE ICODFILIALCOMI INTEGER;
DECLARE VARIABLE CFLAG CHAR(1);
DECLARE VARIABLE IFILIALPCOMI INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(:ICODEMP,'FNPAGTOCOMI') INTO IFILIALPCOMI;
  SELECT ISEQ FROM SPGERANUM(:ICODEMP,:IFILIALPCOMI,'CI') INTO ICODPCOMI;
  INSERT INTO FNPAGTOCOMI(CODEMP,CODFILIAL,CODPCOMI,CODEMPCA,CODFILIALCA,NUMCONTA,CODEMPPN,CODFILIALPN,CODPLAN,DATAPCOMI,DOCPCOMI,VLRPCOMI,OBSPCOMI)
         VALUES (
                :ICODEMP,:IFILIALPCOMI,:iCodPComi,:ICODEMPCA,:ICODFILIALCA,:sCodConta,:ICODEMPPN,:ICODFILIALPN,:sCodPlan,:dData,:iDoc,:dVlr,:sObs
         );
  FOR SELECT C.CODCOMI,C.CODEMP,C.CODFILIAL,C.FLAG FROM VDCOMISSAO C,FNRECEBER R WHERE R.CODVEND=:iCodVend
               AND R.CODEMPVD=:ICODEMPVD AND R.CODFILIALVD=:ICODFILIALVD
               AND C.CODREC=R.CODREC AND C.CODEMPRC=R.CODEMP AND C.CODFILIALRC=R.CODFILIAL
               AND ( (:STIPO='E') OR  (C.DTVENCCOMI BETWEEN :dIni AND :dFim) )
               AND ( (:STIPO='V') OR  (C.DATACOMI BETWEEN :dIni AND :dFim) )
               AND STATUSCOMI='C2'
               AND R.CODEMP=:ICODEMP AND R.CODFILIAL=:ICODFILIAL
               INTO :iCodComi,:iCodEmpComi,:iCodFilialComi,:cFLAG DO
  BEGIN
     UPDATE VDCOMISSAO SET VLRPAGOCOMI=VLRAPAGCOMI, CODPCOMI=:iCodPComi,CODEMPCI=:ICODEMP,
        CODFILIALCI=:IFILIALPCOMI,STATUSCOMI='CP',DTPAGTOCOMI=:dData,FLAG=:cFLAG
      WHERE CODCOMI=:iCodComi AND CODEMP=:iCodEmpComi AND CODFILIAL=:iCodFilialComi;
  END
END ^

ALTER PROCEDURE VDBLOQVENDASP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
CTIPOVENDA CHAR(1) CHARACTER SET NONE,
ICODVENDA INTEGER,
CBLOQVENDA CHAR(1) CHARACTER SET NONE)
AS 

begin
  /* Stored procedure de bloqueio e desbloqueio de venda*/
  UPDATE VDVENDA SET EMMANUT='S', BLOQVENDA=:CBLOQVENDA WHERE CODEMP=:ICODEMP AND
     CODFILIAL=:SCODFILIAL AND TIPOVENDA=:CTIPOVENDA AND CODVENDA=:ICODVENDA;
  UPDATE VDVENDA SET EMMANUT='N' WHERE CODEMP=:ICODEMP AND
     CODFILIAL=:SCODFILIAL AND TIPOVENDA=:CTIPOVENDA AND CODVENDA=:ICODVENDA;
  suspend;
end ^

ALTER PROCEDURE VDBUSCAPRECOSP (ICODPROD INTEGER,
ICODCLI INTEGER,
ICODEMPCL INTEGER,
ICODFILIALCL SMALLINT,
ICODPLANOPAG INTEGER,
ICODEMPPG INTEGER,
ICODFILIALPG SMALLINT,
ICODTIPOMOV INTEGER,
ICODEMPTM INTEGER,
ICODFILIALTM SMALLINT,
ICODEMP INTEGER,
ICODFILIAL SMALLINT)
RETURNS (PRECO NUMERIC(18, 2))
AS 

DECLARE VARIABLE iCodTab INTEGER;
  DECLARE VARIABLE iCodEmpTab INTEGER;
  DECLARE VARIABLE iCodFilialTab SMALLINT;
  DECLARE VARIABLE iCodClasCli INTEGER;
  DECLARE VARIABLE iCodEmpClasCli INTEGER;
  DECLARE VARIABLE iCodFilialClasCli SMALLINT;
BEGIN
  SELECT CODTAB,CODEMPTB,CODFILIALTB FROM EQTIPOMOV WHERE CODTIPOMOV=:iCodTipoMov
         AND CODEMP=:ICODEMPTM AND CODFILIAL=:ICODFILIALTM INTO :iCodTab,:iCodEmpTab,:iCodFilialTab;
  SELECT CODCLASCLI,CODEMPCC,CODFILIALCC FROM VDCLIENTE WHERE CODCLI=:iCodCli
         AND CODEMP=:ICODEMPCL AND CODFILIAL=:ICODFILIALCL INTO :iCodClasCli,:iCodEmpClasCli,iCodFilialClasCli;
  SELECT PRECOPROD FROM VDPRECOPROD WHERE CODPROD=:iCodProd
         AND CODPLANOPAG=:iCodPlanoPag
         AND CODEMPPG=:ICODEMPPG
         AND CODFILIALPG=:ICODFILIALPG
         AND CODTAB=:iCodTab
         AND CODEMPTB=:iCodEmpTab
         AND CODFILIALTB=:iCodFilialTab
         AND CODCLASCLI=:iCodClasCli
         AND CODEMPCC=:iCodEmpClasCli
         AND CODFILIALCC=:iCodFilialClasCli
         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :Preco;
  if ((Preco IS NULL) OR (Preco = 0)) THEN
  BEGIN
    SELECT MAX(PRECOPROD) FROM VDPRECOPROD WHERE CODPROD=:iCodProd
         AND CODPLANOPAG=:iCodPlanoPag
         AND CODEMPPG=:ICODEMPPG
         AND CODFILIALPG=:ICODFILIALPG
         AND CODTAB=:iCodTab
         AND CODEMPTB=:iCodEmpTab
         AND CODFILIALTB=:iCodFilialTab
         AND CODCLASCLI IS NULL
         AND CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :Preco;
  END
  /*Se ainda no conseguiu pagar o preco.*/
  if ((Preco IS NULL) OR (Preco = 0)) THEN
  BEGIN
    SELECT PRECOBASEPROD FROM EQPRODUTO WHERE CODPROD=:ICODPROD AND
      CODEMP=:ICODEMP AND CODFILIAL=:ICODFILIAL INTO :Preco;
  END
  SUSPEND;
END ^

ALTER PROCEDURE VDCOPIAORCSP (CODEMP INTEGER,
CODFILIAL INTEGER,
CODORC INTEGER,
CODFILIALCL INTEGER,
CODCLI INTEGER)
RETURNS (IRET INTEGER)
AS 

DECLARE VARIABLE ICODORC INTEGER;
BEGIN
  SELECT ISEQ FROM SPGERANUM(:CODEMP,:CODFILIAL,'OC') INTO ICODORC;
  INSERT INTO VDORCAMENTO (CODEMP,CODFILIAL,TIPOORC,CODORC,
    CODEMPAE,CODFILIALAE,CODATEND,CODEMPCV,CODFILIALCV,CODCONV,
    DTORC,DTVENCORC,VLRPRODORC,PERCDESCORC,VLRDESCORC,VLRADICORC,
    VLRDESCITORC,VLRLIQORC,STATUSORC,OBSORC,CODPLANOPAG,CODFILIALPG,
    CODEMPPG,TXT01,CODEMPVD,CODFILIALVD,CODVEND,CODEMPCL,CODFILIALCL,
    CODCLI,CODTPCONV,CODFILIALTC,CODEMPTC,PRAZOENTORC)
    SELECT CODEMP,CODFILIAL,'O',:ICODORC,CODEMPAE,CODFILIALAE,
      CODATEND,CODEMPCV,CODFILIALCV,CODCONV,DTORC,DTVENCORC,VLRPRODORC,
      PERCDESCORC,VLRDESCORC,VLRADICORC,VLRDESCITORC,VLRLIQORC,
      STATUSORC,OBSORC,CODPLANOPAG,CODFILIALPG,CODEMPPG,TXT01,CODEMPVD,
      CODFILIALVD,CODVEND,:CODEMP,:CODFILIALCL,:CODCLI,CODTPCONV,
      CODFILIALTC,CODEMPTC,PRAZOENTORC FROM VDORCAMENTO WHERE
      CODORC=:CODORC AND CODEMP=:CODEMP AND CODFILIAL=:CODFILIAL;

  INSERT INTO VDITORCAMENTO (CODEMP,CODFILIAL,TIPOORC,CODORC,CODITORC,
    CODEMPPD,CODFILIALPD,CODPROD,QTDITORC,PRECOITORC,PERCDESCITORC,
    VLRDESCITORC,VLRLIQITORC,VLRPRODITORC,REFPROD,NUMAUTORIZORC,ACEITEITORC,
    APROVITORC,EMITITORC,VENCAUTORIZORC,STRDESCITORC,OBSITORC)
    SELECT CODEMP,CODFILIAL,TIPOORC,:ICODORC,CODITORC,
      CODEMPPD,CODFILIALPD,CODPROD,QTDITORC,PRECOITORC,PERCDESCITORC,
      VLRDESCITORC,VLRLIQITORC,VLRPRODITORC,REFPROD,NUMAUTORIZORC,ACEITEITORC,
      APROVITORC,EMITITORC,VENCAUTORIZORC,STRDESCITORC,OBSITORC
      FROM VDITORCAMENTO WHERE CODORC=:CODORC AND CODEMP=:CODEMP
      AND CODFILIAL=:CODFILIAL;
  IRET = ICODORC;
  SUSPEND;
END ^

ALTER PROCEDURE VDDESBAIXACOMISSAOSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODVEND INTEGER,
CORDEM CHAR(1) CHARACTER SET NONE,
DINI DATE,
DFIM DATE)
AS 

DECLARE VARIABLE SCODFILIALCI SMALLINT;
DECLARE VARIABLE ICODPCOMI INTEGER;
DECLARE VARIABLE IQTD INTEGER;
begin
  /* Procedure Text */
  FOR SELECT CODFILIALCI,CODPCOMI,COUNT(*)
     FROM VDCOMISSAO C, FNRECEBER R
     WHERE R.CODEMPVD = :ICODEMP AND R.CODFILIALVD = :SCODFILIAL AND R.CODVEND = :ICODVEND AND
        C.CODREC = R.CODREC AND C.CODEMPRC = R.CODEMP AND C.CODFILIALRC = R.CODFILIAL AND
        C.STATUSCOMI = 'CP' AND C.CODPCOMI IS NOT NULL AND
         ( (:CORDEM = 'V')  OR (C.DATACOMI BETWEEN :DINI AND :DFIM) ) AND
         ( (:CORDEM = 'E')  OR (C.DTVENCCOMI BETWEEN :DINI AND :DFIM) )
         GROUP BY CODFILIALCI,CODPCOMI
         INTO  :SCODFILIALCI, :ICODPCOMI, :IQTD
         DO
     BEGIN
        UPDATE VDCOMISSAO SET STATUSCOMI='CD'
           WHERE CODEMPCI=:ICODEMP AND
             CODFILIALCI=:SCODFILIALCI AND
             CODPCOMI=:ICODPCOMI;
        DELETE FROM FNPAGTOCOMI
           WHERE CODEMP=:ICODEMP AND
             CODFILIAL=:SCODFILIALCI AND
             CODPCOMI=:ICODPCOMI;
     END
  suspend;
end ^

ALTER PROCEDURE VDESTORNACOMISSAOSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODEMPVD INTEGER,
SCODFILIALVD SMALLINT,
ICODVEND INTEGER,
DINI DATE,
DFIM DATE,
CORDEM CHAR(1) CHARACTER SET NONE)
AS 

DECLARE VARIABLE ICODCOMI INTEGER;
DECLARE VARIABLE ICODEMPRC INTEGER;
DECLARE VARIABLE SCODFILIALRC SMALLINT;
DECLARE VARIABLE ICODREC INTEGER;
DECLARE VARIABLE INPARCITREC INTEGER;
DECLARE VARIABLE NVLRVENDACOMI NUMERIC(15,3);
DECLARE VARIABLE NVLRCOMI NUMERIC(15,3);
DECLARE VARIABLE DDATACOMI DATE;
DECLARE VARIABLE DDTVENCCOMI DATE;
DECLARE VARIABLE CTIPOCOMI CHAR(1);
DECLARE VARIABLE CSTATUSCOMI CHAR(2);
DECLARE VARIABLE DATUAL DATE;
DECLARE VARIABLE CSTATUSITREC CHAR(2);
DECLARE VARIABLE DDTVENCITREC DATE;
begin
  /* Procedure Text */
  DATUAL = CAST( 'now' AS DATE);
  FOR SELECT C.CODCOMI,C.CODEMPRC, C.CODFILIALRC , C.CODREC, C.NPARCITREC,
      C.VLRVENDACOMI, C.VLRCOMI, C.DATACOMI , C.DTVENCCOMI,
      C.TIPOCOMI, C.STATUSCOMI , IR.STATUSITREC, IR.DTVENCITREC
    FROM VDCOMISSAO C, FNITRECEBER IR, FNRECEBER R
    WHERE C.CODEMP=:ICODEMP AND C.CODFILIAL=:SCODFILIAL AND
       IR.CODEMP=C.CODEMPRC AND IR.CODFILIAL=C.CODFILIALRC AND
       IR.CODREC=C.CODREC AND IR.NPARCITREC=C.NPARCITREC AND
       R.CODEMP=C.CODEMPRC AND R.CODFILIAL=C.CODFILIALRC AND
       R.CODREC=C.CODREC AND R.CODEMPVD=:ICODEMPVD AND
       R.CODFILIALVD=:SCODFILIALVD AND R.CODVEND=:ICODVEND AND
       ( (:CORDEM = 'V')  OR (C.DATACOMI BETWEEN :DINI AND :DFIM) ) AND
       ( (:CORDEM = 'E')  OR (C.DTVENCCOMI BETWEEN :DINI AND :DFIM) ) AND
       C.STATUSCOMI IN ('C2','CP') AND
       IR.STATUSITREC NOT IN ('RP') AND
       NOT EXISTS(SELECT * FROM VDCOMISSAO C2 -- Sub-select para verificar a
          -- existencia de estorno anterior.
         WHERE C2.CODEMPRC=C.CODEMPRC AND C2.CODFILIALRC=C.CODFILIALRC AND
         C2.CODREC=C.CODREC AND C2.NPARCITREC=C.NPARCITREC AND
         C2.TIPOCOMI=C.TIPOCOMI AND C2.STATUSCOMI IN ('CE') )
    INTO :ICODCOMI, :ICODEMPRC, :SCODFILIALRC, :ICODREC, :INPARCITREC, :NVLRVENDACOMI,
      :NVLRCOMI, :DDATACOMI, :DDTVENCCOMI, :CTIPOCOMI, :CSTATUSCOMI, :CSTATUSITREC,
      :DDTVENCITREC
  DO
  BEGIN
     IF ( (DATUAL>DDTVENCITREC) AND (CSTATUSCOMI='C2') ) THEN
     --Caso a data atual seja maior que a data de vencimento e a
     -- comisso no esteja paga, passa o status da comisso para no
     -- liberada.
     BEGIN
        UPDATE VDCOMISSAO SET STATUSCOMI='C1'
          WHERE CODEMP=:ICODEMP AND CODFILIAL=:SCODFILIAL AND
            CODCOMI=:ICODCOMI;
     END
     ELSE IF ( (DATUAL>DDTVENCITREC) AND (CSTATUSCOMI='CP') ) THEN
     --Caso a comisso esteja paga e a parcela esteja vencida,
     -- gera um estorno da comisso.
     BEGIN
        NVLRCOMI = NVLRCOMI * -1; -- Transforma o valor da comisso em negativo
        -- para gerar estorno
        EXECUTE PROCEDURE vdadiccomissaosp(:ICODEMPRC,:SCODFILIALRC,:ICODREC,
          :INPARCITREC, :NVLRVENDACOMI, :NVLRCOMI, :DDATACOMI , :DDTVENCITREC,
          :CTIPOCOMI );
     END
  END
  suspend;
end ^

ALTER PROCEDURE VDEVOLUVENDAS (ICODEMP SMALLINT,
ICODFILIAL SMALLINT,
DATAINI DATE,
DATAFIM DATE,
ICODTIPOCLI SMALLINT,
ICODCLI SMALLINT)
RETURNS (VALOR NUMERIC(15, 3),
MES SMALLINT,
ANO SMALLINT)
AS 

declare variable VALORTMP DECIMAL(15,3);
declare variable DATATMP DATE;
declare variable MESTMP SMALLINT;
declare variable ANOTMP SMALLINT;
declare variable MESANT SMALLINT;
declare variable ANOANT SMALLINT;
declare variable VALORANT DECIMAL(15,3);
declare variable ENVIOU CHAR(1);
begin
  /* Retorna os valores de vendas por perodo */
  VALOR = 0;
  VALORANT = 0;
  ENVIOU = 'N';
  FOR select sum(v.vlrliqvenda),v.dtemitvenda from vdvenda v, vdcliente c
             where c.codcli=v.codcli and c.codemp=v.codempcl and c.codfilial=v.codfilialcl
             and v.dtemitvenda between :DATAINI and :DATAFIM and v.codemp = :ICODEMP
             and v.codfilial = :ICODFILIAL
             and ( (c.codtipocli=:ICODTIPOCLI) or (:ICODTIPOCLI is null) )
             and ( (v.codcli=:ICODCLI) or (:ICODCLI is null) )
             group by v.dtemitvenda order by v.dtemitvenda
      into VALORTMP,DATATMP do
      BEGIN
        MESTMP = extract(MONTH from DATATMP);
        ANOTMP = extract(YEAR from DATATMP);
        VALOR=VALOR+VALORANT;
        MES=MESANT;
        ANO=ANOANT;
        if ((not MESANT = MESTMP or not ANOANT = ANOTMP) AND not MESANT is null) then
        begin
          suspend;
          ENVIOU = 'S';
          VALOR = 0;
          MESANT=MESTMP;
          ANOANT=ANOTMP;
          VALORANT=VALORTMP;
        end
        ELSE
        BEGIN
          MESANT=MESTMP;
          ANOANT=ANOTMP;
          VALORANT=VALORTMP;
        END
      END

     VALOR=VALOR+VALORANT;
     MES=MESANT;
     ANO=ANOANT;
     suspend;
end ^

ALTER PROCEDURE VDGERACOMISSAOSP (ICODEMP INTEGER,
SCODFILIAL SMALLINT,
ICODREC INTEGER,
INPARCITREC INTEGER,
NVLRCOMIITREC NUMERIC(15, 3),
DDTVENCITREC DATE)
AS 

DECLARE VARIABLE ICODEMPVA INTEGER;
DECLARE VARIABLE SCODFILIALVA SMALLINT;
DECLARE VARIABLE CTIPOVENDA CHAR(3);
DECLARE VARIABLE ICODVENDA INTEGER;
DECLARE VARIABLE ICODEMPCM INTEGER;
DECLARE VARIABLE SCODFILIALCM SMALLINT;
DECLARE VARIABLE ICODCLCOMIS INTEGER;
DECLARE VARIABLE NVLRVENDACOMI NUMERIC(15,3);
DECLARE VARIABLE DDATACOMI DATE;
DECLARE VARIABLE NPERCFATCLCOMIS NUMERIC(9,2);
DECLARE VARIABLE NPERCPGTOCLCOMIS NUMERIC(9,2);
DECLARE VARIABLE CTIPOCOMI CHAR(1);
DECLARE VARIABLE NVLRCOMI NUMERIC(15,3);
DECLARE VARIABLE I INTEGER;
begin
  /* Gera as comisses a pagar na tabela VDCOMISSAO */
  SELECT R.CODEMPVA,R.CODFILIALVA,R.TIPOVENDA,R.CODVENDA,
         V.CODEMPCM, V.CODFILIALCM, V.CODCLCOMIS, ( V.VLRPRODVENDA - V.VLRDESCVENDA ),
         V.DTEMITVENDA, CM.PERCFATCLCOMIS, CM.PERCPGTOCLCOMIS
        FROM FNRECEBER R, VDVENDA V, VDCLCOMIS CM
        WHERE R.CODEMP=:iCodEmp AND R.CODFILIAL=:sCodFilial AND R.CODREC=:iCodRec AND
         V.CODEMP=R.CODEMPVA AND V.CODFILIAL=R.CODFILIALVA AND V.TIPOVENDA=R.TIPOVENDA AND
         V.CODVENDA=R.CODVENDA AND CM.CODEMP=V.CODEMPCM AND CM.CODFILIAL=V.CODFILIALCM AND
         CM.CODCLCOMIS=V.CODCLCOMIS
        INTO :ICODEMPVA, :SCODFILIALVA, :CTIPOVENDA, :ICODVENDA,
         :ICODEMPCM, :SCODFILIALCM, :ICODCLCOMIS, :NVLRVENDACOMI,
         :DDATACOMI, :NPERCFATCLCOMIS, :NPERCPGTOCLCOMIS ;
   I = 1;
   WHILE (:I<=2) DO
   BEGIN
       if (I=1) then
       begin
          CTIPOCOMI='F';
          NVLRCOMI = cast( (nVlrComiItRec * nPercFatClComis / 100 ) as Numeric(15,2));
       end
       else
       begin
          CTIPOCOMI='R';
          NVLRCOMI = cast( (nVlrComiItRec * nPercPgtoClComis / 100 ) as Numeric(15,2));
       end
       EXECUTE PROCEDURE vdadiccomissaosp(:iCodEmp, :sCodFilial, :iCodRec, :iNParcItRec,
         :nVlrVendaComi, :nVlrComi, :dDataComi, :dDtVencItRec, cTipoComi );
       I=I+1;
   END
  suspend;
end ^

ALTER PROCEDURE VDGERAESTORNOCOMISP AS 

begin
  /* Procedure Text */

  suspend;
end ^
SET TERM ; ^
COMMIT WORK ;
SET AUTODDL ON;
SET TERM ^ ;

/* Triggers only will work for SQL triggers */
CREATE TRIGGER ATAGENDATGBU FOR ATAGENDA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);

  /* Trigger Text */
end ^
 
CREATE TRIGGER ATATENDENTETGBU FOR ATATENDENTE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATATENDIMENTTGBU FOR ATATENDIMENTO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
   new.DTALT=cast('now' AS DATE );
   new.IDUSUALT=USER;
   new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATATENDIMENTOORCTGBU FOR ATATENDIMENTOORC 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATATRIBUICAOTGBU FOR ATATRIBUICAO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATCONVATRIBTGBU FOR ATCONVATRIB 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATCONVATRIBTBTGBU FOR ATCONVATRIBTB 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATCONVENIADOTGBI FOR ATCONVENIADO 
ACTIVE BEFORE INSERT POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATCONVENIADOTGAI FOR ATCONVENIADO 
ACTIVE AFTER INSERT POSITION 0 
as
declare variable ICODATEND INTEGER;
declare variable ICODATENDO INTEGER;
declare variable ICODSETOR INTEGER;
DECLARE VARIABLE IFILIALATEND INTEGER;
DECLARE VARIABLE IFILIALPREF INTEGER;
DECLARE VARIABLE IFILIALUSU INTEGER;
BEGIN

  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'ATATENDENTE') INTO IFILIALATEND;
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE2') INTO IFILIALPREF;
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGUSUARIO') INTO IFILIALUSU;

  SELECT CODATEND FROM ATATENDENTE
    WHERE CODEMP=new.CODEMP AND CODFILIAL=:IFILIALATEND
    AND IDUSU=LOWER(USER) AND CODEMPUS=new.CODEMP AND CODFILIALUS=:IFILIALUSU
    INTO ICODATEND;

  SELECT CODSETAT,CODTPATENDO2 FROM SGPREFERE2
    WHERE CODEMP=new.CODEMP AND CODFILIAL=:IFILIALPREF
    INTO ICODSETOR,ICODATENDO;

  EXECUTE PROCEDURE ATADICATENDIMENTOSP(
    new.CODCONV,:ICODATENDO,:ICODATEND,
    ICODSETOR,NULL,new.CODEMP,:IFILIALUSU,new.CODCONV
  );

end ^
 
CREATE TRIGGER ATCONVENIADOTGBU FOR ATCONVENIADO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATENCAMINHADORTGBU FOR ATENCAMINHADOR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATSETORTGBU FOR ATSETOR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATSETORATENDENTETGBU FOR ATSETORATENDENTE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATTIPOATENDTGBU FOR ATTIPOATEND 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATTIPOATENDOTGBU FOR ATTIPOATENDO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATTIPOATENDOSETORTGBU FOR ATTIPOATENDOSETOR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER ATTIPOCONVTGBU FOR ATTIPOCONV 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER CPCOMPRATGBI FOR CPCOMPRA 
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE IFILIALTIPOMOV INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'EQTIPOMOV') INTO IFILIALTIPOMOV;
  SELECT T.FISCALTIPOMOV FROM EQTIPOMOV T WHERE T.CODTIPOMOV=new.CODTIPOMOV
         AND T.CODEMP=new.CODEMP AND T.CODFILIAL=:IFILIALTIPOMOV INTO new.FLAG;
  IF ( new.FLAG <> 'S') THEN
  BEGIN
    new.FLAG = 'N';
  END
  new.STATUSCOMPRA = 'P1';
  IF (new.VLRPRODCOMPRA IS NULL) THEN new.VLRPRODCOMPRA = 0;
  IF (new.VLRDESCCOMPRA IS NULL) THEN new.VLRDESCCOMPRA = 0;
  IF (new.VLRDESCITCOMPRA IS NULL) THEN new.VLRDESCITCOMPRA = 0;
  IF (new.VLRCOMPRA IS NULL) THEN new.VLRCOMPRA = 0;
  IF (new.VLRBASEICMSCOMPRA IS NULL) THEN new.VLRBASEICMSCOMPRA = 0;
  IF (new.VLRICMSCOMPRA IS NULL) THEN new.VLRICMSCOMPRA = 0;
  IF (new.VLRISENTASCOMPRA IS NULL) THEN new.VLRISENTASCOMPRA = 0;
  IF (new.VLROUTRASCOMPRA IS NULL) THEN new.VLROUTRASCOMPRA = 0;
  IF (new.VLRBASEIPICOMPRA IS NULL) THEN new.VLRBASEIPICOMPRA = 0;
  IF (new.VLRIPICOMPRA IS NULL) THEN new.VLRIPICOMPRA = 0;
  IF (new.VLRLIQCOMPRA IS NULL) THEN new.VLRLIQCOMPRA = 0;
  IF (new.VLRFRETECOMPRA IS NULL) THEN new.VLRFRETECOMPRA = 0;
  IF (new.VLRADICCOMPRA IS NULL) THEN new.VLRADICCOMPRA = 0;
END ^
 
CREATE TRIGGER CPCOMPRATGBU FOR CPCOMPRA 
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE dVlrPagar DECIMAL(15,2);
  DECLARE VARIABLE sStatusPag CHAR(2);
  DECLARE VARIABLE IFILIALTIPOMOV INTEGER;
  DECLARE VARIABLE IFILIALPAG INTEGER;
BEGIN
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  if (new.BLOQCOMPRA IS NULL) then
     new.BLOQCOMPRA='N';
  if ( ( (old.BLOQCOMPRA IS  NULL) OR (old.BLOQCOMPRA='N') ) AND (new.BLOQCOMPRA='S') )  then
  begin
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=user;
      new.HALT=cast('now' AS TIME);
  end
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      if ( (old.BLOQCOMPRA IS NOT NULL AND old.BLOQCOMPRA='S') or (new.BLOQCOMPRA='S') ) then
         EXCEPTION CPCOMPRAEX04 'ESTA COMPRA EST BLOQUEADA!!!';
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'EQTIPOMOV') INTO IFILIALTIPOMOV;
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
      SELECT T.FISCALTIPOMOV FROM EQTIPOMOV T WHERE T.CODTIPOMOV=new.CODTIPOMOV
             AND T.CODEMP=new.CODEMP AND T.CODFILIAL = :IFILIALTIPOMOV INTO new.FLAG;
      IF ( new.FLAG <> 'S') THEN
      BEGIN
        new.FLAG = 'N';
      END
      IF (new.VLRDESCCOMPRA IS NULL) THEN
        new.VLRDESCCOMPRA = 0;
      IF (new.VLRADICCOMPRA IS NULL) THEN
        new.VLRADICCOMPRA = 0;
      IF (new.VLRFRETECOMPRA IS NULL) THEN
        new.VLRFRETECOMPRA = 0;
      IF (old.STATUSCOMPRA = 'P1')  THEN
      BEGIN
        IF (new.STATUSCOMPRA = 'C1') THEN
        BEGIN
          new.STATUSCOMPRA = 'C2';
        END
      END
      ELSE IF ((old.STATUSCOMPRA IN ('P4','C4')) AND (new.STATUSCOMPRA IN ('P4','C4'))) THEN
      BEGIN
        EXCEPTION CPCOMPRAEX03;
      END
      ELSE IF ((old.STATUSCOMPRA IN ('P2','C2')) AND (new.STATUSCOMPRA IN ('P3','C3'))) THEN
      BEGIN
        SELECT STATUSPAG,VLRPARCPAG FROM FNPAGAR WHERE CODCOMPRA=new.CODCOMPRA
             AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPAG INTO :sStatusPag,:dVlrPagar;
        IF ((sStatusPag = 'PD') AND (new.VLRLIQCOMPRA != :dVlrPagar)) THEN
          EXCEPTION CPCOMPRAEX04;
      END
  END
END ^
 
CREATE TRIGGER CPCOMPRATGAU FOR CPCOMPRA 
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE iCodPag INTEGER;
  DECLARE VARIABLE dVLR DECIMAL(15,2);
  DECLARE VARIABLE IFILIALPAG INTEGER;
  DECLARE VARIABLE TIPOMOV CHAR(2);
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN

      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
      SELECT CODPAG FROM FNPAGAR WHERE CODCOMPRA=new.CODCOMPRA
             AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPAG INTO iCodPag;
      SELECT TIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
             AND CODEMP=new.CODEMPTM AND CODFILIAL=new.CODFILIALTM INTO TIPOMOV;

      IF ((NOT TIPOMOV IN ('DV','TR')) AND (
         (iCodPag IS NULL) OR (
         (new.CODPLANOPAG != old.CODPLANOPAG) OR
         (new.CODFOR != old.CODFOR) OR
         (new.VLRLIQCOMPRA != old.VLRLIQCOMPRA) OR
         (new.DTENTCOMPRA != old.DTENTCOMPRA) OR
         (new.DOCCOMPRA != old.DOCCOMPRA) OR
         (new.CODBANCO != old.CODBANCO)))) THEN
      BEGIN
        dVLR = new.VLRLIQCOMPRA;
        IF ((new.STATUSCOMPRA IN ('P2','C2')) AND (old.STATUSCOMPRA IN ('P1','C1'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALPAG;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA,new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,new.CODEMPFR,new.CODFILIALFR,new.CODFOR,:dVLR,new.DTENTCOMPRA,new.DOCCOMPRA,new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,new.FLAG,new.CODEMP,new.CODFILIAL);
        END
        ELSE IF ((new.STATUSCOMPRA IN ('P2','C2')) AND (old.STATUSCOMPRA IN ('P2','C2'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA,new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,new.CODEMPFR,new.CODFILIALFR,new.CODFOR,:dVLR,new.DTENTCOMPRA,new.DOCCOMPRA,new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,new.FLAG,new.CODEMP,new.CODFILIAL);
        END
        ELSE IF ((new.STATUSCOMPRA IN ('P3','C3')) AND (old.STATUSCOMPRA IN ('P3','C3'))) THEN
        BEGIN
          DELETE FROM FNPAGAR WHERE CODCOMPRA=old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL = :IFILIALPAG;
          IF (dVlr > 0) THEN
            EXECUTE PROCEDURE FNADICPAGARSP01(new.CODCOMPRA,new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,new.CODEMPFR,new.CODFILIALFR,new.CODFOR,:dVLR,new.DTENTCOMPRA,new.DOCCOMPRA,new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,new.FLAG,new.CODEMP,new.CODFILIAL);
        END
      END

    /**
     Movimento do estoque
    **/

    -- Avisa os itens que a data de saida foi alterada
      IF ( (new.DTENTCOMPRA != old.DTENTCOMPRA) OR
           (new.DOCCOMPRA != old.DOCCOMPRA) OR
           (new.CODTIPOMOV != old.CODTIPOMOV) )  THEN
        UPDATE CPITCOMPRA SET CODITCOMPRA=CODITCOMPRA WHERE
             CODCOMPRA = old.CODCOMPRA AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
    END
END ^
 
CREATE TRIGGER CPCOMPRATGBD FOR CPCOMPRA 
ACTIVE BEFORE DELETE POSITION 0 
AS
begin
  /* Trigger text */
  if ( old.BLOQCOMPRA IS NOT NULL AND old.BLOQCOMPRA='S'  ) then
      EXCEPTION CPCOMPRAEX04 'ESTA COMPRA EST BLOQUEADA!!!';
end ^
 
CREATE TRIGGER CPEQUIVCFOPTGBU FOR CPEQUIVCFOP 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER CPFORNECEDTGBU FOR CPFORNECED 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER CPITCOMPRATGBI FOR CPITCOMPRA 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE sTipoFisc CHAR(2);
DECLARE VARIABLE sRefProd CHAR(13);
DECLARE VARIABLE sCustoSICMS CHAR(1);
BEGIN
  SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO sRefProd;
  IF (new.REFPROD IS NULL) THEN new.REFPROD = sRefProd;
  IF (new.VLRDESCITCOMPRA IS NULL) THEN new.VLRDESCITCOMPRA = 0;
  IF (new.VLRBASEICMSITCOMPRA IS NULL) THEN new.VLRBASEICMSITCOMPRA = 0;
  IF (new.VLRICMSITCOMPRA IS NULL) THEN new.VLRICMSITCOMPRA = 0;
  IF (new.VLRBASEIPIITCOMPRA IS NULL) THEN new.VLRBASEIPIITCOMPRA = 0;
  IF (new.VLRIPIITCOMPRA IS NULL) THEN new.VLRIPIITCOMPRA = 0;
  IF (new.VLRLIQITCOMPRA IS NULL) THEN new.VLRLIQITCOMPRA = 0;
  IF (new.VLRADICITCOMPRA IS NULL) THEN new.VLRADICITCOMPRA = 0;
  IF (new.VLRFRETEITCOMPRA IS NULL) THEN new.VLRFRETEITCOMPRA = 0;
  SELECT F.TIPOFISC FROM LFCLFISCAL F, EQPRODUTO P WHERE P.CODPROD=new.CODPROD AND
    F.CODFISC = P.CODFISC AND F.CODEMP=P.CODEMP AND F.CODFILIAL=P.CODFILIAL
         AND P.CODEMP=new.CODEMPPD AND P.CODFILIAL = new.CODFILIALPD INTO :sTipoFisc;
/*
  IF (sTipoFisc = 'II') THEN
  BEGIN
    new.VLRISENTASITCOMPRA = new.VLRLIQITCOMPRA;
    new.VLRBASEICMSITCOMPRA = 0;
    new.PERCICMSITCOMPRA = 0;
    new.VLRICMSITCOMPRA = 0;
    new.VLROUTRASITCOMPRA = 0;
  END
  ELSE IF (sTipoFisc = 'FF') THEN
  BEGIN
    new.VLROUTRASITCOMPRA = new.VLRLIQITCOMPRA;
    new.VLRBASEICMSITCOMPRA = 0;
    new.PERCICMSITCOMPRA = 0;
    new.VLRICMSITCOMPRA = 0;
    new.VLRISENTASITCOMPRA = 0;
  END
  ELSE IF (sTipoFisc = 'NN') THEN
  BEGIN
    new.VLROUTRASITCOMPRA = new.VLRLIQITCOMPRA;
    new.VLRBASEICMSITCOMPRA = 0;
    new.PERCICMSITCOMPRA = 0;
    new.VLRICMSITCOMPRA = 0;
    new.VLRISENTASITCOMPRA = 0;
  END
  ELSE IF (sTipoFisc = 'TT') THEN
  BEGIN
    new.VLROUTRASITCOMPRA = 0;
    new.VLRISENTASITCOMPRA = 0;
  END
*/

  SELECT NVLRCUSTO FROM CPCOMPRASP01(new.CODEMP, new.CODFILIAL, new.QTDITCOMPRA,
     new.VLRLIQITCOMPRA, new.VLRICMSITCOMPRA) INTO new.CUSTOITCOMPRA;

  UPDATE CPCOMPRA SET VLRDESCITCOMPRA = VLRDESCITCOMPRA + new.VLRDESCITCOMPRA,
         VLRPRODCOMPRA = VLRPRODCOMPRA + new.VLRPRODITCOMPRA,
         VLRBASEICMSCOMPRA = VLRBASEICMSCOMPRA + new.VLRBASEICMSITCOMPRA,
         VLRICMSCOMPRA = VLRICMSCOMPRA + new.VLRICMSITCOMPRA,
         VLRISENTASCOMPRA = VLRISENTASCOMPRA + new.VLRISENTASITCOMPRA,
         VLROUTRASCOMPRA = VLROUTRASCOMPRA + new.VLROUTRASITCOMPRA,
         VLRBASEIPICOMPRA = VLRBASEIPICOMPRA + new.VLRBASEIPIITCOMPRA,
         VLRIPICOMPRA = VLRIPICOMPRA + new.VLRIPIITCOMPRA,
         VLRLIQCOMPRA = VLRLIQCOMPRA + new.VLRLIQITCOMPRA
         WHERE CODCOMPRA=new.CODCOMPRA
         AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END ^
 
CREATE TRIGGER CPITCOMPRATGAI FOR CPITCOMPRA 
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE DDTCOMPRA DATE;
DECLARE VARIABLE CFLAG CHAR(1);
DECLARE VARIABLE IDOCCOMPRA INTEGER;
DECLARE VARIABLE ICODEMPTM INTEGER;
DECLARE VARIABLE SCODFILIALTM SMALLINT;
DECLARE VARIABLE ICODTIPOMOV INTEGER;

BEGIN
  SELECT C.DTENTCOMPRA,C.FLAG,C.DOCCOMPRA,
      C.CODEMPTM, C.CODFILIALTM, C.CODTIPOMOV
   FROM CPCOMPRA C WHERE C.CODCOMPRA = new.CODCOMPRA
      AND C.CODEMP=new.CODEMP AND C.CODFILIAL = new.CODFILIAL
  INTO :DDTCOMPRA, :CFLAG, :IDOCCOMPRA, :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV;

  EXECUTE PROCEDURE EQMOVPRODIUDSP('I', new.CODEMPPD, new.CODFILIALPD,
     new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
     :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV, null, null, null,
     new.CODEMP, new.CODFILIAL, new.CODCOMPRA, new.CODITCOMPRA,
     null, null, null, null, null, null, null, null, null,
     new.CODEMPNT, new.CODFILIALNT, new.CODNAT, :DDTCOMPRA,
     :IDOCCOMPRA, :CFLAG, new.QTDITCOMPRA, new.CUSTOITCOMPRA);

END ^
 
CREATE TRIGGER CPITCOMPRATGBU FOR CPITCOMPRA 
ACTIVE BEFORE UPDATE POSITION 0 
AS
     declare variable sTipoFisc CHAR(2);
     declare variable sRefProd CHAR(13);
begin
  IF ( new.EMMANUT IS NULL) THEN
      new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN
      new.DTALT = cast('today' AS DATE);
      new.IDUSUALT = USER;
      new.HALT = cast('now' AS TIME);
      IF (new.CODPROD != old.CODPROD) THEN
        EXCEPTION CPITCOMPRAEX01;
      IF (new.CODLOTE != old.CODLOTE) THEN
        EXCEPTION CPITCOMPRAEX02;
      SELECT F.TIPOFISC FROM LFCLFISCAL F, EQPRODUTO P WHERE P.CODPROD=new.CODPROD
             AND F.CODFISC = P.CODFISC AND F.CODEMP = P.CODEMP AND F.CODFILIAL = P.CODFILIAL
             AND P.CODEMP = new.CODEMPPD AND P.CODFILIAL = new.CODFILIALPD INTO :sTipoFisc;
      SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
             AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO sRefProd;

      SELECT NVLRCUSTO FROM CPCOMPRASP01(new.CODEMP, new.CODFILIAL, new.QTDITCOMPRA,
         new.VLRLIQITCOMPRA, new.VLRICMSITCOMPRA) INTO new.CUSTOITCOMPRA;

      IF (new.REFPROD IS NULL) THEN new.REFPROD = sRefProd;
    /*
      IF (sTipoFisc = 'II') THEN
      BEGIN
        new.VLRISENTASITCOMPRA = new.VLRLIQITCOMPRA;
        new.VLROUTRASITCOMPRA = 0;
      END
      ELSE IF (sTipoFisc = 'FF') THEN
      BEGIN
        new.VLROUTRASITCOMPRA = new.VLRLIQITCOMPRA;
        new.VLRISENTASITCOMPRA = 0;
      END
      ELSE IF (sTipoFisc = 'NN') THEN
      BEGIN
        new.VLROUTRASITCOMPRA = new.VLRLIQITCOMPRA;
        new.VLRISENTASITCOMPRA = 0;
      END
      ELSE IF (sTipoFisc = 'TT') THEN
      BEGIN
        new.VLROUTRASITCOMPRA = 0;
        new.VLRISENTASITCOMPRA = 0;
      END
    */
  END
end ^
 
CREATE TRIGGER CPITCOMPRATGAU FOR CPITCOMPRA 
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE DDTCOMPRA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCCOMPRA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) ) THEN
  BEGIN
      UPDATE CPCOMPRA SET VLRDESCITCOMPRA = VLRDESCITCOMPRA -old.VLRDESCITCOMPRA + new.VLRDESCITCOMPRA,
          VLRPRODCOMPRA = VLRPRODCOMPRA - old.VLRPRODITCOMPRA + new.VLRPRODITCOMPRA,
          VLRBASEICMSCOMPRA = VLRBASEICMSCOMPRA - old.VLRBASEICMSITCOMPRA + new.VLRBASEICMSITCOMPRA,
          VLRICMSCOMPRA = VLRICMSCOMPRA -old.VLRICMSITCOMPRA + new.VLRICMSITCOMPRA,
          VLRISENTASCOMPRA = VLRISENTASCOMPRA - old.VLRISENTASITCOMPRA + new.VLRISENTASITCOMPRA,
          VLROUTRASCOMPRA = VLROUTRASCOMPRA - old.VLROUTRASITCOMPRA + new.VLROUTRASITCOMPRA,
          VLRBASEIPICOMPRA = VLRBASEIPICOMPRA - old.VLRBASEIPIITCOMPRA + new.VLRBASEIPIITCOMPRA,
          VLRIPICOMPRA = VLRIPICOMPRA - old.VLRIPIITCOMPRA + new.VLRIPIITCOMPRA,
          VLRLIQCOMPRA = VLRLIQCOMPRA - old.VLRLIQITCOMPRA + new.VLRLIQITCOMPRA
          WHERE CODCOMPRA=new.CODCOMPRA
          AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
    
      SELECT C.DTENTCOMPRA,C.FLAG,C.DOCCOMPRA,
          C.CODEMPTM, C.CODFILIALTM, C.CODTIPOMOV
       FROM CPCOMPRA C WHERE C.CODCOMPRA = new.CODCOMPRA
          AND C.CODEMP=new.CODEMP AND C.CODFILIAL = new.CODFILIAL
      INTO :DDTCOMPRA, :CFLAG, :IDOCCOMPRA, :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV;
    
      EXECUTE PROCEDURE EQMOVPRODIUDSP('U', new.CODEMPPD, new.CODFILIALPD,
         new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
         :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV, null, null, null,
         new.CODEMP, new.CODFILIAL, new.CODCOMPRA, new.CODITCOMPRA,
         null, null, null, null, null, null, null, null, null,
         new.CODEMPNT, new.CODFILIALNT, new.CODNAT, :DDTCOMPRA,
         :IDOCCOMPRA, :CFLAG, new.QTDITCOMPRA, new.CUSTOITCOMPRA);
  END
END ^
 
CREATE TRIGGER CPITCOMPRATGAD FOR CPITCOMPRA 
ACTIVE AFTER DELETE POSITION 0 
AS
  DECLARE VARIABLE DDTCOMPRA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCCOMPRA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
BEGIN
  IF ( not ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) THEN
  BEGIN
      UPDATE CPCOMPRA SET VLRDESCITCOMPRA = VLRDESCITCOMPRA -old.VLRDESCITCOMPRA,
             VLRPRODCOMPRA = VLRPRODCOMPRA - old.VLRPRODITCOMPRA,
             VLRBASEICMSCOMPRA = VLRBASEICMSCOMPRA - old.VLRBASEICMSITCOMPRA,
             VLRICMSCOMPRA = VLRICMSCOMPRA -old.VLRICMSITCOMPRA,
             VLRISENTASCOMPRA = VLRISENTASCOMPRA - old.VLRISENTASITCOMPRA,
             VLROUTRASCOMPRA = VLROUTRASCOMPRA - old.VLROUTRASITCOMPRA,
             VLRBASEIPICOMPRA = VLRBASEIPICOMPRA - old.VLRBASEIPIITCOMPRA,
             VLRIPICOMPRA = VLRIPICOMPRA - old.VLRIPIITCOMPRA,
             VLRLIQCOMPRA = VLRLIQCOMPRA - old.VLRLIQITCOMPRA
             WHERE CODCOMPRA=old.CODCOMPRA
             AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
    
      SELECT C.DTENTCOMPRA,C.FLAG,C.DOCCOMPRA,
          C.CODEMPTM, C.CODFILIALTM, C.CODTIPOMOV
       FROM CPCOMPRA C WHERE C.CODCOMPRA = old.CODCOMPRA
          AND C.CODEMP=old.CODEMP AND C.CODFILIAL = old.CODFILIAL
      INTO :DDTCOMPRA, :CFLAG, :IDOCCOMPRA, :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV;

      EXECUTE PROCEDURE EQMOVPRODIUDSP('D', old.CODEMPPD, old.CODFILIALPD,
         old.CODPROD, old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
         :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV, null, null, null,
         old.CODEMP, old.CODFILIAL, old.CODCOMPRA, old.CODITCOMPRA,
         null, null, null, null, null, null, null, null, null,
         old.CODEMPNT, old.CODFILIALNT, old.CODNAT, :DDTCOMPRA,
         :IDOCCOMPRA, :CFLAG, old.QTDITCOMPRA, old.CUSTOITCOMPRA);
  END
END ^
 
CREATE TRIGGER CPPRODFORTGBU FOR CPPRODFOR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER CPTABFORTGBU FOR CPTABFOR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER CPTIPOFORTGBU FOR CPTIPOFOR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQALMOXTGBU FOR EQALMOX 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT=cast('now'AS TIME);
end ^
 
CREATE TRIGGER EQFATCONVTGBU FOR EQFATCONV 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQGRUPOTGBU FOR EQGRUPO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQINVPRODTGBI FOR EQINVPROD 
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE CLOTEPROD CHAR;
BEGIN
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);

  SELECT CLOTEPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
    AND CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD INTO CLOTEPROD;
  IF (CLOTEPROD = 'S' AND new.CODLOTE IS NULL) THEN
    EXCEPTION EQINVPRODEX05;
  if (new.SLDATUALINVP is null) then new.SLDATUALINVP = 0;
  if (new.SLDDIGINVP is null) then new.SLDDIGINVP = 0;
/*  new.QTDINVP = new.SLDATUALINVP - new.SLDDIGINVP; */
  SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
         AND CODEMP=new.CODEMPPD AND CODFILIAL = new.CODFILIALPD INTO new.REFPROD;
END ^
 
CREATE TRIGGER EQINVPRODTGAI FOR EQINVPROD 
ACTIVE AFTER INSERT POSITION 0 
AS
BEGIN

  EXECUTE PROCEDURE EQMOVPRODIUDSP('I', new.CODEMPPD, new.CODFILIALPD,
     new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
     new.CODEMPTM, new.CODFILIALTM, new.CODTIPOMOV, new.CODEMP,
     new.CODFILIAL, new.CODINVPROD,  null, null, null, null,
     null, null, null, null, null, null, null, null, null,
     null, null, null, new.DATAINVP, new.CODINVPROD, 'S',
     new.QTDINVP, new.PRECOINVP);

END ^
 
CREATE TRIGGER EQINVPRODTGBU FOR EQINVPROD 
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE CLOTEPROD CHAR;
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT CLOTEPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
    AND CODEMP=new.CODEMPPD AND CODFILIAL=new.CODFILIALPD INTO CLOTEPROD;
  IF (new.CODPROD != old.CODPROD) THEN
    EXCEPTION EQINVPRODEX01;
  IF (new.CODLOTE != old.CODLOTE) THEN
    EXCEPTION EQINVPRODEX02;
  IF (new.DATAINVP != old.DATAINVP) THEN
    EXCEPTION EQINVPRODEX03;
  IF (new.CODALMOX != old.CODALMOX) THEN
    EXCEPTION EQINVPRODEX04;
  IF (CLOTEPROD = 'S' AND new.CODLOTE IS NULL) THEN
    EXCEPTION EQINVPRODEX05;
END ^
 
CREATE TRIGGER EQINVPRODTGAU FOR EQINVPROD 
ACTIVE AFTER UPDATE POSITION 0 
AS
BEGIN
  EXECUTE PROCEDURE EQMOVPRODIUDSP('U', new.CODEMPPD, new.CODFILIALPD,
     new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE,
     new.CODEMPTM, new.CODFILIALTM, new.CODTIPOMOV, new.CODEMP,
     new.CODFILIAL, new.CODINVPROD,  null, null, null, null,
     null, null, null, null, null, null, null, null, null,
     null, null, null, new.DATAINVP, new.CODINVPROD, 'S',
     new.QTDINVP, new.PRECOINVP);
END ^
 
CREATE TRIGGER EQINVPRODTGAD FOR EQINVPROD 
ACTIVE AFTER DELETE POSITION 0 
AS
begin
  /* Apos a excluso do inventrio */

  EXECUTE PROCEDURE EQMOVPRODIUDSP('D', old.CODEMPPD, old.CODFILIALPD,
     old.CODPROD, old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
     old.CODEMPTM, old.CODFILIALTM, old.CODTIPOMOV, old.CODEMP,
     old.CODFILIAL, old.CODINVPROD, null, null, null, null,null,
     null, null, null, null, null, null, null, null, null, null,
     null, old.DATAINVP, old.CODINVPROD, 'S', old.QTDINVP, old.PRECOINVP);

end ^
 
CREATE TRIGGER EQITMODGRADETGBU FOR EQITMODGRADE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQITRMATGBU FOR EQITRMA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQLANCTOEXPTGBU FOR EQLANCTOEXP 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQLOTETGBI FOR EQLOTE 
ACTIVE BEFORE INSERT POSITION 0 
as
begin
  if (new.SLDLOTE is null) then
     new.SLDLOTE = 0;
  if (new.SLDRESLOTE is null) then
     new.SLDRESLOTE = 0;
  if (new.SLDCONSIGLOTE is null) then
     new.SLDCONSIGLOTE = 0;
  new.SLDLIQLOTE = new.SLDLOTE-new.SLDRESLOTE-new.SLDCONSIGLOTE;
end ^
 
CREATE TRIGGER EQLOTETGBU FOR EQLOTE 
ACTIVE BEFORE UPDATE POSITION 0 
as
  DECLARE VARIABLE ICODFILIAL INTEGER;
  DECLARE VARIABLE CESTLOTNEG CHAR(1);
begin
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :iCodFilial;
  SELECT ESTLOTNEG FROM SGPREFERE1 WHERE CODEMP=new.CODEMP AND CODFILIAL=:iCodFilial
     INTO :cEstLotNeg;
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.SLDLOTE is null) then
     new.SLDLOTE = 0;
  if (new.SLDRESLOTE is null) then
     new.SLDRESLOTE = 0;
  if (new.SLDCONSIGLOTE is null) then
     new.SLDCONSIGLOTE = 0;
  new.SLDLIQLOTE = new.SLDLOTE-new.SLDRESLOTE-new.SLDCONSIGLOTE;
  if (cEstLotNeg Is null) then
      cEstLotNeg = 'N';
  if ( (new.SLDLOTE < 0) And (cEstLotNeg='N') ) then
    EXCEPTION EQLOTEEX01;
end ^
 
CREATE TRIGGER EQMARCATGBU FOR EQMARCA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQMODGRADETGBU FOR EQMODGRADE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQMOVEXPTGBU FOR EQMOVEXP 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQMOVPRODTGAI FOR EQMOVPROD 
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE SOPERADOR SMALLINT;
DECLARE VARIABLE DDTULTCPPROD DATE;
DECLARE VARIABLE NQTDULTCPPROD NUMERIC(15,3);
DECLARE VARIABLE DDTMPMPROD DATE;
DECLARE VARIABLE NCUSTOMPMPROD NUMERIC(15,3);
BEGIN
  IF (new.ESTOQMOVPROD='S') THEN
  BEGIN
      SELECT DDTULTCPPROD, NQTDULTCPPROD, DDTMPMPROD, NCUSTOMPMPROD
       FROM EQMOVPRODCKCPSP(new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
       new.CODCOMPRA, new.CODINVPROD, new.DTMOVPROD, new.QTDMOVPROD,
       new.CUSTOMPMMOVPROD )
       INTO :DDTULTCPPROD, :NQTDULTCPPROD, :DDTMPMPROD, :NCUSTOMPMPROD;

      IF (new.TIPOMOVPROD = 'S') THEN
         SOPERADOR = -1;
      ELSE
         SOPERADOR = 1;

      EXECUTE PROCEDURE EQMOVPRODATEQSP(new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
        new.CODEMPLE, new.CODFILIALLE, new.CODLOTE, :SOPERADOR, 0, new.QTDMOVPROD,
        new.CODINVPROD, new.CODCOMPRA, :DDTULTCPPROD, :NQTDULTCPPROD,
        :DDTMPMPROD, :NCUSTOMPMPROD);

  END
END ^
 
CREATE TRIGGER EQMOVPRODTGBU FOR EQMOVPROD 
ACTIVE BEFORE UPDATE POSITION 0 
AS
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
END ^
 
CREATE TRIGGER EQMOVPRODTGAU FOR EQMOVPROD 
ACTIVE AFTER UPDATE POSITION 0 
AS
DECLARE VARIABLE SOPERADOR SMALLINT;
DECLARE VARIABLE DDTULTCPPROD DATE;
DECLARE VARIABLE NQTDULTCPPROD NUMERIC(15,3);
DECLARE VARIABLE NQTDMOVPRODOLD NUMERIC(15,3);
DECLARE VARIABLE NQTDMOVPRODNEW NUMERIC(15,3);
DECLARE VARIABLE DDTMPMPROD DATE;
DECLARE VARIABLE NCUSTOMPMPROD NUMERIC(15,3);

BEGIN
  IF ( ( old.ESTOQMOVPROD='S' ) OR (new.ESTOQMOVPROD='S') ) THEN
  BEGIN
      SELECT DDTULTCPPROD, NQTDULTCPPROD, DDTMPMPROD, NCUSTOMPMPROD
         FROM EQMOVPRODCKCPSP(new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
         new.CODCOMPRA, new.CODINVPROD, new.DTMOVPROD, new.QTDMOVPROD,
         new.CUSTOMPMMOVPROD)
       INTO :DDTULTCPPROD, :NQTDULTCPPROD, :DDTMPMPROD, :NCUSTOMPMPROD;

      NQTDMOVPRODOLD = old.QTDMOVPROD;
      NQTDMOVPRODNEW = new.QTDMOVPROD;
      IF (new.TIPOMOVPROD = 'S') THEN -- Se for sada tem que diminuir do estoque
        SOPERADOR = -1;
      ELSE
        SOPERADOR = 1;

      -- Caso o flag de controle de estoque tenha mudado
      IF ( (old.ESTOQMOVPROD='S') AND (new.ESTOQMOVPROD='N') ) THEN
          NQTDMOVPRODNEW = 0;
      ELSE IF ( (old.ESTOQMOVPROD='N') AND (new.ESTOQMOVPROD='S') ) THEN
          NQTDMOVPRODOLD = 0;

      EXECUTE PROCEDURE EQMOVPRODATEQSP(new.CODEMPPD, new.CODFILIALPD,
        new.CODPROD, new.CODEMPLE, new.CODFILIALLE, new.CODLOTE, :SOPERADOR,
        NQTDMOVPRODOLD, NQTDMOVPRODNEW, new.CODINVPROD, new.CODCOMPRA,
        :DDTULTCPPROD, :NQTDULTCPPROD, :DDTMPMPROD, :NCUSTOMPMPROD);
  END
END ^
 
CREATE TRIGGER EQMOVPRODTGAD FOR EQMOVPROD 
ACTIVE AFTER DELETE POSITION 0 
AS
  DECLARE VARIABLE SOPERADOR SMALLINT;
BEGIN
  IF (old.ESTOQMOVPROD = 'S') THEN
  BEGIN
      IF (old.TIPOMOVPROD = 'S') THEN
        SOPERADOR = -1;
      ELSE
        SOPERADOR = 1;

      EXECUTE PROCEDURE EQMOVPRODATEQSP(old.CODEMPPD, old.CODFILIALPD, old.CODPROD,
        old.CODEMPLE, old.CODFILIALLE, old.CODLOTE, :SOPERADOR, old.QTDMOVPROD, 0,
        null, null, null, null, null, null);
   END
 -- EXECUTE PROCEDURE EQMOVPRODATCUSTSP(old.CODEMPPD, old.CODFILIALPD, old.CODPROD, SOPERADOR);
END ^
 
CREATE TRIGGER EQPRODUTOTGBI FOR EQPRODUTO 
ACTIVE BEFORE INSERT POSITION 0 
as
begin
  if (new.SLDPROD is null) then
     new.SLDPROD = 0;
  if (new.SLDRESPROD is null) then
     new.SLDRESPROD = 0;
  if (new.SLDCONSIGPROD is null) then
     new.SLDCONSIGPROD = 0;
  new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
end ^
 
CREATE TRIGGER EQPRODUTOTGBU FOR EQPRODUTO 
ACTIVE BEFORE UPDATE POSITION 0 
as
  DECLARE VARIABLE ICODFILIAL INTEGER;
  DECLARE VARIABLE CESTNEG CHAR(1);
begin
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :iCodFilial;
  SELECT ESTNEG FROM SGPREFERE1 WHERE CODEMP=new.CODEMP AND CODFILIAL=:iCodFilial
     INTO :cEstNeg;
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.SLDPROD is null) then
     new.SLDPROD = 0;
  if (new.SLDRESPROD is null) then
     new.SLDRESPROD = 0;
  if (new.SLDCONSIGPROD is null) then
     new.SLDCONSIGPROD = 0;
  new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
  if (cEstNeg Is null) then
      cEstNeg = 'N';
  if ((new.SLDPROD < 0) AND (new.TIPOPROD='P') AND (cEstNeg='N') ) THEN
    EXCEPTION EQPRODUTOEX01;
end ^
 
CREATE TRIGGER EQRMATGBU FOR EQRMA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQSALDOPRODTGBI FOR EQSALDOPROD 
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  if (new.SLDPROD is null) then
     new.SLDPROD = 0;
  if (new.SLDRESPROD is null) then
     new.SLDRESPROD = 0;
  if (new.SLDCONSIGPROD is null) then
     new.SLDCONSIGPROD = 0;
  new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
END ^
 
CREATE TRIGGER EQSALDOPRODTGBU FOR EQSALDOPROD 
ACTIVE BEFORE UPDATE POSITION 0 
AS
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  if (new.SLDPROD is null) then
     new.SLDPROD = 0;
  if (new.SLDRESPROD is null) then
     new.SLDRESPROD = 0;
  if (new.SLDCONSIGPROD is null) then
     new.SLDCONSIGPROD = 0;
  new.SLDLIQPROD = new.SLDPROD-new.SLDRESPROD-new.SLDCONSIGPROD;
END ^
 
CREATE TRIGGER EQSIMILARTGBI FOR EQSIMILAR 
ACTIVE BEFORE INSERT POSITION 0 
as
begin
   SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP AND
    CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD INTO new.REFPROD;

end ^
 
CREATE TRIGGER EQSIMILARTGBU FOR EQSIMILAR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);
    SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP AND
    CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD INTO new.REFPROD;
end ^
 
CREATE TRIGGER EQTIPOEXPTGBU FOR EQTIPOEXP 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQTIPOMOVTGBI FOR EQTIPOMOV 
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  IF ( (new.TIPOMOV='IV') AND (new.ESTIPOMOV!='I') ) THEN
     EXCEPTION EQTIPOMOVEX01 'FLUXO INCOMPATVEL COM O TIPO DE MOVIMENTO';
  ELSE IF (new.ESTIPOMOV = 'E') THEN
  BEGIN
    IF (new.CODTAB IS NOT NULL) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX01;
    END
  END
  ELSE
  BEGIN
    IF (new.CODTAB IS NULL) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX02;
    END
  END
END ^
 
CREATE TRIGGER EQTIPOMOVTGBU FOR EQTIPOMOV 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT = cast('now' AS DATE);
  new.IDUSUALT = USER;
  new.HALT = cast('now' AS TIME);

  IF ( (new.TIPOMOV='IV') AND (new.ESTIPOMOV!='I') ) THEN
     EXCEPTION EQTIPOMOVEX01 'FLUXO INCOMPATVEL COM O TIPO DE MOVIMENTO';
  ELSE IF (new.ESTIPOMOV = 'E') THEN
  BEGIN
    IF (new.CODTAB IS NOT NULL) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX01;
    END
  END
  ELSE
  BEGIN
    IF (new.CODTAB IS NULL) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX02;
    END
  END
  IF (old.ESTOQTIPOMOV != new.ESTOQTIPOMOV) THEN
  BEGIN
    IF ((EXISTS (SELECT CODVENDA FROM VDVENDA WHERE CODTIPOMOV=new.CODTIPOMOV
      AND CODEMPTM=new.CODEMP AND CODFILIALTM=new.CODFILIAL)) OR
        (EXISTS (SELECT CODCOMPRA FROM CPCOMPRA WHERE CODTIPOMOV=new.CODTIPOMOV
      AND CODEMPTM=new.CODEMP AND CODFILIALTM=new.CODFILIAL))) THEN
    BEGIN
      EXCEPTION EQTIPOMOVEX01 'JA EXISTE MOVIMENTOS PARA ESTE TIPO DE MOVIMENTO!';
    END
  END
end ^
 
CREATE TRIGGER EQUNIDADETGBU FOR EQUNIDADE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER EQVARGRADETGBU FOR EQVARGRADE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNBANCOTGBU FOR FNBANCO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNCCTGBI FOR FNCC 
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
   IF (new.NIVELCC=10) THEN
   BEGIN
     SELECT ISEQ FROM SPGERANUM(new.CODEMP,new.CODFILIAL,'CC') INTO new.CODREDCC;
   END
END ^
 
CREATE TRIGGER FNCCTGBU FOR FNCC 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNCONTATGBU FOR FNCONTA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNCOTMOEDATGBU FOR FNCOTMOEDA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNITPAGARTGBU FOR FNITPAGAR 
ACTIVE BEFORE UPDATE POSITION 0 
AS
DECLARE VARIABLE IFILIALPAG INTEGER;
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPAGAR') INTO IFILIALPAG;
  IF ((old.STATUSITPAG='PP') AND (new.STATUSITPAG='P1')) THEN
  BEGIN
    DELETE FROM FNLANCA WHERE CODPAG=new.CODPAG AND NPARCPAG=new.NPARCPAG
           AND CODEMPPG=new.CODEMP AND CODFILIALPG = new.CODFILIAL
           AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALPAG;
    new.VLRPAGOITPAG = 0;
    new.DTPAGOITPAG = NULL;
  END
  new.VLRITPAG = new.VLRPARCITPAG - new.VLRDESCITPAG + new.VLRJUROSITPAG + new.VLRMULTAITPAG +
  new.VLRADICITPAG;
  new.VLRAPAGITPAG = new.VLRITPAG - new.VLRPAGOITPAG;
  if (new.VLRAPAGITPAG < 0) then
    new.VLRAPAGITPAG = 0;
END ^
 
CREATE TRIGGER FNITPAGARTGAU FOR FNITPAGAR 
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE ICODFOR INTEGER;
  DECLARE VARIABLE ICODEMPFR INTEGER;
  DECLARE VARIABLE ICODFILIALFR INTEGER;
BEGIN
  SELECT CODFOR,CODEMPFR,CODFILIALFR FROM FNPAGAR WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND CODPAG=new.CODPAG
    INTO ICODFOR,ICODEMPFR,ICODFILIALFR;
  IF ((old.STATUSITPAG='P1') AND (new.STATUSITPAG='PP')) THEN
  BEGIN
   EXECUTE PROCEDURE FNADICLANCASP02(new.CodPag,new.NParcPag,new.NumConta,new.CODEMPCA,new.CODFILIALCA,:ICODFOR,:ICODEMPFR,:ICODFILIALFR,
                           new.CodPlan,new.CODEMPPN,new.CODFILIALPN,new.AnoCC,new.CodCC,new.CODEMPCC,new.CODFILIALCC,
                           new.DtPagoItPag,new.DocLancaItPag,new.ObsItPag,new.VlrPagoItPag,new.CODEMP,new.CODFILIAL);
  END
  ELSE IF ((old.STATUSITPAG='PP') AND (new.STATUSITPAG='PP')) THEN
  BEGIN
     EXCEPTION FNPAGAREX01;
  END
  UPDATE FNPAGAR SET VLRPAG = VLRPAG - old.VLRITPAG + new.VLRITPAG,
      VLRDESCPAG = VLRDESCPAG - old.VLRDESCITPAG + new.VLRDESCITPAG,
      VLRMULTAPAG = VLRMULTAPAG - old.VLRMULTAITPAG + new.VLRMULTAITPAG,
      VLRJUROSPAG = VLRJUROSPAG - old.VLRJUROSITPAG + new.VLRJUROSITPAG,
      VLRADICPAG = VLRADICPAG - old.VLRADICITPAG + new.VLRADICITPAG,
      VLRPARCPAG = VLRPARCPAG - old.VLRPARCITPAG + new.VLRPARCITPAG,
      VLRPAGOPAG = VLRPAGOPAG - old.VLRPAGOITPAG + new.VLRPAGOITPAG,
      VLRAPAGPAG = VLRAPAGPAG - old.VLRAPAGITPAG + new.VLRAPAGITPAG
      WHERE CODPAG=new.CODPAG
           AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END ^
 
CREATE TRIGGER FNITPAGARTGBD FOR FNITPAGAR 
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  IF (old.STATUSITPAG = 'PP') THEN
    EXCEPTION FNPAGAREX01;
END ^
 
CREATE TRIGGER FNITPAGARTGAD FOR FNITPAGAR 
ACTIVE AFTER DELETE POSITION 0 
AS
BEGIN
  UPDATE FNPAGAR SET VLRPAG = VLRPAG - old.VLRITPAG,
         VLRDESCPAG = VLRDESCPAG - old.VLRDESCITPAG,
         VLRMULTAPAG = VLRMULTAPAG  - old.VLRMULTAITPAG,
         VLRJUROSPAG = VLRJUROSPAG - old.VLRJUROSITPAG,
         VLRADICPAG = VLRADICPAG - old.VLRADICITPAG,
         VLRPAGOPAG = VLRPAGOPAG - old.VLRPAGOITPAG,
         VLRPARCPAG = VLRPARCPAG - old.VLRPARCITPAG,
         VLRAPAGPAG = VLRAPAGPAG - old.VLRAPAGITPAG
         WHERE CODPAG=old.CODPAG
         AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
END ^
 
CREATE TRIGGER FNITRECEBERTGBI FOR FNITRECEBER 
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  if (new.vlrparcitrec is null) then
     new.vlrparcitrec = 0;
  if (new.vlrdescitrec is null) then
     new.vlrdescitrec = 0;
  if (new.vlrjurositrec is null) then
     new.vlrjurositrec = 0;
  if (new.vlrmultaitrec is null) then
     new.vlrmultaitrec = 0;
  new.vlritrec = new.vlrparcitrec - new.vlrdescitrec + new.vlrjurositrec + new.vlrmultaitrec;
  new.vlrapagitrec = new.vlritrec - new.vlrpagoitrec;
  if (new.vlrapagitrec<0) then
      new.vlrapagitrec = 0;

end ^
 
CREATE TRIGGER FNITRECEBERTGAI FOR FNITRECEBER 
ACTIVE AFTER INSERT POSITION 0 
AS
BEGIN

  EXECUTE PROCEDURE vdgeracomissaosp(new.CODEMP, new.CODFILIAL, new.CODREC, new.NPARCITREC,
    new.VLRCOMIITREC, new.DTVENCITREC);
END ^
 
CREATE TRIGGER FNITRECEBERTGBU FOR FNITRECEBER 
ACTIVE BEFORE UPDATE POSITION 0 
AS
DECLARE VARIABLE SCODFILIALCI SMALLINT;
DECLARE VARIABLE SCODFILIALLC SMALLINT;
DECLARE VARIABLE SCODFILIALPF SMALLINT;
DECLARE VARIABLE CCOMISPDUPL CHAR(1);
DECLARE VARIABLE NVLRPARCREC NUMERIC(15,3);
DECLARE VARIABLE NVLRCOMIREC NUMERIC(15,3);

BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( new.ALTUSUITREC IS NULL ) THEN -- Para no permitir flag de usurio nulo
     new.ALTUSUITREC = 'S';
  IF ( (old.STATUSITREC IN ('RP','RL') )  AND (new.STATUSITREC='R1') ) THEN
  BEGIN
    SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNCOMISSAO') INTO :SCODFILIALCI;
    SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNLANCA') INTO :SCODFILIALLC;
    UPDATE VDCOMISSAO SET STATUSCOMI='C1'
           WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC
           AND CODEMPRC = new.CODEMP AND CODFILIALRC=new.CODFILIAL
           AND CODEMP=new.CODEMP AND CODFILIAL=:SCODFILIALCI
           AND STATUSCOMI NOT IN ('CE');
    DELETE FROM FNLANCA WHERE CODREC=new.CODREC AND NPARCITREC=new.NPARCITREC
           AND CODEMPRC= new.CODEMP AND CODFILIALRC=new.CODFILIAL
           AND CODEMP=new.CODEMP AND CODFILIAL = :SCODFILIALLC;
    new.VLRPAGOITREC = 0;
  END
  new.VLRITREC = new.VLRPARCITREC - new.VLRDESCITREC + new.VLRJUROSITREC + new.VLRMULTAITREC;
  new.VLRAPAGITREC = new.VLRITREC - new.VLRPAGOITREC;
  if (new.VLRAPAGITREC < 0) then -- se o valor a pagar for maior que zero
    new.VLRAPAGITREC = 0;  -- ento valor a pagar ser zero
  if (new.VLRAPAGITREC=0) then -- se o valor a pagar for igual a zero
    new.STATUSITREC = 'RP';  -- ento o status ser RP(pagamento completo)
  else if (new.VLRPAGOITREC>0) then -- caso contrrio e o valor pago maior que zero
    new.STATUSITREC = 'RL'; -- ento o status ser RL(pagamento parcial)
  /*
    Esta seo  destinada e ajustar as comisses conforme os valores de parcelas
    caso o preferncias esteja ajustado para isso.
  */
  IF ( (new.VLRPARCITREC!=old.VLRPARCITREC) AND (new.VLRPARCITREC!=0) ) THEN
  BEGIN
     SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO :SCODFILIALPF;
     SELECT P1.COMISPDUPL  FROM SGPREFERE1 P1
         WHERE P1.CODEMP=new.CODEMP AND P1.CODFILIAL=:SCODFILIALPF INTO :CCOMISPDUPL;
     IF (CCOMISPDUPL='S') THEN
     BEGIN
        SELECT V.VLRLIQVENDA, R.VLRCOMIREC FROM FNRECEBER R, VDVENDA V
          WHERE R.CODEMP=new.CODEMP AND R.CODFILIAL=new.CODFILIAL AND
              R.CODREC=new.CODREC AND V.CODEMP=R.CODEMPVA AND V.CODFILIAL=R.CODFILIALVA AND
              V.TIPOVENDA=R.TIPOVENDA AND V.CODVENDA=R.CODVENDA INTO :NVLRPARCREC, :NVLRCOMIREC;
        IF (NVLRPARCREC!=0) THEN
          new.VLRCOMIITREC = cast( new.VLRPARCITREC * :NVLRCOMIREC / :NVLRPARCREC as DECIMAL(15,2) );
     END
  END

END ^
 
CREATE TRIGGER FNITRECEBERTGAU FOR FNITRECEBER 
ACTIVE AFTER UPDATE POSITION 0 
AS
DECLARE VARIABLE ICODCLI INTEGER;
DECLARE VARIABLE ICODEMPCL INTEGER;
DECLARE VARIABLE ICODFILIALCL INTEGER;
BEGIN
  IF ((old.STATUSITREC='R1' AND new.STATUSITREC in ('RP','RL') )
     OR (old.STATUSITREC in ('RP','RL') AND new.STATUSITREC in ('RP','RL') AND
     new.VLRPAGOITREC > 0)) THEN
  BEGIN
     SELECT CODCLI,CODEMPCL,CODFILIALCL FROM FNRECEBER WHERE CODEMP=new.CODEMP AND
        CODFILIAL=new.CODFILIAL AND CODREC=new.CODREC
        INTO ICODCLI,ICODEMPCL,ICODFILIALCL;
     EXECUTE PROCEDURE FNADICLANCASP01(new.CodRec,new.NParcItRec,new.NumConta,new.CODEMPCA,new.CODFILIALCA,:ICODCLI,:ICODEMPCL,:ICODFILIALCL,
                           new.CodPlan,new.CODEMPPN,new.CODFILIALPN,new.ANOCC,new.CODCC,new.CODEMPCC,new.CODFILIALCC,new.DtPagoItRec,new.DocLancaItRec,
                           new.ObsItRec,new.VlrPagoItRec-old.VlrPagoItRec,new.CODEMP,new.CODFILIAL);
     IF (new.STATUSITREC = 'RP') THEN
     BEGIN
         UPDATE VDCOMISSAO SET STATUSCOMI='C2'
            WHERE CODREC=old.CODREC
            AND CODEMPRC=old.CODEMP
            AND CODFILIALRC=old.CODFILIAL
            AND NPARCITREC=old.NPARCITREC
            AND NOT STATUSCOMI IN ('CP','C2')
            AND CODEMP=old.CODEMP;
     END
  END
  ELSE IF (old.VLRCOMIITREC != new.VLRCOMIITREC) THEN
  BEGIN
     EXECUTE PROCEDURE vdgeracomissaosp(new.CODEMP, new.CODFILIAL, new.CODREC,
        new.NPARCITREC, new.VLRCOMIITREC, new.DTVENCITREC);
  END
  IF ( (new.ALTUSUITREC='S') AND ( (old.VLRITREC!=new.VLRITREC) OR
       (old.VLRDESCITREC!=new.VLRDESCITREC) OR (old.VLRMULTAITREC!=new.VLRMULTAITREC) OR
       (old.VLRJUROSITREC!=new.VLRJUROSITREC) OR (old.VLRPARCITREC!=new.VLRPARCITREC) OR
       (old.VLRPAGOITREC!=new.VLRPAGOITREC) OR (old.VLRAPAGITREC!=new.VLRAPAGITREC) ) ) THEN
     UPDATE FNRECEBER SET VLRREC = VLRREC - old.VLRITREC + new.VLRITREC,
         VLRDESCREC = VLRDESCREC - old.VLRDESCITREC + new.VLRDESCITREC,
         VLRMULTAREC = VLRMULTAREC - old.VLRMULTAITREC + new.VLRMULTAITREC,
         VLRJUROSREC = VLRJUROSREC - old.VLRJUROSITREC + new.VLRJUROSITREC,
         VLRPARCREC = VLRPARCREC - old.VLRPARCITREC + new.VLRPARCITREC,
         VLRPAGOREC = VLRPAGOREC - old.VLRPAGOITREC + new.VLRPAGOITREC,
         VLRAPAGREC = VLRAPAGREC - old.VLRAPAGITREC + new.VLRAPAGITREC,
         ALTUSUREC = 'S' WHERE CODREC=new.CODREC
        AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END ^
 
CREATE TRIGGER FNITRECEBERTGBD FOR FNITRECEBER 
ACTIVE BEFORE DELETE POSITION 0 
AS
DECLARE VARIABLE IFILIALCOMI INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(old.CODEMP,'VDCOMISSAO') INTO IFILIALCOMI;
  IF (old.STATUSITREC not in ('RP','RL') ) THEN
    DELETE FROM VDCOMISSAO WHERE CODREC=old.CODREC AND NPARCITREC=old.NPARCITREC
           AND CODEMP=old.CODEMP AND CODFILIAL = :IFILIALCOMI;
  ELSE
    EXCEPTION FNITRECEBEREX01;
END ^
 
CREATE TRIGGER FNITTBJUROSTGBU FOR FNITTBJUROS 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNLANCATGBI FOR FNLANCA 
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  new.STATUSLANCA = 'L1';
  IF (new.HISTLANCA IS NULL) THEN
    new.HISTLANCA = new.HISTBLANCA;
  IF (new.DTPREVLANCA IS NULL) THEN
    new.DTPREVLANCA = new.DATALANCA;
END ^
 
CREATE TRIGGER FNLANCATGAI FOR FNLANCA 
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE IFILIALPLAN INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPLANEJAMENTO') INTO IFILIALPLAN;
  INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPPN,CODFILIALPN,CODPLAN,DTPREVSUBLANCA,DATASUBLANCA,VLRSUBLANCA,ORIGSUBLANCA,FLAG)
                       VALUES (new.CODEMP,new.CODFILIAL,new.CODLANCA,0,new.CODEMP,:IFILIALPLAN,new.CODPLAN,new.DTPREVLANCA,new.DATALANCA,new.VLRLANCA,'S',new.FLAG);
END ^
 
CREATE TRIGGER FNLANCATGBU FOR FNLANCA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNLANCATGAU FOR FNLANCA 
ACTIVE AFTER UPDATE POSITION 0 
AS
BEGIN
  UPDATE FNSUBLANCA SET DTPREVSUBLANCA=new.DTPREVLANCA,
         DATASUBLANCA=new.DATALANCA,VLRSUBLANCA=new.VLRLANCA,FLAG=new.FLAG
         WHERE CODLANCA=old.CODLANCA AND CODSUBLANCA=0
         AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
END ^
 
CREATE TRIGGER FNLANCATGBD FOR FNLANCA 
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  DELETE FROM FNSUBLANCA WHERE CODLANCA=old.CODLANCA
         AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
END ^
 
CREATE TRIGGER FNLIBCREDTGBI FOR FNLIBCRED 
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGUSUARIO') INTO new.CODFILIALUS;
  new.CODEMPUS = new.CODEMP;
  new.IDUSU=lower(USER);
END ^
 
CREATE TRIGGER FNLIBCREDTGBU FOR FNLIBCRED 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNMODBOLETOTGBU FOR FNMODBOLETO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNMOEDATGBU FOR FNMOEDA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNPAGARTGBI FOR FNPAGAR 
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  IF (new.VLRDESCPAG IS NULL) THEN new.VLRDESCPAG = 0;
  IF (new.VLRJUROSPAG IS NULL) THEN new.VLRJUROSPAG = 0;
  IF (new.VLRMULTAPAG IS NULL) THEN new.VLRMULTAPAG = 0;
  IF (new.VLRPARCPAG IS NULL) THEN new.VLRPARCPAG = 0;
  IF (new.VLRPAGOPAG IS NULL) THEN new.VLRPAGOPAG = 0;
  IF (new.STATUSPAG IS NULL) THEN new.STATUSPAG = 'P1';
  new.VLRPAG = new.VLRPARCPAG - new.VLRDESCPAG + new.VLRJUROSPAG + new.VLRADICPAG +
  new.VLRMULTAPAG;
  new.VLRAPAGPAG = new.VLRPAG - new.VLRPAGOPAG;
END ^
 
CREATE TRIGGER FNPAGARTGAI FOR FNPAGAR 
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE dVlrPAG DECIMAL(15,2);
DECLARE VARIABLE dPercPag DECIMAL(11,6);
DECLARE VARIABLE dResto DECIMAL(15,2);
DECLARE VARIABLE iNumParc INTEGER;
DECLARE VARIABLE iDiasPag INTEGER;
DECLARE VARIABLE i INTEGER;
DECLARE VARIABLE IFILIALPP INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNPLANOPAG') INTO IFILIALPP;
  IF (new.VLRPAG IS NULL) THEN new.VLRPAG = 0;
  IF (new.VLRDESCPAG IS NULL) THEN new.VLRDESCPAG = 0;
  IF (new.VLRJUROSPAG IS NULL) THEN new.VLRJUROSPAG = 0;
  IF (new.VLRMULTAPAG IS NULL) THEN new.VLRMULTAPAG = 0;
  IF (new.VLRPARCPAG IS NULL) THEN new.VLRPARCPAG = 0;
  IF (new.VLRAPAGPAG IS NULL) THEN new.VLRAPAGPAG = 0;
  IF (new.VLRPAGOPAG IS NULL) THEN new.VLRPAGOPAG = 0;
  i = 0;
  dResto = new.VLRPAG;
  SELECT PARCPLANOPAG FROM FNPLANOPAG WHERE CODPLANOPAG=new.CODPLANOPAG
         AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPP INTO :iNumParc;
  FOR SELECT PERCPAG,DIASPAG FROM FNPARCPAG WHERE CODPLANOPAG=new.CODPLANOPAG
             AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALPP ORDER BY DIASPAG
             INTO :dPercPag,:iDiasPag
             DO
  BEGIN
    i = i+1;
    dVlrPAG = cast(cast(new.VLRPAG*dPercPag as DECIMAL(15,2))/100 AS DECIMAL(15,2));
    dResto = dResto-dVlrPAG;
    IF (i = iNumParc) THEN
    BEGIN
      dVlrPAG=dVlrPAG+dResto;
    END
    INSERT INTO FNITPAGAR (CODEMP,CODFILIAL,CODPAG,NPARCPAG,VLRITPAG,VLRDESCITPAG,VLRMULTAITPAG,
                           VLRJUROSITPAG,VLRPARCITPAG,VLRPAGOITPAG,VLRAPAGITPAG,
                           DTITPAG,DTVENCITPAG,STATUSITPAG,VLRADICITPAG,FLAG) VALUES
                           (new.CODEMP,new.CODFILIAL,new.CODPAG,:i,:dVlrPAG,0,0,0,:dVlrPAG,0,:dVlrPAG,
                            new.DATAPAG,new.DATAPAG+:iDiasPag,'P1',new.VLRADICPAG,new.FLAG);
  END
  new.NROPARCPAG = :i;
END ^
 
CREATE TRIGGER FNPAGARTGBU FOR FNPAGAR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNPAGARTGBD FOR FNPAGAR 
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  DELETE FROM FNITPAGAR WHERE CODPAG = old.CODPAG
         AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
END ^
 
CREATE TRIGGER FNPAGTOCOMITGAI FOR FNPAGTOCOMI 
ACTIVE AFTER INSERT POSITION 0 
AS
  DECLARE VARIABLE iCodLanca INTEGER;
  DECLARE VARIABLE sCodPlanConta CHAR(13);
  DECLARE VARIABLE iPlanEmp INTEGER;
  DECLARE VARIABLE iPlanFilial INTEGER;
  DECLARE VARIABLE IFILIALLANCA INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNLANCA') INTO IFILIALLANCA;
  SELECT CODPLAN,CODEMP,CODFILIAL FROM FNCONTA WHERE NUMCONTA=new.NUMCONTA
         AND CODEMP=new.CODEMPCA AND CODFILIAL = new.CODFILIALCA INTO :sCodPlanConta,:iPlanEmp,:iPlanFilial;
  SELECT ISEQ FROM SPGERANUM(new.CODEMP,new.CODFILIAL,'LA') INTO :iCodLanca;
  INSERT INTO FNLANCA (CODEMP,CODFILIAL,CODLANCA,CODEMPCI,CODFILIALCI,CODPCOMI,CODEMPPN,CODFILIALPN,CODPLAN,DATALANCA,DOCLANCA,
                     HISTBLANCA,DTPREVLANCA,VLRLANCA,FLAG)
            VALUES (new.CODEMP,new.CODFILIAL,:iCodLanca,new.CODEMP,new.CODFILIAL,new.CODPCOMI,:iPlanEmp,:iPlanFilial,:sCodPlanConta,new.DATAPCOMI,
                   new.DOCPCOMI,new.OBSPCOMI,new.DATAPCOMI,0,new.FLAG);
  INSERT INTO FNSUBLANCA (CODEMP,CODFILIAL,CODLANCA,CODSUBLANCA,CODEMPPN,CODFILIALPN,CODPLAN,ORIGSUBLANCA,DATASUBLANCA,DTPREVSUBLANCA,VLRSUBLANCA,FLAG)
            VALUES (new.CODEMP,new.CODFILIAL,:iCodLanca,1,new.CODEMPPN,new.CODFILIALPN,new.CODPLAN,'S',new.DATAPCOMI,new.DATAPCOMI,new.VLRPCOMI,new.FLAG);
END ^
 
CREATE TRIGGER FNPAGTOCOMITGBU FOR FNPAGTOCOMI 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNPAGTOCOMITGBD FOR FNPAGTOCOMI 
ACTIVE BEFORE DELETE POSITION 0 
AS
DECLARE VARIABLE IFILIALLANCA INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(old.CODEMP,'FNLANCA') INTO IFILIALLANCA;
  DELETE FROM FNLANCA WHERE CODPCOMI=old.codpcomi
         AND CODEMPCI=old.CODEMP AND CODFILIALCI=old.CODFILIAL
         AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALLANCA;
END ^
 
CREATE TRIGGER FNPARCPAGTGBU FOR FNPARCPAG 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNPLANEJAMENTOTGBI FOR FNPLANEJAMENTO 
ACTIVE BEFORE INSERT POSITION 0 
AS
DECLARE VARIABLE iCodredplan Integer;
BEGIN
   IF (new.NIVELPLAN=6) THEN
   BEGIN
     iCodredplan = 0;
     SELECT MAX(CODREDPLAN) FROM FNPLANEJAMENTO WHERE CODEMP=new.CODEMP
            AND CODFILIAL = new.CODFILIAL INTO :iCodredplan;
     new.CODREDPLAN = iCodredplan + 1;
   END
END ^
 
CREATE TRIGGER FNPLANEJAMENTOTGBU FOR FNPLANEJAMENTO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNPLANOPAGTGAI FOR FNPLANOPAG 
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE i Integer;
DECLARE VARIABLE iDias Integer;
DECLARE VARIABLE dPerc Decimal(10,6);
DECLARE VARIABLE dTotPerc Decimal(10,6);
BEGIN
   IF (new.PARCPLANOPAG>0) THEN
   BEGIN
     i = 1;
     dTotPerc = 0;
     dPerc = 100.000000/new.PARCPLANOPAG;
     WHILE (i<=new.PARCPLANOPAG) DO
     BEGIN
        iDias = (i-1)*30;
        IF (i = new.PARCPLANOPAG) THEN
          dPerc = 100.000000-dTotPerc;
        INSERT INTO FNPARCPAG (CODEMP,CODFILIAL,CODPLANOPAG,NROPARCPAG,PERCPAG,DIASPAG)
               VALUES (new.CODEMP,new.CODFILIAL,new.CODPLANOPAG,:i,:dPerc,:iDias);
        dTotPerc = dTotPerc + dPerc;
        i = i + 1;
     END
   END
END ^
 
CREATE TRIGGER FNPLANOPAGTGBU FOR FNPLANOPAG 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNPLANOPAGTGBD FOR FNPLANOPAG 
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  DELETE FROM FNPARCPAG WHERE CODPLANOPAG=old.CODPLANOPAG
         AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
END ^
 
CREATE TRIGGER FNRECEBERTGBI FOR FNRECEBER 
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  IF (new.VLRREC IS NULL) THEN new.VLRREC = 0;
  IF (new.VLRDESCREC IS NULL) THEN new.VLRDESCREC = 0;
  IF (new.VLRJUROSREC IS NULL) THEN new.VLRJUROSREC = 0;
  IF (new.VLRMULTAREC IS NULL) THEN new.VLRMULTAREC = 0;
  IF (new.VLRPARCREC IS NULL) THEN new.VLRPARCREC = 0;
  IF (new.VLRAPAGREC IS NULL) THEN new.VLRAPAGREC = 0;
  IF (new.VLRPAGOREC IS NULL) THEN new.VLRPAGOREC = 0;

END ^
 
CREATE TRIGGER FNRECEBERTGAI FOR FNRECEBER 
ACTIVE AFTER INSERT POSITION 0 
AS
  DECLARE VARIABLE CODFILIALPP SMALLINT;
  DECLARE VARIABLE AUTOBAIXA CHAR;
  DECLARE VARIABLE NUMCONTA CHAR(10);
  DECLARE VARIABLE CODFILIALCA SMALLINT;
  DECLARE VARIABLE CODPLAN CHAR(13);
  DECLARE VARIABLE CODFILIALPN SMALLINT;
  DECLARE VARIABLE CODCC CHAR(19);
  DECLARE VARIABLE ANOCC SMALLINT;
  DECLARE VARIABLE CODFILIALCC SMALLINT;
  DECLARE VARIABLE CODFILIALIR SMALLINT;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNPLANOPAG') INTO CODFILIALPP;
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNPLANEJAMENTO') INTO CODFILIALPN;
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNCENTROCUSTO') INTO CODFILIALCC;
  SELECT ICODFILIAL FROM SGRETFILIAL(NEW.CODEMP,'FNITRECEBER') INTO CODFILIALIR;
  SELECT I FROM fngeraitrecebersp01('S',new.CODEMP,
    new.CODFILIAL, new.CODREC, new.CODEMPPG, new.CODFILIALPG, new.CODPLANOPAG,
    new.VLRREC, new.DATAREC, new.FLAG, new.CODEMPBO, new.CODFILIALBO,
    new.CODBANCO, new.VLRCOMIREC) INTO new.NROPARCREC;

  SELECT AUTOBAIXAPLANOPAG FROM FNPLANOPAG WHERE CODEMP=NEW.CODEMP AND
    CODFILIAL=:CODFILIALPP AND CODPLANOPAG=NEW.CODPLANOPAG INTO AUTOBAIXA;

-- Se o plano de pagamento tiver marcado para autobaixa, ento  realizada a baixa automtica.

  IF (AUTOBAIXA = 'S') THEN
  BEGIN
    SELECT NUMCONTA,CODFILIALCA,CODPLAN,CODFILIALPN,CODCC,ANOCC,CODFILIALCC FROM
      FNPLANOPAG WHERE CODEMP=NEW.CODEMP AND CODFILIAL=:CODFILIALPP AND
      CODPLANOPAG=NEW.CODPLANOPAG
      INTO NUMCONTA,CODFILIALCA,CODPLAN,CODFILIALPN,CODCC,ANOCC,CODFILIALCC;
--    exception vdvendaex01 'CODEMP: '||CAST(NEW.CODEMP AS CHAR(4));
    UPDATE FNITRECEBER SET NUMCONTA=:NUMCONTA,CODEMPCA=NEW.CODEMP,CODFILIALCA=:CODFILIALCA,
      CODPLAN=:CODPLAN,CODEMPPN=NEW.CODEMP,CODFILIALPN=:CODFILIALPN,
      ANOCC=:ANOCC,CODCC=:CODCC,CODEMPCC=NEW.CODEMP,CODFILIALCC=:CODFILIALCC,
      DOCLANCAITREC='AUTO',DTPAGOITREC=NEW.DATAREC,
      VLRPAGOITREC=VLRPARCITREC,VLRDESCITREC=0,VLRJUROSITREC=0,
      OBSITREC='BAIXA AUTOMTICA',STATUSITREC='RP'
      WHERE CODREC=NEW.CODREC AND CODEMP=NEW.CODEMP AND CODFILIAL=:CODFILIALIR;
  END
END ^
 
CREATE TRIGGER FNRECEBERTGBU FOR FNRECEBER 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNRECEBERTGAU FOR FNRECEBER 
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE INPARCOLD INTEGER;
  DECLARE VARIABLE INPARCNEW INTEGER;
  DECLARE VARIABLE CALTVLR CHAR(1);

BEGIN
  IF ( ((old.CODPLANOPAG<>new.CODPLANOPAG) OR
       (old.FLAG<>new.FLAG) OR
       (old.VLRREC<>new.VLRREC) OR
       (old.DATAREC<>new.DATAREC)) AND
       (new.ALTUSUREC != 'S') ) THEN
  BEGIN
    IF (old.CODPLANOPAG<>new.CODPLANOPAG) THEN
    BEGIN
       SELECT PP.PARCPLANOPAG FROM FNPLANOPAG PP WHERE CODEMP=old.CODEMPPG and
           PP.CODFILIAL=old.CODFILIALPG AND
           PP.CODPLANOPAG=old.CODPLANOPAG INTO :INPARCOLD;
       SELECT PP.PARCPLANOPAG FROM FNPLANOPAG PP WHERE CODEMP=new.CODEMPPG and
           PP.CODFILIAL=new.CODFILIALPG AND
           PP.CODPLANOPAG=new.CODPLANOPAG INTO :INPARCNEW;
       IF (INPARCNEW != INPARCOLD) THEN
           DELETE FROM FNITRECEBER WHERE CODREC=new.CODREC
           AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL;
    END

    IF (new.VLRREC!=old.VLRREC) THEN
       CALTVLR = 'S';
    ELSE
       CALTVLR = 'N';
    SELECT I FROM fngeraitrecebersp01(:CALTVLR,  new.CODEMP,
       new.CODFILIAL, new.CODREC, new.CODEMPPG, new.CODFILIALPG, new.CODPLANOPAG,
       new.VLRREC, new.DATAREC, new.FLAG, new.CODEMPBO, new.CODFILIALBO,
       new.CODBANCO, new.VLRCOMIREC) INTO new.NROPARCREC;
  END
--Atualiza os itens para eles atualizarem a comissao de forma distribuida.
  IF (old.VLRCOMIREC != new.VLRCOMIREC) THEN
    EXECUTE PROCEDURE FNITRECEBERSP01(new.CODEMP,new.CODFILIAL,new.CODREC,
       new.VLRPARCREC,new.VLRCOMIREC,new.NROPARCREC,'N');
/*  ELSE IF (old.ALTUSUREC = 'S' AND old.ALTUSUREC='N') THEN
    EXECUTE PROCEDURE FNITRECEBERSP01(new.CODEMP,new.CODFILIAL,new.CODREC,
       new.VLRPARCREC,new.VLRCOMIREC,new.NROPARCREC);*/

END ^
 
CREATE TRIGGER FNRECEBERRGBD FOR FNRECEBER 
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
    DELETE FROM FNITRECEBER WHERE CODREC = old.CODREC
         AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
END ^
 
CREATE TRIGGER FNSALDOLANCATGBI FOR FNSALDOLANCA 
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  if (new.SALDOSL is null) then
     new.SALDOSL = 0;
  if (new.PREVSL is null) then
     new.PREVSL = 0;
END ^
 
CREATE TRIGGER FNSALDOLANCATGBU FOR FNSALDOLANCA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNSUBLANCATGBI FOR FNSUBLANCA 
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE sEhTransf CHAR(1);
  DECLARE VARIABLE sTipoPlan CHAR(1);
  DECLARE VARIABLE dDataLanca DATE;
  DECLARE VARIABLE dDtPrevLanca DATE;
  DECLARE VARIABLE sHistSubLanc CHAR(50);
BEGIN

   SELECT HISTBLANCA FROM FNLANCA WHERE CODLANCA = new.CODLANCA
     AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO sHistSubLanc;
  IF (new.HISTSUBLANCA IS NULL) THEN
      new.HISTSUBLANCA = sHistSubLanc;

  IF (new.CODSUBLANCA IS NULL) THEN
    SELECT MAX(CODSUBLANCA) FROM FNSUBLANCA WHERE CODLANCA = new.CODLANCA
           AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO new.CODSUBLANCA;
  new.STATUSSUBLANCA = 'S1';
  SELECT TRANSFLANCA,DATALANCA,DTPREVLANCA FROM FNLANCA WHERE CODLANCA = new.CODLANCA
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO sEhTransf,dDataLanca,dDtPrevLanca;
  SELECT TIPOPLAN FROM FNPLANEJAMENTO WHERE CODPLAN = new.CODPLAN
         AND CODEMP=new.CODEMPPN AND CODFILIAL = new.CODFILIALPN INTO sTipoPlan;
  new.DATASUBLANCA = dDataLanca;
  IF (new.CODSUBLANCA > 0) THEN
  BEGIN
    new.ORIGSUBLANCA = 'N';
  END
  new.STATUSSUBLANCA = 'S1';
  new.DTPREVSUBLANCA = dDtPrevLanca;
  IF (sEhTransf = 'S') THEN
  BEGIN
   IF (new.CODSUBLANCA = 2) THEN
     EXCEPTION FNSUBLANCAEX01;
   ELSE IF (sTipoPlan IN ('D','R')) THEN
     EXCEPTION FNSUBLANCAEX02;
  END
  ELSE
    IF ((new.CODSUBLANCA != 0) AND (sTipoPlan IN ('C','B'))) THEN
      EXCEPTION FNSUBLANCAEX03;
  UPDATE FNLANCA SET STATUSLANCA = 'L2', VLRLANCA=(VLRLANCA-new.VLRSUBLANCA)
         WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END ^
 
CREATE TRIGGER FNSUBLANCATGAI FOR FNSUBLANCA 
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE dDataSl DATE;
DECLARE VARIABLE dSaldoSl DECIMAL(15,3);
DECLARE VARIABLE sCodplan CHAR(13);
DECLARE VARIABLE dSaldoAnt DECIMAL(15,3);
DECLARE VARIABLE IFILIALSALDO INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNSALDOLANCA') INTO IFILIALSALDO;
   SELECT CODPLAN,DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=new.CODPLAN
          AND DATASL=new.DATASUBLANCA AND CODEMP=new.CODEMP AND CODFILIAL = :IFILIALSALDO
          INTO :sCodplan,:dDataSl,:dSaldoSl;
   IF (:sCodplan IS NULL ) THEN
   BEGIN
      SELECT SALDOSL FROM FNSALDOLANCA SL1 WHERE SL1.CODPLAN=new.CODPLAN
             AND SL1.DATASL=(
                            SELECT MAX(SL2.DATASL) FROM FNSALDOLANCA SL2 WHERE
                                   SL2.CODPLAN=SL1.CODPLAN AND SL2.DATASL<new.DATASUBLANCA
                                   AND SL2.CODEMP=new.CODEMP AND SL2.CODFILIAL=:IFILIALSALDO
                            )
              AND SL1.CODEMP=new.CODEMP AND SL1.CODFILIAL = :IFILIALSALDO INTO :dSaldoAnt;
      IF (:dSaldoAnt IS NULL) THEN
         dSaldoAnt = 0;
      INSERT INTO FNSALDOLANCA (CODEMP,CODFILIAL,CODPLAN,CODEMPPN,CODFILIALPN,DATASL,SALDOSL)
             VALUES (new.CODEMPPN,:IFILIALSALDO,new.CODPLAN,new.CODEMPPN,new.CODFILIALPN,new.DATASUBLANCA,:dSaldoAnt+new.VLRSUBLANCA);
      UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL + new.VLRSUBLANCA
             WHERE CODPLAN=new.CODPLAN AND DATASL>new.DATASUBLANCA
             AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALSALDO;
   END
   ELSE
   BEGIN
      UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL + new.VLRSUBLANCA
             WHERE CODPLAN=new.CODPLAN AND DATASL>=new.DATASUBLANCA
             AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALSALDO;
   END
END ^
 
CREATE TRIGGER FNSUBLANCATGBU FOR FNSUBLANCA 
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE sEhTransf CHAR(1);
  DECLARE VARIABLE sTipoPlan CHAR(1);
  DECLARE VARIABLE IFILIALSALDO INTEGER;
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNSALDOLANCA') INTO IFILIALSALDO;
  SELECT TIPOPLAN FROM FNPLANEJAMENTO WHERE CODPLAN = new.CODPLAN
         AND CODEMP=new.CODEMPPN AND CODFILIAL = new.CODFILIALPN INTO sTipoPlan;
  SELECT TRANSFLANCA FROM FNLANCA WHERE CODLANCA = new.CODLANCA
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIAL INTO sEhTransf;
  IF (sEhTransf = 'S') THEN
  BEGIN
      IF (new.CODSUBLANCA = 2) THEN
     EXCEPTION FNSUBLANCAEX01;
   ELSE IF (sTipoPlan IN ('D','R')) THEN
     EXCEPTION FNSUBLANCAEX02;
  END
  ELSE
    IF ((new.CODSUBLANCA != 0) AND (sTipoPlan IN ('C','B'))) THEN
      EXCEPTION FNSUBLANCAEX03;
  IF ((new.CODSUBLANCA != 0) AND (old.VLRSUBLANCA <> new.VLRSUBLANCA)) THEN
    UPDATE FNLANCA SET VLRLANCA = ((VLRLANCA+old.VLRSUBLANCA)-new.VLRSUBLANCA)
           WHERE CODLANCA = new.CODLANCA AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
           
  IF ( (old.DATASUBLANCA <> new.DATASUBLANCA) OR (old.VLRSUBLANCA<>new.VLRSUBLANCA) ) THEN
    UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL - old.VLRSUBLANCA
           WHERE CODPLAN=old.CODPLAN AND DATASL>=old.DATASUBLANCA
           AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALSALDO;
END ^
 
CREATE TRIGGER FNSUBLANCATGAU FOR FNSUBLANCA 
ACTIVE AFTER UPDATE POSITION 0 
AS
DECLARE VARIABLE dDataSl DATE;
DECLARE VARIABLE dSaldoSl DECIMAL(15,2);
DECLARE VARIABLE sCodplan CHAR(13);
DECLARE VARIABLE dSaldoAnt DECIMAL(15,2);
DECLARE VARIABLE IFILIALSALDO INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'FNSALDOLANCA') INTO IFILIALSALDO;
   IF ( (old.DATASUBLANCA <> new.DATASUBLANCA) OR (old.VLRSUBLANCA<>new.VLRSUBLANCA) ) THEN
   BEGIN
/*Verifica se j existe saldo no dia da nova data:*/

     SELECT CODPLAN,DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=new.CODPLAN
            AND DATASL=new.DATASUBLANCA AND CODEMP=new.CODEMPPN AND CODFILIAL=:IFILIALSALDO
            INTO :sCodplan,:dDataSl,:dSaldoSl;


/*Se no existir, cria um saldo para o nova data:*/

     IF (sCodplan IS NULL ) THEN
     BEGIN

/*Pega o ultimo saldo anterior a data do lanamento:*/

        SELECT SALDOSL FROM FNSALDOLANCA SL1 WHERE SL1.CODPLAN=new.CODPLAN
               AND SL1.DATASL=(
                              SELECT MAX(SL2.DATASL) FROM FNSALDOLANCA SL2 WHERE
                                     SL2.CODPLAN=SL1.CODPLAN AND SL2.DATASL<new.DATASUBLANCA
                                     AND SL2.CODEMP=new.CODEMPPN AND SL2.CODFILIAL=:IFILIALSALDO
                              )
               AND SL1.CODEMP=new.CODEMPPN AND SL1.CODFILIAL=:IFILIALSALDO INTO :dSaldoAnt;

/*Cria um saldo para este dia e atualiza saldos possveis que tiverem na frente:*/

        IF (:dSaldoAnt IS NULL) THEN
           dSaldoAnt = 0;
        INSERT INTO FNSALDOLANCA (CODEMP,CODFILIAL,CODPLAN,CODEMPPN,CODFILIALPN,DATASL,SALDOSL)
               VALUES (new.CODEMP,:IFILIALSALDO,new.CODPLAN,new.CODEMPPN,new.CODFILIALPN,new.DATASUBLANCA,:dSaldoAnt + new.VLRSUBLANCA);
        UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL + new.VLRSUBLANCA
               WHERE CODPLAN=new.CODPLAN AND DATASL>new.DATASUBLANCA
               AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALSALDO;
     END

/*Caso contrrio s atualiza o saldo:*/

     ELSE
     BEGIN
        UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL + new.VLRSUBLANCA
               WHERE CODPLAN=new.CODPLAN AND DATASL>=new.DATASUBLANCA
               AND CODEMP=new.CODEMP AND CODFILIAL=:IFILIALSALDO;
     END
   END
END ^
 
CREATE TRIGGER FNSUBLANCATGBD FOR FNSUBLANCA 
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  IF (old.CODSUBLANCA > 0) THEN
    UPDATE FNLANCA SET VLRLANCA = VLRLANCA - (old.VLRSUBLANCA*-1) WHERE
      CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL AND
      CODLANCA=old.CODLANCA;
END ^
 
CREATE TRIGGER FNSUBLANCATGAD FOR FNSUBLANCA 
ACTIVE AFTER DELETE POSITION 0 
AS
DECLARE VARIABLE dDataSl DATE;
DECLARE VARIABLE dSaldoSl DECIMAL(15,3);
DECLARE VARIABLE sCodplan CHAR(13);
DECLARE VARIABLE dSaldoAnt DECIMAL(15,3);
DECLARE VARIABLE IFILIALSALDO INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(old.CODEMPPN,'FNSALDOLANCA') INTO IFILIALSALDO;
   SELECT CODPLAN,DATASL,SALDOSL FROM FNSALDOLANCA WHERE CODPLAN=old.CODPLAN
          AND DATASL=old.DATASUBLANCA AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALSALDO
          INTO :sCodplan,:dDataSl,:dSaldoSl;
   IF (:sCodplan IS NULL ) THEN
   BEGIN
      SELECT SALDOSL FROM FNSALDOLANCA SL1 WHERE SL1.CODPLAN=old.CODPLAN
             AND SL1.DATASL=(
                            SELECT MAX(SL2.DATASL) FROM FNSALDOLANCA SL2 WHERE
                                   SL2.CODPLAN=SL1.CODPLAN AND SL2.DATASL<old.DATASUBLANCA
                                   AND SL2.CODEMP=old.CODEMP AND SL2.CODFILIAL=:IFILIALSALDO
                            )
             AND SL1.CODEMP=old.CODEMP AND SL1.CODFILIAL=:IFILIALSALDO INTO :dSaldoAnt;
      IF (:dSaldoAnt IS NULL) THEN
         dSaldoAnt = 0;
      INSERT INTO FNSALDOLANCA (CODEMP,CODFILIAL,CODEMPPN,CODFILIALPN,CODPLAN,DATASL,SALDOSL)
             VALUES (old.CODEMPPN,old.CODFILIALPN,old.CODEMPPN,old.CODFILIALPN,old.CODPLAN,old.DATASUBLANCA,:dSaldoAnt);
      UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL - old.VLRSUBLANCA
             WHERE CODPLAN=old.CODPLAN AND DATASL>old.DATASUBLANCA
             AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALSALDO;
   END
   ELSE
   BEGIN
      UPDATE FNSALDOLANCA SET SALDOSL = SALDOSL - old.VLRSUBLANCA
             WHERE CODPLAN=old.CODPLAN AND DATASL>=old.DATASUBLANCA
             AND CODEMP=old.CODEMP AND CODFILIAL=:IFILIALSALDO;
   END
END ^
 
CREATE TRIGGER FNTBJUROSTGBU FOR FNTBJUROS 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNTIPOCOBTGBU FOR FNTIPOCOB 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER FNTIPOCREDTGBU FOR FNTIPOCRED 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER LFCLFISCALTGBU FOR LFCLFISCAL 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER LFITCLFISCALTGBU FOR LFITCLFISCAL 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER LFITNATOPERTGBU FOR LFITNATOPER 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER LFITREGRAFISCALTGBU FOR LFITREGRAFISCAL 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER LFLIVROFISCALTGBU FOR LFLIVROFISCAL 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  /* Trigger Text */
end ^
 
CREATE TRIGGER LFMENSAGEMTGBU FOR LFMENSAGEM 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER LFMODNOTATGBU FOR LFMODNOTA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER LFNATOPERTGBU FOR LFNATOPER 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER LFREGRAFISCALTGBU FOR LFREGRAFISCAL 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER LFSERIETGBU FOR LFSERIE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER LFTABICMSTGBU FOR LFTABICMS 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER LFTIPOFISCCLITGBU FOR LFTIPOFISCCLI 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER LFTRATTRIBTGBU FOR LFTRATTRIB 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PPESTRUFASETGBU FOR PPESTRUFASE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PPESTRUTURATGBU FOR PPESTRUTURA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PPFASETGBU FOR PPFASE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PPITESTRUTURATGBU FOR PPITESTRUTURA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PPITOPTGBU FOR PPITOP 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PPOPTGBI FOR PPOP 
ACTIVE BEFORE INSERT POSITION 0 
as
begin
   SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP AND
    CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD INTO new.REFPROD;
   new.SITOP = 'GO';
end ^
 
CREATE TRIGGER PPOPTGAI FOR PPOP 
ACTIVE AFTER INSERT POSITION 0 
as
begin
   EXECUTE PROCEDURE PPITOPSP01(new.CODEMP, new.CODFILIAL, new.CODOP);
end ^
 
CREATE TRIGGER PPOPTGBU FOR PPOP 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
    new.DTALT=cast('now' AS DATE);
    new.IDUSUALT=USER;
    new.HALT = cast('now' AS TIME);
    SELECT REFPROD FROM EQPRODUTO WHERE CODEMP=new.CODEMP AND
    CODFILIAL=new.CODFILIAL AND CODPROD=new.CODPROD INTO new.REFPROD;
end ^
 
CREATE TRIGGER PPOPTGAU FOR PPOP 
ACTIVE AFTER UPDATE POSITION 0 
as
begin
   if (old.qtdprodop <> new.qtdprodop ) then
   begin
     DELETE FROM PPITOP WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND
       CODOP=new.CODOP;
     DELETE FROM PPOPFASE WHERE CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL AND
       CODOP=new.CODOP;
     EXECUTE PROCEDURE PPITOPSP01(new.CODEMP, new.CODFILIAL, new.CODOP);
   end
end ^
 
CREATE TRIGGER PPOPFASETGBU0 FOR PPOPFASE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PPRECURSOTGBU FOR PPRECURSO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PPTIPORECTGBU FOR PPTIPOREC 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PVCAIXATGBU FOR PVCAIXA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PVCAIXAIMPTGBU FOR PVCAIXAIMP 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PVLEITURAXTGBU FOR PVLEITURAX 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER PVMOVCAIXA_BI0 FOR PVMOVCAIXA 
ACTIVE BEFORE INSERT POSITION 0 
as
declare variable iMov INTEGER;
declare variable dSaldo DECIMAL(15,3);
begin
  if (new.vlrsldmov is NULL) then
  BEGIN

    SELECT MAX(NROMOV) FROM PVMOVCAIXA WHERE CODEMP=new.CODEMP
      AND CODFILIAL=new.CODFILIAL AND CODCAIXA=new.CODCAIXA
      AND DTAMOV=new.DTAMOV INTO iMov;

    SELECT vlrsldmov FROM PVMOVCAIXA WHERE CODEMP=new.CODEMP
      AND CODFILIAL=new.CODFILIAL AND CODCAIXA=new.CODCAIXA
      AND DTAMOV=new.DTAMOV AND NROMOV=:iMov INTO dSaldo;

    new.vlrsldmov = dSaldo + new.vlrmov;
  END
end ^
 
CREATE TRIGGER PVSEQMOVCAIXATGBU FOR PVSEQMOVCAIXA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGACESSOEUTGBU FOR SGACESSOEU 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGACESSOMGTGBU FOR SGACESSOMG 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGATRIBUICAOTGBU FOR SGATRIBUICAO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGEMPRESATGBU FOR SGEMPRESA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGEQVCLIFORTGBU0 FOR SGEQVCLIFOR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT=cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGFILIALTGBU FOR SGFILIAL 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGFLUXOTGBU FOR SGFLUXO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGGATILHOTGBU FOR SGGATILHO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGGRAUINSTTGBU FOR SGGRAUINST 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGGRPUSUTGBU FOR SGGRPUSU 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGIMPRESSORATGBU FOR SGIMPRESSORA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGITFLUXOTGBU FOR SGITFLUXO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGITPROCESSOTGBU FOR SGITPROCESSO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGITTABELATGBU FOR SGITTABELA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGMENUTGBI FOR SGMENU 
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  if (new.CODSIS=1) then
  begin
     if (new.NOMEMENU is null) then
        new.NOMEMENU = new.DESCMENU;
     if (new.ACAOMENU is null) then
        new.ACAOMENU = cast(new.CODMENU as CHAR(30));
  end 
end ^
 
CREATE TRIGGER SGMENUTGBU FOR SGMENU 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGMENUOBJTGBU FOR SGMENUOBJ 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGMODETIQUETATGBU FOR SGMODETIQUETA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGMODULOTGBU FOR SGMODULO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGOBJETOTGBI FOR SGOBJETO 
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  IF (NEW.CODOBJ IS NULL) THEN
      NEW.CODOBJ = GEN_ID(SGOBJETOINC,1);
END ^
 
CREATE TRIGGER SGOBJETOTGBU FOR SGOBJETO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGOBJETOTBTGBU FOR SGOBJETOTB 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGPAPELTGBU FOR SGPAPEL 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGPREFERE1TGBU FOR SGPREFERE1 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGPREFERE2TGBU FOR SGPREFERE2 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGPREFERE3TGBU FOR SGPREFERE3 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGPREFERE4TGBU FOR SGPREFERE4 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGPREFERE5_BU0 FOR SGPREFERE5 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGPROCESSOTGBU FOR SGPROCESSO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGSEQUENCIATGBU FOR SGSEQUENCIA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGSISTEMATGBU FOR SGSISTEMA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGTABELATGBU FOR SGTABELA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGTAREFATGBU FOR SGTAREFA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGTRATARETAI FOR SGTRATARET 
ACTIVE AFTER INSERT POSITION 0 
as
begin
  IF (new.CODPROCGT IS NULL AND NOT new.SEQITPROCGT IS NULL) THEN
    new.CODPROCGT = new.CODPROC;

end ^
 
CREATE TRIGGER SGTRATARETTGBU FOR SGTRATARET 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER SGVARIAVELTGBU FOR SGVARIAVEL 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT=cast('now'AS TIME);
end ^
 
CREATE TRIGGER TKATIVIDADETGBU FOR TKATIVIDADE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER TKCONTATOTGBU FOR TKCONTATO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER TKCTOATIVTGBU FOR TKCTOATIV 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER TKHISTORICOTGBU FOR TKHISTORICO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER TKSETORCTOTGBU FOR TKSETORCTO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER TKTIPOIMPTGBU FOR TKTIPOIMP 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDAUXVENDATGBU FOR VDAUXVENDA 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDCLASCLITGBU FOR VDCLASCLI 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDCLCOMISTGBI FOR VDCLCOMIS 
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  if ( (new.percfatclcomis+new.percpgtoclcomis) != 100.00) then
  begin
     exception VDCLCOMISEX01;
  end
  /* Trigger text */

end ^
 
CREATE TRIGGER VDCLCOMISTGBU FOR VDCLCOMIS 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  if ( (new.percfatclcomis+new.percpgtoclcomis) != 100.00) then
  begin
     exception VDCLCOMISEX01;
  end
end ^
 
CREATE TRIGGER VDCLIENTETGBI FOR VDCLIENTE 
ACTIVE BEFORE INSERT POSITION 0 
as
begin
  if (new.codpesq is null) then new.codpesq = new.codcli;
end ^
 
CREATE TRIGGER VDCLIENTETGBU FOR VDCLIENTE 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=user;
  new.HALT = cast('now' AS TIME);
  if (new.codpesq is null) then new.codpesq = new.codcli;
end ^
 
CREATE TRIGGER VDCLIENTEFORTGBU FOR VDCLIENTEFOR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDCOMISSAOTGBI FOR VDCOMISSAO 
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  new.DTINS = cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDCOMISSAOTGBU FOR VDCOMISSAO 
ACTIVE BEFORE UPDATE POSITION 0 
AS
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF ( OLD.STATUSCOMI = 'CP' AND NEW.STATUSCOMI = 'C1' ) then
    EXCEPTION VDCOMISSAOEX01;
  ELSE if ( OLD.STATUSCOMI='CP' AND NEW.STATUSCOMI='CP' AND OLD.VLRCOMI!=NEW.VLRCOMI ) then
    EXCEPTION VDCOMISSAOEX01;
  ELSE IF ( OLD.STATUSCOMI = 'C1' AND NEW.STATUSCOMI = 'CP' ) then
    EXCEPTION VDCOMISSAOEX02;
  ELSE IF ( OLD.STATUSCOMI = 'CP' AND NEW.STATUSCOMI = 'CD' ) THEN /* Estorno de comisses */
  BEGIN
     new.STATUSCOMI ='C2';
     new.CODEMPCI = null;
     new.CODFILIALCI = null;
     new.CODPCOMI = null;
     new.VLRPAGOCOMI = 0;
  END
  IF ( new.VLRCOMI IS NULL) THEN
    new.VLRCOMI = 0;
  IF ( new.VLRPAGOCOMI IS NULL ) THEN
    new.VLRPAGOCOMI = 0;
  new.VLRAPAGCOMI = new.VLRCOMI - new.VLRPAGOCOMI;
END ^
 
CREATE TRIGGER VDCOMISSAOTGBD FOR VDCOMISSAO 
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  IF (old.STATUSCOMI = 'CP') THEN
    EXCEPTION VDCOMISSAOEX01;
END ^
 
CREATE TRIGGER VDFOTOPRODTGBU FOR VDFOTOPROD 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDFRETEVDTGAI FOR VDFRETEVD 
ACTIVE BEFORE INSERT POSITION 0 
AS 
DECLARE VARIABLE VLRLIQVENDA NUMERIC(9,2);
BEGIN
  SELECT VLRLIQVENDA FROM VDVENDA WHERE TIPOVENDA=new.TIPOVENDA AND CODVENDA=new.CODVENDA AND
    CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL INTO VLRLIQVENDA;

  IF (NOT VLRLIQVENDA IS NULL AND VLRLIQVENDA > 0 AND NOT new.PERCVENDAFRETEVD > 0) THEN
    new.PERCVENDAFRETEVD = (new.VLRFRETEVD/:VLRLIQVENDA)*100;
    
END ^
 
CREATE TRIGGER VDFRETEVDTGBU FOR VDFRETEVD 
ACTIVE BEFORE UPDATE POSITION 0 
AS
DECLARE VARIABLE VLRLIQVENDA NUMERIC(9,2);
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT VLRLIQVENDA FROM VDVENDA WHERE TIPOVENDA=new.TIPOVENDA AND CODVENDA=new.CODVENDA AND
    CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL INTO VLRLIQVENDA;

  IF (NOT VLRLIQVENDA IS NULL AND VLRLIQVENDA > 0) THEN
    new.PERCVENDAFRETEVD = (new.VLRFRETEVD/:VLRLIQVENDA)*100;

END ^
 
CREATE TRIGGER VDITKITTGBI FOR VDITKIT 
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  /* Trigger text */
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;

end ^
 
CREATE TRIGGER VDITKITTGBU FOR VDITKIT 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  /* Trigger text */
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;

end ^
 
CREATE TRIGGER VDITORCAMENTOTGBI FOR VDITORCAMENTO 
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE sRefProd CHAR(13);
BEGIN
  IF (new.VLRDESCITORC IS NULL) THEN new.VLRDESCITORC = 0;
  IF (new.VLRLIQITORC IS NULL) THEN new.VLRLIQITORC = 0;
  IF (new.VLRLIQITORC = 0) THEN
      new.VLRLIQITORC = (new.QTDITORC * new.PRECOITORC) - new.VLRDESCITORC;
  new.TIPOORC = 'O';
  SELECT P.REFPROD FROM EQPRODUTO P
         WHERE P.CODPROD=new.CODPROD AND P.CODEMP=new.CODEMPPD
         AND P.CODFILIAL = new.CODFILIALPD
         INTO sRefProd;
  IF (new.REFPROD IS NULL) THEN new.REFPROD = sRefProd;
  UPDATE VDORCAMENTO SET VLRDESCITORC = VLRDESCITORC + new.VLRDESCITORC,
         VLRPRODORC = VLRPRODORC + new.VLRPRODITORC,
         VLRLIQORC = VLRLIQORC + new.VLRLIQITORC
         WHERE CODORC=new.CODORC AND TIPOORC=new.TIPOORC
         AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END ^
 
CREATE TRIGGER VDITORCAMENTOTGBU FOR VDITORCAMENTO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  IF (new.VLRPRODITORC IS NULL) THEN new.VLRPRODITORC = 0;
  IF (new.VLRDESCITORC IS NULL) THEN new.VLRDESCITORC = 0;
  IF (new.VLRLIQITORC IS NULL) THEN new.VLRLIQITORC = 0;
end ^
 
CREATE TRIGGER VDITORCAMENTOTGAU FOR VDITORCAMENTO 
ACTIVE AFTER UPDATE POSITION 0 
AS
BEGIN
  UPDATE VDORCAMENTO SET VLRDESCITORC = VLRDESCITORC -old.VLRDESCITORC + new.VLRDESCITORC,
           VLRPRODORC = VLRPRODORC - old.VLRPRODITORC + new.VLRPRODITORC,
           VLRLIQORC = VLRLIQORC - old.VLRLIQITORC + new.VLRLIQITORC
           WHERE CODORC=new.CODORC AND TIPOORC='O'
           AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END ^
 
CREATE TRIGGER VDITORCAMENTOTGAD FOR VDITORCAMENTO 
ACTIVE AFTER DELETE POSITION 0 
AS
BEGIN
  UPDATE VDORCAMENTO SET VLRDESCITORC = VLRDESCITORC -old.VLRDESCITORC,
         VLRPRODORC = VLRPRODORC - old.VLRPRODITORC,
         VLRLIQORC = VLRLIQORC - old.VLRLIQITORC
         WHERE CODORC=old.CODORC AND TIPOORC='O' AND
         CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
END ^
 
CREATE TRIGGER VDITROMANEIOTGBU FOR VDITROMANEIO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDITVENDATGBI FOR VDITVENDA 
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE sRefProd CHAR(13);
  DECLARE VARIABLE sTipoProd CHAR(1);
  DECLARE VARIABLE IFILIALPREF INTEGER;
BEGIN
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE1') INTO IFILIALPREF;
  IF (new.VLRDESCITVENDA IS NULL) THEN new.VLRDESCITVENDA = 0;
  IF (new.VLRBASEICMSITVENDA IS NULL) THEN new.VLRBASEICMSITVENDA = 0;
  IF (new.VLRICMSITVENDA IS NULL) THEN new.VLRICMSITVENDA = 0;
  IF (new.VLRBASEIPIITVENDA IS NULL) THEN new.VLRBASEIPIITVENDA = 0;
  IF (new.VLRIPIITVENDA IS NULL) THEN new.VLRIPIITVENDA = 0;
  IF (new.VLRLIQITVENDA IS NULL) THEN new.VLRLIQITVENDA = 0;
  IF (new.VLRCOMISITVENDA IS NULL) THEN new.VLRCOMISITVENDA = 0;
  IF (new.VLRADICITVENDA IS NULL) THEN new.VLRADICITVENDA = 0;
  IF (new.VLRISSITVENDA IS NULL) THEN new.VLRISSITVENDA = 0;
  IF (new.VLRFRETEITVENDA IS NULL) THEN new.VLRFRETEITVENDA = 0;
  IF (new.TIPOVENDA IS NULL) THEN new.TIPOVENDA = 'V';

  IF (new.VLRLIQITVENDA = 0) THEN
      new.VLRLIQITVENDA = (new.QTDITVENDA * new.PRECOITVENDA) +
         new.VLRADICITVENDA + new.VLRFRETEITVENDA - new.VLRDESCITVENDA;
  IF (NOT new.CODMENS IS NULL) THEN
  BEGIN
    SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'LFMENSAGEM') INTO new.CODFILIALME;
     new.CODEMPME = new.CODEMP;
  END
  SELECT P.REFPROD,P.TIPOPROD FROM LFCLFISCAL F, EQPRODUTO P
         WHERE P.CODPROD=new.CODPROD AND F.CODFISC = P.CODFISC
         AND F.CODEMP = P.CODEMPFC AND F.CODFILIAL = P.CODFILIALFC
         AND P.CODEMP=new.CODEMPPD AND P.CODFILIAL = new.CODFILIALPD
         INTO sRefProd,sTipoProd;
  IF (new.REFPROD IS NULL) THEN new.REFPROD = sRefProd;
  IF (sTipoProd = 'S') THEN
  BEGIN
    SELECT PERCISSEMP FROM SGEMPRESA WHERE
      CODEMP=new.CODEMP INTO new.PERCISSITVENDA;
    IF (new.PERCISSITVENDA != 0) THEN
    BEGIN
      new.VLRBASEISSITVENDA = new.VLRLIQITVENDA;
      new.VLRISSITVENDA = new.VLRBASEISSITVENDA*(new.PERCISSITVENDA/100);
    END
  END
  ELSE
    new.VLRBASEISSITVENDA = 0;
  IF (new.TIPOFISC = 'II') THEN
  BEGIN
    new.VLRISENTASITVENDA = new.VLRLIQITVENDA;
    new.VLRBASEICMSITVENDA = 0;
    new.PERCICMSITVENDA = 0;
    new.VLRICMSITVENDA = 0;
    new.VLROUTRASITVENDA = 0;
  END
  ELSE IF (new.TIPOFISC = 'FF') THEN
  BEGIN
    new.VLROUTRASITVENDA = new.VLRLIQITVENDA;
    new.VLRBASEICMSITVENDA = 0;
    new.PERCICMSITVENDA = 0;
    new.VLRICMSITVENDA = 0;
    new.VLRISENTASITVENDA = 0;
  END
  ELSE IF (new.TIPOFISC = 'NN') THEN
  BEGIN
    new.VLROUTRASITVENDA = new.VLRLIQITVENDA;
    new.VLRBASEICMSITVENDA = 0;
    new.PERCICMSITVENDA = 0;
    new.VLRICMSITVENDA = 0;
    new.VLRISENTASITVENDA = 0;
  END
  ELSE IF (new.TIPOFISC = 'TT') THEN
  BEGIN
    new.VLROUTRASITVENDA = 0;
    new.VLRISENTASITVENDA = 0;
  END
  UPDATE VDVENDA SET VLRDESCITVENDA = VLRDESCITVENDA + new.VLRDESCITVENDA,
         VLRPRODVENDA = VLRPRODVENDA + new.VLRPRODITVENDA,
         VLRBASEICMSVENDA = VLRBASEICMSVENDA + new.VLRBASEICMSITVENDA,
         VLRICMSVENDA = VLRICMSVENDA + new.VLRICMSITVENDA,
         VLRISENTASVENDA = VLRISENTASVENDA + new.VLRISENTASITVENDA,
         VLROUTRASVENDA = VLROUTRASVENDA + new.VLROUTRASITVENDA,
         VLRBASEIPIVENDA = VLRBASEIPIVENDA + new.VLRBASEIPIITVENDA,
         VLRIPIVENDA = VLRIPIVENDA + new.VLRIPIITVENDA,
         VLRLIQVENDA = VLRLIQVENDA + new.VLRLIQITVENDA,
         VLRBASEISSVENDA = VLRBASEISSVENDA + new.VLRBASEISSITVENDA,
         VLRISSVENDA = VLRISSVENDA + new.VLRISSITVENDA,
         VLRCOMISVENDA = VLRCOMISVENDA + new.VLRCOMISITVENDA
         WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA
         AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
END ^
 
CREATE TRIGGER VDITVENDATGAI FOR VDITVENDA 
ACTIVE AFTER INSERT POSITION 0 
AS
  DECLARE VARIABLE DDTVENDA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE CFISCALTIPOMOV CHAR(1);
  DECLARE VARIABLE IDOCVENDA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
  DECLARE VARIABLE NPRECO NUMERIC(15,3);
BEGIN

  SELECT VD.DTEMITVENDA, VD.FLAG, VD.DOCVENDA,
      VD.CODEMPTM, VD.CODFILIALTM, VD.CODTIPOMOV, TM.FISCALTIPOMOV
    FROM EQTIPOMOV TM, VDVENDA VD WHERE
      TM.CODTIPOMOV=VD.CODTIPOMOV AND TM.CODFILIAL=VD.CODFILIALTM AND TM.CODEMP=VD.CODEMPTM
      AND VD.TIPOVENDA=new.TIPOVENDA AND VD.CODVENDA=new.CODVENDA AND VD.CODFILIAL=new.CODFILIAL
      AND VD.CODEMP=new.CODEMP
    INTO :DDTVENDA, :CFLAG, :IDOCVENDA, :ICODEMPTM,
      :SCODFILIALTM, :ICODTIPOMOV,:CFISCALTIPOMOV;

  IF (CFISCALTIPOMOV = 'S') THEN
  BEGIN
    IF (new.CODTRATTRIB IS NULL) THEN
      SELECT CF.ORIGFISC,CF.CODEMPTT,CF.CODFILIALTT,CF.CODTRATTRIB FROM
        LFCLFISCAL CF, EQPRODUTO P WHERE P.CODEMP=new.CODEMPPD AND
        P.CODFILIAL=new.CODFILIALPD AND P.CODPROD=new.CODPROD AND
        CF.CODEMP = P.CODEMPFC AND CF.CODFILIAL=P.CODFILIALFC AND
        CF.CODFISC=P.CODFISC INTO new.ORIGFISC,new.CODEMPTT,new.CODFILIALTT,new.CODTRATTRIB;
  END

  IF (new.QTDITVENDA != 0 ) THEN
     NPRECO = new.VLRLIQITVENDA/new.QTDITVENDA;
  ELSE
     NPRECO = new.PRECOITVENDA;

  EXECUTE PROCEDURE EQMOVPRODIUDSP('I', new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
       new.CODEMPLE, new.CODFILIALLE, new.CODLOTE, :ICODEMPTM, :SCODFILIALTM,
       :ICODTIPOMOV, null, null, null, null, null, null, null,
       new.CODEMP, new.CODFILIAL, new.TIPOVENDA, new.CODVENDA, new.CODITVENDA,
       null, null, null, null, new.CODEMPNT, new.CODFILIALNT, new.CODNAT,
       :DDTVENDA, :IDOCVENDA, :CFLAG, new.QTDITVENDA, :NPRECO);
END ^
 
CREATE TRIGGER VDITVENDATGBU FOR VDITVENDA 
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE sTipoFisc CHAR(2);
  DECLARE VARIABLE sRefProd CHAR(13);
  DECLARE VARIABLE sTipoProd CHAR(1);
  declare variable iCodFilialPref SMALLINT;
  DECLARE VARIABLE NTMP NUMERIC(15,3);
BEGIN
  IF ( new.EMMANUT IS NULL) THEN
      new.EMMANUT='N';
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=USER;
      new.HALT = cast('now' AS TIME);
      SELECT ICODFILIAL FROM sgretfilial(new.CODEMP, 'SGPREFERE1') INTO :iCodFilialPref;
      IF (new.CODPROD != old.CODPROD) THEN
        EXCEPTION VDITVENDAEX01;
      IF (new.CODLOTE != old.CODLOTE) THEN
        EXCEPTION VDITVENDAEX02;
      SELECT REFPROD FROM EQPRODUTO WHERE CODPROD=new.CODPROD
             AND CODEMP=new.CODEMPPD AND CODFILIAL = new.codfilialpd INTO sRefProd;
      IF (new.REFPROD IS NULL) THEN new.REFPROD = sRefProd;
      SELECT F.TIPOFISC,P.TIPOPROD FROM LFCLFISCAL F, EQPRODUTO P WHERE P.CODPROD=new.CODPROD
             AND F.CODFISC = P.CODFISC AND F.CODEMP=new.codemp AND F.CODFILIAL = P.CODFILIALFC
             AND P.CODEMP=new.CODEMP AND P.CODFILIAL = new.codfilialpd
             INTO :sTipoFisc,:sTipoProd;
    
    /****
      Desconto:
    ****/
    
      IF (new.VLRLIQITVENDA = 0) THEN
          new.VLRLIQITVENDA = (new.QTDITVENDA * new.PRECOITVENDA) +
             new.VLRADICITVENDA + new.VLRFRETEITVENDA - new.VLRDESCITVENDA;
      ELSE IF (new.VLRDESCITVENDA > 0 AND new.QTDITVENDA > 0) THEN
      BEGIN
        NTMP = new.VLRLIQITVENDA/new.QTDITVENDA;
        NTMP = NTMP * new.QTDITVENDA;
        new.VLRDESCITVENDA = new.VLRDESCITVENDA + (new.VLRLIQITVENDA-NTMP);
        new.VLRLIQITVENDA = new.VLRLIQITVENDA - old.VLRDESCITVENDA + new.VLRDESCITVENDA;
      END
      
      IF (sTipoProd = 'S') THEN
      BEGIN
        SELECT PERCISSEMP FROM SGEMPRESA WHERE CODEMP=new.CODEMP INTO new.PERCISSITVENDA;
        IF (new.PERCISSITVENDA != 0) THEN
        BEGIN
          new.VLRBASEISSITVENDA = new.VLRLIQITVENDA;
          new.VLRISSITVENDA = new.VLRBASEISSITVENDA*(new.PERCISSITVENDA/100);
        END
      END
      ELSE
        new.VLRBASEISSITVENDA = 0;
      IF (sTipoFisc = 'II') THEN
      BEGIN
        new.VLRISENTASITVENDA = new.VLRLIQITVENDA;
        new.VLRBASEICMSITVENDA = 0;
        new.PERCICMSITVENDA = 0;
        new.VLRICMSITVENDA = 0;
        new.VLROUTRASITVENDA = 0;
      END
      ELSE IF (sTipoFisc = 'FF') THEN
      BEGIN
        new.VLROUTRASITVENDA = new.VLRLIQITVENDA;
        new.VLRBASEICMSITVENDA = 0;
        new.PERCICMSITVENDA = 0;
        new.VLRICMSITVENDA = 0;
        new.VLRISENTASITVENDA = 0;
      END
      ELSE IF (sTipoFisc = 'NN') THEN
      BEGIN
        new.VLROUTRASITVENDA = new.VLRLIQITVENDA;
        new.VLRBASEICMSITVENDA = 0;
        new.PERCICMSITVENDA = 0;
        new.VLRICMSITVENDA = 0;
        new.VLRISENTASITVENDA = 0;
      END
      ELSE IF (sTipoFisc = 'TT') THEN
      BEGIN
        new.VLROUTRASITVENDA = 0;
        new.VLRISENTASITVENDA = 0;
      END
   END
END ^
 
CREATE TRIGGER VDITVENDATGAU FOR VDITVENDA 
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE DDTVENDA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCVENDA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
  DECLARE VARIABLE CSTATUS CHAR(2);
  DECLARE VARIABLE CTIPOPROD CHAR(1);
  DECLARE VARIABLE NPRECO NUMERIC(15,3);
BEGIN
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) ) THEN
  BEGIN
      IF (NOT new.CODMENS = old.CODMENS) THEN
      BEGIN
        SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'LFMENSAGEM') INTO new.CODFILIALME;
        new.CODEMPME = new.CODEMP;
      END

      SELECT VD.DTEMITVENDA,VD.DOCVENDA,VD.STATUSVENDA,VD.FLAG,
             VD.CODEMPTM, VD.CODFILIALTM, VD.CODTIPOMOV
        FROM VDVENDA VD
        WHERE VD.CODVENDA = new.CODVENDA AND VD.TIPOVENDA = new.TIPOVENDA
            AND VD.CODEMP=new.CODEMP AND VD.CODFILIAL = new.CODFILIAL
        INTO :DDTVENDA, :IDOCVENDA, :CSTATUS, :CFLAG, :ICODEMPTM,
          :SCODFILIALTM, :ICODTIPOMOV;

      SELECT TIPOPROD FROM EQPRODUTO WHERE CODPROD=old.CODPROD
             AND CODEMP=old.CODEMPPD AND CODFILIAL = old.CODFILIALPD
         INTO CTIPOPROD;

      if (substr(:CSTATUS,1,1)!='C') then
      BEGIN
        UPDATE VDVENDA SET VLRDESCITVENDA = VLRDESCITVENDA -old.VLRDESCITVENDA + new.VLRDESCITVENDA,
               VLRPRODVENDA = VLRPRODVENDA - old.VLRPRODITVENDA + new.VLRPRODITVENDA,
               VLRBASEICMSVENDA = VLRBASEICMSVENDA - old.VLRBASEICMSITVENDA + new.VLRBASEICMSITVENDA,
               VLRICMSVENDA = VLRICMSVENDA -old.VLRICMSITVENDA + new.VLRICMSITVENDA,
               VLRISENTASVENDA = VLRISENTASVENDA - old.VLRISENTASITVENDA + new.VLRISENTASITVENDA,
               VLROUTRASVENDA = VLROUTRASVENDA - old.VLROUTRASITVENDA + new.VLROUTRASITVENDA,
               VLRBASEIPIVENDA = VLRBASEIPIVENDA - old.VLRBASEIPIITVENDA + new.VLRBASEIPIITVENDA,
               VLRIPIVENDA = VLRIPIVENDA - old.VLRIPIITVENDA + new.VLRIPIITVENDA,
               VLRLIQVENDA = VLRLIQVENDA - old.VLRLIQITVENDA + new.VLRLIQITVENDA,
               VLRCOMISVENDA = VLRCOMISVENDA - old.VLRCOMISITVENDA + new.VLRCOMISITVENDA,
               VLRBASEISSVENDA = VLRBASEISSVENDA - old.VLRBASEISSITVENDA + new.VLRBASEISSITVENDA,
               VLRISSVENDA = VLRISSVENDA - old.VLRISSITVENDA + new.VLRISSITVENDA
               WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA
               AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
        IF (SUBSTR(CSTATUS,1,1) = 'P') THEN
          CSTATUS = 'PV';
        ELSE IF (SUBSTR(CSTATUS,1,1) = 'V') THEN
          CSTATUS = 'VD';
      END

      IF (new.QTDITVENDA = 0) THEN
         NPRECO = new.PRECOITVENDA;
      ELSE
         NPRECO = new.VLRLIQITVENDA/new.QTDITVENDA;

      EXECUTE PROCEDURE EQMOVPRODIUDSP('U',new.CODEMPPD, new.CODFILIALPD, new.CODPROD,
        new.CODEMPLE, new.CODFILIALLE, new.CODLOTE, :ICODEMPTM,
        :SCODFILIALTM, :ICODTIPOMOV, null, null, null ,null, null,
        null, null, new.CODEMP, new.CODFILIAL, new.TIPOVENDA, new.CODVENDA,
        new.CODITVENDA, null, null, null, null, new.CODEMPNT, new.CODFILIALNT,
        new.CODNAT, :DDTVENDA, :IDOCVENDA, :CFLAG, new.QTDITVENDA, :NPRECO);
   END
END ^
 
CREATE TRIGGER VDITVENDATGAD FOR VDITVENDA 
ACTIVE AFTER DELETE POSITION 0 
AS
  DECLARE VARIABLE DDTVENDA DATE;
  DECLARE VARIABLE CFLAG CHAR(1);
  DECLARE VARIABLE IDOCVENDA INTEGER;
  DECLARE VARIABLE ICODEMPTM INTEGER;
  DECLARE VARIABLE SCODFILIALTM SMALLINT;
  DECLARE VARIABLE ICODTIPOMOV INTEGER;
BEGIN
  IF ( not ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) THEN
  BEGIN
      UPDATE VDVENDA SET VLRDESCITVENDA = VLRDESCITVENDA -old.VLRDESCITVENDA,
         VLRPRODVENDA = VLRPRODVENDA - old.VLRPRODITVENDA,
         VLRBASEICMSVENDA = VLRBASEICMSVENDA - old.VLRBASEICMSITVENDA,
         VLRICMSVENDA = VLRICMSVENDA -old.VLRICMSITVENDA,
         VLRISENTASVENDA = VLRISENTASVENDA - old.VLRISENTASITVENDA,
         VLROUTRASVENDA = VLROUTRASVENDA - old.VLROUTRASITVENDA,
         VLRBASEIPIVENDA = VLRBASEIPIVENDA - old.VLRBASEIPIITVENDA,
         VLRIPIVENDA = VLRIPIVENDA - old.VLRIPIITVENDA,
         VLRLIQVENDA = VLRLIQVENDA - old.VLRLIQITVENDA,
         VLRCOMISVENDA = VLRCOMISVENDA - old.VLRCOMISITVENDA,
         VLRBASEISSVENDA = VLRBASEISSVENDA - old.VLRBASEISSITVENDA,
         VLRISSVENDA = VLRISSVENDA - old.VLRISSITVENDA,
         VLRDESCITVENDA = VLRDESCITVENDA - old.VLRDESCITVENDA
         WHERE CODVENDA=old.CODVENDA AND TIPOVENDA=old.TIPOVENDA AND
         CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;

      SELECT V.DTEMITVENDA, V.FLAG, V.DOCVENDA,
          V.CODEMPTM, V.CODFILIALTM, V.CODTIPOMOV
       FROM VDVENDA V  WHERE V.CODVENDA = old.CODVENDA AND
          V.CODEMP=old.CODEMP AND V.CODFILIAL = old.CODFILIAL AND
          V.TIPOVENDA=old.TIPOVENDA
      INTO :DDTVENDA, :CFLAG, :IDOCVENDA, :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV;

      EXECUTE PROCEDURE EQMOVPRODIUDSP('D', old.CODEMPPD, old.CODFILIALPD,
         old.CODPROD, old.CODEMPLE, old.CODFILIALLE, old.CODLOTE,
         :ICODEMPTM, :SCODFILIALTM, :ICODTIPOMOV, null, null, null,
         null, null, null, null,
         old.CODEMP, old.CODFILIAL, old.TIPOVENDA, old.CODVENDA, old.CODITVENDA,
          null, null, null, null,
         old.CODEMPNT, old.CODFILIALNT, old.CODNAT, :DDTVENDA,
         :IDOCVENDA, :CFLAG, old.QTDITVENDA, old.PRECOITVENDA);
    
  END
END ^
 
CREATE TRIGGER VDKITTGBI FOR VDKIT 
ACTIVE BEFORE INSERT POSITION 0 
AS
begin
  new.DTINS=cast('now' AS DATE);
  new.IDUSUINS=USER;
  new.HINS = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
  /* Trigger text */
end ^
 
CREATE TRIGGER VDKITTGBU FOR VDKIT 
ACTIVE BEFORE UPDATE POSITION 0 
AS
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT REFPROD FROM EQREFPRODSP(new.CODEMP, new.CODFILIAL, new.CODPROD) INTO new.REFPROD;
  /* Trigger text */
end ^
 
CREATE TRIGGER VDORCAMENTOTGBI FOR VDORCAMENTO 
ACTIVE BEFORE INSERT POSITION 0 
AS
BEGIN
  IF (new.VLRPRODORC IS NULL) THEN new.VLRPRODORC = 0;
  IF (new.VLRDESCORC IS NULL) THEN new.VLRDESCORC = 0;
  IF (new.VLRADICORC IS NULL) THEN new.VLRADICORC = 0;
  IF (new.VLRDESCITORC IS NULL) THEN new.VLRDESCITORC = 0;
  IF (new.VLRLIQORC IS NULL) THEN new.VLRLIQORC = 0;
  IF (new.CODCONV IS NOT NULL AND new.CODCLI IS NULL) THEN
  BEGIN
       SELECT CODCLI,CODEMPCL,CODFILIALCL,CODTPCONV,CODFILIALTC,CODEMPTC FROM ATCONVENIADO
          WHERE CODEMP=new.CODEMPCV AND CODFILIAL=new.CODFILIALCV
          AND CODCONV=new.CODCONV INTO new.CODCLI,new.CODEMPCL,new.CODFILIALCL,
          new.CODTPCONV,new.CODFILIALTC,new.CODEMPTC;
  END

END ^
 
CREATE TRIGGER VDORCAMENTOTGAI FOR VDORCAMENTO 
ACTIVE AFTER INSERT POSITION 0 
AS
DECLARE VARIABLE iCodFilialTb SMALLINT;
DECLARE VARIABLE iCodFilialSt SMALLINT;
DECLARE VARIABLE iCodObj SMALLINT;
BEGIN
  SELECT CODOBJ FROM SGOBJETO WHERE CODEMP=new.CODEMP AND NOMEOBJ='VDSTATUSORC' INTO :iCodObj;
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'VDSTATUSORC') INTO :iCodFilialSt;
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGTABELA') INTO :iCodFilialTb;
  INSERT INTO VDSTATUSORC (CODEMP,CODFILIAL,TIPOORC,CODORC,CODEMPTB,CODFILIALTB,CODTB,CODITTB,MOTIVOSTORC)
     SELECT new.CODEMP, new.CODFILIAL, new.TIPOORC, new.CODORC, new.CODEMP,
         :iCodFilialTb, OTB.CODTB, ITB.CODITTB,'SITUAO INICIAL'
      FROM SGOBJETOTB OTB,SGITTABELA ITB WHERE OTB.CODEMP=new.CODEMP AND OTB.CODFILIALTB=:iCodFilialTb AND
        OTB.CODOBJ=:iCodObj AND ITB.CODEMP=new.CODEMP AND ITB.CODFILIAL=OTB.CODFILIALTB AND
        ITB.CODTB=OTB.CODTB AND ITB.PADRAOITTB='S';
END ^
 
CREATE TRIGGER VDORCAMENTOTGBU FOR VDORCAMENTO 
ACTIVE BEFORE UPDATE POSITION 0 
AS
declare variable ICODATENDO INTEGER;
declare variable ICODSETOR INTEGER;
DECLARE VARIABLE IFILIALPREF INTEGER;
DECLARE VARIABLE IFILIALUSU INTEGER;
BEGIN
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
  SELECT CODCLI,CODEMPCL,CODFILIALCL,CODTPCONV,CODFILIALTC,CODEMPTC FROM ATCONVENIADO
        WHERE CODEMP=new.CODEMPCV AND CODFILIAL=new.CODFILIALCV
        AND CODCONV=new.CODCONV INTO new.CODCLI,new.CODEMPCL,new.CODFILIALCL,
        new.CODTPCONV,new.CODFILIALTC,new.CODEMPTC;
  IF (NOT new.CODCONV = old.CODCONV) THEN
  BEGIN

    SELECT CODCLI,CODEMPCL,CODFILIALCL FROM ATCONVENIADO
      WHERE CODEMP=new.CODEMPCV AND CODFILIAL=new.CODFILIALCV
       AND CODCONV=new.CODCONV INTO new.CODCLI,new.CODEMPCL,new.CODFILIALCL;

  END
  IF (old.STATUSORC = 'OA' AND new.STATUSORC = 'OC') THEN
  BEGIN
    SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGPREFERE2') INTO IFILIALPREF;
    SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'SGUSUARIO') INTO IFILIALUSU;

    SELECT CODSETAT2,CODTPATENDO3 FROM SGPREFERE2
      WHERE CODEMP=new.CODEMP AND CODFILIAL=:IFILIALPREF
      INTO ICODSETOR,ICODATENDO;

    EXECUTE PROCEDURE ATADICATENDIMENTOSP(
      new.CODCONV,:ICODATENDO,new.CODATEND,
      ICODSETOR,NULL,new.CODEMP,:IFILIALUSU,new.CODORC
    );

  END
  IF (new.VLRDESCORC IS NULL) THEN
    new.VLRDESCORC = 0;
  new.VLRLIQORC = new.VLRPRODORC - new.VLRDESCORC - new.VLRDESCITORC + new.VLRADICORC;
END ^
 
CREATE TRIGGER VDORCAMENTOTGBD FOR VDORCAMENTO 
ACTIVE BEFORE DELETE POSITION 0 
as
begin
  DELETE FROM atatendimentoorc WHERE CODORC=old.CODORC
    AND CODFILIAL=old.CODFILIAL AND CODEMP=old.CODEMP;
end ^
 
CREATE TRIGGER VDPRECOPRODTGBU FOR VDPRECOPROD 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDROMANEIOTGBU FOR VDROMANEIO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDSETORTGBU FOR VDSETOR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDSTATUSORCTGBU FOR VDSTATUSORC 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDTABPRECOTGBU FOR VDTABPRECO 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDTIPOCLITGBU FOR VDTIPOCLI 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDTRANSPTGBU FOR VDTRANSP 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT = cast('now' AS TIME);
end ^
 
CREATE TRIGGER VDVENDATGBI FOR VDVENDA 
ACTIVE BEFORE INSERT POSITION 0 
AS
  DECLARE VARIABLE sTipoMov CHAR(2);
BEGIN
  EXECUTE PROCEDURE FNLIBCREDSP(new.CODVENDA,new.CODCLI,new.CODEMPCL,new.CODFILIALCL,null);
  IF (new.VLRPRODVENDA IS NULL) THEN new.VLRPRODVENDA = 0;
  IF (new.VLRDESCVENDA IS NULL) THEN new.VLRDESCVENDA = 0;
  IF (new.VLRDESCITVENDA IS NULL) THEN new.VLRDESCITVENDA = 0;
  IF (new.VLRVENDA IS NULL) THEN new.VLRVENDA = 0;
  IF (new.VLRBASEICMSVENDA IS NULL) THEN new.VLRBASEICMSVENDA = 0;
  IF (new.VLRICMSVENDA IS NULL) THEN new.VLRICMSVENDA = 0;
  IF (new.VLRPISVENDA IS NULL) THEN new.VLRPISVENDA = 0;
  IF (new.VLRCOFINSVENDA IS NULL) THEN new.VLRCOFINSVENDA = 0;
  IF (new.VLRIRVENDA IS NULL) THEN new.VLRIRVENDA = 0;
  IF (new.VLRCSOCIALVENDA IS NULL) THEN new.VLRCSOCIALVENDA = 0;
  IF (new.VLRISENTASVENDA IS NULL) THEN new.VLRISENTASVENDA = 0;
  IF (new.VLROUTRASVENDA IS NULL) THEN new.VLROUTRASVENDA = 0;
  IF (new.VLRBASEIPIVENDA IS NULL) THEN new.VLRBASEIPIVENDA = 0;
  IF (new.VLRIPIVENDA IS NULL) THEN new.VLRIPIVENDA = 0;
  IF (new.VLRLIQVENDA IS NULL) THEN new.VLRLIQVENDA = 0;
  IF (new.VLRCOMISVENDA IS NULL) THEN new.VLRCOMISVENDA = 0;
  IF (new.VLRFRETEVENDA IS NULL) THEN new.VLRFRETEVENDA = 0;
  IF (new.VLRADICVENDA IS NULL) THEN new.VLRADICVENDA = 0;
  IF (new.TIPOVENDA IS NULL) THEN new.TIPOVENDA = 'V';
  
  SELECT CODTERM FROM SGRETCAIXA(new.CODEMP) INTO new.CODCAIXA;
  SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP,'PVCAIXA') INTO new.CODFILIALCX;
  new.CODEMPCX = new.CODEMP;

  SELECT * FROM LFNOVODOCSP(new.Serie,new.CODEMP,new.CODFILIAL) INTO new.DocVenda;
  SELECT TIPOMOV,FISCALTIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
         AND CODEMP=new.CODEMP AND CODFILIAL = new.CODFILIALTM INTO sTipoMov,new.FLAG;
  IF ( new.FLAG <> 'S') THEN
  BEGIN
     new.FLAG = 'N';
  END
  if ((new.STATUSVENDA is null) OR (RTRIM(new.STATUSVENDA) = '*')) then
  BEGIN
     IF (sTipoMov = 'VD') THEN new.STATUSVENDA = 'V1';
     ELSE new.STATUSVENDA = 'P1';
  END
END ^
 
CREATE TRIGGER VDVENDATGBU FOR VDVENDA 
ACTIVE BEFORE UPDATE POSITION 0 
AS
  DECLARE VARIABLE ICODFILIAL INTEGER;
  DECLARE VARIABLE ICODITVENDA INTEGER;
  DECLARE VARIABLE iCodTipoMov INTEGER;
  DECLARE VARIABLE sSerie CHAR(4);
  DECLARE VARIABLE iCodFilialPref smallint;
  DECLARE VARIABLE dDesc DECIMAL(15,3);
  DECLARE VARIABLE PERCPISFILIAL DECIMAL(9,2);
  DECLARE VARIABLE PERCCOFINSFILIAL DECIMAL(9,2);
  DECLARE VARIABLE PERCIRFILIAL DECIMAL(9,2);
  DECLARE VARIABLE PERCCSOCIALFILIAL DECIMAL(9,2);
  DECLARE VARIABLE VLRPRODITVENDA DECIMAL(15,3);
  DECLARE VARIABLE QTDITVENDA DECIMAL(9,2);
  DECLARE VARIABLE VLRCOMISITVENDA DECIMAL(15,3);
  DECLARE VARIABLE PERCCOMISITVENDA DECIMAL(9,2);
  DECLARE VARIABLE SIMPLESFILIAL CHAR(1);
  DECLARE VARIABLE SIMPLESCLI CHAR(1);
  DECLARE VARIABLE PESSOACLI CHAR(1);
BEGIN
  IF (new.EMMANUT IS NULL) THEN
     new.EMMANUT='N';
  if (new.BLOQVENDA IS NULL) then
     new.BLOQVENDA='N';
  if ( ( (old.BLOQVENDA IS  NULL) OR (old.BLOQVENDA='N') ) AND (new.BLOQVENDA='S') )  then
  begin
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=user;
      new.HALT=cast('now' AS TIME);
  end
  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT is not null)) ) ) THEN
  BEGIN
      if ( (old.BLOQVENDA IS NOT NULL AND old.BLOQVENDA='S') or (new.BLOQVENDA='S') ) then
         EXCEPTION VDVENDAEX05 'ESTA VENDA EST BLOQUEADA!!!';
      new.DTALT=cast('now' AS DATE);
      new.IDUSUALT=user;
      new.HALT=cast('now' AS TIME);
      SELECT CODFILIALSEL FROM SGCONEXAO WHERE CODEMP=new.CODEMP AND UPPER(IDUSU)=UPPER(USER)
          AND CONECTADO > 0 INTO ICODFILIAL;
      EXECUTE PROCEDURE FNLIBCREDSP(new.CODVENDA,new.CODCLI,new.CODEMPCL,new.CODFILIALCL,new.VLRLIQVENDA);
      SELECT ICODFILIAL FROM SGRETFILIAL(new.CODEMP, 'SGPREFERE1') INTO iCodFilialPref;
      IF (substr(old.STATUSVENDA,1,1) = 'C') THEN
        EXCEPTION VDVENDAEX05;
      IF (substr(old.STATUSVENDA,1,1) = 'D') THEN
        EXCEPTION VDVENDAEX05 'ESTA VENDA FOI DEVOLVIDA!';
      IF ((SUBSTR(old.STATUSVENDA,1,1) = 'P') AND (SUBSTR(new.STATUSVENDA,1,1) = 'V' ) AND new.IMPNOTAVENDA = 'N') THEN
      BEGIN
        SELECT T2.CODTIPOMOV, T2.SERIE FROM EQTIPOMOV T2, EQTIPOMOV T WHERE T2.CODEMP=T.CODEMPTM
               AND T2.CODFILIAL=T.CODFILIALTM AND T2.CODTIPOMOV = T.CODTIPOMOVTM
               AND T.CODEMP=new.CODEMPTM AND T.CODFILIAL=new.CODFILIALTM AND T.CODTIPOMOV=new.CODTIPOMOV
               INTO :iCodTipoMov, :sSerie;
        IF (iCodTipoMov IS NULL) THEN
          SELECT T.CODTIPOMOV, T.SERIE FROM SGPREFERE1 P, EQTIPOMOV T WHERE P.CODEMPTM=T.CODEMP AND
                 P.CODFILIALTM=T.CODFILIAL AND P.CODTIPOMOV = T.CODTIPOMOV
                 AND P.CODEMP=new.CODEMP AND P.CODFILIAL = :iCodFilialPref INTO :iCodTipoMov, :sSerie;
        new.CODTIPOMOV = :iCodTipoMov;
        new.SERIE = :sSerie;
        IF ( ( not (old.IMPNOTAVENDA = 'S') ) AND ( not (new.IMPNOTAVENDA = 'S') ) ) THEN
        BEGIN
            SELECT DOC FROM LFNOVODOCSP(new.Serie,new.CODEMP,new.CODFILIAL) INTO new.DocVenda;
            new.IMPNOTAVENDA = 'S';
        END
      END
      SELECT FISCALTIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
             AND CODEMP=new.CODEMP AND CODFILIAL = new.codfilialtm INTO new.FLAG;
      IF (new.FLAG<>'S') THEN
        new.FLAG = 'N';
      SELECT VLRFRETEVD FROM VDFRETEVD WHERE CODVENDA=old.CODVENDA AND TIPOVENDA=old.TIPOVENDA AND TIPOFRETEVD = 'C'
             AND CODEMP=old.CODEMP AND CODFILIAL = old.codfilial INTO new.VLRFRETEVENDA;
      IF (new.VLRDESCVENDA IS NULL) THEN
        new.VLRDESCVENDA = 0;
      IF (new.VLRDESCITVENDA IS NULL) THEN
        new.VLRDESCITVENDA = 0;
      IF (new.VLRADICVENDA IS NULL) THEN
        new.VLRADICVENDA = 0;
      IF (new.VLRFRETEVENDA IS NULL) THEN
        new.VLRFRETEVENDA = 0;
      IF (new.VLRPRODVENDA IS NULL) THEN
        new.VLRPRODVENDA = 0;
      IF (new.VLRIPIVENDA IS NULL) THEN
        new.VLRIPIVENDA = 0;
      IF (new.VLRBASEICMSVENDA IS NULL) THEN
        new.VLRBASEICMSVENDA = 0;
        
      IF (new.VLRDESCITVENDA > 0) THEN
        dDesc = new.VLRDESCITVENDA;
      ELSE
        dDesc = new.VLRDESCVENDA;

      SELECT C.SIMPLESCLI,C.PESSOACLI FROM VDCLIENTE C WHERE C.CODCLI=new.CODCLI AND
        C.CODFILIAL=new.CODFILIALCL AND C.CODEMP=new.CODEMPCL INTO SIMPLESCLI,PESSOACLI;
      SELECT SIMPLESFILIAL,PERCPISFILIAL,PERCCOFINSFILIAL,PERCIRFILIAL,PERCCSOCIALFILIAL
        FROM SGFILIAL WHERE CODEMP=new.CODEMP AND CODFILIAL=:ICODFILIAL
        INTO SIMPLESFILIAL,PERCPISFILIAL,PERCCOFINSFILIAL,PERCIRFILIAL,PERCCSOCIALFILIAL;

      IF (SIMPLESFILIAL = 'N') THEN
      BEGIN
        new.VLRPISVENDA = (new.VLRBASEISSVENDA/100)*PERCPISFILIAL;
        new.VLRCOFINSVENDA = (new.VLRBASEISSVENDA/100)*PERCCOFINSFILIAL;
        new.VLRIRVENDA = (new.VLRBASEISSVENDA/100)*PERCIRFILIAL;
        new.VLRCSOCIALVENDA = (new.VLRBASEISSVENDA/100)*PERCCSOCIALFILIAL;
      END
      ELSE
      BEGIN
        new.VLRPISVENDA = 0;
        new.VLRCOFINSVENDA = 0;
        new.VLRIRVENDA = 0;
        new.VLRCSOCIALVENDA = 0;
      END

      new.VLRLIQVENDA = new.VLRPRODVENDA - dDesc +
                        new.VLRFRETEVENDA + new.VLRIPIVENDA;
      IF (SIMPLESCLI = 'N' AND PESSOACLI = 'J') THEN
        new.VLRLIQVENDA = CAST( new.VLRLIQVENDA - new.VLRPISVENDA - new.VLRCOFINSVENDA - new.VLRIRVENDA - new.VLRCSOCIALVENDA AS NUMERIC(15,2));
      IF ((substr(old.STATUSVENDA,1,1) IN ('P','V')) AND (substr(new.STATUSVENDA,1,1)='C')) THEN
      BEGIN
          new.VLRDESCITVENDA = 0;
          new.VLRPRODVENDA = 0;
          new.VLRBASEICMSVENDA = 0;
          new.VLRICMSVENDA = 0;
          new.VLRISENTASVENDA = 0;
          new.VLROUTRASVENDA = 0;
          new.VLRBASEIPIVENDA = 0;
          new.VLRIPIVENDA = 0;
          new.VLRLIQVENDA = 0;
          new.VLRCOMISVENDA = 0;
          new.VLRISSVENDA = 0;
          new.VLRBASEISSVENDA = 0;
      END


    /**
       COMISSAO
    **/

      IF (NOT new.VLRCOMISVENDA IS NULL AND new.VLRLIQVENDA > 0 AND
          NOT new.PERCMCOMISVENDA = old.PERCMCOMISVENDA) THEN
        BEGIN
    
    --Distribuindo a comissao:
    
          FOR SELECT CODITVENDA,VLRPRODITVENDA,QTDITVENDA,VLRCOMISITVENDA FROM VDITVENDA WHERE CODEMP=new.CODEMP AND
            CODFILIAL=new.CODFILIAL AND CODVENDA=new.CODVENDA INTO ICODITVENDA,VLRPRODITVENDA,QTDITVENDA,VLRCOMISITVENDA DO
          BEGIN
    
    --Calculo do item.:
    
            IF (new.VLRPRODVENDA > 0 AND new.PERCMCOMISVENDA > 0) THEN
            BEGIN
              PERCCOMISITVENDA = new.PERCMCOMISVENDA;
    --Retira..
              new.VLRCOMISVENDA = new.VLRCOMISVENDA-VLRCOMISITVENDA;
    --Atualiza..
              VLRCOMISITVENDA = (VLRPRODITVENDA * PERCCOMISITVENDA) / 100;
    --Adiciona..
              new.VLRCOMISVENDA = new.VLRCOMISVENDA+VLRCOMISITVENDA;
              
            END
            UPDATE VDITVENDA SET VLRCOMISITVENDA=:VLRCOMISITVENDA,
               PERCCOMISITVENDA=:PERCCOMISITVENDA WHERE
               CODITVENDA=:ICODITVENDA AND
               CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA
               AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
          END
      END
      ELSE IF (new.PERCMCOMISVENDA = old.PERCMCOMISVENDA AND new.VLRLIQVENDA > 0) THEN
        new.PERCMCOMISVENDA =
          (new.VLRCOMISVENDA/new.VLRLIQVENDA)*100.000;
    
      IF (new.STATUSVENDA = 'V4') THEN
      BEGIN
        new.IMPNOTAVENDA = 'S';
        new.STATUSVENDA = 'V3';
      END
      IF ((new.IMPNOTAVENDA = 'S') AND (old.IMPNOTAVENDA = 'S')) THEN
      BEGIN
        new.DOCVENDA = old.DOCVENDA;
      END
  END
END ^
 
CREATE TRIGGER VDVENDATGAU FOR VDVENDA 
ACTIVE AFTER UPDATE POSITION 0 
AS
  DECLARE VARIABLE ICODREC INTEGER;
  DECLARE VARIABLE UFCLI CHAR(2);
  DECLARE VARIABLE UFFLAG CHAR;
  DECLARE VARIABLE ICODFILIAL SMALLINT;
  DECLARE VARIABLE SCODFILIALRC SMALLINT;
  DECLARE VARIABLE ICODITVENDA INTEGER;
  DECLARE VARIABLE ICODEMPPD INTEGER;
  DECLARE VARIABLE ICODFILIALPD SMALLINT;
  DECLARE VARIABLE ICODPROD INTEGER;
  DECLARE VARIABLE PERCRED DECIMAL(9,2);
  DECLARE VARIABLE PERCIT DECIMAL(9,2);
  DECLARE VARIABLE PERCICMSITVENDA DECIMAL(9,2);
  DECLARE VARIABLE PERCDESCITVENDA DECIMAL(9,2);
  DECLARE VARIABLE PERCIPIITVENDA DECIMAL(9,2);
  DECLARE VARIABLE TIPOFISC CHAR(2);
  DECLARE VARIABLE VLRDESCITVENDA DECIMAL(15,3);
  DECLARE VARIABLE VLRBASEIPIITVENDA DECIMAL(15,3);
  DECLARE VARIABLE VLRBASEICMSITVENDA DECIMAL(15,3);
  DECLARE VARIABLE VLRIPIITVENDA DECIMAL(15,3);
  DECLARE VARIABLE VLRPRODITVENDA DECIMAL(15,3);
  DECLARE VARIABLE VLRLIQITVENDA DECIMAL(15,3);
  DECLARE VARIABLE VLRICMSITVENDA DECIMAL(15,3);
  DECLARE VARIABLE TIPOMOV CHAR(2);
  DECLARE VARIABLE VLRTMP DECIMAL(15,2);
  DECLARE VARIABLE QTDITVENDA DECIMAL(9,2);
  DECLARE VARIABLE NVLRPARCREC NUMERIC(15,3);
  DECLARE VARIABLE NVLRCOMIREC NUMERIC(15,3);
  DECLARE VARIABLE SNROPARCREC SMALLINT;
BEGIN

  IF ( not ( (new.EMMANUT='S') or ( (old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) )) ) THEN
  BEGIN
    /**
      ITVENDA
    **/

      SELECT CODFILIALSEL FROM SGCONEXAO WHERE CODEMP=new.CODEMP AND UPPER(IDUSU)=UPPER(USER)
          AND CONECTADO > 0 INTO ICODFILIAL;

    /*Informaes fiscais.:*/

      SELECT C.UFCLI FROM VDCLIENTE C WHERE C.CODCLI=new.CODCLI AND
        C.CODFILIAL=new.CODFILIALCL AND C.CODEMP=new.CODEMPCL INTO UFCLI;

      UFFLAG = 'N';

      SELECT 'S' FROM SGFILIAL WHERE CODEMP=new.CODEMP
        AND CODFILIAL=:ICODFILIAL AND UFFILIAL=:UFCLI INTO UFFLAG;


      IF (NOT new.VLRDESCVENDA = old.VLRDESCVENDA) THEN
      BEGIN
  
    --Distribuindo o desconto:

        FOR SELECT CODITVENDA,CODEMPPD,CODFILIALPD,CODPROD,PERCDESCITVENDA,PERCICMSITVENDA,
          VLRDESCITVENDA,VLRLIQITVENDA,VLRPRODITVENDA,QTDITVENDA FROM VDITVENDA WHERE CODEMP=new.CODEMP AND
          CODFILIAL=new.CODFILIAL AND CODVENDA=new.CODVENDA INTO ICODITVENDA,ICODEMPPD,ICODFILIALPD,ICODPROD,
          PERCDESCITVENDA,PERCICMSITVENDA,VLRDESCITVENDA,VLRLIQITVENDA,VLRPRODITVENDA,QTDITVENDA DO
        BEGIN

    --Calculo do item.:

          PERCIT = 0;
          IF (new.VLRPRODVENDA > 0 AND NOT new.VLRDESCITVENDA > 0 AND new.VLRDESCVENDA > 0) THEN
          BEGIN
            PERCIT = (100*VLRPRODITVENDA) / new.VLRPRODVENDA;
            VLRDESCITVENDA = (new.VLRDESCVENDA  * PERCIT) / 100;
          END

    /*Busca informaes fiscais.:*/

          SELECT C.REDFISC,C.ALIQIPIFISC,C.TIPOFISC
            FROM EQPRODUTO P, LFCLFISCAL C, LFITREGRAFISCAL R WHERE
            P.CODPROD = :ICODPROD AND P.CODFILIAL = :ICODFILIALPD AND
            P.CODEMP = :ICODEMPPD AND C.CODFISC = P.CODFISC AND C.CODFILIAL = P.CODFILIALFC AND
            C.CODEMP = P.CODEMPFC AND R.CODREGRA = C.CODREGRA AND R.CODFILIAL = C.CODFILIALRA AND
            R.CODEMP = C.CODEMPRA AND R.CVITRF = 'V' AND R.NOUFITRF=:UFFLAG INTO
            PERCRED,PERCIPIITVENDA,TIPOFISC;

          IF (PERCRED IS NULL) THEN
            PERCRED = 0;
          IF (PERCIPIITVENDA IS NULL) THEN
            PERCIPIITVENDA = 0;
          IF (PERCICMSITVENDA IS NULL) THEN
            PERCICMSITVENDA = 0;


          VLRLIQITVENDA = VLRPRODITVENDA - VLRDESCITVENDA;
          VLRBASEIPIITVENDA = 0;
          VLRBASEICMSITVENDA = 0;
          VLRICMSITVENDA = 0;
          VLRIPIITVENDA = 0;
      
          IF (QTDITVENDA > 0) THEN
          BEGIN
            VLRTMP = VLRLIQITVENDA/QTDITVENDA;
            VLRDESCITVENDA = VLRPRODITVENDA - (VLRTMP*QTDITVENDA);
            VLRLIQITVENDA = VLRPRODITVENDA - VLRDESCITVENDA;
          END


          IF ( TIPOFISC = 'II') THEN
          BEGIN
            PERCICMSITVENDA = 0;
            VLRICMSITVENDA = 0;
            VLRBASEICMSITVENDA = 0;
            PERCIPIITVENDA = 0;
            VLRIPIITVENDA = 0;
            VLRBASEIPIITVENDA = 0;
          END
          ELSE IF ( TIPOFISC = 'FF') THEN
          BEGIN
            PERCICMSITVENDA = 0;
            VLRICMSITVENDA = 0;
            VLRBASEICMSITVENDA = 0;
            PERCIPIITVENDA = 0;
            VLRIPIITVENDA = 0;
            VLRBASEIPIITVENDA = 0;
          END
          ELSE IF ( TIPOFISC = 'NN') THEN
          BEGIN
            PERCICMSITVENDA = 0;
            VLRICMSITVENDA = 0;
            VLRBASEICMSITVENDA = 0;
            PERCIPIITVENDA = 0;
            VLRIPIITVENDA = 0;
            VLRBASEIPIITVENDA = 0;
          END
          ELSE IF ( TIPOFISC = 'TT') THEN
          BEGIN
            VLRBASEICMSITVENDA = VLRLIQITVENDA - (VLRPRODITVENDA*(PERCRED/100));
            VLRBASEIPIITVENDA = VLRLIQITVENDA;
            VLRICMSITVENDA = VLRBASEICMSITVENDA*(PERCICMSITVENDA/100);
            VLRIPIITVENDA = VLRBASEIPIITVENDA*(PERCIPIITVENDA/100);
          END
          UPDATE VDITVENDA SET
              VLRBASEICMSITVENDA = :VLRBASEICMSITVENDA,
              VLRBASEIPIITVENDA = :VLRBASEIPIITVENDA,
              VLRICMSITVENDA = :VLRICMSITVENDA,
              VLRIPIITVENDA = :VLRIPIITVENDA,
              VLRDESCITVENDA = :VLRDESCITVENDA,
              VLRLIQITVENDA = :VLRLIQITVENDA
          WHERE
              CODEMP=new.CODEMP AND
              CODFILIAL=new.CODFILIAL AND
              CODVENDA=new.CODVENDA AND
              CODITVENDA=:ICODITVENDA;
        END
      END

    /**
      Financeiro:
    **/

      SELECT TIPOMOV FROM EQTIPOMOV WHERE CODTIPOMOV=new.CODTIPOMOV
             AND CODEMP=new.CODEMPTM AND CODFILIAL=new.CODFILIALTM INTO TIPOMOV;
      SELECT CODREC FROM FNRECEBER WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA
             AND CODEMP=new.CODEMP AND CODFILIALVA=new.CODFILIAL INTO iCodRec;
      IF ((NOT TIPOMOV IN ('DV','TR')) AND
        ((iCodRec IS NULL) OR (
        (new.CODPLANOPAG != old.CODPLANOPAG) OR
        (new.CODCLI != old.CODCLI) OR
        (new.CODVEND != old.CODVEND) OR
        (new.VLRLIQVENDA != old.VLRLIQVENDA) OR
        (new.DTEMITVENDA != old.DTEMITVENDA) OR
        (new.DOCVENDA != old.DOCVENDA) OR
        (new.CODBANCO != old.CODBANCO)))) THEN
      BEGIN
        IF ((SUBSTR(old.STATUSVENDA,1,1) = 'P') AND (SUBSTR(new.STATUSVENDA,1,1) = 'V' )) THEN
        BEGIN
           IF (new.VLRLIQVENDA > 0) THEN
               EXECUTE PROCEDURE FNADICRECEBERSP01(new.TIPOVENDA, new.CODVENDA,new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,
                   new.CODEMPCL,new.CODFILIALCL,new.CODCLI,new.CODEMPVD,new.CODFILIALVD,new.CODVEND,new.VLRLIQVENDA,
                   new.DTSAIDAVENDA,new.VlrComisVenda,new.DOCVENDA,new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,new.FLAG,
                   new.CODEMP,new.CODFILIAL);
           ELSE
               DELETE FROM FNRECEBER WHERE CODVENDA = new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND
                CODEMP=new.CODEMP AND CODFILIALVA = new.CODFILIAL;
        END
        IF ((new.STATUSVENDA IN ('P2','V2')) AND (old.STATUSVENDA IN ('P1','V1'))) THEN
        BEGIN
          IF (new.VLRLIQVENDA > 0) THEN
            EXECUTE PROCEDURE FNADICRECEBERSP01(new.TIPOVENDA, new.CODVENDA,new.CODEMPPG,new.CODFILIALPG,
               new.CODPLANOPAG,new.CODEMPCL,new.CODFILIALCL,new.CODCLI,new.CODEMPVD,new.CODFILIALVD,
               new.CODVEND,new.VLRLIQVENDA,new.DTSAIDAVENDA,new.VlrComisVenda,new.DOCVENDA,new.CODEMPBO,
               new.CODFILIALBO,new.CODBANCO,new.FLAG,new.CODEMP,new.CODFILIAL);
          ELSE
             DELETE FROM FNRECEBER WHERE CODVENDA = new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND
               CODEMP=new.CODEMP AND CODFILIALVA = new.CODFILIAL;
        END
        ELSE IF ((new.STATUSVENDA IN ('P2','V2')) AND (old.STATUSVENDA IN ('P2','V2'))) THEN
        BEGIN
          IF (new.VLRLIQVENDA > 0) THEN
               EXECUTE PROCEDURE FNADICRECEBERSP01(new.TIPOVENDA, new.CODVENDA,new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,
                new.CODEMPCL,new.CODFILIALCL,new.CODCLI,new.CODEMPVD,new.CODFILIALVD,new.CODVEND,
                new.VLRLIQVENDA,new.DTSAIDAVENDA,new.VlrComisVenda,new.DOCVENDA,new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,
                new.FLAG,new.CODEMP,new.CODFILIAL);
          ELSE
             DELETE FROM FNRECEBER WHERE CODVENDA = new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND
               CODEMP=new.CODEMP AND CODFILIALVA = new.CODFILIAL;
        END
        ELSE IF ((new.STATUSVENDA IN ('P3','V3')) AND (old.STATUSVENDA IN ('P3','V3'))) THEN
        BEGIN
           IF (new.VLRLIQVENDA > 0) THEN
               EXECUTE PROCEDURE FNADICRECEBERSP01(new.TIPOVENDA, new.CODVENDA,new.CODEMPPG,new.CODFILIALPG,new.CODPLANOPAG,
                new.CODEMPCL,new.CODFILIALCL,new.CODCLI,new.CODEMPVD,new.CODFILIALVD,new.CODVEND,
                new.VLRLIQVENDA,new.DTSAIDAVENDA,new.VlrComisVenda,new.DOCVENDA,new.CODEMPBO,new.CODFILIALBO,new.CODBANCO,
                new.FLAG,new.CODEMP,new.CODFILIAL);
           ELSE
             DELETE FROM FNRECEBER WHERE CODVENDA = new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND
               CODEMP=new.CODEMP AND CODFILIALVA = new.CODFILIAL;
        END
      END


      IF (old.VLRCOMISVENDA != new.VLRCOMISVENDA) THEN
      BEGIN
        UPDATE FNRECEBER SET VLRCOMIREC=new.VLRCOMISVENDA WHERE
          CODVENDA=new.CODVENDA AND CODEMPVD=new.CODEMP AND
          CODFILIALVD=new.CODFILIAL;
      END
      ELSE IF (old.CODCLCOMIS != new.CODCLCOMIS) THEN
      BEGIN
          SELECT R.CODFILIAL,R.CODREC,R.VLRPARCREC,R.VLRCOMIREC,R.NROPARCREC
            FROM FNRECEBER R
            WHERE R.CODVENDA=new.CODVENDA AND R.TIPOVENDA=new.TIPOVENDA
              AND R.CODEMPVA=new.CODEMP AND R.CODFILIALVA=new.CODFILIAL
            INTO :SCODFILIALRC, :ICODREC, :NVLRPARCREC, :NVLRCOMIREC, :SNROPARCREC;
          EXECUTE PROCEDURE FNITRECEBERSP01(new.CODEMP,:SCODFILIALRC,:ICODREC,
                :NVLRPARCREC,:NVLRCOMIREC,:SNROPARCREC,'S');
      END

      /**
        Testa valor das parcelas x valor da venda
      **/

      IF ((old.STATUSVENDA IN ('P2','V2')) AND (new.STATUSVENDA IN ('P3','V3'))) THEN
      BEGIN
        SELECT VLRPARCREC FROM FNRECEBER WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA
             AND CODEMPVA=new.CODEMP AND CODFILIALVA = new.CODFILIAL INTO :nVlrParcRec;
        IF (new.VLRLIQVENDA != :nVlrParcRec) THEN
          EXCEPTION VDVENDAEX06;
      END
          
    /**
     Movimento do estoque
    **/
          
    -- Avisa os itens que a data de saida foi alterada
      IF ( (new.DTSAIDAVENDA != old.DTSAIDAVENDA) OR
           (new.CODTIPOMOV!=old.CODTIPOMOV) OR
           ( new.DOCVENDA != old.DOCVENDA )  ) THEN
        UPDATE VDITVENDA SET CODITVENDA=CODITVENDA WHERE
             CODVENDA = old.CODVENDA AND TIPOVENDA = old.TIPOVENDA
             AND CODEMP=old.CODEMP AND CODFILIAL=old.CODFILIAL;
      ELSE IF ((substr(new.STATUSVENDA,1,1)='C') AND (substr(old.STATUSVENDA,1,1) IN ('P','V'))) THEN
      BEGIN
        UPDATE VDITVENDA SET QTDITVENDA=0 WHERE CODVENDA=new.CODVENDA AND TIPOVENDA=new.TIPOVENDA
               AND CODEMP=new.CODEMP AND CODFILIAL=new.CODFILIAL;
        DELETE FROM FNRECEBER WHERE CODVENDA = new.CODVENDA AND TIPOVENDA=new.TIPOVENDA AND
           CODEMP=new.CODEMP AND CODFILIALVA = new.CODFILIAL;
      END

   END
END ^
 
CREATE TRIGGER VDVENDATGBD FOR VDVENDA 
ACTIVE BEFORE DELETE POSITION 0 
AS
BEGIN
  IF ( not ( ( old.EMMANUT='S') and (old.EMMANUT IS NOT NULL) ) ) THEN
  BEGIN
      if ( (old.BLOQVENDA IS NOT NULL) AND (old.BLOQVENDA='S') ) then
         EXCEPTION VDVENDAEX05 'ESTA VENDA EST BLOQUEADA!!!';
      DELETE FROM VDFRETEVD WHERE CODVENDA=old.CODVENDA  AND TIPOVENDA=old.TIPOVENDA
             AND CODEMP=old.CODEMP AND CODFILIAL = old.CODFILIAL;
  END
END ^
 
CREATE TRIGGER VDVENDEDORTGBU FOR VDVENDEDOR 
ACTIVE BEFORE UPDATE POSITION 0 
as
begin
  new.DTALT=cast('now' AS DATE);
  new.IDUSUALT=USER;
  new.HALT=cast('now'AS TIME);
end ^
 
COMMIT WORK ^
SET TERM ; ^

/* Grant role for this database */

/* Role: ADM, Owner: SYSDBA */
CREATE ROLE ADM;

/* Grant permissions for this database */
GRANT SELECT, UPDATE ON EQPRODUTO TO PROCEDURE VDPRECOPRODSP01;
GRANT INSERT, SELECT, UPDATE ON VDPRECOPROD TO PROCEDURE VDPRECOPRODSP01;
